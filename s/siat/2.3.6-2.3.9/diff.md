# Comparing `tmp/siat-2.3.6-py3-none-any.whl.zip` & `tmp/siat-2.3.9-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,8 +1,8 @@
-Zip file size: 1715458 bytes, number of entries: 126
+Zip file size: 1715628 bytes, number of entries: 126
 -rw-rw-rw-  2.0 fat      840 b- defN 23-Apr-10 11:29 siat/__init__.py
 -rw-rw-rw-  2.0 fat     2210 b- defN 23-Jul-12 15:22 siat/allin.py
 -rw-rw-rw-  2.0 fat      747 b- defN 23-Apr-10 11:29 siat/alpha_vantage_test.py
 -rw-rw-rw-  2.0 fat    28555 b- defN 23-Apr-10 11:29 siat/assets_liquidity.py
 -rw-rw-rw-  2.0 fat     1285 b- defN 23-Apr-10 11:29 siat/assets_liquidity_test.py
 -rw-rw-rw-  2.0 fat    10110 b- defN 23-Apr-10 11:29 siat/barrons_scraping_test.py
 -rw-rw-rw-  2.0 fat    36597 b- defN 23-Apr-10 11:29 siat/beta_adjustment.py
@@ -75,28 +75,28 @@
 -rw-rw-rw-  2.0 fat    95227 b- defN 23-Jul-13 12:04 siat/option_china.py
 -rw-rw-rw-  2.0 fat    16355 b- defN 23-Apr-10 11:29 siat/option_china_test.py
 -rw-rw-rw-  2.0 fat    70231 b- defN 23-Jul-13 12:03 siat/option_pricing.py
 -rw-rw-rw-  2.0 fat     2203 b- defN 23-Apr-10 11:29 siat/option_pricing_test.py
 -rw-rw-rw-  2.0 fat     5908 b- defN 23-Apr-10 11:29 siat/option_sina_api_test.py
 -rw-rw-rw-  2.0 fat     2610 b- defN 23-Apr-10 11:29 siat/proxy_test.py
 -rw-rw-rw-  2.0 fat     1552 b- defN 23-Apr-10 11:29 siat/quandl_test.py
--rw-rw-rw-  2.0 fat    49572 b- defN 23-Jul-13 11:00 siat/risk_adjusted_return.py
+-rw-rw-rw-  2.0 fat    49632 b- defN 23-Jul-14 12:32 siat/risk_adjusted_return.py
 -rw-rw-rw-  2.0 fat     3416 b- defN 23-Apr-10 11:29 siat/risk_adjusted_return_test.py
 -rw-rw-rw-  2.0 fat    75899 b- defN 23-Jul-13 11:58 siat/risk_evaluation.py
 -rw-rw-rw-  2.0 fat     3731 b- defN 23-Apr-10 11:29 siat/risk_evaluation_test.py
 -rw-rw-rw-  2.0 fat    12388 b- defN 23-Jul-13 11:53 siat/risk_free_rate.py
 -rw-rw-rw-  2.0 fat     4285 b- defN 23-Apr-10 11:29 siat/risk_free_rate_test.py
 -rw-rw-rw-  2.0 fat   102148 b- defN 23-Jul-13 11:51 siat/sector_china.py
 -rw-rw-rw-  2.0 fat     5843 b- defN 23-Apr-11 14:17 siat/sector_china_test.py
 -rw-rw-rw-  2.0 fat    29185 b- defN 23-May-25 02:36 siat/security_price.py
--rw-rw-rw-  2.0 fat    74152 b- defN 23-Jul-13 11:29 siat/security_prices.py
+-rw-rw-rw-  2.0 fat    74707 b- defN 23-Jul-14 12:33 siat/security_prices.py
 -rw-rw-rw-  2.0 fat    10779 b- defN 23-Apr-10 11:29 siat/security_prices_test.py
 -rw-rw-rw-  2.0 fat     1335 b- defN 23-Apr-10 11:29 siat/setup.py
 -rw-rw-rw-  2.0 fat     1418 b- defN 23-Apr-10 11:29 siat/shenwan index history test.py
--rw-rw-rw-  2.0 fat   130345 b- defN 23-Jul-13 11:34 siat/stock.py
+-rw-rw-rw-  2.0 fat   130763 b- defN 23-Jul-14 12:28 siat/stock.py
 -rw-rw-rw-  2.0 fat    31655 b- defN 23-Apr-10 11:29 siat/stock_advice_linear.py
 -rw-rw-rw-  2.0 fat     1312 b- defN 23-Apr-10 11:29 siat/stock_base.py
 -rw-rw-rw-  2.0 fat    83256 b- defN 23-Jul-13 11:37 siat/stock_china.py
 -rw-rw-rw-  2.0 fat     1294 b- defN 23-Jun-14 07:32 siat/stock_china_test.py
 -rw-rw-rw-  2.0 fat  1266744 b- defN 23-Jun-05 00:13 siat/stock_info.pickle
 -rw-rw-rw-  2.0 fat     6122 b- defN 23-Apr-10 11:29 siat/stock_info_test.py
 -rw-rw-rw-  2.0 fat     1014 b- defN 23-Apr-10 11:29 siat/stock_list_china_test.py
@@ -117,12 +117,12 @@
 -rw-rw-rw-  2.0 fat   118133 b- defN 23-Apr-10 11:29 siat/translate-20230206.py
 -rw-rw-rw-  2.0 fat   121657 b- defN 23-Apr-10 11:29 siat/translate-20230215.py
 -rw-rw-rw-  2.0 fat   134125 b- defN 23-Jul-13 11:40 siat/translate.py
 -rw-rw-rw-  2.0 fat     3936 b- defN 23-Apr-10 11:29 siat/universal_test.py
 -rw-rw-rw-  2.0 fat    52191 b- defN 23-Jul-13 11:46 siat/valuation_china.py
 -rw-rw-rw-  2.0 fat     1571 b- defN 23-Apr-10 11:29 siat/valuation_market_china_test.py
 -rw-rw-rw-  2.0 fat    14859 b- defN 23-Apr-10 11:29 siat/var_model_validation.py
--rw-rw-rw-  2.0 fat     1422 b- defN 23-Jul-13 12:31 siat-2.3.6.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 23-Jul-13 12:31 siat-2.3.6.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        5 b- defN 23-Jul-13 12:31 siat-2.3.6.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat    10131 b- defN 23-Jul-13 12:31 siat-2.3.6.dist-info/RECORD
-126 files, 7813194 bytes uncompressed, 1699992 bytes compressed:  78.2%
+-rw-rw-rw-  2.0 fat     1384 b- defN 23-Jul-14 13:31 siat-2.3.9.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-Jul-14 13:31 siat-2.3.9.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        5 b- defN 23-Jul-14 13:31 siat-2.3.9.dist-info/top_level.txt
+?rw-rw-r--  2.0 fat    10131 b- defN 23-Jul-14 13:31 siat-2.3.9.dist-info/RECORD
+126 files, 7814189 bytes uncompressed, 1700162 bytes compressed:  78.2%
```

## zipnote {}

```diff
@@ -360,20 +360,20 @@
 
 Filename: siat/valuation_market_china_test.py
 Comment: 
 
 Filename: siat/var_model_validation.py
 Comment: 
 
-Filename: siat-2.3.6.dist-info/METADATA
+Filename: siat-2.3.9.dist-info/METADATA
 Comment: 
 
-Filename: siat-2.3.6.dist-info/WHEEL
+Filename: siat-2.3.9.dist-info/WHEEL
 Comment: 
 
-Filename: siat-2.3.6.dist-info/top_level.txt
+Filename: siat-2.3.9.dist-info/top_level.txt
 Comment: 
 
-Filename: siat-2.3.6.dist-info/RECORD
+Filename: siat-2.3.9.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## siat/risk_adjusted_return.py

```diff
@@ -335,15 +335,15 @@
     end  ='2021-1-31'
     scope='US'
     ratio_name='sharpe'
     window=30
     graph=True    
     
 def rar_ratio_rolling(portfolio,start,end,ratio_name='treynor',RF=True, \
-                      window=30,graph=True):
+                      window=30,graph=True,source='auto'):
     """
     功能：滚动计算一个投资组合的风险调整后的收益率指数
     投资组合的结构：{'Market':('US','^GSPC'),'AAPL':0.5,'MSFT':0.3,'IBM':0.2}
     输入：投资组合，开始日期，结束日期，指数名称，滚动窗口宽度(天数)
     输出：风险调整后的收益率指数序列
     注意：因需要滚动计算，开始和结束日期之间需要拉开距离，提前的月数为window/21取整+1；
     另外，无风率可用数据可能距离当前日期滞后约两个月
@@ -372,15 +372,15 @@
     startdate1=date_adjust(startdate, adjust=-startdate_delta)
     
     #从字典中提取信息
     scope,mktidx,stocklist,portionlist=decompose_portfolio(portfolio)
     
     #第2步：计算投资组合的日收益率序列
     #抓取日投资组合价格
-    sp=get_portfolio_prices(portfolio,startdate1,enddate)
+    sp=get_portfolio_prices(portfolio,startdate1,enddate,source=source)
     if sp is None: 
         message="  #Error("+func_name+"): "+"failed to retrieve portfolio info, pls try later"
         print(message)        
         return None
     #计算日收益率，表示为百分比
     import pandas as pd
     ret_pf=pd.DataFrame(sp['Close'].pct_change())*100.0
@@ -1176,15 +1176,15 @@
     sortby='tpw_mean'
     
     graph=False
 
 def compare_mrar(tickers,rar_name,start,end, \
                  market="China",market_index="000300.SS",RF=False,window=60, \
                  axhline_value=0,axhline_label='零线',graph=True,printout=True, \
-                 sortby='tpw_mean'):
+                 sortby='tpw_mean',source='auto'):
     """
     功能：计算多只股票的rar比率，并绘图对比
     比率：支持夏普比率、特雷诺比率、索替诺比率、阿尔法比率等
     
     注意：当RF=False时可能有bug
     """    
     #检查tickers是否为列表且不少于两只股票
@@ -1221,15 +1221,15 @@
     print("Starting to retrive and calculate rar ratios, please wait ......")
     for t in tickers:
         
         pf={'Market':(market,market_index),t:1.0}
         #关闭print输出
         with HiddenPrints():
             df_tmp=rar_ratio_rolling(pf,start1,end,ratio_name=rar_name, \
-                                 RF=RF,window=window,graph=False)
+                                     RF=RF,window=window,graph=False,source=source)
         
         if df_tmp is None:
             print("  #Warning(compare_mrar): data not available for",t)
             continue
         else:
             dft=df_tmp[['RAR']]
             #dft.rename(columns={'RAR':codetranslate(t)},inplace=True)
```

## siat/security_prices.py

```diff
@@ -14,19 +14,19 @@
 from siat.common import *
 from siat.translate import *
 #==============================================================================
 import pandas as pd
 
 #==============================================================================
 #==============================================================================
-def get_price(ticker,fromdate,todate,adj=False):
+def get_price(ticker,fromdate,todate,adj=False,source='auto'):
     """
     套壳函数get_prices，为保持兼容
     """
-    df=get_prices(ticker,fromdate,todate,adj=adj)
+    df=get_prices(ticker,fromdate,todate,adj=adj,source=source)
     
     df2=remove_timezone(df)
     return df2
 #==============================================================================
 if __name__=='__main__':
     ticker='AAPL'
     fromdate='2011-1-1'
@@ -71,15 +71,16 @@
 
 """
 北交所股票以43开头或83、87、88开头，因为新三板(基础层、创新层)股票代码一般为43、83、87开头。
 沪市普通A股股票代码是以60开头，沪市科创板股票代码是以688开头。
 深市普通A股票代码是以00开头，深市创业板股票代码以300开头。
 """
 
-def get_prices(ticker,fromdate,todate,adj=False,retry_count=3,pause=1):
+def get_prices(ticker,fromdate,todate,adj=False,source='auto', \
+               retry_count=3,pause=1):
     """
     功能：抓取证券价格，pandas_datareader + yfinance + akshare
     输出：指定收盘价格序列，日期升序排列
     ticker: 股票代码或其列表。大陆股票代码加上后缀.SZ或.SS，港股代码去掉前导0加后缀.HK
     start: 样本开始日期，yyyy-mm-dd
     end: 样本结束日期，既可以是今天日期，也可以是一个历史日期
     retry_count：网络失败时的重试次数
@@ -103,114 +104,116 @@
             print("  #Warning(get_prices): info retrieving failed from fred for",ticker)
         else:
             if len(prices)==0:
                 print("  #Warning(get_prices): zero record found in fred for",ticker)
             else:
                 return prices
     """
-    
-    #尝试AkShare+Sina+EM（新浪，对中国内地股票、港股和美股有效，但不包括国外市场指数）
-    #printmsg=str(ticker)+" from "+fromdate+' to '+todate
-    print("  Trying to capture prices from sina/EM for",ticker)
-    try:
-        #prices=get_prices_ak(ticker,fromdate,todate,adjust=adj)
-        prices=get_prices_ak(ticker,fromdate,todate)
-    except:
-        print("  #Warning(get_prices): info retrieving failed from sina/EM for",ticker)
-        #return None 
-    else:
-        if prices is None: 
-            print("  #Warning(get_prices): info not found from sina/EM for",ticker)
+    if source in ['auto']:
+        #尝试AkShare+Sina+EM（新浪，对中国内地股票、港股和美股有效，但不包括国外市场指数）
+        #printmsg=str(ticker)+" from "+fromdate+' to '+todate
+        print("  Trying to capture prices from sina/EM for",ticker)
+        try:
+            #prices=get_prices_ak(ticker,fromdate,todate,adjust=adj)
+            prices=get_prices_ak(ticker,fromdate,todate)
+        except:
+            print("  #Warning(get_prices): info retrieving failed from sina/EM for",ticker)
+            #return None 
         else:
-            num=len(prices)
-            if num==0:
-                print("  #Warning(get_prices): zero record found in sina/EM for",ticker)
+            if prices is None: 
+                print("  #Warning(get_prices): info not found from sina/EM for",ticker)
             else:
-                #print("  Successfully retrieved",num,"records for",ticker)
-                prices2=remove_timezone(prices)
+                num=len(prices)
+                if num==0:
+                    print("  #Warning(get_prices): zero record found in sina/EM for",ticker)
+                else:
+                    #print("  Successfully retrieved",num,"records for",ticker)
+                    prices2=remove_timezone(prices)
                 return prices2        
 
-    #尝试pandas_datareader+stooq（对美股、港股、欧股、国外市场指数有效，但对深交所股票无效）
-    #注意stooq代码与新浪/stooq的不同
-    print("  Trying to capture info from stooq for",ticker)
-    try:
-        prices=get_price_stooq(ticker,fromdate,todate)
-    except:
-        print("  #Warning(get_prices): info retrieving failed from stooq for",ticker)
-        #return None 
-    else:
-        if prices is None: 
-            print("  #Warning(get_prices): info not found from stooq for",ticker)
+    if source in ['auto','stooq']:
+        #尝试pandas_datareader+stooq（对美股、港股、欧股、国外市场指数有效，但对深交所股票无效）
+        #注意stooq代码与新浪/stooq的不同
+        print("  Trying to capture info from stooq for",ticker)
+        try:
+            prices=get_price_stooq(ticker,fromdate,todate)
+        except:
+            print("  #Warning(get_prices): info retrieving failed from stooq for",ticker)
+            #return None 
         else:
-            num=len(prices)
-            if num==0:
-                print("  #Warning(get_prices): zero record found for",ticker)
+            if prices is None: 
+                print("  #Warning(get_prices): info not found from stooq for",ticker)
             else:
-                #print("  Successfully retrieved",num,"records for",ticker)
-                prices2=remove_timezone(prices)
-                return prices2        
-    
-    #使用yahoo+yfinance抓取数据                
-    #由于雅虎无法访问，建议暂时关闭，2021-10-24
-    #抓取证券（列表）价格，需要调整收盘价：yfinance优先，线程极易出错，先尝试关闭线程
-    try:
-        print("  Trying to capture info from Yahoo Finance using non-threads for",ticker)
-        prices=get_prices_yf(ticker,start,end,threads=False)
-    except:
-        print("  #Warning(get_prices): retrieving using non-threads failed from yahoo for",ticker)
-    else:
-        if prices is None: 
-            print("  #Warning(get_prices): info not found using non-threads failed from yahoo for",ticker)
+                num=len(prices)
+                if num==0:
+                    print("  #Warning(get_prices): zero record found for",ticker)
+                else:
+                    #print("  Successfully retrieved",num,"records for",ticker)
+                    prices2=remove_timezone(prices)
+                    return prices2        
+
+    if source in ['auto','yahoo']:
+        #使用yahoo+yfinance抓取数据                
+        #由于雅虎无法访问，建议暂时关闭，2021-10-24
+        #抓取证券（列表）价格，需要调整收盘价：yfinance优先，线程极易出错，先尝试关闭线程
+        try:
+            print("  Trying to capture info from Yahoo Finance using non-threads for",ticker)
+            prices=get_prices_yf(ticker,start,end,threads=False)
+        except:
+            print("  #Warning(get_prices): retrieving using non-threads failed from yahoo for",ticker)
         else:
-            num=len(prices)
-            if num==0:
-                print("  #Warning(get_prices): zero record found for",ticker)
+            if prices is None: 
+                print("  #Warning(get_prices): info not found using non-threads failed from yahoo for",ticker)
             else:
-                #print("  Successfully retrieved",num,"records for",ticker)
-                prices2=remove_timezone(prices)
-                return prices2        
+                num=len(prices)
+                if num==0:
+                    print("  #Warning(get_prices): zero record found for",ticker)
+                else:
+                    #print("  Successfully retrieved",num,"records for",ticker)
+                    prices2=remove_timezone(prices)
+                    return prices2        
 
-    #抓取证券（列表）价格，需要调整收盘价：yfinance优先，尝试打开线程
-    try:
-        print("  Trying to capture info from Yahoo Finance using threads for",ticker)
-        prices=get_prices_yf(ticker,start,end,threads=True)
-    except:
-        print("  #Warning(get_prices): retrieving using threads failed from yahoo for",ticker)
-    else:
-        if prices is None: 
-            print("  #Warning(get_prices): info not found using non-threads failed from yahoo for",ticker)
+        #抓取证券（列表）价格，需要调整收盘价：yfinance优先，尝试打开线程
+        try:
+            print("  Trying to capture info from Yahoo Finance using threads for",ticker)
+            prices=get_prices_yf(ticker,start,end,threads=True)
+        except:
+            print("  #Warning(get_prices): retrieving using threads failed from yahoo for",ticker)
         else:
-            num=len(prices)
-            if num==0:
-                print("  #Warning(get_prices): zero record found for",ticker)
+            if prices is None: 
+                print("  #Warning(get_prices): info not found using non-threads failed from yahoo for",ticker)
             else:
-                #print("  Successfully retrieved",num,"records for",ticker)
-                prices2=remove_timezone(prices)
-                return prices2        
-    
-    #抓取证券（列表）价格，不考虑是否需要调整收盘价：pandas_datareader
-    #由于雅虎财经当前无法访问，建议本段停用
-    #由于雅虎无法访问，暂时关闭，2021-10-24
-    try:    
-        print("  Trying to capture info from Yahoo Finance in traditional process for",ticker)
-        prices=get_prices_yahoo(ticker,start,end,retry_count=retry_count,pause=pause)
-    except:    
-        print("  #Warning(get_prices): info retrieving failed from Yahoo Finance in traditional process for",ticker)    
-        return None    
-    else:
-        if prices is None: 
-            print("  #Warning(get_prices): info not found  from Yahoo Finance in traditional process for",ticker)
+                num=len(prices)
+                if num==0:
+                    print("  #Warning(get_prices): zero record found for",ticker)
+                else:
+                    #print("  Successfully retrieved",num,"records for",ticker)
+                    prices2=remove_timezone(prices)
+                    return prices2        
+    
+        #抓取证券（列表）价格，不考虑是否需要调整收盘价：pandas_datareader
+        #由于雅虎财经当前无法访问，建议本段停用
+        #由于雅虎无法访问，暂时关闭，2021-10-24
+        try:    
+            print("  Trying to capture info from Yahoo Finance in traditional process for",ticker)
+            prices=get_prices_yahoo(ticker,start,end,retry_count=retry_count,pause=pause)
+        except:    
+            print("  #Warning(get_prices): info retrieving failed from Yahoo Finance in traditional process for",ticker)    
+            return None    
         else:
-            num=len(prices)
-            if num==0:
-                print("  #Warning(get_prices): zero record found for",ticker)
+            if prices is None: 
+                print("  #Warning(get_prices): info not found  from Yahoo Finance in traditional process for",ticker)
             else:
-                #print("  Successfully retrieved",num,"records for",ticker)
-                prices2=remove_timezone(prices)
-                return prices2        
+                num=len(prices)
+                if num==0:
+                    print("  #Warning(get_prices): zero record found for",ticker)
+                else:
+                    #print("  Successfully retrieved",num,"records for",ticker)
+                    prices2=remove_timezone(prices)
+                    return prices2        
     
     #若能够抓取到数据均已提前返回，到达此处时表面未能抓取到任何数据
     print("  #Warning(get_prices): tried everyting but nothing found for",ticker)
     return None
     
     
 
@@ -1782,15 +1785,15 @@
     portfolio={'Market':('US','^GSPC'),'AAPL':1}
     portfolio={'Market':('China','^HSI'),'0823.HK':1.0}
     portfolio={'Market':('China','000001.SS'),'000661.SZ':2,'603392.SS':3,'300601.SZ':4}
     fromdate='2019-7-19'
     todate='2020-7-20'
     adj=False
 
-def get_portfolio_prices(portfolio,fromdate,todate,adj=False):
+def get_portfolio_prices(portfolio,fromdate,todate,adj=False,source='auto'):
     """
     功能：抓取投资组合portfolio的每日价值和FF3各个因子
     输入：投资组合portfolio，开始日期，结束日期
     fromdate: 样本开始日期。格式：'YYYY-MM-DD'
     todate: 样本结束日期。既可以是今天日期，也可以是一个历史日期    
     
     输出：投资组合的价格序列，按照日期升序排列
@@ -1802,15 +1805,15 @@
     #检查股票列表个数与份额列表个数是否一致
     if len(tickerlist) != len(sharelist):
         print("  #Error(get_portfolio_prices): numbers of stocks and shares mismatch.")
         return None        
     
     #抓取股票价格
     #print("  Searching portfolio prices for",tickerlist,'from',fromdate,'to',todate)
-    p=get_prices(tickerlist,fromdate,todate,adj=adj)
+    p=get_prices(tickerlist,fromdate,todate,adj=adj,source=source)
     if p is None:
         print("  #Error(get_portfolio_prices): information inaccessible for",tickerlist)
         return None  
 
     #print("  Retrieved",len(p),'records of portfolio records')
     import pandas as pd
     if len(sharelist) > 0:
```

## siat/stock.py

```diff
@@ -399,19 +399,21 @@
     info=stock_profile("LBNDX",option="financial")
     #期货
     info=stock_profile("VXX",option="basic")
     info=stock_profile("VXX",option="market")
     info=stock_profile("VXX",option="financial")    
 
 #==============================================================================
-def security_price(ticker, fromdate, todate, adj=False, datatag=False, power=0):
+def security_price(ticker,fromdate,todate,adj=False, \
+                   datatag=False,power=0,source='auto'):
     """
     功能：绘制证券价格折线图。为维持兼容性，套壳函数stock_price
     """
-    df=stock_price(ticker=ticker,fromdate=fromdate,todate=todate,adj=adj,datatag=datatag,power=power)
+    df=stock_price(ticker=ticker,fromdate=fromdate,todate=todate, \
+                   adj=adj,datatag=datatag,power=power,source=source)
     
     return df
 
 if __name__ =="__main__":
     # 测试获取股价：沪深指数
     df=security_price("000001.SS","2022-11-1","2022-12-15")
     df=security_price("000300.SS","2022-11-1","2022-12-15")
@@ -439,24 +441,25 @@
 #==============================================================================
 if __name__ =="__main__":
     ticker="185851.SS"
     fromdate="2023-1-1"
     todate="2023-5-20"
 
 
-def stock_price(ticker, fromdate, todate, adj=False, datatag=False, power=0):
+def stock_price(ticker,fromdate,todate,adj=False, \
+                datatag=False,power=0,source='auto'):
     """
     功能：绘制证券价格折线图。
     输入：证券代码ticker；开始日期fromdate，结束日期todate；
     是否标注数据标签datatag，默认否；多项式趋势线的阶数，若为0则不绘制趋势线。
     输出：绘制证券价格折线图
     返回：证券价格数据表
     """
     #抓取证券价格
-    df=get_price(ticker,fromdate,todate,adj=adj)
+    df=get_price(ticker,fromdate,todate,adj=adj,source=source)
     
     if not (df is None):
         tickername=codetranslate(ticker)
 
         import datetime; today = datetime.date.today()
         lang=check_language()
         if lang == 'English':
@@ -542,21 +545,22 @@
     indicator="Exp Ret%"
     indicator="Annual Ret Volatility%"
     
     datatag=False
     power=0
     graph=True
 
-def security_indicator(ticker,indicator,fromdate,todate,datatag=False,power=0,graph=True):
+def security_indicator(ticker,indicator,fromdate,todate, \
+                       datatag=False,power=0,graph=True,source='auto'):
     """
     功能：单只证券的全部指标
     """
     fromdate1=date_adjust(fromdate,adjust=-365*3)
     
-    pricedf=get_price(ticker,fromdate1,todate)
+    pricedf=get_price(ticker,fromdate1,todate,source=source)
     if pricedf is None:
         print("  #Error(security_indicator): security info not found for",ticker)
         return None
     
     erdf=all_calculate(pricedf,ticker,fromdate,todate)
     
     import pandas as pd
@@ -590,29 +594,30 @@
         
     plot_line(erdf3,indicator,collabel,ylabeltxt,titletxt,footnote,datatag=datatag, \
               power=power,zeroline=zeroline)
     
     return erdf3
     
     
-def stock_ret(ticker,fromdate,todate,rtype="Daily Ret%",datatag=False,power=0,graph=True):
+def stock_ret(ticker,fromdate,todate,rtype="Daily Ret%", \
+              datatag=False,power=0,graph=True,source='auto'):
     """
     功能：绘制证券收益率折线图。
     输入：证券代码ticker；开始日期fromdate，结束日期todate；收益率类型type；
     是否标注数据标签datatag，默认否；多项式趋势线的阶数，若为0则不绘制趋势线。
     输出：绘制证券价格折线图
     返回：证券价格数据表
     """
     #调整抓取样本的开始日期366*2=732，以便保证有足够的样本供后续计算
     fromdate1=date_adjust(fromdate, -732)
 
     #抓取证券价格
     adj=False
     if 'Adj' in rtype: adj=True
-    pricedf=get_price(ticker,fromdate1,todate,adj=adj)
+    pricedf=get_price(ticker,fromdate1,todate,adj=adj,source=source)
     if pricedf is None:
         print("  #Error(stock_ret): failed to find price info for",ticker,fromdate,todate)
         return None
     pricedfcols=list(pricedf)    
     
     #加入日收益率
     drdf=calc_daily_return(pricedf)
@@ -674,15 +679,16 @@
     graph=True
     smooth=False
     loc='best'
     annotate=False
 
 def security_mindicators(ticker,measures,fromdate,todate, \
                          graph=True,smooth=False,loc='best', \
-                         date_range=False,date_freq=False,annotate=False):
+                         date_range=False,date_freq=False,annotate=False, \
+                         source='auto'):
     """
     功能：单个证券，多个指标对比
     date_range=False：指定开始结束日期绘图
     date_freq=False：指定横轴日期间隔，例如'D'、'2D'、'W'、'M'等，横轴一般不超过25个标注，否则会重叠
     """
     # 提前开始日期
     fromdate1=date_adjust(fromdate,adjust=-365*3)
@@ -694,15 +700,15 @@
             print("  #Error(security_mindicators): need 1 ticker only in",ticker)
             return None
 
     if isinstance(measures,str):
         measures=[measures]
     
     try:
-        pricedf=get_price(ticker,fromdate1,todate)
+        pricedf=get_price(ticker,fromdate1,todate,source=source)
     except:
         print("  #Error(security_mindicators): price info not found for",ticker)
         return None
     if pricedf is None:
         print("  #Error(security_mindicators): none of price info found for",ticker)
         return None
     if len(pricedf) ==0:
@@ -1293,27 +1299,27 @@
     fromdate='2020-1-1'
     todate='2020-3-16'
     df1=stock_ret(ticker1,fromdate,todate,graph=False)
     df2=stock_ret(ticker2,fromdate,todate,graph=False)
     comp_2securities_1measure(df1,df2,measure)
 #==============================================================================
 def compare_security(tickers,measures,fromdate,todate,twinx=False, \
-                     loc1='best',loc2='lower left',graph=True):
+                     loc1='best',loc2='lower left',graph=True,source='auto'):
     """
     功能：函数克隆compare_stock
     """
     tickers=upper_ticker(tickers)
     result=compare_stock(tickers=tickers,measures=measures, \
-                  fromdate=fromdate,todate=todate,twinx=twinx, \
-                      loc1=loc1,loc2=loc2,graph=graph)
+                         fromdate=fromdate,todate=todate,twinx=twinx, \
+                         loc1=loc1,loc2=loc2,graph=graph,source=source)
     return result
 
 #==============================================================================
 def compare_stock(tickers,measures,fromdate,todate,twinx=False, \
-                  loc1='best',loc2='lower left',graph=True):    
+                  loc1='best',loc2='lower left',graph=True,source='auto'):    
     """
     功能：对比绘制折线图：一只证券的两种测度，或两只证券的同一个测度。
     输入：
     证券代码tickers，如果是一个列表且内含两个证券代码，则认为希望比较两个证券的
     同一个测度指标。如果是一个列表但只内含一个证券代码或只是一个证券代码的字符串，
     则认为希望比较一个证券的两个测度指标。
     测度指标measures：如果是一个列表且内含两个测度指标，则认为希望比较一个证券的
@@ -1357,15 +1363,15 @@
             return None,None
         if measure_num >= 1: measure1 = measures[0]
         if measure_num >= 2: measure2 = measures[1]
 
     #是否单一证券代码+两个测度指标
     if (security_num == 1) and (measure_num >= 2):
         #证券ticker1：抓取行情，并计算其各种期间的收益率
-        df1a=stock_ret(ticker1,fromdate,todate,graph=False)
+        df1a=stock_ret(ticker1,fromdate,todate,graph=False,source=source)
         if df1a is None: return None,None
         if DEBUG: print("compare|df1a first date:",df1a.index[0])
         #加入价格波动指标
         df1b=price_volatility2(df1a,ticker1,fromdate,todate,graph=False)
         if DEBUG: print("compare|df1b first date:",df1b.index[0])
         #加入收益率波动指标
         df1c=ret_volatility2(df1b,ticker1,fromdate,todate,graph=False)
@@ -1388,27 +1394,27 @@
             result2=pltdf1[[measure2]]
         except:
             return result1,None
         
     elif (security_num >= 2) and (measure_num >= 1):
         #双证券+单个测度指标        
         #证券ticker1：抓取行情，并计算其各种期间的收益率
-        df1a=stock_ret(ticker1,fromdate,todate,graph=False)
+        df1a=stock_ret(ticker1,fromdate,todate,graph=False,source=source)
         if df1a is None: return None,None
         #加入价格波动指标
         df1b=price_volatility2(df1a,ticker1,fromdate,todate,graph=False)
         #加入收益率波动指标
         df1c=ret_volatility2(df1b,ticker1,fromdate,todate,graph=False)
         #加入收益率下偏标准差指标
         df1d=ret_lpsd2(df1c,ticker1,fromdate,todate,graph=False)        
         #去掉开始日期以前的数据
         pltdf1=df1d[df1d.index >= fromdate]
         
         #证券ticker2：
-        df2a=stock_ret(ticker2,fromdate,todate,graph=False)
+        df2a=stock_ret(ticker2,fromdate,todate,graph=False,source=source)
         if df2a is None: return None,None
         df2b=price_volatility2(df2a,ticker2,fromdate,todate,graph=False)
         df2c=ret_volatility2(df2b,ticker2,fromdate,todate,graph=False)
         df2d=ret_lpsd2(df2c,ticker2,fromdate,todate,graph=False)
         pltdf2=df2d[df2d.index >= fromdate]
         
         #绘制双证券单指标对比图
@@ -1466,15 +1472,16 @@
     scaling_option='start'
     
 def compare_msecurity(tickers,measure,start,end, \
                       axhline_value=0,axhline_label='', \
                       preprocess='none',linewidth=1.5, \
                       scaling_option='start', \
                       graph=True,loc='best', \
-                      annotate=False,smooth=False):
+                      annotate=False,smooth=False, \
+                      source='auto'):
     """
     功能：比较并绘制多条证券指标曲线（多于2条），个数可为双数或单数
     注意：
     tickers中须含有2个及以上股票代码，
     measure为单一指标，
     axhline_label不为空时绘制水平线
     
@@ -1515,15 +1522,15 @@
     import pandas as pd
     from functools import reduce
 
     dfs=pd.DataFrame()
     for t in tickers:
         print("  Looking security info for",t,'...')
         with HiddenPrints():
-            df_tmp=security_indicator(t,measure,start,end,graph=False)
+            df_tmp=security_indicator(t,measure,start,end,graph=False,source=source)
         if df_tmp is None:
             print("  #Warning(compare_msecurity): security info not found for",t)
             continue
         if len(df_tmp)==0:
             print("  #Warning(compare_msecurity): security info not found for",t,'between',start,'and',end)
             continue
```

## Comparing `siat-2.3.6.dist-info/RECORD` & `siat-2.3.9.dist-info/RECORD`

 * *Files 3% similar despite different names*

```diff
@@ -74,28 +74,28 @@
 siat/option_china.py,sha256=Drrr1QbyOIMwZRTxOc5508BXZTxsOIU0LHy32smgrSs,95227
 siat/option_china_test.py,sha256=UQ-YUHUjoGBQyanLcM-yzqeEIUQP_gCQIeT0W6rnUnA,16355
 siat/option_pricing.py,sha256=hTz0lD4Yoeq0jK4Kt38qKJC_iOz9a5qXC2OeXgnMmv8,70231
 siat/option_pricing_test.py,sha256=eeorV5Ja5vjlRXnP6fWJHetGU5Vb8SnLopkC6RV3GfA,2203
 siat/option_sina_api_test.py,sha256=dn-k_wrQnAaNKHoROvWJEc7lqlU0bwiV2Aa4usWAFGM,5908
 siat/proxy_test.py,sha256=erQJrmGs2X46z8Gb1h-7GYQ0rTUcaR8dxHExWoBz2eM,2610
 siat/quandl_test.py,sha256=EcPoXnLuqzPl5dKyVEZi3j3PJZFpsnU_iNPhLWC9p-A,1552
-siat/risk_adjusted_return.py,sha256=cEq4dMogPvhXn_1IC28AR6XdcQN94NLIuLvryfxJa_E,49572
+siat/risk_adjusted_return.py,sha256=joyMbymxLrbmE6QjBF2u7Y4s9GCwTRiJwCW6IqGsEc8,49632
 siat/risk_adjusted_return_test.py,sha256=m_VHL5AtT74cJv5i7taTeTfnkX48y0AFJk5phawyYWg,3416
 siat/risk_evaluation.py,sha256=k5yk4bxKsjxazp-kKfQyrXyFhIHz6fHk3AA4rk2jZXc,75899
 siat/risk_evaluation_test.py,sha256=YEXM96gKzTfwN4U61AS4Rr1tV7KgUvn4rRC6f3iMw9s,3731
 siat/risk_free_rate.py,sha256=X9k-JvEtHkcQxiwCTMtTVz7LHojfAERu7eOzw_hKjsc,12388
 siat/risk_free_rate_test.py,sha256=CpmhUf8aEAEZeNu4gvWP2Mz2dLoIgBX5bI41vfUBEr8,4285
 siat/sector_china.py,sha256=r_Rt63smYYEXxpHJ6mTvi2blO_bZ8yQ11OTi9g2OExY,102148
 siat/sector_china_test.py,sha256=1wq7ef8Bb_L8F0h0W6FvyBrIcBTEbrTV7hljtpj49U4,5843
 siat/security_price.py,sha256=2oHskgiw41KMGfqtnA0i2YjNNV6cYgtlUK0j3YeuXWs,29185
-siat/security_prices.py,sha256=cFSqDtBEYpcxySqvW-9zFuChuJWH1dHnwu3vPWHZLwU,74152
+siat/security_prices.py,sha256=I4pPcKWkWttqvJQgZnLZ94KMkixUPAUMf-E9bzj787A,74707
 siat/security_prices_test.py,sha256=OEphoJ87NPKoNow1QA8EU_5MUYrJF-qKoWKNapVfZNI,10779
 siat/setup.py,sha256=up65rQGLmTBkhtaMLowjoQXYmIsnycnm4g1SYmeQS6o,1335
 siat/shenwan index history test.py,sha256=JCVAzOSEldHalhSFa3pqD8JI_8_djPMQOxpkuYU-Esg,1418
-siat/stock.py,sha256=mixEX7ez-S3fwypm25qOhb-eAXuLJm34eb7_GR4hy0w,130345
+siat/stock.py,sha256=svZW74KsNsiVN0Cpdip1BM9LTcQAPRFlPZWBrfumvRY,130763
 siat/stock_advice_linear.py,sha256=-twT7IGP-NEplkL1WPSACcNJjggRB2j4mlAQCkzOAuo,31655
 siat/stock_base.py,sha256=uISvbRyOGy8p9QREA96CVydgflBkn5L3OXOGKl8oanc,1312
 siat/stock_china.py,sha256=IInnxq48z-31QINpIaR2I_s0S74FXa7RNbVXng3Dao4,83256
 siat/stock_china_test.py,sha256=eO4HWsSvc6qezl0LndjtL24lViEyrBjH_sx2c2Y2Q2M,1294
 siat/stock_info.pickle,sha256=o4M-pcN8Sh8QiwZQAZWY1aelI4xgIGIxors7n2uHSJI,1266744
 siat/stock_info_test.py,sha256=gfG3DbhDACbtD8wnv_R6zhj0t11XaC8NX8uLD9Qv3Fo,6122
 siat/stock_list_china_test.py,sha256=gv14UwMMvkZqtb6G7DCTSuehIwVHuVwu7w60p6gyHoo,1014
@@ -116,11 +116,11 @@
 siat/translate-20230206.py,sha256=-vtI125WyaJhmPotOpDAmclt_XnYVaWU9ByLWZ6FyYE,118133
 siat/translate-20230215.py,sha256=TJgtPE3n8IjljmZ4Pefy8dmHoNdFF-1zpML6BhA9FKE,121657
 siat/translate.py,sha256=NHaMYaQRfJJ8eTZc_J05vhhlqvZnYqDymZreR95E7OI,134125
 siat/universal_test.py,sha256=CDAOffW1Rvs-TcNN5giWVvHMlch1w4dp-w5SIV9jXL0,3936
 siat/valuation_china.py,sha256=1hLnVfyQiyHdg2ZSIpNtLgvON-HzKxA7Pf7K01J6ThQ,52191
 siat/valuation_market_china_test.py,sha256=gbJ0ioauuo4koTPH6WKUkqcXiQPafnbhU5eKJ6lpdLA,1571
 siat/var_model_validation.py,sha256=zB_Skk_tmzIR15l6oAW3am4HBGVIG-eZ8gJhCdXZ8Qw,14859
-siat-2.3.6.dist-info/METADATA,sha256=oAy674q6y8C8_0QvQTkBgj4zwEoEZC3ebK9upyen6Ks,1422
-siat-2.3.6.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
-siat-2.3.6.dist-info/top_level.txt,sha256=r1cVyL7AIKqeAmEJjNR8FMT20OmEzufDstC2gv3NvEY,5
-siat-2.3.6.dist-info/RECORD,,
+siat-2.3.9.dist-info/METADATA,sha256=oNwyin1Ud7CiarFQI4kmruefN4DIKWJvG2_C2ZRz3fI,1384
+siat-2.3.9.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+siat-2.3.9.dist-info/top_level.txt,sha256=r1cVyL7AIKqeAmEJjNR8FMT20OmEzufDstC2gv3NvEY,5
+siat-2.3.9.dist-info/RECORD,,
```

