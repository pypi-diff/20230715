# Comparing `tmp/geeViz-2023.6.1.tar.gz` & `tmp/geeViz-2023.7.1.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "geeViz-2023.6.1.tar", last modified: Tue Jun 13 17:08:37 2023, max compression
+gzip compressed data, was "geeViz-2023.7.1.tar", last modified: Fri Jul 14 22:40:01 2023, max compression
```

## Comparing `geeViz-2023.6.1.tar` & `geeViz-2023.7.1.tar`

### file list

```diff
@@ -1,74 +1,74 @@
-drwxrwxrwx   0        0        0        0 2023-06-13 17:08:31.358141 geeViz-2023.6.1/
--rw-rw-rw-   0        0        0      574 2021-03-05 23:03:09.000000 geeViz-2023.6.1/LICENSE
--rw-rw-rw-   0        0        0     3851 2023-06-13 17:08:37.468005 geeViz-2023.6.1/PKG-INFO
--rw-rw-rw-   0        0        0     3180 2023-03-22 17:21:57.000000 geeViz-2023.6.1/README.md
-drwxrwxrwx   0        0        0        0 2023-06-13 17:08:32.451983 geeViz-2023.6.1/geeViz/
--rw-rw-rw-   0        0        0      118 2023-06-13 17:08:07.000000 geeViz-2023.6.1/geeViz/__init__.py
--rw-rw-rw-   0        0        0    23538 2023-06-06 19:41:46.000000 geeViz-2023.6.1/geeViz/assetManagerLib.py
--rw-rw-rw-   0        0        0    95071 2023-04-10 17:24:49.000000 geeViz-2023.6.1/geeViz/changeDetectionLib.py
-drwxrwxrwx   0        0        0        0 2023-06-13 17:08:35.014776 geeViz-2023.6.1/geeViz/examples/
--rw-rw-rw-   0        0        0     5366 2023-04-10 20:44:09.000000 geeViz-2023.6.1/geeViz/examples/CCDCViz.py
--rw-rw-rw-   0        0        0    11674 2023-03-17 22:07:28.000000 geeViz-2023.6.1/geeViz/examples/CCDCVizNotebook.ipynb
--rw-rw-rw-   0        0        0     7865 2022-02-07 19:59:20.000000 geeViz-2023.6.1/geeViz/examples/CCDCWrapper.py
--rw-rw-rw-   0        0        0     4342 2022-04-15 21:41:00.000000 geeViz-2023.6.1/geeViz/examples/GFSTimeLapse.py
--rw-rw-rw-   0        0        0     6156 2023-03-17 20:39:50.000000 geeViz-2023.6.1/geeViz/examples/LANDTRENDRViz.py
--rw-rw-rw-   0        0        0     9374 2023-03-22 17:42:33.000000 geeViz-2023.6.1/geeViz/examples/LANDTRENDRWrapper.py
--rw-rw-rw-   0        0        0    15140 2023-06-12 22:48:14.000000 geeViz-2023.6.1/geeViz/examples/LANDTRENDRWrapperNotebook.ipynb
--rw-rw-rw-   0        0        0    12431 2023-06-12 23:07:18.000000 geeViz-2023.6.1/geeViz/examples/LCMAP_and_LCMS_Viewer.py
--rw-rw-rw-   0        0        0    19047 2023-06-12 23:08:22.000000 geeViz-2023.6.1/geeViz/examples/LCMAP_and_LCMS_Viewer_Notebook.ipynb
--rw-rw-rw-   0        0        0      118 2023-06-13 17:07:59.000000 geeViz-2023.6.1/geeViz/examples/__init__.py
--rw-rw-rw-   0        0        0     1925 2023-06-12 22:06:57.000000 geeViz-2023.6.1/geeViz/examples/foliumViewerExample.py
--rw-rw-rw-   0        0        0   225376 2023-06-13 16:56:55.000000 geeViz-2023.6.1/geeViz/examples/gee2PandasExample.ipynb
--rw-rw-rw-   0        0        0     5672 2023-03-22 19:24:09.000000 geeViz-2023.6.1/geeViz/examples/geeViewExample.py
--rw-rw-rw-   0        0        0    16183 2023-06-12 22:37:39.000000 geeViz-2023.6.1/geeViz/examples/geeViewExampleNotebook.ipynb
--rw-rw-rw-   0        0        0    42932 2023-06-12 22:23:57.000000 geeViz-2023.6.1/geeViz/examples/geeViewVSFoliumViewerExampleNotebook.ipynb
--rw-rw-rw-   0        0        0     5653 2022-02-07 23:21:45.000000 geeViz-2023.6.1/geeViz/examples/getClimateWrapper.py
--rw-rw-rw-   0        0        0    14015 2023-01-09 16:55:27.000000 geeViz-2023.6.1/geeViz/examples/getCombinedLandsatSentinel2Wrapper.py
--rw-rw-rw-   0        0        0    11238 2022-06-15 22:15:23.000000 geeViz-2023.6.1/geeViz/examples/getLandsatWrapper.py
--rw-rw-rw-   0        0        0    17982 2023-06-12 22:41:46.000000 geeViz-2023.6.1/geeViz/examples/getLandsatWrapperNotebook.ipynb
--rw-rw-rw-   0        0        0    12016 2022-08-23 16:04:44.000000 geeViz-2023.6.1/geeViz/examples/getSentinel2Wrapper.py
--rw-rw-rw-   0        0        0     8991 2022-10-26 19:30:20.000000 geeViz-2023.6.1/geeViz/examples/harmonicRegressionWrapper.py
--rw-rw-rw-   0        0        0     8047 2023-06-12 23:06:39.000000 geeViz-2023.6.1/geeViz/examples/lcmsViewerExample.py
--rw-rw-rw-   0        0        0    18294 2023-06-12 23:03:39.000000 geeViz-2023.6.1/geeViz/examples/lcmsViewerExampleNotebook.ipynb
--rw-rw-rw-   0        0        0    13051 2022-02-16 00:28:08.000000 geeViz-2023.6.1/geeViz/examples/phEEnoVizWrapper.py
--rw-rw-rw-   0        0        0     1038 2022-02-01 00:39:23.000000 geeViz-2023.6.1/geeViz/examples/taskTrackerExample.py
--rw-rw-rw-   0        0        0     6171 2022-02-01 00:38:52.000000 geeViz-2023.6.1/geeViz/examples/timeLapseExample.py
--rw-rw-rw-   0        0        0     8568 2023-06-12 22:19:18.000000 geeViz-2023.6.1/geeViz/foliumView.py
--rw-rw-rw-   0        0        0     1741 2021-04-01 17:15:14.000000 geeViz-2023.6.1/geeViz/gcpLib.py
--rw-rw-rw-   0        0        0    10215 2023-06-13 15:59:58.000000 geeViz-2023.6.1/geeViz/gee2Pandas.py
-drwxrwxrwx   0        0        0        0 2023-06-13 17:08:35.217832 geeViz-2023.6.1/geeViz/geeView/
-drwxrwxrwx   0        0        0        0 2023-06-13 17:08:35.264706 geeViz-2023.6.1/geeViz/geeView/css/
--rw-rw-rw-   0        0        0    19972 2023-06-12 22:58:01.000000 geeViz-2023.6.1/geeViz/geeView/css/style.min.css
--rw-rw-rw-   0        0        0    10893 2023-06-13 17:05:14.000000 geeViz-2023.6.1/geeViz/geeView/foliumView.html
-drwxrwxrwx   0        0        0        0 2023-06-13 17:08:36.217910 geeViz-2023.6.1/geeViz/geeView/images/
--rw-rw-rw-   0        0        0     7295 2021-04-01 17:15:14.000000 geeViz-2023.6.1/geeViz/geeView/images/EE-logo-150.png
--rw-rw-rw-   0        0        0    10301 2021-04-01 17:15:14.000000 geeViz-2023.6.1/geeViz/geeView/images/GEE.png
--rw-rw-rw-   0        0        0     5692 2022-08-19 21:41:40.000000 geeViz-2023.6.1/geeViz/geeView/images/GEE_logo_transparent.png
--rw-rw-rw-   0        0        0     4551 2021-04-01 17:15:14.000000 geeViz-2023.6.1/geeViz/geeView/images/RCR-logo.jpg
--rw-rw-rw-   0        0        0    35328 2022-12-07 01:04:30.000000 geeViz-2023.6.1/geeViz/geeView/images/Thumbs.db
--rw-rw-rw-   0        0        0     8352 2021-04-01 17:15:14.000000 geeViz-2023.6.1/geeViz/geeView/images/cumulative_icon.png
--rw-rw-rw-   0        0        0     1502 2021-04-01 17:15:15.000000 geeViz-2023.6.1/geeViz/geeView/images/layer_icon.png
--rw-rw-rw-   0        0        0   230271 2022-06-28 20:18:38.000000 geeViz-2023.6.1/geeViz/geeView/images/logos_usda-fs.svg
--rw-rw-rw-   0        0        0   229463 2022-06-30 19:30:12.000000 geeViz-2023.6.1/geeViz/geeView/images/logos_usda-fs_bn-dk-01.svg
--rw-rw-rw-   0        0        0      635 2022-06-29 22:17:42.000000 geeViz-2023.6.1/geeViz/geeView/images/menu-hamburger_ffffff.svg
--rw-rw-rw-   0        0        0     1489 2021-04-01 17:15:15.000000 geeViz-2023.6.1/geeViz/geeView/images/usdalogo.png
--rw-rw-rw-   0        0        0     8174 2021-04-01 17:15:15.000000 geeViz-2023.6.1/geeViz/geeView/images/usfslogo.png
--rw-rw-rw-   0        0        0     3309 2023-03-08 18:54:11.000000 geeViz-2023.6.1/geeViz/geeView/index.html
-drwxrwxrwx   0        0        0        0 2023-06-13 17:08:36.874206 geeViz-2023.6.1/geeViz/geeView/js/
--rw-rw-rw-   0        0        0    45351 2020-01-16 17:35:18.000000 geeViz-2023.6.1/geeViz/geeView/js/gena-gee-palettes.js
--rw-rw-rw-   0        0        0   342637 2023-06-13 17:05:09.000000 geeViz-2023.6.1/geeViz/geeView/js/lcms-viewer.min.js
--rw-rw-rw-   0        0        0     1021 2023-03-08 18:47:59.000000 geeViz-2023.6.1/geeViz/geeView/js/load.min.js
--rw-rw-rw-   0        0        0  1481815 2023-06-13 16:56:11.000000 geeViz-2023.6.1/geeViz/geeView/js/runGeeViz.js
--rw-rw-rw-   0        0        0    13516 2023-06-13 15:20:03.000000 geeViz-2023.6.1/geeViz/geeView.py
--rw-rw-rw-   0        0        0   174866 2023-04-19 18:43:30.000000 geeViz-2023.6.1/geeViz/getImagesLib.py
--rw-rw-rw-   0        0        0     7467 2021-04-01 17:15:14.000000 geeViz-2023.6.1/geeViz/migrateGEEAssets.py
--rw-rw-rw-   0        0        0    20743 2022-06-01 18:25:26.000000 geeViz-2023.6.1/geeViz/phEEnoViz.py
--rw-rw-rw-   0        0        0     9885 2023-04-21 16:32:19.000000 geeViz-2023.6.1/geeViz/taskManagerLib.py
-drwxrwxrwx   0        0        0        0 2023-06-13 17:08:32.639459 geeViz-2023.6.1/geeViz.egg-info/
--rw-rw-rw-   0        0        0     3851 2023-06-13 17:08:30.000000 geeViz-2023.6.1/geeViz.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0     2156 2023-06-13 17:08:31.000000 geeViz-2023.6.1/geeViz.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2023-06-13 17:08:30.000000 geeViz-2023.6.1/geeViz.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0       81 2023-06-13 17:08:30.000000 geeViz-2023.6.1/geeViz.egg-info/requires.txt
--rw-rw-rw-   0        0        0        7 2023-06-13 17:08:30.000000 geeViz-2023.6.1/geeViz.egg-info/top_level.txt
--rw-rw-rw-   0        0        0       42 2023-06-13 17:08:37.514882 geeViz-2023.6.1/setup.cfg
--rw-rw-rw-   0        0        0     2173 2023-06-13 15:31:46.000000 geeViz-2023.6.1/setup.py
+drwxrwxrwx   0        0        0        0 2023-07-14 22:39:57.770286 geeViz-2023.7.1/
+-rw-rw-rw-   0        0        0      574 2021-03-05 23:03:09.000000 geeViz-2023.7.1/LICENSE
+-rw-rw-rw-   0        0        0     3851 2023-07-14 22:40:01.395284 geeViz-2023.7.1/PKG-INFO
+-rw-rw-rw-   0        0        0     3180 2023-03-22 17:21:57.000000 geeViz-2023.7.1/README.md
+drwxrwxrwx   0        0        0        0 2023-07-14 22:39:57.785913 geeViz-2023.7.1/geeViz/
+-rw-rw-rw-   0        0        0      118 2023-07-14 15:23:43.000000 geeViz-2023.7.1/geeViz/__init__.py
+-rw-rw-rw-   0        0        0    23538 2023-06-06 19:41:46.000000 geeViz-2023.7.1/geeViz/assetManagerLib.py
+-rw-rw-rw-   0        0        0    96153 2023-07-14 15:26:11.000000 geeViz-2023.7.1/geeViz/changeDetectionLib.py
+drwxrwxrwx   0        0        0        0 2023-07-14 22:39:58.770290 geeViz-2023.7.1/geeViz/examples/
+-rw-rw-rw-   0        0        0     5366 2023-04-10 20:44:09.000000 geeViz-2023.7.1/geeViz/examples/CCDCViz.py
+-rw-rw-rw-   0        0        0    11581 2023-06-23 19:50:07.000000 geeViz-2023.7.1/geeViz/examples/CCDCVizNotebook.ipynb
+-rw-rw-rw-   0        0        0     7865 2022-02-07 19:59:20.000000 geeViz-2023.7.1/geeViz/examples/CCDCWrapper.py
+-rw-rw-rw-   0        0        0     4342 2022-04-15 21:41:00.000000 geeViz-2023.7.1/geeViz/examples/GFSTimeLapse.py
+-rw-rw-rw-   0        0        0     6156 2023-03-17 20:39:50.000000 geeViz-2023.7.1/geeViz/examples/LANDTRENDRViz.py
+-rw-rw-rw-   0        0        0     9374 2023-03-22 17:42:33.000000 geeViz-2023.7.1/geeViz/examples/LANDTRENDRWrapper.py
+-rw-rw-rw-   0        0        0    15140 2023-06-12 22:48:14.000000 geeViz-2023.7.1/geeViz/examples/LANDTRENDRWrapperNotebook.ipynb
+-rw-rw-rw-   0        0        0    12431 2023-06-12 23:07:18.000000 geeViz-2023.7.1/geeViz/examples/LCMAP_and_LCMS_Viewer.py
+-rw-rw-rw-   0        0        0    19047 2023-06-12 23:08:22.000000 geeViz-2023.7.1/geeViz/examples/LCMAP_and_LCMS_Viewer_Notebook.ipynb
+-rw-rw-rw-   0        0        0      118 2023-07-14 15:23:50.000000 geeViz-2023.7.1/geeViz/examples/__init__.py
+-rw-rw-rw-   0        0        0     1925 2023-06-12 22:06:57.000000 geeViz-2023.7.1/geeViz/examples/foliumViewerExample.py
+-rw-rw-rw-   0        0        0   225376 2023-06-13 16:56:55.000000 geeViz-2023.7.1/geeViz/examples/gee2PandasExample.ipynb
+-rw-rw-rw-   0        0        0     5672 2023-07-13 22:28:19.000000 geeViz-2023.7.1/geeViz/examples/geeViewExample.py
+-rw-rw-rw-   0        0        0    16183 2023-06-14 18:38:26.000000 geeViz-2023.7.1/geeViz/examples/geeViewExampleNotebook.ipynb
+-rw-rw-rw-   0        0        0    42932 2023-06-12 22:23:57.000000 geeViz-2023.7.1/geeViz/examples/geeViewVSFoliumViewerExampleNotebook.ipynb
+-rw-rw-rw-   0        0        0     5653 2022-02-07 23:21:45.000000 geeViz-2023.7.1/geeViz/examples/getClimateWrapper.py
+-rw-rw-rw-   0        0        0    14015 2023-01-09 16:55:27.000000 geeViz-2023.7.1/geeViz/examples/getCombinedLandsatSentinel2Wrapper.py
+-rw-rw-rw-   0        0        0    11238 2022-06-15 22:15:23.000000 geeViz-2023.7.1/geeViz/examples/getLandsatWrapper.py
+-rw-rw-rw-   0        0        0    17982 2023-06-12 22:41:46.000000 geeViz-2023.7.1/geeViz/examples/getLandsatWrapperNotebook.ipynb
+-rw-rw-rw-   0        0        0    12016 2022-08-23 16:04:44.000000 geeViz-2023.7.1/geeViz/examples/getSentinel2Wrapper.py
+-rw-rw-rw-   0        0        0     8991 2022-10-26 19:30:20.000000 geeViz-2023.7.1/geeViz/examples/harmonicRegressionWrapper.py
+-rw-rw-rw-   0        0        0     8047 2023-06-12 23:06:39.000000 geeViz-2023.7.1/geeViz/examples/lcmsViewerExample.py
+-rw-rw-rw-   0        0        0    18294 2023-06-12 23:03:39.000000 geeViz-2023.7.1/geeViz/examples/lcmsViewerExampleNotebook.ipynb
+-rw-rw-rw-   0        0        0    13051 2022-02-16 00:28:08.000000 geeViz-2023.7.1/geeViz/examples/phEEnoVizWrapper.py
+-rw-rw-rw-   0        0        0     1038 2022-02-01 00:39:23.000000 geeViz-2023.7.1/geeViz/examples/taskTrackerExample.py
+-rw-rw-rw-   0        0        0     6171 2022-02-01 00:38:52.000000 geeViz-2023.7.1/geeViz/examples/timeLapseExample.py
+-rw-rw-rw-   0        0        0     8568 2023-06-12 22:19:18.000000 geeViz-2023.7.1/geeViz/foliumView.py
+-rw-rw-rw-   0        0        0     1741 2021-04-01 17:15:14.000000 geeViz-2023.7.1/geeViz/gcpLib.py
+-rw-rw-rw-   0        0        0    10077 2023-06-14 18:38:26.000000 geeViz-2023.7.1/geeViz/gee2Pandas.py
+drwxrwxrwx   0        0        0        0 2023-07-14 22:40:00.348415 geeViz-2023.7.1/geeViz/geeView/
+drwxrwxrwx   0        0        0        0 2023-07-14 22:40:00.473411 geeViz-2023.7.1/geeViz/geeView/css/
+-rw-rw-rw-   0        0        0    20906 2023-07-14 22:33:10.000000 geeViz-2023.7.1/geeViz/geeView/css/style.min.css
+-rw-rw-rw-   0        0        0     9867 2023-06-13 21:58:16.000000 geeViz-2023.7.1/geeViz/geeView/foliumView.html
+drwxrwxrwx   0        0        0        0 2023-07-14 22:40:00.520286 geeViz-2023.7.1/geeViz/geeView/images/
+-rw-rw-rw-   0        0        0     7295 2021-04-01 17:15:14.000000 geeViz-2023.7.1/geeViz/geeView/images/EE-logo-150.png
+-rw-rw-rw-   0        0        0    10301 2021-04-01 17:15:14.000000 geeViz-2023.7.1/geeViz/geeView/images/GEE.png
+-rw-rw-rw-   0        0        0     5692 2022-08-19 21:41:40.000000 geeViz-2023.7.1/geeViz/geeView/images/GEE_logo_transparent.png
+-rw-rw-rw-   0        0        0     4551 2021-04-01 17:15:14.000000 geeViz-2023.7.1/geeViz/geeView/images/RCR-logo.jpg
+-rw-rw-rw-   0        0        0    35328 2022-12-07 01:04:30.000000 geeViz-2023.7.1/geeViz/geeView/images/Thumbs.db
+-rw-rw-rw-   0        0        0     8352 2021-04-01 17:15:14.000000 geeViz-2023.7.1/geeViz/geeView/images/cumulative_icon.png
+-rw-rw-rw-   0        0        0     1502 2021-04-01 17:15:15.000000 geeViz-2023.7.1/geeViz/geeView/images/layer_icon.png
+-rw-rw-rw-   0        0        0   230271 2022-06-28 20:18:38.000000 geeViz-2023.7.1/geeViz/geeView/images/logos_usda-fs.svg
+-rw-rw-rw-   0        0        0   229463 2022-06-30 19:30:12.000000 geeViz-2023.7.1/geeViz/geeView/images/logos_usda-fs_bn-dk-01.svg
+-rw-rw-rw-   0        0        0      635 2022-06-29 22:17:42.000000 geeViz-2023.7.1/geeViz/geeView/images/menu-hamburger_ffffff.svg
+-rw-rw-rw-   0        0        0     1489 2021-04-01 17:15:15.000000 geeViz-2023.7.1/geeViz/geeView/images/usdalogo.png
+-rw-rw-rw-   0        0        0     8174 2021-04-01 17:15:15.000000 geeViz-2023.7.1/geeViz/geeView/images/usfslogo.png
+-rw-rw-rw-   0        0        0     3309 2023-07-10 21:07:12.000000 geeViz-2023.7.1/geeViz/geeView/index.html
+drwxrwxrwx   0        0        0        0 2023-07-14 22:40:01.067164 geeViz-2023.7.1/geeViz/geeView/js/
+-rw-rw-rw-   0        0        0    45351 2020-01-16 17:35:18.000000 geeViz-2023.7.1/geeViz/geeView/js/gena-gee-palettes.js
+-rw-rw-rw-   0        0        0   348932 2023-07-14 22:32:12.000000 geeViz-2023.7.1/geeViz/geeView/js/lcms-viewer.min.js
+-rw-rw-rw-   0        0        0     1021 2023-03-08 18:47:59.000000 geeViz-2023.7.1/geeViz/geeView/js/load.min.js
+-rw-rw-rw-   0        0        0    30757 2023-07-14 22:33:49.000000 geeViz-2023.7.1/geeViz/geeView/js/runGeeViz.js
+-rw-rw-rw-   0        0        0    15487 2023-07-14 15:22:42.000000 geeViz-2023.7.1/geeViz/geeView.py
+-rw-rw-rw-   0        0        0   174767 2023-07-13 21:15:58.000000 geeViz-2023.7.1/geeViz/getImagesLib.py
+-rw-rw-rw-   0        0        0     7467 2021-04-01 17:15:14.000000 geeViz-2023.7.1/geeViz/migrateGEEAssets.py
+-rw-rw-rw-   0        0        0    20743 2022-06-01 18:25:26.000000 geeViz-2023.7.1/geeViz/phEEnoViz.py
+-rw-rw-rw-   0        0        0     9885 2023-04-21 16:32:19.000000 geeViz-2023.7.1/geeViz/taskManagerLib.py
+drwxrwxrwx   0        0        0        0 2023-07-14 22:39:58.645288 geeViz-2023.7.1/geeViz.egg-info/
+-rw-rw-rw-   0        0        0     3851 2023-07-14 22:39:57.000000 geeViz-2023.7.1/geeViz.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0     2156 2023-07-14 22:39:57.000000 geeViz-2023.7.1/geeViz.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2023-07-14 22:39:57.000000 geeViz-2023.7.1/geeViz.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0       81 2023-07-14 22:39:57.000000 geeViz-2023.7.1/geeViz.egg-info/requires.txt
+-rw-rw-rw-   0        0        0        7 2023-07-14 22:39:57.000000 geeViz-2023.7.1/geeViz.egg-info/top_level.txt
+-rw-rw-rw-   0        0        0       42 2023-07-14 22:40:01.410908 geeViz-2023.7.1/setup.cfg
+-rw-rw-rw-   0        0        0     2173 2023-06-13 15:31:46.000000 geeViz-2023.7.1/setup.py
```

### Comparing `geeViz-2023.6.1/LICENSE` & `geeViz-2023.7.1/LICENSE`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/PKG-INFO` & `geeViz-2023.7.1/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: geeViz
-Version: 2023.6.1
+Version: 2023.7.1
 Summary: A package to help with GEE data processing, analysis, and visualization
 Home-page: https://github.com/gee-community/geeViz
 Author: Ian Housman
 Author-email: ian.housman@gmail.com
 License: Apache
 Keywords: earthengine google remote sensing landsat sentinel modis forestry forest
 Classifier: Programming Language :: Python :: 3
```

### Comparing `geeViz-2023.6.1/README.md` & `geeViz-2023.7.1/README.md`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/assetManagerLib.py` & `geeViz-2023.7.1/geeViz/assetManagerLib.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/changeDetectionLib.py` & `geeViz-2023.7.1/geeViz/changeDetectionLib.py`

 * *Files 1% similar despite different names*

```diff
@@ -1738,15 +1738,15 @@
 # 10/21 LSC Added Capability to use pixel-wise Composite Dates instead of set dates. 
 # If used, set annualizeWithCompositeDates to True and provide imported/prepped composite image collection with 'year' and 'julianDay' bands
 def annualizeCCDC(ccdcImg, startYear, endYear, startJulian, endJulian, tEndExtrapolationPeriod, 
   yearStartMonth = 9, yearStartDay = 1, annualizeWithCompositeDates = False, compositeCollection = None):
 
   # Create image collection of images with the proper time stamp as well as a 'year' band with the year fraction.
   if annualizeWithCompositeDates and compositeCollection != None:
-    timeImgs = getTimeImageCollectionFromComposites(startJulian, endJulian, compositeCollection)
+    timeImgs = getTimeImageCollectionFromComposites(compositeCollection,startYear,endYear)
   else:
     timeImgs = getTimeImageCollection(startYear, endYear, startJulian ,endJulian, 1, yearStartMonth, yearStartDay)
   Map.addLayer(timeImgs,{},'time')
   # If selected, add a constant amount of time to last end segment to make sure the last year is annualized correctly.
   # tEndExtrapolationPeriod should be a fraction of a year.
   finalTEnd = ccdcImg.select('tEnd').arraySlice(0,-1,None).rename('tEnd').arrayGet(0).add(tEndExtrapolationPeriod).toArray(0)
   tEnds = ccdcImg.select('tEnd')
@@ -1868,20 +1868,35 @@
       #.copyProperties(dateImg, ['system:time_start']);
 
     #return out
   #yearImages = compositeCollection.map(lambda dateImg: getYearTimeImage(dateImg))
 
   #return yearImages
 
-def getTimeImageCollectionFromComposites(startJulian, endJulian, compositeCollection): 
-  dates = compositeCollection.map(lambda img:img.select(['year']).add(img.select(['julianDay']).divide(365)).float().copyProperties(img,['system:time_start']))
-  nYears = dates.size().getInfo()
-  interpolated = linearInterp(dates, 365*nYears, -32768)
-  return interpolated
-
+# def getTimeImageCollectionFromComposites(startJulian, endJulian, compositeCollection): 
+#   dates = compositeCollection.map(lambda img:img.select(['year']).add(img.select(['julianDay']).divide(365)).float().copyProperties(img,['system:time_start']))
+#   nYears = dates.size().getInfo()
+#   interpolated = linearInterp(dates, 365*nYears, -32768)
+#   return interpolated
+def getTimeImageCollectionFromComposites(compositeCollection,startYear=None,endYear=None): 
+    compositeCollection = compositeCollection.sort('system:time_start')
+    if startYear == None:
+      startYear =compositeCollection.first().date().get('year')
+      print('Found start year: {}'.format(startYear.getInfo()))
+    if endYear == None:
+      endYear =compositeCollection.sort('system:time_start',False).first().date().get('year')
+      print('Found end year: {}'.format(endYear.getInfo()))
+
+    dates = compositeCollection.map(lambda img:img.select(['year']).add(img.select(['julianDay']).divide(365)).float().copyProperties(img,['system:time_start']))
+    dummyImage = dates.first()
+  
+    datesFilled = ee.ImageCollection(ee.List.sequence(startYear,endYear).map(lambda yr:fillEmptyCollections(dates.filter(ee.Filter.calendarRange(yr,yr,'year')),dummyImage).first().set('system:time_start',ee.Date.fromYMD(yr,6,1).millis())))
+    nYears = datesFilled.size().getInfo()
+    interpolated = linearInterp(datesFilled, 365*nYears, -32768)
+    return interpolated
 ###################################################################################
 #Function for getting change years and magnitudes for a specified band from CCDC outputs
 #Only change from the breaks is extracted
 #As of now, if a segment has a high slope value, this method will not extract that 
 def ccdcChangeDetection(ccdcImg,bandName):
   magKeys = ['.*_magnitude']
   tBreakKeys = ['tBreak']
```

### Comparing `geeViz-2023.6.1/geeViz/examples/CCDCViz.py` & `geeViz-2023.7.1/geeViz/examples/CCDCViz.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/CCDCVizNotebook.ipynb` & `geeViz-2023.7.1/geeViz/examples/CCDCVizNotebook.ipynb`

 * *Files 10% similar despite different names*

#### Pretty-printed

 * *Similarity: 0.9849773755048943%*

 * *Differences: {"'cells'": "{0: {'attachments': OrderedDict()}, 1: {'execution_count': 5, 'outputs': {0: {'text': "*

 * *            "{insert: [(0, 'Initializing GEE\\n'), (1, 'geeViz package folder: "*

 * *            "c:\\\\Users\\\\ihousman\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python311\\\\Lib\\\\site-packages\\\\geeViz\\n')]}}}}, "*

 * *            "2: {'execution_count': 7, 'outputs': {0: {'text': {insert: [(4, 'cwd "*

 * *            "a:\\\\GEE\\\\gee_py_modules_package\\\\geeViz\\\\examples\\n')], delete: [4]}}, 1: "*

 * *          […]*

```diff
@@ -1,10 +1,11 @@
 {
     "cells": [
         {
+            "attachments": {},
             "cell_type": "markdown",
             "id": "15b5b935",
             "metadata": {},
             "source": [
                 "\n",
                 "   Copyright 2023 Ian Housman\n",
                 "\n",
@@ -19,22 +20,24 @@
                 "   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n",
                 "   See the License for the specific language governing permissions and\n",
                 "   limitations under the License.\n"
             ]
         },
         {
             "cell_type": "code",
-            "execution_count": 4,
+            "execution_count": 5,
             "id": "e57ee268",
             "metadata": {},
             "outputs": [
                 {
                     "name": "stdout",
                     "output_type": "stream",
                     "text": [
+                        "Initializing GEE\n",
+                        "geeViz package folder: c:\\Users\\ihousman\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\geeViz\n",
                         "done\n"
                     ]
                 }
             ],
             "source": [
                 "#Example of how to visualize CCDC outputs using the Python visualization tools\n",
                 "#Adds change products and fitted harmonics from CCDC output to the viewer\n",
@@ -79,163 +82,158 @@
                 "startYear = 1984\n",
                 "endYear = 2022\n",
                 "print('done')"
             ]
         },
         {
             "cell_type": "code",
-            "execution_count": 5,
+            "execution_count": 7,
             "id": "26bdb396",
             "metadata": {},
             "outputs": [
                 {
                     "name": "stdout",
                     "output_type": "stream",
                     "text": [
                         "Adding layer: Raw CCDC Output\n",
                         "Starting webmap\n",
                         "Using default refresh token for geeView: C:\\Users\\ihousman/.config/earthengine/credentials\n",
                         "Local web server at: http://localhost:8001/geeView/ already serving.\n",
-                        "cwd A:\\GEE\\gee_py_modules_package\\geeViz\\examples\n"
+                        "cwd a:\\GEE\\gee_py_modules_package\\geeViz\\examples\n"
                     ]
                 },
                 {
                     "data": {
                         "text/html": [
                             "\n",
                             "        <iframe\n",
                             "            width=\"100%\"\n",
                             "            height=\"525px\"\n",
-                            "            src=\"http://localhost:8001/geeView/?accessToken=ya29.a0AVvZVsr3rv32GR_z1YsbWTwjxi5CVK7VeI-Kq_dVA9uBl4-krWFpyGXngylwTz7D-9x27e8hyKOQesZDOF86pBob-dENnVRh5iamicwcdUNV4hGKOAz1558cNUEdKaQv3fPC64ByVzMwM9lWYnw4SntqoEz7MQYidnjsALsaCgYKAZASARASFQGbdwaIX7n6n6CDFbSUqLQeFHdJkQ0174\"\n",
+                            "            src=\"http://localhost:8001/geeView/?accessToken=ya29.a0AWY7Cklw_vewLIJiL_19b_Nfnr2PV2YE_3ck-sIQQ_m1AT4X4NxulDN2BZuTf2JfP2DtNlwqNpKtxRow0Ux_O3asPieFThtbknb0ooRvUIEqQdl7ldoa6bc-1WiB3hsUqBU4a37nhOYmFBk2XCQ8ddxORWhvfeFmsAqFmgaCgYKAYISARASFQG1tDrpxQ-gYZUvHjCo0pCJD6Lg8w0173\"\n",
                             "            frameborder=\"0\"\n",
                             "            allowfullscreen\n",
                             "            \n",
                             "        ></iframe>\n",
                             "        "
                         ],
                         "text/plain": [
-                            "<IPython.lib.display.IFrame at 0x228f3242aa0>"
+                            "<IPython.lib.display.IFrame at 0x1a96446ea50>"
                         ]
                     },
-                    "execution_count": 5,
                     "metadata": {},
-                    "output_type": "execute_result"
+                    "output_type": "display_data"
                 }
             ],
             "source": [
                 "Map.clearMap()\n",
                 "#Add the raw array image\n",
                 "Map.addLayer(ccdcImg,{},'Raw CCDC Output',True)\n",
                 "Map.centerObject(ccdcImg)\n",
                 "Map.turnOnInspector()\n",
-                "Map.view(open_browser = False, open_iframe = True)\n",
-                "Map.IFrame\n",
+                "Map.view()\n",
                 "#Double click on map to see raw CCDC output image array values\n",
                 "#Notice it is difficult to interpret these values as a time series since only breaks and their respective harmonic models are stored"
             ]
         },
         {
             "cell_type": "code",
-            "execution_count": 6,
+            "execution_count": 8,
             "id": "194029e4",
             "metadata": {},
             "outputs": [
                 {
                     "name": "stdout",
                     "output_type": "stream",
                     "text": [
                         "Adding layer: Loss Year\n",
                         "Adding layer: Loss Mag\n",
                         "Adding layer: Gain Year\n",
                         "Adding layer: Gain Mag\n",
                         "Starting webmap\n",
                         "Using default refresh token for geeView: C:\\Users\\ihousman/.config/earthengine/credentials\n",
                         "Local web server at: http://localhost:8001/geeView/ already serving.\n",
-                        "cwd A:\\GEE\\gee_py_modules_package\\geeViz\\examples\n"
+                        "cwd a:\\GEE\\gee_py_modules_package\\geeViz\\examples\n"
                     ]
                 },
                 {
                     "data": {
                         "text/html": [
                             "\n",
                             "        <iframe\n",
                             "            width=\"100%\"\n",
                             "            height=\"525px\"\n",
-                            "            src=\"http://localhost:8001/geeView/?accessToken=ya29.a0AVvZVsrMif7t4b9j4NMMAWpswOaKLbjn09Re__Dzt7iEKrU_A_GHueOCCdJNssXUbK61RIrvVscQHjzBOzsh-QWIuD1Y7xApRR1vPPWKc0dv-l-WD4M7xm2D4m7abo9W6YqXw_eTFQEOAR2pfmCoxzgnYdC4B6-SrzhylTsaCgYKAUUSARASFQGbdwaITM5-6Hw98XrdwfEdTKlT9A0174\"\n",
+                            "            src=\"http://localhost:8001/geeView/?accessToken=ya29.a0AWY7CkmbEYshCbwobl-lP4peJr5G6-CwrHWKMSj---hOobTLwrpel83USvxH6S6__5omrMi9VQlwjpPs5B7IPbDOinzEayvCworwWL0CMBp9ExAhrgImg09TmocDMSqVMG640OukhM0Bo_que2gbgS_KNJ5g8MSW76QoJQaCgYKAS4SARASFQG1tDrpFN1DTBjU-EQ3VTDJ5cUgxA0173\"\n",
                             "            frameborder=\"0\"\n",
                             "            allowfullscreen\n",
                             "            \n",
                             "        ></iframe>\n",
                             "        "
                         ],
                         "text/plain": [
-                            "<IPython.lib.display.IFrame at 0x228f14defe0>"
+                            "<IPython.lib.display.IFrame at 0x1a965967e10>"
                         ]
                     },
-                    "execution_count": 6,
                     "metadata": {},
-                    "output_type": "execute_result"
+                    "output_type": "display_data"
                 }
             ],
             "source": [
                 "Map.clearMap()\n",
                 "#We will not look at more useful ways of visualizing CCDC outputs\n",
                 "#First, we will extract the change years and magnitude\n",
                 "changeObj = changeDetectionLib.ccdcChangeDetection(ccdcImg,changeDetectionBandName);\n",
                 "Map.addLayer(changeObj[sortingMethod]['loss']['year'],{'min':startYear,'max':endYear,'palette':changeDetectionLib.lossYearPalette},'Loss Year')\n",
                 "Map.addLayer(changeObj[sortingMethod]['loss']['mag'],{'min':-0.5,'max':-0.1,'palette':changeDetectionLib.lossMagPalette},'Loss Mag',False);\n",
                 "Map.addLayer(changeObj[sortingMethod]['gain']['year'],{'min':startYear,'max':endYear,'palette':changeDetectionLib.gainYearPalette},'Gain Year');\n",
                 "Map.addLayer(changeObj[sortingMethod]['gain']['mag'],{'min':0.05,'max':0.2,'palette':changeDetectionLib.gainMagPalette},'Gain Mag',False);\n",
                 "\n",
                 "Map.turnOnInspector()\n",
-                "Map.view(open_browser = False, open_iframe = True)\n",
-                "Map.IFrame\n",
+                "Map.view()\n",
                 "#Double click on map to see raw years of loss and gain breaks\n",
                 "#Notice as you zoom in the layers change since GEE is processing outputs at a given pyramid level"
             ]
         },
         {
             "cell_type": "code",
-            "execution_count": 8,
+            "execution_count": 9,
             "id": "4a8031fe",
             "metadata": {},
             "outputs": [
                 {
                     "name": "stdout",
                     "output_type": "stream",
                     "text": [
                         "Adding layer: Fitted CCDC\n",
                         "Adding layer: Synthetic Composite\n",
                         "Starting webmap\n",
                         "Using default refresh token for geeView: C:\\Users\\ihousman/.config/earthengine/credentials\n",
                         "Local web server at: http://localhost:8001/geeView/ already serving.\n",
-                        "cwd A:\\GEE\\gee_py_modules_package\\geeViz\\examples\n"
+                        "cwd a:\\GEE\\gee_py_modules_package\\geeViz\\examples\n"
                     ]
                 },
                 {
                     "data": {
                         "text/html": [
                             "\n",
                             "        <iframe\n",
                             "            width=\"100%\"\n",
                             "            height=\"525px\"\n",
-                            "            src=\"http://localhost:8001/geeView/?accessToken=ya29.a0AVvZVsom3Qh_z__LAqhHurHDz3JmwQFePeXAjRslVNc8VbdfdAlnlO4VDw8svgfGpOyD3YzAYm1zak_lkcwQpyamL0kbR-UaBkPySMGXOg7vwG13YLkpd_6a9pwd2ogXls5HRYjFa6a1_AJ_ZM1BWIkIx1D451OMo5PQ360aCgYKAZ4SARASFQGbdwaI7w_vSJCVMYIGSxUn9FxTrw0174\"\n",
+                            "            src=\"http://localhost:8001/geeView/?accessToken=ya29.a0AWY7Ckl_PVbBNwCRUcZznThRlVRhNeN2Ks2LN1HB7vWohP6zddWZP9h8QH97TpIe_7Ua36CoXNbqzT-pKd-22x1hRcBQkebJV5pILGOvkMDXwa0jYAsB_MLcPz2GO-7D4DwezUkelSIg1x2zrcun5UO3rsZKpycfAMXMpgaCgYKAQESARASFQG1tDrpr185hoJqLK9fysf2oOEr6w0173\"\n",
                             "            frameborder=\"0\"\n",
                             "            allowfullscreen\n",
                             "            \n",
                             "        ></iframe>\n",
                             "        "
                         ],
                         "text/plain": [
-                            "<IPython.lib.display.IFrame at 0x228f321ece0>"
+                            "<IPython.lib.display.IFrame at 0x1a965722990>"
                         ]
                     },
-                    "execution_count": 8,
                     "metadata": {},
-                    "output_type": "execute_result"
+                    "output_type": "display_data"
                 }
             ],
             "source": [
                 "Map.clearMap()\n",
                 "#Apply the CCDC harmonic model across a time series\n",
                 "#First get a time series of time images \n",
                 "yearImages = changeDetectionLib.getTimeImageCollection(startYear,endYear,startJulian,endJulian,0.1);\n",
@@ -257,16 +255,15 @@
                 "    .filter(ee.Filter.calendarRange(endYear-1,endYear-1,'year'))\\\n",
                 "    .filter(ee.Filter.calendarRange(190,250)).first()\n",
                 "\n",
                 "# Visualize output as you would a composite\n",
                 "Map.addLayer(syntheticComposites,getImagesLib.vizParamsFalse,'Synthetic Composite')\n",
                 "\n",
                 "Map.turnOnInspector()\n",
-                "Map.view(open_browser = False, open_iframe = True)\n",
-                "Map.IFrame\n",
+                "Map.view()\n",
                 "\n",
                 "#No layers will draw, but you can double click on map to see the fitted CCDC time series"
             ]
         },
         {
             "cell_type": "code",
             "execution_count": null,
@@ -288,15 +285,15 @@
                 "version": 3
             },
             "file_extension": ".py",
             "mimetype": "text/x-python",
             "name": "python",
             "nbconvert_exporter": "python",
             "pygments_lexer": "ipython3",
-            "version": "3.10.0"
+            "version": "3.11.4"
         },
         "vscode": {
             "interpreter": {
                 "hash": "369f2c481f4da34e4445cda3fffd2e751bd1c4d706f27375911949ba6bb62e1c"
             }
         }
     },
```

### Comparing `geeViz-2023.6.1/geeViz/examples/CCDCWrapper.py` & `geeViz-2023.7.1/geeViz/examples/CCDCWrapper.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/GFSTimeLapse.py` & `geeViz-2023.7.1/geeViz/examples/GFSTimeLapse.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/LANDTRENDRViz.py` & `geeViz-2023.7.1/geeViz/examples/LANDTRENDRViz.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/LANDTRENDRWrapper.py` & `geeViz-2023.7.1/geeViz/examples/LANDTRENDRWrapper.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/LANDTRENDRWrapperNotebook.ipynb` & `geeViz-2023.7.1/geeViz/examples/LANDTRENDRWrapperNotebook.ipynb`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/LCMAP_and_LCMS_Viewer.py` & `geeViz-2023.7.1/geeViz/examples/LCMAP_and_LCMS_Viewer.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/LCMAP_and_LCMS_Viewer_Notebook.ipynb` & `geeViz-2023.7.1/geeViz/examples/LCMAP_and_LCMS_Viewer_Notebook.ipynb`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/foliumViewerExample.py` & `geeViz-2023.7.1/geeViz/examples/foliumViewerExample.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/gee2PandasExample.ipynb` & `geeViz-2023.7.1/geeViz/examples/gee2PandasExample.ipynb`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/geeViewExample.py` & `geeViz-2023.7.1/geeViz/examples/geeViewExample.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/geeViewExampleNotebook.ipynb` & `geeViz-2023.7.1/geeViz/examples/geeViewExampleNotebook.ipynb`

 * *Files 2% similar despite different names*

#### Pretty-printed

 * *Similarity: 0.9986658577967171%*

 * *Differences: {"'cells'": "{2: {'execution_count': 2, 'outputs': {1: {'data': {'text/html': {insert: [(4, "*

 * *            "'            "*

 * *            'src="http://localhost:8001/geeView/?accessToken=ya29.a0AWY7Ckn_5fDJ1cX7ULGtKhS1mdv-c3DA0UZL3xO3kbXHrm1aURAHup-VJ7c2KYud8LLmHlPopawqrNbjL3RCTdnEcXswsbsfzc0BOrqCy_KWBYMDcwQIrlSADCKDm_tC1ntGUwzjvf5n9-4OG9xX9Q9jz1oMBVmOGjjz228aCgYKAUQSARASFQG1tDrp1x8CJNpUy8VgXVk-A9A5Qg0174"\\n\')], '*

 * *            "delete: [4]}, 'text/plain': ['<IPython.lib.display.IFrame at 0x155e703b6d0>']}}}}}" […]*

```diff
@@ -53,15 +53,15 @@
                 "Map = geeView.Map\n",
                 "Map.clearMap()\n",
                 "print('done')"
             ]
         },
         {
             "cell_type": "code",
-            "execution_count": 4,
+            "execution_count": 2,
             "id": "c91f7f74",
             "metadata": {},
             "outputs": [
                 {
                     "name": "stdout",
                     "output_type": "stream",
                     "text": [
@@ -75,23 +75,23 @@
                 {
                     "data": {
                         "text/html": [
                             "\n",
                             "        <iframe\n",
                             "            width=\"100%\"\n",
                             "            height=\"525px\"\n",
-                            "            src=\"http://localhost:8001/geeView/?accessToken=ya29.a0AWY7CkkX-HAJnVRfrHGZYjBr_W2b6zfRiMDXqIdXI1j_-o7aYo7yxdrL5f4PrGmE26otcE1lXJYttAAcI4rJbkHYS-q-Bn2y0AB0BrIKF2IoJhhuG4ZtGTupm9_hD9GE9wTFHMURZwRBs_4p98AbX_T4SlqjF7kKm9NEieAaCgYKAXcSARASFQG1tDrpNXzoLrnyIvERgN1eHI1L7w0174\"\n",
+                            "            src=\"http://localhost:8001/geeView/?accessToken=ya29.a0AWY7Ckn_5fDJ1cX7ULGtKhS1mdv-c3DA0UZL3xO3kbXHrm1aURAHup-VJ7c2KYud8LLmHlPopawqrNbjL3RCTdnEcXswsbsfzc0BOrqCy_KWBYMDcwQIrlSADCKDm_tC1ntGUwzjvf5n9-4OG9xX9Q9jz1oMBVmOGjjz228aCgYKAUQSARASFQG1tDrp1x8CJNpUy8VgXVk-A9A5Qg0174\"\n",
                             "            frameborder=\"0\"\n",
                             "            allowfullscreen\n",
                             "            \n",
                             "        ></iframe>\n",
                             "        "
                         ],
                         "text/plain": [
-                            "<IPython.lib.display.IFrame at 0x1ec2f996cb0>"
+                            "<IPython.lib.display.IFrame at 0x155e703b6d0>"
                         ]
                     },
                     "metadata": {},
                     "output_type": "display_data"
                 }
             ],
             "source": [
```

### Comparing `geeViz-2023.6.1/geeViz/examples/geeViewVSFoliumViewerExampleNotebook.ipynb` & `geeViz-2023.7.1/geeViz/examples/geeViewVSFoliumViewerExampleNotebook.ipynb`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/getClimateWrapper.py` & `geeViz-2023.7.1/geeViz/examples/getClimateWrapper.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/getCombinedLandsatSentinel2Wrapper.py` & `geeViz-2023.7.1/geeViz/examples/getCombinedLandsatSentinel2Wrapper.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/getLandsatWrapper.py` & `geeViz-2023.7.1/geeViz/examples/getLandsatWrapper.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/getLandsatWrapperNotebook.ipynb` & `geeViz-2023.7.1/geeViz/examples/getLandsatWrapperNotebook.ipynb`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/getSentinel2Wrapper.py` & `geeViz-2023.7.1/geeViz/examples/getSentinel2Wrapper.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/harmonicRegressionWrapper.py` & `geeViz-2023.7.1/geeViz/examples/harmonicRegressionWrapper.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/lcmsViewerExample.py` & `geeViz-2023.7.1/geeViz/examples/lcmsViewerExample.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/lcmsViewerExampleNotebook.ipynb` & `geeViz-2023.7.1/geeViz/examples/lcmsViewerExampleNotebook.ipynb`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/phEEnoVizWrapper.py` & `geeViz-2023.7.1/geeViz/examples/phEEnoVizWrapper.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/taskTrackerExample.py` & `geeViz-2023.7.1/geeViz/examples/taskTrackerExample.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/examples/timeLapseExample.py` & `geeViz-2023.7.1/geeViz/examples/timeLapseExample.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/foliumView.py` & `geeViz-2023.7.1/geeViz/foliumView.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/gcpLib.py` & `geeViz-2023.7.1/geeViz/gcpLib.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/gee2Pandas.py` & `geeViz-2023.7.1/geeViz/gee2Pandas.py`

 * *Files 1% similar despite different names*

```diff
@@ -190,15 +190,14 @@
     o = open(outJsonFilename,'w')
     o.write(json.dumps(outJson))
     o.close()
     return outJson
 ####################################################################################################
 # Scratch space for testing
 if __name__ == '__main__':
-    # tableToFeatureCollection(table_path,lat='Latitude', lon='Longitude',properties=[],dateCol=None,groupByColumns = None,mode='Excel')
     output_dir = r'C:\tmp\geeToPandasTest' 
     out_json = os.path.join(output_dir,'test_json.json')
 
     out_csv = os.path.join(output_dir,'test_json.csv')
     if not os.path.exists(output_dir):os.makedirs(output_dir)
     fc = ee.FeatureCollection('projects/lcms-292214/assets/CONUS-LCMS/Training-Tables/Training-Tables-AnnualizedFormat_v2022/LCMS-CONUS-2015').limit(5)
     composite = ee.ImageCollection('projects/lcms-tcc-shared/assets/Composites/Composite-Collection-yesL7-1984-2020')\
```

### Comparing `geeViz-2023.6.1/geeViz/geeView/css/style.min.css` & `geeViz-2023.7.1/geeViz/geeView/css/style.min.css`

 * *Files 16% similar despite different names*

```diff
@@ -1 +1 @@
-@import "https://fonts.googleapis.com/css?family=Roboto+Condensed&display=swap";:root{--teal-30:#b2ece4;--teal-50:#80dfd2;--teal-80:#00bfa5;--teal-100:#00897b;--foo:true;--deep-brown-10:#d6d1ca;--deep-brown-20:#bfb7b0;--deep-brown-30:#aca199;--deep-brown-50:#968b83;--deep-brown-70:#847779;--deep-brown-80:#6f6259;--deep-brown-100:#372e2c;--grayy:#6f6259;--black:#1B1716DD;--solid-black:#1b1716;--black:rgba(27,23,22,0.9);--transparent:rgba(0,0,0,0);--white:#FFF;--almost-transparent:#BFB7B0DD;--orange:#ff834c;--transparent-teal:rgba(0,137,123,0.3);--slider-border-radius:2px}html,body{height:100%;margin:0;padding:0;background-color:var(--black);font-size:16px;font-family:'Roboto Condensed',sans-serif;font-weight:100}@media only screen and (max-width:1600px){html,body{font-size:14px !important}}@media only screen and (max-width:1400px){html,body{font-size:12px !important}}@media only screen and (max-width:1200px){html,body{font-size:12px !important}}@media only screen and (max-width:992){html,body{font-size:11px !important}}@media only screen and (max-width:768){html,body{font-size:10px !important}}@media only screen and (max-width:576px){html,body{font-size:10px !important}}@media only screen and (max-width:400px){html,body{font-size:10px !important}}.custom-hidden{display:none}.center{display:block;margin-left:auto;margin-right:auto;width:50%}.vcenter{display:inline-block;vertical-align:middle !important;float:none}.white{color:var(--deep-brown-20)}.gray{color:var(--deep-brown-70)}.dark-gray{color:var(--deep-brown-10)}.teal{color:var(--teal-100) !important}.teal80{color:var(--teal-80) !important}.teal-study-area-label{color:var(--teal-80) !important}.bg-teal{background-color:var(--teal-100) !important}.bg-gray{background-color:var(--deep-brown-100) !important;color:var(--deep-brown-20) !important}.bg-black,.btn{background-color:var(--black) !important;margin:0 !important;color:var(--white) !important;outline:none !important;vertical-align:middle !important}.shepherd-button{background-color:var(--deep-brown-100) !important;padding:.1rem .2rem;font-size:1.25rem}.shepherd-content,.shepherd-title,.shepherd-header,.shepherd-text,.shepherd-footer{background-color:var(--deep-brown-100) !important;color:var(--deep-brown-10) !important;overflow:auto}.shepherd-title{font-size:1.25rem}.shepherd-arrow:before{background-color:var(--teal-100) !important;outline-style:solid}.eraser{color:var(--deep-brown-100) !important;cursor:pointer}.eraser:active{transform:translate(3px) translateY(0);color:var(--teal-100) !important}.eraser-all{height:.8rem;cursor:pointer;color:#000;background-color:var(--deep-brown-10);font-size:.8rem !important;margin-top:0;margin-bottom:0;margin-left:.25rem;padding-left:.25rem;padding-right:.25rem;border-radius:.2rem;padding-bottom:0}.fa-eraser{color:var(--deep-brown-100) !important}.eraser-all:active,.fa-eraser:active{transform:translate(4px) translateY(0);color:var(--teal-100) !important}.eraser-all:hover{font-weight:300}.bg-solid-black{background-color:var(--solid-black) !important;color:var(--white) !important}.time-lapse-active{background-color:var(--teal-100) !important;color:var(--deep-brown-70) !important}.time-lapse-slider-handle-label{padding-top:1.1em;margin-left:-2.2em;font-size:.7em;width:5em;color:var(--teal-100) !important;text-align:center}.info-page{color:var(--deep-brown-20) !important;padding-top:4em}.simple-bg-black{background-color:var(--black) !important;color:var(--white) !important}.bg-transparent{background-color:var(--almost-transparent) !important;color:#000 !important}.list-group-item,.list-group,.list-group-title{background-color:var(--deep-brown-10) !important;padding-left:0;padding-right:0}hr{border:0;border-top:1px solid var(--deep-brown-100)}.text-black{color:var(--black) !important}table{border:none !important}.dropdown-divider{margin-top:.2em;margin-bottom:0;padding-top:.2em;padding-bottom:.2em}.figure{display:right;float:right}.figcaption{width:50%;text-align:justify;font-size:20em}.container-beforeIntro{padding-right:-50px;padding-left:100px;margin-right:-15px;margin-left:-15px}.container-intro{padding-right:25px;padding-left:45px;margin-right:0;margin-left:-15px}.main-container{position:absolute}.map{width:100%;height:100%;position:absolute;z-index:1}.search-box,.form-control{height:1.5em}kbd{border:1px solid #999}ul,li{list-style-type:none}th{font-weight:600 !important}.select-layer-name{margin:0;color:var(--teal-100)}button{-webkit-appearance:button}.sidebar-toggler{position:absolute;top:0;left:0;z-index:5;margin-top:-0.2rem;height:3rem}.sidebar-toggler:hover{font-size:1.9em !important}.sidebar-toggler:active{transform:translate(4px) translateY(4px)}.teal-hover:hover{color:var(--teal-100) !important}.sidebar{overflow-y:auto;max-height:calc(100% - 1.7em);background-color:var(--black) !important;z-index:3}.vl{border-left:1px solid var(--deep-brown-20);height:1.25rem;vertical-align:middle;display:inline-block;margin-left:.1rem;margin-right:.25rem;margin-top:.5rem}.vl2{border-left:1px solid var(--deep-brown-100);height:2rem;display:inline;vertical-align:middle;display:inline-block;margin-left:0;margin-right:0}.title-banner{font-weight:100;font-family:'Roboto';margin-left:2.5rem;margin-right:.5rem;margin-bottom:0;margin-top:.25rem;font-size:1.5rem;display:flex}.search-bar{padding-left:2.75rem;padding-right:1rem;padding-bottom:.5rem;padding-top:.25rem;font-size:1.5rem;display:flex}.dashboard-results-container{position:absolute;bottom:0;left:0;width:100%;height:0;z-index:2}#dashboard-results-expander{height:.75rem;background-color:var(--teal-100);margin:0;padding:0;cursor:grab}.dashboard-results{height:100%;width:100%;overflow-x:scroll;overflow-y:hidden;white-space:nowrap;color:var(--white);background-color:var(--black) !important;margin:0;padding:0}.dashboard-highlights{position:absolute;top:0;right:0;max-width:25rem;max-height:100%;overflow-y:auto;overflow-x:auto;z-index:2}.dashboard-download-div{margin:.5rem}.dashboard-download-button{background-color:var(--deep-brown-100) !important;font-size:.75rem;color:var(--deep-brown-10) !important;font-family:'Roboto';font-size:1rem;border:1px solid var(--deep-brown-100)}.dashboard-download-icon{color:var(--deep-brown-10) !important}.nav-tabs>li>a{color:var(--deep-brown-20);background-color:var(--deep-brown-100)}.nav-tabs .nav-link{border:1px solid var(--deep-brown-20);border-top-left-radius:.25rem;border-top-right-radius:.25rem;height:2rem;font-size:.85rem}.nav-tabs .nav-link:active{background-color:var(--teal-100) !important;transform:scale3d(1.05,1,1);color:var(--deep-brown-100)}.nav-tabs>li>a:hover{color:var(--teal-100)}.nav-tabs .nav-item.show .nav-link,.nav-tabs .nav-link.active{color:var(--deep-brown-100);background-color:var(--deep-brown-20);font-weight:bold}.highlights-table-tabs{max-width:100%}.highlights-row{font-size:.65rem}.highlights-entry{padding:.1rem;word-wrap:break-word}.highlights-insig{color:var(--deep-brown-80)}.highlights-sig{font-weight:900;font-size:.75rem;color:var(--deep-brown-100)}.highlights-title{color:var(--deep-brown-20);font-family:'Roboto';font-size:1.75rem;text-align:center;margin-top:.25rem;margin-bottom:.25rem;margin-left:3rem !important;font-weight:200}.highlights-table-title{color:var(--deep-brown-20);font-family:'Roboto';font-size:.75rem;text-align:center;font-weight:200}.highlights-table-section-title{color:var(--deep-brown-20);background-color:var(--deep-brown-100) !important;font-family:'Roboto';font-size:.75rem;text-align:left;font-weight:300}.highlights-table{overflow-y:auto;padding-left:0 !important}.dataTables_filter{text-align:left !important;margin-left:.5rem;margin-top:.5rem;margin-bottom:.25rem;font-size:.75rem;color:var(--deep-brown-100);font-family:'Roboto'}.highlights-disclaimer{margin-top:.75rem;margin-left:.75rem;margin-right:.75rem;margin-bottom:.75rem;font-size:.75rem;max-width:20rem;color:var(--deep-brown-20)}.btn-group>.btn{margin-left:.5rem !important;padding-bottom:0;border-radius:3px;color:var(--deep-brown-20) !important;background-color:var(--deep-brown-100) !important;font-size:.75rem;margin-top:.5rem !important}.pac-container{background-color:var(--deep-brown-20)}.hr{height:1px;border:0;background-color:var(--deep-brown-20)}#dashboard-progress-container{padding-left:1.75rem;padding-right:1rem}.progressbar{background:var(--deep-brown-80);width:100%;font-size:1rem;height:.8rem;margin-top:0;margin-bottom:.25rem}.progress-spinner{margin-left:.25rem;margin-right:.25rem;margin-top:0;margin-bottom:0}.progressbar span{display:block;text-align:center;color:#fff;transition:300ms width linear;background:#00897b;height:.8rem;font-size:.6rem;padding-bottom:.5rem}.bottombar{position:absolute;bottom:0;left:5rem;color:var(--white);background-color:var(--black) !important;font-size:.8rem;z-index:999}.image-icon-bar{max-height:1.3em;float:right;margin:.1em;border-radius:0;background:rgba(255,255,255,0.2)}.home-image-icon-bar{max-height:2em;float:right;margin:.3em;border-radius:0}.support-icons{max-width:4em;max-height:3em}.support-text{color:var(--deep-brown-100) !important}.support-text:hover{font-weight:bold}.text-capitalize{text-transform:uppercase !important}.table-bordered td{border-right:1px solid #000 !important;border-left:1px solid #000 !important}.chart-table{max-height:30rem;max-width:90rem;overflow-y:auto;overflow-x:auto;font-size:.8rem}.chart-table-graph-container{max-height:50rem;max-width:90rem;overflow-x:auto;overflow-y:auto}.chart-table-first-row{position:sticky !important;top:0 !important;z-index:1}.chart-table-first-column{position:sticky !important;left:0;z-index:0}.chartjs-chart,.plotly-chart{display:inline-block;height:100%;padding-top:.5rem;padding-bottom:.5rem;padding-left:.5rem;padding-right:.5rem}.lcms-change-table-columns td{font-size:12px;table-layout:fixed;padding:15px 75px 0 0;max-width:1000px}td{word-wrap:break-word}.plotly-chart{padding-top:.75rem;margin-left:.5rem}.plotly-chart-download{display:none}.legendDiv{position:absolute;bottom:1.7em;right:0;overflow-y:auto;max-height:60%;color:var(--white);background-color:var(--black) !important;z-index:2}.legend div span{display:inline-block;height:.9em;margin-right:.3em;width:.9em;font-size:.9em}.legend-title{text-align:left;margin-bottom:.1rem;font-weight:bold;font-size:.9rem}.my-legend .legend-scale ul{margin:0;margin-bottom:.3em;padding:0;float:left;list-style:none}.my-legend .legend-scale ul li{font-size:80%;list-style:none;margin-left:0;line-height:1em;margin-bottom:.3em}.my-legend ul.legend-labels li span{display:block;float:left;height:1em;width:2em;margin-right:.3em;margin-left:0;border:1px solid #999}.my-legend .legend-source{font-size:70%;color:#999;clear:both}.my-legend a{color:#777}.leftLabel{float:left;font-size:.85rem}.rightLabel{float:right;font-size:.85rem}.colorRamp{width:100%;height:1rem}.legend-colorRamp{font-size:.9rem;width:100%}.layer-spinner{color:var(--black) !important;font-size:.9em !important}.layer-container{margin-bottom:1px}.layer-list{padding-bottom:1px;padding-top:1px;padding-left:0;margin-bottom:0}.time-lapse-layer-range-container{float:right;width:30%;margin-top:-0.95em}.time-lapse-label-container{padding-bottom:2em}.simple-time-lapse-layer-range{margin-top:1.8em;cursor:pointer;float:right;min-width:4rem}.simple-time-lapse-layer-range-first{float:right;min-width:4rem;margin-top:1.5em;cursor:pointer}.simple-layer-opacity-range{float:right;min-width:4rem;vertical-align:bottom;margin-top:.7rem;cursor:pointer}.layer-span,.layer-spinner,.layer-container,.toggle_radio,.collapse-title,.nav-item,ul{cursor:pointer;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.toggle_radio{position:relative;background:rgba(255,255,255,.5);margin:4px auto;overflow:hidden;padding:0 !important;-webkit-border-radius:var(--slider-border-radius);-moz-border-radius:var(--slider-border-radius);border-radius:var(--slider-border-radius);position:relative;float:left;height:26px;width:214px}.toggle_radio>*{float:left}.toggle_radio input[type=radio]{display:none}.toggle_radio label{background:#FFF;color:#000;z-index:0;display:block;width:100px;height:20px;margin:3px 3px;-webkit-border-radius:var(--slider-border-radius);-moz-border-radius:var(--slider-border-radius);border-radius:var(--slider-border-radius);cursor:pointer;z-index:1;text-align:center}.toggle_option_slider{width:100px;height:20px;position:absolute;top:3px;-webkit-border-radius:var(--slider-border-radius);-moz-border-radius:var(--slider-border-radius);border-radius:var(--slider-border-radius);-webkit-transition:all .4s ease;-moz-transition:all .4s ease;-o-transition:all .4s ease;-ms-transition:all .4s ease;transition:all .4s ease}.first_toggle:checked ~ .toggle_option_slider{background:var(--transparent-teal);left:3px;font-weight:900 !important}.second_toggle:checked ~ .toggle_option_slider{background:var(--transparent-teal);left:109px;font-weight:900 !important}.third_toggle:checked ~ .toggle_option_slider{background:var(--transparent-teal);left:215px}.param-title{font-weight:bold;padding-top:1rem;margin-bottom:0}::-webkit-scrollbar{width:.7rem;height:.7rem}::-webkit-scrollbar-track{-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,0.3)}::-webkit-scrollbar-thumb{background:var(--deep-brown-70);-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,0.5)}.flexcroll::-webkit-scrollbar{width:.7rem}.flexcroll::-webkit-scrollbar-track{-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,0.3)}.flexcroll::-webkit-scrollbar-thumb{background:var(--deep-brown-70);-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,0.5)}.flexcroll{scrollbar-color:var(--deep-brown-70) rgba(0,0,0,0.3);scrollbar-width:thin;scrollbar-height:thin;-webkit-scrollbar-color:var(--deep-brown-70) rgba(0,0,0,0.3);-webkit-scrollbar-width:thin;-webkit-scrollbar-height:thin}.fa{font-size:1.1em;color:#FFF;cursor:pointer}.panel-heading{border-top:.05rem solid var(--deep-brown-10);background-color:var(--transparent) !important;color:var(--white) !important}.bg-white,.panel-body{background-color:var(--deep-brown-10) !important;margin:0 !important;color:#000 !important;outline:none !important}.bg-download-select{background-color:var(--deep-brown-10) !important;margin:0 !important;color:var(--teal-100) !important;outline:none !important}.bg-download-select::selection{color:red;background:yellow}.panel-title{font-size:1.25rem}.h3{font-size:1rem}.panel-title>a:after{float:right !important;font-family:FontAwesome;content:"\f068";padding-right:5px}.panel-title-svg-lg{width:3rem;height:3rem;margin-right:-0.5rem;margin-left:-1rem;margin-top:-1.25rem;margin-bottom:-1rem}.panel-title-svg-sm{width:2rem;height:2rem;margin-right:0;margin-left:-0.5rem;margin-top:-0.75rem;margin-bottom:-0.5rem}.panel-title.collapsed>a:after{float:right !important;content:"\f067"}.sub-panel-title{padding-top:.8em}.sub-panel-title>a:after{float:left !important;font-family:FontAwesome;content:"\f077" !important;padding-right:5px}.sub-panel-title.collapsed>a:after{float:left !important;content:"\f078" !important}.sub-sub-panel-title.collapsed>a,.sub-panel-title.collapsed>a{font-weight:100 !important;color:var(--black) !important}.sub-sub-panel-title>a,.sub-panel-title>a{font-weight:900 !important}.sub-sub-panel-title>a:after{float:left !important;font-family:FontAwesome;content:"\f205" !important;padding-right:5px;color:var(--teal-100)}.sub-sub-panel-title.collapsed>a:after{float:left !important;content:"\f204" !important;color:var(--black)}.sub-panel-title,.sub-sub-panel-title{background-color:var(--deep-brown-10) !important;color:var(--black);font-weight:bold !important;font-size:1.1em;border-top:.1em solid var(--deep-brown-30)}.collapse-title{color:var(--white)}.sub-sub-panel-title:hover,.sub-panel-title:hover,.collapse-title:hover,.panel-title:hover,.dropdown-item:hover,.nav-link:hover,.hover-teal:hover,a:hover{text-decoration:none;font-weight:1000 !important;cursor:pointer}.panel-title:hover{color:var(--teal-100) !important}.card{border-radius:0 !important;background-color:var(--white) !important}.gm-style-iw{border-radius:1px !important}.gm-marker-label{background-color:#372e2c;bottom:1rem;right:60%;position:relative;font-size:.8rem;font-family:'Roboto Condensed',sans-serif}.dropdown{cursor:pointer}.btn{padding:.3rem}.btn:active,.drawing-mode-selector:active{background-color:var(--teal-100) !important;transform:scale3d(1.05,1,1)}.btn:hover,.drawing-mode-selector:hover{font-weight:300}.color-button{border-radius:.2em;height:2.1em;width:2.1em;border:.1em solid black;vertical-align:middle !important}.dropdown-menu:hover{display:block;cursor:pointer}.dropdown-item{padding:0 !important}input[type = 'checkbox'],label,input[type = 'radio']{cursor:pointer}input[type=checkbox],input[type=radio]{display:none}input[type=checkbox]+label:before,input[type=radio]+label:before{font-family:FontAwesome;display:inline-block}input[type=checkbox]+label:before,input[type=radio].form-check-input+label:before{content:"\f10c"}input[type=checkbox]+label:before,input[type=radio].form-check-input+label:before{letter-spacing:.2em}input[type=checkbox]:checked+label:before,input[type=radio].form-check-input:checked+label:before{content:"\f111";color:#00897b}input[type=checkbox]:checked+label:before,input[type=radio].form-check-input:checked+label:before{letter-spacing:.2em}textarea{resize:none;overflow:hidden;min-height:50px;max-height:100px}.close{color:#FFF}.modal-md{max-width:550px}.modal-content{border-radius:0 !important}.modal-content{max-width:90em !important}.logo{height:3rem;display:inline;vertical-align:top;margin-bottom:.5rem}.splash-title{overflow:hidden;padding-left:1rem;padding-right:1rem;display:inline}.modal-full-screen-styling{background-color:rgba(230,230,230,0.8)}.modal-content-full-screen-styling{background-color:rgba(230,230,230,0.2);border-style:none}.intro-modal-links,.links{text-decoration:underline !important;font-size:1rem;font-weight:bold;margin-right:.3rem;color:var(--black) !important}.intro-modal-links:active{transform:translate(4px) translateY(4px)}.intro-modal-links:hover{font-weight:1000}.intro-list li{display:block}.modal-content-not-full-screen-styling{background-color:rgba(230,230,230,0.8);border-style:none}.ui-slider-horizontal .ui-slider-handle{top:-.45rem;border-radius:0;margin-left:-0.3rem;width:.6rem;height:1rem;border:.1rem solid var(--deep-brown-100)}.ui-widget-content .ui-state-default{background:var(--deep-brown-100) !important}.ui-slider-horizontal{height:.2rem;background:var(--deep-brown-70);border:.1rem solid var(--deep-brown-100)}.ui-slider-horizontal .ui-slider-handle .ui-state-focus{border-radius:0 !important}ul,#myUL{list-style-type:none}#myUL{margin:0;padding:0}.caret{cursor:pointer;border-top:0;user-select:none;white-space:nowrap;padding-bottom:1.5rem;font-size:1.1rem}.caret::before{font-family:FontAwesome;content:"\f07b";color:var(--teal-100);display:inline-block;margin-right:.3em;padding-left:.25em}.caret-down::before{font-family:FontAwesome;content:"\f07c";color:var(--teal-100)}.nested{display:none}.active{display:block;padding-left:1.2em}#downloadTree{color:#00897b}.carousel-img{width:100%;max-width:600px;max-height:500px}.textFade{animation:fadeInAnimation ease 20s;animation-delay:ease 0;animation-iteration-count:1;animation-fill-mode:forwards}.textFade2{animation:fadeInAnimation ease 25s;animation-delay:ease 0;animation-iteration-count:1;animation-fill-mode:forwards}.textFade3{animation:fadeInAnimation ease 30s;animation-delay:ease 0;animation-iteration-count:1;animation-fill-mode:forwards}.textFade4{animation:fadeInAnimation ease 35s;animation-delay:ease 0;animation-iteration-count:1;animation-fill-mode:forwards}.textFade5{animation:fadeInAnimation ease 40s;animation-delay:ease 0;animation-iteration-count:1;animation-fill-mode:forwards}.textFade6{animation:fadeInAnimation ease 45s;animation-delay:ease 0;animation-iteration-count:1;animation-fill-mode:forwards}@keyframes fadeInAnimation{0%{opacity:0}100%{opacity:1}}
+@import "https://fonts.googleapis.com/css?family=Roboto+Condensed&display=swap";:root{--teal-30:#B2ECE4;--teal-50:#80DFD2;--teal-80:#00BFA5;--teal-100:#00897b;--foo: true;--deep-brown-10:#D6D1CA;--deep-brown-20:#BFB7B0;--deep-brown-30:#ACA199;--deep-brown-50:#968B83;--deep-brown-70:#847779;--deep-brown-80:#6F6259;--deep-brown-100:#372e2c;--grayy:#6F6259;--black:#1B1716DD;--solid-black:#1B1716;--black:rgba(27, 23, 22, 0.9);--transparent:rgba(0,0,0,0);--white:#FFF;--almost-transparent:#BFB7B0DD;--orange:#FF834C;--transparent-teal:rgba(0, 137, 123, 0.3);--slider-border-radius:2px}html, body{height: 100%;margin: 0;padding: 0;background-color: var(--black);font-size: 16px;font-family: 'Roboto Condensed', sans-serif;font-weight: 100}@media only screen and (max-width: 1600px){html, body{font-size: 14px!important}}@media only screen and (max-width: 1400px){html, body{font-size: 12px!important}}@media only screen and (max-width: 1200px){html, body{font-size: 12px!important}}@media only screen and (max-width: 992){html, body{font-size: 11px!important}}@media only screen and (max-width: 768){html, body{font-size: 10px!important}}@media only screen and (max-width: 576px){html, body{font-size: 10px!important}}@media only screen and (max-width: 400px){html, body{font-size: 10px!important}}.custom-hidden{display: none}.center{display: block;margin-left: auto;margin-right: auto;width: 50%}.vcenter{display: inline-block;vertical-align: middle!important;float: none}.white{color:var(--deep-brown-20)}.gray{color:var(--deep-brown-70)}.dark-gray{color:var(--deep-brown-10)}.teal{color:var(--teal-100)!important}.teal80{color:var(--teal-80)!important}.teal-study-area-label{color:var(--teal-80)!important}.bg-teal{background-color: var(--teal-100)!important}.bg-gray{background-color: var(--deep-brown-100)!important;color:var(--deep-brown-20)!important}.bg-black,.btn{background-color: var(--black)!important;margin:0px!important;color:var(--white)!important;outline:none!important;vertical-align:middle!important}.shepherd-button{background-color: var(--deep-brown-100)!important;padding: 0.1rem 0.2rem;font-size:1.25rem}.shepherd-content,.shepherd-title,.shepherd-header,.shepherd-text,.shepherd-footer{background-color: var(--deep-brown-100)!important;color:var(--deep-brown-10)!important;overflow: auto}.shepherd-title{font-size:1.25rem}.shepherd-arrow:before{background-color: var(--teal-100)!important;outline-style: solid}.eraser{color: var(--deep-brown-100)!important;cursor:pointer}.eraser:active{transform: translate(3px) translateY(0px);color:var(--teal-100)!important}.eraser-all{height: 0.8rem;cursor:pointer;color:#000;background-color: var(--deep-brown-10);font-size:0.8rem!important;margin-top:0.0rem;margin-bottom: 0.0rem;margin-left:0.25rem;padding-left:0.25rem;padding-right:0.25rem;border-radius: 0.2rem;padding-bottom: 0rem}.fa-eraser{color:var(--deep-brown-100)!important}.eraser-all:active,.fa-eraser:active{transform: translate(4px) translateY(0px);color:var(--teal-100)!important}.eraser-all:hover{font-weight: 300}.bg-solid-black{background-color: var(--solid-black)!important;color:var(--white)!important}.time-lapse-active{background-color: var(--teal-100)!important;color:var(--deep-brown-70)!important}.time-lapse-slider-handle-label{padding-top:1.1em;margin-left:-2.2em;font-size:0.7em;width:5em;color:var(--teal-100)!important;text-align: center}.info-page{color:var(--deep-brown-20)!important}.simple-bg-black{background-color: var(--black)!important;color:var(--white)!important}.bg-transparent{background-color: var(--almost-transparent)!important;color:#000!important}.list-group-item,.list-group,.list-group-title{background-color: var(--deep-brown-10)!important;padding-left:0px;padding-right:0px}hr{border: 0;border-top: 1px solid var(--deep-brown-100);}.text-black{color:var(--black)!important}table{border: none!important}.dropdown-divider{margin-top:0.2em;margin-bottom:0em;padding-top:0.2em;padding-bottom:0.2em}.figure{display: right;float: right}.figcaption{width: 50%;text-align: justify;font-size:20em}.container-beforeIntro{padding-right: -50px;padding-left:100px;margin-right: -15px;margin-left: -15px}.container-intro{padding-right: 25px;padding-left: 45px;margin-right: 0px;margin-left: -15px}.main-container{position: absolute}.map{width:100%;height:100%;position:absolute;z-index:1}.search-box,.form-control{height:1.5em}kbd{border: 1px solid #999}ul, li{list-style-type:none}th{font-weight:600!important}.select-layer-name{margin:0;color:var(--teal-100)}button{-webkit-appearance: button}.sidebar-toggler{position:absolute;top:0%;left:0%;z-index:5;margin-top:-0.2rem;height:3rem}.sidebar-toggler:hover{font-size:1.9em!important}.sidebar-toggler:active{transform: translate(4px) translateY(4px)}.teal-hover:hover{color:var(--teal-100)!important}.sidebar{overflow-y: auto;max-height:calc(100% - 1.7em);;background-color: var(--black)!important;z-index:3}.vl{border-left: 1px solid var(--deep-brown-20);height: 1.25rem;vertical-align: middle;display: inline-block;margin-left: 0.1rem;margin-right:0.25rem;margin-top:0.5rem}.hl{border-bottom: 1px solid var(--deep-brown-20);height: 0.5rem;width:100%;vertical-align: middle;display: inline-block;margin-left: 0rem;margin-right:0rem;margin-top:0rem;padding:0}.vl-home{border-left: 1px solid var(--deep-brown-20);height: 1.5rem;vertical-align: middle;display: inline-block;margin-left: 0.1rem;margin-right:0.25rem;margin-top:0rem;margin-bottom:0.4rem}.vl2{border-left: 1px solid var(--deep-brown-100);height:2rem;display: inline;vertical-align: middle;display: inline-block;margin-left: 0rem;margin-right:0rem}.title-banner{font-weight:100;font-family: 'Roboto';margin-left:2.5rem;margin-right:0.5rem;margin-bottom:0.0rem;margin-top:0.25rem;font-size:1.5rem;display:flex}.search-bar{padding-left:2.75rem;padding-right:1rem;padding-bottom:0.5rem;padding-top:0.25rem;font-size:1.5rem;display: flex}.dashboard-results-container{position:absolute;bottom:0%;left:0%;width:100%;height:0px;z-index: 2}#dashboard-results-expander{height:0.75rem;background-color: var(--teal-100);margin:0;padding:0;cursor:grab}.dashboard-results{height:100%;width: 100%;overflow-x:scroll;overflow-y:hidden;white-space:nowrap;color:var(--white);background-color: var(--black)!important;margin:0;padding:0}.dashboard-highlights{position:absolute;top:0rem;right:0%;max-width:25rem;max-height:100%;overflow-y:auto;overflow-x:auto;z-index: 2}.dashboard-download-div{margin:0.5rem}.dashboard-download-button{background-color: var(--deep-brown-100)!important;font-size: 0.75rem;color:var(--deep-brown-10)!important;font-family: 'Roboto';font-size:1rem;border: 1px solid var(--deep-brown-100)}.dashboard-download-icon{color:var(--deep-brown-10)!important}.nav-tabs > li > a{color:var(--deep-brown-20);background-color: var(--deep-brown-100);}.nav-tabs .nav-link{border: 1px solid var(--deep-brown-20);border-top-left-radius: 0.25rem;border-top-right-radius: 0.25rem;height: 2rem;font-size: 0.85rem}.nav-tabs .nav-link:active{background-color: var(--teal-100)!important;transform: scale3d(1.05, 1, 1);color: var(--deep-brown-100)}.nav-tabs > li > a:hover{color:var(--teal-100)}.nav-tabs .nav-item.show .nav-link, .nav-tabs .nav-link.active{color: var(--deep-brown-100);background-color: var(--deep-brown-20);font-weight:bold}.highlights-table-tabs{max-width: 100%}.highlights-row{font-size: 0.65rem}.highlights-entry{padding:0.1rem;word-wrap: break-word}.highlights-insig{color:var(--deep-brown-80)}.highlights-sig{font-weight: 900;font-size:0.75rem;color:var(--deep-brown-100)}.highlights-title{color:var(--deep-brown-20);font-family: 'Roboto';font-size:1.75rem;text-align: center;margin-top:0.25rem;margin-bottom:0.25rem;margin-left:3rem!important;font-weight:200}.highlights-table-title{color:var(--deep-brown-20);font-family: 'Roboto';font-size:0.75rem;text-align: center;font-weight:200}.highlights-table-section-title{color:var(--deep-brown-20);background-color: var(--deep-brown-100)!important;font-family: 'Roboto';font-size:0.75rem;text-align: left;font-weight:300}.highlights-table{overflow-y:auto;padding-left: 0px!important}.dataTables_filter{text-align: left!important;margin-left: 0.5rem;margin-top:0.5rem;margin-bottom: 0.25rem;font-size: 0.75rem;color:var(--deep-brown-100);font-family: 'Roboto'}.highlights-disclaimer{margin-top:0.75rem;margin-left: 0.75rem;margin-right:0.75rem;margin-bottom:0.75rem;font-size: 0.75rem;max-width: 20rem;color: var(--deep-brown-20)}.btn-group>.btn{margin-left: 0.5rem!important;padding-bottom: 0px;border-radius: 3px;color: var(--deep-brown-20)!important;background-color: var(--deep-brown-100)!important;font-size: 0.75rem;margin-top: 0.5rem!important}.pac-container{background-color:var(--deep-brown-20)}.hr{height: 1px;border: none;background-color:var(--deep-brown-20)}#dashboard-progress-container{padding-left:1.75rem;padding-right:1rem}.progressbar{background: var(--deep-brown-80);width: 100%;font-size: 1rem;height:0.8rem;margin-top: 0rem;margin-bottom: 0.25rem}.progress-spinner{margin-left:0.25rem;margin-right:0.25rem;margin-top:0rem;margin-bottom:0rem}.progressbar span{display: block;text-align: center;color: #fff;transition: 300ms width linear;background: #00897B;height:0.8rem;font-size: 0.6rem;padding-bottom:0.5rem}.bottombar{position:absolute;bottom:0.0%;left:5rem;color:var(--white);background-color: var(--black)!important;font-size:0.8rem;z-index:999}.image-icon-bar{max-height:1.3em;float:right;margin:0.1em;border-radius: 0px;background:rgba(255,255,255,0.2)}.home-image-icon-bar{height:1.5rem;float:right;margin:0.2em;border-radius: 0px}.support-icons{max-width:4em;max-height:3em}.support-text{color: var(--deep-brown-100)!important}.support-text:hover{font-weight: bold}.text-capitalize{text-transform: uppercase!important}.table-bordered td{border-right: 1px solid #000!important;border-left: 1px solid #000!important}.chart-table{max-height:30rem;max-width:90rem;overflow-y:auto;overflow-x:auto;font-size: 0.8rem}.chart-table-graph-container{max-height:50rem;max-width:90rem;overflow-x:auto;overflow-y:auto}.chart-table-first-row{position: sticky!important;top: 0!important;z-index: 1}.chart-table-first-column{position: sticky!important;left: 0;z-index: 0}.chartjs-chart,.plotly-chart{display: inline-block;height:100%;padding-top:0.5rem;padding-bottom:0.5rem;padding-left:0.5rem;padding-right:0.5rem}.lcms-change-table-columns td{font-size: 12px;table-layout: fixed;padding: 15px 75px 0px 0px;max-width: 1000px}td{word-wrap:break-word}.plotly-chart{padding-top:0.75rem;margin-left:0.5rem}.plotly-chart-download{display: none}.legendDiv{position:absolute;bottom:1.7em;right:0%;overflow-y:auto;max-height:60%;color:var(--white);background-color: var(--black)!important;z-index:2}.legend div span{display: inline-block;height: 0.9em;margin-right: 0.3em;width: 0.9em;font-size:0.9em}.legend-title{text-align: left;margin-bottom: 0.1rem;font-weight: bold;font-size: 0.9rem}.my-legend .legend-scale ul{margin: 0;margin-bottom: 0.3em;padding: 0;float: left;list-style: none}.my-legend .legend-scale ul li{font-size: 80%;list-style: none;margin-left: 0;line-height: 1em;margin-bottom: 0.3em}.my-legend ul.legend-labels li span{display: block;float: left;height: 1em;width: 2em;margin-right: 0.3em;margin-left: 0;border: 1px solid #999}.my-legend .legend-source{font-size: 70%;color: #999;clear: both}.my-legend a{color: #777}.leftLabel{float:left;font-size:0.85rem}.rightLabel{float:right;font-size:0.85rem}.colorRamp{width:100%;height:1.0rem}.legend-colorRamp{font-size: 0.9rem;width:100%}.layer-spinner{color: var(--black)!important;font-size:0.9em!important}.layer-container{margin-bottom:1px}.layer-list{padding-bottom: 1px;padding-top :1px;padding-left:0px;margin-bottom:0px}.time-lapse-layer-range-container{float:right;width:30%;margin-top:-0.95em}.time-lapse-label-container{padding-bottom:2em}.simple-time-lapse-layer-range{margin-top:1.8em;cursor:pointer;float:right;min-width:4rem}.simple-time-lapse-layer-range-first{float:right;min-width:4rem;margin-top:1.5em;cursor:pointer}.simple-layer-opacity-range{float:right;min-width:4rem;vertical-align:bottom;margin-top:0.7rem;cursor:pointer}.layer-span, .layer-spinner,.layer-container,.toggle_radio,.collapse-title,.nav-item,ul{cursor:pointer;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none}.toggle_radio{position: relative;background: rgba(255,255,255,.5);margin: 4px auto;overflow: hidden;padding: 0 !important;-webkit-border-radius: var(--slider-border-radius);-moz-border-radius: var(--slider-border-radius);border-radius: var(--slider-border-radius);position: relative;float:left;height: 26px;width: 214px}.toggle_radio > *{float: left}.toggle_radio input[type=radio]{display: none}.toggle_radio label{background:#FFF;color: #000;z-index: 0;display: block;width: 100px;height: 20px;margin: 3px 3px;-webkit-border-radius: var(--slider-border-radius);-moz-border-radius: var(--slider-border-radius);border-radius: var(--slider-border-radius);cursor: pointer;z-index: 1;text-align: center}.toggle_option_slider{width: 100px;height: 20px;position: absolute;top: 3px;-webkit-border-radius: var(--slider-border-radius);-moz-border-radius: var(--slider-border-radius);border-radius: var(--slider-border-radius);-webkit-transition: all .4s ease;-moz-transition: all .4s ease;-o-transition: all .4s ease;-ms-transition: all .4s ease;transition: all .4s ease}.first_toggle:checked ~ .toggle_option_slider{background: var(--transparent-teal);left: 3px;font-weight: 900!important}.second_toggle:checked ~ .toggle_option_slider{background: var(--transparent-teal);left: 109px;font-weight: 900!important}.third_toggle:checked ~ .toggle_option_slider{background: var(--transparent-teal);left: 215px}.param-title{font-weight: bold;padding-top:1rem;margin-bottom:0rem}::-webkit-scrollbar{width: 0.7rem;height:0.7rem}::-webkit-scrollbar-track{-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3)}::-webkit-scrollbar-thumb{background: var(--deep-brown-70);-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.5)}.flexcroll::-webkit-scrollbar{width: 0.7rem}.flexcroll::-webkit-scrollbar-track{-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3)}.flexcroll::-webkit-scrollbar-thumb{background: var(--deep-brown-70);-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.5)}.flexcroll{scrollbar-color: var(--deep-brown-70) rgba(0,0,0,0.3);scrollbar-width: thin;scrollbar-height: thin;-webkit-scrollbar-color: var(--deep-brown-70) rgba(0,0,0,0.3);-webkit-scrollbar-width: thin;-webkit-scrollbar-height: thin}.fa{font-size:1.1em;color:#FFF;cursor:pointer}.panel-heading{border-top: 0.05rem solid var(--deep-brown-10);background-color: var(--transparent)!important;color:var(--white)!important}.bg-white, .panel-body{background-color: var(--deep-brown-10)!important;margin:0px!important;color:#000!important;outline:none!important}.bg-download-select{background-color: var(--deep-brown-10)!important;margin:0px!important;color:var(--teal-100)!important;outline:none!important}.bg-download-select::selection{color: red;background: yellow}.panel-title{font-size: 1.25rem}.h3{font-size:1rem}.panel-title > a:after{float: right !important;font-family: FontAwesome;content:"\f068";padding-right: 5px}.panel-title-svg-lg{width:3rem;height:3rem;margin-right:-0.5rem;margin-left:-1.0rem;margin-top:-1.25rem;margin-bottom:-1rem}.panel-title-svg-sm{width:2rem;height:2rem;margin-right:0rem;margin-left:-0.5rem;margin-top:-0.75rem;margin-bottom:-0.5rem}.panel-title.collapsed > a:after{float: right !important;content:"\f067"}.sub-panel-title{padding-top:0.8em}.sub-panel-title > a:after{float: left !important;font-family: FontAwesome;content:"\f077" !important;padding-right: 5px}.sub-panel-title.collapsed > a:after{float: left !important;content:"\f078" !important}.sub-sub-panel-title.collapsed> a, .sub-panel-title.collapsed> a{font-weight: 100!important;color:var(--black)!important}.sub-sub-panel-title > a , .sub-panel-title > a{font-weight: 900!important}.sub-sub-panel-title > a:after{float: left !important;font-family: FontAwesome;content:"\f205" !important;padding-right: 5px;color:var(--teal-100)}.sub-sub-panel-title.collapsed > a:after{float: left !important;content:"\f204" !important;color:var(--black)}.sub-panel-title, .sub-sub-panel-title{background-color: var(--deep-brown-10)!important;color:var(--black);font-weight: bold!important;font-size:1.1em;border-top: 0.1em solid var(--deep-brown-30)}.collapse-title{color:var(--white)}.sub-sub-panel-title:hover,.sub-panel-title:hover,.collapse-title:hover,.panel-title:hover,.dropdown-item:hover,.nav-link:hover, .hover-teal:hover, a:hover{text-decoration: none;font-weight: 1000!important;;cursor:pointer}.panel-title:hover{color:var(--teal-100)!important}.card{border-radius: 0px!important;background-color: var(--white)!important}.gm-style-iw{border-radius: 1px!important}.gm-marker-label{background-color: #372e2c;bottom: 1rem;right: 60%;position: relative;font-size: 0.8rem;font-family: 'Roboto Condensed', sans-serif}.dropdown{cursor: pointer}.btn{padding:0.3rem}.btn:active,.drawing-mode-selector:active{background-color: var(--teal-100)!important;transform: scale3d(1.05, 1, 1)}.btn:hover,.drawing-mode-selector:hover{font-weight: 300}.color-button{border-radius:0.2em;height:2.1em;width:2.1em;border:0.1em solid black;vertical-align: middle!important}.dropdown-menu:hover{display: block;cursor:pointer}.dropdown-item{padding:0px!important}input[type = 'checkbox'],label,input[type = 'radio']{cursor:pointer}input[type=checkbox],input[type=radio]{display:none}input[type=checkbox] + label:before ,input[type=radio] + label:before{font-family: FontAwesome;display: inline-block}input[type=checkbox] + label:before,input[type=radio].form-check-input + label:before{content: "\f10c"}input[type=checkbox] + label:before,input[type=radio].form-check-input + label:before{letter-spacing: 0.2em}input[type=checkbox]:checked + label:before,input[type=radio].form-check-input:checked + label:before{content: "\f111";color:#00897B}input[type=checkbox]:checked + label:before,input[type=radio].form-check-input:checked + label:before{letter-spacing: 0.2em}textarea{resize: none;overflow: hidden;min-height: 50px;max-height: 100px}.modal-md{max-width:550px}.modal-content{border-radius: 0!important}.modal-content{max-width:90em!important}.logo{height:3rem;display: inline;vertical-align: top;margin-bottom: 0.5rem;margin-left:-0.3rem}.splash-title{overflow: hidden;padding-left:1rem;padding-right:1rem;display: inline}.modal-full-screen-styling{background-color:rgba(230,230,230,0.8)}.modal-content-full-screen-styling{background-color:rgba(230,230,230,0.2);border-style: none}.intro-modal-links, .links{text-decoration: underline!important;font-size: 1.0rem;font-weight: bold;margin-right:0.3rem;color:var(--black)!important}.intro-modal-links:active{transform: translate(4px) translateY(4px)}.intro-modal-links:hover{font-weight: 1000}.intro-list li{display: block}.modal-content-not-full-screen-styling{background-color:rgba(230,230,230,0.8);border-style: none}.ui-slider-horizontal .ui-slider-handle{top: -.45rem;border-radius:0rem;margin-left: -0.3rem;width: 0.6rem;height: 1rem;border: 0.1rem solid var(--deep-brown-100)}.ui-widget-content .ui-state-default{background: var(--deep-brown-100)!important}.ui-slider-horizontal{height: .2rem;background:var(--deep-brown-70);border: 0.1rem solid var(--deep-brown-100)}.ui-slider-horizontal .ui-slider-handle .ui-state-focus{border-radius: 0rem!important}ul, #myUL{list-style-type: none}#myUL{margin: 0;padding: 0}.caret{cursor: pointer;border-top: none;user-select: none;white-space: nowrap;padding-bottom:1.5rem;font-size: 1.1rem}.caret::before{font-family: FontAwesome;content:"\f07b";color: var(--teal-100);display: inline-block;margin-right: 0.3em;padding-left:0.25em}.caret-down::before{font-family: FontAwesome;content:"\f07c";color: var(--teal-100)}.nested{display: none}.active{display: block;padding-left:1.2em}#downloadTree{color:#00897b}.carousel-img{width: 100%;max-width: 600px;max-height: 500px}.textFade{animation: fadeInAnimation ease 20s;animation-delay: ease 0;animation-iteration-count: 1;animation-fill-mode: forwards}.textFade2{animation: fadeInAnimation ease 25s;animation-delay: ease 0;animation-iteration-count: 1;animation-fill-mode: forwards}.textFade3{animation: fadeInAnimation ease 30s;animation-delay: ease 0;animation-iteration-count: 1;animation-fill-mode: forwards}.textFade4{animation: fadeInAnimation ease 35s;animation-delay: ease 0;animation-iteration-count: 1;animation-fill-mode: forwards}.textFade5{animation: fadeInAnimation ease 40s;animation-delay: ease 0;animation-iteration-count: 1;animation-fill-mode: forwards}.textFade6{animation: fadeInAnimation ease 45s;animation-delay: ease 0;animation-iteration-count: 1;animation-fill-mode: forwards}@keyframes fadeInAnimation{0%{opacity: 0}100%{opacity: 1}}
```

### Comparing `geeViz-2023.6.1/geeViz/geeView/foliumView.html` & `geeViz-2023.7.1/geeViz/geeView/foliumView.html`

 * *Files 18% similar despite different names*

```diff
@@ -21,15 +21,15 @@
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css"/>
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>
     
             <meta name="viewport" content="width=device-width,
                 initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
             <style>
-                #map_47766393329cab8496e0a807eb620567 {
+                #map_9f01af45d810005f53e9f223be17841a {
                     position: relative;
                     width: 100.0%;
                     height: 100.0%;
                     left: 0.0%;
                     top: 0.0%;
                 }
                 .leaflet-container { font-size: 1rem; }
@@ -37,134 +37,122 @@
         
     <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.2/Control.FullScreen.min.js"></script>
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.2/Control.FullScreen.min.css"/>
 </head>
 <body>
     
     
-            <div class="folium-map" id="map_47766393329cab8496e0a807eb620567" ></div>
+            <div class="folium-map" id="map_9f01af45d810005f53e9f223be17841a" ></div>
         
 </body>
 <script>
     
     
-            var map_47766393329cab8496e0a807eb620567 = L.map(
-                "map_47766393329cab8496e0a807eb620567",
+            var map_9f01af45d810005f53e9f223be17841a = L.map(
+                "map_9f01af45d810005f53e9f223be17841a",
                 {
                     center: [0, 0],
                     crs: L.CRS.EPSG3857,
                     zoom: 1,
                     zoomControl: true,
                     preferCanvas: false,
                 }
             );
 
             
 
         
     
-            var tile_layer_e78521839dc218eea5aea3087e90e71d = L.tileLayer(
+            var tile_layer_52456da184d9b89b0072d897add8f711 = L.tileLayer(
                 "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
                 {"attribution": "Data by \u0026copy; \u003ca target=\"_blank\" href=\"http://openstreetmap.org\"\u003eOpenStreetMap\u003c/a\u003e, under \u003ca target=\"_blank\" href=\"http://www.openstreetmap.org/copyright\"\u003eODbL\u003c/a\u003e.", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
-            ).addTo(map_47766393329cab8496e0a807eb620567);
+            ).addTo(map_9f01af45d810005f53e9f223be17841a);
         
     
-            var tile_layer_a181e18baa53cfa28d08895d6b770e30 = L.tileLayer(
+            var tile_layer_6600cffe439b1334bb98126b827cadbf = L.tileLayer(
                 "https://mt1.google.com/vt/lyrs=m\u0026x={x}\u0026y={y}\u0026z={z}",
                 {"attribution": "Google", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
-            ).addTo(map_47766393329cab8496e0a807eb620567);
+            ).addTo(map_9f01af45d810005f53e9f223be17841a);
         
     
-            var tile_layer_9aea0991d1a7a5b64447a8e2e56aa946 = L.tileLayer(
+            var tile_layer_99fea673b78dcaeacc304e7e82469b51 = L.tileLayer(
                 "https://mt1.google.com/vt/lyrs=y\u0026x={x}\u0026y={y}\u0026z={z}",
                 {"attribution": "Google", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
-            ).addTo(map_47766393329cab8496e0a807eb620567);
+            ).addTo(map_9f01af45d810005f53e9f223be17841a);
         
     
-            var tile_layer_07f261c344287e642692ad411a767d19 = L.tileLayer(
-                "https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/0fd1db82d279da0824b36718f60ee868-a456419d2d8784d0209f9558b44e10bb/tiles/{z}/{x}/{y}",
+            var tile_layer_8a1a60d87bcebecb3cfc77926e48aaf0 = L.tileLayer(
+                "https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/0fd1db82d279da0824b36718f60ee868-bcf4988b06df88074e01f961c7a29704/tiles/{z}/{x}/{y}",
                 {"attribution": "Google Earth Engine", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
-            ).addTo(map_47766393329cab8496e0a807eb620567);
+            ).addTo(map_9f01af45d810005f53e9f223be17841a);
         
     
-            var tile_layer_a0ba7e53056745a6ac954a10bc637693 = L.tileLayer(
-                "https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/c6ca2e65ab5f31977600a36ebba2c2e1-0058cf6325568347e615805f2dfe7b41/tiles/{z}/{x}/{y}",
+            var tile_layer_90e1acf1279c79320003ab557c364443 = L.tileLayer(
+                "https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/3485c862b1adaf3d9c26cd1bc6240177-23aaec80f9271af53600f057cdbe5bee/tiles/{z}/{x}/{y}",
                 {"attribution": "Google Earth Engine", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
-            ).addTo(map_47766393329cab8496e0a807eb620567);
+            ).addTo(map_9f01af45d810005f53e9f223be17841a);
         
     
-            var tile_layer_d3e1788a590704ff6d79aba8c1421001 = L.tileLayer(
-                "https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/532d13afdc902923d4d09b47fa9ea3fd-27a56c03c1388ec946cf5c20755e4dfc/tiles/{z}/{x}/{y}",
-                {"attribution": "Google Earth Engine | GeeViz", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
-            ).addTo(map_47766393329cab8496e0a807eb620567);
+            var tile_layer_b7d8ae181cd8088e15ac8a863447e327 = L.tileLayer(
+                "https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/256bef5461e5ae9af23af4a11291fcb3-21f244b22f544f4c881106d1477c4046/tiles/{z}/{x}/{y}",
+                {"attribution": "Google Earth Engine", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
+            ).addTo(map_9f01af45d810005f53e9f223be17841a);
         
     
-            var tile_layer_66c216948740e7fcb999337e1cc6d252 = L.tileLayer(
-                "https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/37db9b94e19e3638c1d9880d82548fbe-022da95d64ddf043da8bebfa5df2f845/tiles/{z}/{x}/{y}",
+            var tile_layer_b6d46a674ee02fef5b231922e6cbc9ea = L.tileLayer(
+                "https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/c97dbbc514930ba23dd7d4bb491793c2-7456047243f9a1951cbc32303737a9af/tiles/{z}/{x}/{y}",
                 {"attribution": "Google Earth Engine | GeeViz", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
-            ).addTo(map_47766393329cab8496e0a807eb620567);
+            ).addTo(map_9f01af45d810005f53e9f223be17841a);
         
     
-            var tile_layer_cdc09be7f16164bd031a261f087bfa8a = L.tileLayer(
-                "https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/47b6ee900db3f3a59c79b079fc2fddf3-97be030449695473499ed142b3142802/tiles/{z}/{x}/{y}",
+            var tile_layer_f4d29d1fad225e569bf92fb73be036c9 = L.tileLayer(
+                "https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/0618402ce7fa273b3c89fbd16b593017-8e869bf00ebc5797046cf8c2ee40967c/tiles/{z}/{x}/{y}",
                 {"attribution": "Google Earth Engine | GeeViz", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
-            ).addTo(map_47766393329cab8496e0a807eb620567);
-        
-    
-            var tile_layer_31c7d426aac1af90c858daaecc5ca11f = L.tileLayer(
-                "https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/63c14b0538e07a3ca0d73259a122790b-474ac98feca1c9c6dfd8e556acbace06/tiles/{z}/{x}/{y}",
-                {"attribution": "Google Earth Engine", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
-            ).addTo(map_47766393329cab8496e0a807eb620567);
-        
-    
-            var tile_layer_938fcc72be8f9471c2f188e675876de7 = L.tileLayer(
-                "https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/cafb0d2cc02cf76ec239f89a145d70fa-8ea9ae60232ee2084a893d9db53f59e5/tiles/{z}/{x}/{y}",
-                {"attribution": "Google Earth Engine", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
-            ).addTo(map_47766393329cab8496e0a807eb620567);
+            ).addTo(map_9f01af45d810005f53e9f223be17841a);
         
     
-            var tile_layer_02d7f43d27619dde6b64bcf49cf1dc54 = L.tileLayer(
-                "https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/942811ab076cbafda83188c0dcfe0a59-27ce70a2dbce14b0a2f470c94405cbe1/tiles/{z}/{x}/{y}",
-                {"attribution": "Google Earth Engine", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
-            ).addTo(map_47766393329cab8496e0a807eb620567);
+            var tile_layer_f7c79d77871fc74c5c39e1b7e05a8020 = L.tileLayer(
+                "https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/ab6f1be6481bc707b3c308efcb5688e0-f22f7647a0ad20ab0b29c721eaa3840a/tiles/{z}/{x}/{y}",
+                {"attribution": "Google Earth Engine | GeeViz", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
+            ).addTo(map_9f01af45d810005f53e9f223be17841a);
         
     
-            var tile_layer_bc63dc991cc0b8de3ea7fbe9144f4483 = L.tileLayer(
-                "https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/14f4c2778fc2adcbbd07a05911496f2e-f83ae8717a38ce04e4425eda43983943/tiles/{z}/{x}/{y}",
-                {"attribution": "Google Earth Engine", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
-            ).addTo(map_47766393329cab8496e0a807eb620567);
+            var tile_layer_2194b231b0e586b709b84271f735dc05 = L.tileLayer(
+                "https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/5b27623fc826aad75562ae5c2bd9ef8e-7a2439d031c55c8b960a6f9f0d3ca7b8/tiles/{z}/{x}/{y}",
+                {"attribution": "Google Earth Engine | GeeViz", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
+            ).addTo(map_9f01af45d810005f53e9f223be17841a);
         
     
-            var layer_control_cba5b8833ddc165e1c4024daf87b3c85 = {
+            var layer_control_a5646b5ff2725dcd66940e348db83151 = {
                 base_layers : {
-                    "openstreetmap" : tile_layer_e78521839dc218eea5aea3087e90e71d,
+                    "openstreetmap" : tile_layer_52456da184d9b89b0072d897add8f711,
                 },
                 overlays :  {
-                    "Google Maps" : tile_layer_a181e18baa53cfa28d08895d6b770e30,
-                    "Google Satellite" : tile_layer_9aea0991d1a7a5b64447a8e2e56aa946,
-                    "Bloom Mapper Study Area" : tile_layer_07f261c344287e642692ad411a767d19,
-                    "Clean Water Body Centroids" : tile_layer_a0ba7e53056745a6ac954a10bc637693,
-                    "Clean Comp 2018-2022" : tile_layer_d3e1788a590704ff6d79aba8c1421001,
-                    "Clean Water Mask 2018-2022" : tile_layer_66c216948740e7fcb999337e1cc6d252,
-                    "Old Water Mask" : tile_layer_cdc09be7f16164bd031a261f087bfa8a,
-                    "HCB Training" : tile_layer_31c7d426aac1af90c858daaecc5ca11f,
-                    "WDEQ Training" : tile_layer_938fcc72be8f9471c2f188e675876de7,
-                    "Clean Training" : tile_layer_02d7f43d27619dde6b64bcf49cf1dc54,
-                    "All Training" : tile_layer_bc63dc991cc0b8de3ea7fbe9144f4483,
+                    "Google Maps" : tile_layer_6600cffe439b1334bb98126b827cadbf,
+                    "Google Satellite" : tile_layer_99fea673b78dcaeacc304e7e82469b51,
+                    "Bloom Mapper Study Area" : tile_layer_8a1a60d87bcebecb3cfc77926e48aaf0,
+                    "WDEQ Training" : tile_layer_90e1acf1279c79320003ab557c364443,
+                    "Apply Study Area" : tile_layer_b7d8ae181cd8088e15ac8a863447e327,
+                    "Median S2 yr2022_07-30_08-27" : tile_layer_b6d46a674ee02fef5b231922e6cbc9ea,
+                    "Median S2 Water yr2022_07-30_08-27" : tile_layer_f4d29d1fad225e569bf92fb73be036c9,
+                    "WDEQ Density  yr2022_07-30_08-27" : tile_layer_f7c79d77871fc74c5c39e1b7e05a8020,
+                    "WDEQ Count yr2022_07-30_08-27" : tile_layer_2194b231b0e586b709b84271f735dc05,
                 },
             };
             L.control.layers(
-                layer_control_cba5b8833ddc165e1c4024daf87b3c85.base_layers,
-                layer_control_cba5b8833ddc165e1c4024daf87b3c85.overlays,
+                layer_control_a5646b5ff2725dcd66940e348db83151.base_layers,
+                layer_control_a5646b5ff2725dcd66940e348db83151.overlays,
                 {"autoZIndex": false, "collapsed": false, "position": "topright"}
-            ).addTo(map_47766393329cab8496e0a807eb620567);
-            tile_layer_d3e1788a590704ff6d79aba8c1421001.remove();
-            tile_layer_66c216948740e7fcb999337e1cc6d252.remove();
-            tile_layer_cdc09be7f16164bd031a261f087bfa8a.remove();
+            ).addTo(map_9f01af45d810005f53e9f223be17841a);
+            tile_layer_b7d8ae181cd8088e15ac8a863447e327.remove();
+            tile_layer_b6d46a674ee02fef5b231922e6cbc9ea.remove();
+            tile_layer_f4d29d1fad225e569bf92fb73be036c9.remove();
+            tile_layer_f7c79d77871fc74c5c39e1b7e05a8020.remove();
+            tile_layer_2194b231b0e586b709b84271f735dc05.remove();
         
     
             L.control.fullscreen(
                 {"forceSeparateButton": false, "position": "topleft", "title": "Full Screen", "titleCancel": "Exit Full Screen"}
-            ).addTo(map_47766393329cab8496e0a807eb620567);
+            ).addTo(map_9f01af45d810005f53e9f223be17841a);
         
 </script>
 </html>
```

### Comparing `geeViz-2023.6.1/geeViz/geeView/images/EE-logo-150.png` & `geeViz-2023.7.1/geeViz/geeView/images/EE-logo-150.png`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/geeView/images/GEE.png` & `geeViz-2023.7.1/geeViz/geeView/images/GEE.png`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/geeView/images/GEE_logo_transparent.png` & `geeViz-2023.7.1/geeViz/geeView/images/GEE_logo_transparent.png`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/geeView/images/RCR-logo.jpg` & `geeViz-2023.7.1/geeViz/geeView/images/RCR-logo.jpg`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/geeView/images/Thumbs.db` & `geeViz-2023.7.1/geeViz/geeView/images/Thumbs.db`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/geeView/images/cumulative_icon.png` & `geeViz-2023.7.1/geeViz/geeView/images/cumulative_icon.png`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/geeView/images/layer_icon.png` & `geeViz-2023.7.1/geeViz/geeView/images/layer_icon.png`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/geeView/images/logos_usda-fs.svg` & `geeViz-2023.7.1/geeViz/geeView/images/logos_usda-fs.svg`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/geeView/images/logos_usda-fs_bn-dk-01.svg` & `geeViz-2023.7.1/geeViz/geeView/images/logos_usda-fs_bn-dk-01.svg`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/geeView/images/menu-hamburger_ffffff.svg` & `geeViz-2023.7.1/geeViz/geeView/images/menu-hamburger_ffffff.svg`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/geeView/images/usdalogo.png` & `geeViz-2023.7.1/geeViz/geeView/images/usdalogo.png`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/geeView/images/usfslogo.png` & `geeViz-2023.7.1/geeViz/geeView/images/usfslogo.png`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/geeView/index.html` & `geeViz-2023.7.1/geeViz/geeView/index.html`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/geeView/js/gena-gee-palettes.js` & `geeViz-2023.7.1/geeViz/geeView/js/gena-gee-palettes.js`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/geeView/js/lcms-viewer.min.js` & `geeViz-2023.7.1/geeViz/geeView/js/lcms-viewer.min.js`

 * *Files 1% similar despite different names*

#### js-beautify {}

```diff
@@ -21,18 +21,18 @@
 }
 var fullShareURL;
 
 function TweetThis(e = "", a = "", t = !1, o = !0, l = !1) {
     updatePageUrl(), $.get("https://tinyurl.com/api-create.php", {
         url: pageUrl
     }, (function(r) {
-        let n = r.split("https://tinyurl.com/")[1],
-            s = pageUrl.split("?")[0] + "?id=" + n,
-            i = e + s + a;
-        if (ga("send", "event", mode + "-share", pageUrl, s), console.log("shared"), t) {
+        let s = r.split("https://tinyurl.com/")[1],
+            n = pageUrl.split("?")[0] + "?id=" + s,
+            i = e + n + a;
+        if (ga("send", "event", mode + "-share", pageUrl, n), console.log("shared"), t) {
             window.open(i, "_blank").focus()
         } else if (o) {
             showMessage("Share link", `<div class="input-group-prepend" id = 'shareLinkMessageBox'>\n                                <button onclick = 'copyText("shareLinkText","copiedMessageBox")'' title = 'Click to copy link to clipboard' class="py-0  fa fa-copy btn input-group-text bg-white"></button>\n                                <input type="text" value="${i}" id="shareLinkText" style = "max-width:70%;" class = "form-control mx-1">\n                               </div>\n                               <div id = 'copiedMessageBox' class = 'pl-4'</div>\n                               `), "geeViz" !== mode && $("#shareLinkMessageBox").append(staticTemplates.shareButtons)
         } else l && (fullShareURL = i);
         !1 !== t || l || setUrl(i)
     }))
 }
@@ -43,32 +43,31 @@
     var o = $("#" + e).text();
     "" === o && (o = $("#" + e).val()), t.val(o).select(), document.execCommand("copy"), t.remove(), null != a && $("#" + a).html("Copied text to clipboard")
 }
 
 function parseUrlSearch() {
     let e = window.location.search;
     if (console.log(e), "" !== e && (e = e.split("?")[1].split("&"), e.map((function(e) {
-            if (e.indexOf("OBJECT---") > -1) {
-                var a = e.split("---");
-                void 0 === urlParams[a[1]] && (urlParams[a[1]] = {}), urlParams[a[1]][a[2].split("=")[0]] = a[2].split("=")[1]
-            } else urlParams[e.split("=")[0]] = e.split("=")[1]
+            var a = decodeURIComponent(e.split("=")[1]);
+            try {
+                urlParams[e.split("=")[0]] = JSON.parse(a)
+            } catch (t) {
+                urlParams[e.split("=")[0]] = a
+            }
         }))), void 0 !== urlParams.id) window.open("https://tinyurl.com/" + urlParams.id, "_self"), "undefined" != typeof Storage && localStorage.setItem("cachedID", urlParams.id);
     else if ("undefined" != typeof Storage) {
         var a = localStorage.getItem("cachedID");
         null != a && "null" !== a && (setUrl(baseUrl() + "?id=" + a), localStorage.setItem("cachedID", null))
     }
 }
 
 function constructUrlSearch() {
     var e = "?";
     return Object.keys(urlParams).map((function(a) {
-        if ("object" == typeof urlParams[a]) {
-            var t = {};
-            Object.keys(urlParams[a]).map((e => t["OBJECT---" + a + "---" + e] = urlParams[a][e])), e += new URLSearchParams(t).toString() + "&"
-        } else e += a + "=" + urlParams[a] + "&"
+        e += a + "=" + encodeURIComponent(JSON.stringify(urlParams[a])) + "&"
     })), e = e.slice(0, e.length - 1)
 }
 pageUrl = document.URL, tinyURL = "", urlParams = {};
 let cachedSettingskey = "settings",
     startYear = 1985,
     endYear = 2022,
     startJulian = 153,
@@ -499,14 +498,16 @@
     return Math.min.apply(null, this)
 }, String.prototype.toProperCase = function() {
     return this.replace(/\w\S*/g, (function(e) {
         return e.charAt(0).toUpperCase() + e.substr(1).toLowerCase()
     }))
 }, String.prototype.replaceAll = function(e, a, t) {
     return this.replace(new RegExp(e.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g, "\\$&"), t ? "gi" : "g"), "string" == typeof a ? a.replace(/\$/g, "$$$$") : a)
+}, Array.prototype.insert = function(e) {
+    return this.splice.apply(this, [e, 0].concat(Array.prototype.slice.call(arguments, 1))), this
 }, Number.prototype.formatNumber = function(e = 2) {
     return this.toFixed(e).replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,")
 }, Number.prototype.numberWithCommas = function() {
     return this.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")
 }, String.prototype.numberWithCommas = function() {
     return this.replace(/\B(?=(\d{3})+(?!\d))/g, ",")
 }, String.prototype.toTitle = function() {
@@ -741,15 +742,16 @@
     queryTip: "Double-click on map to query the values of the visible layers.  Only layers that are turned on will be queried.",
     pixelChartDiv: `<div>Double-click on map to query ${mode} data time series<br></div>`,
     pixelChartTip: "Double-click on map to look at the full time series of " + mode + " outputs for a pixel.",
     userDefinedAreaChartDiv: "<div  id=\"user-defined\" >\n                                            <label>Provide name for area selected for charting (optional):</label>\n                                            <input title = 'Provide a name for your chart. A default one will be provided if left blank.'  type=\"user-defined-area-name\" class=\"form-control my-1\" id=\"user-defined-area-name\" placeholder=\"Name your charting area!\" style='width:80%;'>\n                                            <hr>\n                                            <div>Total area selected: <i id = \"user-defined-area-spinner\" style = 'display:none;' class=\"fa fa-spinner fa-spin text-dark pl-1\"></i></div>\n                                            <div id = 'user-defined-features-area' class = 'select-layer-name'>0 hectares / 0 acres</div>\n                                            <div id = 'user-defined-edit-toolbar'></div>\n                                            <button class = 'btn' style = 'margin-bottom: 0.5em!important;' onclick = 'chartUserDefinedArea()' title = 'Click to summarize across drawn polygons'>Chart Selected Areas</button>\n        \t\t            \t\t\t</div>\n                                \t</div>",
     showChartButton: "<div class = 'py-2'>\n                                <button onclick = \"$('#chart-modal').modal()\" class = 'btn bg-black' title = \"If you turned off the chart, but want to show it again\" >Turn on Chart</button>\n                                </div>",
     userDefinedAreaChartTip: "Click on map to select an area to summarize " + mode + " products across. Press <kbd>ctrl+z</kbd> to undo most recent point.  Press <kbd>Delete</kbd>, or press <kbd>Backspace</kbd> to start over. Double-click to finish polygon. Any number of polygons can be defined by repeating this process. Once finished defining areas, click on the <kbd>Chart Selected Areas</kbd> button to create chart.",
     uploadAreaChartDiv: "<hr>\n                                <label title = 'Powered by: https://ogre.adc4gis.com/'>Choose a zipped shapefile, kml, kmz, or geoJSON file to summarize across. Then hit \"Chart across chosen file\" button below to produce chart.</label>\n                                <input class = 'file-input my-1' type=\"file\" id=\"areaUpload\" name=\"upload\" accept=\".zip,.geojson,.json,.kmz,.kml\" style=\"display: inline-block;\">\n                                <hr>\n                                <div id = 'upload-reduction-factor-container'></div>\n                                <hr>\n                                <div>Uploaded areas:</div>\n                                <div id=\"area-charting-shp-layer-list\"></div>\n                                <hr>\n                                <button class = 'btn' style = 'margin-bottom: 0.5em!important;' onclick = 'runShpDefinedCharting()' title = 'Click to summarize across chosen .zip shapefile, .kmz, .kml, or .geojson.'>Chart across chosen file</button>",
-    uploadAreaChartTip: "Select zipped shapefile (zip into .zip all files related to the shapefile) or a single .kmz, .kml (If the .kmz or .kml has embedded pngs or any other non vector data, the conversion will likely fail.), or .geojson file to summarize products across.",
+    uploadShpToMapLayerDiv: '<hr>\n                                <label title = \'Powered by: https://ogre.adc4gis.com/\'>Choose a zipped shapefile, kml, kmz, or geoJSON file to add to the viewer for reference. Then click "Add file to viewer" button below to add the layer.</label>\n                                <input class = \'file-input my-1\' type="file" id="areaUpload" name="upload" accept=".zip,.geojson,.json,.kmz,.kml" style="display: inline-block;">\n                                <div>Uploaded areas:</div>\n                                <div id="area-charting-shp-layer-list"></div>\n                                <hr>\n                                <button class = \'btn\' style = \'margin-bottom: 0.5em!important;\' onclick = \'runShpDefinedAddLayer()\' title = \'Click to add .zip shapefile, .kmz, .kml, or .geojson. Layer will appear in Reference Data.\'>Add file to viewer</button>',
+    uploadAreaChartTip: "Select zipped shapefile (zip into .zip all files related to the shapefile) or a single .kmz, .kml (If the .kmz or .kml has embedded pngs or any other non vector data, the conversion will likely fail), or .geojson file to summarize products across.",
     selectAreaDropdownChartDiv: "<i title=\"Selecting pre-defined summary areas for chosen study area\" id = \"select-area-spinner\" class=\"text-dark px-2 fa fa-spin fa-spinner\"></i>\n                            <select class = 'form-control' style = 'width:100%;'  id='forestBoundaries' onchange='chartChosenArea()'></select>\n                            <hr>",
     selectAreaDropdownChartTip: "Select from pre-defined areas to summarize products across.",
     selectAreaInteractiveChartDiv: "<div>Choose from layers below and click on map to select areas to include in chart</div>\n                                        <hr>\n                                        <label>Provide name for area selected for charting (optional):</label>\n                                        <input title = 'Provide a name for your chart. A default one will be provided if left blank.'  type=\"user-selected-area-name\" class=\"form-control\" id=\"user-selected-area-name\" placeholder=\"Name your charting area!\" style='width:80%;'>\n                                        <hr>\n                                        <div id = 'simplify-error-range-container'></div>\n                                        <hr>\n                                        <div id=\"area-charting-select-layer-list\"></div>\n                                        <hr>\n                                        <div>Selected areas:</div>\n                                        <i id = \"select-features-list-spinner\" style = 'display:none;' class=\"fa fa-spinner fa-spin text-dark\"></i>\n                                        <li class = 'selected-features-list' id = 'selected-features-list'></li>\n                                        <div id=\"area-charting-selected-layer-list\"></div>\n                                        <hr>\n                                        <div>Total area selected: <i id = \"select-features-area-spinner\" style = 'display:none;' class=\"fa fa-spinner fa-spin text-dark pl-1\"></i></div>\n                                        <div id = 'selected-features-area' class = 'select-layer-name'>0 hectares / 0 acres</div>\n                                        <div id = 'select-features-edit-toolbar'></div>\n                                        <button class = 'btn' onclick = 'chartSelectedAreas()'>Chart Selected Areas</button>\n                                        ",
     selectAreaInteractiveChartTip: "Select from pre-defined areas on map to summarize products across.",
     shareButtons: '\x3c!-- Email --\x3e\n                        <a title = \'Share via E-mail\' onclick = \'TweetThis("mailto:?Subject=USDA Forest Service Landscape Change Monitoring System&amp;Body=I%20saw%20this%20and%20thought%20you%20might%20be%20interested.%20 ","",true)\'>\n                            <img class = \'image-icon-bar\' src="./images/email.png" alt="Email" />\n                        </a>\n                        <a title = \'Share on Reddit\' onclick = \'TweetThis("http://reddit.com/submit?url=","&amp;title=USDA Forest Service Landscape Change Monitoring System",true)\' >\n                            <img class = \'image-icon-bar\' src="./images/reddit.png" alt="Reddit" />\n                        </a>\n                        <a title = \'Share on Twitter\' onclick = \'TweetThis("https://twitter.com/share?url=","&amp;text=USDA Forest Service Landscape Change Monitoring System&amp;hashtags=USFSLCMS",true)\' >\n                            <img class = \'image-icon-bar\' src="./images/twitter.png" alt="Twitter" />\n                        </a>\n                        <a  title = \'Share on Facebook\' onclick = \'TweetThis("http://www.facebook.com/sharer.php?u=","",true)\' >\n                            <img class = \'image-icon-bar\' src="./images/facebook.png" alt="Facebook" />\n                        </a>'
 };
 
@@ -809,16 +811,16 @@
     let a = staticTemplates[e].replaceAll("<kbd>", "");
     a = a.replaceAll("</kbd>", ""), staticTemplates[e + "Hover"] = a
 }));
 const setRadioValue = function(e, a) {
     console.log(a), window[e] = a
 };
 
-function getRadio(e, a, t, o, l, r, n) {
-    return `<div class = 'container'>\n                <div id = '${e}-row' class = 'row'>\n            \t\t<label class="col-sm-4">${a}</label>\n            \t\t<div class = 'col-sm-8'>\n                \t\t<div  id = '${e}' class="toggle_radio">\n                            <input type="radio" checked class="toggle_option first_toggle" id="first_toggle${e}" name="toggle_option" onclick="setRadioValue('${l}','${r}')"  >\n                \t       <input type="radio"  class="toggle_option second_toggle" id="second_toggle${e}" name="toggle_option" onclick="setRadioValue('${l}','${n}')">\n                \t       <label for="first_toggle${e}"><p>${t}</p></label>\n                \t       <label for="second_toggle${e}"><p>${o}</p></label>\n                \t       <div class="toggle_option_slider"></div>\n            \t        </div>\n            \t   </div>\n        \t   </div>\n        \t</div>`
+function getRadio(e, a, t, o, l, r, s) {
+    return `<div class = 'container'>\n                <div id = '${e}-row' class = 'row'>\n            \t\t<label class="col-sm-4">${a}</label>\n            \t\t<div class = 'col-sm-8'>\n                \t\t<div  id = '${e}' class="toggle_radio">\n                            <input type="radio" checked class="toggle_option first_toggle" id="first_toggle${e}" name="toggle_option" onclick="setRadioValue('${l}','${r}')"  >\n                \t       <input type="radio"  class="toggle_option second_toggle" id="second_toggle${e}" name="toggle_option" onclick="setRadioValue('${l}','${s}')">\n                \t       <label for="first_toggle${e}"><p>${t}</p></label>\n                \t       <label for="second_toggle${e}"><p>${o}</p></label>\n                \t       <div class="toggle_option_slider"></div>\n            \t        </div>\n            \t   </div>\n        \t   </div>\n        \t</div>`
 }
 
 function getDiv(containerID, divID, label, variable, value) {
     eval(`var ${variable} = ${value}`), console.log(eval(variable));
     var div = `<div id = "${divID}">${label}</div>`;
     $("#" + containerID).append(div), $("#" + divID).click((function() {
         eval(`${variable}++`), console.log(eval(variable)), $("#" + divID).append(eval(variable))
@@ -910,27 +912,29 @@
     })), $("#" + radioID + "-second_toggle").change((function() {
         eval(`window.${variable} = '${valueOff}';`), eval(`${offFunction}`)
     }))
 }
 
 function addCheckboxes(containerID, checkboxID, title, variable, optionList) {
     $("#" + containerID).append(`<form  class = 'simple-radio' id = '${checkboxID}'><p class = 'param-title'>${title}</p></form>`), eval(`if(window.${variable} === undefined){window.${variable} = []}`), Object.keys(optionList).map((function(k) {
-        const checkboxCheckboxID = variable + k + "-checkbox",
+        const kID = k.replace(/[^A-Za-z0-9]/g, "-"),
+            checkboxCheckboxID = variable + kID + "-checkbox",
             checkboxLabelID = variable + checkboxCheckboxID + "-label";
         "true" === optionList[k] ? optionList[k] = !0 : "false" === optionList[k] && (optionList[k] = !1);
         let checked = optionList[k];
         optionList[k] = checked, checked = checked ? "checked" : "", eval(`window.${variable} = optionList`), $("#" + checkboxID).append(`<input  role="option" id="${checkboxCheckboxID}" type="checkbox" ${checked} value = '${k}' />\n                                 <label  id="${checkboxLabelID}" style = 'margin-bottom:0px;'  for="${checkboxCheckboxID}" >${k}</label>`), $("#" + checkboxCheckboxID).change((function() {
             optionList[$(this).val()] = $(this)[0].checked, eval(`window.${variable} = optionList`), console.log("Checkbox change"), console.log(optionList)
         }))
     }))
 }
 
 function addMultiRadio(containerID, radioID, title, variable, optionList) {
     $("#" + containerID).append(`<form  class = 'simple-radio' id = '${radioID}'><p class = 'param-title'>${title}</p></form>`), eval(`if(window.${variable} === undefined){window.${variable} = ''};`), Object.keys(optionList).map((function(k) {
-        var radioCheckboxID = k + "-checkbox",
+        const kID = k.replace(/[^A-Za-z0-9]/g, "-");
+        var radioCheckboxID = kID + "-checkbox",
             radioLabelID = radioCheckboxID + "-label";
         "true" === optionList[k] ? optionList[k] = !0 : "false" === optionList[k] && (optionList[k] = !1);
         var checked = optionList[k];
         checked ? (checked = "checked", eval(`window.${variable} = "${k}"`)) : checked = "", $("#" + radioID).append(`<div class="form-check form-check-inline">\n                              <input role="option" class="form-check-input" type="radio" name="inlineRadioOptions" id="${radioCheckboxID}" ${checked} value="${k}">\n                              <label class="form-check-label" for="${radioCheckboxID}">${k}</label>\n                            </div>`), $("#" + radioCheckboxID).change((function() {
             Object.keys(optionList).map((e => optionList[e] = !1));
             var v = $(this).val();
             optionList[v] = !0, eval(`window.${variable} = "${v}"`)
@@ -991,55 +995,55 @@
         },
         stop: function(e, a) {
             null != stopFun && stopFun(e, a)
         }
     })
 }
 
-function addDualRangeSlider(e, a, t, o, l, r, n, s, i, d, c, p, u, m) {
-    null == p && (p = ""), $("#" + e).append(`<div  id="${d}-container"class='dual-range-slider-container px-1' title="${p}">\n\t\t\t\t\t\t\t        <div class='dual-range-slider-name pt-2 pb-3 param-title'>${a}</div>\n\t\t\t\t\t\t\t        <div id="${d}" class='dual-range-slider-slider' href = '#'></div>\n\t\t\t\t\t\t\t        <div id='${d}-update' class='dual-range-slider-value p-2'></div>\n\t\t\t\t\t\t\t    </div>`), setUpDualRangeSlider(t, o, l, r, n, s, i, d, d + "-update", c, u, m)
+function addDualRangeSlider(e, a, t, o, l, r, s, n, i, d, c, p, u, m) {
+    null == p && (p = ""), $("#" + e).append(`<div  id="${d}-container"class='dual-range-slider-container px-1' title="${p}">\n\t\t\t\t\t\t\t        <div class='dual-range-slider-name pt-2 pb-3 param-title'>${a}</div>\n\t\t\t\t\t\t\t        <div id="${d}" class='dual-range-slider-slider' href = '#'></div>\n\t\t\t\t\t\t\t        <div id='${d}-update' class='dual-range-slider-value p-2'></div>\n\t\t\t\t\t\t\t    </div>`), setUpDualRangeSlider(t, o, l, r, s, n, i, d, d + "-update", c, u, m)
 }
 
 function setUpRangeSlider(variable, min, max, defaultValue, step, sliderID, mode) {
     eval(`window.${variable} = ${defaultValue};`), $("#" + sliderID + "-update").html(defaultValue), $("#" + sliderID).slider({
         min: min,
         max: max,
         step: step,
         value: defaultValue,
         slide: function(e, ui) {
             eval(`window.${variable} = ${ui.value};`), $("#" + sliderID + "-update").empty(), $("#" + sliderID + "-update").html(ui.value)
         }
     })
 }
 
-function addRangeSlider(e, a, t, o, l, r, n, s, i, d) {
-    $("#" + e).append(`<div  id="${s}-container" class='dual-range-slider-container px-1' title="${d}">\n                                    <div class='dual-range-slider-name pt-2 pb-3 param-title'>${a}</div>\n                                    <div id="${s}" class='dual-range-slider-slider' href = '#'></div>\n                                    <div id='${s}-update' class='dual-range-slider-value p-2'></div>\n                                </div>`), setUpRangeSlider(t, o, l, r, n, s, i)
+function addRangeSlider(e, a, t, o, l, r, s, n, i, d) {
+    $("#" + e).append(`<div  id="${n}-container" class='dual-range-slider-container px-1' title="${d}">\n                                    <div class='dual-range-slider-name pt-2 pb-3 param-title'>${a}</div>\n                                    <div id="${n}" class='dual-range-slider-slider' href = '#'></div>\n                                    <div id='${n}-update' class='dual-range-slider-value p-2'></div>\n                                </div>`), setUpRangeSlider(t, o, l, r, s, n, i)
 }
 
-function addTab(e, a, t, o, l, r, n, s, i) {
+function addTab(e, a, t, o, l, r, s, n, i) {
     var d;
-    s || (s = ""), d = i || "true" === i ? "active show" : "", $("#" + a).append(`<li class="nav-item"><a onclick = '${r}' class="nav-link text-left text-dark tab-nav-link ${d}" id="'+tabID+'" data-toggle="tab" href="#${l}" role="tab" aria-controls="${l}" aria-selected="false" title="${s}">${e}</a></li>`), $("#" + t).append($(`<div class="tab-pane fade ${d}" id="${l}" role="tabpanel" aria-labelledby="${o}" title="${s}"></div>`).append(n))
+    n || (n = ""), d = i || "true" === i ? "active show" : "", $("#" + a).append(`<li class="nav-item"><a onclick = '${r}' class="nav-link text-left text-dark tab-nav-link ${d}" id="'+tabID+'" data-toggle="tab" href="#${l}" role="tab" aria-controls="${l}" aria-selected="false" title="${n}">${e}</a></li>`), $("#" + t).append($(`<div class="tab-pane fade ${d}" id="${l}" role="tabpanel" aria-labelledby="${o}" title="${n}"></div>`).append(s))
 }
 
 function addTabContainer(e, a, t) {
     $("#" + e).append(`<ul class="pb-1 nav nav-tabs flex-column nav-justified md-tabs" id="${a}" role="tablist">  \n    </ul>\n    <div class = 'tab-content card' id = '${t}'>\n    </div>`)
 }
 
-function addCollapse(e, a, t, o, l, r, n, s, i = "append") {
+function addCollapse(e, a, t, o, l, r, s, n, i = "append") {
     var d;
-    null == s && (s = ""), !0 === r || "true" === r || "show" === r ? (r = "show", d = "") : (r = "", d = "collapsed");
-    var c = `<header title="${s}" class="panel-heading px-3 py-2 " role="tab" id="${a}" onclick = '${n}'>\n\t<h2 class="p-0 m-0 panel-title  ${d}" data-toggle="collapse"  href="#${t}" id="${a}-label" aria-expanded="${r}" aria-controls="${t}"> <a class = 'collapse-title' role='img'>\n\t${l} ${o} </a></h2><span id="${a}-message"</span></header>`,
+    null == n && (n = ""), !0 === r || "true" === r || "show" === r ? (r = "show", d = "") : (r = "", d = "collapsed");
+    var c = `<header title="${n}" class="panel-heading px-3 py-2 " role="tab" id="${a}" onclick = '${s}'>\n\t<h2 class="p-0 m-0 panel-title  ${d}" data-toggle="collapse"  href="#${t}" id="${a}-label" aria-expanded="${r}" aria-controls="${t}"> <a class = 'collapse-title' role='img'>\n\t${l} ${o} </a></h2><span id="${a}-message"</span></header>`,
         p = `<section id="${t}" class="panel-collapse collapse panel-body ${r} px-5 py-0" role="tabpanel" aria-labelledby="${a}"></section>`;
     "append" === i ? $("#" + e).append(`<div role="listitem" id="${a}-${t}"></div>`) : $("#" + e).prepend(`<div role="listitem" id="${a}-${t}"></div>`), $(`#${a}-${t}`).append(c), $(`#${a}-${t}`).append(p)
 }
 
-function addSubCollapse(e, a, t, o, l, r, n) {
-    var s;
-    !0 === r || "true" === r || "show" === r ? (r = "show", s = "") : (r = "", s = "collapsed");
-    var i = `<div >\n                                <div   class="panel-heading px-0 py-2 " role="tab" id="${a}" onclick = '${n}'>\n\t                           <h5 class="sub-panel-title ${s}" data-toggle="collapse"  href="#${t}" aria-expanded="false" aria-controls="${t}" > <a class = 'collapse-title' >${l} ${o} </a></h5>\n                                </div>\n                            </div`,
+function addSubCollapse(e, a, t, o, l, r, s) {
+    var n;
+    !0 === r || "true" === r || "show" === r ? (r = "show", n = "") : (r = "", n = "collapsed");
+    var i = `<div >\n                                <div   class="panel-heading px-0 py-2 " role="tab" id="${a}" onclick = '${s}'>\n\t                           <h5 class="sub-panel-title ${n}" data-toggle="collapse"  href="#${t}" aria-expanded="false" aria-controls="${t}" > <a class = 'collapse-title' >${l} ${o} </a></h5>\n                                </div>\n                            </div`,
         d = `<div id="${t}" class="panel-collapse collapse panel-body ${r} px-1 py-0" role="tabpanel" aria-labelledby="${a}"></div>`;
     $("#" + e).append(i), $("#" + e).append(d)
 }
 
 function addAccordianContainer(e, a) {
     $("#" + e).append(`<div class="accordion" id="${a}"></div>`)
 }
@@ -1049,22 +1053,22 @@
     return new Date(t.setMonth(0, e))
 }, Date.prototype.dayofYear = function() {
     var e = new Date(this.getFullYear(), 0, 0);
     return Math.floor((this - e) / 864e5)
 };
 var panelCollapseI = 1;
 
-function addAccordianCard(e, a, t, o, l, r, n, s) {
+function addAccordianCard(e, a, t, o, l, r, s, n) {
     var i;
-    null == s && (s = ""), !0 === r || "true" === r || "show" === r ? (r = "show", i = "") : (r = "", i = "collapsed"), $("#" + e).append(`\n    <div>\n      <div class=" px-0 py-2 sub-panel-title ${i}" id="${a}" data-toggle="collapse" data-target="#${t}"\n        aria-expanded="false" aria-controls="${t}" onclick = '${n}'>\n      <a class = 'collapse-title' title="${s}"  >\n        ${o} </a>\n      </div>\n      <div id="${t}" class="panel-collapse-${panelCollapseI} super-panel-collapse panel-collapse collapse panel-body pl-3 py-0  ${r} bg-black" aria-labelledby="${a}"\n        data-parent="#${e}">\n        <div title="${s}">${l}</div>\n      </div>\n    </div>`), panelCollapseI++
+    null == n && (n = ""), !0 === r || "true" === r || "show" === r ? (r = "show", i = "") : (r = "", i = "collapsed"), $("#" + e).append(`\n    <div>\n      <div class=" px-0 py-2 sub-panel-title ${i}" id="${a}" data-toggle="collapse" data-target="#${t}"\n        aria-expanded="false" aria-controls="${t}" onclick = '${s}'>\n      <a class = 'collapse-title' title="${n}"  >\n        ${o} </a>\n      </div>\n      <div id="${t}" class="panel-collapse-${panelCollapseI} super-panel-collapse panel-collapse collapse panel-body pl-3 py-0  ${r} bg-black" aria-labelledby="${a}"\n        data-parent="#${e}">\n        <div title="${n}">${l}</div>\n      </div>\n    </div>`), panelCollapseI++
 }
 
-function addSubAccordianCard(e, a, t, o, l, r, n, s) {
+function addSubAccordianCard(e, a, t, o, l, r, s, n) {
     var i;
-    null == s && (s = ""), !0 === r || "true" === r || "show" === r ? (r = "show", i = "") : (r = "", i = "collapsed"), $("#" + e).append(`\n    <div>\n      <div class=" px-0 py-2 sub-sub-panel-title ${i}" id="${a}" data-toggle="collapse" data-target="#${t}"\n        aria-expanded="false" aria-controls="${t}" onclick = '${n}'>\n      <a class = 'collapse-title' title="${s}"  >\n        ${o} </a>\n      </div>\n      <div id="${t}" class="panel-collapse-${panelCollapseI} toggle-collapse panel-collapse collapse panel-body pl-3 py-0  ${r} bg-black" aria-labelledby="${a}"\n        data-parent="#${e}">\n        <div title="${s}">${l}</div>\n      </div>\n    </div>`), panelCollapseI++
+    null == n && (n = ""), !0 === r || "true" === r || "show" === r ? (r = "show", i = "") : (r = "", i = "collapsed"), $("#" + e).append(`\n    <div>\n      <div class=" px-0 py-2 sub-sub-panel-title ${i}" id="${a}" data-toggle="collapse" data-target="#${t}"\n        aria-expanded="false" aria-controls="${t}" onclick = '${s}'>\n      <a class = 'collapse-title' title="${n}"  >\n        ${o} </a>\n      </div>\n      <div id="${t}" class="panel-collapse-${panelCollapseI} toggle-collapse panel-collapse collapse panel-body pl-3 py-0  ${r} bg-black" aria-labelledby="${a}"\n        data-parent="#${e}">\n        <div title="${n}">${l}</div>\n      </div>\n    </div>`), panelCollapseI++
 }
 
 function getWalkThroughCollapseContainerID() {
     return $(window).width() < 576 ? "sidebar-left" : "legendDiv"
 }
 
 function moveCollapse(e, a = getWalkThroughCollapseContainerID()) {
@@ -1130,16 +1134,16 @@
     e.loadError = !1;
     var a = e.legendDivID;
     e.id = a;
     var t = a + "-" + e.ID,
         o = a + "-container-" + e.ID,
         l = a + "-opacity-" + e.ID,
         r = a + "-visible-" + e.ID,
-        n = a + "-span-" + e.ID,
-        s = r + "-label-" + e.ID,
+        s = a + "-span-" + e.ID,
+        n = r + "-label-" + e.ID,
         i = a + "-spinner-" + e.ID,
         d = `${a}-eraser-${e.ID}`,
         c = (e.ID, "");
 
     function p() {
         $(`#${l}`).css("background-color", `rgba(55, 46, 44,${e.rangeOpacity})!important`)
     }
@@ -1157,64 +1161,64 @@
         e.loadError = !0, console.log("GEE Tile Service request failed for " + e.name), console.log(o), $("#" + o).css("background", "red"), $("#" + o).attr("title", 'Layer failed to load. Error message: "' + a + '"')
     }
 
     function g() {
         p(), layerObj[a].visible = e.visible, layerObj[a].opacity = e.opacity
     }
 
-    function v() {
+    function f() {
         e.loadError || (e.visible ? (ga("send", "event", "layer-off", e.layerType, e.name), "dynamicMapService" === e.layerType ? (e.layer.setMap(null), e.visible = !1, e.percent = 0, e.rangeOpacity = 0, p(), u(), $("#" + e.legendDivID).hide()) : "geeVector" !== e.layerType && "geoJSONVector" !== e.layerType ? (e.visible = !1, e.map.overlayMapTypes.setAt(e.layerId, null), e.percent = 0, u(), $("#" + e.legendDivID).hide(), e.rangeOpacity = 0, "tileMapService" !== e.layerType && "dynamicMapService" !== e.layerType && e.canQuery && (queryObj[t].visible = e.visible)) : (e.visible = !1, e.percent = 0, u(), $("#" + e.legendDivID).hide(), e.layer.setMap(null), e.rangeOpacity = 0, $("#" + i + "2").hide(), "geeVector" === e.layerType && e.canQuery && (queryObj[t].visible = e.visible)), e.viz.dashboardSummaryLayer && (Object.keys(e.dashboardSelectedFeatures).map((a => e.dashboardSelectedFeatures[a].polyList.map((e => e.setMap(null))))), updateDashboardCharts(), updateDashboardHighlights()), e.loading = !1, updateGEETileLayersDownloading(), $("#" + i + "2").hide(), $("#" + i + "3").hide(), g()) : (ga("send", "event", "layer-on", e.layerType, e.name), e.viz.isTimeLapse || turnOffTimeLapseCheckboxes(), "dynamicMapService" === e.layerType ? (e.layer.setMap(map), e.visible = !0, e.percent = 100, e.rangeOpacity = e.opacity, p(), u(), $("#" + e.legendDivID).show()) : "geeVector" !== e.layerType && "geoJSONVector" !== e.layerType ? (e.visible = !0, e.map.overlayMapTypes.setAt(e.layerId, e.layer), $("#" + e.legendDivID).show(), e.rangeOpacity = e.opacity, e.isTileMapService && (e.percent = 100, u()), e.layer.setOpacity(e.opacity), "tileMapService" !== e.layerType && "dynamicMapService" !== e.layerType && e.canQuery && (queryObj[t].visible = e.visible)) : (e.visible = !0, e.percent = 100, u(), $("#" + e.legendDivID).show(), e.layer.setMap(e.map), e.rangeOpacity = e.opacity, "geeVector" === e.layerType && e.canQuery && (queryObj[t].visible = e.visible)), e.viz.dashboardSummaryLayer && (Object.keys(e.dashboardSelectedFeatures).map((a => e.dashboardSelectedFeatures[a].polyList.map((e => e.setMap(map))))), "lcms-dashboard" === mode ? dashboardBoxSelect() : (updateDashboardCharts(), updateDashboardHighlights())), g()))
     }
 
-    function f() {
+    function v() {
         e.visible && $("#" + r).click()
     }
 
     function y() {
         e.visible || $("#" + r).click()
     }
-    layerObj[a] = e, e.wasJittered = !1, e.loading = !1, e.refreshNumber = refreshNumber, e.visible && (c = "checked"), e.viz.isTimeLapse && (timeLapseObj[e.viz.timeLapseID].loadingLayerIDs.push(a), timeLapseObj[e.viz.timeLapseID].sliders.push(l), timeLapseObj[e.viz.timeLapseID].layerVisibleIDs.push(r)), $("#" + e.whichLayerList).prepend(`<li id = '${o}' aria-label="Map layer controls container for ${e.name}" class = 'layer-container'  title= '${e.helpBoxMessage}'>\n\t\t\t\t\t\t\t\t           <div id="${l}" aria-labelledby="${o}" Opacity range slider for ${e.name}" class = 'simple-layer-opacity-range'></div>\n\t\t\t\t\t\t\t\t           <input  role="option" id="${r}" aria-label="Layer visibility toggle checkbox for ${e.name}" type="checkbox" ${c}  />\n\t\t\t\t\t\t\t\t            <label class = 'layer-checkbox' id="${s}" aria-label="Layer visibility toggle checkbox for ${e.name}" style = 'margin-bottom:0px;display:none;'  for="${r}"></label>\n\t\t\t\t\t\t\t\t            <i id = "${i}" class="fa fa-spinner fa-spin layer-spinner" title='Waiting for layer service from Google Earth Engine'></i>\n\t\t\t\t\t\t\t\t            <i id = "${i}2" style = 'display:none;' class="fa fa-cog fa-spin layer-spinner" title='Waiting for map tiles from Google Earth Engine'></i>\n\t\t\t\t\t\t\t\t            <i id = "${i}3" style = 'display:none;' class="fa fa-cog fa-spin layer-spinner" title='Waiting for map tiles from Google Earth Engine'></i>\n                                            <i title = 'Click to clear all selected features from this layer' id='${d}' class="fa fa-eraser eraser" style="display:none;"></i>\n\t\t\t\t\t\t\t\t            <span id = '${n}' aria-labelledby="${o}" class = 'layer-span'>${e.name}</span>\n\t\t\t\t\t\t\t\t       </li>`), $("#" + l).slider({
+    layerObj[a] = e, e.wasJittered = !1, e.loading = !1, e.refreshNumber = refreshNumber, e.visible && (c = "checked"), e.viz.isTimeLapse && (timeLapseObj[e.viz.timeLapseID].loadingLayerIDs.push(a), timeLapseObj[e.viz.timeLapseID].sliders.push(l), timeLapseObj[e.viz.timeLapseID].layerVisibleIDs.push(r)), $("#" + e.whichLayerList).prepend(`<li id = '${o}' aria-label="Map layer controls container for ${e.name}" class = 'layer-container'  title= '${e.helpBoxMessage}'>\n\t\t\t\t\t\t\t\t           <div id="${l}" aria-labelledby="${o}" Opacity range slider for ${e.name}" class = 'simple-layer-opacity-range'></div>\n\t\t\t\t\t\t\t\t           <input  role="option" id="${r}" aria-label="Layer visibility toggle checkbox for ${e.name}" type="checkbox" ${c}  />\n\t\t\t\t\t\t\t\t            <label class = 'layer-checkbox' id="${n}" aria-label="Layer visibility toggle checkbox for ${e.name}" style = 'margin-bottom:0px;display:none;'  for="${r}"></label>\n\t\t\t\t\t\t\t\t            <i id = "${i}" class="fa fa-spinner fa-spin layer-spinner" title='Waiting for layer service from Google Earth Engine'></i>\n\t\t\t\t\t\t\t\t            <i id = "${i}2" style = 'display:none;' class="fa fa-cog fa-spin layer-spinner" title='Waiting for map tiles from Google Earth Engine'></i>\n\t\t\t\t\t\t\t\t            <i id = "${i}3" style = 'display:none;' class="fa fa-cog fa-spin layer-spinner" title='Waiting for map tiles from Google Earth Engine'></i>\n                                            <i title = 'Click to clear all selected features from this layer' id='${d}' class="fa fa-eraser eraser" style="display:none;"></i>\n\t\t\t\t\t\t\t\t            <span id = '${s}' aria-labelledby="${o}" class = 'layer-span'>${e.name}</span>\n\t\t\t\t\t\t\t\t       </li>`), $("#" + l).slider({
         min: 0,
         max: 100,
         step: 1,
         value: 100 * e.opacity,
         slide: function(t, o) {
             if (e.opacity = o.value / 100, "geeVector" !== e.layerType && "geoJSONVector" !== e.layerType) e.layer.setOpacity(e.opacity);
             else {
                 var l = e.layer.getStyle();
                 l.strokeOpacity = e.opacity, l.fillOpacity = e.opacity / e.viz.opacityRatio, e.layer.setStyle(l), e.visible && e.range
             }
             e.visible && (e.rangeOpacity = e.opacity), layerObj[a].visible = e.visible, layerObj[a].opacity = e.opacity, p()
         }
     }), $("#" + l).val(100 * e.opacity);
     var b = !1;
-    if ($("#" + n).click((function() {
+    if ($("#" + s).click((function() {
             setTimeout((function() {
                 b || $("#" + r).click()
             }), 200)
         })), $("#" + i + "2").click((function() {
             $("#" + r).click()
-        })), $("#" + n).dblclick((function() {
+        })), $("#" + s).dblclick((function() {
             m(), b = !0, m(), e.visible || $("#" + r).click(), setTimeout((function() {
                 b = !1
             }), 200)
         })), $("#" + r).change((function() {
-            v()
-        })), layerObj[a].visible = e.visible, layerObj[a].opacity = e.opacity, e.viz.isTimeLapse || $(".layer-checkbox").on("turnOffAll", (function() {
-            f()
-        })), "geeVector" !== e.layerType && "geeVectorImage" !== e.layerType && "geoJSONVector" !== e.layerType || ($("#" + s).addClass("vector-layer-checkbox"), $(".vector-layer-checkbox").on("turnOffAll", (function() {
             f()
+        })), layerObj[a].visible = e.visible, layerObj[a].opacity = e.opacity, e.viz.isTimeLapse || $(".layer-checkbox").on("turnOffAll", (function() {
+            v()
+        })), "geeVector" !== e.layerType && "geeVectorImage" !== e.layerType && "geoJSONVector" !== e.layerType || ($("#" + n).addClass("vector-layer-checkbox"), $(".vector-layer-checkbox").on("turnOffAll", (function() {
+            v()
         })), $(".vector-layer-checkbox").on("turnOnAll", (function() {
             y()
         })), $(".vector-layer-checkbox").on("turnOffAllVectors", (function() {
-            f()
+            v()
         })), $(".vector-layer-checkbox").on("turnOnAllVectors", (function() {
             y()
-        })), e.viz.isUploadedLayer && ($("#" + s).addClass("uploaded-layer-checkbox"), selectionTracker.uploadedLayerIndices.push(e.layerId), $(".vector-layer-checkbox").on("turnOffAllUploadedLayers", (function() {
-            f()
+        })), e.viz.isUploadedLayer && ($("#" + n).addClass("uploaded-layer-checkbox"), selectionTracker.uploadedLayerIndices.push(e.layerId), $(".vector-layer-checkbox").on("turnOffAllUploadedLayers", (function() {
+            v()
         })), $(".vector-layer-checkbox").on("turnOnAllUploadedLayers", (function() {
             y()
         })))), "geeImage" === e.layerType || "geeVectorImage" === e.layerType || "geeImageCollection" === e.layerType) {
         if ("geeImageCollection" === e.layerType) {
             e.imageCollection = e.item, null !== e.viz.reducer && void 0 !== e.viz.reducer || (e.viz.reducer = ee.Reducer.lastNonNull());
             var w = ee.Image(e.item.first()).bandNames();
             e.item = ee.ImageCollection(e.item).reduce(e.viz.reducer).rename(w).copyProperties(e.imageCollection.first())
@@ -1223,35 +1227,35 @@
             if (e.viz.isSelectLayer && (selectedFeaturesJSON[e.name] = {
                     layerName: e.name,
                     filterList: [],
                     geoJSON: new google.maps.Data,
                     id: e.id,
                     rawGeoJSON: {},
                     selection: ee.FeatureCollection([])
-                }, $("#" + s).addClass("select-layer-checkbox"), $(".vector-layer-checkbox").on("turnOffAllSelectLayers", (function() {
-                    f()
+                }, $("#" + n).addClass("select-layer-checkbox"), $(".vector-layer-checkbox").on("turnOffAllSelectLayers", (function() {
+                    v()
                 })), $(".vector-layer-checkbox").on("turnOnAllSelectLayers", (function() {
                     y()
                 })), $(".vector-layer-checkbox").on("turnOffAll", (function() {
-                    f()
+                    v()
                 })), $(".vector-layer-checkbox").on("turnOnAll", (function() {
                     y()
                 }))), e.queryItem = e.item, "geeVectorImage" === e.layerType && (e.item = ee.Image().paint(e.item, null, e.viz.strokeWeight), e.viz.palette = e.viz.strokeColor), e.viz.isSelectLayer)
                 if (void 0 === e.viz.selectLayerNameProperty) e.queryItem.first().propertyNames().evaluate((function(a, t) {
                     void 0 !== t ? S = "system:index" : (a.map((function(e) {
                         -1 !== e.toLowerCase().indexOf("name") && (S = e)
                     })), void 0 === S && (S = "system:index")), selectedFeaturesJSON[e.name].fieldName = S, selectedFeaturesJSON[e.name].eeObject = e.queryItem.select([S], ["name"])
                 }));
                 else selectedFeaturesJSON[e.name].fieldName = e.viz.selectLayerNamePropertyname, selectedFeaturesJSON[e.name].eeObject = e.queryItem.select([e.viz.selectLayerNameProperty], ["name"]);
-            e.viz.isSelectedLayer && ($("#" + s).addClass("selected-layer-checkbox"), $(".vector-layer-checkbox").on("turnOffAllSelectLayers", (function() {
-                f()
+            e.viz.isSelectedLayer && ($("#" + n).addClass("selected-layer-checkbox"), $(".vector-layer-checkbox").on("turnOffAllSelectLayers", (function() {
+                v()
             })), $(".vector-layer-checkbox").on("turnOnAllSelectLayers", (function() {
                 y()
             })), $(".vector-layer-checkbox").on("turnOffAllSelectedLayers", (function() {
-                f()
+                v()
             })), $(".vector-layer-checkbox").on("turnOnAllSelectedLayers", (function() {
                 y()
             })), selectionTracker.seletedFeatureLayerIndices.push(e.layerId))
         }
 
         function C() {
             var a = Object.values(layerObj).filter((function(a) {
@@ -1278,33 +1282,33 @@
                 })), e.usedViz = 0 == r ? {} : e.viz, ee.Image(e.item).getMap(e.usedViz, (function(l, r) {
                     void 0 === l && e.mapServiceTryNumber <= 1 ? (queryObj[t].queryItem = e.item, e.item = e.item.visualize(), o()) : function(t, o) {
                         if (decrementOutstandingGEERequests(), $("#" + i).hide(), e.viz.isTimeLapse) {
                             timeLapseObj[e.viz.timeLapseID].loadingLayerIDs = timeLapseObj[e.viz.timeLapseID].loadingLayerIDs.filter((e => e !== a));
                             var l = parseInt(100 * (1 - timeLapseObj[e.viz.timeLapseID].loadingLayerIDs.length / timeLapseObj[e.viz.timeLapseID].nFrames));
                             $("#" + e.viz.timeLapseID + "-collapse-label").css("background", `-webkit-linear-gradient(left, #FFF, #FFF ${l}%, transparent ${l}%, transparent 100%)`), 0 === timeLapseObj[e.viz.timeLapseID].loadingLayerIDs.length && ($("#" + e.viz.timeLapseID + "-loading-spinner").hide(), $("#" + e.viz.timeLapseID + "-year-label").hide(), $("#" + e.viz.timeLapseID + "-collapse-label").css("background", "-webkit-linear-gradient(left, #FFF, #FFF 0%, transparent 0%, transparent 100%)"), $("#" + e.viz.timeLapseID + "-toggle-checkbox-label").show(), timeLapseObj[e.viz.timeLapseID].isReady = !0)
                         }
-                        if ($("#" + s).show(), e.currentGEERunID === geeRunID)
+                        if ($("#" + n).show(), e.currentGEERunID === geeRunID)
                             if (void 0 === t || void 0 !== o) h(o);
                             else {
                                 const a = t.urlFormat;
                                 e.layer = new google.maps.ImageMapType({
                                     getTileUrl: function(t, o) {
                                         let l = a.replace("{x}", t.x).replace("{y}", t.y).replace("{z}", o);
                                         return e.loading || (e.loading = !0, e.percent = 10, $("#" + i + "2").show(), updateGEETileLayersDownloading(), u(), e.viz.isTimeLapse && C()), l
                                     }
                                 }), e.layer.addListener("tilesloaded", (function() {
                                     e.percent = 100, e.loading = !1, $("#" + i + "2").hide(), updateGEETileLayersDownloading(), u(), e.viz.isTimeLapse && C()
-                                })), e.visible ? (e.map.overlayMapTypes.setAt(e.layerId, e.layer), e.rangeOpacity = e.opacity, e.layer.setOpacity(e.opacity), $("#" + e.legendDivID).show()) : e.rangeOpacity = 0, $("#" + i).hide(), $("#" + s).show(), p()
+                                })), e.visible ? (e.map.overlayMapTypes.setAt(e.layerId, e.layer), e.rangeOpacity = e.opacity, e.layer.setOpacity(e.opacity), $("#" + e.legendDivID).show()) : e.rangeOpacity = 0, $("#" + i).hide(), $("#" + n).show(), p()
                             }
                     }(l, r)
                 })), e.mapServiceTryNumber++
             }()
     } else if ("geeVector" === e.layerType || "geoJSONVector" === e.layerType) {
         function L(a) {
-            $("#" + i).hide(), $("#" + s).show(), e.currentGEERunID === geeRunID && (void 0 === a && h(), e.layer = new google.maps.Data, e.layer.setStyle(e.viz), e.layer.addGeoJson(a), e.viz.clickQuery && (map.addListener("click", (function() {
+            $("#" + i).hide(), $("#" + n).show(), e.currentGEERunID === geeRunID && (void 0 === a && h(), e.layer = new google.maps.Data, e.layer.setStyle(e.viz), e.layer.addGeoJson(a), e.viz.clickQuery && (map.addListener("click", (function() {
                 infowindow.setMap(null)
             })), e.layer.addListener("click", (function(e) {
                 console.log(e), infowindow.setPosition(e.latLng);
                 var a = '<table class="table table-hover bg-white">\n                            <tbody>',
                     t = e.feature.j;
                 Object.keys(t).map((function(e) {
                     var o = t[e];
@@ -1321,24 +1325,24 @@
         }), incrementOutstandingGEERequests(), "geeVector" === e.layerType ? (decrementOutstandingGEERequests(), e.item.evaluate((function(e) {
             L(e)
         }))) : (decrementOutstandingGEERequests(), L(e.item))
     } else if ("tileMapService" === e.layerType) e.layer = new google.maps.ImageMapType({
         getTileUrl: e.item,
         tileSize: new google.maps.Size(256, 256),
         maxZoom: 15
-    }), e.visible ? (e.map.overlayMapTypes.setAt(e.layerId, e.layer), e.rangeOpacity = e.opacity, e.layer.setOpacity(e.opacity)) : e.rangeOpacity = 0, $("#" + i).hide(), $("#" + s).show(), p();
+    }), e.visible ? (e.map.overlayMapTypes.setAt(e.layerId, e.layer), e.rangeOpacity = e.opacity, e.layer.setOpacity(e.opacity)) : e.rangeOpacity = 0, $("#" + i).hide(), $("#" + n).show(), p();
     else if ("dynamicMapService" === e.layerType) {
         function D() {
             null !== e.layer && void 0 !== e.layer && e.layer.setMap(null), e.layer = map.getZoom() > e.item[1].minZoom ? getGroundOverlay(e.item[1].baseURL, e.item[1].minZoom, e.item[1].ending) : getGroundOverlay(e.item[0].baseURL, e.item[0].minZoom, e.item[0].ending), e.visible ? (e.layer.setMap(map), e.percent = 100, u(), groundOverlayOn = !0, $("#" + e.legendDivID).show(), e.layer.setOpacity(e.opacity), e.rangeOpacity = e.opacity) : e.rangeOpacity = 0, p()
         }
         D(), google.maps.event.addListener(map, "zoom_changed", (function() {
             D()
         })), google.maps.event.addListener(map, "dragend", (function() {
             D()
-        })), $("#" + i).hide(), $("#" + s).show(), p()
+        })), $("#" + i).hide(), $("#" + n).show(), p()
     }
     if (e.viz.dashboardSummaryLayer) {
         $(`#${d}`).click((function() {
             e.visible && (Object.keys(e.dashboardSelectedFeatures).map((a => {
                 e.dashboardSelectedFeatures[a].polyList.map((e => e.setMap(null))), delete e.dashboardSelectedFeatures[a]
             })), updateDashboardCharts(), updateDashboardHighlights())
         })), e.dashboardSelectedFeatures = {}, e.dashboardSummaryMode = e.viz.dashboardSummaryMode
@@ -1629,18 +1633,18 @@
 else if ("STORM" === mode) {
     function refineFeatures(e, a) {
         var t = e.slice(0, e.length - 1),
             o = e.slice(1, e.length),
             l = [t[0]];
         return t.forEach((function(e, t) {
             var r = o[t],
-                n = e.geometry.coordinates,
-                s = r.geometry.coordinates,
+                s = e.geometry.coordinates,
+                n = r.geometry.coordinates,
                 i = JSON.parse(JSON.stringify(e));
-            i.geometry.coordinates = [(n[0] + s[0]) / 2, (n[1] + s[1]) / 2], a.map((function(a) {
+            i.geometry.coordinates = [(s[0] + n[0]) / 2, (s[1] + n[1]) / 2], a.map((function(a) {
                 var t = e.properties[a],
                     o = (r.properties[a] + t) / 2;
                 i.properties[a] = o
             })), l.push([i, r])
         })), l = l.flat()
     }
 
@@ -1659,34 +1663,66 @@
                 }));
                 for (var t = refinementIterations, o = a.length; t > 0 && 2 * a.length < 1500;) console.log("Refining"), console.log(refinementIterations), a = refineFeatures(a, ["lat", "lon", "wspd", "pres", "date", "year"]), console.log(a.length), t--;
                 setTimeout((function() {
                     showMessage("Track ingestion finished", "Refined " + (refinementIterations - t).toString() + "/" + refinementIterations.toString() + " iterations.<br>Total number of raw track points is: " + o.toString() + "<br>Total number of refined track points is: " + a.length.toString())
                 }), 1e3);
                 var l = a.slice(0, a.length - 1),
                     r = a.slice(1),
-                    n = ee.List.sequence(0, l.length - 1).getInfo().map((function(e) {
+                    s = ee.List.sequence(0, l.length - 1).getInfo().map((function(e) {
                         var a = {
                             type: "Feature"
                         };
                         return a.geometry = l[e].geometry, a.properties = {}, a.properties.current = l[e].properties, a.properties.future = r[e].properties, a
                     }));
-                $("#summary-spinner").slideUp(), createHurricaneDamageWrapper(ee.FeatureCollection(n))
+                $("#summary-spinner").slideUp(), createHurricaneDamageWrapper(ee.FeatureCollection(s))
             }, e.readAsText(jQuery("#stormTrackUpload")[0].files[0])
         } else $("#summary-spinner").hide(), showMessage("No storm track provided", 'Please download storm track from <a href="https://www.wunderground.com/hurricane" target="_blank">here</a> . Copy and paste the storm track coordinates into a text editor. Save the table. Then upload that table above.')
     }
     canExport = !0, addCollapse("sidebar-left", "parameters-collapse-label", "parameters-collapse-div", "PARAMETERS", '<i role="img" class="fa fa-sliders mr-1" aria-hidden="true"></i>', !0, null, "Adjust parameters used to prepare storm outputs"), $("#parameters-collapse-div").append('\n    <label>Download storm track from <a href="https://www.wunderground.com/hurricane" target="_blank">here</a>. Copy and paste the storm track coordinates into a text editor. Save the table. Then upload that table below. <a href="./geojson/michael.txt" download="michael.txt" >Download test data here.</a></label>\n    <input class = \'file-input my-1\' type="file" id="stormTrackUpload" name="upload"  style="display: inline-block;" title = "Download storm track from https://www.wunderground.com/hurricane">\n    <hr>\n    <label>Provide name for storm (optional):</label>\n    <input title = \'Provide a name for the storm. The name of the provided storm track file will be used if left blank.\'  type="user-selected-area-name" class="form-control" id="storm-name"  placeholder="Name your storm!" style=\'width:80%;\'><hr>'), addRangeSlider("parameters-collapse-div", "Refinement iterations", "refinementIterations", 0, 10, 5, 1, "refinement-factor-slider", "null", "Specify number of iterations to perform a linear interpolation of provided track. A higher number is needed for tracks with fewer real observations"), addRangeSlider("parameters-collapse-div", "Max distance (km)", "maxDistance", 50, 500, 200, 50, "max-distance-slider", "null", "Specify max distance in km from storm track to include in output"), addRangeSlider("parameters-collapse-div", "Min wind (mph)", "minWind", 0, 75, 30, 5, "min-wind-slider", "null", "Specify min wind speed in mph to include in output"), $("#parameters-collapse-div").append('\n        <hr>\n        <label style = \'width:90%\'>The MOD of Rupture is intended to indicate how much force it takes to snap a tree. A single value can be provided by providing a constant image (e.g. ee.Image(1)) and a simple lookup to convert that image to a desired MOD of Rupture (e.g. {1:8500}). If different MOD of Rupture values are needed for different tree types, you can provide an EE image that may have tree classes or land cover classes that can then be cross-walked to a MOD of Rupture image with different values for different tree/land cover classes (e.g. ee.Image( "USGS/NLCD_RELEASES/2016_REL/2016" ).select([ 0 ]) with a lookup of {41:8500,42:2000,43:5000,90:4000}</label>\n        <hr>\n        <label>MOD of Rupture Image</label>\n        <textarea   title = \'Provide an image with relevant land cover/tree classes. Provide a constant raster (ee.Image(1)) if you would like to use a constant\'   class="form-control" id="mod-image"   oninput="auto_grow(this)" style=\'width:90%;\'>ee.Image("USGS/NLCD_RELEASES/2016_REL/2016").select([0])</textarea>\n        <hr>\n        <label>MOD of Rupture Lookup</label>\n        <textarea   title = \'Provide a lookup table to remap each class of the image provided above with a MOD of Rupture value.\'  type="user-selected-area-name" class="form-control" id="mod-lookup" oninput="auto_grow(this)" style=\'width:90%;\'>{41:8500, 42:2000, 43:5000, 90:4000}</textarea>\n       '), $("#parameters-collapse-div").append("<hr>\n      <button class = 'btn' style = 'margin-bottom: 0.5em!important;' onclick = 'ingestStormTrack()' title = 'Click to ingest storm track and map damage'>Ingest Storm Track</button>\n      <button class = 'btn' style = 'margin-bottom: 0.5em!important;' onclick = 'reRun()' title = 'Click to remove existing layers and exports'>Clear All Layers/Exports</button><br>"), addCollapse("sidebar-left", "layer-list-collapse-label", "layer-list-collapse-div", mode + " DATA", "<img style = 'width:1.1em;' class='image-icon mr-1' alt=\"Layers icon\" src=\"images/layer_icon.png\">", !0, null, mode + " DATA layers to view on map"), $("#layer-list-collapse-div").append('<ul id="layer-list" class = "layer-list"></ul>'), addCollapse("sidebar-left", "tools-collapse-label", "tools-collapse-div", "TOOLS", '<i role="img" class="fa fa-gear mr-1" aria-hidden="true"></i>', !1, "", "Tools to measure and chart data provided on the map"), addCollapse("sidebar-left", "download-collapse-label", "download-collapse-div", "DOWNLOAD DATA", '<i role="img" class="fa fa-cloud-download mr-1" aria-hidden="true"></i>', !1, "", "Download " + mode + " products for further analysis")
-} else if ("TreeMap" === mode) addCollapse("sidebar-left", "layer-list-collapse-label", "layer-list-collapse-div", "TreeMap DATA", "<img style = 'width:1.1em;' class='image-icon mr-1' alt=\"Layers icon\" src=\"images/layer_icon.png\">", !0, null, mode + " DATA layers to view on map"), addCollapse("sidebar-left", "tools-collapse-label", "tools-collapse-div", "TOOLS", '<i role="img" class="fa fa-gear mr-1" aria-hidden="true"></i>', !1, "", "Tools to measure and chart data provided on the map"), $("#layer-list-collapse-div").append('<ul id="layer-list" class = "layer-list"></ul>');
+} else if ("TreeMap" === mode) $("head").append('<script type="text/javascript" src="./js/forest-type-palette.js"><\/script>'), addCollapse("sidebar-left", "layer-list-collapse-label", "layer-list-collapse-div", "TreeMap DATA", "<img style = 'width:1.1em;' class='image-icon mr-1' alt=\"Layers icon\" src=\"images/layer_icon.png\">", !0, null, mode + " DATA layers to view on map"), addCollapse("sidebar-left", "tools-collapse-label", "tools-collapse-div", "TOOLS", '<i role="img" class="fa fa-gear mr-1" aria-hidden="true"></i>', !1, "", "Tools to measure and chart data provided on the map"), $("#layer-list-collapse-div").append('<ul id="layer-list" class = "layer-list"></ul>');
 else if ("sequoia-view" === mode) {
-    addCollapse("sidebar-left", "parameters-collapse-label", "parameters-collapse-div", "PARAMETERS", '<i role="img" class="fa fa-sliders mr-1" aria-hidden="true"></i>', !0, null, "Adjust parameters used to prepare storm outputs");
+    addCollapse("sidebar-left", "parameters-collapse-label", "parameters-collapse-div", "PARAMETERS", '<i role="img" class="fa fa-sliders mr-1" aria-hidden="true"></i>', !0, null, "Adjust parameters used to prepare analysis window");
     var minYear = 2017,
         maxYear = (new Date).getFullYear(),
         dayOfYear = (new Date).dayofYear();
-    null != urlParams.preStartYear && null != urlParams.preStartYear || (urlParams.preStartYear = minYear), null != urlParams.preEndYear && null != urlParams.preEndYear || (urlParams.preEndYear = maxYear - 1), null != urlParams.postStartYear && null != urlParams.postStartYear || (urlParams.postStartYear = maxYear), null != urlParams.postEndYear && null != urlParams.postEndYear || (urlParams.postEndYear = maxYear), null != urlParams.startJulian && null != urlParams.startJulian || (urlParams.startJulian = dayOfYear - 16), null != urlParams.endJulian && null != urlParams.endJulian || (urlParams.endJulian = dayOfYear - 2), console.log(maxYear), addDualRangeSlider("parameters-collapse-div", "Choose start year range:", "urlParams.preStartYear", "urlParams.preEndYear", minYear, maxYear - 1, urlParams.preStartYear, urlParams.preEndYear, 1, "pre-years-slider", "null", "Years to include for the past image data"), addDualRangeSlider("parameters-collapse-div", "Choose analysis year range:", "urlParams.postStartYear", "urlParams.postEndYear", minYear, maxYear, urlParams.postStartYear, urlParams.postEndYear, 1, "post-years-slider", "null", "Years to include for the current image data"), addDualRangeSlider("parameters-collapse-div", "Choose analysis date range:", "urlParams.startJulian", "urlParams.endJulian", 1, 365, urlParams.startJulian, urlParams.endJulian, 1, "julian-day-slider", "julian", "Days of year of " + mode + " data to include for land cover, land use, loss, and gain"), addCollapse("sidebar-left", "layer-list-collapse-label", "layer-list-collapse-div", "MAP LAYERS", "<img style = 'width:1.1em;' class='image-icon mr-1' alt=\"Layers icon\" src=\"images/layer_icon.png\">", !0, null, mode + " DATA layers to view on map"), addCollapse("sidebar-left", "table-collapse-label", "table-collapse-div", "MONITORING SITES", '<img class=\'panel-title-svg-lg\'  alt="Graph icon" src="./Icons_svg/graph_ffffff.svg">', !0, "", "Giant Sequoia monitoring sites output table"), addCollapse("sidebar-left", "tools-collapse-label", "tools-collapse-div", "TOOLS", '<i role="img" class="fa fa-gear mr-1" aria-hidden="true"></i>', !1, "", "Tools to measure and chart data provided on the map"), $("#layer-list-collapse-div").append('<ul id="layer-list" class = "layer-list"></ul>'), $("#parameters-collapse-div").append(staticTemplates.reRunButton)
+    null != urlParams.preStartYear && null != urlParams.preStartYear || (urlParams.preStartYear = minYear), null != urlParams.preEndYear && null != urlParams.preEndYear || (urlParams.preEndYear = maxYear - 1), null != urlParams.postYear && null != urlParams.postYear || (urlParams.postYear = maxYear), null != urlParams.startJulian && null != urlParams.startJulian || (urlParams.startJulian = dayOfYear - 16), null != urlParams.endJulian && null != urlParams.endJulian || (urlParams.endJulian = dayOfYear - 2), null != urlParams.compVizParams && null != urlParams.compVizParams || (urlParams.compVizParams = {
+        min: .1,
+        max: [.5, .6, .6],
+        bands: "swir2,nir,red",
+        gamma: 1.6
+    }), null != urlParams.diffVizParams && null != urlParams.diffVizParams || (urlParams.diffVizParams = {
+        min: -.05,
+        max: .05,
+        bands: ["brightness", "greenness", "wetness"]
+    }), null != urlParams.diffThreshs && null != urlParams.diffThreshs || (urlParams.diffThreshs = {
+        greenness: -.05,
+        wetness: -.02,
+        NBR: -.2
+    }), null != urlParams.treeDiameter && null != urlParams.treeDiameter || (urlParams.treeDiameter = 15), null != urlParams.lcmsTreeMaskClasses && null != urlParams.lcmsTreeMaskClasses || (urlParams.lcmsTreeMaskClasses = {
+        Trees: !0,
+        "Shrubs & Trees Mix": !1,
+        "Grass/Forb/Herb & Trees Mix": !1,
+        "Barren & Trees Mix": !1
+    }), addDualRangeSlider("parameters-collapse-div", "Analysis date range:", "urlParams.startJulian", "urlParams.endJulian", 1, 365, urlParams.startJulian, urlParams.endJulian, 1, "julian-day-slider", "julian", "Select a window of dates to filter the analysis (baseline and post-disturbance)."), addDualRangeSlider("parameters-collapse-div", "Baseline year(s):", "urlParams.preStartYear", "urlParams.preEndYear", minYear, maxYear - 1, urlParams.preStartYear, urlParams.preEndYear, 1, "pre-years-slider", "null", "Choose year(s) to calculate reference (pre-change) signal. If more than one year is chosen, the baseline will be the mean signal of the years during the selected date range."), addRangeSlider("parameters-collapse-div", "Target year:", "urlParams.postYear", minYear + 1, maxYear, urlParams.postYear, 1, "post-years-slider", null, "Choose year to compare against Baseline year(s)."), addSubCollapse("parameters-collapse-div", "advanced-params-label", "advanced-params-div", "Advanced Parameters", "", !1, ""), $("#parameters-collapse-div").append("<hr>"), addRangeSlider("advanced-params-div", "Giant Sequoia Canopy Diamater (m)", "urlParams.treeDiameter", 5, 30, urlParams.treeDiameter, 5, "tree-diameter-slider", "null", "Specify the average diameter of a Giant Sequoia crown in meters"), addCheckboxes("advanced-params-div", "lcms-tree-mask-class-checkboxes", "LCMS land cover classes to include as tree to mask out non tree areas from change detection. ", "lcmsTreeMaskClasses", urlParams.lcmsTreeMaskClasses), $("#advanced-params-div").append(`\n  <hr>\n  <label>Difference Bands and Thresholds</label>\n  <textarea   title = 'Bands and thresholds to use for identifying change'   class="form-control" id="diff-bands-thresh-input"   oninput="auto_grow(this)" style='width:90%;'>${JSON.stringify(urlParams.diffThreshs)}</textarea>\n  <hr>\n  \n  <label>Composite Visualization Parameters</label>\n  <textarea   title = 'Viz params for composite images'   class="form-control" id="comp-viz-params-input"   oninput="auto_grow(this)" style='width:90%;'>${JSON.stringify(urlParams.compVizParams)}</textarea>\n  <hr>\n  <label>Difference Visualization Parameters</label>\n  <textarea   title = 'Viz params for difference image'   class="form-control" id="diff-viz-params-input"   oninput="auto_grow(this)" style='width:90%;'>${JSON.stringify(urlParams.diffVizParams)}</textarea>\n \n `), $("#comp-viz-params-input").on("input", (() => {
+        urlParams.compVizParams = JSON.parse($("#comp-viz-params-input").val())
+    })), $("#diff-viz-params-input").on("input", (() => {
+        urlParams.diffVizParams = JSON.parse($("#diff-viz-params-input").val())
+    })), $("#diff-bands-thresh-input").on("input", (() => {
+        urlParams.diffThreshs = JSON.parse($("#diff-bands-thresh-input").val())
+    })), $("#post-years-slider").slider().bind("slide", (function(e, a) {
+        var t = a.value,
+            o = !1;
+        t <= urlParams.preEndYear && (urlParams.preEndYear = t - 1, o = !0), t <= urlParams.preStartYear && (urlParams.preStartYear = t - 1, o = !0), o && ($("#pre-years-slider").slider("values", [urlParams.preStartYear, urlParams.preEndYear]), $("#pre-years-slider-update").html(`${urlParams.preStartYear} - ${urlParams.preEndYear}`))
+    })), $("#pre-years-slider").slider().bind("slide", (function(e, a) {
+        var t = a.values,
+            o = !1;
+        t[0] >= urlParams.postYear && (urlParams.postYear = t[0] + 1, o = !0), t[1] >= urlParams.postYear && (urlParams.postYear = t[1] + 1, o = !0), o && ($("#post-years-slider").slider("value", urlParams.postYear), $("#post-years-slider-update").html(`${urlParams.postYear}`))
+    })), addCollapse("sidebar-left", "layer-list-collapse-label", "layer-list-collapse-div", "MAP LAYERS", "<img style = 'width:1.1em;' class='image-icon mr-1' alt=\"Layers icon\" src=\"images/layer_icon.png\">", !0, null, mode + " DATA layers to view on map"), addCollapse("sidebar-left", "reference-layer-list-collapse-label", "reference-layer-list-collapse-div", "REFERENCE DATA", '<img class=\'panel-title-svg-lg\'  alt="Layers icon" src="./Icons_svg/data-layers_ffffff.svg">', !1, null, "Additional relevant layers to view on map intended to provide context for change data"), $("#reference-layer-list-collapse-div").append('<ul id="reference-layer-list" class = "layer-list"></ul>'), addCollapse("sidebar-left", "table-collapse-label", "table-collapse-div", "MONITORING SITES", '<img class=\'panel-title-svg-lg\'  alt="Graph icon" src="./Icons_svg/graph_ffffff.svg">', !0, "", "Giant Sequoia monitoring sites output table"), addCollapse("sidebar-left", "tools-collapse-label", "tools-collapse-div", "TOOLS", '<i role="img" class="fa fa-gear mr-1" aria-hidden="true"></i>', !1, "", "Tools to measure and chart data provided on the map"), $("#layer-list-collapse-div").append('<ul id="layer-list" class = "layer-list"></ul>'), $("#parameters-collapse-div").append(staticTemplates.reRunButton)
 } else addCollapse("sidebar-left", "layer-list-collapse-label", "layer-list-collapse-div", "ANCILLARY DATA", "<img style = 'width:1.1em;' class='image-icon mr-1' alt=\"Layers icon\" src=\"images/layer_icon.png\">", !0, null, mode + " DATA layers to view on map"), addCollapse("sidebar-left", "reference-layer-list-collapse-label", "reference-layer-list-collapse-div", "PLOT DATA", "<img style = 'width:1.1em;' class='image-icon mr-1' alt=\"Layers icon\" src=\"images/layer_icon.png\">", !1, null, "Additional relevant layers to view on map intended to provide context for " + mode + " DATA"), addCollapse("sidebar-left", "tools-collapse-label", "tools-collapse-div", "TOOLS", '<i role="img" class="fa fa-gear mr-1" aria-hidden="true"></i>', !1, "", "Tools to measure and chart data provided on the map"), $("#layer-list-collapse-div").append('<ul id="layer-list" class = "layer-list"></ul>'), $("#reference-layer-list-collapse-div").append('<ul id="reference-layer-list" class = "layer-list"></ul>'), plotsOn = !0;
-if ($("body").append("<div class = 'legendDiv flexcroll col-sm-5 col-md-3 col-lg-3 col-xl-2 p-0 m-0' id = 'legendDiv'></div>"), $(".legendDiv").css("bottom", $(".bottombar").height()), $(".sidebar").css("max-height", $("body").height() - $(".bottombar").height()), addLegendCollapse(), addAccordianContainer("tools-collapse-div", "tools-accordian"), $("#tools-accordian").append("<h5 class = 'pt-2' style = 'border-top: 0.0em solid black;'>Measuring Tools</h5>"), addSubAccordianCard("tools-accordian", "measure-distance-label", "measure-distance-div", "Distance Measuring", staticTemplates.distanceDiv, !1, "toggleTool(toolFunctions.measuring.distance)", staticTemplates.distanceTipHover), addSubAccordianCard("tools-accordian", "measure-area-label", "measure-area-div", "Area Measuring", staticTemplates.areaDiv, !1, "toggleTool(toolFunctions.measuring.area)", staticTemplates.areaTipHover), addRadio("measure-distance-div", "metricOrImperialDistance-radio", "", "Imperial", "Metric", "metricOrImperialDistance", "imperial", "metric", "updateDistance()", "updateDistance()", "Toggle between imperial or metric units"), addRadio("measure-area-div", "metricOrImperialArea-radio", "", "Imperial", "Metric", "metricOrImperialArea", "imperial", "metric", "updateArea()", "updateArea()", "Toggle between imperial or metric units"), addShapeEditToolbar("measure-distance-div", "measure-distance-div-icon-bar", "undoDistanceMeasuring()", "resetPolyline()"), addColorPicker("measure-distance-div-icon-bar", "distance-color-picker", "updateDistanceColor", distancePolylineOptions.strokeColor), addShapeEditToolbar("measure-area-div", "measure-area-div-icon-bar", "undoAreaMeasuring()", "resetPolys()"), addColorPicker("measure-area-div-icon-bar", "area-color-picker", "updateAreaColor", areaPolygonOptions.strokeColor), $("#tools-accordian").append("<h5 class = 'pt-2' style = 'border-top: 0.1em solid black;'>Pixel Tools</h5>"), addSubAccordianCard("tools-accordian", "query-label", "query-div", "Query Visible Map Layers", staticTemplates.queryDiv, !1, "toggleTool(toolFunctions.pixel.query)", staticTemplates.queryTipHover), -1 === ["Bloom-Mapper", "TreeMap"].indexOf(mode) && (addSubAccordianCard("tools-accordian", "pixel-chart-label", "pixel-chart-div", "Query " + mode + " Time Series", staticTemplates.pixelChartDiv, !1, "toggleTool(toolFunctions.pixel.chart)", staticTemplates.pixelChartTipHover), addDropdown("pixel-chart-div", "pixel-collection-dropdown", "Choose which " + mode + " time series to chart", "whichPixelChartCollection", "Choose which " + mode + " time series to chart.")), "geeViz" === mode) {
+if ($("body").append("<div class = 'legendDiv flexcroll col-sm-5 col-md-3 col-lg-3 col-xl-2 p-0 m-0' id = 'legendDiv'></div>"), $(".legendDiv").css("bottom", "1rem"), $(".sidebar").css("max-height", $("body").height() - $(".bottombar").height()), addLegendCollapse(), addAccordianContainer("tools-collapse-div", "tools-accordian"), $("#tools-accordian").append("<h5 class = 'pt-2' style = 'border-top: 0.0em solid black;'>Measuring Tools</h5>"), addSubAccordianCard("tools-accordian", "measure-distance-label", "measure-distance-div", "Distance Measuring", staticTemplates.distanceDiv, !1, "toggleTool(toolFunctions.measuring.distance)", staticTemplates.distanceTipHover), addSubAccordianCard("tools-accordian", "measure-area-label", "measure-area-div", "Area Measuring", staticTemplates.areaDiv, !1, "toggleTool(toolFunctions.measuring.area)", staticTemplates.areaTipHover), addRadio("measure-distance-div", "metricOrImperialDistance-radio", "", "Imperial", "Metric", "metricOrImperialDistance", "imperial", "metric", "updateDistance()", "updateDistance()", "Toggle between imperial or metric units"), addRadio("measure-area-div", "metricOrImperialArea-radio", "", "Imperial", "Metric", "metricOrImperialArea", "imperial", "metric", "updateArea()", "updateArea()", "Toggle between imperial or metric units"), addShapeEditToolbar("measure-distance-div", "measure-distance-div-icon-bar", "undoDistanceMeasuring()", "resetPolyline()"), addColorPicker("measure-distance-div-icon-bar", "distance-color-picker", "updateDistanceColor", distancePolylineOptions.strokeColor), addShapeEditToolbar("measure-area-div", "measure-area-div-icon-bar", "undoAreaMeasuring()", "resetPolys()"), addColorPicker("measure-area-div-icon-bar", "area-color-picker", "updateAreaColor", areaPolygonOptions.strokeColor), $("#tools-accordian").append("<h5 class = 'pt-2' style = 'border-top: 0.1em solid black;'>Pixel Tools</h5>"), addSubAccordianCard("tools-accordian", "query-label", "query-div", "Query Visible Map Layers", staticTemplates.queryDiv, !1, "toggleTool(toolFunctions.pixel.query)", staticTemplates.queryTipHover), -1 === ["Bloom-Mapper", "TreeMap", "sequoia-view"].indexOf(mode) && (addSubAccordianCard("tools-accordian", "pixel-chart-label", "pixel-chart-div", "Query " + mode + " Time Series", staticTemplates.pixelChartDiv, !1, "toggleTool(toolFunctions.pixel.chart)", staticTemplates.pixelChartTipHover), addDropdown("pixel-chart-div", "pixel-collection-dropdown", "Choose which " + mode + " time series to chart", "whichPixelChartCollection", "Choose which " + mode + " time series to chart.")), "geeViz" === mode) {
     $("#pixel-chart-label").remove(), $("#share-button").remove(), $("#tools-accordian").append("<hr>");
     var tShowToolTipModal = !0;
     null !== localStorage.showToolTipModal && void 0 !== localStorage.showToolTipModal && (tShowToolTipModal = localStorage.showToolTipModal), addRadio("tools-accordian", "tooltip-radio", "Show tool tips", "Yes", "No", "localStorage.showToolTipModal", "true", "false", "", "", "Whether to show tool tips to help explain how to use the tools."), "false" === tShowToolTipModal && $("#tooltip-radio-second_toggle_label").click()
 }
 if ("LAMDA" === mode && $("#pixel-chart-label").remove(), "LCMS-pilot" === mode || "MTBS" === mode || "lcms-base-learner" === mode || "IDS" === mode || "LCMS" === mode) {
     if ($("#tools-accordian").append("<h5 class = 'pt-2' style = 'border-top: 0.1em solid black;'>Area Tools</h5>"), addSubCollapse("tools-accordian", "area-chart-params-label", "area-chart-params-div", "Area Tools Parameters", "", !1, ""), $("#area-chart-params-label").prop("title", "Click here to select which LCMS products to chart, and change which area units are used. "), addDropdown("area-chart-params-div", "area-collection-dropdown", "Choose which " + mode + " product to summarize", "whichAreaChartCollection", "Choose which " + mode + " time series to summarize."), $("#parameters-collapse-div").append("<hr>"), addMultiRadio("area-chart-params-div", "area-summary-format", "Area Units", "areaChartFormat", {
             Percentage: !0,
@@ -1699,34 +1735,34 @@
             $("#area-collection-dropdown").val().indexOf("-transition") > -1 ? $("#transition-periods-container").show() : $("#transition-periods-container").hide()
         }))
     }
     $("#area-summary-format").prop("title", "Choose how to summarize area- as a percentage of the area, acres, or hectares."), addSubAccordianCard("tools-accordian", "user-defined-area-chart-label", "user-defined-area-chart-div", "User-Defined Area", staticTemplates.userDefinedAreaChartDiv, !1, "toggleTool(toolFunctions.area.userDefined)", staticTemplates.userDefinedAreaChartTipHover), addSubAccordianCard("tools-accordian", "upload-area-chart-label", "upload-area-chart-div", "Upload an Area", staticTemplates.uploadAreaChartDiv, !1, "toggleTool(toolFunctions.area.shpDefined)", staticTemplates.uploadAreaChartTipHover), addSubAccordianCard("tools-accordian", "select-area-interactive-chart-label", "select-area-interactive-chart-div", "Select an Area on Map", staticTemplates.selectAreaInteractiveChartDiv, !1, "toggleTool(toolFunctions.area.selectInteractive)", staticTemplates.selectAreaInteractiveChartTipHover), addRangeSlider("upload-reduction-factor-container", "Vertex Reduction Factor", "uploadReductionFactor", 1, 5, 1, 1, "upload-reduction-factor-slider", "null", "Every n vertex in uploaded file will be kept for polygons > 100 vertices (E.g. if 3 is chosen, every third vertex remains). This is intended to help enable use of uploaded areas that may have failed due to its size."), addRangeSlider("simplify-error-range-container", "Simplify Area - Max Error", "simplifyMaxError", 0, 500, 0, 50, "simplify-error-slider", "null", "If the selected area is very large and/or has a lot of vertices, it may not compute. In this instance, clear out any existing selections (trash can button below), and increase this value. The selected polygon will be simplified using a max error in meters equal to this value upon selection. Generally between 50 and 150 will get most areas to work."), addShapeEditToolbar("user-defined-edit-toolbar", "user-defined-area-icon-bar", "undoUserDefinedAreaCharting()", "restartUserDefinedAreaCarting()"), addColorPicker("user-defined-area-icon-bar", "user-defined-color-picker", "updateUDPColor", udpOptions.strokeColor), addShapeEditToolbar("select-features-edit-toolbar", "select-area-interactive-chart-icon-bar", "removeLastSelectArea()", "clearSelectedAreas()", "Click to unselect most recently selected polyogn", "Click to clear all selected polygons"), $("#tools-accordian").append("<hr>");
     var tShowToolTipModal = !0;
     null !== localStorage.showToolTipModal && void 0 !== localStorage.showToolTipModal && (tShowToolTipModal = localStorage.showToolTipModal), addRadio("tools-accordian", "tooltip-radio", "Show tool tips", "Yes", "No", "localStorage.showToolTipModal", "true", "false", "", "", "Whether to show tool tips to help explain how to use the tools."), "false" === tShowToolTipModal && $("#tooltip-radio-second_toggle_label").click()
 }
-if ("MTBS" !== mode && "Ancillary" !== mode || ($("#contributor-logos").prepend('<a href="https://www.usgs.gov/" target="_blank" >\n                                    <img src="images/usgslogo.png" class = \'image-icon-bar\' alt="USGS logo" title="Click to learn more about the US Geological Survey">\n                                  </a>'), $("#contributor-logos").prepend('<a href="https://www.mtbs.gov/" target="_blank" >\n                                    <img src="images/mtbs-logo-large.png" class = \'image-icon-bar\' alt="MTBS logo" title="Click to learn more about MTBS">\n                                  </a>')), canExport) {
+if ("sequoia-view" === mode && ($("#tools-accordian").append("<h5 class = 'pt-2' style = 'border-top: 0.1em solid black;'>Area Tools</h5>"), addSubAccordianCard("tools-accordian", "upload-area-chart-label", "upload-area-chart-div", "Upload an Area", staticTemplates.uploadShpToMapLayerDiv, !1, "toggleTool(toolFunctions.area.shpDefined)", staticTemplates.uploadAreaChartTipHover)), "MTBS" !== mode && "Ancillary" !== mode || ($("#contributor-logos").prepend('<a href="https://www.usgs.gov/" target="_blank" >\n                                    <img src="images/usgslogo.png" class = \'image-icon-bar\' alt="USGS logo" title="Click to learn more about the US Geological Survey">\n                                  </a>'), $("#contributor-logos").prepend('<a href="https://www.mtbs.gov/" target="_blank" >\n                                    <img src="images/mtbs-logo-large.png" class = \'image-icon-bar\' alt="MTBS logo" title="Click to learn more about MTBS">\n                                  </a>')), canExport) {
     function cacheCRS() {
         localStorage.export_crs = $("#export-crs").val()
     }
     $("#download-collapse-div").append(staticTemplates.exportContainer), void 0 !== localStorage.export_crs && null !== localStorage.export_crs && localStorage.export_crs.indexOf("EPSG") > -1 ? $("#export-crs").val(localStorage.export_crs) : localStorage.export_crs = $("#export-crs").val(), "STORM" === mode && ($("#export-area-drawing-div").append("<hr>\n                                            <button class = 'btn' onclick = 'addTrackBounds()' title = 'Add bounds of storm track for export area.'><i class=\"pr-1 fa fa-square-o\" aria-hidden=\"true\"></i> Use storm track bound as area to download</button>\n                                            "), $("#export-button-div").append("<hr>"), addRangeSlider("export-button-div", "Quick look spatial resolution", "quickLookRes", 1200, 6e3, 3e3, 300, "quick-look-res-slider", "null", "Specify spatial resolution for quick look downloads."), $("#export-button-div").append("<button class = 'btn' onclick = 'downloadQuickLooks()'  title = 'Quickly download outputs at coarse resolution'><i class=\"pr-1 fa fa-cloud-download\" aria-hidden=\"true\"></i>Download Quick Look Outputs</button>\n                                            "))
 }
 
 function resizeViewerPanes() {
-    "lcms-dashboard" !== mode && (moveCollapse("chart-collapse"), moveCollapse("legend-collapse")), $(".legendDiv").css("bottom", $(".bottombar").height()), $(".legendDiv").css("max-height", window.innerHeight - $(".bottombar").height()), $(".sidebar").css("max-height", $("body").height() - $(".bottombar").height()), walkThroughAdded && moveCollapse("walk-through-collapse")
+    "lcms-dashboard" !== mode && (moveCollapse("chart-collapse"), moveCollapse("legend-collapse")), $(".legendDiv").css("bottom", "1rem"), $(".legendDiv").css("max-height", window.innerHeight - convertRemToPixels(1) + 1), $(".sidebar").css("max-height", $("body").height() - $(".bottombar").height()), walkThroughAdded && moveCollapse("walk-through-collapse")
 }
 
 function resizeDashboardPanes() {
     let e = $("#layer-list-collapse-label-layer-list-collapse-div").width(),
         a = $(".bottombar").height(),
         t = $("#dashboard-results-container").height(),
         o = $("#sidebar-left-container").height(),
         l = $("#dashboard-results-expander").height(),
         r = $(".dashboard-highlights").width(),
-        n = $(".dashboard-highlights").height();
-    $("#sidebar-left-container").css("max-height", window.innerHeight - a), o + a + t + l < window.innerHeight ? ($("#dashboard-results-container").css("left", 0), n < window.innerHeight - t - l ? $("#dashboard-results-container").css("max-width", window.innerWidth) : $("#dashboard-results-container").css("max-width", window.innerWidth - r)) : ($("#dashboard-results-container").css("left", e), n < window.innerHeight - t - l ? ($("#dashboard-results-container").css("max-width", window.innerWidth - e), $(".dashboard-highlights").css("height")) : $("#dashboard-results-container").css("max-width", window.innerWidth - e - r)), $("#dashboard-results-container").css("bottom", a + l - 1), $(".dashboard-highlights").css("max-height", window.innerHeight - a)
+        s = $(".dashboard-highlights").height();
+    $("#sidebar-left-container").css("max-height", window.innerHeight - a), o + a + t + l < window.innerHeight ? ($("#dashboard-results-container").css("left", 0), s < window.innerHeight - t - l ? $("#dashboard-results-container").css("max-width", window.innerWidth) : $("#dashboard-results-container").css("max-width", window.innerWidth - r)) : ($("#dashboard-results-container").css("left", e), s < window.innerHeight - t - l ? ($("#dashboard-results-container").css("max-width", window.innerWidth - e), $(".dashboard-highlights").css("height")) : $("#dashboard-results-container").css("max-width", window.innerWidth - e - r)), $("#dashboard-results-container").css("bottom", a + l - 1), $(".dashboard-highlights").css("max-height", window.innerHeight - a)
 }
 if ("lcms-dashboard" === mode) {
     var dashboardScrollLeft = 0;
 
     function addExpander() {
         var e = {
             setDragID: a => e.id = a,
@@ -1809,16 +1845,16 @@
 }
 
 function llToNAD83(e, a) {
     var t = [e, a],
         o = 6378136.98,
         l = o * Math.PI * 2,
         r = l / 360,
-        n = Math.PI / 180;
-    return t[0] *= r, (a = t[1]) > 86 ? t[1] = l : a < -86 ? t[1] = -l : (a *= n, a = Math.log(Math.tan(a) + 1 / Math.cos(a), Math.E), t[1] = a * o), {
+        s = Math.PI / 180;
+    return t[0] *= r, (a = t[1]) > 86 ? t[1] = l : a < -86 ? t[1] = -l : (a *= s, a = Math.log(Math.tan(a) + 1 / Math.cos(a), Math.E), t[1] = a * o), {
         x: t[0],
         y: t[1]
     }
 }
 var toObj = (e, a) => e.reduce(((e, t, o) => (e[t] = a[o], e)), {}),
     toDict = toObj;
 
@@ -1835,16 +1871,16 @@
         return e[a]
     }))
 }
 
 function tileXYZToQuadKey(e, a, t) {
     for (var o = "", l = t; l > 0; l--) {
         var r = 0,
-            n = 1 << l - 1;
-        0 != (e & n) && (r += 1), 0 != (a & n) && (r += 2), o += r.toString()
+            s = 1 << l - 1;
+        0 != (e & s) && (r += 1), 0 != (a & s) && (r += 2), o += r.toString()
     }
     return o
 }
 
 function centerMap(e, a, t) {
     map.setCenter({
         lat: a,
@@ -1949,16 +1985,16 @@
 }
 
 function setPlotProjectColor(e) {
     for (var a = document.getElementsByTagName("ee-pt-project"), t = 0; t < a.length; t++) a[t].style.outline = "none";
     a[a.length - e].style.outline = "#FFF dotted"
 }
 
-function addSelectLayerToMap(e, a, t, o, l, r, n, s, i) {
-    a.canQuery = !1, a.isSelectLayer = !0, addToMap(e, a, t, o, l, r, n, "area-charting-select-layer-list", i)
+function addSelectLayerToMap(e, a, t, o, l, r, s, n, i) {
+    a.canQuery = !1, a.isSelectLayer = !0, addToMap(e, a, t, o, l, r, s, "area-charting-select-layer-list", i)
 }
 var intervalPeriod = 666.6666666666666,
     timeLapseID, timeLapseFrame = 0,
     cumulativeMode = !1,
     lastJitter;
 
 function pauseTimeLapse(e) {
@@ -2131,52 +2167,52 @@
 
 function fillEmptyCollections(e, a) {
     var t = ee.ImageCollection([a.mask(ee.Image(0))]),
         o = e.toList(1).length();
     return ee.ImageCollection(ee.Algorithms.If(o.gt(0), e, t))
 }
 
-function addTimeLapseToMap(e, a, t, o, l, r, n, s, i) {
+function addTimeLapseToMap(e, a, t, o, l, r, s, n, i) {
     null != a && null !== a.serialized && void 0 !== a.serialized && !0 === a.serialized && (e = ee.Deserializer.decode(e), a.serialized = !1), null !== a.cumulativeMode && void 0 !== a.cumulativeMode || (a.cumulativeMode = !1);
     o = !1;
-    void 0 !== a.opacity && null !== a.opacity || (a.opacity = 1), e = ee.ImageCollection(e);
+    void 0 !== a.opacity && null !== a.opacity || (a.opacity = 1), e = ee.ImageCollection(e), null != t && null != t || (t = "Layer " + NEXT_LAYER_ID);
     var d = "";
     var c = t.replaceAll(" ", "-") + "-" + NEXT_LAYER_ID.toString();
-    c = c.replace(/[^A-Za-z0-9]/g, "-"), a.autoViz && (dicts = getLookupDicts(ee.Image(e.first()), null, "eeImage"), a.classLegendDict = dicts.classLegendDict, a.queryDict = dicts.queryDict, a.autoViz = !1), a.canQuery = !1, a.isSelectLayer = !1, a.isTimeLapse = !0, a.timeLapseID = c, a.layerType = "geeImage", null !== a.dateFormat && void 0 !== a.dateFormat || (a.dateFormat = "YYYY", a.advanceInterval = "year"), null !== a.dateField && void 0 !== a.dateField || (a.dateField = "system:time_start"), timeLapseObj[c] = {}, null == s && (s = "layer-list"), null !== a.years && void 0 !== a.years || (console.log("start computing years"), a.years = unique(e.sort(a.dateField, !0).toList(1e4, 0).map((function(e) {
+    c = c.replace(/[^A-Za-z0-9]/g, "-"), a.autoViz && (dicts = getLookupDicts(ee.Image(e.first()), null, "eeImage"), a.classLegendDict = dicts.classLegendDict, a.queryDict = dicts.queryDict, a.autoViz = !1), a.canQuery = !1, a.isSelectLayer = !1, a.isTimeLapse = !0, a.timeLapseID = c, a.layerType = "geeImage", null !== a.dateFormat && void 0 !== a.dateFormat || (a.dateFormat = "YYYY", a.advanceInterval = "year"), null !== a.dateField && void 0 !== a.dateField || (a.dateField = "system:time_start"), timeLapseObj[c] = {}, null == n && (n = "layer-list"), null !== a.years && void 0 !== a.years || (console.log("start computing years"), a.years = unique(e.sort(a.dateField, !0).toList(1e4, 0).map((function(e) {
         var t = ee.Date(ee.Image(e).get(a.dateField));
         return ee.Number.parse(t.format(a.dateFormat)).int32()
     })).getInfo()), console.log("done computing years"), console.log(a.years));
     var p = a.years[0],
         u = a.years[a.years.length - 1];
     timeLapseObj[c].years = a.years, timeLapseObj[c].frames = ee.List.sequence(0, a.years.length - 1).getInfo(), timeLapseObj[c].nFrames = a.years.length, timeLapseObj[c].loadingLayerIDs = [], timeLapseObj[c].loadingTilesLayerIDs = [], timeLapseObj[c].layerVisibleIDs = [], timeLapseObj[c].sliders = [], timeLapseObj[c].intervalValue = null, timeLapseObj[c].isReady = !1, timeLapseObj[c].visible = o, timeLapseObj[c].state = "inactive", timeLapseObj[c].opacity = 100 * a.opacity, queryObj[c] = {
         visible: timeLapseObj[c].visible,
         queryItem: e,
         queryDict: a.queryDict,
         type: "geeImageCollection",
         name: t
     };
-    $("#" + s).append(`\n                                <li   title = 'Time lapse layers load multiple map layers throughout time. Once loaded, you can play the time lapse as an animation, or advance through single years using the buttons and sliders provided.  The layers can be displayed as a single year or as a cumulative mosaic of all preceding years using the right-most button.' id = '${c}-collapse-label' class = 'layer-container'>\n                                  <div class = 'time-lapse-layer-range-container' >\n                                    <div title = 'Opacity' id='${c}-opacity-slider' class = 'simple-time-lapse-layer-range-first'>\n                                      <div id='${c}-opacity-slider-handle' class=" time-lapse-slider-handle ui-slider-handle">\n                                        <div style = 'display:none;' id='${c}-opacity-slider-handle-label' class = 'time-lapse-slider-handle-label'>${timeLapseObj[c].opacity/100}</div>\n                                      </div>\n                                    </div>\n                                    <div id='${c}-time-lapse-layer-range-container' style = 'display:none;'>\n                                      <div title = 'Frame Date' id='${c}-year-slider' class = 'simple-time-lapse-layer-range'>\n                                        <div id='${c}-year-slider-handle' class=" time-lapse-slider-handle ui-slider-handle">\n                                          <div id='${c}-year-slider-handle-label' class = 'time-lapse-slider-handle-label'>${a.years[0]}</div>\n                                        </div>\n                                      </div>\n                                    \n                                      <div title = 'Frame Rate' id='${c}-speed-slider' class = 'simple-time-lapse-layer-range'>\n                                        <div id='${c}-speed-slider-handle' class=" time-lapse-slider-handle ui-slider-handle">\n                                          <div id='${c}-speed-slider-handle-label' class = 'time-lapse-slider-handle-label'>${(1/(intervalPeriod/1e3)).toFixed(1)}fps</div>\n                                        </div>\n                                      </div>\n                                    </div>\n                                  </div>\n                                  <input  id="${c}-toggle-checkbox" onchange = 'timeLapseCheckbox("${c}")' type="checkbox" ${d}/>\n                                  <label  title = 'Activate/deactivate time lapse' id="${c}-toggle-checkbox-label" style = 'margin-bottom:0px;display:none;'  for="${c}-toggle-checkbox"></label>\n                                  <i style = 'display:none;' id = '${c}-loading-gear' title = '${t} time lapse tiles loading' class="text-dark fa fa-gear fa-spin layer-spinner"></i>\n                                  <i id = '${c}-loading-spinner' title = '${t} time lapse layers loading' class="text-dark fa fa-spinner fa-spin layer-spinner"></i>\n\n                                  <span  id = '${c}-name-span'  class = 'layer-span'>${t}</span>\n\n                                  <div id = "${c}-icon-bar" class = 'icon-bar pl-4 pt-3' style = 'display:none;'>\n                                    <button class = 'btn' title = 'Back one frame' id = '${c}-backward-button' onclick = 'backOneFrame("${c}")'><i class="fa fa-backward fa-xs"></i></button>\n                                    <button class = 'btn' title = 'Pause animation' id = '${c}-pause-button' onclick = 'pauseButtonFunction("${c}")'><i class="fa fa-pause"></i></button>\n                                    <button style = 'display:none;' class = 'btn time-lapse-active' title = 'Clear animation' id = '${c}-stop-button' onclick = 'stopTimeLapse("${c}")'><i class="fa fa-stop"></i></button>\n                                    <button class = 'btn' title = 'Play animation' id = '${c}-play-button'  onclick = 'playTimeLapse("${c}")'><i class="fa fa-play"></i></button>\n                                    <button class = 'btn' title = 'Forward one frame' id = '${c}-forward-button' onclick = 'forwardOneFrame("${c}")'><i class="fa fa-forward"></i></button>\n                                    <button style = '' class = 'btn' title = 'Refresh layers if tiles failed to load' id = '${c}-refresh-tiles-button' onclick = 'jitterZoom(true)'><i class="fa fa-refresh"></i></button>\n                                    <button style = 'display:none;' class = 'btn' title = 'Toggle frame visiblity' id = '${c}-toggle-frames-button' onclick = 'toggleFrames("${c}")'><i class="fa fa-eye"></i></button>\n                                    <button class = 'btn cumulativeToggler' onclick = 'toggleCumulativeMode()' title = 'Click to toggle whether to show a single year or all years in the past along with current year'><img style = 'width:1.4em;filter: invert(100%) brightness(500%)'  src="images/cumulative_icon.png"></button>\n                                    <div id = "${c}-message-div" class = 'pt-2'></div>\n                                  </div>\n\n                                </li>\n                                \n                                <div id = '${c}-collapse-div' style = 'display:none;'></div>`), $("#time-lapse-legend-list").append(`<div id="legend-${c}-collapse-div"></div>`), onclick = 'timeLapseCheckbox("${legendDivID}")';
+    $("#" + n).append(`\n                                <li   title = 'Time lapse layers load multiple map layers throughout time. Once loaded, you can play the time lapse as an animation, or advance through single years using the buttons and sliders provided.  The layers can be displayed as a single year or as a cumulative mosaic of all preceding years using the right-most button.' id = '${c}-collapse-label' class = 'layer-container'>\n                                  <div class = 'time-lapse-layer-range-container' >\n                                    <div title = 'Opacity' id='${c}-opacity-slider' class = 'simple-time-lapse-layer-range-first'>\n                                      <div id='${c}-opacity-slider-handle' class=" time-lapse-slider-handle ui-slider-handle">\n                                        <div style = 'display:none;' id='${c}-opacity-slider-handle-label' class = 'time-lapse-slider-handle-label'>${timeLapseObj[c].opacity/100}</div>\n                                      </div>\n                                    </div>\n                                    <div id='${c}-time-lapse-layer-range-container' style = 'display:none;'>\n                                      <div title = 'Frame Date' id='${c}-year-slider' class = 'simple-time-lapse-layer-range'>\n                                        <div id='${c}-year-slider-handle' class=" time-lapse-slider-handle ui-slider-handle">\n                                          <div id='${c}-year-slider-handle-label' class = 'time-lapse-slider-handle-label'>${a.years[0]}</div>\n                                        </div>\n                                      </div>\n                                    \n                                      <div title = 'Frame Rate' id='${c}-speed-slider' class = 'simple-time-lapse-layer-range'>\n                                        <div id='${c}-speed-slider-handle' class=" time-lapse-slider-handle ui-slider-handle">\n                                          <div id='${c}-speed-slider-handle-label' class = 'time-lapse-slider-handle-label'>${(1/(intervalPeriod/1e3)).toFixed(1)}fps</div>\n                                        </div>\n                                      </div>\n                                    </div>\n                                  </div>\n                                  <input  id="${c}-toggle-checkbox" onchange = 'timeLapseCheckbox("${c}")' type="checkbox" ${d}/>\n                                  <label  title = 'Activate/deactivate time lapse' id="${c}-toggle-checkbox-label" style = 'margin-bottom:0px;display:none;'  for="${c}-toggle-checkbox"></label>\n                                  <i style = 'display:none;' id = '${c}-loading-gear' title = '${t} time lapse tiles loading' class="text-dark fa fa-gear fa-spin layer-spinner"></i>\n                                  <i id = '${c}-loading-spinner' title = '${t} time lapse layers loading' class="text-dark fa fa-spinner fa-spin layer-spinner"></i>\n\n                                  <span  id = '${c}-name-span'  class = 'layer-span'>${t}</span>\n\n                                  <div id = "${c}-icon-bar" class = 'icon-bar pl-4 pt-3' style = 'display:none;'>\n                                    <button class = 'btn' title = 'Back one frame' id = '${c}-backward-button' onclick = 'backOneFrame("${c}")'><i class="fa fa-backward fa-xs"></i></button>\n                                    <button class = 'btn' title = 'Pause animation' id = '${c}-pause-button' onclick = 'pauseButtonFunction("${c}")'><i class="fa fa-pause"></i></button>\n                                    <button style = 'display:none;' class = 'btn time-lapse-active' title = 'Clear animation' id = '${c}-stop-button' onclick = 'stopTimeLapse("${c}")'><i class="fa fa-stop"></i></button>\n                                    <button class = 'btn' title = 'Play animation' id = '${c}-play-button'  onclick = 'playTimeLapse("${c}")'><i class="fa fa-play"></i></button>\n                                    <button class = 'btn' title = 'Forward one frame' id = '${c}-forward-button' onclick = 'forwardOneFrame("${c}")'><i class="fa fa-forward"></i></button>\n                                    <button style = '' class = 'btn' title = 'Refresh layers if tiles failed to load' id = '${c}-refresh-tiles-button' onclick = 'jitterZoom(true)'><i class="fa fa-refresh"></i></button>\n                                    <button style = 'display:none;' class = 'btn' title = 'Toggle frame visiblity' id = '${c}-toggle-frames-button' onclick = 'toggleFrames("${c}")'><i class="fa fa-eye"></i></button>\n                                    <button class = 'btn cumulativeToggler' onclick = 'toggleCumulativeMode()' title = 'Click to toggle whether to show a single year or all years in the past along with current year'><img style = 'width:1.4em;filter: invert(100%) brightness(500%)'  src="images/cumulative_icon.png"></button>\n                                    <div id = "${c}-message-div" class = 'pt-2'></div>\n                                  </div>\n\n                                </li>\n                                \n                                <div id = '${c}-collapse-div' style = 'display:none;'></div>`), $("#time-lapse-legend-list").append(`<div id="legend-${c}-collapse-div"></div>`), onclick = 'timeLapseCheckbox("${legendDivID}")';
     if ($("#" + c + "-name-span").click((function() {
             setTimeout((function() {
                 timeLapseCheckbox(c)
             }), 200)
-        })), a.layerType = "geeImage", a.legendTitle = t, a.opacity = 0, "tileMapService" === a.timeLapseType) a.layerType = "tileMapService", a.years.map((function(s) {
-        s !== a.years[0] && (a.addToLegend = !1, a.addToClassLegend = !1);
+        })), a.layerType = "geeImage", a.legendTitle = t, a.opacity = 0, "tileMapService" === a.timeLapseType) a.layerType = "tileMapService", a.years.map((function(n) {
+        n !== a.years[0] && (a.addToLegend = !1, a.addToClassLegend = !1);
         var d = Object.assign({}, a);
-        d.year = s, addToMap(standardTileURLFunction(e + s.toString() + "/", !0, ""), d, t + " " + s.toString(), o, l, r, n, c + "-collapse-div", i)
+        d.year = n, addToMap(standardTileURLFunction(e + n.toString() + "/", !0, ""), d, t + " " + n.toString(), o, l, r, s, c + "-collapse-div", i)
     }));
     else {
         var m = ee.Image(e.first());
-        a.years.map((function(s) {
-            var d = ee.Date.parse(a.dateFormat, s.toString()),
+        a.years.map((function(n) {
+            var d = ee.Date.parse(a.dateFormat, n.toString()),
                 p = fillEmptyCollections(e.filterDate(d, d.advance(1, a.advanceInterval)), m);
             p = ee.Image(p.first()).set("system:time_start", d.millis());
-            s !== a.years[0] && (a.addToLegend = !1, a.addToClassLegend = !1, a.classLegendDict = null);
+            n !== a.years[0] && (a.addToLegend = !1, a.addToClassLegend = !1, a.classLegendDict = null);
             var u = Object.assign({}, a);
-            u.year = s, addToMap(p, u, t + " " + s.toString(), o, l, r, n, c + "-collapse-div", i)
+            u.year = n, addToMap(p, u, t + " " + n.toString(), o, l, r, s, c + "-collapse-div", i)
         }))
     }
     "tileMapService" === a.timeLapseType && (timeLapseObj[c].isReady = !0, $("#" + c + "-toggle-checkbox-label").show(), $("#" + c + "-loading-spinner").hide()), timeLapseObj[c].sliders = timeLapseObj[c].sliders, $("#" + c + "-opacity-slider").slider({
         min: 0,
         max: 1,
         step: .05,
         value: timeLapseObj[c].opacity / 100,
@@ -2211,31 +2247,31 @@
                 $("#" + e + "-speed-slider").slider().slider("option", "value", a.value), $("#" + e + "-speed-slider-handle-label").text(`${a.value.toFixed(1)}fps`)
             })), timeLapseObj[c].isReady && setSpeed(c, t)
         }
     })
 }
 
 function addExport(e, a, t, o, l, r) {
-    var n = {};
+    var s = {};
     null == l && (l = {}), null == o && (o = !0), null == r && (r = -32768);
-    var s = "";
-    o && (s = "checked");
+    var n = "";
+    o && (n = "checked");
     var i = Date().split(" ");
     i[2], i[1], i[3], i[4];
-    a = a.replace(/[^A-Za-z0-9]/g, "_"), n.res = t, n.name = a, n.eeImage = e, n.Export = o, n.ID = exportID, exportImageDict[exportID] = {
+    a = a.replace(/[^A-Za-z0-9]/g, "_"), s.res = t, s.name = a, s.eeImage = e, s.Export = o, s.ID = exportID, exportImageDict[exportID] = {
         eeImage: e,
         name: a,
         res: t,
         shouldExport: o,
         metadataParams: l,
         noDataValue: r
-    }, $("#export-list").append(`<div class = 'input-group'>\n                              <span  class="input-group-addon">\n                                <input  id = '${a}-checkbox-${exportID}' type="checkbox" ${s} >\n                                <label  style = 'margin-bottom:0px;'  for='${a}-checkbox-${exportID}'></label>\n                              </span>\n                              \n                              <input  id = '${a}-name-${exportID}' class="form-control export-name-input" type="text" value="${n.name}" title = 'Change export name if needed'>\n                            </div>`), $("#" + a + "-name-" + exportID.toString()).on("input", (function() {
-        exportImageDict[n.ID].name = $(this).val()
+    }, $("#export-list").append(`<div class = 'input-group'>\n                              <span  class="input-group-addon">\n                                <input  id = '${a}-checkbox-${exportID}' type="checkbox" ${n} >\n                                <label  style = 'margin-bottom:0px;'  for='${a}-checkbox-${exportID}'></label>\n                              </span>\n                              \n                              <input  id = '${a}-name-${exportID}' class="form-control export-name-input" type="text" value="${s.name}" title = 'Change export name if needed'>\n                            </div>`), $("#" + a + "-name-" + exportID.toString()).on("input", (function() {
+        exportImageDict[s.ID].name = $(this).val()
     })), $("#" + a + "-checkbox-" + exportID.toString()).on("change", (function() {
-        exportImageDict[n.ID].shouldExport = this.checked
+        exportImageDict[s.ID].shouldExport = this.checked
     })), exportID++
 }
 
 function getLookupDicts(e, a, t) {
     return "geeImageCollection" == t && (e = ee.Image(e.first())), null == a && (a = ee.Image(e).bandNames().getInfo()[0]), values = ee.List([e.get(a + "_class_values"), e.get(a + "_class_names"), e.get(a + "_class_palette")]).getInfo(), value_name = zip(values[0], values[1]).map((function(e) {
         return e.join("- ")
     })), legendDict = toObj(value_name, values[2]), queryDict = toObj(values[0], value_name), {
@@ -2247,191 +2283,191 @@
     Image: "geeImage",
     ImageCollection: "geeImageCollection",
     Feature: "geeVectorImage",
     FeatureCollection: "geeVectorImage",
     Geometry: "geeVectorImage"
 };
 
-function addToMap(e, a, t, o, l, r, n, s, i) {
+function addToMap(e, a, t, o, l, r, s, n, i) {
     null != a && null !== a.serialized && void 0 !== a.serialized && !0 === a.serialized && (e = ee.Deserializer.decode(e));
     var d = geeRunID;
-    if (null == s && (s = "layer-list"), null == a && (a = {}), null == t && (t = "Layer " + NEXT_LAYER_ID), null === a.layerType || void 0 === a.layerType) {
+    if (null == n && (n = "layer-list"), null == a && (a = {}), null == t && (t = "Layer " + NEXT_LAYER_ID), null === a.layerType || void 0 === a.layerType) {
         var c = ee.Algorithms.ObjectType(e).getInfo();
         "Feature" === c && (e = ee.FeatureCollection([e]), c = ee.Algorithms.ObjectType(e).getInfo()), a.layerType = typeLookup[c]
     }
     "geoJSONVector" === a.layerType && (a.canQuery = !1), "geeVector" === a.layerType || "geoJSONVector" === a.layerType ? (void 0 !== a.strokeOpacity && null !== a.strokeOpacity || (a.strokeOpacity = 1), void 0 !== a.fillOpacity && null !== a.fillOpacity || (a.fillOpacity = .2), void 0 !== a.fillColor && null !== a.fillColor || (a.fillColor = "222222"), void 0 !== a.strokeColor && null !== a.strokeColor || (a.strokeColor = getColor()), void 0 !== a.strokeWeight && null !== a.strokeWeight || (a.strokeWeight = 3), a.opacityRatio = a.strokeOpacity / a.fillOpacity, -1 == a.fillColor.indexOf("#") && (a.fillColor = "#" + a.fillColor), -1 == a.strokeColor.indexOf("#") && (a.strokeColor = "#" + a.strokeColor), void 0 !== a.addToClassLegend && null !== a.addToClassLegend || (a.addToClassLegend = !0)) : "geeVectorImage" === a.layerType && (void 0 !== a.strokeOpacity && null !== a.strokeOpacity || (a.strokeOpacity = 1), a.fillOpacity = 0, void 0 !== a.fillColor && null !== a.fillColor || (a.fillColor = "222222"), void 0 !== a.strokeColor && null !== a.strokeColor || (a.strokeColor = getColor()), void 0 !== a.strokeWeight && null !== a.strokeWeight || (a.strokeWeight = 2), -1 == a.fillColor.indexOf("#") && (a.fillColor = "#" + a.fillColor), -1 == a.strokeColor.indexOf("#") && (a.strokeColor = "#" + a.strokeColor), void 0 !== a.addToClassLegend && null !== a.addToClassLegend || (a.addToClassLegend = !0, a.addToLegend = !1));
     var p = t.replaceAll(" ", "-") + "-" + NEXT_LAYER_ID.toString();
-    p = p.replace(/[^A-Za-z0-9]/g, "-"), null == o && (o = !0), null == a.opacity && (a.opacity = 1), -1 != Object.keys(layerObj).indexOf(p) && (o = layerObj[p].visible, a.opacity = layerObj[p].opacity, "geeVector" !== a.layerType && "geoJSONVector" !== a.layerType || (a.strokeOpacity = layerObj[p].opacity, a.fillOpacity = a.strokeOpacity / a.opacityRatio)), null != n && void 0 !== n || (n = ""), null !== a.title && void 0 !== a.title && (n = a.title);
+    p = p.replace(/[^A-Za-z0-9]/g, "-"), null == o && (o = !0), null == a.opacity && (a.opacity = 1), void 0 !== a.bands && "string" == typeof a.bands && (a.bands = a.bands.split(",")), -1 != Object.keys(layerObj).indexOf(p) && (o = layerObj[p].visible, a.opacity = layerObj[p].opacity, "geeVector" !== a.layerType && "geoJSONVector" !== a.layerType || (a.strokeOpacity = layerObj[p].opacity, a.fillOpacity = a.strokeOpacity / a.opacityRatio)), null != s && void 0 !== s || (s = ""), null !== a.title && void 0 !== a.title && (s = a.title);
     var u = {};
-    if (u.ID = NEXT_LAYER_ID, NEXT_LAYER_ID += 1, u.layerChildID = layerChildID, layerChildID++, u.name = t, u.opacity = a.opacity, a.opacity = 1, u.map = map, u.helpBoxMessage = n, u.visible = o, u.label = l, u.fontColor = r, u.helpBox = n, u.legendDivID = p, null == i && (i = e), null !== a.canQuery && void 0 !== a.canQuery || (a.canQuery = !0), u.canQuery = a.canQuery, u.queryItem = i, u.layerType = a.layerType, a.autoViz && (dicts = getLookupDicts(e, null, a.layerType), a.classLegendDict = dicts.classLegendDict, a.queryDict = dicts.queryDict), null == a || null != a.bands && 1 != a.bands.split(",").length || 0 == a.addToLegend || void 0 !== a.addToClassLegend && null !== a.addToClassLegend && !1 !== a.addToClassLegend || null != a.classLegendDict && null != a.classLegendDict) {
+    if (u.ID = NEXT_LAYER_ID, NEXT_LAYER_ID += 1, u.layerChildID = layerChildID, layerChildID++, u.name = t, u.opacity = a.opacity, a.opacity = 1, u.map = map, u.helpBoxMessage = s, u.visible = o, u.label = l, u.fontColor = r, u.helpBox = s, u.legendDivID = p, null == i && (i = e), null !== a.canQuery && void 0 !== a.canQuery || (a.canQuery = !0), u.canQuery = a.canQuery, u.queryItem = i, u.layerType = a.layerType, a.autoViz && (dicts = getLookupDicts(e, null, a.layerType), a.classLegendDict = dicts.classLegendDict, a.queryDict = dicts.queryDict), null == a || null != a.bands && 1 != a.bands.length || 0 == a.addToLegend || void 0 !== a.addToClassLegend && null !== a.addToClassLegend && !1 !== a.addToClassLegend || null != a.classLegendDict && null != a.classLegendDict) {
         if (null != a && (void 0 !== a.classLegendDict && null !== a.classLegendDict || !0 === a.addToClassLegend)) {
-            addLegendContainer(p, "legend-" + s, !1, n);
+            addLegendContainer(p, "legend-" + n, !1, s);
             var m, h = p + "-class-container";
             if (m = null !== a.legendTitle && void 0 !== a.legendTitle ? a.legendTitle : t, addClassLegendContainer(h, p, m), "geeVector" !== a.layerType && "geoJSONVector" !== a.layerType && "geeVectorImage" !== a.layerType) {
                 Object.keys(a.classLegendDict).map((function(e) {
                     var o = {};
-                    o.name = t, o.helpBoxMessage = n, o.classColor = a.classLegendDict[e], o.classStrokeColor = "999", o.classStrokeWeight = 1, o.className = e, addClassLegendEntry(h, o)
+                    o.name = t, o.helpBoxMessage = s, o.classColor = a.classLegendDict[e], o.classStrokeColor = "999", o.classStrokeWeight = 1, o.className = e, addClassLegendEntry(h, o)
                 }))
             } else {
-                (y = {}).name = t, y.helpBoxMessage = n;
+                (y = {}).name = t, y.helpBoxMessage = s;
                 var g = a.strokeColor.slice(1),
-                    v = a.fillColor.slice(1);
+                    f = a.fillColor.slice(1);
                 3 === g.length && (g = g.split("").map((function(e) {
                     return e + e
-                })).join().replaceAll(",", "")), 3 === v.length && (v = v.split("").map((function(e) {
+                })).join().replaceAll(",", "")), 3 === f.length && (f = f.split("").map((function(e) {
                     return e + e
-                })).join().replaceAll(",", "")), y.classColor = v + Math.floor(a.fillOpacity / 2 * 255).toString(16), y.classStrokeColor = g + Math.floor(255 * a.strokeOpacity).toString(16), y.classStrokeWeight = a.strokeWeight + 1, y.className = "", addClassLegendEntry(h, y)
+                })).join().replaceAll(",", "")), y.classColor = f + Math.floor(a.fillOpacity / 2 * 255).toString(16), y.classStrokeColor = g + Math.floor(255 * a.strokeOpacity).toString(16), y.classStrokeWeight = a.strokeWeight + 1, y.className = "", addClassLegendEntry(h, y)
             }
-            var f = {};
-            f.name = t, f.helpBoxMessage = n
+            var v = {};
+            v.name = t, v.helpBoxMessage = s
         }
     } else {
-        addLegendContainer(p, "legend-" + s, !1, n);
+        addLegendContainer(p, "legend-" + n, !1, s);
         var y = {};
-        if (null !== a.legendTitle && void 0 !== a.legendTitle ? y.name = a.legendTitle : y.name = t, y.helpBoxMessage = n, null != a.palette) var b = a.palette;
+        if (null !== a.legendTitle && void 0 !== a.legendTitle ? y.name = a.legendTitle : y.name = t, y.helpBoxMessage = s, null != a.palette) var b = a.palette;
         else b = "000,FFF";
         var w = b;
         "string" == typeof b && (w = w.split(",")), 1 == w.length && (w = [w[0], w[0]]), w = w.map((function(e) {
             return e.indexOf("#") > -1 && (e = e.slice(1)), e
         }));
         var S = createColorRamp("colorRamp" + colorRampIndex.toString(), w, 180, 20);
         y.colorRamp = S;
         let e = a.min,
             o = a.max;
         a.legendNumbersWithCommas && (e = e.numberWithCommas(), o = o.numberWithCommas()), null != l && null != a.min ? y.min = e + " " + l : null != l && null == a.min ? y.min = minLabel : null == l && null != a.min && (y.min = e), null != l && null != a.max ? y.max = o + " " + l : null != l && null == a.max ? y.max = maxLabel : null == l && null != a.max && (y.max = o), null !== a.legendLabelLeft && void 0 !== a.legendLabelLeft && (y.min = a.legendLabelLeft + " " + e), null !== a.legendLabelRight && void 0 !== a.legendLabelRight && (y.max = a.legendLabelRight + " " + o), null !== a.legendLabelLeftAfter && void 0 !== a.legendLabelLeftAfter && (y.min = e + " " + a.legendLabelLeftAfter), null !== a.legendLabelRightAfter && void 0 !== a.legendLabelRightAfter && (y.max = o + " " + a.legendLabelRightAfter), null == y.min && (y.min = "min"), null == y.max && (y.max = "max"), y.fontColor = null != r ? "color:#" + r + ";" : "color:#DDD;", addColorRampLegendEntry(p, y)
     }
-    u.visible = o, u.item = e, u.name = t, u.viz = a, u.whichLayerList = s, u.layerId = layerCount, u.currentGEERunID = d, addLayer(u), layerCount++
+    u.visible = o, u.item = e, u.name = t, u.viz = a, u.whichLayerList = n, u.layerId = layerCount, u.currentGEERunID = d, addLayer(u), layerCount++
 }
 
 function standardTileURLFunction(e, a, t, o) {
     return null == a && (a = !1), o = null == o ? "" : "?token=" + o, null == t && (t = ".png"),
         function(l, r) {
-            var n = 1 << r,
-                s = l.x % n;
-            return console.log(l, r, s), s < 0 && (s = n + s), a ? e + r + "/" + s + "/" + l.y + t + o : e + r + "/" + l.y + "/" + s + t + o
+            var s = 1 << r,
+                n = l.x % s;
+            return console.log(l, r, n), n < 0 && (n = s + n), a ? e + r + "/" + n + "/" + l.y + t + o : e + r + "/" + l.y + "/" + n + t + o
         }
 }
 
 function superSimpleTileURLFunction(e) {
     return function(a, t) {
         return e + t + "/" + a.y + "/" + a.x
     }
 }
 
 function addRESTToMap(e, a, t, o, l, r) {
-    var n = ee.Image();
+    var s = ee.Image();
     null == r && (r = "layer-list"), null == a && (a = "Layer " + NEXT_LAYER_ID), null == t && (t = !0), null == o && (o = 18), null == l && (l = "");
-    var s = document.createElement("REST-layer");
-    s.tileURLFunction = e, s.ID = NEXT_LAYER_ID, NEXT_LAYER_ID += 1, s.layerChildID = layerChildID, layerChildID++, s.name = a, s.map = map, s.helpBoxMessage = l, s.visible = t, s.helpBox = l, s.maxZoom = o, s.visible = t, s.item = n, s.name = a;
+    var n = document.createElement("REST-layer");
+    n.tileURLFunction = e, n.ID = NEXT_LAYER_ID, NEXT_LAYER_ID += 1, n.layerChildID = layerChildID, layerChildID++, n.name = a, n.map = map, n.helpBoxMessage = l, n.visible = t, n.helpBox = l, n.maxZoom = o, n.visible = t, n.item = s, n.name = a;
     var i = document.querySelector(r);
-    i.insertBefore(s, i.firstChild), layerCount++, n.getMap({}, (function(e) {
-        s.setLayer(e)
+    i.insertBefore(n, i.firstChild), layerCount++, s.getMap({}, (function(e) {
+        n.setLayer(e)
     }))
 }
 
 function point2LatLng(e, a) {
     var t;
     try {
         var o = document.getElementById("map");
         e -= o.offsetLeft, a -= o.offsetTop;
         var l = map.getProjection().fromLatLngToPoint(map.getBounds().getNorthEast()),
             r = map.getProjection().fromLatLngToPoint(map.getBounds().getSouthWest()),
-            n = Math.pow(2, map.getZoom()),
-            s = new google.maps.Point(e / n + r.x, a / n + l.y);
-        t = map.getProjection().fromPointToLatLng(s)
+            s = Math.pow(2, map.getZoom()),
+            n = new google.maps.Point(e / s + r.x, a / s + l.y);
+        t = map.getProjection().fromPointToLatLng(n)
     } catch (e) {
         t = null
     }
     return t
 }
 
 function getGroundOverlay(e, a, t) {
     if (map.getZoom() >= a) {
         null == t && (t = "");
         var o = $("#map").height(),
             l = $("#map").width(),
             r = map.getBounds(),
-            n = Object.keys(r),
-            s = Object.keys(r[n[0]]),
-            i = Object.keys(r[n[1]]);
-        eeBoundsPoly = ee.Geometry.Rectangle([r[n[1]][s[0]], r[n[0]][i[0]], r[n[1]][s[1]], r[n[0]][i[1]]]);
-        var d = r[n[1]][s[0]],
-            c = r[n[1]][s[1]],
-            p = [d, r[n[0]][i[0]]],
-            u = [c, r[n[0]][i[1]]],
+            s = Object.keys(r),
+            n = Object.keys(r[s[0]]),
+            i = Object.keys(r[s[1]]);
+        eeBoundsPoly = ee.Geometry.Rectangle([r[s[1]][n[0]], r[s[0]][i[0]], r[s[1]][n[1]], r[s[0]][i[1]]]);
+        var d = r[s[1]][n[0]],
+            c = r[s[1]][n[1]],
+            p = [d, r[s[0]][i[0]]],
+            u = [c, r[s[0]][i[1]]],
             m = llToNAD83(p[0], p[1]),
             h = llToNAD83(u[0], u[1]),
             g = e + m.x.toString() + "%2C" + h.y.toString() + "%2C" + h.x.toString() + "%2C" + m.y.toString() + "&bboxSR=102100&imageSR=102100&size=" + l.toString() + "%2C" + o.toString() + "&f=image" + t;
         return overlay = new google.maps.GroundOverlay(g, r), overlay
     }
     return g = "../images/blank.png", overlay = new google.maps.GroundOverlay(g, map.getBounds()), overlay
 }
 
-function addDynamicToMap(e, a, t, o, l, r, n, s, i, d) {
+function addDynamicToMap(e, a, t, o, l, r, s, n, i, d) {
     null == d && (d = "layer-list");
     var c = ee.Image();
-    null == n && (n = "Layer " + NEXT_LAYER_ID), null == s && (s = !0), null == i && (i = "");
+    null == s && (s = "Layer " + NEXT_LAYER_ID), null == n && (n = !0), null == i && (i = "");
     var p = document.createElement("dynamic-layer");
-    p.ID = NEXT_LAYER_ID, NEXT_LAYER_ID += 1, p.layerChildID = layerChildID, layerChildID++, p.name = n, p.map = map, p.helpBoxMessage = i, p.visible = s, p.groundOverlayFunction = function() {
+    p.ID = NEXT_LAYER_ID, NEXT_LAYER_ID += 1, p.layerChildID = layerChildID, layerChildID++, p.name = s, p.map = map, p.helpBoxMessage = i, p.visible = n, p.groundOverlayFunction = function() {
         return map.getZoom() > r ? getGroundOverlay(a, r, t) : getGroundOverlay(e, l, o)
-    }, p.helpBox = i, p.visible = s, p.item = c, p.name = n;
+    }, p.helpBox = i, p.visible = n, p.item = c, p.name = s;
     var u = document.querySelector(d);
     u.insertBefore(p, u.firstChild), layerCount++, p.startUp()
 }
 
-function addFeatureToMap(e, a, t, o, l, r, n, s, i) {
+function addFeatureToMap(e, a, t, o, l, r, s, n, i) {
     console.log("adding feature: " + t), e.evaluate((function(e) {
         var a = new google.maps.Data({
             fillOpacity: 0,
             strokeColor: "#F00"
         });
         a.addGeoJson(e), a.setMap(map)
     }))
 }
 var featureViewObj = {};
 
-function addFeatureView(e, a, t, o, l, r, n) {
+function addFeatureView(e, a, t, o, l, r, s) {
     ee.data.getFeatureViewTilesKey({
         assetId: e,
         visParams: a
     }, (function(e) {
         console.log(e);
         var a = "https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/featureViews/" + e.token + "/tiles/";
         tileURLFunction = function(e, t) {
             return a + t + "/" + e.x + "/" + e.y
         }, addToMap(tileURLFunction, {
             layerType: "tileMapService"
         }, t, o)
     }));
-    var s = t.replaceAll(" ", "-") + "-" + NEXT_LAYER_ID.toString();
-    s = s.replace(/[^A-Za-z0-9]/g, "-"), NEXT_LAYER_ID++, featureViewObj[s] = {
+    var n = t.replaceAll(" ", "-") + "-" + NEXT_LAYER_ID.toString();
+    n = n.replace(/[^A-Za-z0-9]/g, "-"), NEXT_LAYER_ID++, featureViewObj[n] = {
         name: t,
         assetId: e
     }
 }
 
 function mp() {
-    this.addLayer = function(e, a, t, o, l, r, n, s, i) {
-        addToMap(e, a, t, o, l, r, n, s, i)
-    }, this.addSerializedLayer = function(e, a, t, o, l, r, n, s, i) {
-        a.serialized = !0, addToMap(e, a, t, o, l, r, n, s, i)
-    }, this.addSelectLayer = function(e, a, t, o, l, r, n, s, i) {
-        addSelectLayerToMap(e, a, t, o, l, r, n, s, i)
-    }, this.addTimeLapse = function(e, a, t, o, l, r, n, s, i) {
-        addTimeLapseToMap(e, a, t, o, l, r, n, s, i)
-    }, this.addSerializedTimeLapse = function(e, a, t, o, l, r, n, s, i) {
-        a.serialized = !0, addTimeLapseToMap(e, a, t, o, l, r, n, s, i)
+    this.addLayer = function(e, a, t, o, l, r, s, n, i) {
+        addToMap(e, a, t, o, l, r, s, n, i)
+    }, this.addSerializedLayer = function(e, a, t, o, l, r, s, n, i) {
+        a.serialized = !0, addToMap(e, a, t, o, l, r, s, n, i)
+    }, this.addSelectLayer = function(e, a, t, o, l, r, s, n, i) {
+        addSelectLayerToMap(e, a, t, o, l, r, s, n, i)
+    }, this.addTimeLapse = function(e, a, t, o, l, r, s, n, i) {
+        addTimeLapseToMap(e, a, t, o, l, r, s, n, i)
+    }, this.addSerializedTimeLapse = function(e, a, t, o, l, r, s, n, i) {
+        a.serialized = !0, addTimeLapseToMap(e, a, t, o, l, r, s, n, i)
     }, this.addREST = function(e, a, t, o, l, r) {
         addRESTToMap(e, a, t, o, l, r)
-    }, this.addExport = function(e, a, t, o, l, r, n, s) {
-        addExport(e, a, t, o, l, r, n, s)
+    }, this.addExport = function(e, a, t, o, l, r, s, n) {
+        addExport(e, a, t, o, l, r, s, n)
     }, this.addPlot = function(e) {
         addPlot(e)
-    }, this.addFeatureView = function(e, a, t, o, l, r, n) {
-        addFeatureView(e, a, t, o, l, r, n)
+    }, this.addFeatureView = function(e, a, t, o, l, r, s) {
+        addFeatureView(e, a, t, o, l, r, s)
     }, this.centerObject = function(e) {
         centerObject(e)
     }
 }
 var Map2 = new mp;
 
 function sleep(e) {
@@ -2477,15 +2513,15 @@
 
 function mulberry32(e) {
     return function() {
         var a = e += 1831565813;
         return a = Math.imul(a ^ a >>> 15, 1 | a), (((a ^= a + Math.imul(a ^ a >>> 7, 61 | a)) ^ a >>> 14) >>> 0) / 4294967296
     }
 }
-"false" === urlParams.addLayer && Object.keys(Map2).filter((e => e.indexOf("add") > -1)).map((e => {
+"false" !== urlParams.addLayer && !1 !== urlParams.addLayer || Object.keys(Map2).filter((e => e.indexOf("add") > -1)).map((e => {
     Map2[e] = function() {}
 }));
 var randomN = mulberry32(1);
 
 function getRandomInt(e, a) {
     return Math.floor(randomN() * (a - e + 1)) + e
 }
@@ -2552,16 +2588,16 @@
     var t = !1;
     "#" == e[0] && (e = e.slice(1), t = !0);
     var o = parseInt(e, 16),
         l = (o >> 16) + a;
     l > 255 ? l = 255 : l < 0 && (l = 0);
     var r = (o >> 8 & 255) + a;
     r > 255 ? r = 255 : r < 0 && (r = 0);
-    var n = (255 & o) + a;
-    return n > 255 ? n = 255 : n < 0 && (n = 0), (t ? "#" : "") + (n | r << 8 | l << 16).toString(16)
+    var s = (255 & o) + a;
+    return s > 255 ? s = 255 : s < 0 && (s = 0), (t ? "#" : "") + (s | r << 8 | l << 16).toString(16)
 }
 
 function startArea() {
     !1 === polyOn && (polyOn = !0), areaPolygonOptions.polyNumber = polyNumber, map.setOptions({
         draggableCursor: "crosshair"
     }), map.setOptions({
         disableDoubleClickZoom: !0
@@ -2569,25 +2605,25 @@
         var e, a, t = Object.keys(areaPolygonObj),
             o = 0,
             l = 0;
         t.map((function(t) {
             var r = areaPolygonObj[t].getPath().getArray();
             if (r.length > 0) {
                 clickCoords = clickLngLat, console.log(clickCoords), console.log(r), area = google.maps.geometry.spherical.computeArea(areaPolygonObj[t].getPath());
-                var n = unitNameDict[metricOrImperialArea].area,
-                    s = unitMultiplierDict[metricOrImperialArea].area;
-                area > 0 && l++, (o += area) >= 1e3 ? (e = n[1], a = s[1]) : (e = n[0], a = s[0]), console.log(n), console.log(s), console.log(area), console.log(o), console.log(e), console.log(a)
+                var s = unitNameDict[metricOrImperialArea].area,
+                    n = unitMultiplierDict[metricOrImperialArea].area;
+                area > 0 && l++, (o += area) >= 1e3 ? (e = s[1], a = n[1]) : (e = s[0], a = n[0]), console.log(s), console.log(n), console.log(area), console.log(o), console.log(e), console.log(a)
             }
         }));
         var r = o / 9;
         o = (o *= a).formatNumber();
-        var n = "polygon";
-        t.length > 1 && (n = "polygons");
-        var s = l.toString() + " " + n + " <br>" + o + " " + e;
-        "Ancillary" === mode && (s += "<br>" + r.formatNumber() + " % pixel"), infowindow.setContent(s), infowindow.setPosition(clickCoords), infowindow.open(map), $(".gm-ui-hover-effect").hide()
+        var s = "polygon";
+        t.length > 1 && (s = "polygons");
+        var n = l.toString() + " " + s + " <br>" + o + " " + e;
+        "Ancillary" === mode && (n += "<br>" + r.formatNumber() + " % pixel"), infowindow.setContent(n), infowindow.setPosition(clickCoords), infowindow.open(map), $(".gm-ui-hover-effect").hide()
     }, startListening()
 }
 
 function setToPolygon(e) {
     null != e && null != e || (e = polyNumber), console.log("Setting " + e.toString() + " to polygon"), areaPolygonOptions.strokeColor = areaPolygonObj[e].strokeColor;
     var a = areaPolygonObj[e].getPath();
     areaPolygonObj[e].setMap(null), areaPolygonObj[e] = new google.maps.Polygon(areaPolygonOptions), areaPolygonObj[e].setPath(a), areaPolygonObj[e].setMap(map)
@@ -2930,117 +2966,127 @@
     "undefined" != typeof Storage && (cachedStudyAreaName = localStorage.getItem("cachedStudyAreaName"), null !== urlParams.studyAreaName && void 0 !== urlParams.studyAreaName ? cachedStudyAreaName = decodeURIComponent(urlParams.studyAreaName) : null == cachedStudyAreaName && (cachedStudyAreaName = defaultStudyArea), studyAreaName = studyAreaDict[cachedStudyAreaName].name, longStudyAreaName = cachedStudyAreaName, $("#study-area-label").text(longStudyAreaName), $("#study-area-label").fitText(1.8), 1 == studyAreaSpecificPage && (cachedSettingskey = studyAreaName + "-settings"), o = JSON.parse(localStorage.getItem(cachedSettingskey)), layerObj = null), null != o && null != o.center && null != o.zoom && (a = o.center, t = o.zoom), null === layerObj && (layerObj = {}), void 0 !== urlParams.lng && null !== urlParams.lng && void 0 !== urlParams.lat && null !== urlParams.lat ? (print("Setting center from URL"), e.center = {
         lng: parseFloat(urlParams.lng),
         lat: parseFloat(urlParams.lat)
     }) : e.center = a, void 0 !== urlParams.zoom && null !== urlParams.zoom ? (print("Setting zoom from URL"), e.zoom = parseInt(urlParams.zoom)) : e.zoom = t, urlParams.lng = e.center.lng, urlParams.lat = e.center.lat, urlParams.zoom = e.zoom, map = new google.maps.Map(document.getElementById("map"), e);
     var l = map.getStreetView();
 
     function r(e, a, t, o) {
-        $(".legendDiv").css("bottom", $(".bottombar").height()), $("#current-mouse-position").html("Lng: " + e + ", Lat: " + a + ", " + o + " Zoom: " + t + ", 1:" + zoomDict[t])
+        $("#current-mouse-position").html("Lng: " + e + ", Lat: " + a + ", " + o + " Zoom: " + t + ", 1:" + zoomDict[t])
     }
     google.maps.event.addListener(l, "visible_changed", (function() {
         l.getVisible() ? (console.log("street view in use"), $("#sidebar-left-container").hide(), $(".sidebar-toggler").hide(), $("#legendDiv").hide(), $("#bottombar").hide(), $("#dashboard-results-container").hide(), $("#dashboard-highlights-container").hide()) : (console.log("street view not in use"), $("#sidebar-left-container").show(), $(".sidebar-toggler").show(), $("#legendDiv").show(), $("#bottombar").show(), $("#dashboard-results-container").show(), $("#dashboard-highlights-container").show())
     })), marker = new google.maps.Circle({
         center: {
             lat: 45,
             lng: -111
         },
         radius: 5
     }), infowindow = getInfoWindow(), queryGeoJSON = new google.maps.Data, queryGeoJSON.setMap(map), queryGeoJSON.setStyle({
         strokeColor: "#FF0"
     }), initSearchBox(), placeholderID = 1;
-    var n = 0,
-        s = 0;
+    var s = 0,
+        n = 0;
 
     function i(e) {
         mouseLat = e.lat().toFixed(4).toString(), mouseLng = e.lng().toFixed(4).toString();
         try {
             ee.Image("USGS/SRTMGL1_003").reduceRegion(ee.Reducer.first(), ee.Geometry.Point([e.lng(), e.lat()])).get("elevation").evaluate((function(e) {
                 if (null !== e) {
                     var a = parseInt(3.28084 * e);
-                    n = "Elevation: " + e.toString() + "(m), " + a.toString() + "(ft),"
+                    s = "Elevation: " + e.toString() + "(m), " + a.toString() + "(ft),"
                 } else {
                     a = "NA";
-                    n = "Elevation: NA,"
+                    s = "Elevation: NA,"
                 }
-                r(mouseLng, mouseLat, t, n)
+                r(mouseLng, mouseLat, t, s)
             }))
         } catch (e) {
-            r(mouseLng, mouseLat, t, n = "Elevation: NA,")
+            r(mouseLng, mouseLat, t, s = "Elevation: NA,")
         }
     }
     map.addListener("mousemove", (function(e) {
         var a = e.latLng;
         if (null !== a) {
             var t = map.getZoom();
             mouseLat = a.lat().toFixed(4).toString(), mouseLng = a.lng().toFixed(4).toString();
             var o = (new Date).getTime();
-            o - s > 1e3 ? (i(a), s = o) : r(mouseLng, mouseLat, t, n)
+            o - n > 1e3 ? (i(a), n = o) : r(mouseLng, mouseLat, t, s)
         }
     })), google.maps.event.addListener(map, "maptypeid_changed", (function() {
         console.log("map type id changed"), urlParams.mapTypeId = map.mapTypeId, "satellite" === map.mapTypeId ? removeLabelOverlay() : addLabelOverlay()
     })), google.maps.event.addListener(map, "idle", (function() {
         t = map.getZoom();
         var e = map.getCenter(),
             a = e.lng(),
             o = e.lat();
         urlParams.lng = a, urlParams.lat = o, urlParams.zoom = t, trackView();
         var l = map.getBounds(),
-            s = Object.keys(l),
-            i = Object.keys(l[s[0]]),
-            d = Object.keys(l[s[1]]);
-        r(mouseLng, mouseLat, t, n);
+            n = Object.keys(l),
+            i = Object.keys(l[n[0]]),
+            d = Object.keys(l[n[1]]);
+        r(mouseLng, mouseLat, t, s);
         try {
-            eeBoundsPoly = ee.Geometry.Rectangle([l[s[1]][i[0]], l[s[0]][d[0]], l[s[1]][i[1]], l[s[0]][d[1]]])
+            eeBoundsPoly = ee.Geometry.Rectangle([l[n[1]][i[0]], l[n[0]][d[0]], l[n[1]][i[1]], l[n[0]][d[1]]])
         } catch (e) {}
         "undefined" != typeof Storage && (localStorage.setItem(cachedSettingskey, JSON.stringify({
             center: {
                 lat: o,
                 lng: a
             },
             zoom: t
         })), updateViewList = !0)
-    })), ee.initialize(authProxyAPIURL, geeAPIURL, (function() {
-        geeAuthenticated = !0, setTimeout((function() {
-            "true" === localStorage["showIntroModal-" + mode] ? $("#introModal").modal().show() : void 0 === staticTemplates.loadingModal[mode] ? "MTBS" === mode ? showMessage("", staticTemplates.loadingModal.all("mtbs-logo.png", "Creating")) : "STORM" === mode || "Bloom-Mapper" === mode || "sequoia-view" === mode ? showMessage("", staticTemplates.loadingModal.all("logos_usda-fs_bn-dk-01.svg", "Creating")) : "lcms-dashboard" === mode ? showMessage("", staticTemplates.loadingModal.all("lcms-icon.png", "Loading", "LCMS summary areas")) : showMessage("", staticTemplates.loadingModal.all("lcms-icon.png", "Creating")) : showMessage("Loading", staticTemplates.loadingModal[mode]), $("#dontShowAgainCheckbox").change((function() {
-                localStorage["showIntroModal-" + mode] = !this.checked
-            }))
-        }), 1e3), geeAuthenticated && $("#main-container").append(staticTemplates.introModal[mode]), null === cachedStudyAreaName && $("#study-area-label").text(defaultStudyArea), "Ancillary" === mode ? run = runAncillary : "LCMS" === mode || "LCMS-pilot" === mode && 0 == studyAreaDict[longStudyAreaName].isPilot ? run = runGTAC : "LT" === mode ? run = runLT : "MTBS" === mode ? run = runMTBS : "TEST" === mode ? run = runTest : "IDS" === mode ? run = runIDS : "geeViz" === mode ? run = runGeeViz : "LAMDA" === mode ? run = runLAMDA : "STORM" === mode ? run = runStorm : "lcms-base-learner" === mode ? run = runBaseLearner : "TreeMap" === mode ? run = runTreeMap : "lcms-dashboard" === mode ? (run = runDashboard, map.setOptions({
-            mapTypeControlOptions: {
-                style: google.maps.MapTypeControlStyle.DROPDOWN_MENU,
-                position: google.maps.ControlPosition.TOP_CENTER,
-                style: google.maps.MapTypeControlStyle.SMALL
-            },
-            streetViewControlOptions: {
-                position: google.maps.ControlPosition.TOP_CENTER
-            },
-            scaleControlOptions: {
-                position: google.maps.ControlPosition.TOP_CENTER
-            },
-            zoomControlOptions: {
-                position: google.maps.ControlPosition.TOP_CENTER,
-                style: google.maps.ZoomControlStyle.SMALL
-            },
-            draggableCursor: "pointer"
-        })) : "Bloom-Mapper" === mode ? run = runAlgal : "sequoia-view" === mode ? run = runSequoia : "CONUS" === studyAreaName ? (longStudyAreaName = cachedStudyAreaName, run = runCONUS) : null != cachedStudyAreaName ? (longStudyAreaName = cachedStudyAreaName, resetStudyArea(cachedStudyAreaName)) : run = runUSFS, "LCMS" === mode && (setupDropdownTreeDownloads(studyAreaName), populateLCMSDownloads()), setGEERunID(), setTimeout((function() {
-            var e = !1,
-                a = 0;
+    }));
+    var d = 1;
 
-            function t() {
-                try {
-                    run(), e = !0
-                } catch (e) {
-                    console.log(e), console.log("Failed to load GEE run function. Waiting 5 seconds to retry"), a++
+    function c() {
+        console.log(`Initializing GEE try number: ${d}`), ee.initialize(authProxyAPIURL, geeAPIURL, (() => {
+            geeAuthenticated = !0, setTimeout((function() {
+                "true" === localStorage["showIntroModal-" + mode] ? $("#introModal").modal().show() : void 0 === staticTemplates.loadingModal[mode] ? "MTBS" === mode ? showMessage("", staticTemplates.loadingModal.all("mtbs-logo.png", "Creating")) : "STORM" === mode || "Bloom-Mapper" === mode || "sequoia-view" === mode ? showMessage("", staticTemplates.loadingModal.all("logos_usda-fs_bn-dk-01.svg", "Creating")) : "lcms-dashboard" === mode ? showMessage("", staticTemplates.loadingModal.all("lcms-icon.png", "Loading", "LCMS summary areas")) : showMessage("", staticTemplates.loadingModal.all("lcms-icon.png", "Creating")) : showMessage("Loading", staticTemplates.loadingModal[mode]), $("#dontShowAgainCheckbox").change((function() {
+                    localStorage["showIntroModal-" + mode] = !this.checked
+                }))
+            }), 1e3), geeAuthenticated && $("#main-container").append(staticTemplates.introModal[mode]), null === cachedStudyAreaName && $("#study-area-label").text(defaultStudyArea), "Ancillary" === mode ? run = runAncillary : "LCMS" === mode || "LCMS-pilot" === mode && 0 == studyAreaDict[longStudyAreaName].isPilot ? run = runGTAC : "LT" === mode ? run = runLT : "MTBS" === mode ? run = runMTBS : "TEST" === mode ? run = runTest : "IDS" === mode ? run = runIDS : "geeViz" === mode ? run = runGeeViz : "LAMDA" === mode ? run = runLAMDA : "STORM" === mode ? run = runStorm : "lcms-base-learner" === mode ? run = runBaseLearner : "TreeMap" === mode ? run = runTreeMap : "lcms-dashboard" === mode ? (run = runDashboard, map.setOptions({
+                mapTypeControlOptions: {
+                    style: google.maps.MapTypeControlStyle.DROPDOWN_MENU,
+                    position: google.maps.ControlPosition.TOP_CENTER,
+                    style: google.maps.MapTypeControlStyle.SMALL
+                },
+                streetViewControlOptions: {
+                    position: google.maps.ControlPosition.TOP_CENTER
+                },
+                scaleControlOptions: {
+                    position: google.maps.ControlPosition.TOP_CENTER
+                },
+                zoomControlOptions: {
+                    position: google.maps.ControlPosition.TOP_CENTER,
+                    style: google.maps.ZoomControlStyle.SMALL
+                },
+                draggableCursor: "pointer"
+            })) : "Bloom-Mapper" === mode ? run = runAlgal : "sequoia-view" === mode ? run = runSequoia : "CONUS" === studyAreaName ? (longStudyAreaName = cachedStudyAreaName, run = runCONUS) : null != cachedStudyAreaName ? (longStudyAreaName = cachedStudyAreaName, resetStudyArea(cachedStudyAreaName)) : run = runUSFS, "LCMS" === mode && (setupDropdownTreeDownloads(studyAreaName), populateLCMSDownloads()), setGEERunID(), setTimeout((function() {
+                var e = !1,
+                    a = 0;
+
+                function t() {
+                    try {
+                        run(), e = !0
+                    } catch (e) {
+                        console.log(e), console.log("Failed to load GEE run function. Waiting 5 seconds to retry"), a++
+                    }
                 }
-            }
-            for (; !1 === e && a < 2;) t(), !1 === e && sleepFor(3e3);
-            setupAreaLayerSelection(), plotsOn && (addPlotCollapse(), loadAllPlots()), "true" !== localStorage["showIntroModal-" + mode] ? ($(".modal").modal("hide"), $(".modal-backdrop").remove()) : ($("#intro-modal-loading-div").hide(), $("#summary-spinner").hide()), "lcms-dashboard" === mode && (dashboardBoxSelect(), startDashboardViewExtentSelect()), addLabelOverlay(), urlParams.endYear - urlParams.startYear < 5 && "LCMS" === mode && showMessage("No Transition Charting", "The year range must be 5 years or more to perform transition charting")
-        }), 1500)
-    }), (function(e) {
-        console.log(`Failed to authenticate to GEE: ${e}`), "LCMS" === mode && (setupDropdownTreeDownloads(studyAreaName), populateLCMSDownloads()), ga("send", "event", mode + "-gee-auth-error", "failure", "failure"), showMessage("Map Loading Error", staticTemplates.authErrorMessage)
-    }))
+                for (; !1 === e && a < 2;) t(), !1 === e && sleepFor(3e3);
+                setupAreaLayerSelection(), plotsOn && (addPlotCollapse(), loadAllPlots()), "true" !== localStorage["showIntroModal-" + mode] ? ($(".modal").modal("hide"), $(".modal-backdrop").remove()) : ($("#intro-modal-loading-div").hide(), $("#summary-spinner").hide()), "lcms-dashboard" === mode && (dashboardBoxSelect(), startDashboardViewExtentSelect()), addLabelOverlay(), urlParams.endYear - urlParams.startYear < 5 && "LCMS" === mode && showMessage("No Transition Charting", "The year range must be 5 years or more to perform transition charting")
+            }), 1500)
+        }), (e => {
+            ! function(e) {
+                console.log(`Failed to authenticate to GEE: ${e}`), "LCMS" === mode && (setupDropdownTreeDownloads(studyAreaName), populateLCMSDownloads()), ga("send", "event", mode + "-gee-auth-error", "failure", "failure"), showMessage("Map Loading Error", staticTemplates.authErrorMessage), "geeViz" === mode && null !== urlParams.accessToken && void 0 !== urlParams.accessToken && "null" !== urlParams.accessToken && "None" !== urlParams.accessToken && (urlParams.geeAuthProxyURL = "https://rcr-ee-proxy-2.herokuapp.com", authProxyAPIURL = urlParams.geeAuthProxyURL, geeAPIURL = "https://earthengine.googleapis.com", d < 5 && (showMessage("Map Loading Error", "Switching to use standard credentials to access GEE. This may produce errors in accessing assets that are not shared publically."), setTimeout((() => {
+                    c()
+                }), 1e3)))
+            }(e)
+        })), d++
+    }
+    c()
 }
 var mapWaitCount = 0,
     mapWaitMax = 3;
 
 function map_load() {
     mapWaitCount++, "undefined" != typeof google ? initialize() : mapWaitCount < mapWaitMax ? (console.log("Waiting attempt #" + mapWaitCount), setTimeout((function() {
         map_load()
@@ -3186,42 +3232,42 @@
             lng: e,
             lat: a
         }), infowindow.setOptions({
             maxWidth: 350
         }), infowindow.setContent(l), infowindow.open(map)) : (infowindow.setContent(""), infowindow.setMap(null), $("#legendDiv").css("max-width", ""), $("#legendDiv").css("max-height", "80%"), $("#chart-collapse-label-chart-collapse-div").show(), $("#chart-collapse-div").empty(), $("#chart-collapse-div").append(l));
         var r = 1;
 
-        function n(e, a, t) {
+        function s(e, a, t) {
             var l = t + "-container-" + r.toString();
             if (r++, $("#query-list-container").append("<table class=\"table table-hover bg-white\">\n\t\t\t\t\t\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr class = 'bg-black'><th></th></tr>\n\t\t\t\t\t\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t\t\t\t\t  </table>"), null == e) $("#query-list-container").append(`<table class="table table-hover bg-white">\n\t\t\t\t\t\t\t\t\t\t\t\t<tbody id = '${l}'></tbody>\n\t\t\t\t\t\t\t\t\t\t\t  </table>`), $("#" + l).append(`<tr><th>${a.name}</th><th>NULL</th></tr>`);
             else if ("geeImage" === a.type) {
                 $("#query-list-container").append(`<table class="table table-hover bg-white">\n\t\t\t\t\t\t\t\t\t\t\t\t<tbody id = '${l}'></tbody>\n\t\t\t\t\t\t\t\t\t\t\t  </table>`);
                 let t = Object.keys(e);
                 if (1 === t.length) {
-                    var n = Object.values(e)[0];
-                    null !== a.queryDict && void 0 !== a.queryDict ? n = a.queryDict[parseInt(n)] : n % 1 && (n = n.toFixed(4)), $("#" + l).append(`<tr><th>${a.name}</th><td>${n}</td></tr>`)
+                    var s = Object.values(e)[0];
+                    null !== a.queryDict && void 0 !== a.queryDict ? s = a.queryDict[parseInt(s)] : s % 1 && (s = s.toFixed(4)), $("#" + l).append(`<tr><th>${a.name}</th><td>${s}</td></tr>`)
                 } else if (4 === t.length && t.indexOf("viz-blue") > -1 && t.indexOf("viz-green") > -1 && t.indexOf("viz-red") > -1) {
                     let o = t.filter((e => -1 === e.indexOf("viz-")))[0];
-                    n = JSON.stringify(e[o]);
-                    null !== a.queryDict && void 0 !== a.queryDict ? n = a.queryDict[parseInt(n)] : n % 1 && (n = n.toFixed(4)), $("#" + l).append(`<tr><th>${a.name}</th><td>${n}</td></tr>`)
+                    s = JSON.stringify(e[o]);
+                    null !== a.queryDict && void 0 !== a.queryDict ? s = a.queryDict[parseInt(s)] : s % 1 && (s = s.toFixed(4)), $("#" + l).append(`<tr><th>${a.name}</th><td>${s}</td></tr>`)
                 } else $("#" + l).append(`<tr><th>${a.name}</th><th>Multi band</th></tr>`), Object.keys(e).map((function(a) {
                     try {
                         var t = e[a];
                         null !== t && (t = t.toFixed(2).toString()), $("#" + l).append(`<tr><td>${a}</td><td>${t}</td></tr>`)
                     } catch (e) {
                         $("#" + l).append(`<tr><td>${a}</td><td>${JSON.stringify(t)}</td></tr>`)
                     }
                 }))
             } else if ("geeImageCollection" === a.type) {
                 $("#query-list-container").append("<ul class = 'bg-black dropdown-divider'></ul>"), $("#query-list-container").append(`<ul class = 'm-0 p-0 bg-white' id = '${l}'></ul>`);
                 let t = 600;
                 "infoWindow" === queryWindowMode ? (infowindow.setOptions({
                     maxWidth: 1200
                 }), infowindow.open(map)) : ($("#legendDiv").css("max-width", "575px"), t = 550);
-                var s = {
+                var n = {
                         plot_bgcolor: "#D6D1CA",
                         paper_bgcolor: "#D6D1CA",
                         font: {
                             family: "Roboto Condensed, sans-serif"
                         },
                         margin: {
                             l: 50,
@@ -3249,89 +3295,89 @@
                         toImageButtonOptions: {
                             filename: a.name + o,
                             width: 1200,
                             height: 800,
                             format: "png"
                         }
                     };
-                Plotly.newPlot(l, e.table, s, i)
+                Plotly.newPlot(l, e.table, n, i)
             } else if ("geeVectorImage" === a.type || "geeVector" === a.type) {
                 $("#query-list-container").append(`<table class="table table-hover bg-white">\n\t\t\t\t\t\t\t\t\t\t\t\t<tbody id = '${l}'></tbody>\n\t\t\t\t\t\t\t\t\t\t\t  </table>`);
                 var p = Object.keys(e);
                 $("#" + l).append(`<tr><th>${a.name}</th><th>Attribute Table</th></tr>`), p.map((function(a) {
                     var t = e[a];
                     $("#" + l).append(`<tr><th>${a}</th><td>${t}</td></tr>`)
                 }))
             }
             c >= d && (map.setOptions({
                 draggableCursor: "help"
             }), map.setOptions({
                 cursor: "help"
             }), $("#summary-spinner").slideUp())
         }
-        var s = Object.keys(queryObj),
+        var n = Object.keys(queryObj),
             i = [];
-        s.map((function(e) {
+        n.map((function(e) {
             queryObj[e].visible && i.push(e)
         }));
         var d = i.length,
             c = 0;
         0 === d && ($("#summary-spinner").slideUp(), showMessage("No Layers to Query!", "No visible layers to query. Please turn on any layers you would like to query")), clearQueryGeoJSON(), i.map((function(e) {
             var a = queryObj[e];
             if (a.visible) {
                 var o = ee.Geometry.Point(t);
                 if (ga("send", "event", mode, "pixelQuery-" + a.type, a.name), "geeImage" === a.type) ee.Image(a.queryItem).reduceRegion(ee.Reducer.first(), o, 30, "EPSG:5070", null, !0, 1e13, 1).evaluate((function(t) {
-                    c++, n(t, a, e)
+                    c++, s(t, a, e)
                 }));
                 else if ("geeImageCollection" === a.type) {
                     var l = a.queryDateFormat;
                     null == l && (l = "YYYY-MM-dd");
                     var r = ee.ImageCollection(a.queryItem),
-                        s = o.buffer(plotRadius).bounds();
+                        n = o.buffer(plotRadius).bounds();
                     r.first().propertyNames().getInfo().indexOf("system:time_start") > -1 && (r = r.sort("system:time_start").map((function(e) {
                         return e.set("system:time_start", e.date().format(l))
-                    }))), r.getRegion(s, scale, crs, transform).evaluate((function(t, o) {
+                    }))), r.getRegion(n, scale, crs, transform).evaluate((function(t, o) {
                         console.log(t), null != t ? function(t) {
                             if (c++, t.length > 1) {
                                 var o = t[0];
                                 t = t.slice(1);
-                                var l, r, s = o.indexOf("time"),
+                                var l, r, n = o.indexOf("time"),
                                     i = o.indexOf("id"),
                                     d = arrayColumn(t, i).filter(((e, a, t) => t.indexOf(e) === a)).length;
-                                t.length > d && (console.log("reducing number of inputs"), t = t.slice(0, d)), null !== t[0][s] ? (l = arrayColumn(t, s), r = "Time") : (l = arrayColumn(t, i), r = "ID");
+                                t.length > d && (console.log("reducing number of inputs"), t = t.slice(0, d)), null !== t[0][n] ? (l = arrayColumn(t, n), r = "Time") : (l = arrayColumn(t, i), r = "ID");
                                 var p = o.slice(4);
                                 yColumns = t.map((function(e) {
                                     return e.slice(4)
                                 }));
                                 var u = p.map((function(e, a) {
                                     return {
                                         x: l,
                                         y: arrayColumn(yColumns, a),
                                         type: "scatter",
                                         name: e
                                     }
                                 }));
-                                n({
+                                s({
                                     table: u,
                                     xLabel: r
                                 }, a, e)
-                            } else console.log("no data"), n(null, a, e)
-                        }(t) : (c++, n(null, a, e)), null != o && showMessage("Error", o)
+                            } else console.log("no data"), s(null, a, e)
+                        }(t) : (c++, s(null, a, e)), null != o && showMessage("Error", o)
                     }))
                 } else if ("geeVectorImage" === a.type || "geeVector" === a.type) {
                     try {
                         var i = a.queryItem.filterBounds(o)
                     } catch (e) {
                         i = ee.FeatureCollection([a.queryItem]).filterBounds(o)
                     }
                     i.evaluate((function(t) {
                         c++, queryGeoJSON.addGeoJson(t);
                         var o = t.features;
-                        0 === o.length ? n(null, a, e) : o.map((function(t) {
-                            n(t.properties, a, e)
+                        0 === o.length ? s(null, a, e) : o.map((function(t) {
+                            s(t.properties, a, e)
                         }))
                     }))
                 }
             }
         }))
     },
     fsb, udp;
@@ -3455,31 +3501,31 @@
 function convertToStack(e, a = "year", t = "YYYY") {
     "year" === a && (e = e.map((function(e) {
         return e.set("year", e.date().format(t))
     })));
     var o = e.first().bandNames(),
         l = ee.List(e.toList(1e4, 0).map((e => ee.Image(e).get(a)))),
         r = e.toBands(),
-        n = r.bandNames().map((e => {
+        s = r.bandNames().map((e => {
             var a = ee.Number.parse(ee.String(e).split("_").get(0));
             return ee.String(l.get(a)).cat("---").cat(ee.String(e).split("_").slice(1, null).join("_"))
         }));
-    return r.rename(n).set({
+    return r.rename(s).set({
         xProps: l,
         bns: o
     })
 }
 
-function getAreaSummaryTable(e, a, t, o, l, r, n, s) {
-    null == t && (t = "year"), null == o && (o = 100), null == l && (l = "YYYY"), null == r && (r = "EPSG:5070"), null == n && (n = null), null == s && null === n && (s = 30), "year" === t && (e = e.map((function(e) {
+function getAreaSummaryTable(e, a, t, o, l, r, s, n) {
+    null == t && (t = "year"), null == o && (o = 100), null == l && (l = "YYYY"), null == r && (r = "EPSG:5070"), null == s && (s = null), null == n && null === s && (n = 30), "year" === t && (e = e.map((function(e) {
         return e.set("year", e.date().format(l))
     })));
     var i = ee.Image(e.first()).bandNames();
     return e.toList(1e4, 0).map((function(e) {
-        var l, d = (e = ee.Image(e)).reduceRegion(ee.Reducer.fixedHistogram(0, 2, 2), a, s, r, n, !0, 1e13, 4),
+        var l, d = (e = ee.Image(e)).reduceRegion(ee.Reducer.fixedHistogram(0, 2, 2), a, n, r, s, !0, 1e13, 4),
             c = e.get(t);
         return d = ee.Dictionary(d), values = i.map((function(e) {
             var a = d.get(e);
             return a = ee.Array(a).slice(1, 1, 2).project([0]), l = ee.Number(a.reduce(ee.Reducer.sum(), [0]).get([0])), (a = ee.Number(a.toList().get(1))).divide(l).multiply(o)
         })), values = ee.List([c]).cat(values), values
     }))
 }
@@ -3520,36 +3566,36 @@
         let t = getTransitionRowData();
         if (null !== t) {
             let l = getTransitionClasses(areaChartCollections[whichAreaChartCollection].collection, t, areaChartCollections[whichAreaChartCollection].values, areaChartCollections[whichAreaChartCollection].bandName),
                 r = e.bounds(500, crs).transform(crs, 500);
             ee.Image(l).clip(e).reduceRegion(ee.Reducer.fixedHistogram(0, 3, 3), r, scale, crs, transform, !0, 1e13, 4).evaluate(((t, l) => {
                 if (void 0 !== l && currentChartID === o) showMessage("Charting Error", l);
                 else if (currentChartID === o) {
-                    const s = Object.values(t)[0].slice(0, 2).map((e => e[1])).reduce(((e, a) => e + a), 0),
+                    const n = Object.values(t)[0].slice(0, 2).map((e => e[1])).reduce(((e, a) => e + a), 0),
                         i = {
                             source: [],
                             target: [],
                             value: []
                         };
                     let d, c = [],
                         p = [],
                         u = [],
                         m = {},
                         h = 0,
                         g = [],
-                        v = {};
+                        f = {};
                     Object.keys(t).map((e => g.push(e.split("---")[0].split("--")[0], e.split("---")[1].split("--")[0]))), Object.keys(t).map((e => u.push(e.split("---")[0].split("--")[1], e.split("---")[1].split("--")[1]))), g = unique(g), u = unique(u).map((e => parseInt(e))).sort(((e, a) => e - a)), g.map((e => {
                         areaChartCollections[whichAreaChartCollection].names.map((a => {
                             const t = e + " " + a;
                             p.push(t), m[t] = h, h++
                         })), areaChartCollections[whichAreaChartCollection].colors.map((e => {
                             c.push(e)
                         }))
-                    })), d = "Percentage" === areaChartFormat ? 1 / s * 100 : chartFormatDict[areaChartFormat].mult;
-                    let f = [],
+                    })), d = "Percentage" === areaChartFormat ? 1 / n * 100 : chartFormatDict[areaChartFormat].mult;
+                    let v = [],
                         y = 1;
 
                     function r(e, t = 20, o = 25, l = 10) {
                         i.hovertemplate = "%{value}" + chartFormatDict[areaChartFormat].label + " %{source.label}-%{target.label}<extra></extra>";
                         var r = [r = {
                                 type: "sankey",
                                 orientation: "h",
@@ -3562,15 +3608,15 @@
                                     },
                                     label: p,
                                     color: c,
                                     hovertemplate: "%{value}" + chartFormatDict[areaChartFormat].label + " %{label}<extra></extra>"
                                 },
                                 link: i
                             }],
-                            n = {
+                            s = {
                                 title: a,
                                 font: {
                                     size: l
                                 },
                                 autosize: !0,
                                 margin: {
                                     l: 25,
@@ -3578,65 +3624,65 @@
                                     b: 25,
                                     t: 50,
                                     pad: 4
                                 },
                                 paper_bgcolor: "#DDD",
                                 plot_bgcolor: "#DDD"
                             },
-                            s = {
+                            n = {
                                 toImageButtonOptions: {
                                     format: "png",
                                     filename: a,
                                     width: 1e3,
                                     height: 600
                                 },
                                 scrollZoom: !0,
                                 displayModeBar: !1
                             };
-                        return Plotly.newPlot(e, r, n, s)
+                        return Plotly.newPlot(e, r, s, n)
                     }
                     g.slice(0, g.length - 1).map((e => {
                         let a = e,
                             o = g[y];
                         y++;
                         let l = [""];
-                        u.map((e => l.push(o + " " + areaChartCollections[whichAreaChartCollection].names[e - 1]))), f.push(l), u.map((e => {
+                        u.map((e => l.push(o + " " + areaChartCollections[whichAreaChartCollection].names[e - 1]))), v.push(l), u.map((e => {
                             let l = [a + " " + areaChartCollections[whichAreaChartCollection].names[e - 1]];
                             u.map((r => {
-                                let n = t[`${a}--${e}---${o}--${r}`][1][1] * d;
-                                l.push(n)
-                            })), f.push(l)
-                        })), f.push([""])
-                    })), f = f.slice(0, f.length - 1), dataTable = f, Object.keys(t).map((e => {
+                                let s = t[`${a}--${e}---${o}--${r}`][1][1] * d;
+                                l.push(s)
+                            })), v.push(l)
+                        })), v.push([""])
+                    })), v = v.slice(0, v.length - 1), dataTable = v, Object.keys(t).map((e => {
                         const a = e.split("---")[0].split("--")[0],
                             o = e.split("---")[1].split("--")[0],
                             l = parseInt(e.split("---")[0].split("--")[1]) - 1,
                             r = parseInt(e.split("---")[1].split("--")[1]) - 1,
-                            n = areaChartCollections[whichAreaChartCollection].names[l],
-                            s = areaChartCollections[whichAreaChartCollection].names[r],
+                            s = areaChartCollections[whichAreaChartCollection].names[l],
+                            n = areaChartCollections[whichAreaChartCollection].names[r],
                             c = t[e][1][1] * d,
-                            p = a + " " + n,
-                            u = o + " " + s;
-                        v[e] = c, i.source.push(m[p]), i.target.push(m[u]), i.value.push(c)
+                            p = a + " " + s,
+                            u = o + " " + n;
+                        f[e] = c, i.source.push(m[p]), i.target.push(m[u]), i.value.push(c)
                     })), configChartModal("Plotly"), r("chart-canvas", thickness = 20, nodePad = 25, fontSize = 10), plotlyDownloadChartObject = r("chart-download-canvas", thickness = 40, nodePad = 20, fontSize = 20), $("#chart-download-dropdown").empty(), $("#chart-modal-footer").append(`<div class="dropdown">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=" dropdown-toggle"  id="chartDownloadDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n\t\t\t\t\t\t\t\t\t\t\t\t\tDownload\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div id = 'chart-download-dropdown' class="dropdown-menu px-2" aria-labelledby="chartDownloadDropdown">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<a class="dropdown-item" href="#" onclick = "downloadPlotly(plotlyDownloadChartObject,'${a}.png')">PNG</a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<a class="dropdown-item" href="#" onclick = "exportToCsv('${a}.csv', dataTable)">CSV</a>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="dropdown">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=" dropdown-toggle"  id="chartTypeDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n\t\t\t\t\t\t\t\t\t\t\t\t\tChart Type\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div id = 'chart-type-dropdown' class="dropdown-menu px-2" aria-labelledby="chartTypeDropdown">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<a class="dropdown-item" href="#" onclick = "toggleChartTable('chart');">Sankey Chart</a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<a class="dropdown-item" href="#" onclick = "toggleChartTable('table')">Table</a>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t`);
-                    var n = htmlTable(dataTable);
-                    $("#chart-table").append(n), toggleChartTable(localStorage.tableOrChart), e.evaluate((function(e, t) {
-                        areaGeoJson = e, areaGeoJson.properties = v, void 0 === t && null != areaGeoJson ? $("#chart-download-dropdown").append(`<a class="dropdown-item" href="#" onclick = "exportJSON('${a}.geojson', areaGeoJson)">geoJSON</a>`) : showMessage("Error", "Could not convert summary area to geoJSON " + t)
+                    var s = htmlTable(dataTable);
+                    $("#chart-table").append(s), toggleChartTable(localStorage.tableOrChart), e.evaluate((function(e, t) {
+                        areaGeoJson = e, areaGeoJson.properties = f, void 0 === t && null != areaGeoJson ? $("#chart-download-dropdown").append(`<a class="dropdown-item" href="#" onclick = "exportJSON('${a}.geojson', areaGeoJson)">geoJSON</a>`) : showMessage("Error", "Could not convert summary area to geoJSON " + t)
                     })), ga("send", "event", mode, "sankeyAreaChart", whichAreaChartCollection), $("#chart-modal").modal()
                 }
                 $("#summary-spinner").slideUp()
             }))
         } else $("#summary-spinner").slideUp()
     } else {
         var l = areaChartCollections[whichAreaChartCollection].collection,
             r = areaChartCollections[whichAreaChartCollection].xAxisProperty,
-            n = areaChartCollections[whichAreaChartCollection].xAxisLabel,
-            s = areaChartCollections[whichAreaChartCollection].yAxisLabel,
+            s = areaChartCollections[whichAreaChartCollection].xAxisLabel,
+            n = areaChartCollections[whichAreaChartCollection].yAxisLabel,
             i = areaChartCollections[whichAreaChartCollection].dateFormat;
-        null !== r && null != r || (r = "year"), null !== n && null != n || (n = null), null !== s && null != s || (s = "% Area"), s = areaChartFormatDict[areaChartFormat].label;
+        null !== r && null != r || (r = "year"), null !== s && null != s || (s = null), null !== n && null != n || (n = "% Area"), n = areaChartFormatDict[areaChartFormat].label;
         var d = e.area(1e3);
         ["Acres", "Hectares"].indexOf(areaChartFormat) > -1 ? multiplier = d.multiply(areaChartFormatDict[areaChartFormat].mult) : multiplier = areaChartFormatDict[areaChartFormat].mult;
         var c = ee.Image(l.first()).bandNames().getInfo();
         (c = c.map((function(e) {
             return e.replaceAll("_", " ") + " " + areaChartFormatDict[areaChartFormat].label
         }))).unshift(r);
         var p = getAreaSummaryTable(l, e, r, multiplier, i, crs, transform, scale),
@@ -3648,16 +3694,16 @@
                 if (void 0 !== r && u < 60 && currentChartID === o && i - m < 1e4) t();
                 else if (void 0 === r && currentChartID === o) {
                     l.unshift(c), $("#summary-spinner").slideUp();
                     var d = areaChartCollections[whichAreaChartCollection].stacked,
                         p = areaChartCollections[whichAreaChartCollection].steppedLine,
                         h = areaChartCollections[whichAreaChartCollection].colors,
                         g = areaChartCollections[whichAreaChartCollection].chartType,
-                        v = areaChartCollections[whichAreaChartCollection].fieldsHidden;
-                    null == g && (g = "line"), ga("send", "event", mode, "areaChart", whichAreaChartCollection), addChartJS(l, a, g, d, p, h, n, s, v), e.evaluate((function(e, t) {
+                        f = areaChartCollections[whichAreaChartCollection].fieldsHidden;
+                    null == g && (g = "line"), ga("send", "event", mode, "areaChart", whichAreaChartCollection), addChartJS(l, a, g, d, p, h, s, n, f), e.evaluate((function(e, t) {
                         areaGeoJson = e, areaGeoJson[a] = l, void 0 === t && null != areaGeoJson ? $("#chart-download-dropdown").append(`<a class="dropdown-item" href="#" onclick = "exportJSON('${a}.geojson', areaGeoJson)">geoJSON</a>`) : showMessage("Error", "Could not convert summary area to geoJSON " + t)
                     })), areaChartingCount--
                 } else void 0 !== r && ($("#summary-spinner").slideUp(), (r.indexOf("Dictionary.toArray: Unable to convert dictionary to array") > -1 || r.indexOf("Array: Parameter 'values' is required.") > -1) && (r = "Most likely selected area does not overlap with selected LCMS study area<br>Please select area that overlaps with products<br>Raw Error Message:<br>" + r), showMessage('<i class="text-dark text-uppercase fa fa-exclamation-triangle"></i> Error! Try again', r));
                 u++
             }))
         }()
     }
@@ -3717,14 +3763,33 @@
             Map2.addLayer(o, {
                 isUploadedLayer: !0
             }, e, !0, null, null, e + " for area summarizing", "area-charting-shp-layer-list"), makeAreaChart(o, e)
         }))
     } else showMessage("No Summary Area Selected", "Please select a .zip shapefile or a .geojson file to summarize across")
 }
 
+function runShpDefinedAddLayer() {
+    if (jQuery("#areaUpload")[0].files.length > 0) {
+        var e = jQuery("#areaUpload")[0].files[0].name.split(".")[0];
+        map.setOptions({
+            draggableCursor: "progress"
+        }), map.setOptions({
+            cursor: "progress"
+        }), convertToGeoJSON("areaUpload").done((function(a) {
+            console.log("successfully converted to JSON"), console.log(a), a.features.map((function(e) {
+                e.geometry.type
+            })) ? Map2.addLayer(a.features.map((e => ee.Feature(e).buffer(8))), {
+                layerType: "geeVectorImage"
+            }, e, !0, null, null, e, "reference-layer-list") : Map2.addLayer(a, {
+                layerType: "geoJSONVector"
+            }, e, !0, null, null, e, "reference-layer-list")
+        }))
+    } else showMessage("No Summary Area Selected", "Please select a .zip shapefile or a .geojson file to add to viewer")
+}
+
 function startShpDefinedCharting() {
     turnOnUploadedLayers(), void 0 !== selectionTracker.uploadedLayerIndices && null !== selectionTracker.uploadedLayerIndices || (selectionTracker.uploadedLayerIndices = [])
 }
 
 function stopAreaCharting() {
     window.removeEventListener("keydown", restartUserDefinedAreaCarting), window.removeEventListener("keydown", undoUserDefinedAreaCharting);
     try {
@@ -3853,37 +3918,37 @@
     },
     chartJSChart, plotlyDownloadChartObject, chartType, chartTableDict;
 
 function configChartModal(e = "chartJS") {
     $(document).height() / $(document).width() > 1 ? (canvasHeight = "90%", canvasWidth = "100%") : (canvasHeight = "50%", canvasWidth = "100%"), clearModal("chart-modal"), $("#chart-modal-body").append("<div id = 'chart-modal-graph-table-container' class = 'flexcroll chart-table-graph-container'></div>"), "chartJS" === e ? $("#chart-modal-graph-table-container").append(`<div id = 'chart-modal-graph-container' class = 'pb-2'>\n\t    \t\t\t\t\t\t\t\t\t\t\t\t\t<canvas id="chart-canvas" width="${canvasWidth}" height = "${canvasHeight}" ></canvas>\n\t    \t\t\t\t\t\t\t\t\t\t\t\t</div>`) : $("#chart-modal-graph-table-container").append('<div id = \'chart-modal-graph-container\' class = \'pb-2\'>\n\t    \t\t\t\t\t\t\t\t\t\t\t\t\t<div id="chart-canvas"></div>\n\t    \t\t\t\t\t\t\t\t\t\t\t\t\t<div id="chart-download-canvas" style="display:none;"></div>\n\t    \t\t\t\t\t\t\t\t\t\t\t\t</div>'), $("#chart-modal-graph-table-container").append(`<div id="chart-table" style = 'display:none;' width="${canvasWidth}" height = "${canvasHeight}" ></div>`)
 }
 
-function addChartJS(e, a, t, o, l, r, n, s, i) {
+function addChartJS(e, a, t, o, l, r, s, n, i) {
     var d = !0,
         c = !0;
-    null == i && (i = null), null == n && (n = "", d = !1), null == s && (s = "", c = !1), null == r && (r = chartColors), null == t && (t = "line"), null == o && (o = !1), void 0 !== l && null != l || (l = !1), dataTable = dataTableNumbersToNames(e), configChartModal();
+    null == i && (i = null), null == s && (s = "", d = !1), null == n && (n = "", c = !1), null == r && (r = chartColors), null == t && (t = "line"), null == o && (o = !1), void 0 !== l && null != l || (l = !1), dataTable = dataTableNumbersToNames(e), configChartModal();
     var p = arrayColumn(e.slice(1), 0),
         u = range(1, e[1].length).map((function(a) {
             var t = !1;
             null !== i && (t = i[a - 1]);
-            var n = arrayColumn(e, a),
-                s = n[0],
-                d = n.slice(1);
+            var s = arrayColumn(e, a),
+                n = s[0],
+                d = s.slice(1);
             d = d.map((function(e) {
                 var a;
                 try {
                     a = e.toFixed(6)
                 } catch (t) {
                     a = e
                 }
                 return a
             }));
             var c = r[(a - 1) % r.length]; - 1 === c.indexOf("#") && (c = "#" + c);
             var p = {
-                label: s,
+                label: n,
                 pointStyle: "circle",
                 pointRadius: 1,
                 data: d,
                 fill: !1,
                 borderColor: c,
                 lineTension: 0,
                 borderWidth: 2,
@@ -3923,22 +3988,22 @@
                 backgroundColor: "#DDD"
             },
             scales: {
                 yAxes: [{
                     stacked: o,
                     scaleLabel: {
                         display: c,
-                        labelString: s
+                        labelString: n
                     }
                 }],
                 xAxes: [{
                     stacked: o,
                     scaleLabel: {
                         display: d,
-                        labelString: n
+                        labelString: s
                     },
                     maxBarThickness: 100
                 }]
             }
         }
     }), $("#chart-download-dropdown").empty(), $("#chart-modal-footer").append(`<div class="dropdown">\n\t\t\t\t\t\t\t\t\t\t  <div class=" dropdown-toggle"  id="chartDownloadDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n\t\t\t\t\t\t\t\t\t\t    Download\n\t\t\t\t\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t\t\t\t\t  <div id = 'chart-download-dropdown' class="dropdown-menu px-2" aria-labelledby="chartDownloadDropdown">\n\t\t\t\t\t\t\t\t\t\t    <a class="dropdown-item" href="#" onclick = "downloadChartJS(chartJSChart,'${a}.png')">PNG</a>\n\t\t\t\t\t\t\t\t\t\t    <a class="dropdown-item" href="#" onclick = "exportToCsv('${a}.csv', dataTable)">CSV</a>\n\t\t\t\t\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="dropdown">\n\t\t\t\t\t\t\t\t\t\t  <div class=" dropdown-toggle"  id="chartTypeDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n\t\t\t\t\t\t\t\t\t\t    Chart Type\n\t\t\t\t\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t\t\t\t\t  <div id = 'chart-type-dropdown' class="dropdown-menu px-2" aria-labelledby="chartTypeDropdown">\n\t\t\t\t\t\t\t\t\t\t    <a class="dropdown-item" href="#" onclick = "toggleChartTable('chart');change('line',false,${l});">Line</a>\n\t\t\t\t\t\t\t\t\t\t    <a class="dropdown-item" href="#" onclick = "toggleChartTable('chart');change('line',true,${l});">Stacked Line</a>\n\t\t\t\t\t\t\t\t\t\t    <a class="dropdown-item" href="#" onclick = "toggleChartTable('chart');change('bar',false,${l});">Bar</a>\n\t\t\t\t\t\t\t\t\t\t    <a class="dropdown-item" href="#" onclick = "toggleChartTable('chart');change('bar',true,${l});">Stacked Bar</a>\n\t\t\t\t\t\t\t\t\t\t    <a class="dropdown-item" href="#" onclick = "toggleChartTable('table')">Table</a>\n\t\t\t\t\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t`);
     var m = htmlTable(dataTable);
@@ -3970,18 +4035,18 @@
     a[0] = a[0].toProperCase();
     var t = [a];
     return e.slice(1).map((function(e) {
         var o = [];
         jQuery.each(e, (function(e, t) {
             var l, r = a[e];
             if (null !== chartTableDict && null !== chartTableDict[r] && void 0 !== chartTableDict[r] && void 0 !== t) {
-                var n = Object.keys(chartTableDict[r]).filter((function(e) {
+                var s = Object.keys(chartTableDict[r]).filter((function(e) {
                     return Math.abs(e - t) < 1e-4
                 }));
-                if (null == (l = chartTableDict[r][n])) {
+                if (null == (l = chartTableDict[r][s])) {
                     try {
                         t = t.formatNumber()
                     } catch (e) {}
                     l = t
                 }
             } else {
                 try {
@@ -4192,18 +4257,18 @@
             return a + "\n"
         }, o = "", l = 0; l < a.length; l++) o += t(a[l]);
     var r = new Blob([o], {
         type: "text/csv;charset=utf-8;"
     });
     if (navigator.msSaveBlob) navigator.msSaveBlob(r, e);
     else {
-        var n = document.createElement("a");
-        if (void 0 !== n.download) {
-            var s = URL.createObjectURL(r);
-            n.setAttribute("href", s), n.setAttribute("download", e), n.style.visibility = "hidden", document.body.appendChild(n), n.click(), document.body.removeChild(n), ga("send", "event", mode, getActiveTools()[0] + "-chartDownload", "csv")
+        var s = document.createElement("a");
+        if (void 0 !== s.download) {
+            var n = URL.createObjectURL(r);
+            s.setAttribute("href", n), s.setAttribute("download", e), s.style.visibility = "hidden", document.body.appendChild(s), s.click(), document.body.removeChild(s), ga("send", "event", mode, getActiveTools()[0] + "-chartDownload", "csv")
         }
     }
 }
 
 function stopAllTools() {
     stopArea(), stopDistance(), stopQuery(), stopCharting(), stopAreaCharting(), stopCharting(), clearQueryGeoJSON(), turnOffUploadedLayers(), turnOffSelectLayers(), turnOffSelectGeoJSON(), Object.keys(toolFunctions).map((function(e) {
         Object.keys(toolFunctions[e]).map((function(a) {
@@ -4277,15 +4342,15 @@
             o && e.push(l)
         }))
     })), e
 }
 
 function updateToolStatusBar() {
     var e = !1;
-    $("#current-tool-selection").empty(), $("#current-tool-selection").append("Ative tools: "), Object.keys(toolFunctions).map((function(a) {
+    $("#current-tool-selection").empty(), $("#current-tool-selection").append("Active tools: "), Object.keys(toolFunctions).map((function(a) {
         Object.keys(toolFunctions[a]).map((function(t) {
             var o = toolFunctions[a][t].state,
                 l = toolFunctions[a][t].title;
             o && ($("#current-tool-selection").append(`${l}`), e = !0)
         }))
     })), e ? ga("send", "event", "tool-active", mode, $("#current-tool-selection").html().split(": ")[1]) : $("#current-tool-selection").append("No active tools")
 }
```

### Comparing `geeViz-2023.6.1/geeViz/geeView/js/load.min.js` & `geeViz-2023.7.1/geeViz/geeView/js/load.min.js`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/geeView.py` & `geeViz-2023.7.1/geeViz/geeView.py`

 * *Files 8% similar despite different names*

```diff
@@ -23,33 +23,80 @@
 
 from threading import Thread
 from IPython.display import IFrame,display, HTML
 if sys.version_info[0] < 3:
     import SimpleHTTPServer, SocketServer
 else:
     import http.server, socketserver 
+creds_path = ee.oauth.get_credentials_path()
 ######################################################################
-#Set up GEE and paths
-try:
-    z = ee.Number(1).getInfo()
-except:
-    print('Initializing GEE')
-    ee.Initialize()
+# Functions to handle various initialization/authentication workflows to try to get a user an initialized instance of ee
 
+# Function to have user input a project id if one is still needed
+def getProject():
+    provided_project = '{}.proj_id'.format(creds_path)
+    provided_project = os.path.normpath(provided_project)
+    
+    if not os.path.exists(provided_project):
+        project_id = input('Please enter GEE project ID: ')
+        print('You entered: {}'.format(project_id))
+        o = open(provided_project,'w')
+        o.write(project_id)
+        o.close()
+    o = open(provided_project,'r')
+    project_id=o.read()
+    print('Cached project id file path: {}'.format(provided_project))
+    print('Cached project id: {}'.format(project_id))
+    o.close()
+    return project_id
+def verified_initialize(project=None):
+    ee.Initialize(project=project)
+    z = ee.Number(1).getInfo()
+    print('Successfully initialized')
+# Function to handle various exceptions to initializing to GEE
+def robustInitializer():
+    try:
+        z = ee.Number(1).getInfo()
+    except:
+        print('Initializing GEE')
+        
+        if not os.path.exists(creds_path):
+            print('No credentials found')
+            print('Will attempt ee.Authenticate')
+            ee.Authenticate()
+        try:
+            verified_initialize(project=None)
+        except Exception as E:
+            print(E)
+            if str(E).find('Reauthentication is needed') >- 1:
+                ee.Authenticate()
+            
+            if str(E).find('project is not registered') > -1:
+                project_id=getProject()
+            else:
+                project_id = None
+            try:
+                verified_initialize(project=project_id)
+            except Exception as E:
+                print(E)
+                
+######################################################################
+#Set up GEE and paths
+robustInitializer()
 geeVizFolder = 'geeViz'
 geeViewFolder = 'geeView'
 #Set up template web viewer
 #Do not change
 cwd = os.getcwd()
 
 paths = sys.path
 
-gee_py_modules_dir = site.getsitepackages()[-1]
-
-py_viz_dir = os.path.join(gee_py_modules_dir,geeVizFolder)
+# gee_py_modules_dir = site.getsitepackages()[-1]
+# py_viz_dir = os.path.join(gee_py_modules_dir,geeVizFolder)
+py_viz_dir = os.path.dirname(__file__)
 # os.chdir(py_viz_dir)
 print('geeViz package folder:', py_viz_dir)
 
 #Specify location of files to run
 template = os.path.join(py_viz_dir,geeViewFolder,'index.html')
 ee_run_dir =  os.path.join(py_viz_dir, geeViewFolder,'js')
 if os.path.exists(ee_run_dir) == False:os.makedirs(ee_run_dir)
@@ -90,15 +137,16 @@
     params = {
             "grant_type": "refresh_token",
             "client_id": ee.oauth.CLIENT_ID,
             "client_secret": ee.oauth.CLIENT_SECRET,
             "refresh_token": refresh_token
     }
     r = requests.post(ee.oauth.TOKEN_URI, data=params)
-
+    # print('R:',r.json()['access_token'])
+    # input('press any key to continue')
     if r.ok:
         return cleanAccessToken(r.json()['access_token'])
     else:
         return None
 
 # Function for using a GEE white-listed service account key to get an access token for geeView
 def serviceAccountToken(service_key_file_path):
```

### Comparing `geeViz-2023.6.1/geeViz/getImagesLib.py` & `geeViz-2023.7.1/geeViz/getImagesLib.py`

 * *Files 0% similar despite different names*

```diff
@@ -48,10883 +48,10876 @@
 000002f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00000300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00000310: 230d 0a66 726f 6d20 6765 6556 697a 2e67  #..from geeViz.g
 00000320: 6565 5669 6577 2069 6d70 6f72 7420 2a0d  eeView import *.
 00000330: 0a69 6d70 6f72 7420 6d61 7468 2c20 6565  .import math, ee
 00000340: 2c20 6a73 6f6e 2c20 7064 620d 0a66 726f  , json, pdb..fro
 00000350: 6d20 7468 7265 6164 696e 6720 696d 706f  m threading impo
-00000360: 7274 2054 6872 6561 640d 0a74 7279 3a0d  rt Thread..try:.
-00000370: 0a20 2020 207a 203d 2065 652e 4e75 6d62  .    z = ee.Numb
-00000380: 6572 2831 292e 6765 7449 6e66 6f28 290d  er(1).getInfo().
-00000390: 0a65 7863 6570 743a 0d0a 2020 2020 7072  .except:..    pr
-000003a0: 696e 7428 2749 6e69 7469 616c 697a 696e  int('Initializin
-000003b0: 6720 4745 4527 290d 0a20 2020 2065 652e  g GEE')..    ee.
-000003c0: 496e 6974 6961 6c69 7a65 2829 0d0a 2323  Initialize()..##
-000003d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000003e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000003f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00000400: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00000410: 2323 2323 0d0a 234d 6f64 756c 6520 666f  ####..#Module fo
-00000420: 7220 6765 7474 696e 6720 4c61 6e64 7361  r getting Landsa
-00000430: 742c 2053 656e 7469 6e65 6c20 3220 616e  t, Sentinel 2 an
-00000440: 6420 4d4f 4449 5320 696d 6167 6573 2f63  d MODIS images/c
-00000450: 6f6d 706f 7369 7465 730d 0a23 4465 6669  omposites..#Defi
-00000460: 6e65 2076 6973 7561 6c69 7a61 7469 6f6e  ne visualization
-00000470: 2070 6172 616d 6574 6572 730d 0a76 697a   parameters..viz
-00000480: 5061 7261 6d73 4661 6c73 6520 3d20 7b5c  ParamsFalse = {\
-00000490: 0d0a 2020 276d 696e 273a 2030 2e30 352c  ..  'min': 0.05,
-000004a0: 0d0a 2020 276d 6178 273a 205b 302e 352c  ..  'max': [0.5,
-000004b0: 302e 362c 302e 365d 2c0d 0a20 2027 6261  0.6,0.6],..  'ba
-000004c0: 6e64 7327 3a20 2773 7769 7231 2c6e 6972  nds': 'swir1,nir
-000004d0: 2c72 6564 272c 0d0a 2020 2767 616d 6d61  ,red',..  'gamma
-000004e0: 273a 2031 2e36 5c0d 0a7d 0d0a 7669 7a50  ': 1.6\..}..vizP
-000004f0: 6172 616d 7346 616c 7365 3130 6b20 3d20  aramsFalse10k = 
-00000500: 7b5c 0d0a 2020 276d 696e 273a 2030 2e30  {\..  'min': 0.0
-00000510: 352a 3130 3030 302c 0d0a 2020 276d 6178  5*10000,..  'max
-00000520: 273a 205b 302e 352a 3130 3030 302c 302e  ': [0.5*10000,0.
-00000530: 362a 3130 3030 302c 302e 362a 3130 3030  6*10000,0.6*1000
-00000540: 305d 2c0d 0a20 2027 6261 6e64 7327 3a20  0],..  'bands': 
-00000550: 2773 7769 7231 2c6e 6972 2c72 6564 272c  'swir1,nir,red',
-00000560: 0d0a 2020 2767 616d 6d61 273a 2031 2e36  ..  'gamma': 1.6
-00000570: 5c0d 0a7d 0d0a 7669 7a50 6172 616d 7354  \..}..vizParamsT
-00000580: 7275 6520 3d20 7b5c 0d0a 2020 276d 696e  rue = {\..  'min
-00000590: 273a 2030 2c0d 0a20 2027 6d61 7827 3a20  ': 0,..  'max': 
-000005a0: 5b30 2e32 2c30 2e32 2c30 2e32 5d2c 0d0a  [0.2,0.2,0.2],..
-000005b0: 2020 2762 616e 6473 273a 2027 7265 642c    'bands': 'red,
-000005c0: 6772 6565 6e2c 626c 7565 275c 0d0a 7d0d  green,blue'\..}.
-000005d0: 0a76 697a 5061 7261 6d73 5472 7565 3130  .vizParamsTrue10
-000005e0: 6b20 3d20 7b5c 0d0a 2020 276d 696e 273a  k = {\..  'min':
-000005f0: 2030 2c0d 0a20 2027 6d61 7827 3a20 5b30   0,..  'max': [0
-00000600: 2e32 2a31 3030 3030 2c30 2e32 2a31 3030  .2*10000,0.2*100
-00000610: 3030 2c30 2e32 2a31 3030 3030 5d2c 0d0a  00,0.2*10000],..
-00000620: 2020 2762 616e 6473 273a 2027 7265 642c    'bands': 'red,
-00000630: 6772 6565 6e2c 626c 7565 275c 0d0a 7d0d  green,blue'\..}.
-00000640: 0a0d 0a63 6f6d 6d6f 6e5f 7072 6f6a 6563  ...common_projec
-00000650: 7469 6f6e 7320 3d20 7b7d 0d0a 636f 6d6d  tions = {}..comm
-00000660: 6f6e 5f70 726f 6a65 6374 696f 6e73 5b27  on_projections['
-00000670: 4e4c 4344 5f43 4f4e 5553 275d 203d 207b  NLCD_CONUS'] = {
-00000680: 2763 7273 273a 2750 524f 4a43 535b 2241  'crs':'PROJCS["A
-00000690: 6c62 6572 735f 436f 6e69 6361 6c5f 4571  lbers_Conical_Eq
-000006a0: 7561 6c5f 4172 6561 222c 4745 4f47 4353  ual_Area",GEOGCS
-000006b0: 5b22 5747 5320 3834 222c 4441 5455 4d5b  ["WGS 84",DATUM[
-000006c0: 2257 4753 5f31 3938 3422 2c53 5048 4552  "WGS_1984",SPHER
-000006d0: 4f49 445b 2257 4753 2038 3422 2c36 3337  OID["WGS 84",637
-000006e0: 3831 3337 2c32 3938 2e32 3537 3232 3335  8137,298.2572235
-000006f0: 3633 2c41 5554 484f 5249 5459 5b22 4550  63,AUTHORITY["EP
-00000700: 5347 222c 2237 3033 3022 5d5d 2c54 4f57  SG","7030"]],TOW
-00000710: 4753 3834 5b30 2c30 2c30 2c30 2c30 2c30  GS84[0,0,0,0,0,0
-00000720: 2c30 5d2c 4155 5448 4f52 4954 595b 2245  ,0],AUTHORITY["E
-00000730: 5053 4722 2c22 3633 3236 225d 5d2c 5052  PSG","6326"]],PR
-00000740: 494d 454d 5b22 4772 6565 6e77 6963 6822  IMEM["Greenwich"
-00000750: 2c30 2c41 5554 484f 5249 5459 5b22 4550  ,0,AUTHORITY["EP
-00000760: 5347 222c 2238 3930 3122 5d5d 2c55 4e49  SG","8901"]],UNI
-00000770: 545b 2264 6567 7265 6522 2c30 2e30 3137  T["degree",0.017
-00000780: 3435 3332 3932 3531 3939 3433 332c 4155  4532925199433,AU
-00000790: 5448 4f52 4954 595b 2245 5053 4722 2c22  THORITY["EPSG","
-000007a0: 3931 3232 225d 5d2c 4155 5448 4f52 4954  9122"]],AUTHORIT
-000007b0: 595b 2245 5053 4722 2c22 3433 3236 225d  Y["EPSG","4326"]
-000007c0: 5d2c 5052 4f4a 4543 5449 4f4e 5b22 416c  ],PROJECTION["Al
-000007d0: 6265 7273 5f43 6f6e 6963 5f45 7175 616c  bers_Conic_Equal
-000007e0: 5f41 7265 6122 5d2c 5041 5241 4d45 5445  _Area"],PARAMETE
-000007f0: 525b 226c 6174 6974 7564 655f 6f66 5f63  R["latitude_of_c
-00000800: 656e 7465 7222 2c32 335d 2c50 4152 414d  enter",23],PARAM
-00000810: 4554 4552 5b22 6c6f 6e67 6974 7564 655f  ETER["longitude_
-00000820: 6f66 5f63 656e 7465 7222 2c2d 3936 5d2c  of_center",-96],
-00000830: 5041 5241 4d45 5445 525b 2273 7461 6e64  PARAMETER["stand
-00000840: 6172 645f 7061 7261 6c6c 656c 5f31 222c  ard_parallel_1",
-00000850: 3239 2e35 5d2c 5041 5241 4d45 5445 525b  29.5],PARAMETER[
-00000860: 2273 7461 6e64 6172 645f 7061 7261 6c6c  "standard_parall
-00000870: 656c 5f32 222c 3435 2e35 5d2c 5041 5241  el_2",45.5],PARA
-00000880: 4d45 5445 525b 2266 616c 7365 5f65 6173  METER["false_eas
-00000890: 7469 6e67 222c 305d 2c50 4152 414d 4554  ting",0],PARAMET
-000008a0: 4552 5b22 6661 6c73 655f 6e6f 7274 6869  ER["false_northi
-000008b0: 6e67 222c 305d 2c55 4e49 545b 226d 6574  ng",0],UNIT["met
-000008c0: 6572 7322 2c31 5d2c 4158 4953 5b22 4561  ers",1],AXIS["Ea
-000008d0: 7374 696e 6722 2c45 4153 545d 2c41 5849  sting",EAST],AXI
-000008e0: 535b 224e 6f72 7468 696e 6722 2c4e 4f52  S["Northing",NOR
-000008f0: 5448 5d5d 272c 0d0a 2020 2020 2020 2020  TH]]',..        
-00000900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000910: 2020 2020 2020 2774 7261 6e73 666f 726d        'transform
-00000920: 273a 205b 3330 2c30 2c2d 3233 3631 3931  ': [30,0,-236191
-00000930: 352e 302c 302c 2d33 302c 3331 3737 3733  5.0,0,-30,317773
-00000940: 352e 305d 7d0d 0a63 6f6d 6d6f 6e5f 7072  5.0]}..common_pr
-00000950: 6f6a 6563 7469 6f6e 735b 274e 4c43 445f  ojections['NLCD_
-00000960: 414b 275d 203d 207b 2763 7273 273a 2750  AK'] = {'crs':'P
-00000970: 524f 4a43 535b 2241 6c62 6572 735f 436f  ROJCS["Albers_Co
-00000980: 6e69 6361 6c5f 4571 7561 6c5f 4172 6561  nical_Equal_Area
-00000990: 222c 4745 4f47 4353 5b22 5747 5320 3834  ",GEOGCS["WGS 84
-000009a0: 222c 4441 5455 4d5b 2257 4753 5f31 3938  ",DATUM["WGS_198
-000009b0: 3422 2c53 5048 4552 4f49 445b 2257 4753  4",SPHEROID["WGS
-000009c0: 2038 3422 2c36 3337 3831 3337 2c32 3938   84",6378137,298
-000009d0: 2e32 3537 3232 3335 3633 2c41 5554 484f  .257223563,AUTHO
-000009e0: 5249 5459 5b22 4550 5347 222c 2237 3033  RITY["EPSG","703
-000009f0: 3022 5d5d 2c54 4f57 4753 3834 5b30 2c30  0"]],TOWGS84[0,0
-00000a00: 2c30 2c30 2c30 2c30 2c30 5d2c 4155 5448  ,0,0,0,0,0],AUTH
-00000a10: 4f52 4954 595b 2245 5053 4722 2c22 3633  ORITY["EPSG","63
-00000a20: 3236 225d 5d2c 5052 494d 454d 5b22 4772  26"]],PRIMEM["Gr
-00000a30: 6565 6e77 6963 6822 2c30 2c41 5554 484f  eenwich",0,AUTHO
-00000a40: 5249 5459 5b22 4550 5347 222c 2238 3930  RITY["EPSG","890
-00000a50: 3122 5d5d 2c55 4e49 545b 2264 6567 7265  1"]],UNIT["degre
-00000a60: 6522 2c30 2e30 3137 3435 3332 3932 3531  e",0.01745329251
-00000a70: 3939 3433 332c 4155 5448 4f52 4954 595b  99433,AUTHORITY[
-00000a80: 2245 5053 4722 2c22 3931 3038 225d 5d2c  "EPSG","9108"]],
-00000a90: 4155 5448 4f52 4954 595b 2245 5053 4722  AUTHORITY["EPSG"
-00000aa0: 2c22 3433 3236 225d 5d2c 5052 4f4a 4543  ,"4326"]],PROJEC
-00000ab0: 5449 4f4e 5b22 416c 6265 7273 5f43 6f6e  TION["Albers_Con
-00000ac0: 6963 5f45 7175 616c 5f41 7265 6122 5d2c  ic_Equal_Area"],
-00000ad0: 5041 5241 4d45 5445 525b 2273 7461 6e64  PARAMETER["stand
-00000ae0: 6172 645f 7061 7261 6c6c 656c 5f31 222c  ard_parallel_1",
-00000af0: 3535 5d2c 5041 5241 4d45 5445 525b 2273  55],PARAMETER["s
-00000b00: 7461 6e64 6172 645f 7061 7261 6c6c 656c  tandard_parallel
-00000b10: 5f32 222c 3635 5d2c 5041 5241 4d45 5445  _2",65],PARAMETE
-00000b20: 525b 226c 6174 6974 7564 655f 6f66 5f63  R["latitude_of_c
-00000b30: 656e 7465 7222 2c35 305d 2c50 4152 414d  enter",50],PARAM
-00000b40: 4554 4552 5b22 6c6f 6e67 6974 7564 655f  ETER["longitude_
-00000b50: 6f66 5f63 656e 7465 7222 2c2d 3135 345d  of_center",-154]
-00000b60: 2c50 4152 414d 4554 4552 5b22 6661 6c73  ,PARAMETER["fals
-00000b70: 655f 6561 7374 696e 6722 2c30 5d2c 5041  e_easting",0],PA
-00000b80: 5241 4d45 5445 525b 2266 616c 7365 5f6e  RAMETER["false_n
-00000b90: 6f72 7468 696e 6722 2c30 5d2c 554e 4954  orthing",0],UNIT
-00000ba0: 5b22 6d65 7465 7273 222c 315d 5d27 2c0d  ["meters",1]]',.
-00000bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00000bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000bd0: 2020 2027 7472 616e 7366 6f72 6d27 3a5b     'transform':[
-00000be0: 3330 2c30 2c2d 3438 3931 352e 302c 302c  30,0,-48915.0,0,
-00000bf0: 2d33 302c 3133 3139 3431 352e 305d 7d0d  -30,1319415.0]}.
-00000c00: 0a63 6f6d 6d6f 6e5f 7072 6f6a 6563 7469  .common_projecti
-00000c10: 6f6e 735b 274e 4c43 445f 4849 275d 203d  ons['NLCD_HI'] =
-00000c20: 207b 2763 7273 273a 2750 524f 4a43 535b   {'crs':'PROJCS[
-00000c30: 2241 6c62 6572 735f 436f 6e69 6361 6c5f  "Albers_Conical_
-00000c40: 4571 7561 6c5f 4172 6561 222c 4745 4f47  Equal_Area",GEOG
-00000c50: 4353 5b22 5747 5320 3834 222c 4441 5455  CS["WGS 84",DATU
-00000c60: 4d5b 2257 4753 5f31 3938 3422 2c20 5350  M["WGS_1984", SP
-00000c70: 4845 524f 4944 5b22 5747 5320 3834 222c  HEROID["WGS 84",
-00000c80: 2036 3337 3831 3337 2e30 2c20 3239 382e   6378137.0, 298.
-00000c90: 3235 3732 3233 3536 332c 2041 5554 484f  257223563, AUTHO
-00000ca0: 5249 5459 5b22 4550 5347 222c 2237 3033  RITY["EPSG","703
-00000cb0: 3022 5d5d 2c20 4155 5448 4f52 4954 595b  0"]], AUTHORITY[
-00000cc0: 2245 5053 4722 2c22 3633 3236 225d 5d2c  "EPSG","6326"]],
-00000cd0: 2050 5249 4d45 4d5b 2247 7265 656e 7769   PRIMEM["Greenwi
-00000ce0: 6368 222c 2030 2e30 5d2c 2055 4e49 545b  ch", 0.0], UNIT[
-00000cf0: 2264 6567 7265 6522 2c20 302e 3031 3734  "degree", 0.0174
-00000d00: 3533 3239 3235 3139 3934 3332 3935 5d2c  53292519943295],
-00000d10: 2041 5849 535b 224c 6f6e 6769 7475 6465   AXIS["Longitude
-00000d20: 222c 2045 4153 545d 2c20 4158 4953 5b22  ", EAST], AXIS["
-00000d30: 4c61 7469 7475 6465 222c 204e 4f52 5448  Latitude", NORTH
-00000d40: 5d2c 2041 5554 484f 5249 5459 5b22 4550  ], AUTHORITY["EP
-00000d50: 5347 222c 2234 3332 3622 5d5d 2c20 5052  SG","4326"]], PR
-00000d60: 4f4a 4543 5449 4f4e 5b22 416c 6265 7273  OJECTION["Albers
-00000d70: 5f43 6f6e 6963 5f45 7175 616c 5f41 7265  _Conic_Equal_Are
-00000d80: 6122 5d2c 2050 4152 414d 4554 4552 5b22  a"], PARAMETER["
-00000d90: 6365 6e74 7261 6c5f 6d65 7269 6469 616e  central_meridian
-00000da0: 222c 202d 3135 372e 305d 2c50 4152 414d  ", -157.0],PARAM
-00000db0: 4554 4552 5b22 6c61 7469 7475 6465 5f6f  ETER["latitude_o
-00000dc0: 665f 6f72 6967 696e 222c 2033 2e30 5d2c  f_origin", 3.0],
-00000dd0: 5041 5241 4d45 5445 525b 2273 7461 6e64  PARAMETER["stand
-00000de0: 6172 645f 7061 7261 6c6c 656c 5f31 222c  ard_parallel_1",
-00000df0: 2038 2e30 5d2c 5041 5241 4d45 5445 525b   8.0],PARAMETER[
-00000e00: 2266 616c 7365 5f65 6173 7469 6e67 222c  "false_easting",
-00000e10: 2030 2e30 5d2c 5041 5241 4d45 5445 525b   0.0],PARAMETER[
-00000e20: 2266 616c 7365 5f6e 6f72 7468 696e 6722  "false_northing"
-00000e30: 2c20 302e 305d 2c50 4152 414d 4554 4552  , 0.0],PARAMETER
-00000e40: 5b22 7374 616e 6461 7264 5f70 6172 616c  ["standard_paral
-00000e50: 6c65 6c5f 3222 2c20 3138 2e30 5d2c 554e  lel_2", 18.0],UN
-00000e60: 4954 5b22 6d22 2c20 312e 305d 2c41 5849  IT["m", 1.0],AXI
-00000e70: 535b 2278 222c 2045 4153 545d 2c41 5849  S["x", EAST],AXI
-00000e80: 535b 2279 222c 204e 4f52 5448 5d5d 272c  S["y", NORTH]]',
-00000e90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00000ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000eb0: 2020 2020 2774 7261 6e73 666f 726d 273a      'transform':
-00000ec0: 5b33 302c 302c 2d33 3432 3538 352c 302c  [30,0,-342585,0,
-00000ed0: 2d33 302c 3231 3237 3133 355d 7d0d 0a0d  -30,2127135]}...
-00000ee0: 0a23 4469 7265 6374 696f 6e20 6f66 2020  .#Direction of  
-00000ef0: 6120 6465 6372 6561 7365 2069 6e20 7068  a decrease in ph
-00000f00: 6f74 6f73 796e 7468 6574 6963 2076 6567  otosynthetic veg
-00000f10: 6574 6174 696f 6e2d 2061 6464 2061 6e79  etation- add any
-00000f20: 2074 6861 7420 6172 6520 6d69 7373 696e   that are missin
-00000f30: 670d 0a63 6861 6e67 6544 6972 4469 6374  g..changeDirDict
-00000f40: 203d 207b 5c0d 0a22 626c 7565 223a 312c   = {\.."blue":1,
-00000f50: 2267 7265 656e 223a 312c 2272 6564 223a  "green":1,"red":
-00000f60: 312c 226e 6972 223a 2d31 2c22 7377 6972  1,"nir":-1,"swir
-00000f70: 3122 3a31 2c22 7377 6972 3222 3a31 2c22  1":1,"swir2":1,"
-00000f80: 7465 6d70 223a 312c 5c0d 0a22 4e44 5649  temp":1,\.."NDVI
-00000f90: 223a 2d31 2c22 4e42 5222 3a2d 312c 224e  ":-1,"NBR":-1,"N
-00000fa0: 444d 4922 3a2d 312c 224e 4453 4922 3a31  DMI":-1,"NDSI":1
-00000fb0: 2c5c 0d0a 2262 7269 6768 746e 6573 7322  ,\.."brightness"
-00000fc0: 3a31 2c22 6772 6565 6e6e 6573 7322 3a2d  :1,"greenness":-
-00000fd0: 312c 2277 6574 6e65 7373 223a 2d31 2c22  1,"wetness":-1,"
-00000fe0: 666f 7572 7468 223a 2d31 2c22 6669 6674  fourth":-1,"fift
-00000ff0: 6822 3a31 2c22 7369 7874 6822 3a2d 312c  h":1,"sixth":-1,
-00001000: 5c0d 0a22 4e44 5f62 6c75 655f 6772 6565  \.."ND_blue_gree
-00001010: 6e22 3a2d 312c 224e 445f 626c 7565 5f72  n":-1,"ND_blue_r
-00001020: 6564 223a 2d31 2c22 4e44 5f62 6c75 655f  ed":-1,"ND_blue_
-00001030: 6e69 7222 3a31 2c22 4e44 5f62 6c75 655f  nir":1,"ND_blue_
-00001040: 7377 6972 3122 3a2d 312c 224e 445f 626c  swir1":-1,"ND_bl
-00001050: 7565 5f73 7769 7232 223a 2d31 2c5c 0d0a  ue_swir2":-1,\..
-00001060: 224e 445f 6772 6565 6e5f 7265 6422 3a2d  "ND_green_red":-
-00001070: 312c 224e 445f 6772 6565 6e5f 6e69 7222  1,"ND_green_nir"
-00001080: 3a31 2c22 4e44 5f67 7265 656e 5f73 7769  :1,"ND_green_swi
-00001090: 7231 223a 2d31 2c22 4e44 5f67 7265 656e  r1":-1,"ND_green
-000010a0: 5f73 7769 7232 223a 2d31 2c22 4e44 5f72  _swir2":-1,"ND_r
-000010b0: 6564 5f73 7769 7231 223a 2d31 2c5c 0d0a  ed_swir1":-1,\..
-000010c0: 224e 445f 7265 645f 7377 6972 3222 3a2d  "ND_red_swir2":-
-000010d0: 312c 224e 445f 6e69 725f 7265 6422 3a2d  1,"ND_nir_red":-
-000010e0: 312c 224e 445f 6e69 725f 7377 6972 3122  1,"ND_nir_swir1"
-000010f0: 3a2d 312c 224e 445f 6e69 725f 7377 6972  :-1,"ND_nir_swir
-00001100: 3222 3a2d 312c 224e 445f 7377 6972 315f  2":-1,"ND_swir1_
-00001110: 7377 6972 3222 3a2d 312c 5c0d 0a22 525f  swir2":-1,\.."R_
-00001120: 7377 6972 315f 6e69 7222 3a31 2c22 525f  swir1_nir":1,"R_
-00001130: 7265 645f 7377 6972 3122 3a2d 312c 2245  red_swir1":-1,"E
-00001140: 5649 223a 2d31 2c22 5341 5649 223a 2d31  VI":-1,"SAVI":-1
-00001150: 2c22 4942 4922 3a31 2c5c 0d0a 2274 6341  ,"IBI":1,\.."tcA
-00001160: 6e67 6c65 4247 223a 2d31 2c22 7463 416e  ngleBG":-1,"tcAn
-00001170: 676c 6547 5722 3a2d 312c 2274 6341 6e67  gleGW":-1,"tcAng
-00001180: 6c65 4257 223a 2d31 2c22 7463 4469 7374  leBW":-1,"tcDist
-00001190: 4247 223a 312c 2274 6344 6973 7447 5722  BG":1,"tcDistGW"
-000011a0: 3a31 2c22 7463 4469 7374 4257 223a 312c  :1,"tcDistBW":1,
-000011b0: 5c0d 0a27 4e49 5276 273a 2d31 2c27 4e44  \..'NIRv':-1,'ND
-000011c0: 4349 273a 2d31 2c27 4e44 4749 273a 2d31  CI':-1,'NDGI':-1
-000011d0: 5c0d 0a7d 0d0a 0d0a 0d0a 2350 7265 636f  \..}......#Preco
-000011e0: 6d70 7574 6564 2063 6c6f 7564 7363 6f72  mputed cloudscor
-000011f0: 6520 6f66 6673 6574 7320 616e 6420 5444  e offsets and TD
-00001200: 4f4d 2073 7461 7473 0d0a 2354 6865 7365  OM stats..#These
-00001210: 2068 6176 6520 6265 656e 2070 7265 2d63   have been pre-c
-00001220: 6f6d 7075 7465 6420 666f 7220 616c 6c20  omputed for all 
-00001230: 434f 4e55 5320 666f 7220 4c61 6e64 7361  CONUS for Landsa
-00001240: 7420 616e 6420 5365 7469 6e65 6c20 3220  t and Setinel 2 
-00001250: 2873 6570 6172 6174 656c 7929 0d0a 2361  (separately)..#a
-00001260: 6e64 2061 7265 2061 7070 726f 7072 6961  nd are appropria
-00001270: 7465 2074 6f20 7573 6520 666f 7220 616e  te to use for an
-00001280: 7920 7469 6d65 2070 6572 696f 6420 7769  y time period wi
-00001290: 7468 696e 2074 6865 2067 726f 7769 6e67  thin the growing
-000012a0: 2073 6561 736f 6e0d 0a23 5468 6520 636c   season..#The cl
-000012b0: 6f75 6453 636f 7265 206f 6666 7365 7420  oudScore offset 
-000012c0: 6973 2067 656e 6572 616c 6c79 2073 6f6d  is generally som
-000012d0: 6520 6c6f 7765 7220 7065 7263 656e 7469  e lower percenti
-000012e0: 6c65 206f 6620 636c 6f75 6453 636f 7265  le of cloudScore
-000012f0: 7320 6f6e 2061 2070 6978 656c 2d77 6973  s on a pixel-wis
-00001300: 6520 6261 7369 730d 0a23 5468 6520 5444  e basis..#The TD
-00001310: 4f4d 2073 7461 7473 2061 7265 2074 6865  OM stats are the
-00001320: 206d 6561 6e20 616e 6420 7374 616e 6461   mean and standa
-00001330: 7264 2064 6576 6961 7469 6f6e 7320 6f66  rd deviations of
-00001340: 2074 6865 2074 776f 2062 616e 6473 2075   the two bands u
-00001350: 7365 6420 696e 2054 444f 4d0d 0a23 4279  sed in TDOM..#By
-00001360: 2064 6566 6175 6c74 2c20 5444 4f4d 2075   default, TDOM u
-00001370: 7365 7320 7468 6520 6e69 7220 616e 6420  ses the nir and 
-00001380: 7377 6972 3120 6261 6e64 730d 0a70 7265  swir1 bands..pre
-00001390: 436f 6d70 7574 6564 436c 6f75 6453 636f  ComputedCloudSco
-000013a0: 7265 4f66 6673 6574 203d 2065 652e 496d  reOffset = ee.Im
-000013b0: 6167 6543 6f6c 6c65 6374 696f 6e28 2770  ageCollection('p
-000013c0: 726f 6a65 6374 732f 6c63 6d73 2d74 6363  rojects/lcms-tcc
-000013d0: 2d73 6861 7265 642f 6173 7365 7473 2f43  -shared/assets/C
-000013e0: 532d 5444 4f4d 2d53 7461 7473 2f63 6c6f  S-TDOM-Stats/clo
-000013f0: 7564 5363 6f72 6527 292e 6d6f 7361 6963  udScore').mosaic
-00001400: 2829 0d0a 7072 6543 6f6d 7075 7465 6454  ()..preComputedT
-00001410: 444f 4d53 7461 7473 203d 2065 652e 496d  DOMStats = ee.Im
-00001420: 6167 6543 6f6c 6c65 6374 696f 6e28 2770  ageCollection('p
-00001430: 726f 6a65 6374 732f 6c63 6d73 2d74 6363  rojects/lcms-tcc
-00001440: 2d73 6861 7265 642f 6173 7365 7473 2f43  -shared/assets/C
-00001450: 532d 5444 4f4d 2d53 7461 7473 2f54 444f  S-TDOM-Stats/TDO
-00001460: 4d27 292e 6669 6c74 6572 2865 652e 4669  M').filter(ee.Fi
-00001470: 6c74 6572 2e65 7128 2765 6e64 5965 6172  lter.eq('endYear
-00001480: 272c 3230 3139 2929 2e6d 6f73 6169 6328  ',2019)).mosaic(
-00001490: 292e 6469 7669 6465 2831 3030 3030 290d  ).divide(10000).
-000014a0: 0a0d 0a0d 0a64 6566 2067 6574 5072 6563  .....def getPrec
-000014b0: 6f6d 7075 7465 6443 6c6f 7564 5363 6f72  omputedCloudScor
-000014c0: 654f 6666 7365 7473 2863 6c6f 7564 5363  eOffsets(cloudSc
-000014d0: 6f72 6550 6374 6c20 3d20 3130 293a 0d0a  orePctl = 10):..
-000014e0: 2020 7265 7475 726e 207b 276c 616e 6473    return {'lands
-000014f0: 6174 273a 2070 7265 436f 6d70 7574 6564  at': preComputed
-00001500: 436c 6f75 6453 636f 7265 4f66 6673 6574  CloudScoreOffset
-00001510: 2e73 656c 6563 7428 5b27 4c61 6e64 7361  .select(['Landsa
-00001520: 745f 436c 6f75 6453 636f 7265 5f70 7b7d  t_CloudScore_p{}
-00001530: 272e 666f 726d 6174 2863 6c6f 7564 5363  '.format(cloudSc
-00001540: 6f72 6550 6374 6c29 5d29 2c0d 0a20 2020  orePctl)]),..   
-00001550: 2020 2020 2020 2027 7365 6e74 696e 656c         'sentinel
-00001560: 3227 3a70 7265 436f 6d70 7574 6564 436c  2':preComputedCl
-00001570: 6f75 6453 636f 7265 4f66 6673 6574 2e73  oudScoreOffset.s
-00001580: 656c 6563 7428 5b27 5365 6e74 696e 656c  elect(['Sentinel
-00001590: 325f 436c 6f75 6453 636f 7265 5f70 7b7d  2_CloudScore_p{}
-000015a0: 272e 666f 726d 6174 2863 6c6f 7564 5363  '.format(cloudSc
-000015b0: 6f72 6550 6374 6c29 5d29 0d0a 2020 2020  orePctl)])..    
-000015c0: 2020 2020 2020 7d0d 0a0d 0a64 6566 2067        }....def g
-000015d0: 6574 5072 6563 6f6d 7075 7465 6454 444f  etPrecomputedTDO
-000015e0: 4d53 7461 7473 2829 3a0d 0a20 2072 6574  MStats():..  ret
-000015f0: 7572 6e20 7b27 6c61 6e64 7361 7427 3a20  urn {'landsat': 
-00001600: 7b0d 0a20 2020 2020 2020 2020 2020 2020  {..             
-00001610: 2020 2020 2020 2020 2027 6d65 616e 273a           'mean':
-00001620: 7072 6543 6f6d 7075 7465 6454 444f 4d53  preComputedTDOMS
-00001630: 7461 7473 2e73 656c 6563 7428 5b27 4c61  tats.select(['La
-00001640: 6e64 7361 745f 6e69 725f 6d65 616e 272c  ndsat_nir_mean',
-00001650: 274c 616e 6473 6174 5f73 7769 7231 5f6d  'Landsat_swir1_m
-00001660: 6561 6e27 5d29 2c0d 0a20 2020 2020 2020  ean']),..       
-00001670: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00001680: 7374 6444 6576 273a 7072 6543 6f6d 7075  stdDev':preCompu
-00001690: 7465 6454 444f 4d53 7461 7473 2e73 656c  tedTDOMStats.sel
-000016a0: 6563 7428 5b27 4c61 6e64 7361 745f 6e69  ect(['Landsat_ni
-000016b0: 725f 7374 6444 6576 272c 274c 616e 6473  r_stdDev','Lands
-000016c0: 6174 5f73 7769 7231 5f73 7464 4465 7627  at_swir1_stdDev'
-000016d0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-000016e0: 2020 2020 2020 2020 2020 7d2c 0d0a 2020            },..  
-000016f0: 2020 2020 2020 2020 2773 656e 7469 6e65          'sentine
-00001700: 6c32 273a 207b 0d0a 2020 2020 2020 2020  l2': {..        
-00001710: 2020 2020 2020 2020 2020 2020 2020 276d                'm
-00001720: 6561 6e27 3a70 7265 436f 6d70 7574 6564  ean':preComputed
-00001730: 5444 4f4d 5374 6174 732e 7365 6c65 6374  TDOMStats.select
-00001740: 285b 2753 656e 7469 6e65 6c32 5f6e 6972  (['Sentinel2_nir
-00001750: 5f6d 6561 6e27 2c27 5365 6e74 696e 656c  _mean','Sentinel
-00001760: 325f 7377 6972 315f 6d65 616e 275d 292c  2_swir1_mean']),
-00001770: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00001780: 2020 2020 2020 2020 2773 7464 4465 7627          'stdDev'
-00001790: 3a70 7265 436f 6d70 7574 6564 5444 4f4d  :preComputedTDOM
-000017a0: 5374 6174 732e 7365 6c65 6374 285b 2753  Stats.select(['S
-000017b0: 656e 7469 6e65 6c32 5f6e 6972 5f73 7464  entinel2_nir_std
-000017c0: 4465 7627 2c27 5365 6e74 696e 656c 325f  Dev','Sentinel2_
-000017d0: 7377 6972 315f 7374 6444 6576 275d 290d  swir1_stdDev']).
-000017e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000017f0: 2020 2020 2020 207d 0d0a 2020 2020 2020         }..      
-00001800: 2020 2020 7d0d 0a0d 0a0d 0a0d 0a23 2323      }........###
+00000360: 7274 2054 6872 6561 640d 0a23 2323 2323  rt Thread..#####
+00000370: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00000380: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00000390: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000003a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000003b0: 230d 0a23 4d6f 6475 6c65 2066 6f72 2067  #..#Module for g
+000003c0: 6574 7469 6e67 204c 616e 6473 6174 2c20  etting Landsat, 
+000003d0: 5365 6e74 696e 656c 2032 2061 6e64 204d  Sentinel 2 and M
+000003e0: 4f44 4953 2069 6d61 6765 732f 636f 6d70  ODIS images/comp
+000003f0: 6f73 6974 6573 0d0a 2344 6566 696e 6520  osites..#Define 
+00000400: 7669 7375 616c 697a 6174 696f 6e20 7061  visualization pa
+00000410: 7261 6d65 7465 7273 0d0a 7669 7a50 6172  rameters..vizPar
+00000420: 616d 7346 616c 7365 203d 207b 5c0d 0a20  amsFalse = {\.. 
+00000430: 2027 6d69 6e27 3a20 302e 3035 2c0d 0a20   'min': 0.05,.. 
+00000440: 2027 6d61 7827 3a20 5b30 2e35 2c30 2e36   'max': [0.5,0.6
+00000450: 2c30 2e36 5d2c 0d0a 2020 2762 616e 6473  ,0.6],..  'bands
+00000460: 273a 2027 7377 6972 312c 6e69 722c 7265  ': 'swir1,nir,re
+00000470: 6427 2c0d 0a20 2027 6761 6d6d 6127 3a20  d',..  'gamma': 
+00000480: 312e 365c 0d0a 7d0d 0a76 697a 5061 7261  1.6\..}..vizPara
+00000490: 6d73 4661 6c73 6531 306b 203d 207b 5c0d  msFalse10k = {\.
+000004a0: 0a20 2027 6d69 6e27 3a20 302e 3035 2a31  .  'min': 0.05*1
+000004b0: 3030 3030 2c0d 0a20 2027 6d61 7827 3a20  0000,..  'max': 
+000004c0: 5b30 2e35 2a31 3030 3030 2c30 2e36 2a31  [0.5*10000,0.6*1
+000004d0: 3030 3030 2c30 2e36 2a31 3030 3030 5d2c  0000,0.6*10000],
+000004e0: 0d0a 2020 2762 616e 6473 273a 2027 7377  ..  'bands': 'sw
+000004f0: 6972 312c 6e69 722c 7265 6427 2c0d 0a20  ir1,nir,red',.. 
+00000500: 2027 6761 6d6d 6127 3a20 312e 365c 0d0a   'gamma': 1.6\..
+00000510: 7d0d 0a76 697a 5061 7261 6d73 5472 7565  }..vizParamsTrue
+00000520: 203d 207b 5c0d 0a20 2027 6d69 6e27 3a20   = {\..  'min': 
+00000530: 302c 0d0a 2020 276d 6178 273a 205b 302e  0,..  'max': [0.
+00000540: 322c 302e 322c 302e 325d 2c0d 0a20 2027  2,0.2,0.2],..  '
+00000550: 6261 6e64 7327 3a20 2772 6564 2c67 7265  bands': 'red,gre
+00000560: 656e 2c62 6c75 6527 5c0d 0a7d 0d0a 7669  en,blue'\..}..vi
+00000570: 7a50 6172 616d 7354 7275 6531 306b 203d  zParamsTrue10k =
+00000580: 207b 5c0d 0a20 2027 6d69 6e27 3a20 302c   {\..  'min': 0,
+00000590: 0d0a 2020 276d 6178 273a 205b 302e 322a  ..  'max': [0.2*
+000005a0: 3130 3030 302c 302e 322a 3130 3030 302c  10000,0.2*10000,
+000005b0: 302e 322a 3130 3030 305d 2c0d 0a20 2027  0.2*10000],..  '
+000005c0: 6261 6e64 7327 3a20 2772 6564 2c67 7265  bands': 'red,gre
+000005d0: 656e 2c62 6c75 6527 5c0d 0a7d 0d0a 0d0a  en,blue'\..}....
+000005e0: 636f 6d6d 6f6e 5f70 726f 6a65 6374 696f  common_projectio
+000005f0: 6e73 203d 207b 7d0d 0a63 6f6d 6d6f 6e5f  ns = {}..common_
+00000600: 7072 6f6a 6563 7469 6f6e 735b 274e 4c43  projections['NLC
+00000610: 445f 434f 4e55 5327 5d20 3d20 7b27 6372  D_CONUS'] = {'cr
+00000620: 7327 3a27 5052 4f4a 4353 5b22 416c 6265  s':'PROJCS["Albe
+00000630: 7273 5f43 6f6e 6963 616c 5f45 7175 616c  rs_Conical_Equal
+00000640: 5f41 7265 6122 2c47 454f 4743 535b 2257  _Area",GEOGCS["W
+00000650: 4753 2038 3422 2c44 4154 554d 5b22 5747  GS 84",DATUM["WG
+00000660: 535f 3139 3834 222c 5350 4845 524f 4944  S_1984",SPHEROID
+00000670: 5b22 5747 5320 3834 222c 3633 3738 3133  ["WGS 84",637813
+00000680: 372c 3239 382e 3235 3732 3233 3536 332c  7,298.257223563,
+00000690: 4155 5448 4f52 4954 595b 2245 5053 4722  AUTHORITY["EPSG"
+000006a0: 2c22 3730 3330 225d 5d2c 544f 5747 5338  ,"7030"]],TOWGS8
+000006b0: 345b 302c 302c 302c 302c 302c 302c 305d  4[0,0,0,0,0,0,0]
+000006c0: 2c41 5554 484f 5249 5459 5b22 4550 5347  ,AUTHORITY["EPSG
+000006d0: 222c 2236 3332 3622 5d5d 2c50 5249 4d45  ","6326"]],PRIME
+000006e0: 4d5b 2247 7265 656e 7769 6368 222c 302c  M["Greenwich",0,
+000006f0: 4155 5448 4f52 4954 595b 2245 5053 4722  AUTHORITY["EPSG"
+00000700: 2c22 3839 3031 225d 5d2c 554e 4954 5b22  ,"8901"]],UNIT["
+00000710: 6465 6772 6565 222c 302e 3031 3734 3533  degree",0.017453
+00000720: 3239 3235 3139 3934 3333 2c41 5554 484f  2925199433,AUTHO
+00000730: 5249 5459 5b22 4550 5347 222c 2239 3132  RITY["EPSG","912
+00000740: 3222 5d5d 2c41 5554 484f 5249 5459 5b22  2"]],AUTHORITY["
+00000750: 4550 5347 222c 2234 3332 3622 5d5d 2c50  EPSG","4326"]],P
+00000760: 524f 4a45 4354 494f 4e5b 2241 6c62 6572  ROJECTION["Alber
+00000770: 735f 436f 6e69 635f 4571 7561 6c5f 4172  s_Conic_Equal_Ar
+00000780: 6561 225d 2c50 4152 414d 4554 4552 5b22  ea"],PARAMETER["
+00000790: 6c61 7469 7475 6465 5f6f 665f 6365 6e74  latitude_of_cent
+000007a0: 6572 222c 3233 5d2c 5041 5241 4d45 5445  er",23],PARAMETE
+000007b0: 525b 226c 6f6e 6769 7475 6465 5f6f 665f  R["longitude_of_
+000007c0: 6365 6e74 6572 222c 2d39 365d 2c50 4152  center",-96],PAR
+000007d0: 414d 4554 4552 5b22 7374 616e 6461 7264  AMETER["standard
+000007e0: 5f70 6172 616c 6c65 6c5f 3122 2c32 392e  _parallel_1",29.
+000007f0: 355d 2c50 4152 414d 4554 4552 5b22 7374  5],PARAMETER["st
+00000800: 616e 6461 7264 5f70 6172 616c 6c65 6c5f  andard_parallel_
+00000810: 3222 2c34 352e 355d 2c50 4152 414d 4554  2",45.5],PARAMET
+00000820: 4552 5b22 6661 6c73 655f 6561 7374 696e  ER["false_eastin
+00000830: 6722 2c30 5d2c 5041 5241 4d45 5445 525b  g",0],PARAMETER[
+00000840: 2266 616c 7365 5f6e 6f72 7468 696e 6722  "false_northing"
+00000850: 2c30 5d2c 554e 4954 5b22 6d65 7465 7273  ,0],UNIT["meters
+00000860: 222c 315d 2c41 5849 535b 2245 6173 7469  ",1],AXIS["Easti
+00000870: 6e67 222c 4541 5354 5d2c 4158 4953 5b22  ng",EAST],AXIS["
+00000880: 4e6f 7274 6869 6e67 222c 4e4f 5254 485d  Northing",NORTH]
+00000890: 5d27 2c0d 0a20 2020 2020 2020 2020 2020  ]',..           
+000008a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000008b0: 2020 2027 7472 616e 7366 6f72 6d27 3a20     'transform': 
+000008c0: 5b33 302c 302c 2d32 3336 3139 3135 2e30  [30,0,-2361915.0
+000008d0: 2c30 2c2d 3330 2c33 3137 3737 3335 2e30  ,0,-30,3177735.0
+000008e0: 5d7d 0d0a 636f 6d6d 6f6e 5f70 726f 6a65  ]}..common_proje
+000008f0: 6374 696f 6e73 5b27 4e4c 4344 5f41 4b27  ctions['NLCD_AK'
+00000900: 5d20 3d20 7b27 6372 7327 3a27 5052 4f4a  ] = {'crs':'PROJ
+00000910: 4353 5b22 416c 6265 7273 5f43 6f6e 6963  CS["Albers_Conic
+00000920: 616c 5f45 7175 616c 5f41 7265 6122 2c47  al_Equal_Area",G
+00000930: 454f 4743 535b 2257 4753 2038 3422 2c44  EOGCS["WGS 84",D
+00000940: 4154 554d 5b22 5747 535f 3139 3834 222c  ATUM["WGS_1984",
+00000950: 5350 4845 524f 4944 5b22 5747 5320 3834  SPHEROID["WGS 84
+00000960: 222c 3633 3738 3133 372c 3239 382e 3235  ",6378137,298.25
+00000970: 3732 3233 3536 332c 4155 5448 4f52 4954  7223563,AUTHORIT
+00000980: 595b 2245 5053 4722 2c22 3730 3330 225d  Y["EPSG","7030"]
+00000990: 5d2c 544f 5747 5338 345b 302c 302c 302c  ],TOWGS84[0,0,0,
+000009a0: 302c 302c 302c 305d 2c41 5554 484f 5249  0,0,0,0],AUTHORI
+000009b0: 5459 5b22 4550 5347 222c 2236 3332 3622  TY["EPSG","6326"
+000009c0: 5d5d 2c50 5249 4d45 4d5b 2247 7265 656e  ]],PRIMEM["Green
+000009d0: 7769 6368 222c 302c 4155 5448 4f52 4954  wich",0,AUTHORIT
+000009e0: 595b 2245 5053 4722 2c22 3839 3031 225d  Y["EPSG","8901"]
+000009f0: 5d2c 554e 4954 5b22 6465 6772 6565 222c  ],UNIT["degree",
+00000a00: 302e 3031 3734 3533 3239 3235 3139 3934  0.01745329251994
+00000a10: 3333 2c41 5554 484f 5249 5459 5b22 4550  33,AUTHORITY["EP
+00000a20: 5347 222c 2239 3130 3822 5d5d 2c41 5554  SG","9108"]],AUT
+00000a30: 484f 5249 5459 5b22 4550 5347 222c 2234  HORITY["EPSG","4
+00000a40: 3332 3622 5d5d 2c50 524f 4a45 4354 494f  326"]],PROJECTIO
+00000a50: 4e5b 2241 6c62 6572 735f 436f 6e69 635f  N["Albers_Conic_
+00000a60: 4571 7561 6c5f 4172 6561 225d 2c50 4152  Equal_Area"],PAR
+00000a70: 414d 4554 4552 5b22 7374 616e 6461 7264  AMETER["standard
+00000a80: 5f70 6172 616c 6c65 6c5f 3122 2c35 355d  _parallel_1",55]
+00000a90: 2c50 4152 414d 4554 4552 5b22 7374 616e  ,PARAMETER["stan
+00000aa0: 6461 7264 5f70 6172 616c 6c65 6c5f 3222  dard_parallel_2"
+00000ab0: 2c36 355d 2c50 4152 414d 4554 4552 5b22  ,65],PARAMETER["
+00000ac0: 6c61 7469 7475 6465 5f6f 665f 6365 6e74  latitude_of_cent
+00000ad0: 6572 222c 3530 5d2c 5041 5241 4d45 5445  er",50],PARAMETE
+00000ae0: 525b 226c 6f6e 6769 7475 6465 5f6f 665f  R["longitude_of_
+00000af0: 6365 6e74 6572 222c 2d31 3534 5d2c 5041  center",-154],PA
+00000b00: 5241 4d45 5445 525b 2266 616c 7365 5f65  RAMETER["false_e
+00000b10: 6173 7469 6e67 222c 305d 2c50 4152 414d  asting",0],PARAM
+00000b20: 4554 4552 5b22 6661 6c73 655f 6e6f 7274  ETER["false_nort
+00000b30: 6869 6e67 222c 305d 2c55 4e49 545b 226d  hing",0],UNIT["m
+00000b40: 6574 6572 7322 2c31 5d5d 272c 0d0a 2020  eters",1]]',..  
+00000b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000b70: 2774 7261 6e73 666f 726d 273a 5b33 302c  'transform':[30,
+00000b80: 302c 2d34 3839 3135 2e30 2c30 2c2d 3330  0,-48915.0,0,-30
+00000b90: 2c31 3331 3934 3135 2e30 5d7d 0d0a 636f  ,1319415.0]}..co
+00000ba0: 6d6d 6f6e 5f70 726f 6a65 6374 696f 6e73  mmon_projections
+00000bb0: 5b27 4e4c 4344 5f48 4927 5d20 3d20 7b27  ['NLCD_HI'] = {'
+00000bc0: 6372 7327 3a27 5052 4f4a 4353 5b22 416c  crs':'PROJCS["Al
+00000bd0: 6265 7273 5f43 6f6e 6963 616c 5f45 7175  bers_Conical_Equ
+00000be0: 616c 5f41 7265 6122 2c47 454f 4743 535b  al_Area",GEOGCS[
+00000bf0: 2257 4753 2038 3422 2c44 4154 554d 5b22  "WGS 84",DATUM["
+00000c00: 5747 535f 3139 3834 222c 2053 5048 4552  WGS_1984", SPHER
+00000c10: 4f49 445b 2257 4753 2038 3422 2c20 3633  OID["WGS 84", 63
+00000c20: 3738 3133 372e 302c 2032 3938 2e32 3537  78137.0, 298.257
+00000c30: 3232 3335 3633 2c20 4155 5448 4f52 4954  223563, AUTHORIT
+00000c40: 595b 2245 5053 4722 2c22 3730 3330 225d  Y["EPSG","7030"]
+00000c50: 5d2c 2041 5554 484f 5249 5459 5b22 4550  ], AUTHORITY["EP
+00000c60: 5347 222c 2236 3332 3622 5d5d 2c20 5052  SG","6326"]], PR
+00000c70: 494d 454d 5b22 4772 6565 6e77 6963 6822  IMEM["Greenwich"
+00000c80: 2c20 302e 305d 2c20 554e 4954 5b22 6465  , 0.0], UNIT["de
+00000c90: 6772 6565 222c 2030 2e30 3137 3435 3332  gree", 0.0174532
+00000ca0: 3932 3531 3939 3433 3239 355d 2c20 4158  92519943295], AX
+00000cb0: 4953 5b22 4c6f 6e67 6974 7564 6522 2c20  IS["Longitude", 
+00000cc0: 4541 5354 5d2c 2041 5849 535b 224c 6174  EAST], AXIS["Lat
+00000cd0: 6974 7564 6522 2c20 4e4f 5254 485d 2c20  itude", NORTH], 
+00000ce0: 4155 5448 4f52 4954 595b 2245 5053 4722  AUTHORITY["EPSG"
+00000cf0: 2c22 3433 3236 225d 5d2c 2050 524f 4a45  ,"4326"]], PROJE
+00000d00: 4354 494f 4e5b 2241 6c62 6572 735f 436f  CTION["Albers_Co
+00000d10: 6e69 635f 4571 7561 6c5f 4172 6561 225d  nic_Equal_Area"]
+00000d20: 2c20 5041 5241 4d45 5445 525b 2263 656e  , PARAMETER["cen
+00000d30: 7472 616c 5f6d 6572 6964 6961 6e22 2c20  tral_meridian", 
+00000d40: 2d31 3537 2e30 5d2c 5041 5241 4d45 5445  -157.0],PARAMETE
+00000d50: 525b 226c 6174 6974 7564 655f 6f66 5f6f  R["latitude_of_o
+00000d60: 7269 6769 6e22 2c20 332e 305d 2c50 4152  rigin", 3.0],PAR
+00000d70: 414d 4554 4552 5b22 7374 616e 6461 7264  AMETER["standard
+00000d80: 5f70 6172 616c 6c65 6c5f 3122 2c20 382e  _parallel_1", 8.
+00000d90: 305d 2c50 4152 414d 4554 4552 5b22 6661  0],PARAMETER["fa
+00000da0: 6c73 655f 6561 7374 696e 6722 2c20 302e  lse_easting", 0.
+00000db0: 305d 2c50 4152 414d 4554 4552 5b22 6661  0],PARAMETER["fa
+00000dc0: 6c73 655f 6e6f 7274 6869 6e67 222c 2030  lse_northing", 0
+00000dd0: 2e30 5d2c 5041 5241 4d45 5445 525b 2273  .0],PARAMETER["s
+00000de0: 7461 6e64 6172 645f 7061 7261 6c6c 656c  tandard_parallel
+00000df0: 5f32 222c 2031 382e 305d 2c55 4e49 545b  _2", 18.0],UNIT[
+00000e00: 226d 222c 2031 2e30 5d2c 4158 4953 5b22  "m", 1.0],AXIS["
+00000e10: 7822 2c20 4541 5354 5d2c 4158 4953 5b22  x", EAST],AXIS["
+00000e20: 7922 2c20 4e4f 5254 485d 5d27 2c0d 0a20  y", NORTH]]',.. 
+00000e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000e50: 2027 7472 616e 7366 6f72 6d27 3a5b 3330   'transform':[30
+00000e60: 2c30 2c2d 3334 3235 3835 2c30 2c2d 3330  ,0,-342585,0,-30
+00000e70: 2c32 3132 3731 3335 5d7d 0d0a 0d0a 2344  ,2127135]}....#D
+00000e80: 6972 6563 7469 6f6e 206f 6620 2061 2064  irection of  a d
+00000e90: 6563 7265 6173 6520 696e 2070 686f 746f  ecrease in photo
+00000ea0: 7379 6e74 6865 7469 6320 7665 6765 7461  synthetic vegeta
+00000eb0: 7469 6f6e 2d20 6164 6420 616e 7920 7468  tion- add any th
+00000ec0: 6174 2061 7265 206d 6973 7369 6e67 0d0a  at are missing..
+00000ed0: 6368 616e 6765 4469 7244 6963 7420 3d20  changeDirDict = 
+00000ee0: 7b5c 0d0a 2262 6c75 6522 3a31 2c22 6772  {\.."blue":1,"gr
+00000ef0: 6565 6e22 3a31 2c22 7265 6422 3a31 2c22  een":1,"red":1,"
+00000f00: 6e69 7222 3a2d 312c 2273 7769 7231 223a  nir":-1,"swir1":
+00000f10: 312c 2273 7769 7232 223a 312c 2274 656d  1,"swir2":1,"tem
+00000f20: 7022 3a31 2c5c 0d0a 224e 4456 4922 3a2d  p":1,\.."NDVI":-
+00000f30: 312c 224e 4252 223a 2d31 2c22 4e44 4d49  1,"NBR":-1,"NDMI
+00000f40: 223a 2d31 2c22 4e44 5349 223a 312c 5c0d  ":-1,"NDSI":1,\.
+00000f50: 0a22 6272 6967 6874 6e65 7373 223a 312c  ."brightness":1,
+00000f60: 2267 7265 656e 6e65 7373 223a 2d31 2c22  "greenness":-1,"
+00000f70: 7765 746e 6573 7322 3a2d 312c 2266 6f75  wetness":-1,"fou
+00000f80: 7274 6822 3a2d 312c 2266 6966 7468 223a  rth":-1,"fifth":
+00000f90: 312c 2273 6978 7468 223a 2d31 2c5c 0d0a  1,"sixth":-1,\..
+00000fa0: 224e 445f 626c 7565 5f67 7265 656e 223a  "ND_blue_green":
+00000fb0: 2d31 2c22 4e44 5f62 6c75 655f 7265 6422  -1,"ND_blue_red"
+00000fc0: 3a2d 312c 224e 445f 626c 7565 5f6e 6972  :-1,"ND_blue_nir
+00000fd0: 223a 312c 224e 445f 626c 7565 5f73 7769  ":1,"ND_blue_swi
+00000fe0: 7231 223a 2d31 2c22 4e44 5f62 6c75 655f  r1":-1,"ND_blue_
+00000ff0: 7377 6972 3222 3a2d 312c 5c0d 0a22 4e44  swir2":-1,\.."ND
+00001000: 5f67 7265 656e 5f72 6564 223a 2d31 2c22  _green_red":-1,"
+00001010: 4e44 5f67 7265 656e 5f6e 6972 223a 312c  ND_green_nir":1,
+00001020: 224e 445f 6772 6565 6e5f 7377 6972 3122  "ND_green_swir1"
+00001030: 3a2d 312c 224e 445f 6772 6565 6e5f 7377  :-1,"ND_green_sw
+00001040: 6972 3222 3a2d 312c 224e 445f 7265 645f  ir2":-1,"ND_red_
+00001050: 7377 6972 3122 3a2d 312c 5c0d 0a22 4e44  swir1":-1,\.."ND
+00001060: 5f72 6564 5f73 7769 7232 223a 2d31 2c22  _red_swir2":-1,"
+00001070: 4e44 5f6e 6972 5f72 6564 223a 2d31 2c22  ND_nir_red":-1,"
+00001080: 4e44 5f6e 6972 5f73 7769 7231 223a 2d31  ND_nir_swir1":-1
+00001090: 2c22 4e44 5f6e 6972 5f73 7769 7232 223a  ,"ND_nir_swir2":
+000010a0: 2d31 2c22 4e44 5f73 7769 7231 5f73 7769  -1,"ND_swir1_swi
+000010b0: 7232 223a 2d31 2c5c 0d0a 2252 5f73 7769  r2":-1,\.."R_swi
+000010c0: 7231 5f6e 6972 223a 312c 2252 5f72 6564  r1_nir":1,"R_red
+000010d0: 5f73 7769 7231 223a 2d31 2c22 4556 4922  _swir1":-1,"EVI"
+000010e0: 3a2d 312c 2253 4156 4922 3a2d 312c 2249  :-1,"SAVI":-1,"I
+000010f0: 4249 223a 312c 5c0d 0a22 7463 416e 676c  BI":1,\.."tcAngl
+00001100: 6542 4722 3a2d 312c 2274 6341 6e67 6c65  eBG":-1,"tcAngle
+00001110: 4757 223a 2d31 2c22 7463 416e 676c 6542  GW":-1,"tcAngleB
+00001120: 5722 3a2d 312c 2274 6344 6973 7442 4722  W":-1,"tcDistBG"
+00001130: 3a31 2c22 7463 4469 7374 4757 223a 312c  :1,"tcDistGW":1,
+00001140: 2274 6344 6973 7442 5722 3a31 2c5c 0d0a  "tcDistBW":1,\..
+00001150: 274e 4952 7627 3a2d 312c 274e 4443 4927  'NIRv':-1,'NDCI'
+00001160: 3a2d 312c 274e 4447 4927 3a2d 315c 0d0a  :-1,'NDGI':-1\..
+00001170: 7d0d 0a0d 0a0d 0a23 5072 6563 6f6d 7075  }......#Precompu
+00001180: 7465 6420 636c 6f75 6473 636f 7265 206f  ted cloudscore o
+00001190: 6666 7365 7473 2061 6e64 2054 444f 4d20  ffsets and TDOM 
+000011a0: 7374 6174 730d 0a23 5468 6573 6520 6861  stats..#These ha
+000011b0: 7665 2062 6565 6e20 7072 652d 636f 6d70  ve been pre-comp
+000011c0: 7574 6564 2066 6f72 2061 6c6c 2043 4f4e  uted for all CON
+000011d0: 5553 2066 6f72 204c 616e 6473 6174 2061  US for Landsat a
+000011e0: 6e64 2053 6574 696e 656c 2032 2028 7365  nd Setinel 2 (se
+000011f0: 7061 7261 7465 6c79 290d 0a23 616e 6420  parately)..#and 
+00001200: 6172 6520 6170 7072 6f70 7269 6174 6520  are appropriate 
+00001210: 746f 2075 7365 2066 6f72 2061 6e79 2074  to use for any t
+00001220: 696d 6520 7065 7269 6f64 2077 6974 6869  ime period withi
+00001230: 6e20 7468 6520 6772 6f77 696e 6720 7365  n the growing se
+00001240: 6173 6f6e 0d0a 2354 6865 2063 6c6f 7564  ason..#The cloud
+00001250: 5363 6f72 6520 6f66 6673 6574 2069 7320  Score offset is 
+00001260: 6765 6e65 7261 6c6c 7920 736f 6d65 206c  generally some l
+00001270: 6f77 6572 2070 6572 6365 6e74 696c 6520  ower percentile 
+00001280: 6f66 2063 6c6f 7564 5363 6f72 6573 206f  of cloudScores o
+00001290: 6e20 6120 7069 7865 6c2d 7769 7365 2062  n a pixel-wise b
+000012a0: 6173 6973 0d0a 2354 6865 2054 444f 4d20  asis..#The TDOM 
+000012b0: 7374 6174 7320 6172 6520 7468 6520 6d65  stats are the me
+000012c0: 616e 2061 6e64 2073 7461 6e64 6172 6420  an and standard 
+000012d0: 6465 7669 6174 696f 6e73 206f 6620 7468  deviations of th
+000012e0: 6520 7477 6f20 6261 6e64 7320 7573 6564  e two bands used
+000012f0: 2069 6e20 5444 4f4d 0d0a 2342 7920 6465   in TDOM..#By de
+00001300: 6661 756c 742c 2054 444f 4d20 7573 6573  fault, TDOM uses
+00001310: 2074 6865 206e 6972 2061 6e64 2073 7769   the nir and swi
+00001320: 7231 2062 616e 6473 0d0a 7072 6543 6f6d  r1 bands..preCom
+00001330: 7075 7465 6443 6c6f 7564 5363 6f72 654f  putedCloudScoreO
+00001340: 6666 7365 7420 3d20 6565 2e49 6d61 6765  ffset = ee.Image
+00001350: 436f 6c6c 6563 7469 6f6e 2827 7072 6f6a  Collection('proj
+00001360: 6563 7473 2f6c 636d 732d 7463 632d 7368  ects/lcms-tcc-sh
+00001370: 6172 6564 2f61 7373 6574 732f 4353 2d54  ared/assets/CS-T
+00001380: 444f 4d2d 5374 6174 732f 636c 6f75 6453  DOM-Stats/cloudS
+00001390: 636f 7265 2729 2e6d 6f73 6169 6328 290d  core').mosaic().
+000013a0: 0a70 7265 436f 6d70 7574 6564 5444 4f4d  .preComputedTDOM
+000013b0: 5374 6174 7320 3d20 6565 2e49 6d61 6765  Stats = ee.Image
+000013c0: 436f 6c6c 6563 7469 6f6e 2827 7072 6f6a  Collection('proj
+000013d0: 6563 7473 2f6c 636d 732d 7463 632d 7368  ects/lcms-tcc-sh
+000013e0: 6172 6564 2f61 7373 6574 732f 4353 2d54  ared/assets/CS-T
+000013f0: 444f 4d2d 5374 6174 732f 5444 4f4d 2729  DOM-Stats/TDOM')
+00001400: 2e66 696c 7465 7228 6565 2e46 696c 7465  .filter(ee.Filte
+00001410: 722e 6571 2827 656e 6459 6561 7227 2c32  r.eq('endYear',2
+00001420: 3031 3929 292e 6d6f 7361 6963 2829 2e64  019)).mosaic().d
+00001430: 6976 6964 6528 3130 3030 3029 0d0a 0d0a  ivide(10000)....
+00001440: 0d0a 6465 6620 6765 7450 7265 636f 6d70  ..def getPrecomp
+00001450: 7574 6564 436c 6f75 6453 636f 7265 4f66  utedCloudScoreOf
+00001460: 6673 6574 7328 636c 6f75 6453 636f 7265  fsets(cloudScore
+00001470: 5063 746c 203d 2031 3029 3a0d 0a20 2072  Pctl = 10):..  r
+00001480: 6574 7572 6e20 7b27 6c61 6e64 7361 7427  eturn {'landsat'
+00001490: 3a20 7072 6543 6f6d 7075 7465 6443 6c6f  : preComputedClo
+000014a0: 7564 5363 6f72 654f 6666 7365 742e 7365  udScoreOffset.se
+000014b0: 6c65 6374 285b 274c 616e 6473 6174 5f43  lect(['Landsat_C
+000014c0: 6c6f 7564 5363 6f72 655f 707b 7d27 2e66  loudScore_p{}'.f
+000014d0: 6f72 6d61 7428 636c 6f75 6453 636f 7265  ormat(cloudScore
+000014e0: 5063 746c 295d 292c 0d0a 2020 2020 2020  Pctl)]),..      
+000014f0: 2020 2020 2773 656e 7469 6e65 6c32 273a      'sentinel2':
+00001500: 7072 6543 6f6d 7075 7465 6443 6c6f 7564  preComputedCloud
+00001510: 5363 6f72 654f 6666 7365 742e 7365 6c65  ScoreOffset.sele
+00001520: 6374 285b 2753 656e 7469 6e65 6c32 5f43  ct(['Sentinel2_C
+00001530: 6c6f 7564 5363 6f72 655f 707b 7d27 2e66  loudScore_p{}'.f
+00001540: 6f72 6d61 7428 636c 6f75 6453 636f 7265  ormat(cloudScore
+00001550: 5063 746c 295d 290d 0a20 2020 2020 2020  Pctl)])..       
+00001560: 2020 207d 0d0a 0d0a 6465 6620 6765 7450     }....def getP
+00001570: 7265 636f 6d70 7574 6564 5444 4f4d 5374  recomputedTDOMSt
+00001580: 6174 7328 293a 0d0a 2020 7265 7475 726e  ats():..  return
+00001590: 207b 276c 616e 6473 6174 273a 207b 0d0a   {'landsat': {..
+000015a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000015b0: 2020 2020 2020 276d 6561 6e27 3a70 7265        'mean':pre
+000015c0: 436f 6d70 7574 6564 5444 4f4d 5374 6174  ComputedTDOMStat
+000015d0: 732e 7365 6c65 6374 285b 274c 616e 6473  s.select(['Lands
+000015e0: 6174 5f6e 6972 5f6d 6561 6e27 2c27 4c61  at_nir_mean','La
+000015f0: 6e64 7361 745f 7377 6972 315f 6d65 616e  ndsat_swir1_mean
+00001600: 275d 292c 0d0a 2020 2020 2020 2020 2020  ']),..          
+00001610: 2020 2020 2020 2020 2020 2020 2773 7464              'std
+00001620: 4465 7627 3a70 7265 436f 6d70 7574 6564  Dev':preComputed
+00001630: 5444 4f4d 5374 6174 732e 7365 6c65 6374  TDOMStats.select
+00001640: 285b 274c 616e 6473 6174 5f6e 6972 5f73  (['Landsat_nir_s
+00001650: 7464 4465 7627 2c27 4c61 6e64 7361 745f  tdDev','Landsat_
+00001660: 7377 6972 315f 7374 6444 6576 275d 290d  swir1_stdDev']).
+00001670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001680: 2020 2020 2020 207d 2c0d 0a20 2020 2020         },..     
+00001690: 2020 2020 2027 7365 6e74 696e 656c 3227       'sentinel2'
+000016a0: 3a20 7b0d 0a20 2020 2020 2020 2020 2020  : {..           
+000016b0: 2020 2020 2020 2020 2020 2027 6d65 616e             'mean
+000016c0: 273a 7072 6543 6f6d 7075 7465 6454 444f  ':preComputedTDO
+000016d0: 4d53 7461 7473 2e73 656c 6563 7428 5b27  MStats.select(['
+000016e0: 5365 6e74 696e 656c 325f 6e69 725f 6d65  Sentinel2_nir_me
+000016f0: 616e 272c 2753 656e 7469 6e65 6c32 5f73  an','Sentinel2_s
+00001700: 7769 7231 5f6d 6561 6e27 5d29 2c0d 0a20  wir1_mean']),.. 
+00001710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001720: 2020 2020 2027 7374 6444 6576 273a 7072       'stdDev':pr
+00001730: 6543 6f6d 7075 7465 6454 444f 4d53 7461  eComputedTDOMSta
+00001740: 7473 2e73 656c 6563 7428 5b27 5365 6e74  ts.select(['Sent
+00001750: 696e 656c 325f 6e69 725f 7374 6444 6576  inel2_nir_stdDev
+00001760: 272c 2753 656e 7469 6e65 6c32 5f73 7769  ','Sentinel2_swi
+00001770: 7231 5f73 7464 4465 7627 5d29 0d0a 2020  r1_stdDev'])..  
+00001780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001790: 2020 2020 7d0d 0a20 2020 2020 2020 2020      }..         
+000017a0: 207d 0d0a 0d0a 0d0a 0d0a 2323 2323 2323   }........######
+000017b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000017c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000017d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000017e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000017f0: 0d0a 2346 554e 4354 494f 4e53 0d0a 2323  ..#FUNCTIONS..##
+00001800: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00001810: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00001820: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00001830: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001840: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001850: 2323 230d 0a23 4655 4e43 5449 4f4e 530d  ###..#FUNCTIONS.
-00001860: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+00001840: 2323 2323 0d0a 2323 2323 2323 2323 2323  ####..##########
+00001850: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001860: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00001870: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001880: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001890: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000018a0: 2323 2323 2323 230d 0a23 2323 2323 2323  #######..#######
-000018b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000018c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000018d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000018e0: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
-000018f0: 0a23 4675 6e63 7469 6f6e 2074 6f20 6173  .#Function to as
-00001900: 796e 6368 726f 6e6f 7573 6c79 2070 7269  ynchronously pri
-00001910: 6e74 2065 6520 6f62 6a65 6374 730d 0a64  nt ee objects..d
-00001920: 6566 2070 7269 6e74 4545 2865 654f 626a  ef printEE(eeObj
-00001930: 6563 742c 6d65 7373 6167 6520 3d20 2727  ect,message = ''
-00001940: 293a 0d0a 2020 6465 6620 7072 696e 7449  ):..  def printI
-00001950: 7428 6565 4f62 6a65 6374 293a 0d0a 2020  t(eeObject):..  
-00001960: 2020 7072 696e 7428 6d65 7373 6167 652c    print(message,
-00001970: 6565 4f62 6a65 6374 2e67 6574 496e 666f  eeObject.getInfo
-00001980: 2829 290d 0a20 2020 2070 7269 6e74 2829  ())..    print()
-00001990: 0d0a 2020 7420 3d20 5468 7265 6164 2874  ..  t = Thread(t
-000019a0: 6172 6765 7420 3d20 7072 696e 7449 742c  arget = printIt,
-000019b0: 6172 6773 203d 2028 6565 4f62 6a65 6374  args = (eeObject
-000019c0: 2c29 290d 0a20 2074 2e73 7461 7274 2829  ,))..  t.start()
-000019d0: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
+00001880: 2323 2323 2323 2323 2323 2323 0d0a 2346  ############..#F
+00001890: 756e 6374 696f 6e20 746f 2061 7379 6e63  unction to async
+000018a0: 6872 6f6e 6f75 736c 7920 7072 696e 7420  hronously print 
+000018b0: 6565 206f 626a 6563 7473 0d0a 6465 6620  ee objects..def 
+000018c0: 7072 696e 7445 4528 6565 4f62 6a65 6374  printEE(eeObject
+000018d0: 2c6d 6573 7361 6765 203d 2027 2729 3a0d  ,message = ''):.
+000018e0: 0a20 2064 6566 2070 7269 6e74 4974 2865  .  def printIt(e
+000018f0: 654f 626a 6563 7429 3a0d 0a20 2020 2070  eObject):..    p
+00001900: 7269 6e74 286d 6573 7361 6765 2c65 654f  rint(message,eeO
+00001910: 626a 6563 742e 6765 7449 6e66 6f28 2929  bject.getInfo())
+00001920: 0d0a 2020 2020 7072 696e 7428 290d 0a20  ..    print().. 
+00001930: 2074 203d 2054 6872 6561 6428 7461 7267   t = Thread(targ
+00001940: 6574 203d 2070 7269 6e74 4974 2c61 7267  et = printIt,arg
+00001950: 7320 3d20 2865 654f 626a 6563 742c 2929  s = (eeObject,))
+00001960: 0d0a 2020 742e 7374 6172 7428 290d 0a23  ..  t.start()..#
+00001970: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001980: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001990: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000019a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000019b0: 2323 2323 230d 0a23 2323 2323 2323 2323  #####..#########
+000019c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000019d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000019e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000019f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001a00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001a10: 2323 2323 2323 2323 0d0a 2323 2323 2323  ########..######
-00001a20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001a30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001a40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001a50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001a60: 0d0a 2346 756e 6374 696f 6e20 746f 2073  ..#Function to s
-00001a70: 6574 206e 756c 6c20 7661 6c75 6520 666f  et null value fo
-00001a80: 7220 6578 706f 7274 206f 7220 636f 6e76  r export or conv
-00001a90: 6572 7369 6f6e 2074 6f20 6172 7261 7973  ersion to arrays
-00001aa0: 0d0a 6465 6620 7365 744e 6f44 6174 6128  ..def setNoData(
-00001ab0: 696d 6167 652c 6e6f 4461 7461 5661 6c75  image,noDataValu
-00001ac0: 6529 3a0d 0a20 2023 2061 7267 7320 3d20  e):..  # args = 
-00001ad0: 666f 726d 6174 4172 6773 286c 6f63 616c  formatArgs(local
-00001ae0: 7328 2929 0d0a 2020 696d 6167 6520 3d20  s())..  image = 
-00001af0: 696d 6167 652e 756e 6d61 736b 286e 6f44  image.unmask(noD
-00001b00: 6174 6156 616c 7565 2c20 4661 6c73 6529  ataValue, False)
-00001b10: 232e 7365 7428 276e 6f44 6174 6156 616c  #.set('noDataVal
-00001b20: 7565 272c 206e 6f44 6174 6156 616c 7565  ue', noDataValue
-00001b30: 290d 0a20 2072 6574 7572 6e20 696d 6167  )..  return imag
-00001b40: 6523 2e73 6574 2861 7267 7329 0d0a 2323  e#.set(args)..##
+000019f0: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
+00001a00: 4675 6e63 7469 6f6e 2074 6f20 7365 7420  Function to set 
+00001a10: 6e75 6c6c 2076 616c 7565 2066 6f72 2065  null value for e
+00001a20: 7870 6f72 7420 6f72 2063 6f6e 7665 7273  xport or convers
+00001a30: 696f 6e20 746f 2061 7272 6179 730d 0a64  ion to arrays..d
+00001a40: 6566 2073 6574 4e6f 4461 7461 2869 6d61  ef setNoData(ima
+00001a50: 6765 2c6e 6f44 6174 6156 616c 7565 293a  ge,noDataValue):
+00001a60: 0d0a 2020 2320 6172 6773 203d 2066 6f72  ..  # args = for
+00001a70: 6d61 7441 7267 7328 6c6f 6361 6c73 2829  matArgs(locals()
+00001a80: 290d 0a20 2069 6d61 6765 203d 2069 6d61  )..  image = ima
+00001a90: 6765 2e75 6e6d 6173 6b28 6e6f 4461 7461  ge.unmask(noData
+00001aa0: 5661 6c75 652c 2046 616c 7365 2923 2e73  Value, False)#.s
+00001ab0: 6574 2827 6e6f 4461 7461 5661 6c75 6527  et('noDataValue'
+00001ac0: 2c20 6e6f 4461 7461 5661 6c75 6529 0d0a  , noDataValue)..
+00001ad0: 2020 7265 7475 726e 2069 6d61 6765 232e    return image#.
+00001ae0: 7365 7428 6172 6773 290d 0a23 2323 2323  set(args)..#####
+00001af0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001b00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001b10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001b20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001b30: 230d 0a23 2323 2323 2323 2323 2323 2323  #..#############
+00001b40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00001b50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00001b60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001b70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001b80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001b90: 2323 2323 0d0a 2323 2323 2323 2323 2323  ####..##########
-00001ba0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001bb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001bc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001bd0: 2323 2323 2323 2323 2323 2323 0d0a 2320  ############..# 
-00001be0: 466f 726d 6174 7320 6172 6775 6d65 6e74  Formats argument
-00001bf0: 7320 6173 2073 7472 696e 6773 2073 6f20  s as strings so 
-00001c00: 6361 6e20 6265 2065 6173 696c 7920 7365  can be easily se
-00001c10: 7420 6173 2070 726f 7065 7274 6965 730d  t as properties.
-00001c20: 0a64 6566 2066 6f72 6d61 7441 7267 7328  .def formatArgs(
-00001c30: 6172 6773 293a 0d0a 2020 666f 726d 6174  args):..  format
-00001c40: 7465 6441 7267 7320 3d20 7b7d 0d0a 2020  tedArgs = {}..  
-00001c50: 666f 7220 6b65 7920 696e 2061 7267 732e  for key in args.
-00001c60: 6b65 7973 2829 3a0d 0a20 2020 2020 2069  keys():..      i
-00001c70: 6620 7479 7065 2861 7267 735b 6b65 795d  f type(args[key]
-00001c80: 2920 696e 205b 626f 6f6c 2c20 6c69 7374  ) in [bool, list
-00001c90: 2c20 6469 6374 2c20 7479 7065 284e 6f6e  , dict, type(Non
-00001ca0: 6529 5d3a 0d0a 2020 2020 2020 2020 666f  e)]:..        fo
-00001cb0: 726d 6174 7465 6441 7267 735b 6b65 795d  rmattedArgs[key]
-00001cc0: 203d 2073 7472 2861 7267 735b 6b65 795d   = str(args[key]
-00001cd0: 290d 0a20 2020 2020 2065 6c69 6620 7479  )..      elif ty
-00001ce0: 7065 2861 7267 735b 6b65 795d 2920 696e  pe(args[key]) in
-00001cf0: 205b 7374 722c 2069 6e74 5d3a 0d0a 2020   [str, int]:..  
-00001d00: 2020 2020 2020 666f 726d 6174 7465 6441        formattedA
-00001d10: 7267 735b 6b65 795d 203d 2061 7267 735b  rgs[key] = args[
-00001d20: 6b65 795d 0d0a 2020 7265 7475 726e 2066  key]..  return f
-00001d30: 6f72 6d61 7474 6564 4172 6773 0d0a 2323  ormattedArgs..##
+00001b70: 2323 2323 2323 2323 230d 0a23 2046 6f72  #########..# For
+00001b80: 6d61 7473 2061 7267 756d 656e 7473 2061  mats arguments a
+00001b90: 7320 7374 7269 6e67 7320 736f 2063 616e  s strings so can
+00001ba0: 2062 6520 6561 7369 6c79 2073 6574 2061   be easily set a
+00001bb0: 7320 7072 6f70 6572 7469 6573 0d0a 6465  s properties..de
+00001bc0: 6620 666f 726d 6174 4172 6773 2861 7267  f formatArgs(arg
+00001bd0: 7329 3a0d 0a20 2066 6f72 6d61 7474 6564  s):..  formatted
+00001be0: 4172 6773 203d 207b 7d0d 0a20 2066 6f72  Args = {}..  for
+00001bf0: 206b 6579 2069 6e20 6172 6773 2e6b 6579   key in args.key
+00001c00: 7328 293a 0d0a 2020 2020 2020 6966 2074  s():..      if t
+00001c10: 7970 6528 6172 6773 5b6b 6579 5d29 2069  ype(args[key]) i
+00001c20: 6e20 5b62 6f6f 6c2c 206c 6973 742c 2064  n [bool, list, d
+00001c30: 6963 742c 2074 7970 6528 4e6f 6e65 295d  ict, type(None)]
+00001c40: 3a0d 0a20 2020 2020 2020 2066 6f72 6d61  :..        forma
+00001c50: 7474 6564 4172 6773 5b6b 6579 5d20 3d20  ttedArgs[key] = 
+00001c60: 7374 7228 6172 6773 5b6b 6579 5d29 0d0a  str(args[key])..
+00001c70: 2020 2020 2020 656c 6966 2074 7970 6528        elif type(
+00001c80: 6172 6773 5b6b 6579 5d29 2069 6e20 5b73  args[key]) in [s
+00001c90: 7472 2c20 696e 745d 3a0d 0a20 2020 2020  tr, int]:..     
+00001ca0: 2020 2066 6f72 6d61 7474 6564 4172 6773     formattedArgs
+00001cb0: 5b6b 6579 5d20 3d20 6172 6773 5b6b 6579  [key] = args[key
+00001cc0: 5d0d 0a20 2072 6574 7572 6e20 666f 726d  ]..  return form
+00001cd0: 6174 7465 6441 7267 730d 0a23 2323 2323  attedArgs..#####
+00001ce0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001cf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001d00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001d10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001d20: 230d 0a23 2323 2323 2323 2323 2323 2323  #..#############
+00001d30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00001d40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00001d50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001d60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001d70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001d80: 2323 2323 0d0a 2323 2323 2323 2323 2323  ####..##########
-00001d90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001da0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001db0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00001dc0: 2323 2323 2323 2323 2323 2323 0d0a 2346  ############..#F
-00001dd0: 756e 6374 696f 6e73 2074 6f20 7065 7266  unctions to perf
-00001de0: 6f72 6d20 6261 7369 6320 636c 756d 7020  orm basic clump 
-00001df0: 616e 6420 656c 696d 0d0a 6465 6620 7369  and elim..def si
-00001e00: 6576 6528 696d 6167 652c 206d 6d75 293a  eve(image, mmu):
-00001e10: 0d0a 2020 6172 6773 203d 2066 6f72 6d61  ..  args = forma
-00001e20: 7441 7267 7328 6c6f 6361 6c73 2829 290d  tArgs(locals()).
-00001e30: 0a20 2063 6f6e 6e65 6374 6564 203d 2069  .  connected = i
-00001e40: 6d61 6765 2e63 6f6e 6e65 6374 6564 5069  mage.connectedPi
-00001e50: 7865 6c43 6f75 6e74 286d 6d75 2b32 3029  xelCount(mmu+20)
-00001e60: 0d0a 2020 234d 6170 2e61 6464 4c61 7965  ..  #Map.addLaye
-00001e70: 7228 636f 6e6e 6563 7465 642c 7b27 6d69  r(connected,{'mi
-00001e80: 6e27 3a31 2c27 6d61 7827 3a6d 6d75 7d2c  n':1,'max':mmu},
-00001e90: 2763 6f6e 6e65 6374 6564 2729 0d0a 2020  'connected')..  
-00001ea0: 656c 696d 203d 2063 6f6e 6e65 6374 6564  elim = connected
-00001eb0: 2e67 7428 6d6d 7529 0d0a 2020 6d6f 6465  .gt(mmu)..  mode
-00001ec0: 203d 2069 6d61 6765 2e66 6f63 616c 5f6d   = image.focal_m
-00001ed0: 6f64 6528 6d6d 752f 322c 2763 6972 636c  ode(mmu/2,'circl
-00001ee0: 6527 290d 0a20 206d 6f64 6520 3d20 6d6f  e')..  mode = mo
-00001ef0: 6465 2e6d 6173 6b28 696d 6167 652e 6d61  de.mask(image.ma
-00001f00: 736b 2829 290d 0a20 2066 696c 6c65 6420  sk())..  filled 
-00001f10: 3d20 696d 6167 652e 7768 6572 6528 656c  = image.where(el
-00001f20: 696d 2e4e 6f74 2829 2c6d 6f64 6529 0d0a  im.Not(),mode)..
-00001f30: 2020 7265 7475 726e 2066 696c 6c65 642e    return filled.
-00001f40: 7365 7428 276d 6d75 272c 206d 6d75 292e  set('mmu', mmu).
-00001f50: 7365 7428 6172 6773 290d 0a0d 0a0d 0a23  set(args)......#
-00001f60: 5772 6974 7465 6e20 6279 2059 616e 6720  Written by Yang 
-00001f70: 5a2e 0d0a 232d 2d2d 2d2d 2d20 4c38 2074  Z...#------ L8 t
-00001f80: 6f20 4c37 2048 4152 4d4f 4e49 5a41 5449  o L7 HARMONIZATI
-00001f90: 4f4e 2046 554e 4354 494f 4e20 2d2d 2d2d  ON FUNCTION ----
-00001fa0: 2d0d 0a23 2073 6c6f 7065 2061 6e64 2069  -..# slope and i
-00001fb0: 6e74 6572 6365 7074 2063 6974 6174 696f  ntercept citatio
-00001fc0: 6e3a 2052 6f79 2c20 442e 502e 2c20 4b6f  n: Roy, D.P., Ko
-00001fd0: 7661 6c73 6b79 792c 2056 2e2c 205a 6861  valskyy, V., Zha
-00001fe0: 6e67 2c20 482e 4b2e 2c20 5665 726d 6f74  ng, H.K., Vermot
-00001ff0: 652c 2045 2e46 2e2c 2059 616e 2c20 4c2e  e, E.F., Yan, L.
-00002000: 2c20 4b75 6d61 722c 2053 2e53 2c20 4567  , Kumar, S.S, Eg
-00002010: 6f72 6f76 2c20 412e 2c20 3230 3136 2c20  orov, A., 2016, 
-00002020: 4368 6172 6163 7465 7269 7a61 7469 6f6e  Characterization
-00002030: 206f 6620 4c61 6e64 7361 742d 3720 746f   of Landsat-7 to
-00002040: 204c 616e 6473 6174 2d38 2072 6566 6c65   Landsat-8 refle
-00002050: 6374 6976 6520 7761 7665 6c65 6e67 7468  ctive wavelength
-00002060: 2061 6e64 206e 6f72 6d61 6c69 7a65 6420   and normalized 
-00002070: 6469 6666 6572 656e 6365 2076 6567 6574  difference veget
-00002080: 6174 696f 6e20 696e 6465 7820 636f 6e74  ation index cont
-00002090: 696e 7569 7479 2c20 5265 6d6f 7465 2053  inuity, Remote S
-000020a0: 656e 7369 6e67 206f 6620 456e 7669 726f  ensing of Enviro
-000020b0: 6e6d 656e 742c 2031 3835 2c20 3537 2d37  nment, 185, 57-7
-000020c0: 302e 2868 7474 703a 2f2f 6478 2e64 6f69  0.(http://dx.doi
-000020d0: 2e6f 7267 2f31 302e 3130 3136 2f6a 2e72  .org/10.1016/j.r
-000020e0: 7365 2e32 3031 352e 3132 2e30 3234 293b  se.2015.12.024);
-000020f0: 2054 6162 6c65 2032 202d 2072 6564 7563   Table 2 - reduc
-00002100: 6564 206d 616a 6f72 2061 7869 7320 2852  ed major axis (R
-00002110: 4d41 2920 7265 6772 6573 7369 6f6e 2063  MA) regression c
-00002120: 6f65 6666 6963 6965 6e74 730d 0a64 6566  oefficients..def
-00002130: 2068 6172 6d6f 6e69 7a61 7469 6f6e 526f   harmonizationRo
-00002140: 7928 6f6c 6929 3a0d 0a20 2073 6c6f 7065  y(oli):..  slope
-00002150: 7320 3d20 6565 2e49 6d61 6765 2e63 6f6e  s = ee.Image.con
-00002160: 7374 616e 7428 5b30 2e39 3738 352c 2030  stant([0.9785, 0
-00002170: 2e39 3534 322c 2030 2e39 3832 352c 2031  .9542, 0.9825, 1
-00002180: 2e30 3037 332c 2031 2e30 3137 312c 2030  .0073, 1.0171, 0
-00002190: 2e39 3934 395d 2923 6372 6561 7465 2061  .9949])#create a
-000021a0: 6e20 696d 6167 6520 6f66 2073 6c6f 7065  n image of slope
-000021b0: 7320 7065 7220 6261 6e64 2066 6f72 204c  s per band for L
-000021c0: 3820 544f 204c 3720 7265 6772 6573 7369  8 TO L7 regressi
-000021d0: 6f6e 206c 696e 6520 2d20 4461 7669 6420  on line - David 
-000021e0: 526f 790d 0a20 2069 7463 7020 3d20 6565  Roy..  itcp = ee
-000021f0: 2e49 6d61 6765 2e63 6f6e 7374 616e 7428  .Image.constant(
-00002200: 5b2d 302e 3030 3935 2c20 2d30 2e30 3031  [-0.0095, -0.001
-00002210: 362c 202d 302e 3030 3232 2c20 2d30 2e30  6, -0.0022, -0.0
-00002220: 3032 312c 202d 302e 3030 3330 2c20 302e  021, -0.0030, 0.
-00002230: 3030 3239 5d29 2363 7265 6174 6520 616e  0029])#create an
-00002240: 2069 6d61 6765 206f 6620 792d 696e 7465   image of y-inte
-00002250: 7263 6570 7473 2070 6572 2062 616e 6420  rcepts per band 
-00002260: 666f 7220 4c38 2054 4f20 4c37 2072 6567  for L8 TO L7 reg
-00002270: 7265 7373 696f 6e20 6c69 6e65 202d 2044  ression line - D
-00002280: 6176 6964 2052 6f79 0d0a 2020 626e 7320  avid Roy..  bns 
-00002290: 3d20 6f6c 692e 6261 6e64 4e61 6d65 7328  = oli.bandNames(
-000022a0: 290d 0a20 2069 6e63 6c75 6465 426e 7320  )..  includeBns 
-000022b0: 3d20 5b27 626c 7565 272c 2767 7265 656e  = ['blue','green
-000022c0: 272c 2772 6564 272c 276e 6972 272c 2773  ','red','nir','s
-000022d0: 7769 7231 272c 2773 7769 7232 2720 5d0d  wir1','swir2' ].
-000022e0: 0a20 206f 7468 6572 426e 7320 3d20 626e  .  otherBns = bn
-000022f0: 732e 7265 6d6f 7665 416c 6c28 696e 636c  s.removeAll(incl
-00002300: 7564 6542 6e73 290d 0a0d 0a20 2023 6372  udeBns)....  #cr
-00002310: 6561 7465 2061 6e20 696d 6167 6520 6f66  eate an image of
-00002320: 2079 2d69 6e74 6572 6365 7074 7320 7065   y-intercepts pe
-00002330: 7220 6261 6e64 2066 6f72 204c 3820 544f  r band for L8 TO
-00002340: 204c 3720 7265 6772 6573 7369 6f6e 206c   L7 regression l
-00002350: 696e 6520 2d20 4461 7669 6420 526f 790d  ine - David Roy.
-00002360: 0a20 2079 203d 206f 6c69 2e73 656c 6563  .  y = oli.selec
-00002370: 7428 696e 636c 7564 6542 6e73 292e 666c  t(includeBns).fl
-00002380: 6f61 7428 292e 7375 6274 7261 6374 2869  oat().subtract(i
-00002390: 7463 7029 2e64 6976 6964 6528 736c 6f70  tcp).divide(slop
-000023a0: 6573 292e 7365 7428 2773 7973 7465 6d3a  es).set('system:
-000023b0: 7469 6d65 5f73 7461 7274 272c 206f 6c69  time_start', oli
-000023c0: 2e67 6574 2827 7379 7374 656d 3a74 696d  .get('system:tim
-000023d0: 655f 7374 6172 7427 2929 0d0a 2020 7920  e_start'))..  y 
-000023e0: 3d20 792e 6164 6442 616e 6473 286f 6c69  = y.addBands(oli
-000023f0: 2e73 656c 6563 7428 6f74 6865 7242 6e73  .select(otherBns
-00002400: 2929 2e73 656c 6563 7428 626e 7329 3b0d  )).select(bns);.
-00002410: 0a20 2072 6574 7572 6e20 792e 666c 6f61  .  return y.floa
-00002420: 7428 290d 0a0d 0a0d 0a23 2323 2323 2323  t()......#######
-00002430: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00002440: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00002450: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00002460: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
-00002470: 436f 6465 2074 6f20 696d 706c 656d 656e  Code to implemen
-00002480: 7420 4f4c 492f 4554 4d2f 4d53 4920 7265  t OLI/ETM/MSI re
-00002490: 6772 6573 7369 6f6e 0d0a 2343 6861 7374  gression..#Chast
-000024a0: 6169 6e20 6574 2061 6c20 3230 3138 2063  ain et al 2018 c
-000024b0: 6f65 6666 6963 6965 6e74 730d 0a23 456d  oefficients..#Em
-000024c0: 7069 7269 6361 6c20 6372 6f73 7320 7365  pirical cross se
-000024d0: 6e73 6f72 2063 6f6d 7061 7269 736f 6e20  nsor comparison 
-000024e0: 6f66 2053 656e 7469 6e65 6c2d 3241 2061  of Sentinel-2A a
-000024f0: 6e64 2032 4220 4d53 492c 204c 616e 6473  nd 2B MSI, Lands
-00002500: 6174 2d38 204f 4c49 2c20 616e 6420 4c61  at-8 OLI, and La
-00002510: 6e64 7361 742d 3720 4554 4d2b 2074 6f70  ndsat-7 ETM+ top
-00002520: 206f 6620 6174 6d6f 7370 6865 7265 2073   of atmosphere s
-00002530: 7065 6374 7261 6c20 6368 6172 6163 7465  pectral characte
-00002540: 7269 7374 6963 7320 6f76 6572 2074 6865  ristics over the
-00002550: 2063 6f6e 7465 726d 696e 6f75 7320 556e   conterminous Un
-00002560: 6974 6564 2053 7461 7465 730d 0a23 6874  ited States..#ht
-00002570: 7470 733a 2f2f 7777 772e 7363 6965 6e63  tps://www.scienc
-00002580: 6564 6972 6563 742e 636f 6d2f 7363 6965  edirect.com/scie
-00002590: 6e63 652f 6172 7469 636c 652f 7069 692f  nce/article/pii/
-000025a0: 5330 3033 3434 3235 3731 3833 3035 3231  S003442571830521
-000025b0: 3223 7430 3032 300d 0a23 4c65 6674 206f  2#t0020..#Left o
-000025c0: 7574 2038 6120 636f 6566 6669 6369 656e  ut 8a coefficien
-000025d0: 7473 2073 696e 6365 2061 6c6c 2073 656e  ts since all sen
-000025e0: 736f 7273 206e 6565 6420 746f 2062 6520  sors need to be 
-000025f0: 6372 6f73 732d 2063 6f72 7265 6374 6564  cross- corrected
-00002600: 2077 6974 6820 6261 6e64 7320 636f 6d6d   with bands comm
-00002610: 6f6e 2074 6f20 616c 6c20 7365 6e73 6f72  on to all sensor
-00002620: 730d 0a23 4465 7065 6e64 656e 7420 616e  s..#Dependent an
-00002630: 6420 496e 6465 7065 6e64 656e 7420 7661  d Independent va
-00002640: 7269 6162 6c65 7320 6361 6e20 6265 2073  riables can be s
-00002650: 7769 7463 6865 6420 7369 6e63 6520 4d61  witched since Ma
-00002660: 6a6f 7220 4178 6973 2028 4d6f 6465 6c20  jor Axis (Model 
-00002670: 3229 206c 696e 6561 7220 7265 6772 6573  2) linear regres
-00002680: 7369 6f6e 2077 6173 2075 7365 640d 0a63  sion was used..c
-00002690: 6861 7374 6169 6e42 616e 644e 616d 6573  hastainBandNames
-000026a0: 203d 205b 2762 6c75 6527 2c27 6772 6565   = ['blue','gree
-000026b0: 6e27 2c27 7265 6427 2c27 6e69 7227 2c27  n','red','nir','
-000026c0: 7377 6972 3127 2c27 7377 6972 3227 5d0d  swir1','swir2'].
-000026d0: 0a0d 0a23 4672 6f6d 2054 6162 6c65 2034  ...#From Table 4
-000026e0: 0d0a 2320 6d73 6920 3d20 6f6c 692a 736c  ..# msi = oli*sl
-000026f0: 6f70 652b 696e 7465 7263 6570 740d 0a23  ope+intercept..#
-00002700: 206f 6c69 203d 2028 6d73 692d 696e 7465   oli = (msi-inte
-00002710: 7263 6570 7429 2f73 6c6f 7065 0d0a 6d73  rcept)/slope..ms
-00002720: 694f 4c49 536c 6f70 6573 203d 205b 312e  iOLISlopes = [1.
-00002730: 3039 3436 2c31 2e30 3034 332c 312e 3035  0946,1.0043,1.05
-00002740: 3234 2c30 2e38 3935 342c 312e 3030 3439  24,0.8954,1.0049
-00002750: 2c31 2e30 3030 325d 0d0a 6d73 694f 4c49  ,1.0002]..msiOLI
-00002760: 496e 7465 7263 6570 7473 203d 205b 2d30  Intercepts = [-0
-00002770: 2e30 3130 372c 302e 3030 3236 2c2d 302e  .0107,0.0026,-0.
-00002780: 3030 3135 2c30 2e30 3033 332c 302e 3030  0015,0.0033,0.00
-00002790: 3635 2c30 2e30 3034 365d 0d0a 0d0a 2346  65,0.0046]....#F
-000027a0: 726f 6d20 5461 626c 6520 350d 0a23 206d  rom Table 5..# m
-000027b0: 7369 203d 2065 746d 2a73 6c6f 7065 2b69  si = etm*slope+i
-000027c0: 6e74 6572 6365 7074 0d0a 2320 6574 6d20  ntercept..# etm 
-000027d0: 3d20 286d 7369 2d69 6e74 6572 6365 7074  = (msi-intercept
-000027e0: 292f 736c 6f70 650d 0a6d 7369 4554 4d53  )/slope..msiETMS
-000027f0: 6c6f 7065 7320 3d20 5b31 2e31 3036 3031  lopes = [1.10601
-00002800: 2c30 2e39 3930 3931 2c31 2e30 3536 3831  ,0.99091,1.05681
-00002810: 2c31 2e30 3034 352c 312e 3033 3631 312c  ,1.0045,1.03611,
-00002820: 312e 3034 3031 315d 0d0a 6d73 6945 544d  1.04011]..msiETM
-00002830: 496e 7465 7263 6570 7473 203d 205b 2d30  Intercepts = [-0
-00002840: 2e30 3133 392c 302e 3030 3431 312c 2d30  .0139,0.00411,-0
-00002850: 2e30 3032 342c 2d30 2e30 3037 362c 302e  .0024,-0.0076,0.
-00002860: 3030 3431 312c 302e 3030 3836 315d 0d0a  00411,0.00861]..
-00002870: 0d0a 2346 726f 6d20 5461 626c 6520 360d  ..#From Table 6.
-00002880: 0a23 206f 6c69 203d 2065 746d 2a73 6c6f  .# oli = etm*slo
-00002890: 7065 2b69 6e74 6572 6365 7074 0d0a 2320  pe+intercept..# 
-000028a0: 6574 6d20 3d20 286f 6c69 2d69 6e74 6572  etm = (oli-inter
-000028b0: 6365 7074 292f 736c 6f70 650d 0a6f 6c69  cept)/slope..oli
-000028c0: 4554 4d53 6c6f 7065 7320 3d5b 312e 3033  ETMSlopes =[1.03
-000028d0: 3530 312c 312e 3030 3932 312c 312e 3031  501,1.00921,1.01
-000028e0: 3939 312c 312e 3134 3036 312c 312e 3034  991,1.14061,1.04
-000028f0: 3335 312c 312e 3035 3237 315d 0d0a 6f6c  351,1.05271]..ol
-00002900: 6945 544d 496e 7465 7263 6570 7473 203d  iETMIntercepts =
-00002910: 205b 2d30 2e30 3035 352c 2d30 2e30 3030   [-0.0055,-0.000
-00002920: 382c 2d30 2e30 3032 312c 2d30 2e30 3136  8,-0.0021,-0.016
-00002930: 332c 2d30 2e30 3034 352c 302e 3030 3236  3,-0.0045,0.0026
-00002940: 315d 0d0a 0d0a 2343 6f6e 7374 7275 6374  1]....#Construct
-00002950: 2064 6963 7469 6f6e 6172 7920 746f 2068   dictionary to h
-00002960: 616e 646c 6520 616c 6c20 7061 6972 7769  andle all pairwi
-00002970: 7365 2063 6f6d 626f 730d 0a63 6861 7374  se combos..chast
-00002980: 6169 6e43 6f65 6666 4469 6374 203d 207b  ainCoeffDict = {
-00002990: 274d 5349 5f4f 4c49 273a 5b6d 7369 4f4c  'MSI_OLI':[msiOL
-000029a0: 4953 6c6f 7065 732c 6d73 694f 4c49 496e  ISlopes,msiOLIIn
-000029b0: 7465 7263 6570 7473 2c31 5d2c 5c0d 0a20  tercepts,1],\.. 
-000029c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000029d0: 2020 2020 2020 2020 274d 5349 5f45 544d          'MSI_ETM
-000029e0: 273a 5b6d 7369 4554 4d53 6c6f 7065 732c  ':[msiETMSlopes,
-000029f0: 6d73 6945 544d 496e 7465 7263 6570 7473  msiETMIntercepts
-00002a00: 2c31 5d2c 5c0d 0a20 2020 2020 2020 2020  ,1],\..         
-00002a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002a20: 274f 4c49 5f45 544d 273a 5b6f 6c69 4554  'OLI_ETM':[oliET
-00002a30: 4d53 6c6f 7065 732c 6f6c 6945 544d 496e  MSlopes,oliETMIn
-00002a40: 7465 7263 6570 7473 2c31 5d2c 5c0d 0a20  tercepts,1],\.. 
-00002a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002a60: 2020 2020 2020 2020 274f 4c49 5f4d 5349          'OLI_MSI
-00002a70: 273a 5b6d 7369 4f4c 4953 6c6f 7065 732c  ':[msiOLISlopes,
-00002a80: 6d73 694f 4c49 496e 7465 7263 6570 7473  msiOLIIntercepts
-00002a90: 2c30 5d2c 5c0d 0a20 2020 2020 2020 2020  ,0],\..         
-00002aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ab0: 2745 544d 5f4d 5349 273a 5b6d 7369 4554  'ETM_MSI':[msiET
-00002ac0: 4d53 6c6f 7065 732c 6d73 6945 544d 496e  MSlopes,msiETMIn
-00002ad0: 7465 7263 6570 7473 2c30 5d2c 5c0d 0a20  tercepts,0],\.. 
-00002ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002af0: 2020 2020 2020 2020 2745 544d 5f4f 4c49          'ETM_OLI
-00002b00: 273a 5b6f 6c69 4554 4d53 6c6f 7065 732c  ':[oliETMSlopes,
-00002b10: 6f6c 6945 544d 496e 7465 7263 6570 7473  oliETMIntercepts
-00002b20: 2c30 5d5c 0d0a 7d0d 0a0d 0a0d 0a0d 0a0d  ,0]\..}.........
-00002b30: 0a23 4675 6e63 7469 6f6e 2074 6f20 6170  .#Function to ap
-00002b40: 706c 7920 6d6f 6465 6c20 696e 206f 6e65  ply model in one
-00002b50: 2064 6972 6563 7469 6f6e 0d0a 6465 6620   direction..def 
-00002b60: 6469 7230 5265 6772 6573 7369 6f6e 2869  dir0Regression(i
-00002b70: 6d67 2c73 6c6f 7065 732c 696e 7465 7263  mg,slopes,interc
-00002b80: 6570 7473 293a 0d0a 2020 626e 7320 3d20  epts):..  bns = 
-00002b90: 696d 672e 6261 6e64 4e61 6d65 7328 290d  img.bandNames().
-00002ba0: 0a20 206e 6f6e 436f 7272 6563 7442 616e  .  nonCorrectBan
-00002bb0: 6473 203d 2062 6e73 2e72 656d 6f76 6541  ds = bns.removeA
-00002bc0: 6c6c 2863 6861 7374 6169 6e42 616e 644e  ll(chastainBandN
-00002bd0: 616d 6573 290d 0a20 206e 6f6e 436f 7272  ames)..  nonCorr
-00002be0: 6563 7465 6442 616e 6473 203d 2069 6d67  ectedBands = img
-00002bf0: 2e73 656c 6563 7428 6e6f 6e43 6f72 7265  .select(nonCorre
-00002c00: 6374 4261 6e64 7329 0d0a 2020 636f 7272  ctBands)..  corr
-00002c10: 6563 7465 6420 3d20 696d 672e 7365 6c65  ected = img.sele
-00002c20: 6374 2863 6861 7374 6169 6e42 616e 644e  ct(chastainBandN
-00002c30: 616d 6573 292e 6d75 6c74 6970 6c79 2873  ames).multiply(s
-00002c40: 6c6f 7065 7329 2e61 6464 2869 6e74 6572  lopes).add(inter
-00002c50: 6365 7074 7329 0d0a 2020 6f75 7420 3d20  cepts)..  out = 
-00002c60: 636f 7272 6563 7465 642e 6164 6442 616e  corrected.addBan
-00002c70: 6473 286e 6f6e 436f 7272 6563 7465 6442  ds(nonCorrectedB
-00002c80: 616e 6473 292e 7365 6c65 6374 2862 6e73  ands).select(bns
-00002c90: 290d 0a20 2072 6574 7572 6e20 6f75 740d  )..  return out.
-00002ca0: 0a0d 0a23 4170 706c 7969 6e67 2074 6865  ...#Applying the
-00002cb0: 206d 6f64 656c 2069 6e20 7468 6520 6f70   model in the op
-00002cc0: 706f 7369 7465 2064 6972 6563 7469 6f6e  posite direction
-00002cd0: 0d0a 6465 6620 6469 7231 5265 6772 6573  ..def dir1Regres
-00002ce0: 7369 6f6e 2869 6d67 2c73 6c6f 7065 732c  sion(img,slopes,
-00002cf0: 696e 7465 7263 6570 7473 293a 0d0a 2020  intercepts):..  
-00002d00: 626e 7320 3d20 696d 672e 6261 6e64 4e61  bns = img.bandNa
-00002d10: 6d65 7328 290d 0a20 206e 6f6e 436f 7272  mes()..  nonCorr
-00002d20: 6563 7442 616e 6473 203d 2062 6e73 2e72  ectBands = bns.r
-00002d30: 656d 6f76 6541 6c6c 2863 6861 7374 6169  emoveAll(chastai
-00002d40: 6e42 616e 644e 616d 6573 290d 0a20 206e  nBandNames)..  n
-00002d50: 6f6e 436f 7272 6563 7465 6442 616e 6473  onCorrectedBands
-00002d60: 203d 2069 6d67 2e73 656c 6563 7428 6e6f   = img.select(no
-00002d70: 6e43 6f72 7265 6374 4261 6e64 7329 0d0a  nCorrectBands)..
-00002d80: 2020 636f 7272 6563 7465 6420 3d20 696d    corrected = im
-00002d90: 672e 7365 6c65 6374 2863 6861 7374 6169  g.select(chastai
-00002da0: 6e42 616e 644e 616d 6573 292e 7375 6274  nBandNames).subt
-00002db0: 7261 6374 2869 6e74 6572 6365 7074 7329  ract(intercepts)
-00002dc0: 2e64 6976 6964 6528 736c 6f70 6573 290d  .divide(slopes).
-00002dd0: 0a20 206f 7574 203d 2063 6f72 7265 6374  .  out = correct
-00002de0: 6564 2e61 6464 4261 6e64 7328 6e6f 6e43  ed.addBands(nonC
-00002df0: 6f72 7265 6374 6564 4261 6e64 7329 2e73  orrectedBands).s
-00002e00: 656c 6563 7428 626e 7329 0d0a 2020 7265  elect(bns)..  re
-00002e10: 7475 726e 206f 7574 0d0a 0d0a 2346 756e  turn out....#Fun
-00002e20: 6374 696f 6e20 746f 2063 6f72 7265 6374  ction to correct
-00002e30: 206f 6e65 2073 656e 736f 7220 746f 2061   one sensor to a
-00002e40: 6e6f 7468 6572 0d0a 6465 6620 6861 726d  nother..def harm
-00002e50: 6f6e 697a 6174 696f 6e43 6861 7374 6169  onizationChastai
-00002e60: 6e28 696d 672c 2066 726f 6d53 656e 736f  n(img, fromSenso
-00002e70: 722c 2074 6f53 656e 736f 7229 3a0d 0a20  r, toSensor):.. 
-00002e80: 2061 7267 7320 3d20 666f 726d 6174 4172   args = formatAr
-00002e90: 6773 286c 6f63 616c 7328 2929 0d0a 0d0a  gs(locals())....
-00002ea0: 2020 2347 6574 2074 6865 206d 6f64 656c    #Get the model
-00002eb0: 2066 6f72 2074 6865 2067 6976 656e 2066   for the given f
-00002ec0: 726f 6d20 616e 6420 746f 2073 656e 736f  rom and to senso
-00002ed0: 720d 0a20 2063 6f6d 626f 4b65 7920 3d20  r..  comboKey = 
-00002ee0: 6672 6f6d 5365 6e73 6f72 2e75 7070 6572  fromSensor.upper
-00002ef0: 2829 2b27 5f27 2b74 6f53 656e 736f 722e  ()+'_'+toSensor.
-00002f00: 7570 7065 7228 290d 0a20 2063 6f65 6666  upper()..  coeff
-00002f10: 4c69 7374 203d 2063 6861 7374 6169 6e43  List = chastainC
-00002f20: 6f65 6666 4469 6374 5b63 6f6d 626f 4b65  oeffDict[comboKe
-00002f30: 795d 0d0a 2020 736c 6f70 6573 203d 2063  y]..  slopes = c
-00002f40: 6f65 6666 4c69 7374 5b30 5d0d 0a20 2069  oeffList[0]..  i
-00002f50: 6e74 6572 6365 7074 7320 3d20 636f 6566  ntercepts = coef
-00002f60: 664c 6973 745b 315d 0d0a 2020 6469 7265  fList[1]..  dire
-00002f70: 6374 696f 6e20 3d20 6565 2e4e 756d 6265  ction = ee.Numbe
-00002f80: 7228 636f 6566 664c 6973 745b 325d 290d  r(coeffList[2]).
-00002f90: 0a0d 0a20 2023 4170 706c 7920 7468 6520  ...  #Apply the 
-00002fa0: 6d6f 6465 6c20 696e 2074 6865 2072 6573  model in the res
-00002fb0: 7065 6374 6976 6520 6469 7265 6374 696f  pective directio
-00002fc0: 6e0d 0a20 206f 7574 203d 2065 652e 416c  n..  out = ee.Al
-00002fd0: 676f 7269 7468 6d73 2e49 6628 6469 7265  gorithms.If(dire
-00002fe0: 6374 696f 6e2e 6571 2830 292c 2064 6972  ction.eq(0), dir
-00002ff0: 3052 6567 7265 7373 696f 6e28 696d 672c  0Regression(img,
-00003000: 736c 6f70 6573 2c69 6e74 6572 6365 7074  slopes,intercept
-00003010: 7329 2c20 6469 7231 5265 6772 6573 7369  s), dir1Regressi
-00003020: 6f6e 2869 6d67 2c73 6c6f 7065 732c 696e  on(img,slopes,in
-00003030: 7465 7263 6570 7473 2929 0d0a 2020 6f75  tercepts))..  ou
-00003040: 7420 3d20 6565 2e49 6d61 6765 286f 7574  t = ee.Image(out
-00003050: 292e 636f 7079 5072 6f70 6572 7469 6573  ).copyProperties
-00003060: 2869 6d67 292e 636f 7079 5072 6f70 6572  (img).copyProper
-00003070: 7469 6573 2869 6d67 2c5b 2773 7973 7465  ties(img,['syste
-00003080: 6d3a 7469 6d65 5f73 7461 7274 275d 290d  m:time_start']).
-00003090: 0a20 206f 7574 203d 206f 7574 2e73 6574  .  out = out.set
-000030a0: 287b 2766 726f 6d53 656e 736f 7227 3a20  ({'fromSensor': 
-000030b0: 6672 6f6d 5365 6e73 6f72 2c20 2774 6f53  fromSensor, 'toS
-000030c0: 656e 736f 7227 3a20 746f 5365 6e73 6f72  ensor': toSensor
-000030d0: 7d29 2e73 6574 2861 7267 7329 0d0a 2020  }).set(args)..  
-000030e0: 7265 7475 726e 2065 652e 496d 6167 6528  return ee.Image(
-000030f0: 6f75 7429 0d0a 0d0a 0d0a 2323 2323 2323  out)......######
-00003100: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00003110: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00003120: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00003130: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
-00003140: 2346 756e 6374 696f 6e20 746f 2063 7265  #Function to cre
-00003150: 6174 6520 6120 6d75 6c74 6962 616e 6420  ate a multiband 
-00003160: 696d 6167 6520 6672 6f6d 2061 2063 6f6c  image from a col
-00003170: 6c65 6374 696f 6e0d 0a64 6566 2063 6f6c  lection..def col
-00003180: 6c65 6374 696f 6e54 6f49 6d61 6765 2863  lectionToImage(c
-00003190: 6f6c 6c65 6374 696f 6e29 3a0d 0a20 2064  ollection):..  d
-000031a0: 6566 2063 4974 6572 6174 6f72 2869 6d67  ef cIterator(img
-000031b0: 2c70 7265 7629 3a0d 0a20 2020 2072 6574  ,prev):..    ret
-000031c0: 7572 6e20 6565 2e49 6d61 6765 2870 7265  urn ee.Image(pre
-000031d0: 7629 2e61 6464 4261 6e64 7328 696d 6729  v).addBands(img)
-000031e0: 0d0a 2020 7374 6163 6b20 3d20 6565 2e49  ..  stack = ee.I
-000031f0: 6d61 6765 2863 6f6c 6c65 6374 696f 6e2e  mage(collection.
-00003200: 6974 6572 6174 6528 6349 7465 7261 746f  iterate(cIterato
-00003210: 722c 2065 652e 496d 6167 6528 3129 2929  r, ee.Image(1)))
-00003220: 0d0a 2020 7374 6163 6b20 3d20 7374 6163  ..  stack = stac
-00003230: 6b2e 7365 6c65 6374 2865 652e 4c69 7374  k.select(ee.List
-00003240: 2e73 6571 7565 6e63 6528 312c 2073 7461  .sequence(1, sta
-00003250: 636b 2e62 616e 644e 616d 6573 2829 2e73  ck.bandNames().s
-00003260: 697a 6528 292e 7375 6274 7261 6374 2831  ize().subtract(1
-00003270: 2929 290d 0a20 2072 6574 7572 6e20 7374  )))..  return st
-00003280: 6163 6b0d 0a0d 0a23 2323 2323 2323 2323  ack....#########
+00001d60: 2323 2323 2323 2323 230d 0a23 4675 6e63  #########..#Func
+00001d70: 7469 6f6e 7320 746f 2070 6572 666f 726d  tions to perform
+00001d80: 2062 6173 6963 2063 6c75 6d70 2061 6e64   basic clump and
+00001d90: 2065 6c69 6d0d 0a64 6566 2073 6965 7665   elim..def sieve
+00001da0: 2869 6d61 6765 2c20 6d6d 7529 3a0d 0a20  (image, mmu):.. 
+00001db0: 2061 7267 7320 3d20 666f 726d 6174 4172   args = formatAr
+00001dc0: 6773 286c 6f63 616c 7328 2929 0d0a 2020  gs(locals())..  
+00001dd0: 636f 6e6e 6563 7465 6420 3d20 696d 6167  connected = imag
+00001de0: 652e 636f 6e6e 6563 7465 6450 6978 656c  e.connectedPixel
+00001df0: 436f 756e 7428 6d6d 752b 3230 290d 0a20  Count(mmu+20).. 
+00001e00: 2023 4d61 702e 6164 644c 6179 6572 2863   #Map.addLayer(c
+00001e10: 6f6e 6e65 6374 6564 2c7b 276d 696e 273a  onnected,{'min':
+00001e20: 312c 276d 6178 273a 6d6d 757d 2c27 636f  1,'max':mmu},'co
+00001e30: 6e6e 6563 7465 6427 290d 0a20 2065 6c69  nnected')..  eli
+00001e40: 6d20 3d20 636f 6e6e 6563 7465 642e 6774  m = connected.gt
+00001e50: 286d 6d75 290d 0a20 206d 6f64 6520 3d20  (mmu)..  mode = 
+00001e60: 696d 6167 652e 666f 6361 6c5f 6d6f 6465  image.focal_mode
+00001e70: 286d 6d75 2f32 2c27 6369 7263 6c65 2729  (mmu/2,'circle')
+00001e80: 0d0a 2020 6d6f 6465 203d 206d 6f64 652e  ..  mode = mode.
+00001e90: 6d61 736b 2869 6d61 6765 2e6d 6173 6b28  mask(image.mask(
+00001ea0: 2929 0d0a 2020 6669 6c6c 6564 203d 2069  ))..  filled = i
+00001eb0: 6d61 6765 2e77 6865 7265 2865 6c69 6d2e  mage.where(elim.
+00001ec0: 4e6f 7428 292c 6d6f 6465 290d 0a20 2072  Not(),mode)..  r
+00001ed0: 6574 7572 6e20 6669 6c6c 6564 2e73 6574  eturn filled.set
+00001ee0: 2827 6d6d 7527 2c20 6d6d 7529 2e73 6574  ('mmu', mmu).set
+00001ef0: 2861 7267 7329 0d0a 0d0a 0d0a 2357 7269  (args)......#Wri
+00001f00: 7474 656e 2062 7920 5961 6e67 205a 2e0d  tten by Yang Z..
+00001f10: 0a23 2d2d 2d2d 2d2d 204c 3820 746f 204c  .#------ L8 to L
+00001f20: 3720 4841 524d 4f4e 495a 4154 494f 4e20  7 HARMONIZATION 
+00001f30: 4655 4e43 5449 4f4e 202d 2d2d 2d2d 0d0a  FUNCTION -----..
+00001f40: 2320 736c 6f70 6520 616e 6420 696e 7465  # slope and inte
+00001f50: 7263 6570 7420 6369 7461 7469 6f6e 3a20  rcept citation: 
+00001f60: 526f 792c 2044 2e50 2e2c 204b 6f76 616c  Roy, D.P., Koval
+00001f70: 736b 7979 2c20 562e 2c20 5a68 616e 672c  skyy, V., Zhang,
+00001f80: 2048 2e4b 2e2c 2056 6572 6d6f 7465 2c20   H.K., Vermote, 
+00001f90: 452e 462e 2c20 5961 6e2c 204c 2e2c 204b  E.F., Yan, L., K
+00001fa0: 756d 6172 2c20 532e 532c 2045 676f 726f  umar, S.S, Egoro
+00001fb0: 762c 2041 2e2c 2032 3031 362c 2043 6861  v, A., 2016, Cha
+00001fc0: 7261 6374 6572 697a 6174 696f 6e20 6f66  racterization of
+00001fd0: 204c 616e 6473 6174 2d37 2074 6f20 4c61   Landsat-7 to La
+00001fe0: 6e64 7361 742d 3820 7265 666c 6563 7469  ndsat-8 reflecti
+00001ff0: 7665 2077 6176 656c 656e 6774 6820 616e  ve wavelength an
+00002000: 6420 6e6f 726d 616c 697a 6564 2064 6966  d normalized dif
+00002010: 6665 7265 6e63 6520 7665 6765 7461 7469  ference vegetati
+00002020: 6f6e 2069 6e64 6578 2063 6f6e 7469 6e75  on index continu
+00002030: 6974 792c 2052 656d 6f74 6520 5365 6e73  ity, Remote Sens
+00002040: 696e 6720 6f66 2045 6e76 6972 6f6e 6d65  ing of Environme
+00002050: 6e74 2c20 3138 352c 2035 372d 3730 2e28  nt, 185, 57-70.(
+00002060: 6874 7470 3a2f 2f64 782e 646f 692e 6f72  http://dx.doi.or
+00002070: 672f 3130 2e31 3031 362f 6a2e 7273 652e  g/10.1016/j.rse.
+00002080: 3230 3135 2e31 322e 3032 3429 3b20 5461  2015.12.024); Ta
+00002090: 626c 6520 3220 2d20 7265 6475 6365 6420  ble 2 - reduced 
+000020a0: 6d61 6a6f 7220 6178 6973 2028 524d 4129  major axis (RMA)
+000020b0: 2072 6567 7265 7373 696f 6e20 636f 6566   regression coef
+000020c0: 6669 6369 656e 7473 0d0a 6465 6620 6861  ficients..def ha
+000020d0: 726d 6f6e 697a 6174 696f 6e52 6f79 286f  rmonizationRoy(o
+000020e0: 6c69 293a 0d0a 2020 736c 6f70 6573 203d  li):..  slopes =
+000020f0: 2065 652e 496d 6167 652e 636f 6e73 7461   ee.Image.consta
+00002100: 6e74 285b 302e 3937 3835 2c20 302e 3935  nt([0.9785, 0.95
+00002110: 3432 2c20 302e 3938 3235 2c20 312e 3030  42, 0.9825, 1.00
+00002120: 3733 2c20 312e 3031 3731 2c20 302e 3939  73, 1.0171, 0.99
+00002130: 3439 5d29 2363 7265 6174 6520 616e 2069  49])#create an i
+00002140: 6d61 6765 206f 6620 736c 6f70 6573 2070  mage of slopes p
+00002150: 6572 2062 616e 6420 666f 7220 4c38 2054  er band for L8 T
+00002160: 4f20 4c37 2072 6567 7265 7373 696f 6e20  O L7 regression 
+00002170: 6c69 6e65 202d 2044 6176 6964 2052 6f79  line - David Roy
+00002180: 0d0a 2020 6974 6370 203d 2065 652e 496d  ..  itcp = ee.Im
+00002190: 6167 652e 636f 6e73 7461 6e74 285b 2d30  age.constant([-0
+000021a0: 2e30 3039 352c 202d 302e 3030 3136 2c20  .0095, -0.0016, 
+000021b0: 2d30 2e30 3032 322c 202d 302e 3030 3231  -0.0022, -0.0021
+000021c0: 2c20 2d30 2e30 3033 302c 2030 2e30 3032  , -0.0030, 0.002
+000021d0: 395d 2923 6372 6561 7465 2061 6e20 696d  9])#create an im
+000021e0: 6167 6520 6f66 2079 2d69 6e74 6572 6365  age of y-interce
+000021f0: 7074 7320 7065 7220 6261 6e64 2066 6f72  pts per band for
+00002200: 204c 3820 544f 204c 3720 7265 6772 6573   L8 TO L7 regres
+00002210: 7369 6f6e 206c 696e 6520 2d20 4461 7669  sion line - Davi
+00002220: 6420 526f 790d 0a20 2062 6e73 203d 206f  d Roy..  bns = o
+00002230: 6c69 2e62 616e 644e 616d 6573 2829 0d0a  li.bandNames()..
+00002240: 2020 696e 636c 7564 6542 6e73 203d 205b    includeBns = [
+00002250: 2762 6c75 6527 2c27 6772 6565 6e27 2c27  'blue','green','
+00002260: 7265 6427 2c27 6e69 7227 2c27 7377 6972  red','nir','swir
+00002270: 3127 2c27 7377 6972 3227 205d 0d0a 2020  1','swir2' ]..  
+00002280: 6f74 6865 7242 6e73 203d 2062 6e73 2e72  otherBns = bns.r
+00002290: 656d 6f76 6541 6c6c 2869 6e63 6c75 6465  emoveAll(include
+000022a0: 426e 7329 0d0a 0d0a 2020 2363 7265 6174  Bns)....  #creat
+000022b0: 6520 616e 2069 6d61 6765 206f 6620 792d  e an image of y-
+000022c0: 696e 7465 7263 6570 7473 2070 6572 2062  intercepts per b
+000022d0: 616e 6420 666f 7220 4c38 2054 4f20 4c37  and for L8 TO L7
+000022e0: 2072 6567 7265 7373 696f 6e20 6c69 6e65   regression line
+000022f0: 202d 2044 6176 6964 2052 6f79 0d0a 2020   - David Roy..  
+00002300: 7920 3d20 6f6c 692e 7365 6c65 6374 2869  y = oli.select(i
+00002310: 6e63 6c75 6465 426e 7329 2e66 6c6f 6174  ncludeBns).float
+00002320: 2829 2e73 7562 7472 6163 7428 6974 6370  ().subtract(itcp
+00002330: 292e 6469 7669 6465 2873 6c6f 7065 7329  ).divide(slopes)
+00002340: 2e73 6574 2827 7379 7374 656d 3a74 696d  .set('system:tim
+00002350: 655f 7374 6172 7427 2c20 6f6c 692e 6765  e_start', oli.ge
+00002360: 7428 2773 7973 7465 6d3a 7469 6d65 5f73  t('system:time_s
+00002370: 7461 7274 2729 290d 0a20 2079 203d 2079  tart'))..  y = y
+00002380: 2e61 6464 4261 6e64 7328 6f6c 692e 7365  .addBands(oli.se
+00002390: 6c65 6374 286f 7468 6572 426e 7329 292e  lect(otherBns)).
+000023a0: 7365 6c65 6374 2862 6e73 293b 0d0a 2020  select(bns);..  
+000023b0: 7265 7475 726e 2079 2e66 6c6f 6174 2829  return y.float()
+000023c0: 0d0a 0d0a 0d0a 2323 2323 2323 2323 2323  ......##########
+000023d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000023e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000023f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00002400: 2323 2323 2323 2323 2323 0d0a 2343 6f64  ##########..#Cod
+00002410: 6520 746f 2069 6d70 6c65 6d65 6e74 204f  e to implement O
+00002420: 4c49 2f45 544d 2f4d 5349 2072 6567 7265  LI/ETM/MSI regre
+00002430: 7373 696f 6e0d 0a23 4368 6173 7461 696e  ssion..#Chastain
+00002440: 2065 7420 616c 2032 3031 3820 636f 6566   et al 2018 coef
+00002450: 6669 6369 656e 7473 0d0a 2345 6d70 6972  ficients..#Empir
+00002460: 6963 616c 2063 726f 7373 2073 656e 736f  ical cross senso
+00002470: 7220 636f 6d70 6172 6973 6f6e 206f 6620  r comparison of 
+00002480: 5365 6e74 696e 656c 2d32 4120 616e 6420  Sentinel-2A and 
+00002490: 3242 204d 5349 2c20 4c61 6e64 7361 742d  2B MSI, Landsat-
+000024a0: 3820 4f4c 492c 2061 6e64 204c 616e 6473  8 OLI, and Lands
+000024b0: 6174 2d37 2045 544d 2b20 746f 7020 6f66  at-7 ETM+ top of
+000024c0: 2061 746d 6f73 7068 6572 6520 7370 6563   atmosphere spec
+000024d0: 7472 616c 2063 6861 7261 6374 6572 6973  tral characteris
+000024e0: 7469 6373 206f 7665 7220 7468 6520 636f  tics over the co
+000024f0: 6e74 6572 6d69 6e6f 7573 2055 6e69 7465  nterminous Unite
+00002500: 6420 5374 6174 6573 0d0a 2368 7474 7073  d States..#https
+00002510: 3a2f 2f77 7777 2e73 6369 656e 6365 6469  ://www.sciencedi
+00002520: 7265 6374 2e63 6f6d 2f73 6369 656e 6365  rect.com/science
+00002530: 2f61 7274 6963 6c65 2f70 6969 2f53 3030  /article/pii/S00
+00002540: 3334 3432 3537 3138 3330 3532 3132 2374  34425718305212#t
+00002550: 3030 3230 0d0a 234c 6566 7420 6f75 7420  0020..#Left out 
+00002560: 3861 2063 6f65 6666 6963 6965 6e74 7320  8a coefficients 
+00002570: 7369 6e63 6520 616c 6c20 7365 6e73 6f72  since all sensor
+00002580: 7320 6e65 6564 2074 6f20 6265 2063 726f  s need to be cro
+00002590: 7373 2d20 636f 7272 6563 7465 6420 7769  ss- corrected wi
+000025a0: 7468 2062 616e 6473 2063 6f6d 6d6f 6e20  th bands common 
+000025b0: 746f 2061 6c6c 2073 656e 736f 7273 0d0a  to all sensors..
+000025c0: 2344 6570 656e 6465 6e74 2061 6e64 2049  #Dependent and I
+000025d0: 6e64 6570 656e 6465 6e74 2076 6172 6961  ndependent varia
+000025e0: 626c 6573 2063 616e 2062 6520 7377 6974  bles can be swit
+000025f0: 6368 6564 2073 696e 6365 204d 616a 6f72  ched since Major
+00002600: 2041 7869 7320 284d 6f64 656c 2032 2920   Axis (Model 2) 
+00002610: 6c69 6e65 6172 2072 6567 7265 7373 696f  linear regressio
+00002620: 6e20 7761 7320 7573 6564 0d0a 6368 6173  n was used..chas
+00002630: 7461 696e 4261 6e64 4e61 6d65 7320 3d20  tainBandNames = 
+00002640: 5b27 626c 7565 272c 2767 7265 656e 272c  ['blue','green',
+00002650: 2772 6564 272c 276e 6972 272c 2773 7769  'red','nir','swi
+00002660: 7231 272c 2773 7769 7232 275d 0d0a 0d0a  r1','swir2']....
+00002670: 2346 726f 6d20 5461 626c 6520 340d 0a23  #From Table 4..#
+00002680: 206d 7369 203d 206f 6c69 2a73 6c6f 7065   msi = oli*slope
+00002690: 2b69 6e74 6572 6365 7074 0d0a 2320 6f6c  +intercept..# ol
+000026a0: 6920 3d20 286d 7369 2d69 6e74 6572 6365  i = (msi-interce
+000026b0: 7074 292f 736c 6f70 650d 0a6d 7369 4f4c  pt)/slope..msiOL
+000026c0: 4953 6c6f 7065 7320 3d20 5b31 2e30 3934  ISlopes = [1.094
+000026d0: 362c 312e 3030 3433 2c31 2e30 3532 342c  6,1.0043,1.0524,
+000026e0: 302e 3839 3534 2c31 2e30 3034 392c 312e  0.8954,1.0049,1.
+000026f0: 3030 3032 5d0d 0a6d 7369 4f4c 4949 6e74  0002]..msiOLIInt
+00002700: 6572 6365 7074 7320 3d20 5b2d 302e 3031  ercepts = [-0.01
+00002710: 3037 2c30 2e30 3032 362c 2d30 2e30 3031  07,0.0026,-0.001
+00002720: 352c 302e 3030 3333 2c30 2e30 3036 352c  5,0.0033,0.0065,
+00002730: 302e 3030 3436 5d0d 0a0d 0a23 4672 6f6d  0.0046]....#From
+00002740: 2054 6162 6c65 2035 0d0a 2320 6d73 6920   Table 5..# msi 
+00002750: 3d20 6574 6d2a 736c 6f70 652b 696e 7465  = etm*slope+inte
+00002760: 7263 6570 740d 0a23 2065 746d 203d 2028  rcept..# etm = (
+00002770: 6d73 692d 696e 7465 7263 6570 7429 2f73  msi-intercept)/s
+00002780: 6c6f 7065 0d0a 6d73 6945 544d 536c 6f70  lope..msiETMSlop
+00002790: 6573 203d 205b 312e 3130 3630 312c 302e  es = [1.10601,0.
+000027a0: 3939 3039 312c 312e 3035 3638 312c 312e  99091,1.05681,1.
+000027b0: 3030 3435 2c31 2e30 3336 3131 2c31 2e30  0045,1.03611,1.0
+000027c0: 3430 3131 5d0d 0a6d 7369 4554 4d49 6e74  4011]..msiETMInt
+000027d0: 6572 6365 7074 7320 3d20 5b2d 302e 3031  ercepts = [-0.01
+000027e0: 3339 2c30 2e30 3034 3131 2c2d 302e 3030  39,0.00411,-0.00
+000027f0: 3234 2c2d 302e 3030 3736 2c30 2e30 3034  24,-0.0076,0.004
+00002800: 3131 2c30 2e30 3038 3631 5d0d 0a0d 0a23  11,0.00861]....#
+00002810: 4672 6f6d 2054 6162 6c65 2036 0d0a 2320  From Table 6..# 
+00002820: 6f6c 6920 3d20 6574 6d2a 736c 6f70 652b  oli = etm*slope+
+00002830: 696e 7465 7263 6570 740d 0a23 2065 746d  intercept..# etm
+00002840: 203d 2028 6f6c 692d 696e 7465 7263 6570   = (oli-intercep
+00002850: 7429 2f73 6c6f 7065 0d0a 6f6c 6945 544d  t)/slope..oliETM
+00002860: 536c 6f70 6573 203d 5b31 2e30 3335 3031  Slopes =[1.03501
+00002870: 2c31 2e30 3039 3231 2c31 2e30 3139 3931  ,1.00921,1.01991
+00002880: 2c31 2e31 3430 3631 2c31 2e30 3433 3531  ,1.14061,1.04351
+00002890: 2c31 2e30 3532 3731 5d0d 0a6f 6c69 4554  ,1.05271]..oliET
+000028a0: 4d49 6e74 6572 6365 7074 7320 3d20 5b2d  MIntercepts = [-
+000028b0: 302e 3030 3535 2c2d 302e 3030 3038 2c2d  0.0055,-0.0008,-
+000028c0: 302e 3030 3231 2c2d 302e 3031 3633 2c2d  0.0021,-0.0163,-
+000028d0: 302e 3030 3435 2c30 2e30 3032 3631 5d0d  0.0045,0.00261].
+000028e0: 0a0d 0a23 436f 6e73 7472 7563 7420 6469  ...#Construct di
+000028f0: 6374 696f 6e61 7279 2074 6f20 6861 6e64  ctionary to hand
+00002900: 6c65 2061 6c6c 2070 6169 7277 6973 6520  le all pairwise 
+00002910: 636f 6d62 6f73 0d0a 6368 6173 7461 696e  combos..chastain
+00002920: 436f 6566 6644 6963 7420 3d20 7b27 4d53  CoeffDict = {'MS
+00002930: 495f 4f4c 4927 3a5b 6d73 694f 4c49 536c  I_OLI':[msiOLISl
+00002940: 6f70 6573 2c6d 7369 4f4c 4949 6e74 6572  opes,msiOLIInter
+00002950: 6365 7074 732c 315d 2c5c 0d0a 2020 2020  cepts,1],\..    
+00002960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002970: 2020 2020 2027 4d53 495f 4554 4d27 3a5b       'MSI_ETM':[
+00002980: 6d73 6945 544d 536c 6f70 6573 2c6d 7369  msiETMSlopes,msi
+00002990: 4554 4d49 6e74 6572 6365 7074 732c 315d  ETMIntercepts,1]
+000029a0: 2c5c 0d0a 2020 2020 2020 2020 2020 2020  ,\..            
+000029b0: 2020 2020 2020 2020 2020 2020 2027 4f4c               'OL
+000029c0: 495f 4554 4d27 3a5b 6f6c 6945 544d 536c  I_ETM':[oliETMSl
+000029d0: 6f70 6573 2c6f 6c69 4554 4d49 6e74 6572  opes,oliETMInter
+000029e0: 6365 7074 732c 315d 2c5c 0d0a 2020 2020  cepts,1],\..    
+000029f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002a00: 2020 2020 2027 4f4c 495f 4d53 4927 3a5b       'OLI_MSI':[
+00002a10: 6d73 694f 4c49 536c 6f70 6573 2c6d 7369  msiOLISlopes,msi
+00002a20: 4f4c 4949 6e74 6572 6365 7074 732c 305d  OLIIntercepts,0]
+00002a30: 2c5c 0d0a 2020 2020 2020 2020 2020 2020  ,\..            
+00002a40: 2020 2020 2020 2020 2020 2020 2027 4554               'ET
+00002a50: 4d5f 4d53 4927 3a5b 6d73 6945 544d 536c  M_MSI':[msiETMSl
+00002a60: 6f70 6573 2c6d 7369 4554 4d49 6e74 6572  opes,msiETMInter
+00002a70: 6365 7074 732c 305d 2c5c 0d0a 2020 2020  cepts,0],\..    
+00002a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002a90: 2020 2020 2027 4554 4d5f 4f4c 4927 3a5b       'ETM_OLI':[
+00002aa0: 6f6c 6945 544d 536c 6f70 6573 2c6f 6c69  oliETMSlopes,oli
+00002ab0: 4554 4d49 6e74 6572 6365 7074 732c 305d  ETMIntercepts,0]
+00002ac0: 5c0d 0a7d 0d0a 0d0a 0d0a 0d0a 0d0a 2346  \..}..........#F
+00002ad0: 756e 6374 696f 6e20 746f 2061 7070 6c79  unction to apply
+00002ae0: 206d 6f64 656c 2069 6e20 6f6e 6520 6469   model in one di
+00002af0: 7265 6374 696f 6e0d 0a64 6566 2064 6972  rection..def dir
+00002b00: 3052 6567 7265 7373 696f 6e28 696d 672c  0Regression(img,
+00002b10: 736c 6f70 6573 2c69 6e74 6572 6365 7074  slopes,intercept
+00002b20: 7329 3a0d 0a20 2062 6e73 203d 2069 6d67  s):..  bns = img
+00002b30: 2e62 616e 644e 616d 6573 2829 0d0a 2020  .bandNames()..  
+00002b40: 6e6f 6e43 6f72 7265 6374 4261 6e64 7320  nonCorrectBands 
+00002b50: 3d20 626e 732e 7265 6d6f 7665 416c 6c28  = bns.removeAll(
+00002b60: 6368 6173 7461 696e 4261 6e64 4e61 6d65  chastainBandName
+00002b70: 7329 0d0a 2020 6e6f 6e43 6f72 7265 6374  s)..  nonCorrect
+00002b80: 6564 4261 6e64 7320 3d20 696d 672e 7365  edBands = img.se
+00002b90: 6c65 6374 286e 6f6e 436f 7272 6563 7442  lect(nonCorrectB
+00002ba0: 616e 6473 290d 0a20 2063 6f72 7265 6374  ands)..  correct
+00002bb0: 6564 203d 2069 6d67 2e73 656c 6563 7428  ed = img.select(
+00002bc0: 6368 6173 7461 696e 4261 6e64 4e61 6d65  chastainBandName
+00002bd0: 7329 2e6d 756c 7469 706c 7928 736c 6f70  s).multiply(slop
+00002be0: 6573 292e 6164 6428 696e 7465 7263 6570  es).add(intercep
+00002bf0: 7473 290d 0a20 206f 7574 203d 2063 6f72  ts)..  out = cor
+00002c00: 7265 6374 6564 2e61 6464 4261 6e64 7328  rected.addBands(
+00002c10: 6e6f 6e43 6f72 7265 6374 6564 4261 6e64  nonCorrectedBand
+00002c20: 7329 2e73 656c 6563 7428 626e 7329 0d0a  s).select(bns)..
+00002c30: 2020 7265 7475 726e 206f 7574 0d0a 0d0a    return out....
+00002c40: 2341 7070 6c79 696e 6720 7468 6520 6d6f  #Applying the mo
+00002c50: 6465 6c20 696e 2074 6865 206f 7070 6f73  del in the oppos
+00002c60: 6974 6520 6469 7265 6374 696f 6e0d 0a64  ite direction..d
+00002c70: 6566 2064 6972 3152 6567 7265 7373 696f  ef dir1Regressio
+00002c80: 6e28 696d 672c 736c 6f70 6573 2c69 6e74  n(img,slopes,int
+00002c90: 6572 6365 7074 7329 3a0d 0a20 2062 6e73  ercepts):..  bns
+00002ca0: 203d 2069 6d67 2e62 616e 644e 616d 6573   = img.bandNames
+00002cb0: 2829 0d0a 2020 6e6f 6e43 6f72 7265 6374  ()..  nonCorrect
+00002cc0: 4261 6e64 7320 3d20 626e 732e 7265 6d6f  Bands = bns.remo
+00002cd0: 7665 416c 6c28 6368 6173 7461 696e 4261  veAll(chastainBa
+00002ce0: 6e64 4e61 6d65 7329 0d0a 2020 6e6f 6e43  ndNames)..  nonC
+00002cf0: 6f72 7265 6374 6564 4261 6e64 7320 3d20  orrectedBands = 
+00002d00: 696d 672e 7365 6c65 6374 286e 6f6e 436f  img.select(nonCo
+00002d10: 7272 6563 7442 616e 6473 290d 0a20 2063  rrectBands)..  c
+00002d20: 6f72 7265 6374 6564 203d 2069 6d67 2e73  orrected = img.s
+00002d30: 656c 6563 7428 6368 6173 7461 696e 4261  elect(chastainBa
+00002d40: 6e64 4e61 6d65 7329 2e73 7562 7472 6163  ndNames).subtrac
+00002d50: 7428 696e 7465 7263 6570 7473 292e 6469  t(intercepts).di
+00002d60: 7669 6465 2873 6c6f 7065 7329 0d0a 2020  vide(slopes)..  
+00002d70: 6f75 7420 3d20 636f 7272 6563 7465 642e  out = corrected.
+00002d80: 6164 6442 616e 6473 286e 6f6e 436f 7272  addBands(nonCorr
+00002d90: 6563 7465 6442 616e 6473 292e 7365 6c65  ectedBands).sele
+00002da0: 6374 2862 6e73 290d 0a20 2072 6574 7572  ct(bns)..  retur
+00002db0: 6e20 6f75 740d 0a0d 0a23 4675 6e63 7469  n out....#Functi
+00002dc0: 6f6e 2074 6f20 636f 7272 6563 7420 6f6e  on to correct on
+00002dd0: 6520 7365 6e73 6f72 2074 6f20 616e 6f74  e sensor to anot
+00002de0: 6865 720d 0a64 6566 2068 6172 6d6f 6e69  her..def harmoni
+00002df0: 7a61 7469 6f6e 4368 6173 7461 696e 2869  zationChastain(i
+00002e00: 6d67 2c20 6672 6f6d 5365 6e73 6f72 2c20  mg, fromSensor, 
+00002e10: 746f 5365 6e73 6f72 293a 0d0a 2020 6172  toSensor):..  ar
+00002e20: 6773 203d 2066 6f72 6d61 7441 7267 7328  gs = formatArgs(
+00002e30: 6c6f 6361 6c73 2829 290d 0a0d 0a20 2023  locals())....  #
+00002e40: 4765 7420 7468 6520 6d6f 6465 6c20 666f  Get the model fo
+00002e50: 7220 7468 6520 6769 7665 6e20 6672 6f6d  r the given from
+00002e60: 2061 6e64 2074 6f20 7365 6e73 6f72 0d0a   and to sensor..
+00002e70: 2020 636f 6d62 6f4b 6579 203d 2066 726f    comboKey = fro
+00002e80: 6d53 656e 736f 722e 7570 7065 7228 292b  mSensor.upper()+
+00002e90: 275f 272b 746f 5365 6e73 6f72 2e75 7070  '_'+toSensor.upp
+00002ea0: 6572 2829 0d0a 2020 636f 6566 664c 6973  er()..  coeffLis
+00002eb0: 7420 3d20 6368 6173 7461 696e 436f 6566  t = chastainCoef
+00002ec0: 6644 6963 745b 636f 6d62 6f4b 6579 5d0d  fDict[comboKey].
+00002ed0: 0a20 2073 6c6f 7065 7320 3d20 636f 6566  .  slopes = coef
+00002ee0: 664c 6973 745b 305d 0d0a 2020 696e 7465  fList[0]..  inte
+00002ef0: 7263 6570 7473 203d 2063 6f65 6666 4c69  rcepts = coeffLi
+00002f00: 7374 5b31 5d0d 0a20 2064 6972 6563 7469  st[1]..  directi
+00002f10: 6f6e 203d 2065 652e 4e75 6d62 6572 2863  on = ee.Number(c
+00002f20: 6f65 6666 4c69 7374 5b32 5d29 0d0a 0d0a  oeffList[2])....
+00002f30: 2020 2341 7070 6c79 2074 6865 206d 6f64    #Apply the mod
+00002f40: 656c 2069 6e20 7468 6520 7265 7370 6563  el in the respec
+00002f50: 7469 7665 2064 6972 6563 7469 6f6e 0d0a  tive direction..
+00002f60: 2020 6f75 7420 3d20 6565 2e41 6c67 6f72    out = ee.Algor
+00002f70: 6974 686d 732e 4966 2864 6972 6563 7469  ithms.If(directi
+00002f80: 6f6e 2e65 7128 3029 2c20 6469 7230 5265  on.eq(0), dir0Re
+00002f90: 6772 6573 7369 6f6e 2869 6d67 2c73 6c6f  gression(img,slo
+00002fa0: 7065 732c 696e 7465 7263 6570 7473 292c  pes,intercepts),
+00002fb0: 2064 6972 3152 6567 7265 7373 696f 6e28   dir1Regression(
+00002fc0: 696d 672c 736c 6f70 6573 2c69 6e74 6572  img,slopes,inter
+00002fd0: 6365 7074 7329 290d 0a20 206f 7574 203d  cepts))..  out =
+00002fe0: 2065 652e 496d 6167 6528 6f75 7429 2e63   ee.Image(out).c
+00002ff0: 6f70 7950 726f 7065 7274 6965 7328 696d  opyProperties(im
+00003000: 6729 2e63 6f70 7950 726f 7065 7274 6965  g).copyPropertie
+00003010: 7328 696d 672c 5b27 7379 7374 656d 3a74  s(img,['system:t
+00003020: 696d 655f 7374 6172 7427 5d29 0d0a 2020  ime_start'])..  
+00003030: 6f75 7420 3d20 6f75 742e 7365 7428 7b27  out = out.set({'
+00003040: 6672 6f6d 5365 6e73 6f72 273a 2066 726f  fromSensor': fro
+00003050: 6d53 656e 736f 722c 2027 746f 5365 6e73  mSensor, 'toSens
+00003060: 6f72 273a 2074 6f53 656e 736f 727d 292e  or': toSensor}).
+00003070: 7365 7428 6172 6773 290d 0a20 2072 6574  set(args)..  ret
+00003080: 7572 6e20 6565 2e49 6d61 6765 286f 7574  urn ee.Image(out
+00003090: 290d 0a0d 0a0d 0a23 2323 2323 2323 2323  )......#########
+000030a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000030b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000030c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000030d0: 2323 2323 2323 2323 2323 230d 0a23 4675  ###########..#Fu
+000030e0: 6e63 7469 6f6e 2074 6f20 6372 6561 7465  nction to create
+000030f0: 2061 206d 756c 7469 6261 6e64 2069 6d61   a multiband ima
+00003100: 6765 2066 726f 6d20 6120 636f 6c6c 6563  ge from a collec
+00003110: 7469 6f6e 0d0a 6465 6620 636f 6c6c 6563  tion..def collec
+00003120: 7469 6f6e 546f 496d 6167 6528 636f 6c6c  tionToImage(coll
+00003130: 6563 7469 6f6e 293a 0d0a 2020 6465 6620  ection):..  def 
+00003140: 6349 7465 7261 746f 7228 696d 672c 7072  cIterator(img,pr
+00003150: 6576 293a 0d0a 2020 2020 7265 7475 726e  ev):..    return
+00003160: 2065 652e 496d 6167 6528 7072 6576 292e   ee.Image(prev).
+00003170: 6164 6442 616e 6473 2869 6d67 290d 0a20  addBands(img).. 
+00003180: 2073 7461 636b 203d 2065 652e 496d 6167   stack = ee.Imag
+00003190: 6528 636f 6c6c 6563 7469 6f6e 2e69 7465  e(collection.ite
+000031a0: 7261 7465 2863 4974 6572 6174 6f72 2c20  rate(cIterator, 
+000031b0: 6565 2e49 6d61 6765 2831 2929 290d 0a20  ee.Image(1))).. 
+000031c0: 2073 7461 636b 203d 2073 7461 636b 2e73   stack = stack.s
+000031d0: 656c 6563 7428 6565 2e4c 6973 742e 7365  elect(ee.List.se
+000031e0: 7175 656e 6365 2831 2c20 7374 6163 6b2e  quence(1, stack.
+000031f0: 6261 6e64 4e61 6d65 7328 292e 7369 7a65  bandNames().size
+00003200: 2829 2e73 7562 7472 6163 7428 3129 2929  ().subtract(1)))
+00003210: 0d0a 2020 7265 7475 726e 2073 7461 636b  ..  return stack
+00003220: 0d0a 0d0a 2323 2323 2323 2323 2323 2323  ....############
+00003230: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00003240: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00003250: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00003260: 2323 2323 2323 2323 0d0a 2323 2323 2323  ########..######
+00003270: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00003280: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00003290: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000032a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000032b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000032c0: 2323 2323 2323 2323 2323 230d 0a23 2323  ###########..###
-000032d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000032e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000032f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00003300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00003310: 230d 0a23 4675 6e63 7469 6f6e 2074 6f20  #..#Function to 
-00003320: 6669 6e64 2074 6865 2064 6174 6520 666f  find the date fo
-00003330: 7220 6120 6769 7665 6e20 636f 6d70 6f73  r a given compos
-00003340: 6974 6520 636f 6d70 7574 6564 2066 726f  ite computed fro
-00003350: 6d20 6120 6769 7665 6e20 7365 7420 6f66  m a given set of
-00003360: 2069 6d61 6765 730d 0a23 5769 6c6c 2077   images..#Will w
-00003370: 6f72 6b20 6f6e 2063 6f6d 706f 7369 7465  ork on composite
-00003380: 7320 636f 6d70 7574 6564 2077 6974 6820  s computed with 
-00003390: 6d65 7468 6f64 7320 7468 6174 2069 6e63  methods that inc
-000033a0: 6c75 6465 2064 6966 6665 7265 6e74 2064  lude different d
-000033b0: 6174 6573 2061 6372 6f73 7320 6469 6666  ates across diff
-000033c0: 6572 656e 7420 6261 6e64 730d 0a23 7375  erent bands..#su
-000033d0: 6368 2061 7320 7468 6520 6d65 6469 616e  ch as the median
-000033e0: 2e20 2046 6f72 2073 6f6d 6574 6869 6e67  .  For something
-000033f0: 206c 696b 6520 6120 6d65 646f 6964 2c20   like a medoid, 
-00003400: 6f6e 6c79 2061 2073 696e 676c 6520 6261  only a single ba
-00003410: 6e64 7320 6e65 6564 7320 7061 7373 6564  nds needs passed
-00003420: 2074 6872 6f75 6768 0d0a 2341 206b 6e6f   through..#A kno
-00003430: 776e 2062 7567 2069 7320 7468 6174 2069  wn bug is that i
-00003440: 6620 7468 6520 7361 6d65 2076 616c 7565  f the same value
-00003450: 206f 6363 7572 7320 7477 6963 652c 2069   occurs twice, i
-00003460: 7420 7769 6c6c 2063 686f 6f73 6520 6f6e  t will choose on
-00003470: 6c79 2061 2073 696e 676c 6520 6461 7465  ly a single date
-00003480: 0d0a 6465 6620 636f 6d70 6f73 6974 6544  ..def compositeD
-00003490: 6174 6573 2869 6d61 6765 732c 2063 6f6d  ates(images, com
-000034a0: 706f 7369 7465 2c20 6261 6e64 4e61 6d65  posite, bandName
-000034b0: 7320 3d20 4e6f 6e65 293a 0d0a 2020 6966  s = None):..  if
-000034c0: 2062 616e 644e 616d 6573 203d 3d20 4e6f   bandNames == No
-000034d0: 6e65 3a0d 0a20 2020 2062 616e 644e 616d  ne:..    bandNam
-000034e0: 6573 203d 2065 652e 496d 6167 6528 696d  es = ee.Image(im
-000034f0: 6167 6573 2e66 6972 7374 2829 292e 6261  ages.first()).ba
-00003500: 6e64 4e61 6d65 7328 290d 0a20 2065 6c73  ndNames()..  els
-00003510: 653a 0d0a 2020 2020 696d 6167 6573 203d  e:..    images =
-00003520: 2069 6d61 6765 732e 7365 6c65 6374 2862   images.select(b
-00003530: 616e 644e 616d 6573 290d 0a20 2020 2063  andNames)..    c
-00003540: 6f6d 706f 7369 7465 203d 2063 6f6d 706f  omposite = compo
-00003550: 7369 7465 2e73 656c 6563 7428 6261 6e64  site.select(band
-00003560: 4e61 6d65 7329 0d0a 0d0a 2020 6465 6620  Names)....  def 
-00003570: 626e 4361 7428 626e 293a 0d0a 2020 2020  bnCat(bn):..    
-00003580: 7265 7475 726e 2065 652e 5374 7269 6e67  return ee.String
-00003590: 2862 6e29 2e63 6174 2827 5f64 6966 6627  (bn).cat('_diff'
-000035a0: 290d 0a0d 0a20 2062 6e73 203d 2065 652e  )....  bns = ee.
-000035b0: 496d 6167 6528 696d 6167 6573 2e66 6972  Image(images.fir
-000035c0: 7374 2829 292e 6261 6e64 4e61 6d65 7328  st()).bandNames(
-000035d0: 292e 6d61 7028 626e 4361 7429 0d0a 0d0a  ).map(bnCat)....
-000035e0: 2020 2346 756e 6374 696f 6e20 746f 2067    #Function to g
-000035f0: 6574 2074 6865 2061 6273 2064 6966 6620  et the abs diff 
-00003600: 6672 6f6d 2061 2067 6976 656e 2063 6f6d  from a given com
-00003610: 706f 7369 7465 202a 2d31 0d0a 2020 6465  posite *-1..  de
-00003620: 6620 6765 7444 6966 6628 696d 6729 3a0d  f getDiff(img):.
-00003630: 0a20 2020 206f 7574 203d 2069 6d67 2e73  .    out = img.s
-00003640: 7562 7472 6163 7428 636f 6d70 6f73 6974  ubtract(composit
-00003650: 6529 2e61 6273 2829 2e6d 756c 7469 706c  e).abs().multipl
-00003660: 7928 2d31 292e 7265 6e61 6d65 2862 6e73  y(-1).rename(bns
-00003670: 290d 0a20 2020 2072 6574 7572 6e20 696d  )..    return im
-00003680: 672e 6164 6442 616e 6473 286f 7574 293b  g.addBands(out);
-00003690: 0d0a 0d0a 0d0a 2020 2346 696e 6420 7468  ......  #Find th
-000036a0: 6520 6469 6666 2061 6e64 2061 6464 2061  e diff and add a
-000036b0: 2064 6174 6520 6261 6e64 0d0a 2020 696d   date band..  im
-000036c0: 6167 6573 203d 2069 6d61 6765 732e 6d61  ages = images.ma
-000036d0: 7028 6765 7444 6966 6629 0d0a 2020 696d  p(getDiff)..  im
-000036e0: 6167 6573 203d 2069 6d61 6765 732e 6d61  ages = images.ma
-000036f0: 7028 6164 6444 6174 6542 616e 6429 0d0a  p(addDateBand)..
-00003700: 0d0a 2020 2349 7465 7261 7465 2061 6372  ..  #Iterate acr
-00003710: 6f73 7320 6561 6368 2062 616e 6420 616e  oss each band an
-00003720: 6420 6669 6e64 2074 6865 2063 6f72 7265  d find the corre
-00003730: 7370 6f6e 6469 6e67 2064 6174 6520 746f  sponding date to
-00003740: 2074 6865 2063 6f6d 706f 7369 7465 0d0a   the composite..
-00003750: 2020 6465 6620 626e 4361 7432 2862 6e29    def bnCat2(bn)
-00003760: 3a0d 0a20 2020 2062 6e20 3d20 6565 2e53  :..    bn = ee.S
-00003770: 7472 696e 6728 626e 290d 0a20 2020 2074  tring(bn)..    t
-00003780: 203d 2069 6d61 6765 732e 7365 6c65 6374   = images.select
-00003790: 285b 626e 2c62 6e2e 6361 7428 275f 6469  ([bn,bn.cat('_di
-000037a0: 6666 2729 2c27 7965 6172 275d 292e 7175  ff'),'year']).qu
-000037b0: 616c 6974 794d 6f73 6169 6328 626e 2e63  alityMosaic(bn.c
-000037c0: 6174 2827 5f64 6966 6627 2929 0d0a 2020  at('_diff'))..  
-000037d0: 2020 7265 7475 726e 2074 2e73 656c 6563    return t.selec
-000037e0: 7428 5b27 7965 6172 275d 292e 7265 6e61  t(['year']).rena
-000037f0: 6d65 285b 2759 5959 5944 4427 5d29 0d0a  me(['YYYYDD'])..
-00003800: 2020 6f75 7420 3d20 6261 6e64 4e61 6d65    out = bandName
-00003810: 732e 6d61 7028 626e 4361 7432 290d 0a0d  s.map(bnCat2)...
-00003820: 0a20 2023 436f 6e76 6572 7420 746f 2061  .  #Convert to a
-00003830: 6e20 696d 6167 6520 616e 6420 7265 6e61  n image and rena
-00003840: 6d65 0d0a 2020 6f75 7420 3d20 636f 6c6c  me..  out = coll
-00003850: 6563 7469 6f6e 546f 496d 6167 6528 6565  ectionToImage(ee
-00003860: 2e49 6d61 6765 436f 6c6c 6563 7469 6f6e  .ImageCollection
-00003870: 286f 7574 2929 0d0a 2020 2376 6172 206f  (out))..  #var o
-00003880: 7574 426e 7320 3d20 6261 6e64 4e61 6d65  utBns = bandName
-00003890: 732e 6d61 7028 6675 6e63 7469 6f6e 2862  s.map(function(b
-000038a0: 6e29 7b72 6574 7572 6e20 6565 2e53 7472  n){return ee.Str
-000038b0: 696e 6728 626e 292e 6361 7428 2759 5959  ing(bn).cat('YYY
-000038c0: 5944 4427 297d 293b 0d0a 2020 236f 7574  YDD')});..  #out
-000038d0: 203d 206f 7574 2e72 656e 616d 6528 6f75   = out.rename(ou
-000038e0: 7442 6e73 293b 0d0a 0d0a 2020 7265 7475  tBns);....  retu
-000038f0: 726e 206f 7574 0d0a 0d0a 2323 2323 2323  rn out....######
-00003900: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00003910: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00003920: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00003930: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00003940: 2323 2323 2323 0d0a 2346 756e 6374 696f  ######..#Functio
-00003950: 6e20 746f 2068 616e 646c 6520 656d 7074  n to handle empt
-00003960: 7920 636f 6c6c 6563 7469 6f6e 7320 7468  y collections th
-00003970: 6174 2077 696c 6c20 6361 7573 6520 7375  at will cause su
-00003980: 6273 6571 7565 6e74 2070 726f 6365 7373  bsequent process
-00003990: 6573 2074 6f20 6661 696c 0d0a 2349 6620  es to fail..#If 
-000039a0: 7468 6520 636f 6c6c 6563 7469 6f6e 2069  the collection i
-000039b0: 7320 656d 7074 792c 2077 696c 6c20 6669  s empty, will fi
-000039c0: 6c6c 2069 7420 7769 7468 2061 6e20 656d  ll it with an em
-000039d0: 7074 7920 696d 6167 650d 0a64 6566 2066  pty image..def f
-000039e0: 696c 6c45 6d70 7479 436f 6c6c 6563 7469  illEmptyCollecti
-000039f0: 6f6e 7328 696e 436f 6c6c 6563 7469 6f6e  ons(inCollection
-00003a00: 2c64 756d 6d79 496d 6167 6529 3a0d 0a20  ,dummyImage):.. 
-00003a10: 2064 756d 6d79 436f 6c6c 6563 7469 6f6e   dummyCollection
-00003a20: 203d 2065 652e 496d 6167 6543 6f6c 6c65   = ee.ImageColle
-00003a30: 6374 696f 6e28 5b64 756d 6d79 496d 6167  ction([dummyImag
-00003a40: 652e 6d61 736b 2865 652e 496d 6167 6528  e.mask(ee.Image(
-00003a50: 3029 295d 290d 0a20 2069 6d61 6765 436f  0))])..  imageCo
-00003a60: 756e 7420 3d20 696e 436f 6c6c 6563 7469  unt = inCollecti
-00003a70: 6f6e 2e74 6f4c 6973 7428 3129 2e6c 656e  on.toList(1).len
-00003a80: 6774 6828 290d 0a20 2072 6574 7572 6e20  gth()..  return 
-00003a90: 6565 2e49 6d61 6765 436f 6c6c 6563 7469  ee.ImageCollecti
-00003aa0: 6f6e 2865 652e 416c 676f 7269 7468 6d73  on(ee.Algorithms
-00003ab0: 2e49 6628 696d 6167 6543 6f75 6e74 2e67  .If(imageCount.g
-00003ac0: 7428 3029 2c69 6e43 6f6c 6c65 6374 696f  t(0),inCollectio
-00003ad0: 6e2c 6475 6d6d 7943 6f6c 6c65 6374 696f  n,dummyCollectio
-00003ae0: 6e29 290d 0a0d 0a23 2323 2323 2323 2323  n))....#########
-00003af0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00003b00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00003b10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00003b20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00003b30: 2323 230d 0a23 2041 6464 2062 616e 6420  ###..# Add band 
-00003b40: 7472 6163 6b69 6e67 2077 6869 6368 2073  tracking which s
-00003b50: 6174 656c 6c69 7465 2074 6865 2070 6978  atellite the pix
-00003b60: 656c 2063 616d 6520 6672 6f6d 0d0a 6465  el came from..de
-00003b70: 6620 6164 6453 656e 736f 7242 616e 6428  f addSensorBand(
-00003b80: 696d 672c 2077 6869 6368 5072 6f67 7261  img, whichProgra
-00003b90: 6d2c 2074 6f61 4f72 5352 293a 0d0a 2020  m, toaOrSR):..  
-00003ba0: 7365 6e73 6f72 4469 6374 203d 2065 652e  sensorDict = ee.
-00003bb0: 4469 6374 696f 6e61 7279 287b 274c 414e  Dictionary({'LAN
-00003bc0: 4453 4154 5f34 273a 2034 2c0d 0a20 2020  DSAT_4': 4,..   
-00003bd0: 2020 2020 2020 2020 2020 2027 4c41 4e44             'LAND
-00003be0: 5341 545f 3527 3a20 352c 0d0a 2020 2020  SAT_5': 5,..    
-00003bf0: 2020 2020 2020 2020 2020 274c 414e 4453            'LANDS
-00003c00: 4154 5f37 273a 2037 2c0d 0a20 2020 2020  AT_7': 7,..     
-00003c10: 2020 2020 2020 2020 2027 4c41 4e44 5341           'LANDSA
-00003c20: 545f 3827 3a20 382c 0d0a 2020 2020 2020  T_8': 8,..      
-00003c30: 2020 2020 2020 2020 274c 414e 4453 4154          'LANDSAT
-00003c40: 5f39 273a 2039 2c0d 0a20 2020 2020 2020  _9': 9,..       
-00003c50: 2020 2020 2020 2027 5365 6e74 696e 656c         'Sentinel
-00003c60: 2d32 4127 3a20 3231 2c0d 0a20 2020 2020  -2A': 21,..     
-00003c70: 2020 2020 2020 2020 2027 5365 6e74 696e           'Sentin
-00003c80: 656c 2d32 4227 3a20 3232 2c0d 0a20 2020  el-2B': 22,..   
-00003c90: 2020 2020 2020 2020 2020 2027 5365 6e74             'Sent
-00003ca0: 696e 656c 2d32 4327 3a20 3233 2c0d 0a20  inel-2C': 23,.. 
-00003cb0: 2020 2020 2020 2020 2020 2020 207d 290d               }).
-00003cc0: 0a20 2073 656e 736f 7250 726f 7044 6963  .  sensorPropDic
-00003cd0: 7420 3d20 6565 2e44 6963 7469 6f6e 6172  t = ee.Dictionar
-00003ce0: 7928 7b27 4331 5f6c 616e 6473 6174 273a  y({'C1_landsat':
-00003cf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00003d00: 2020 2020 2020 2020 2020 7b27 544f 4127            {'TOA'
-00003d10: 3a27 5350 4143 4543 5241 4654 5f49 4427  :'SPACECRAFT_ID'
-00003d20: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00003d30: 2020 2020 2020 2020 2020 2020 2027 5352               'SR
-00003d40: 273a 2753 4154 454c 4c49 5445 275c 0d0a  ':'SATELLITE'\..
-00003d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003d60: 2020 2020 2020 2020 7d2c 0d0a 2020 2020          },..    
-00003d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003d80: 2743 325f 6c61 6e64 7361 7427 3a0d 0a20  'C2_landsat':.. 
+000032a0: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
+000032b0: 2346 756e 6374 696f 6e20 746f 2066 696e  #Function to fin
+000032c0: 6420 7468 6520 6461 7465 2066 6f72 2061  d the date for a
+000032d0: 2067 6976 656e 2063 6f6d 706f 7369 7465   given composite
+000032e0: 2063 6f6d 7075 7465 6420 6672 6f6d 2061   computed from a
+000032f0: 2067 6976 656e 2073 6574 206f 6620 696d   given set of im
+00003300: 6167 6573 0d0a 2357 696c 6c20 776f 726b  ages..#Will work
+00003310: 206f 6e20 636f 6d70 6f73 6974 6573 2063   on composites c
+00003320: 6f6d 7075 7465 6420 7769 7468 206d 6574  omputed with met
+00003330: 686f 6473 2074 6861 7420 696e 636c 7564  hods that includ
+00003340: 6520 6469 6666 6572 656e 7420 6461 7465  e different date
+00003350: 7320 6163 726f 7373 2064 6966 6665 7265  s across differe
+00003360: 6e74 2062 616e 6473 0d0a 2373 7563 6820  nt bands..#such 
+00003370: 6173 2074 6865 206d 6564 6961 6e2e 2020  as the median.  
+00003380: 466f 7220 736f 6d65 7468 696e 6720 6c69  For something li
+00003390: 6b65 2061 206d 6564 6f69 642c 206f 6e6c  ke a medoid, onl
+000033a0: 7920 6120 7369 6e67 6c65 2062 616e 6473  y a single bands
+000033b0: 206e 6565 6473 2070 6173 7365 6420 7468   needs passed th
+000033c0: 726f 7567 680d 0a23 4120 6b6e 6f77 6e20  rough..#A known 
+000033d0: 6275 6720 6973 2074 6861 7420 6966 2074  bug is that if t
+000033e0: 6865 2073 616d 6520 7661 6c75 6520 6f63  he same value oc
+000033f0: 6375 7273 2074 7769 6365 2c20 6974 2077  curs twice, it w
+00003400: 696c 6c20 6368 6f6f 7365 206f 6e6c 7920  ill choose only 
+00003410: 6120 7369 6e67 6c65 2064 6174 650d 0a64  a single date..d
+00003420: 6566 2063 6f6d 706f 7369 7465 4461 7465  ef compositeDate
+00003430: 7328 696d 6167 6573 2c20 636f 6d70 6f73  s(images, compos
+00003440: 6974 652c 2062 616e 644e 616d 6573 203d  ite, bandNames =
+00003450: 204e 6f6e 6529 3a0d 0a20 2069 6620 6261   None):..  if ba
+00003460: 6e64 4e61 6d65 7320 3d3d 204e 6f6e 653a  ndNames == None:
+00003470: 0d0a 2020 2020 6261 6e64 4e61 6d65 7320  ..    bandNames 
+00003480: 3d20 6565 2e49 6d61 6765 2869 6d61 6765  = ee.Image(image
+00003490: 732e 6669 7273 7428 2929 2e62 616e 644e  s.first()).bandN
+000034a0: 616d 6573 2829 0d0a 2020 656c 7365 3a0d  ames()..  else:.
+000034b0: 0a20 2020 2069 6d61 6765 7320 3d20 696d  .    images = im
+000034c0: 6167 6573 2e73 656c 6563 7428 6261 6e64  ages.select(band
+000034d0: 4e61 6d65 7329 0d0a 2020 2020 636f 6d70  Names)..    comp
+000034e0: 6f73 6974 6520 3d20 636f 6d70 6f73 6974  osite = composit
+000034f0: 652e 7365 6c65 6374 2862 616e 644e 616d  e.select(bandNam
+00003500: 6573 290d 0a0d 0a20 2064 6566 2062 6e43  es)....  def bnC
+00003510: 6174 2862 6e29 3a0d 0a20 2020 2072 6574  at(bn):..    ret
+00003520: 7572 6e20 6565 2e53 7472 696e 6728 626e  urn ee.String(bn
+00003530: 292e 6361 7428 275f 6469 6666 2729 0d0a  ).cat('_diff')..
+00003540: 0d0a 2020 626e 7320 3d20 6565 2e49 6d61  ..  bns = ee.Ima
+00003550: 6765 2869 6d61 6765 732e 6669 7273 7428  ge(images.first(
+00003560: 2929 2e62 616e 644e 616d 6573 2829 2e6d  )).bandNames().m
+00003570: 6170 2862 6e43 6174 290d 0a0d 0a20 2023  ap(bnCat)....  #
+00003580: 4675 6e63 7469 6f6e 2074 6f20 6765 7420  Function to get 
+00003590: 7468 6520 6162 7320 6469 6666 2066 726f  the abs diff fro
+000035a0: 6d20 6120 6769 7665 6e20 636f 6d70 6f73  m a given compos
+000035b0: 6974 6520 2a2d 310d 0a20 2064 6566 2067  ite *-1..  def g
+000035c0: 6574 4469 6666 2869 6d67 293a 0d0a 2020  etDiff(img):..  
+000035d0: 2020 6f75 7420 3d20 696d 672e 7375 6274    out = img.subt
+000035e0: 7261 6374 2863 6f6d 706f 7369 7465 292e  ract(composite).
+000035f0: 6162 7328 292e 6d75 6c74 6970 6c79 282d  abs().multiply(-
+00003600: 3129 2e72 656e 616d 6528 626e 7329 0d0a  1).rename(bns)..
+00003610: 2020 2020 7265 7475 726e 2069 6d67 2e61      return img.a
+00003620: 6464 4261 6e64 7328 6f75 7429 3b0d 0a0d  ddBands(out);...
+00003630: 0a0d 0a20 2023 4669 6e64 2074 6865 2064  ...  #Find the d
+00003640: 6966 6620 616e 6420 6164 6420 6120 6461  iff and add a da
+00003650: 7465 2062 616e 640d 0a20 2069 6d61 6765  te band..  image
+00003660: 7320 3d20 696d 6167 6573 2e6d 6170 2867  s = images.map(g
+00003670: 6574 4469 6666 290d 0a20 2069 6d61 6765  etDiff)..  image
+00003680: 7320 3d20 696d 6167 6573 2e6d 6170 2861  s = images.map(a
+00003690: 6464 4461 7465 4261 6e64 290d 0a0d 0a20  ddDateBand).... 
+000036a0: 2023 4974 6572 6174 6520 6163 726f 7373   #Iterate across
+000036b0: 2065 6163 6820 6261 6e64 2061 6e64 2066   each band and f
+000036c0: 696e 6420 7468 6520 636f 7272 6573 706f  ind the correspo
+000036d0: 6e64 696e 6720 6461 7465 2074 6f20 7468  nding date to th
+000036e0: 6520 636f 6d70 6f73 6974 650d 0a20 2064  e composite..  d
+000036f0: 6566 2062 6e43 6174 3228 626e 293a 0d0a  ef bnCat2(bn):..
+00003700: 2020 2020 626e 203d 2065 652e 5374 7269      bn = ee.Stri
+00003710: 6e67 2862 6e29 0d0a 2020 2020 7420 3d20  ng(bn)..    t = 
+00003720: 696d 6167 6573 2e73 656c 6563 7428 5b62  images.select([b
+00003730: 6e2c 626e 2e63 6174 2827 5f64 6966 6627  n,bn.cat('_diff'
+00003740: 292c 2779 6561 7227 5d29 2e71 7561 6c69  ),'year']).quali
+00003750: 7479 4d6f 7361 6963 2862 6e2e 6361 7428  tyMosaic(bn.cat(
+00003760: 275f 6469 6666 2729 290d 0a20 2020 2072  '_diff'))..    r
+00003770: 6574 7572 6e20 742e 7365 6c65 6374 285b  eturn t.select([
+00003780: 2779 6561 7227 5d29 2e72 656e 616d 6528  'year']).rename(
+00003790: 5b27 5959 5959 4444 275d 290d 0a20 206f  ['YYYYDD'])..  o
+000037a0: 7574 203d 2062 616e 644e 616d 6573 2e6d  ut = bandNames.m
+000037b0: 6170 2862 6e43 6174 3229 0d0a 0d0a 2020  ap(bnCat2)....  
+000037c0: 2343 6f6e 7665 7274 2074 6f20 616e 2069  #Convert to an i
+000037d0: 6d61 6765 2061 6e64 2072 656e 616d 650d  mage and rename.
+000037e0: 0a20 206f 7574 203d 2063 6f6c 6c65 6374  .  out = collect
+000037f0: 696f 6e54 6f49 6d61 6765 2865 652e 496d  ionToImage(ee.Im
+00003800: 6167 6543 6f6c 6c65 6374 696f 6e28 6f75  ageCollection(ou
+00003810: 7429 290d 0a20 2023 7661 7220 6f75 7442  t))..  #var outB
+00003820: 6e73 203d 2062 616e 644e 616d 6573 2e6d  ns = bandNames.m
+00003830: 6170 2866 756e 6374 696f 6e28 626e 297b  ap(function(bn){
+00003840: 7265 7475 726e 2065 652e 5374 7269 6e67  return ee.String
+00003850: 2862 6e29 2e63 6174 2827 5959 5959 4444  (bn).cat('YYYYDD
+00003860: 2729 7d29 3b0d 0a20 2023 6f75 7420 3d20  ')});..  #out = 
+00003870: 6f75 742e 7265 6e61 6d65 286f 7574 426e  out.rename(outBn
+00003880: 7329 3b0d 0a0d 0a20 2072 6574 7572 6e20  s);....  return 
+00003890: 6f75 740d 0a0d 0a23 2323 2323 2323 2323  out....#########
+000038a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000038b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000038c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000038d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000038e0: 2323 230d 0a23 4675 6e63 7469 6f6e 2074  ###..#Function t
+000038f0: 6f20 6861 6e64 6c65 2065 6d70 7479 2063  o handle empty c
+00003900: 6f6c 6c65 6374 696f 6e73 2074 6861 7420  ollections that 
+00003910: 7769 6c6c 2063 6175 7365 2073 7562 7365  will cause subse
+00003920: 7175 656e 7420 7072 6f63 6573 7365 7320  quent processes 
+00003930: 746f 2066 6169 6c0d 0a23 4966 2074 6865  to fail..#If the
+00003940: 2063 6f6c 6c65 6374 696f 6e20 6973 2065   collection is e
+00003950: 6d70 7479 2c20 7769 6c6c 2066 696c 6c20  mpty, will fill 
+00003960: 6974 2077 6974 6820 616e 2065 6d70 7479  it with an empty
+00003970: 2069 6d61 6765 0d0a 6465 6620 6669 6c6c   image..def fill
+00003980: 456d 7074 7943 6f6c 6c65 6374 696f 6e73  EmptyCollections
+00003990: 2869 6e43 6f6c 6c65 6374 696f 6e2c 6475  (inCollection,du
+000039a0: 6d6d 7949 6d61 6765 293a 0d0a 2020 6475  mmyImage):..  du
+000039b0: 6d6d 7943 6f6c 6c65 6374 696f 6e20 3d20  mmyCollection = 
+000039c0: 6565 2e49 6d61 6765 436f 6c6c 6563 7469  ee.ImageCollecti
+000039d0: 6f6e 285b 6475 6d6d 7949 6d61 6765 2e6d  on([dummyImage.m
+000039e0: 6173 6b28 6565 2e49 6d61 6765 2830 2929  ask(ee.Image(0))
+000039f0: 5d29 0d0a 2020 696d 6167 6543 6f75 6e74  ])..  imageCount
+00003a00: 203d 2069 6e43 6f6c 6c65 6374 696f 6e2e   = inCollection.
+00003a10: 746f 4c69 7374 2831 292e 6c65 6e67 7468  toList(1).length
+00003a20: 2829 0d0a 2020 7265 7475 726e 2065 652e  ()..  return ee.
+00003a30: 496d 6167 6543 6f6c 6c65 6374 696f 6e28  ImageCollection(
+00003a40: 6565 2e41 6c67 6f72 6974 686d 732e 4966  ee.Algorithms.If
+00003a50: 2869 6d61 6765 436f 756e 742e 6774 2830  (imageCount.gt(0
+00003a60: 292c 696e 436f 6c6c 6563 7469 6f6e 2c64  ),inCollection,d
+00003a70: 756d 6d79 436f 6c6c 6563 7469 6f6e 2929  ummyCollection))
+00003a80: 0d0a 0d0a 2323 2323 2323 2323 2323 2323  ....############
+00003a90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00003aa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00003ab0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00003ac0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00003ad0: 0d0a 2320 4164 6420 6261 6e64 2074 7261  ..# Add band tra
+00003ae0: 636b 696e 6720 7768 6963 6820 7361 7465  cking which sate
+00003af0: 6c6c 6974 6520 7468 6520 7069 7865 6c20  llite the pixel 
+00003b00: 6361 6d65 2066 726f 6d0d 0a64 6566 2061  came from..def a
+00003b10: 6464 5365 6e73 6f72 4261 6e64 2869 6d67  ddSensorBand(img
+00003b20: 2c20 7768 6963 6850 726f 6772 616d 2c20  , whichProgram, 
+00003b30: 746f 614f 7253 5229 3a0d 0a20 2073 656e  toaOrSR):..  sen
+00003b40: 736f 7244 6963 7420 3d20 6565 2e44 6963  sorDict = ee.Dic
+00003b50: 7469 6f6e 6172 7928 7b27 4c41 4e44 5341  tionary({'LANDSA
+00003b60: 545f 3427 3a20 342c 0d0a 2020 2020 2020  T_4': 4,..      
+00003b70: 2020 2020 2020 2020 274c 414e 4453 4154          'LANDSAT
+00003b80: 5f35 273a 2035 2c0d 0a20 2020 2020 2020  _5': 5,..       
+00003b90: 2020 2020 2020 2027 4c41 4e44 5341 545f         'LANDSAT_
+00003ba0: 3727 3a20 372c 0d0a 2020 2020 2020 2020  7': 7,..        
+00003bb0: 2020 2020 2020 274c 414e 4453 4154 5f38        'LANDSAT_8
+00003bc0: 273a 2038 2c0d 0a20 2020 2020 2020 2020  ': 8,..         
+00003bd0: 2020 2020 2027 4c41 4e44 5341 545f 3927       'LANDSAT_9'
+00003be0: 3a20 392c 0d0a 2020 2020 2020 2020 2020  : 9,..          
+00003bf0: 2020 2020 2753 656e 7469 6e65 6c2d 3241      'Sentinel-2A
+00003c00: 273a 2032 312c 0d0a 2020 2020 2020 2020  ': 21,..        
+00003c10: 2020 2020 2020 2753 656e 7469 6e65 6c2d        'Sentinel-
+00003c20: 3242 273a 2032 322c 0d0a 2020 2020 2020  2B': 22,..      
+00003c30: 2020 2020 2020 2020 2753 656e 7469 6e65          'Sentine
+00003c40: 6c2d 3243 273a 2032 332c 0d0a 2020 2020  l-2C': 23,..    
+00003c50: 2020 2020 2020 2020 2020 7d29 0d0a 2020            })..  
+00003c60: 7365 6e73 6f72 5072 6f70 4469 6374 203d  sensorPropDict =
+00003c70: 2065 652e 4469 6374 696f 6e61 7279 287b   ee.Dictionary({
+00003c80: 2743 315f 6c61 6e64 7361 7427 3a0d 0a20  'C1_landsat':.. 
+00003c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003ca0: 2020 2020 2020 207b 2754 4f41 273a 2753         {'TOA':'S
+00003cb0: 5041 4345 4352 4146 545f 4944 272c 0d0a  PACECRAFT_ID',..
+00003cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003cd0: 2020 2020 2020 2020 2020 2753 5227 3a27            'SR':'
+00003ce0: 5341 5445 4c4c 4954 4527 5c0d 0a20 2020  SATELLITE'\..   
+00003cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d00: 2020 2020 207d 2c0d 0a20 2020 2020 2020       },..       
+00003d10: 2020 2020 2020 2020 2020 2020 2027 4332               'C2
+00003d20: 5f6c 616e 6473 6174 273a 0d0a 2020 2020  _landsat':..    
+00003d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d40: 2020 2020 7b27 544f 4127 3a27 5350 4143      {'TOA':'SPAC
+00003d50: 4543 5241 4654 5f49 4427 2c0d 0a20 2020  ECRAFT_ID',..   
+00003d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d70: 2020 2020 2020 2027 5352 273a 2753 5041         'SR':'SPA
+00003d80: 4345 4352 4146 545f 4944 275c 0d0a 2020  CECRAFT_ID'\..  
 00003d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003da0: 2020 2020 2020 207b 2754 4f41 273a 2753         {'TOA':'S
-00003db0: 5041 4345 4352 4146 545f 4944 272c 0d0a  PACECRAFT_ID',..
-00003dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003dd0: 2020 2020 2020 2020 2020 2753 5227 3a27            'SR':'
-00003de0: 5350 4143 4543 5241 4654 5f49 4427 5c0d  SPACECRAFT_ID'\.
-00003df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003e00: 2020 2020 2020 2020 207d 2c0d 0a20 2020           },..   
-00003e10: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00003e20: 7365 6e74 696e 656c 3227 3a0d 0a20 2020  sentinel2':..   
+00003da0: 2020 2020 2020 7d2c 0d0a 2020 2020 2020        },..      
+00003db0: 2020 2020 2020 2020 2020 2020 2773 656e              'sen
+00003dc0: 7469 6e65 6c32 273a 0d0a 2020 2020 2020  tinel2':..      
+00003dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003de0: 2020 7b27 544f 4127 3a27 5350 4143 4543    {'TOA':'SPACEC
+00003df0: 5241 4654 5f4e 414d 4527 2c0d 0a20 2020  RAFT_NAME',..   
+00003e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003e10: 2020 2020 2020 2753 5227 3a27 5350 4143        'SR':'SPAC
+00003e20: 4543 5241 4654 5f4e 414d 4527 5c0d 0a20  ECRAFT_NAME'\.. 
 00003e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003e40: 2020 2020 207b 2754 4f41 273a 2753 5041       {'TOA':'SPA
-00003e50: 4345 4352 4146 545f 4e41 4d45 272c 0d0a  CECRAFT_NAME',..
-00003e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003e70: 2020 2020 2020 2020 2027 5352 273a 2753           'SR':'S
-00003e80: 5041 4345 4352 4146 545f 4e41 4d45 275c  PACECRAFT_NAME'\
-00003e90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00003ea0: 2020 2020 2020 2020 2020 7d5c 0d0a 2020            }\..  
-00003eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003ec0: 7d29 0d0a 2020 746f 614f 7253 5220 3d20  })..  toaOrSR = 
-00003ed0: 746f 614f 7253 522e 7570 7065 7228 290d  toaOrSR.upper().
-00003ee0: 0a20 2073 656e 736f 7250 726f 7020 3d20  .  sensorProp = 
-00003ef0: 6565 2e44 6963 7469 6f6e 6172 7928 7365  ee.Dictionary(se
-00003f00: 6e73 6f72 5072 6f70 4469 6374 2e67 6574  nsorPropDict.get
-00003f10: 2877 6869 6368 5072 6f67 7261 6d29 292e  (whichProgram)).
-00003f20: 6765 7428 746f 614f 7253 5229 0d0a 2020  get(toaOrSR)..  
-00003f30: 7365 6e73 6f72 4e61 6d65 203d 2069 6d67  sensorName = img
-00003f40: 2e67 6574 2873 656e 736f 7250 726f 7029  .get(sensorProp)
-00003f50: 0d0a 2020 696d 6720 3d20 696d 672e 6164  ..  img = img.ad
-00003f60: 6442 616e 6473 2865 652e 496d 6167 652e  dBands(ee.Image.
-00003f70: 636f 6e73 7461 6e74 2873 656e 736f 7244  constant(sensorD
-00003f80: 6963 742e 6765 7428 7365 6e73 6f72 4e61  ict.get(sensorNa
-00003f90: 6d65 2929 2e72 656e 616d 6528 5b27 7365  me)).rename(['se
-00003fa0: 6e73 6f72 275d 292e 6279 7465 2829 292e  nsor']).byte()).
-00003fb0: 7365 7428 2773 656e 736f 7227 2c73 656e  set('sensor',sen
-00003fc0: 736f 724e 616d 6529 0d0a 2020 7265 7475  sorName)..  retu
-00003fd0: 726e 2069 6d67 0d0a 0d0a 0d0a 2323 2323  rn img......####
+00003e40: 2020 2020 2020 207d 5c0d 0a20 2020 2020         }\..     
+00003e50: 2020 2020 2020 2020 2020 2020 207d 290d               }).
+00003e60: 0a20 2074 6f61 4f72 5352 203d 2074 6f61  .  toaOrSR = toa
+00003e70: 4f72 5352 2e75 7070 6572 2829 0d0a 2020  OrSR.upper()..  
+00003e80: 7365 6e73 6f72 5072 6f70 203d 2065 652e  sensorProp = ee.
+00003e90: 4469 6374 696f 6e61 7279 2873 656e 736f  Dictionary(senso
+00003ea0: 7250 726f 7044 6963 742e 6765 7428 7768  rPropDict.get(wh
+00003eb0: 6963 6850 726f 6772 616d 2929 2e67 6574  ichProgram)).get
+00003ec0: 2874 6f61 4f72 5352 290d 0a20 2073 656e  (toaOrSR)..  sen
+00003ed0: 736f 724e 616d 6520 3d20 696d 672e 6765  sorName = img.ge
+00003ee0: 7428 7365 6e73 6f72 5072 6f70 290d 0a20  t(sensorProp).. 
+00003ef0: 2069 6d67 203d 2069 6d67 2e61 6464 4261   img = img.addBa
+00003f00: 6e64 7328 6565 2e49 6d61 6765 2e63 6f6e  nds(ee.Image.con
+00003f10: 7374 616e 7428 7365 6e73 6f72 4469 6374  stant(sensorDict
+00003f20: 2e67 6574 2873 656e 736f 724e 616d 6529  .get(sensorName)
+00003f30: 292e 7265 6e61 6d65 285b 2773 656e 736f  ).rename(['senso
+00003f40: 7227 5d29 2e62 7974 6528 2929 2e73 6574  r']).byte()).set
+00003f50: 2827 7365 6e73 6f72 272c 7365 6e73 6f72  ('sensor',sensor
+00003f60: 4e61 6d65 290d 0a20 2072 6574 7572 6e20  Name)..  return 
+00003f70: 696d 670d 0a0d 0a0d 0a23 2323 2323 2323  img......#######
+00003f80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00003f90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00003fa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00003fb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00003fc0: 2323 2323 230d 0a23 2323 2323 2323 2323  #####..#########
+00003fd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00003fe0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00003ff0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00004000: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00004010: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00004020: 2323 2323 2323 2323 0d0a 2323 2323 2323  ########..######
-00004030: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00004040: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00004050: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00004060: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00004070: 2323 2323 2323 0d0a 2341 6464 7320 7468  ######..#Adds th
-00004080: 6520 666c 6f61 7420 7965 6172 2077 6974  e float year wit
-00004090: 6820 6a75 6c69 616e 2070 726f 706f 7274  h julian proport
-000040a0: 696f 6e20 746f 2069 6d61 6765 0d0a 6465  ion to image..de
-000040b0: 6620 6164 6444 6174 6542 616e 6428 696d  f addDateBand(im
-000040c0: 672c 206d 6173 6b54 696d 6520 3d20 4661  g, maskTime = Fa
-000040d0: 6c73 6529 3a0d 0a20 2064 203d 2065 652e  lse):..  d = ee.
-000040e0: 4461 7465 2869 6d67 2e67 6574 2827 7379  Date(img.get('sy
-000040f0: 7374 656d 3a74 696d 655f 7374 6172 7427  stem:time_start'
-00004100: 2929 0d0a 2020 7920 3d20 642e 6765 7428  ))..  y = d.get(
-00004110: 2779 6561 7227 290d 0a20 2064 203d 2079  'year')..  d = y
-00004120: 2e61 6464 2864 2e67 6574 4672 6163 7469  .add(d.getFracti
-00004130: 6f6e 2827 7965 6172 2729 290d 0a20 2023  on('year'))..  #
-00004140: 643d 642e 6765 7446 7261 6374 696f 6e28  d=d.getFraction(
-00004150: 2779 6561 7227 290d 0a20 2064 6220 3d20  'year')..  db = 
-00004160: 6565 2e49 6d61 6765 2e63 6f6e 7374 616e  ee.Image.constan
-00004170: 7428 6429 2e72 656e 616d 6528 5b27 7965  t(d).rename(['ye
-00004180: 6172 275d 292e 666c 6f61 7428 290d 0a20  ar']).float().. 
-00004190: 2069 6620 6d61 736b 5469 6d65 3a0d 0a20   if maskTime:.. 
-000041a0: 2020 2064 6220 3d20 6462 2e75 7064 6174     db = db.updat
-000041b0: 654d 6173 6b28 696d 672e 7365 6c65 6374  eMask(img.select
-000041c0: 285b 305d 292e 6d61 736b 2829 290d 0a20  ([0]).mask()).. 
-000041d0: 2072 6574 7572 6e20 696d 672e 6164 6442   return img.addB
-000041e0: 616e 6473 2864 6229 0d0a 0d0a 6465 6620  ands(db)....def 
-000041f0: 6164 6459 6561 7246 7261 6374 696f 6e42  addYearFractionB
-00004200: 616e 6428 696d 6729 3a0d 0a20 2064 203d  and(img):..  d =
-00004210: 2065 652e 4461 7465 2869 6d67 2e67 6574   ee.Date(img.get
-00004220: 2827 7379 7374 656d 3a74 696d 655f 7374  ('system:time_st
-00004230: 6172 7427 2929 0d0a 2020 7920 3d20 642e  art'))..  y = d.
-00004240: 6765 7428 2779 6561 7227 290d 0a20 2023  get('year')..  #
-00004250: 6420 3d20 792e 6164 6428 642e 6765 7446  d = y.add(d.getF
-00004260: 7261 6374 696f 6e28 2779 6561 7227 2929  raction('year'))
-00004270: 3b0d 0a20 2064 203d 2064 2e67 6574 4672  ;..  d = d.getFr
-00004280: 6163 7469 6f6e 2827 7965 6172 2729 0d0a  action('year')..
-00004290: 2020 6462 203d 2065 652e 496d 6167 652e    db = ee.Image.
-000042a0: 636f 6e73 7461 6e74 2864 292e 7265 6e61  constant(d).rena
-000042b0: 6d65 285b 2779 6561 7227 5d29 2e66 6c6f  me(['year']).flo
-000042c0: 6174 2829 0d0a 2020 6462 203d 2064 6220  at()..  db = db 
-000042d0: 232e 7570 6461 7465 4d61 736b 2869 6d67  #.updateMask(img
-000042e0: 2e73 656c 6563 7428 5b30 5d29 2e6d 6173  .select([0]).mas
-000042f0: 6b28 2929 0d0a 2020 7265 7475 726e 2069  k())..  return i
-00004300: 6d67 2e61 6464 4261 6e64 7328 6462 290d  mg.addBands(db).
-00004310: 0a0d 0a64 6566 2061 6464 5965 6172 5965  ...def addYearYe
-00004320: 6172 4672 6163 7469 6f6e 4261 6e64 2869  arFractionBand(i
-00004330: 6d67 293a 0d0a 2020 6420 3d20 6565 2e44  mg):..  d = ee.D
-00004340: 6174 6528 696d 672e 6765 7428 2773 7973  ate(img.get('sys
-00004350: 7465 6d3a 7469 6d65 5f73 7461 7274 2729  tem:time_start')
-00004360: 290d 0a20 2079 203d 2064 2e67 6574 2827  )..  y = d.get('
-00004370: 7965 6172 2729 0d0a 2020 2364 203d 2079  year')..  #d = y
-00004380: 2e61 6464 2864 2e67 6574 4672 6163 7469  .add(d.getFracti
-00004390: 6f6e 2827 7965 6172 2729 293b 0d0a 2020  on('year'));..  
-000043a0: 6420 3d20 642e 6765 7446 7261 6374 696f  d = d.getFractio
-000043b0: 6e28 2779 6561 7227 290d 0a20 2064 6220  n('year')..  db 
-000043c0: 3d20 6565 2e49 6d61 6765 2e63 6f6e 7374  = ee.Image.const
-000043d0: 616e 7428 7929 2e61 6464 2865 652e 496d  ant(y).add(ee.Im
-000043e0: 6167 652e 636f 6e73 7461 6e74 2864 2929  age.constant(d))
-000043f0: 2e72 656e 616d 6528 5b27 7965 6172 275d  .rename(['year']
-00004400: 292e 666c 6f61 7428 290d 0a20 2064 6220  ).float()..  db 
-00004410: 3d20 6462 2023 2e75 7064 6174 654d 6173  = db #.updateMas
-00004420: 6b28 696d 672e 7365 6c65 6374 285b 305d  k(img.select([0]
-00004430: 292e 6d61 736b 2829 290d 0a20 2072 6574  ).mask())..  ret
-00004440: 7572 6e20 696d 672e 6164 6442 616e 6473  urn img.addBands
-00004450: 2864 6229 0d0a 0d0a 6465 6620 6164 6459  (db)....def addY
-00004460: 6561 7242 616e 6428 696d 6729 3a0d 0a20  earBand(img):.. 
-00004470: 2064 203d 2065 652e 4461 7465 2869 6d67   d = ee.Date(img
-00004480: 2e67 6574 2827 7379 7374 656d 3a74 696d  .get('system:tim
-00004490: 655f 7374 6172 7427 2929 0d0a 2020 7920  e_start'))..  y 
-000044a0: 3d20 642e 6765 7428 2779 6561 7227 290d  = d.get('year').
-000044b0: 0a0d 0a20 2064 6220 3d20 6565 2e49 6d61  ...  db = ee.Ima
-000044c0: 6765 2e63 6f6e 7374 616e 7428 7929 2e72  ge.constant(y).r
-000044d0: 656e 616d 6528 5b27 7965 6172 275d 292e  ename(['year']).
-000044e0: 666c 6f61 7428 290d 0a20 2064 6220 3d20  float()..  db = 
-000044f0: 6462 232e 7570 6461 7465 4d61 736b 2869  db#.updateMask(i
-00004500: 6d67 2e73 656c 6563 7428 5b30 5d29 2e6d  mg.select([0]).m
-00004510: 6173 6b28 2929 0d0a 2020 7265 7475 726e  ask())..  return
-00004520: 2069 6d67 2e61 6464 4261 6e64 7328 6462   img.addBands(db
-00004530: 290d 0a0d 0a64 6566 2061 6464 4a75 6c69  )....def addJuli
-00004540: 616e 4461 7942 616e 6428 696d 6729 3a0d  anDayBand(img):.
-00004550: 0a20 2064 203d 2065 652e 4461 7465 2869  .  d = ee.Date(i
-00004560: 6d67 2e67 6574 2827 7379 7374 656d 3a74  mg.get('system:t
-00004570: 696d 655f 7374 6172 7427 2929 0d0a 2020  ime_start'))..  
-00004580: 6a75 6c69 616e 203d 2065 652e 496d 6167  julian = ee.Imag
-00004590: 6528 6565 2e4e 756d 6265 722e 7061 7273  e(ee.Number.pars
-000045a0: 6528 642e 666f 726d 6174 2827 4444 2729  e(d.format('DD')
-000045b0: 2929 2e72 656e 616d 6528 5b27 6a75 6c69  )).rename(['juli
-000045c0: 616e 4461 7927 5d29 0d0a 0d0a 2020 7265  anDay'])....  re
-000045d0: 7475 726e 2069 6d67 2e61 6464 4261 6e64  turn img.addBand
-000045e0: 7328 6a75 6c69 616e 292e 666c 6f61 7428  s(julian).float(
-000045f0: 290d 0a0d 0a64 6566 2061 6464 5965 6172  )....def addYear
-00004600: 4a75 6c69 616e 4461 7942 616e 6428 696d  JulianDayBand(im
-00004610: 6729 3a0d 0a20 2064 203d 2065 652e 4461  g):..  d = ee.Da
-00004620: 7465 2869 6d67 2e67 6574 2827 7379 7374  te(img.get('syst
-00004630: 656d 3a74 696d 655f 7374 6172 7427 2929  em:time_start'))
-00004640: 0d0a 2020 796a 203d 2065 652e 496d 6167  ..  yj = ee.Imag
-00004650: 6528 6565 2e4e 756d 6265 722e 7061 7273  e(ee.Number.pars
-00004660: 6528 642e 666f 726d 6174 2827 5959 4444  e(d.format('YYDD
-00004670: 2729 2929 2e72 656e 616d 6528 5b27 7965  '))).rename(['ye
-00004680: 6172 4a75 6c69 616e 275d 290d 0a20 2072  arJulian'])..  r
-00004690: 6574 7572 6e20 696d 672e 6164 6442 616e  eturn img.addBan
-000046a0: 6473 2879 6a29 2e66 6c6f 6174 2829 0d0a  ds(yj).float()..
-000046b0: 0d0a 6465 6620 6164 6446 756c 6c59 6561  ..def addFullYea
-000046c0: 724a 756c 6961 6e44 6179 4261 6e64 2869  rJulianDayBand(i
-000046d0: 6d67 293a 0d0a 2020 6420 3d20 6565 2e44  mg):..  d = ee.D
-000046e0: 6174 6528 696d 672e 6765 7428 2773 7973  ate(img.get('sys
-000046f0: 7465 6d3a 7469 6d65 5f73 7461 7274 2729  tem:time_start')
-00004700: 293b 0d0a 2020 796a 203d 2065 652e 496d  );..  yj = ee.Im
-00004710: 6167 6528 6565 2e4e 756d 6265 722e 7061  age(ee.Number.pa
-00004720: 7273 6528 642e 666f 726d 6174 2827 5959  rse(d.format('YY
-00004730: 5959 4444 2729 2929 2e72 656e 616d 6528  YYDD'))).rename(
-00004740: 5b27 7965 6172 4a75 6c69 616e 275d 292e  ['yearJulian']).
-00004750: 696e 7436 3428 290d 0a0d 0a20 2072 6574  int64()....  ret
-00004760: 7572 6e20 696d 672e 6164 6442 616e 6473  urn img.addBands
-00004770: 2879 6a29 2e66 6c6f 6174 2829 0d0a 0d0a  (yj).float()....
-00004780: 6465 6620 6f66 6673 6574 496d 6167 6544  def offsetImageD
-00004790: 6174 6528 696d 672c 206e 2c20 756e 6974  ate(img, n, unit
-000047a0: 293a 0d0a 2020 6461 7465 203d 2065 652e  ):..  date = ee.
-000047b0: 4461 7465 2869 6d67 2e67 6574 2827 7379  Date(img.get('sy
-000047c0: 7374 656d 3a74 696d 655f 7374 6172 7427  stem:time_start'
-000047d0: 2929 0d0a 2020 6461 7465 203d 2064 6174  ))..  date = dat
-000047e0: 652e 6164 7661 6e63 6528 6e2c 2075 6e69  e.advance(n, uni
-000047f0: 7429 0d0a 2020 2320 6461 7465 203d 2065  t)..  # date = e
-00004800: 652e 4461 7465 2e66 726f 6d59 4d44 2831  e.Date.fromYMD(1
-00004810: 3030 2c64 6174 652e 6765 7428 276d 6f6e  00,date.get('mon
-00004820: 7468 2729 2c64 6174 652e 6765 7428 2764  th'),date.get('d
-00004830: 6179 2729 290d 0a20 2072 6574 7572 6e20  ay'))..  return 
-00004840: 696d 672e 7365 7428 2773 7973 7465 6d3a  img.set('system:
-00004850: 7469 6d65 5f73 7461 7274 272c 2064 6174  time_start', dat
-00004860: 652e 6d69 6c6c 6973 2829 290d 0a0d 0a23  e.millis())....#
+00004010: 2323 230d 0a23 4164 6473 2074 6865 2066  ###..#Adds the f
+00004020: 6c6f 6174 2079 6561 7220 7769 7468 206a  loat year with j
+00004030: 756c 6961 6e20 7072 6f70 6f72 7469 6f6e  ulian proportion
+00004040: 2074 6f20 696d 6167 650d 0a64 6566 2061   to image..def a
+00004050: 6464 4461 7465 4261 6e64 2869 6d67 2c20  ddDateBand(img, 
+00004060: 6d61 736b 5469 6d65 203d 2046 616c 7365  maskTime = False
+00004070: 293a 0d0a 2020 6420 3d20 6565 2e44 6174  ):..  d = ee.Dat
+00004080: 6528 696d 672e 6765 7428 2773 7973 7465  e(img.get('syste
+00004090: 6d3a 7469 6d65 5f73 7461 7274 2729 290d  m:time_start')).
+000040a0: 0a20 2079 203d 2064 2e67 6574 2827 7965  .  y = d.get('ye
+000040b0: 6172 2729 0d0a 2020 6420 3d20 792e 6164  ar')..  d = y.ad
+000040c0: 6428 642e 6765 7446 7261 6374 696f 6e28  d(d.getFraction(
+000040d0: 2779 6561 7227 2929 0d0a 2020 2364 3d64  'year'))..  #d=d
+000040e0: 2e67 6574 4672 6163 7469 6f6e 2827 7965  .getFraction('ye
+000040f0: 6172 2729 0d0a 2020 6462 203d 2065 652e  ar')..  db = ee.
+00004100: 496d 6167 652e 636f 6e73 7461 6e74 2864  Image.constant(d
+00004110: 292e 7265 6e61 6d65 285b 2779 6561 7227  ).rename(['year'
+00004120: 5d29 2e66 6c6f 6174 2829 0d0a 2020 6966  ]).float()..  if
+00004130: 206d 6173 6b54 696d 653a 0d0a 2020 2020   maskTime:..    
+00004140: 6462 203d 2064 622e 7570 6461 7465 4d61  db = db.updateMa
+00004150: 736b 2869 6d67 2e73 656c 6563 7428 5b30  sk(img.select([0
+00004160: 5d29 2e6d 6173 6b28 2929 0d0a 2020 7265  ]).mask())..  re
+00004170: 7475 726e 2069 6d67 2e61 6464 4261 6e64  turn img.addBand
+00004180: 7328 6462 290d 0a0d 0a64 6566 2061 6464  s(db)....def add
+00004190: 5965 6172 4672 6163 7469 6f6e 4261 6e64  YearFractionBand
+000041a0: 2869 6d67 293a 0d0a 2020 6420 3d20 6565  (img):..  d = ee
+000041b0: 2e44 6174 6528 696d 672e 6765 7428 2773  .Date(img.get('s
+000041c0: 7973 7465 6d3a 7469 6d65 5f73 7461 7274  ystem:time_start
+000041d0: 2729 290d 0a20 2079 203d 2064 2e67 6574  '))..  y = d.get
+000041e0: 2827 7965 6172 2729 0d0a 2020 2364 203d  ('year')..  #d =
+000041f0: 2079 2e61 6464 2864 2e67 6574 4672 6163   y.add(d.getFrac
+00004200: 7469 6f6e 2827 7965 6172 2729 293b 0d0a  tion('year'));..
+00004210: 2020 6420 3d20 642e 6765 7446 7261 6374    d = d.getFract
+00004220: 696f 6e28 2779 6561 7227 290d 0a20 2064  ion('year')..  d
+00004230: 6220 3d20 6565 2e49 6d61 6765 2e63 6f6e  b = ee.Image.con
+00004240: 7374 616e 7428 6429 2e72 656e 616d 6528  stant(d).rename(
+00004250: 5b27 7965 6172 275d 292e 666c 6f61 7428  ['year']).float(
+00004260: 290d 0a20 2064 6220 3d20 6462 2023 2e75  )..  db = db #.u
+00004270: 7064 6174 654d 6173 6b28 696d 672e 7365  pdateMask(img.se
+00004280: 6c65 6374 285b 305d 292e 6d61 736b 2829  lect([0]).mask()
+00004290: 290d 0a20 2072 6574 7572 6e20 696d 672e  )..  return img.
+000042a0: 6164 6442 616e 6473 2864 6229 0d0a 0d0a  addBands(db)....
+000042b0: 6465 6620 6164 6459 6561 7259 6561 7246  def addYearYearF
+000042c0: 7261 6374 696f 6e42 616e 6428 696d 6729  ractionBand(img)
+000042d0: 3a0d 0a20 2064 203d 2065 652e 4461 7465  :..  d = ee.Date
+000042e0: 2869 6d67 2e67 6574 2827 7379 7374 656d  (img.get('system
+000042f0: 3a74 696d 655f 7374 6172 7427 2929 0d0a  :time_start'))..
+00004300: 2020 7920 3d20 642e 6765 7428 2779 6561    y = d.get('yea
+00004310: 7227 290d 0a20 2023 6420 3d20 792e 6164  r')..  #d = y.ad
+00004320: 6428 642e 6765 7446 7261 6374 696f 6e28  d(d.getFraction(
+00004330: 2779 6561 7227 2929 3b0d 0a20 2064 203d  'year'));..  d =
+00004340: 2064 2e67 6574 4672 6163 7469 6f6e 2827   d.getFraction('
+00004350: 7965 6172 2729 0d0a 2020 6462 203d 2065  year')..  db = e
+00004360: 652e 496d 6167 652e 636f 6e73 7461 6e74  e.Image.constant
+00004370: 2879 292e 6164 6428 6565 2e49 6d61 6765  (y).add(ee.Image
+00004380: 2e63 6f6e 7374 616e 7428 6429 292e 7265  .constant(d)).re
+00004390: 6e61 6d65 285b 2779 6561 7227 5d29 2e66  name(['year']).f
+000043a0: 6c6f 6174 2829 0d0a 2020 6462 203d 2064  loat()..  db = d
+000043b0: 6220 232e 7570 6461 7465 4d61 736b 2869  b #.updateMask(i
+000043c0: 6d67 2e73 656c 6563 7428 5b30 5d29 2e6d  mg.select([0]).m
+000043d0: 6173 6b28 2929 0d0a 2020 7265 7475 726e  ask())..  return
+000043e0: 2069 6d67 2e61 6464 4261 6e64 7328 6462   img.addBands(db
+000043f0: 290d 0a0d 0a64 6566 2061 6464 5965 6172  )....def addYear
+00004400: 4261 6e64 2869 6d67 293a 0d0a 2020 6420  Band(img):..  d 
+00004410: 3d20 6565 2e44 6174 6528 696d 672e 6765  = ee.Date(img.ge
+00004420: 7428 2773 7973 7465 6d3a 7469 6d65 5f73  t('system:time_s
+00004430: 7461 7274 2729 290d 0a20 2079 203d 2064  tart'))..  y = d
+00004440: 2e67 6574 2827 7965 6172 2729 0d0a 0d0a  .get('year')....
+00004450: 2020 6462 203d 2065 652e 496d 6167 652e    db = ee.Image.
+00004460: 636f 6e73 7461 6e74 2879 292e 7265 6e61  constant(y).rena
+00004470: 6d65 285b 2779 6561 7227 5d29 2e66 6c6f  me(['year']).flo
+00004480: 6174 2829 0d0a 2020 6462 203d 2064 6223  at()..  db = db#
+00004490: 2e75 7064 6174 654d 6173 6b28 696d 672e  .updateMask(img.
+000044a0: 7365 6c65 6374 285b 305d 292e 6d61 736b  select([0]).mask
+000044b0: 2829 290d 0a20 2072 6574 7572 6e20 696d  ())..  return im
+000044c0: 672e 6164 6442 616e 6473 2864 6229 0d0a  g.addBands(db)..
+000044d0: 0d0a 6465 6620 6164 644a 756c 6961 6e44  ..def addJulianD
+000044e0: 6179 4261 6e64 2869 6d67 293a 0d0a 2020  ayBand(img):..  
+000044f0: 6420 3d20 6565 2e44 6174 6528 696d 672e  d = ee.Date(img.
+00004500: 6765 7428 2773 7973 7465 6d3a 7469 6d65  get('system:time
+00004510: 5f73 7461 7274 2729 290d 0a20 206a 756c  _start'))..  jul
+00004520: 6961 6e20 3d20 6565 2e49 6d61 6765 2865  ian = ee.Image(e
+00004530: 652e 4e75 6d62 6572 2e70 6172 7365 2864  e.Number.parse(d
+00004540: 2e66 6f72 6d61 7428 2744 4427 2929 292e  .format('DD'))).
+00004550: 7265 6e61 6d65 285b 276a 756c 6961 6e44  rename(['julianD
+00004560: 6179 275d 290d 0a0d 0a20 2072 6574 7572  ay'])....  retur
+00004570: 6e20 696d 672e 6164 6442 616e 6473 286a  n img.addBands(j
+00004580: 756c 6961 6e29 2e66 6c6f 6174 2829 0d0a  ulian).float()..
+00004590: 0d0a 6465 6620 6164 6459 6561 724a 756c  ..def addYearJul
+000045a0: 6961 6e44 6179 4261 6e64 2869 6d67 293a  ianDayBand(img):
+000045b0: 0d0a 2020 6420 3d20 6565 2e44 6174 6528  ..  d = ee.Date(
+000045c0: 696d 672e 6765 7428 2773 7973 7465 6d3a  img.get('system:
+000045d0: 7469 6d65 5f73 7461 7274 2729 290d 0a20  time_start')).. 
+000045e0: 2079 6a20 3d20 6565 2e49 6d61 6765 2865   yj = ee.Image(e
+000045f0: 652e 4e75 6d62 6572 2e70 6172 7365 2864  e.Number.parse(d
+00004600: 2e66 6f72 6d61 7428 2759 5944 4427 2929  .format('YYDD'))
+00004610: 292e 7265 6e61 6d65 285b 2779 6561 724a  ).rename(['yearJ
+00004620: 756c 6961 6e27 5d29 0d0a 2020 7265 7475  ulian'])..  retu
+00004630: 726e 2069 6d67 2e61 6464 4261 6e64 7328  rn img.addBands(
+00004640: 796a 292e 666c 6f61 7428 290d 0a0d 0a64  yj).float()....d
+00004650: 6566 2061 6464 4675 6c6c 5965 6172 4a75  ef addFullYearJu
+00004660: 6c69 616e 4461 7942 616e 6428 696d 6729  lianDayBand(img)
+00004670: 3a0d 0a20 2064 203d 2065 652e 4461 7465  :..  d = ee.Date
+00004680: 2869 6d67 2e67 6574 2827 7379 7374 656d  (img.get('system
+00004690: 3a74 696d 655f 7374 6172 7427 2929 3b0d  :time_start'));.
+000046a0: 0a20 2079 6a20 3d20 6565 2e49 6d61 6765  .  yj = ee.Image
+000046b0: 2865 652e 4e75 6d62 6572 2e70 6172 7365  (ee.Number.parse
+000046c0: 2864 2e66 6f72 6d61 7428 2759 5959 5944  (d.format('YYYYD
+000046d0: 4427 2929 292e 7265 6e61 6d65 285b 2779  D'))).rename(['y
+000046e0: 6561 724a 756c 6961 6e27 5d29 2e69 6e74  earJulian']).int
+000046f0: 3634 2829 0d0a 0d0a 2020 7265 7475 726e  64()....  return
+00004700: 2069 6d67 2e61 6464 4261 6e64 7328 796a   img.addBands(yj
+00004710: 292e 666c 6f61 7428 290d 0a0d 0a64 6566  ).float()....def
+00004720: 206f 6666 7365 7449 6d61 6765 4461 7465   offsetImageDate
+00004730: 2869 6d67 2c20 6e2c 2075 6e69 7429 3a0d  (img, n, unit):.
+00004740: 0a20 2064 6174 6520 3d20 6565 2e44 6174  .  date = ee.Dat
+00004750: 6528 696d 672e 6765 7428 2773 7973 7465  e(img.get('syste
+00004760: 6d3a 7469 6d65 5f73 7461 7274 2729 290d  m:time_start')).
+00004770: 0a20 2064 6174 6520 3d20 6461 7465 2e61  .  date = date.a
+00004780: 6476 616e 6365 286e 2c20 756e 6974 290d  dvance(n, unit).
+00004790: 0a20 2023 2064 6174 6520 3d20 6565 2e44  .  # date = ee.D
+000047a0: 6174 652e 6672 6f6d 594d 4428 3130 302c  ate.fromYMD(100,
+000047b0: 6461 7465 2e67 6574 2827 6d6f 6e74 6827  date.get('month'
+000047c0: 292c 6461 7465 2e67 6574 2827 6461 7927  ),date.get('day'
+000047d0: 2929 0d0a 2020 7265 7475 726e 2069 6d67  ))..  return img
+000047e0: 2e73 6574 2827 7379 7374 656d 3a74 696d  .set('system:tim
+000047f0: 655f 7374 6172 7427 2c20 6461 7465 2e6d  e_start', date.m
+00004800: 696c 6c69 7328 2929 0d0a 0d0a 2323 2323  illis())....####
+00004810: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00004820: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00004830: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00004840: 2323 2323 2323 2323 2323 2323 0d0a 2323  ############..##
+00004850: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00004860: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00004870: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00004880: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00004890: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000048a0: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
-000048b0: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
-000048c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000048d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000048e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000048f0: 230d 0a66 7269 6e67 6543 6f75 6e74 5468  #..fringeCountTh
-00004900: 7265 7368 6f6c 6420 3d20 3237 3923 4465  reshold = 279#De
-00004910: 6669 6e65 206e 756d 6265 7220 6f66 206e  fine number of n
-00004920: 6f6e 206e 756c 6c20 6f62 7365 7276 6174  on null observat
-00004930: 696f 6e73 2066 6f72 2070 6978 656c 2074  ions for pixel t
-00004940: 6f20 6e6f 7420 6265 2063 6c61 7373 6966  o not be classif
-00004950: 6965 6420 6173 2061 2066 7269 6e67 650d  ied as a fringe.
-00004960: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
-00004970: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00004980: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00004990: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000049a0: 230d 0a23 4b65 726e 656c 2075 7365 6420  #..#Kernel used 
-000049b0: 666f 7220 6465 6672 696e 6769 6e67 0d0a  for defringing..
-000049c0: 6b20 3d20 6565 2e4b 6572 6e65 6c2e 6669  k = ee.Kernel.fi
-000049d0: 7865 6428 3431 2c20 3431 2c20 5c0d 0a5b  xed(41, 41, \..[
-000049e0: 5b30 2c20 302c 2030 2c20 302c 2030 2c20  [0, 0, 0, 0, 0, 
-000049f0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004a00: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00004a10: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00004a20: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
-00004a30: 2c20 312c 2031 2c20 312c 2030 2c20 302c  , 1, 1, 1, 0, 0,
-00004a40: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00004a50: 302c 2030 2c20 302c 2030 5d2c 5c0d 0a5b  0, 0, 0, 0],\..[
+00004880: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
+00004890: 6672 696e 6765 436f 756e 7454 6872 6573  fringeCountThres
+000048a0: 686f 6c64 203d 2032 3739 2344 6566 696e  hold = 279#Defin
+000048b0: 6520 6e75 6d62 6572 206f 6620 6e6f 6e20  e number of non 
+000048c0: 6e75 6c6c 206f 6273 6572 7661 7469 6f6e  null observation
+000048d0: 7320 666f 7220 7069 7865 6c20 746f 206e  s for pixel to n
+000048e0: 6f74 2062 6520 636c 6173 7369 6669 6564  ot be classified
+000048f0: 2061 7320 6120 6672 696e 6765 0d0a 2323   as a fringe..##
+00004900: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00004910: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00004920: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00004930: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
+00004940: 234b 6572 6e65 6c20 7573 6564 2066 6f72  #Kernel used for
+00004950: 2064 6566 7269 6e67 696e 670d 0a6b 203d   defringing..k =
+00004960: 2065 652e 4b65 726e 656c 2e66 6978 6564   ee.Kernel.fixed
+00004970: 2834 312c 2034 312c 205c 0d0a 5b5b 302c  (41, 41, \..[[0,
+00004980: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00004990: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+000049a0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+000049b0: 2030 2c20 302c 2030 2c20 302c 2031 2c20   0, 0, 0, 0, 1, 
+000049c0: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
+000049d0: 2c20 312c 2031 2c20 302c 2030 2c20 302c  , 1, 1, 0, 0, 0,
+000049e0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+000049f0: 302c 2030 2c20 305d 2c5c 0d0a 5b30 2c20  0, 0, 0],\..[0, 
+00004a00: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00004a10: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00004a20: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00004a30: 302c 2030 2c20 302c 2030 2c20 312c 2031  0, 0, 0, 0, 1, 1
+00004a40: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+00004a50: 2031 2c20 312c 2030 2c20 302c 2030 2c20   1, 1, 0, 0, 0, 
 00004a60: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004a70: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00004a80: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00004a90: 302c 2030 2c20 302c 2030 2c20 302c 2031  0, 0, 0, 0, 0, 1
-00004aa0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00004ab0: 2031 2c20 312c 2031 2c20 302c 2030 2c20   1, 1, 1, 0, 0, 
-00004ac0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004ad0: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+00004a70: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00004a80: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00004a90: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00004aa0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00004ab0: 302c 2030 2c20 302c 2030 2c20 312c 2031  0, 0, 0, 0, 1, 1
+00004ac0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+00004ad0: 2031 2c20 312c 2030 2c20 302c 2030 2c20   1, 1, 0, 0, 0, 
 00004ae0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004af0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00004b00: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00004b10: 302c 2030 2c20 302c 2030 2c20 302c 2031  0, 0, 0, 0, 0, 1
-00004b20: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00004b30: 2031 2c20 312c 2031 2c20 302c 2030 2c20   1, 1, 1, 0, 0, 
-00004b40: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004b50: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+00004af0: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00004b00: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00004b10: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00004b20: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00004b30: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00004b40: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00004b50: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
 00004b60: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004b70: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00004b80: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00004b90: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004ba0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00004bb0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00004bc0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004bd0: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+00004b70: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00004b80: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00004b90: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00004ba0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00004bb0: 302c 2030 2c20 302c 2031 2c20 312c 2031  0, 0, 0, 1, 1, 1
+00004bc0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+00004bd0: 2031 2c20 302c 2030 2c20 302c 2030 2c20   1, 0, 0, 0, 0, 
 00004be0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004bf0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00004c00: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00004c10: 302c 2030 2c20 302c 2030 2c20 312c 2031  0, 0, 0, 0, 1, 1
-00004c20: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00004c30: 2031 2c20 312c 2030 2c20 302c 2030 2c20   1, 1, 0, 0, 0, 
-00004c40: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004c50: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+00004bf0: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00004c00: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00004c10: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00004c20: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00004c30: 302c 2030 2c20 302c 2031 2c20 312c 2031  0, 0, 0, 1, 1, 1
+00004c40: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+00004c50: 2031 2c20 302c 2030 2c20 302c 2030 2c20   1, 0, 0, 0, 0, 
 00004c60: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004c70: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00004c80: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00004c90: 302c 2030 2c20 302c 2030 2c20 312c 2031  0, 0, 0, 0, 1, 1
-00004ca0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00004cb0: 2031 2c20 312c 2030 2c20 302c 2030 2c20   1, 1, 0, 0, 0, 
-00004cc0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004cd0: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+00004c70: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00004c80: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00004c90: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00004ca0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00004cb0: 302c 2030 2c20 302c 2031 2c20 312c 2031  0, 0, 0, 1, 1, 1
+00004cc0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+00004cd0: 2031 2c20 302c 2030 2c20 302c 2030 2c20   1, 0, 0, 0, 0, 
 00004ce0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004cf0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00004d00: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00004d10: 302c 2030 2c20 302c 2030 2c20 312c 2031  0, 0, 0, 0, 1, 1
-00004d20: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00004d30: 2031 2c20 312c 2030 2c20 302c 2030 2c20   1, 1, 0, 0, 0, 
-00004d40: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004d50: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+00004cf0: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00004d00: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00004d10: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00004d20: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00004d30: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00004d40: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00004d50: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
 00004d60: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004d70: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00004d80: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00004d90: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004da0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00004db0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00004dc0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004dd0: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+00004d70: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00004d80: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00004d90: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00004da0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00004db0: 302c 2030 2c20 312c 2031 2c20 312c 2031  0, 0, 1, 1, 1, 1
+00004dc0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+00004dd0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
 00004de0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004df0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00004e00: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00004e10: 302c 2030 2c20 302c 2031 2c20 312c 2031  0, 0, 0, 1, 1, 1
-00004e20: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00004e30: 2031 2c20 302c 2030 2c20 302c 2030 2c20   1, 0, 0, 0, 0, 
-00004e40: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004e50: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+00004df0: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00004e00: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00004e10: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00004e20: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00004e30: 302c 2030 2c20 312c 2031 2c20 312c 2031  0, 0, 1, 1, 1, 1
+00004e40: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+00004e50: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
 00004e60: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004e70: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00004e80: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00004e90: 302c 2030 2c20 302c 2031 2c20 312c 2031  0, 0, 0, 1, 1, 1
-00004ea0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00004eb0: 2031 2c20 302c 2030 2c20 302c 2030 2c20   1, 0, 0, 0, 0, 
-00004ec0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004ed0: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+00004e70: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00004e80: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00004e90: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00004ea0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00004eb0: 302c 2030 2c20 312c 2031 2c20 312c 2031  0, 0, 1, 1, 1, 1
+00004ec0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+00004ed0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
 00004ee0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004ef0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00004f00: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00004f10: 302c 2030 2c20 302c 2031 2c20 312c 2031  0, 0, 0, 1, 1, 1
-00004f20: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00004f30: 2031 2c20 302c 2030 2c20 302c 2030 2c20   1, 0, 0, 0, 0, 
-00004f40: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004f50: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+00004ef0: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00004f00: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00004f10: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00004f20: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00004f30: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00004f40: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00004f50: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
 00004f60: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004f70: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00004f80: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00004f90: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004fa0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00004fb0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00004fc0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004fd0: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+00004f70: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00004f80: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00004f90: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00004fa0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00004fb0: 302c 2031 2c20 312c 2031 2c20 312c 2031  0, 1, 1, 1, 1, 1
+00004fc0: 2c20 312c 2031 2c20 312c 2031 2c20 302c  , 1, 1, 1, 1, 0,
+00004fd0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
 00004fe0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00004ff0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005000: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005010: 302c 2030 2c20 312c 2031 2c20 312c 2031  0, 0, 1, 1, 1, 1
-00005020: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00005030: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005040: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005050: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+00004ff0: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00005000: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00005010: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005020: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005030: 302c 2031 2c20 312c 2031 2c20 312c 2031  0, 1, 1, 1, 1, 1
+00005040: 2c20 312c 2031 2c20 312c 2031 2c20 302c  , 1, 1, 1, 1, 0,
+00005050: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
 00005060: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005070: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005080: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005090: 302c 2030 2c20 312c 2031 2c20 312c 2031  0, 0, 1, 1, 1, 1
-000050a0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-000050b0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-000050c0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-000050d0: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+00005070: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00005080: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00005090: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+000050a0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+000050b0: 302c 2031 2c20 312c 2031 2c20 312c 2031  0, 1, 1, 1, 1, 1
+000050c0: 2c20 312c 2031 2c20 312c 2031 2c20 302c  , 1, 1, 1, 1, 0,
+000050d0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
 000050e0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-000050f0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005100: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005110: 302c 2030 2c20 312c 2031 2c20 312c 2031  0, 0, 1, 1, 1, 1
-00005120: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00005130: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005140: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005150: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+000050f0: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00005100: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00005110: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005120: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005130: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00005140: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005150: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
 00005160: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005170: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005180: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005190: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-000051a0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000051b0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-000051c0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-000051d0: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+00005170: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00005180: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00005190: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+000051a0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+000051b0: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
+000051c0: 2c20 312c 2031 2c20 312c 2030 2c20 302c  , 1, 1, 1, 0, 0,
+000051d0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
 000051e0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-000051f0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005200: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005210: 302c 2031 2c20 312c 2031 2c20 312c 2031  0, 1, 1, 1, 1, 1
-00005220: 2c20 312c 2031 2c20 312c 2031 2c20 302c  , 1, 1, 1, 1, 0,
-00005230: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005240: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005250: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+000051f0: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00005200: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00005210: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005220: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005230: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
+00005240: 2c20 312c 2031 2c20 312c 2030 2c20 302c  , 1, 1, 1, 0, 0,
+00005250: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
 00005260: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005270: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005280: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005290: 302c 2031 2c20 312c 2031 2c20 312c 2031  0, 1, 1, 1, 1, 1
-000052a0: 2c20 312c 2031 2c20 312c 2031 2c20 302c  , 1, 1, 1, 1, 0,
-000052b0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-000052c0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-000052d0: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+00005270: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00005280: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00005290: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+000052a0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+000052b0: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
+000052c0: 2c20 312c 2031 2c20 312c 2030 2c20 302c  , 1, 1, 1, 0, 0,
+000052d0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
 000052e0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-000052f0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005300: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005310: 302c 2031 2c20 312c 2031 2c20 312c 2031  0, 1, 1, 1, 1, 1
-00005320: 2c20 312c 2031 2c20 312c 2031 2c20 302c  , 1, 1, 1, 1, 0,
-00005330: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005340: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005350: 2c20 302c 2030 2c20 305d 2c20 5c0d 0a5b  , 0, 0, 0], \..[
+000052f0: 2c20 302c 2030 5d2c 205c 0d0a 5b30 2c20  , 0, 0], \..[0, 
+00005300: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00005310: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005320: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005330: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00005340: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005350: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
 00005360: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005370: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005380: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005390: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-000053a0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000053b0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-000053c0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-000053d0: 2c20 302c 2030 2c20 305d 2c5c 0d0a 5b30  , 0, 0, 0],\..[0
+00005370: 2c20 302c 2030 5d2c 5c0d 0a5b 302c 2030  , 0, 0],\..[0, 0
+00005380: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005390: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+000053a0: 302c 2030 2c20 302c 2030 2c20 312c 2031  0, 0, 0, 0, 1, 1
+000053b0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+000053c0: 2031 2c20 312c 2030 2c20 302c 2030 2c20   1, 1, 0, 0, 0, 
+000053d0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 000053e0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000053f0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005400: 302c 2030 2c20 302c 2030 2c20 302c 2031  0, 0, 0, 0, 0, 1
-00005410: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00005420: 2031 2c20 312c 2031 2c20 302c 2030 2c20   1, 1, 1, 0, 0, 
-00005430: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005440: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005450: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+000053f0: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005400: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005410: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005420: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00005430: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005440: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005450: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 00005460: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005470: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005480: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005490: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000054a0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-000054b0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-000054c0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000054d0: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+00005470: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005480: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005490: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+000054a0: 302c 2030 2c20 302c 2031 2c20 312c 2031  0, 0, 0, 1, 1, 1
+000054b0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+000054c0: 2031 2c20 302c 2030 2c20 302c 2030 2c20   1, 0, 0, 0, 0, 
+000054d0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 000054e0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000054f0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005500: 302c 2030 2c20 302c 2030 2c20 312c 2031  0, 0, 0, 0, 1, 1
-00005510: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00005520: 2031 2c20 312c 2030 2c20 302c 2030 2c20   1, 1, 0, 0, 0, 
-00005530: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005540: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005550: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+000054f0: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005500: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005510: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005520: 302c 2030 2c20 302c 2031 2c20 312c 2031  0, 0, 0, 1, 1, 1
+00005530: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+00005540: 2031 2c20 302c 2030 2c20 302c 2030 2c20   1, 0, 0, 0, 0, 
+00005550: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 00005560: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005570: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005580: 302c 2030 2c20 302c 2030 2c20 312c 2031  0, 0, 0, 0, 1, 1
-00005590: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-000055a0: 2031 2c20 312c 2030 2c20 302c 2030 2c20   1, 1, 0, 0, 0, 
-000055b0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-000055c0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000055d0: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+00005570: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005580: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005590: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+000055a0: 302c 2030 2c20 302c 2031 2c20 312c 2031  0, 0, 0, 1, 1, 1
+000055b0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+000055c0: 2031 2c20 302c 2030 2c20 302c 2030 2c20   1, 0, 0, 0, 0, 
+000055d0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 000055e0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000055f0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005600: 302c 2030 2c20 302c 2030 2c20 312c 2031  0, 0, 0, 0, 1, 1
-00005610: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00005620: 2031 2c20 312c 2030 2c20 302c 2030 2c20   1, 1, 0, 0, 0, 
-00005630: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005640: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005650: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+000055f0: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005600: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005610: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005620: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00005630: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005640: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005650: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 00005660: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005670: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005680: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005690: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000056a0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-000056b0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-000056c0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000056d0: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+00005670: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005680: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005690: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+000056a0: 302c 2030 2c20 312c 2031 2c20 312c 2031  0, 0, 1, 1, 1, 1
+000056b0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+000056c0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+000056d0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 000056e0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000056f0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005700: 302c 2030 2c20 302c 2031 2c20 312c 2031  0, 0, 0, 1, 1, 1
-00005710: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00005720: 2031 2c20 302c 2030 2c20 302c 2030 2c20   1, 0, 0, 0, 0, 
-00005730: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005740: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005750: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+000056f0: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005700: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005710: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005720: 302c 2030 2c20 312c 2031 2c20 312c 2031  0, 0, 1, 1, 1, 1
+00005730: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+00005740: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005750: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 00005760: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005770: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005780: 302c 2030 2c20 302c 2031 2c20 312c 2031  0, 0, 0, 1, 1, 1
-00005790: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-000057a0: 2031 2c20 302c 2030 2c20 302c 2030 2c20   1, 0, 0, 0, 0, 
-000057b0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-000057c0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000057d0: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+00005770: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005780: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005790: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+000057a0: 302c 2030 2c20 312c 2031 2c20 312c 2031  0, 0, 1, 1, 1, 1
+000057b0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+000057c0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+000057d0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 000057e0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000057f0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005800: 302c 2030 2c20 302c 2031 2c20 312c 2031  0, 0, 0, 1, 1, 1
-00005810: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00005820: 2031 2c20 302c 2030 2c20 302c 2030 2c20   1, 0, 0, 0, 0, 
-00005830: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005840: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005850: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+000057f0: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005800: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005810: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005820: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00005830: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005840: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005850: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 00005860: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005870: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005880: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005890: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000058a0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-000058b0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-000058c0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000058d0: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+00005870: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005880: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005890: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+000058a0: 302c 2031 2c20 312c 2031 2c20 312c 2031  0, 1, 1, 1, 1, 1
+000058b0: 2c20 312c 2031 2c20 312c 2031 2c20 302c  , 1, 1, 1, 1, 0,
+000058c0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+000058d0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 000058e0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000058f0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005900: 302c 2030 2c20 312c 2031 2c20 312c 2031  0, 0, 1, 1, 1, 1
-00005910: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00005920: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005930: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005940: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005950: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+000058f0: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005900: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005910: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005920: 302c 2031 2c20 312c 2031 2c20 312c 2031  0, 1, 1, 1, 1, 1
+00005930: 2c20 312c 2031 2c20 312c 2031 2c20 302c  , 1, 1, 1, 1, 0,
+00005940: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005950: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 00005960: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005970: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005980: 302c 2030 2c20 312c 2031 2c20 312c 2031  0, 0, 1, 1, 1, 1
-00005990: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-000059a0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-000059b0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-000059c0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000059d0: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+00005970: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005980: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005990: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+000059a0: 302c 2031 2c20 312c 2031 2c20 312c 2031  0, 1, 1, 1, 1, 1
+000059b0: 2c20 312c 2031 2c20 312c 2031 2c20 302c  , 1, 1, 1, 1, 0,
+000059c0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+000059d0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 000059e0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000059f0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005a00: 302c 2030 2c20 312c 2031 2c20 312c 2031  0, 0, 1, 1, 1, 1
-00005a10: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00005a20: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005a30: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005a40: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005a50: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+000059f0: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005a00: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005a10: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005a20: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00005a30: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005a40: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005a50: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 00005a60: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005a70: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005a80: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005a90: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005aa0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005ab0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005ac0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005ad0: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+00005a70: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005a80: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005a90: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005aa0: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
+00005ab0: 2c20 312c 2031 2c20 312c 2030 2c20 302c  , 1, 1, 1, 0, 0,
+00005ac0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005ad0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 00005ae0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005af0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005b00: 302c 2031 2c20 312c 2031 2c20 312c 2031  0, 1, 1, 1, 1, 1
-00005b10: 2c20 312c 2031 2c20 312c 2031 2c20 302c  , 1, 1, 1, 1, 0,
-00005b20: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005b30: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005b40: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005b50: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+00005af0: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005b00: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005b10: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005b20: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
+00005b30: 2c20 312c 2031 2c20 312c 2030 2c20 302c  , 1, 1, 1, 0, 0,
+00005b40: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005b50: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 00005b60: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005b70: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005b80: 302c 2031 2c20 312c 2031 2c20 312c 2031  0, 1, 1, 1, 1, 1
-00005b90: 2c20 312c 2031 2c20 312c 2031 2c20 302c  , 1, 1, 1, 1, 0,
-00005ba0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005bb0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005bc0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005bd0: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+00005b70: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005b80: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005b90: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005ba0: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
+00005bb0: 2c20 312c 2031 2c20 312c 2030 2c20 302c  , 1, 1, 1, 0, 0,
+00005bc0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005bd0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 00005be0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005bf0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005c00: 302c 2031 2c20 312c 2031 2c20 312c 2031  0, 1, 1, 1, 1, 1
-00005c10: 2c20 312c 2031 2c20 312c 2031 2c20 302c  , 1, 1, 1, 1, 0,
-00005c20: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005c30: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005c40: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005c50: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+00005bf0: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005c00: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005c10: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005c20: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00005c30: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005c40: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005c50: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 00005c60: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005c70: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005c80: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005c90: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005ca0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005cb0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005cc0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005cd0: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+00005c70: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005c80: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005c90: 2030 2c20 302c 2030 2c20 302c 2031 2c20   0, 0, 0, 0, 1, 
+00005ca0: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
+00005cb0: 2c20 312c 2031 2c20 302c 2030 2c20 302c  , 1, 1, 0, 0, 0,
+00005cc0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005cd0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 00005ce0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005cf0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005d00: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
-00005d10: 2c20 312c 2031 2c20 312c 2030 2c20 302c  , 1, 1, 1, 0, 0,
-00005d20: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005d30: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005d40: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005d50: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+00005cf0: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005d00: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005d10: 2030 2c20 302c 2030 2c20 302c 2031 2c20   0, 0, 0, 0, 1, 
+00005d20: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
+00005d30: 2c20 312c 2031 2c20 302c 2030 2c20 302c  , 1, 1, 0, 0, 0,
+00005d40: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005d50: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 00005d60: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005d70: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005d80: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
-00005d90: 2c20 312c 2031 2c20 312c 2030 2c20 302c  , 1, 1, 1, 0, 0,
-00005da0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005db0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005dc0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005dd0: 2030 2c20 302c 2030 5d2c 205c 0d0a 5b30   0, 0, 0], \..[0
+00005d70: 2030 2c20 305d 2c20 5c0d 0a5b 302c 2030   0, 0], \..[0, 0
+00005d80: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00005d90: 2030 2c20 302c 2030 2c20 302c 2031 2c20   0, 0, 0, 0, 1, 
+00005da0: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
+00005db0: 2c20 312c 2031 2c20 302c 2030 2c20 302c  , 1, 1, 0, 0, 0,
+00005dc0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00005dd0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
 00005de0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005df0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005e00: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
-00005e10: 2c20 312c 2031 2c20 312c 2030 2c20 302c  , 1, 1, 1, 0, 0,
-00005e20: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00005e30: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00005e40: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00005e50: 2030 2c20 302c 2030 5d5d 5c0d 0a29 0d0a   0, 0, 0]]\..)..
-00005e60: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
-00005e70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00005e80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00005e90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00005ea0: 2323 0d0a 2341 6c67 6f72 6974 686d 2074  ##..#Algorithm t
-00005eb0: 6f20 6465 6672 696e 6765 204c 616e 6473  o defringe Lands
-00005ec0: 6174 2073 6365 6e65 730d 0a64 6566 2064  at scenes..def d
-00005ed0: 6566 7269 6e67 654c 616e 6473 6174 2869  efringeLandsat(i
-00005ee0: 6d67 293a 0d0a 2020 2346 696e 6420 616e  mg):..  #Find an
-00005ef0: 7920 7069 7865 6c20 7769 7468 6f75 7420  y pixel without 
-00005f00: 7375 6666 6963 6965 6e74 206e 6f6e 206e  sufficient non n
-00005f10: 756c 6c20 7069 7865 6c73 2028 6672 696e  ull pixels (frin
-00005f20: 6765 7329 0d0a 2020 6d20 3d20 696d 672e  ges)..  m = img.
-00005f30: 6d61 736b 2829 2e72 6564 7563 6528 6565  mask().reduce(ee
-00005f40: 2e52 6564 7563 6572 2e6d 696e 2829 290d  .Reducer.min()).
-00005f50: 0a0d 0a20 2023 4170 706c 7920 6b65 726e  ...  #Apply kern
-00005f60: 656c 0d0a 2020 6b65 726e 656c 5375 6d20  el..  kernelSum 
-00005f70: 3d20 6d2e 7265 6475 6365 4e65 6967 6862  = m.reduceNeighb
-00005f80: 6f72 686f 6f64 2865 652e 5265 6475 6365  orhood(ee.Reduce
-00005f90: 722e 7375 6d28 292c 206b 2c20 276b 6572  r.sum(), k, 'ker
-00005fa0: 6e65 6c27 290d 0a20 2023 4d61 702e 6164  nel')..  #Map.ad
-00005fb0: 644c 6179 6572 2869 6d67 2c76 697a 5061  dLayer(img,vizPa
-00005fc0: 7261 6d73 2c27 7769 7468 2066 7269 6e67  rams,'with fring
-00005fd0: 6573 2729 0d0a 2020 234d 6170 2e61 6464  es')..  #Map.add
-00005fe0: 4c61 7965 7228 7375 6d2c 7b27 6d69 6e27  Layer(sum,{'min'
-00005ff0: 3a32 302c 276d 6178 273a 3234 317d 2c27  :20,'max':241},'
-00006000: 7375 6d34 3127 2c66 616c 7365 290d 0a0d  sum41',false)...
-00006010: 0a20 2023 4d61 736b 2070 6978 656c 7320  .  #Mask pixels 
-00006020: 772f 6f20 7375 6666 6963 6965 6e74 206f  w/o sufficient o
-00006030: 6273 0d0a 2020 6b65 726e 656c 5375 6d20  bs..  kernelSum 
-00006040: 3d20 6b65 726e 656c 5375 6d2e 6774 6528  = kernelSum.gte(
-00006050: 6672 696e 6765 436f 756e 7454 6872 6573  fringeCountThres
-00006060: 686f 6c64 290d 0a20 2069 6d67 203d 2069  hold)..  img = i
-00006070: 6d67 2e6d 6173 6b28 6b65 726e 656c 5375  mg.mask(kernelSu
-00006080: 6d29 0d0a 2020 234d 6170 2e61 6464 4c61  m)..  #Map.addLa
-00006090: 7965 7228 696d 672c 7669 7a50 6172 616d  yer(img,vizParam
-000060a0: 732c 2764 6566 7269 6e67 6564 2729 0d0a  s,'defringed')..
-000060b0: 2020 7265 7475 726e 2069 6d67 0d0a 0d0a    return img....
-000060c0: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
-000060d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000060e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000060f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00006100: 2323 0d0a 2346 756e 6374 696f 6e20 746f  ##..#Function to
-00006110: 2066 696e 6420 756e 6971 7565 2076 616c   find unique val
-00006120: 7565 7320 6f66 2061 2066 6965 6c64 2069  ues of a field i
-00006130: 6e20 6120 636f 6c6c 6563 7469 6f6e 0d0a  n a collection..
-00006140: 6465 6620 756e 6971 7565 5661 6c75 6573  def uniqueValues
-00006150: 2863 6f6c 6c65 6374 696f 6e2c 6669 656c  (collection,fiel
-00006160: 6429 3a0d 0a20 2076 616c 7565 7320 3d20  d):..  values = 
-00006170: 6565 2e44 6963 7469 6f6e 6172 7928 636f  ee.Dictionary(co
-00006180: 6c6c 6563 7469 6f6e 2e72 6564 7563 6543  llection.reduceC
-00006190: 6f6c 756d 6e73 2865 652e 5265 6475 6365  olumns(ee.Reduce
-000061a0: 722e 6672 6571 7565 6e63 7948 6973 746f  r.frequencyHisto
-000061b0: 6772 616d 2829 2c5b 6669 656c 645d 292e  gram(),[field]).
-000061c0: 6765 7428 2768 6973 746f 6772 616d 2729  get('histogram')
-000061d0: 292e 6b65 7973 2829 0d0a 2020 7265 7475  ).keys()..  retu
-000061e0: 726e 2076 616c 7565 730d 0a0d 0a23 2323  rn values....###
-000061f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00006200: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00006210: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00006220: 2323 2323 2323 2323 2323 2323 0d0a 2346  ############..#F
-00006230: 756e 6374 696f 6e20 746f 2073 696d 706c  unction to simpl
-00006240: 6966 7920 6461 7461 2069 6e74 6f20 6461  ify data into da
-00006250: 696c 7920 6d6f 7361 6963 730d 0a23 5468  ily mosaics..#Th
-00006260: 6973 2070 726f 6365 6475 7265 206d 7573  is procedure mus
-00006270: 7420 6265 2075 7365 6420 666f 7220 7072  t be used for pr
-00006280: 6f70 6572 2070 726f 6365 7373 696e 6720  oper processing 
-00006290: 6f66 2053 3220 696d 6167 6572 790d 0a64  of S2 imagery..d
-000062a0: 6566 2064 6169 6c79 4d6f 7361 6963 7328  ef dailyMosaics(
-000062b0: 696d 6773 293a 0d0a 2020 2353 696d 706c  imgs):..  #Simpl
-000062c0: 6966 7920 6461 7465 2074 6f20 6578 636c  ify date to excl
-000062d0: 7564 6520 7469 6d65 206f 6620 6461 790d  ude time of day.
-000062e0: 0a20 2064 6566 2070 726f 7057 7261 7070  .  def propWrapp
-000062f0: 6572 2869 6d67 293a 0d0a 2020 2020 6420  er(img):..    d 
-00006300: 3d20 6565 2e53 7472 696e 6728 6565 2e44  = ee.String(ee.D
-00006310: 6174 6528 696d 672e 6765 7428 2773 7973  ate(img.get('sys
-00006320: 7465 6d3a 7469 6d65 5f73 7461 7274 2729  tem:time_start')
-00006330: 292e 666f 726d 6174 2827 5959 5959 2d4d  ).format('YYYY-M
-00006340: 4d2d 6464 2729 290d 0a20 2020 206f 7262  M-dd'))..    orb
-00006350: 6974 203d 2065 652e 4e75 6d62 6572 2869  it = ee.Number(i
-00006360: 6d67 2e67 6574 2827 5345 4e53 494e 475f  mg.get('SENSING_
-00006370: 4f52 4249 545f 4e55 4d42 4552 2729 292e  ORBIT_NUMBER')).
-00006380: 666f 726d 6174 2829 0d0a 2020 2020 7265  format()..    re
-00006390: 7475 726e 2069 6d67 2e73 6574 287b 2764  turn img.set({'d
-000063a0: 6174 652d 6f72 6269 7427 3a64 2e63 6174  ate-orbit':d.cat
-000063b0: 2865 652e 5374 7269 6e67 2827 5f27 2929  (ee.String('_'))
-000063c0: 2e63 6174 286f 7262 6974 292c 2764 6174  .cat(orbit),'dat
-000063d0: 6527 3a64 7d29 0d0a 2020 696d 6773 203d  e':d})..  imgs =
-000063e0: 2069 6d67 732e 6d61 7028 7072 6f70 5772   imgs.map(propWr
-000063f0: 6170 7065 7229 0d0a 0d0a 2020 2346 696e  apper)....  #Fin
-00006400: 6420 7468 6520 756e 6971 7565 2064 6179  d the unique day
-00006410: 730d 0a20 2064 6179 4f72 6269 7473 2020  s..  dayOrbits  
-00006420: 3d20 6565 2e44 6963 7469 6f6e 6172 7928  = ee.Dictionary(
-00006430: 696d 6773 2e61 6767 7265 6761 7465 5f68  imgs.aggregate_h
-00006440: 6973 746f 6772 616d 2827 6461 7465 2d6f  istogram('date-o
-00006450: 7262 6974 2729 292e 6b65 7973 2829 0d0a  rbit')).keys()..
-00006460: 0d0a 2020 6465 6620 6461 7957 7261 7070  ..  def dayWrapp
-00006470: 6572 2864 293a 0d0a 2020 2020 6461 7465  er(d):..    date
-00006480: 203d 2065 652e 4461 7465 2865 652e 5374   = ee.Date(ee.St
-00006490: 7269 6e67 2864 292e 7370 6c69 7428 275f  ring(d).split('_
-000064a0: 2729 2e67 6574 2830 2929 0d0a 2020 2020  ').get(0))..    
-000064b0: 6f72 6269 7420 3d20 6565 2e4e 756d 6265  orbit = ee.Numbe
-000064c0: 722e 7061 7273 6528 6565 2e53 7472 696e  r.parse(ee.Strin
-000064d0: 6728 6429 2e73 706c 6974 2827 5f27 292e  g(d).split('_').
-000064e0: 6765 7428 3129 290d 0a20 2020 2074 203d  get(1))..    t =
-000064f0: 2069 6d67 732e 6669 6c74 6572 4461 7465   imgs.filterDate
-00006500: 2864 6174 652c 6461 7465 2e61 6476 616e  (date,date.advan
-00006510: 6365 2831 2c27 6461 7927 2929 5c0d 0a20  ce(1,'day'))\.. 
-00006520: 2020 202e 6669 6c74 6572 2865 652e 4669     .filter(ee.Fi
-00006530: 6c74 6572 2e65 7128 2753 454e 5349 4e47  lter.eq('SENSING
-00006540: 5f4f 5242 4954 5f4e 554d 4245 5227 2c6f  _ORBIT_NUMBER',o
-00006550: 7262 6974 2929 0d0a 2020 2020 6620 3d20  rbit))..    f = 
-00006560: 6565 2e49 6d61 6765 2874 2e66 6972 7374  ee.Image(t.first
-00006570: 2829 290d 0a20 2020 2074 203d 2074 2e6d  ())..    t = t.m
-00006580: 6f73 6169 6328 290d 0a20 2020 2074 203d  osaic()..    t =
-00006590: 2074 2e73 6574 2827 7379 7374 656d 3a74   t.set('system:t
-000065a0: 696d 655f 7374 6172 7427 2c64 6174 652e  ime_start',date.
-000065b0: 6d69 6c6c 6973 2829 290d 0a20 2020 2074  millis())..    t
-000065c0: 203d 2074 2e63 6f70 7950 726f 7065 7274   = t.copyPropert
-000065d0: 6965 7328 6629 0d0a 2020 2020 7265 7475  ies(f)..    retu
-000065e0: 726e 2074 0d0a 2020 696d 6773 203d 2064  rn t..  imgs = d
-000065f0: 6179 4f72 6269 7473 2e6d 6170 2864 6179  ayOrbits.map(day
-00006600: 5772 6170 7065 7229 0d0a 2020 696d 6773  Wrapper)..  imgs
-00006610: 203d 2065 652e 496d 6167 6543 6f6c 6c65   = ee.ImageColle
-00006620: 6374 696f 6e2e 6672 6f6d 496d 6167 6573  ction.fromImages
-00006630: 2869 6d67 7329 0d0a 0d0a 2020 7265 7475  (imgs)....  retu
-00006640: 726e 2069 6d67 730d 0a23 2323 2323 2323  rn imgs..#######
-00006650: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00006660: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00006670: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00006680: 2323 2323 2323 2323 230d 0a23 2053 656e  #########..# Sen
-00006690: 7469 6e65 6c20 3120 7072 6f63 6573 7369  tinel 1 processi
-000066a0: 6e67 0d0a 2320 4164 6170 7465 6420 6672  ng..# Adapted fr
-000066b0: 6f6d 3a20 6874 7470 733a 2f2f 636f 6465  om: https://code
-000066c0: 2e65 6172 7468 656e 6769 6e65 2e67 6f6f  .earthengine.goo
-000066d0: 676c 652e 636f 6d2f 3339 6133 6164 3561  gle.com/39a3ad5a
-000066e0: 6335 3963 6438 6166 3134 6533 6462 6437  c59cd8af14e3dbd7
-000066f0: 3834 3336 6432 6235 0d0a 2320 4175 7468  8436d2b5..# Auth
-00006700: 6f72 3a20 5761 7272 656e 2053 636f 7474  or: Warren Scott
-00006710: 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d  ....#-----------
-00006720: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006730: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2044 4546  ------------ DEF
-00006740: 494e 4520 5350 4543 4b4c 4546 554e 4354  INE SPECKLEFUNCT
-00006750: 494f 4e2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ION-------------
-00006760: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006770: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006780: 2d2d 2d2d 2d2d 2a2f 0d0a 0d0a 2320 5369  ------*/....# Si
-00006790: 676d 6120 4c65 6520 6669 6c74 6572 0d0a  gma Lee filter..
-000067a0: 6465 6620 746f 4e61 7475 7261 6c28 696d  def toNatural(im
-000067b0: 6729 3a0d 0a20 2072 6574 7572 6e20 6565  g):..  return ee
-000067c0: 2e49 6d61 6765 2831 302e 3029 2e70 6f77  .Image(10.0).pow
-000067d0: 2869 6d67 2e73 656c 6563 7428 3029 2e64  (img.select(0).d
-000067e0: 6976 6964 6528 3130 2e30 2929 0d0a 6465  ivide(10.0))..de
-000067f0: 6620 746f 4442 2869 6d67 293a 0d0a 2020  f toDB(img):..  
-00006800: 7265 7475 726e 2065 652e 496d 6167 6528  return ee.Image(
-00006810: 696d 6729 2e6c 6f67 3130 2829 2e6d 756c  img).log10().mul
-00006820: 7469 706c 7928 3130 2e30 290d 0a0d 0a0d  tiply(10.0).....
-00006830: 0a23 2054 6865 2052 4c20 7370 6563 6b6c  .# The RL speckl
-00006840: 6520 6669 6c74 6572 2066 726f 6d20 6874  e filter from ht
-00006850: 7470 733a 2f2f 636f 6465 2e65 6172 7468  tps://code.earth
-00006860: 656e 6769 6e65 2e67 6f6f 676c 652e 636f  engine.google.co
-00006870: 6d2f 3265 6633 3834 3633 6562 6166 3561  m/2ef38463ebaf5a
-00006880: 6531 3333 6134 3738 6631 3733 6664 3061  e133a478f173fd0a
-00006890: 6235 2062 7920 4775 6964 6f20 4c65 6d6f  b5 by Guido Lemo
-000068a0: 696e 650d 0a23 2041 7320 636f 6465 6420  ine..# As coded 
-000068b0: 696e 2074 6865 2053 4e41 5020 332e 3020  in the SNAP 3.0 
-000068c0: 5331 5442 583a 0d0a 6465 6620 5265 6669  S1TBX:..def Refi
-000068d0: 6e65 644c 6565 2869 6d67 293a 200d 0a20  nedLee(img): .. 
-000068e0: 2023 2069 6d67 206d 7573 7420 6265 2069   # img must be i
-000068f0: 6e20 6e61 7475 7261 6c20 756e 6974 732c  n natural units,
-00006900: 2069 2e65 2e20 6e6f 7420 696e 2064 4221   i.e. not in dB!
-00006910: 0d0a 2020 2320 5365 7420 7570 2033 7833  ..  # Set up 3x3
-00006920: 206b 6572 6e65 6c73 200d 0a20 2077 6569   kernels ..  wei
-00006930: 6768 7473 3320 3d20 6565 2e4c 6973 742e  ghts3 = ee.List.
-00006940: 7265 7065 6174 2865 652e 4c69 7374 2e72  repeat(ee.List.r
-00006950: 6570 6561 7428 312c 3329 2c33 290d 0a20  epeat(1,3),3).. 
-00006960: 206b 6572 6e65 6c33 203d 2065 652e 4b65   kernel3 = ee.Ke
-00006970: 726e 656c 2e66 6978 6564 2833 2c33 2c20  rnel.fixed(3,3, 
-00006980: 7765 6967 6874 7333 2c20 312c 2031 2c20  weights3, 1, 1, 
-00006990: 4661 6c73 6529 0d0a 0d0a 2020 6d65 616e  False)....  mean
-000069a0: 3320 3d20 696d 672e 7265 6475 6365 4e65  3 = img.reduceNe
-000069b0: 6967 6862 6f72 686f 6f64 2865 652e 5265  ighborhood(ee.Re
-000069c0: 6475 6365 722e 6d65 616e 2829 2c20 6b65  ducer.mean(), ke
-000069d0: 726e 656c 3329 0d0a 2020 7661 7269 616e  rnel3)..  varian
-000069e0: 6365 3320 3d20 696d 672e 7265 6475 6365  ce3 = img.reduce
-000069f0: 4e65 6967 6862 6f72 686f 6f64 2865 652e  Neighborhood(ee.
-00006a00: 5265 6475 6365 722e 7661 7269 616e 6365  Reducer.variance
-00006a10: 2829 2c20 6b65 726e 656c 3329 0d0a 0d0a  (), kernel3)....
-00006a20: 2020 2320 5573 6520 6120 7361 6d70 6c65    # Use a sample
-00006a30: 206f 6620 7468 6520 3378 3320 7769 6e64   of the 3x3 wind
-00006a40: 6f77 7320 696e 7369 6465 2061 2037 7837  ows inside a 7x7
-00006a50: 2077 696e 646f 7773 2074 6f20 6465 7465   windows to dete
-00006a60: 726d 696e 6520 6772 6164 6965 6e74 7320  rmine gradients 
-00006a70: 616e 6420 6469 7265 6374 696f 6e73 0d0a  and directions..
-00006a80: 2020 7361 6d70 6c65 5f77 6569 6768 7473    sample_weights
-00006a90: 203d 2065 652e 4c69 7374 285b 5b30 2c30   = ee.List([[0,0
-00006aa0: 2c30 2c30 2c30 2c30 2c30 5d2c 205b 302c  ,0,0,0,0,0], [0,
-00006ab0: 312c 302c 312c 302c 312c 305d 2c5b 302c  1,0,1,0,1,0],[0,
-00006ac0: 302c 302c 302c 302c 302c 305d 2c20 0d0a  0,0,0,0,0,0], ..
-00006ad0: 2020 2020 5b30 2c31 2c30 2c31 2c30 2c31      [0,1,0,1,0,1
-00006ae0: 2c30 5d2c 205b 302c 302c 302c 302c 302c  ,0], [0,0,0,0,0,
-00006af0: 302c 305d 2c20 5b30 2c31 2c30 2c31 2c30  0,0], [0,1,0,1,0
-00006b00: 2c31 2c30 5d2c 5b30 2c30 2c30 2c30 2c30  ,1,0],[0,0,0,0,0
-00006b10: 2c30 2c30 5d5d 290d 0a0d 0a20 2073 616d  ,0,0]])....  sam
-00006b20: 706c 655f 6b65 726e 656c 203d 2065 652e  ple_kernel = ee.
-00006b30: 4b65 726e 656c 2e66 6978 6564 2837 2c37  Kernel.fixed(7,7
-00006b40: 2c20 7361 6d70 6c65 5f77 6569 6768 7473  , sample_weights
-00006b50: 2c20 332c 332c 2046 616c 7365 290d 0a0d  , 3,3, False)...
-00006b60: 0a20 2023 2043 616c 6375 6c61 7465 206d  .  # Calculate m
-00006b70: 6561 6e20 616e 6420 7661 7269 616e 6365  ean and variance
-00006b80: 2066 6f72 2074 6865 2073 616d 706c 6564   for the sampled
-00006b90: 2077 696e 646f 7773 2061 6e64 2073 746f   windows and sto
-00006ba0: 7265 2061 7320 3920 6261 6e64 730d 0a20  re as 9 bands.. 
-00006bb0: 2073 616d 706c 655f 6d65 616e 203d 206d   sample_mean = m
-00006bc0: 6561 6e33 2e6e 6569 6768 626f 7268 6f6f  ean3.neighborhoo
-00006bd0: 6454 6f42 616e 6473 2873 616d 706c 655f  dToBands(sample_
-00006be0: 6b65 726e 656c 290d 0a20 2073 616d 706c  kernel)..  sampl
-00006bf0: 655f 7661 7220 3d20 7661 7269 616e 6365  e_var = variance
-00006c00: 332e 6e65 6967 6862 6f72 686f 6f64 546f  3.neighborhoodTo
-00006c10: 4261 6e64 7328 7361 6d70 6c65 5f6b 6572  Bands(sample_ker
-00006c20: 6e65 6c29 0d0a 0d0a 2020 2320 4465 7465  nel)....  # Dete
-00006c30: 726d 696e 6520 7468 6520 3420 6772 6164  rmine the 4 grad
-00006c40: 6965 6e74 7320 666f 7220 7468 6520 7361  ients for the sa
-00006c50: 6d70 6c65 6420 7769 6e64 6f77 730d 0a20  mpled windows.. 
-00006c60: 2067 7261 6469 656e 7473 203d 2073 616d   gradients = sam
-00006c70: 706c 655f 6d65 616e 2e73 656c 6563 7428  ple_mean.select(
-00006c80: 3129 2e73 7562 7472 6163 7428 7361 6d70  1).subtract(samp
-00006c90: 6c65 5f6d 6561 6e2e 7365 6c65 6374 2837  le_mean.select(7
-00006ca0: 2929 2e61 6273 2829 0d0a 2020 6772 6164  )).abs()..  grad
-00006cb0: 6965 6e74 7320 3d20 6772 6164 6965 6e74  ients = gradient
-00006cc0: 732e 6164 6442 616e 6473 2873 616d 706c  s.addBands(sampl
-00006cd0: 655f 6d65 616e 2e73 656c 6563 7428 3629  e_mean.select(6)
-00006ce0: 2e73 7562 7472 6163 7428 7361 6d70 6c65  .subtract(sample
-00006cf0: 5f6d 6561 6e2e 7365 6c65 6374 2832 2929  _mean.select(2))
-00006d00: 2e61 6273 2829 290d 0a20 2067 7261 6469  .abs())..  gradi
-00006d10: 656e 7473 203d 2067 7261 6469 656e 7473  ents = gradients
-00006d20: 2e61 6464 4261 6e64 7328 7361 6d70 6c65  .addBands(sample
-00006d30: 5f6d 6561 6e2e 7365 6c65 6374 2833 292e  _mean.select(3).
-00006d40: 7375 6274 7261 6374 2873 616d 706c 655f  subtract(sample_
-00006d50: 6d65 616e 2e73 656c 6563 7428 3529 292e  mean.select(5)).
-00006d60: 6162 7328 2929 0d0a 2020 6772 6164 6965  abs())..  gradie
-00006d70: 6e74 7320 3d20 6772 6164 6965 6e74 732e  nts = gradients.
-00006d80: 6164 6442 616e 6473 2873 616d 706c 655f  addBands(sample_
-00006d90: 6d65 616e 2e73 656c 6563 7428 3029 2e73  mean.select(0).s
-00006da0: 7562 7472 6163 7428 7361 6d70 6c65 5f6d  ubtract(sample_m
-00006db0: 6561 6e2e 7365 6c65 6374 2838 2929 2e61  ean.select(8)).a
-00006dc0: 6273 2829 290d 0a0d 0a20 2023 2041 6e64  bs())....  # And
-00006dd0: 2066 696e 6420 7468 6520 6d61 7869 6d75   find the maximu
-00006de0: 6d20 6772 6164 6965 6e74 2061 6d6f 6e67  m gradient among
-00006df0: 7374 2067 7261 6469 656e 7420 6261 6e64  st gradient band
-00006e00: 730d 0a20 206d 6178 5f67 7261 6469 656e  s..  max_gradien
-00006e10: 7420 3d20 6772 6164 6965 6e74 732e 7265  t = gradients.re
-00006e20: 6475 6365 2865 652e 5265 6475 6365 722e  duce(ee.Reducer.
-00006e30: 6d61 7828 2929 0d0a 0d0a 2020 2320 4372  max())....  # Cr
-00006e40: 6561 7465 2061 206d 6173 6b20 666f 7220  eate a mask for 
-00006e50: 6261 6e64 2070 6978 656c 7320 7468 6174  band pixels that
-00006e60: 2061 7265 2074 6865 206d 6178 696d 756d   are the maximum
-00006e70: 2067 7261 6469 656e 740d 0a20 2067 7261   gradient..  gra
-00006e80: 646d 6173 6b20 3d20 6772 6164 6965 6e74  dmask = gradient
-00006e90: 732e 6571 286d 6178 5f67 7261 6469 656e  s.eq(max_gradien
-00006ea0: 7429 0d0a 0d0a 2020 2320 6475 706c 6963  t)....  # duplic
-00006eb0: 6174 6520 6772 6164 6d61 736b 2062 616e  ate gradmask ban
-00006ec0: 6473 3a20 6561 6368 2067 7261 6469 656e  ds: each gradien
-00006ed0: 7420 7265 7072 6573 656e 7473 2032 2064  t represents 2 d
-00006ee0: 6972 6563 7469 6f6e 730d 0a20 2067 7261  irections..  gra
-00006ef0: 646d 6173 6b20 3d20 6772 6164 6d61 736b  dmask = gradmask
-00006f00: 2e61 6464 4261 6e64 7328 6772 6164 6d61  .addBands(gradma
-00006f10: 736b 290d 0a0d 0a20 2023 2044 6574 6572  sk)....  # Deter
-00006f20: 6d69 6e65 2074 6865 2038 2064 6972 6563  mine the 8 direc
-00006f30: 7469 6f6e 730d 0a20 2064 6972 6563 7469  tions..  directi
-00006f40: 6f6e 7320 3d20 7361 6d70 6c65 5f6d 6561  ons = sample_mea
-00006f50: 6e2e 7365 6c65 6374 2831 292e 7375 6274  n.select(1).subt
-00006f60: 7261 6374 2873 616d 706c 655f 6d65 616e  ract(sample_mean
-00006f70: 2e73 656c 6563 7428 3429 295c 0d0a 2020  .select(4))\..  
-00006f80: 2020 2e67 7428 7361 6d70 6c65 5f6d 6561    .gt(sample_mea
-00006f90: 6e2e 7365 6c65 6374 2834 292e 7375 6274  n.select(4).subt
-00006fa0: 7261 6374 2873 616d 706c 655f 6d65 616e  ract(sample_mean
-00006fb0: 2e73 656c 6563 7428 3729 2929 2e6d 756c  .select(7))).mul
-00006fc0: 7469 706c 7928 3129 0d0a 2020 6469 7265  tiply(1)..  dire
-00006fd0: 6374 696f 6e73 203d 2064 6972 6563 7469  ctions = directi
-00006fe0: 6f6e 732e 6164 6442 616e 6473 2873 616d  ons.addBands(sam
-00006ff0: 706c 655f 6d65 616e 2e73 656c 6563 7428  ple_mean.select(
-00007000: 3629 2e73 7562 7472 6163 7428 7361 6d70  6).subtract(samp
-00007010: 6c65 5f6d 6561 6e2e 7365 6c65 6374 2834  le_mean.select(4
-00007020: 2929 5c0d 0a20 2020 202e 6774 2873 616d  ))\..    .gt(sam
-00007030: 706c 655f 6d65 616e 2e73 656c 6563 7428  ple_mean.select(
-00007040: 3429 2e73 7562 7472 6163 7428 7361 6d70  4).subtract(samp
-00007050: 6c65 5f6d 6561 6e2e 7365 6c65 6374 2832  le_mean.select(2
-00007060: 2929 292e 6d75 6c74 6970 6c79 2832 2929  ))).multiply(2))
-00007070: 0d0a 2020 6469 7265 6374 696f 6e73 203d  ..  directions =
-00007080: 2064 6972 6563 7469 6f6e 732e 6164 6442   directions.addB
-00007090: 616e 6473 2873 616d 706c 655f 6d65 616e  ands(sample_mean
-000070a0: 2e73 656c 6563 7428 3329 2e73 7562 7472  .select(3).subtr
-000070b0: 6163 7428 7361 6d70 6c65 5f6d 6561 6e2e  act(sample_mean.
-000070c0: 7365 6c65 6374 2834 2929 5c0d 0a20 2020  select(4))\..   
-000070d0: 202e 6774 2873 616d 706c 655f 6d65 616e   .gt(sample_mean
-000070e0: 2e73 656c 6563 7428 3429 2e73 7562 7472  .select(4).subtr
-000070f0: 6163 7428 7361 6d70 6c65 5f6d 6561 6e2e  act(sample_mean.
-00007100: 7365 6c65 6374 2835 2929 292e 6d75 6c74  select(5))).mult
-00007110: 6970 6c79 2833 2929 0d0a 2020 6469 7265  iply(3))..  dire
-00007120: 6374 696f 6e73 203d 2064 6972 6563 7469  ctions = directi
-00007130: 6f6e 732e 6164 6442 616e 6473 2873 616d  ons.addBands(sam
-00007140: 706c 655f 6d65 616e 2e73 656c 6563 7428  ple_mean.select(
-00007150: 3029 2e73 7562 7472 6163 7428 7361 6d70  0).subtract(samp
-00007160: 6c65 5f6d 6561 6e2e 7365 6c65 6374 2834  le_mean.select(4
-00007170: 2929 5c0d 0a20 2020 202e 6774 2873 616d  ))\..    .gt(sam
-00007180: 706c 655f 6d65 616e 2e73 656c 6563 7428  ple_mean.select(
-00007190: 3429 2e73 7562 7472 6163 7428 7361 6d70  4).subtract(samp
-000071a0: 6c65 5f6d 6561 6e2e 7365 6c65 6374 2838  le_mean.select(8
-000071b0: 2929 292e 6d75 6c74 6970 6c79 2834 2929  ))).multiply(4))
-000071c0: 0d0a 2020 2020 0d0a 2020 2320 5468 6520  ..    ..  # The 
-000071d0: 6e65 7874 2034 2061 7265 2074 6865 206e  next 4 are the n
-000071e0: 6f74 2829 206f 6620 7468 6520 7072 6576  ot() of the prev
-000071f0: 696f 7573 2034 0d0a 2020 6469 7265 6374  ious 4..  direct
-00007200: 696f 6e73 203d 2064 6972 6563 7469 6f6e  ions = direction
-00007210: 732e 6164 6442 616e 6473 2864 6972 6563  s.addBands(direc
-00007220: 7469 6f6e 732e 7365 6c65 6374 2830 292e  tions.select(0).
-00007230: 4e6f 7428 292e 6d75 6c74 6970 6c79 2835  Not().multiply(5
-00007240: 2929 0d0a 2020 6469 7265 6374 696f 6e73  ))..  directions
-00007250: 203d 2064 6972 6563 7469 6f6e 732e 6164   = directions.ad
-00007260: 6442 616e 6473 2864 6972 6563 7469 6f6e  dBands(direction
-00007270: 732e 7365 6c65 6374 2831 292e 4e6f 7428  s.select(1).Not(
-00007280: 292e 6d75 6c74 6970 6c79 2836 2929 0d0a  ).multiply(6))..
-00007290: 2020 6469 7265 6374 696f 6e73 203d 2064    directions = d
-000072a0: 6972 6563 7469 6f6e 732e 6164 6442 616e  irections.addBan
-000072b0: 6473 2864 6972 6563 7469 6f6e 732e 7365  ds(directions.se
-000072c0: 6c65 6374 2832 292e 4e6f 7428 292e 6d75  lect(2).Not().mu
-000072d0: 6c74 6970 6c79 2837 2929 0d0a 2020 6469  ltiply(7))..  di
-000072e0: 7265 6374 696f 6e73 203d 2064 6972 6563  rections = direc
-000072f0: 7469 6f6e 732e 6164 6442 616e 6473 2864  tions.addBands(d
-00007300: 6972 6563 7469 6f6e 732e 7365 6c65 6374  irections.select
-00007310: 2833 292e 4e6f 7428 292e 6d75 6c74 6970  (3).Not().multip
-00007320: 6c79 2838 2929 0d0a 0d0a 2020 2320 4d61  ly(8))....  # Ma
-00007330: 736b 2061 6c6c 2076 616c 7565 7320 7468  sk all values th
-00007340: 6174 2061 7265 206e 6f74 2031 2d38 0d0a  at are not 1-8..
-00007350: 2020 6469 7265 6374 696f 6e73 203d 2064    directions = d
-00007360: 6972 6563 7469 6f6e 732e 7570 6461 7465  irections.update
-00007370: 4d61 736b 2867 7261 646d 6173 6b29 0d0a  Mask(gradmask)..
-00007380: 0d0a 2020 2320 2263 6f6c 6c61 7073 6522  ..  # "collapse"
-00007390: 2074 6865 2073 7461 636b 2069 6e74 6f20   the stack into 
-000073a0: 6120 7369 6e67 6520 6261 6e64 2069 6d61  a singe band ima
-000073b0: 6765 2028 6475 6520 746f 206d 6173 6b69  ge (due to maski
-000073c0: 6e67 2c20 6561 6368 2070 6978 656c 2068  ng, each pixel h
-000073d0: 6173 206a 7573 7420 6f6e 6520 7661 6c75  as just one valu
-000073e0: 6520 2831 2d38 2920 696e 2069 7427 7320  e (1-8) in it's 
-000073f0: 6469 7265 6374 696f 6e61 6c20 6261 6e64  directional band
-00007400: 2c20 616e 6420 6973 206f 7468 6572 7769  , and is otherwi
-00007410: 7365 206d 6173 6b65 6429 0d0a 2020 6469  se masked)..  di
-00007420: 7265 6374 696f 6e73 203d 2064 6972 6563  rections = direc
-00007430: 7469 6f6e 732e 7265 6475 6365 2865 652e  tions.reduce(ee.
-00007440: 5265 6475 6365 722e 7375 6d28 2929 2020  Reducer.sum())  
-00007450: 0d0a 0d0a 2020 2320 7661 7220 7061 6c20  ....  # var pal 
-00007460: 3d20 5b27 6666 6666 6666 272c 2766 6630  = ['ffffff','ff0
-00007470: 3030 3027 2c27 6666 6666 3030 272c 2027  000','ffff00', '
-00007480: 3030 6666 3030 272c 2027 3030 6666 6666  00ff00', '00ffff
-00007490: 272c 2027 3030 3030 6666 272c 2027 6666  ', '0000ff', 'ff
-000074a0: 3030 6666 272c 2027 3030 3030 3030 275d  00ff', '000000']
-000074b0: 3b0d 0a20 2023 204d 6170 2e61 6464 4c61  ;..  # Map.addLa
-000074c0: 7965 7228 6469 7265 6374 696f 6e73 2e72  yer(directions.r
-000074d0: 6564 7563 6528 6565 2e52 6564 7563 6572  educe(ee.Reducer
-000074e0: 2e73 756d 2829 292c 207b 6d69 6e3a 312c  .sum()), {min:1,
-000074f0: 206d 6178 3a38 2c20 7061 6c65 7474 653a   max:8, palette:
-00007500: 2070 616c 7d2c 2027 4469 7265 6374 696f   pal}, 'Directio
-00007510: 6e73 272c 2066 616c 7365 293b 0d0a 0d0a  ns', false);....
-00007520: 2020 7361 6d70 6c65 5f73 7461 7473 203d    sample_stats =
-00007530: 2073 616d 706c 655f 7661 722e 6469 7669   sample_var.divi
-00007540: 6465 2873 616d 706c 655f 6d65 616e 2e6d  de(sample_mean.m
-00007550: 756c 7469 706c 7928 7361 6d70 6c65 5f6d  ultiply(sample_m
-00007560: 6561 6e29 290d 0a0d 0a20 2023 2043 616c  ean))....  # Cal
-00007570: 6375 6c61 7465 206c 6f63 616c 4e6f 6973  culate localNois
-00007580: 6556 6172 6961 6e63 650d 0a20 2073 6967  eVariance..  sig
-00007590: 6d61 5620 3d20 7361 6d70 6c65 5f73 7461  maV = sample_sta
-000075a0: 7473 2e74 6f41 7272 6179 2829 2e61 7272  ts.toArray().arr
-000075b0: 6179 536f 7274 2829 2e61 7272 6179 536c  aySort().arraySl
-000075c0: 6963 6528 302c 302c 3529 2e61 7272 6179  ice(0,0,5).array
-000075d0: 5265 6475 6365 2865 652e 5265 6475 6365  Reduce(ee.Reduce
-000075e0: 722e 6d65 616e 2829 2c20 5b30 5d29 0d0a  r.mean(), [0])..
-000075f0: 0d0a 2020 2320 5365 7420 7570 2074 6865  ..  # Set up the
-00007600: 2037 2a37 206b 6572 6e65 6c73 2066 6f72   7*7 kernels for
-00007610: 2064 6972 6563 7469 6f6e 616c 2073 7461   directional sta
-00007620: 7469 7374 6963 730d 0a20 2072 6563 745f  tistics..  rect_
-00007630: 7765 6967 6874 7320 3d20 6565 2e4c 6973  weights = ee.Lis
-00007640: 742e 7265 7065 6174 2865 652e 4c69 7374  t.repeat(ee.List
-00007650: 2e72 6570 6561 7428 302c 3729 2c33 292e  .repeat(0,7),3).
-00007660: 6361 7428 6565 2e4c 6973 742e 7265 7065  cat(ee.List.repe
-00007670: 6174 2865 652e 4c69 7374 2e72 6570 6561  at(ee.List.repea
-00007680: 7428 312c 3729 2c34 2929 0d0a 0d0a 2020  t(1,7),4))....  
-00007690: 6469 6167 5f77 6569 6768 7473 203d 2065  diag_weights = e
-000076a0: 652e 4c69 7374 285b 5b31 2c30 2c30 2c30  e.List([[1,0,0,0
-000076b0: 2c30 2c30 2c30 5d2c 205b 312c 312c 302c  ,0,0,0], [1,1,0,
-000076c0: 302c 302c 302c 305d 2c20 5b31 2c31 2c31  0,0,0,0], [1,1,1
-000076d0: 2c30 2c30 2c30 2c30 5d2c 5b31 2c31 2c31  ,0,0,0,0],[1,1,1
-000076e0: 2c31 2c30 2c30 2c30 5d2c 205b 312c 312c  ,1,0,0,0], [1,1,
-000076f0: 312c 312c 312c 302c 305d 2c20 5b31 2c31  1,1,1,0,0], [1,1
-00007700: 2c31 2c31 2c31 2c31 2c30 5d2c 205b 312c  ,1,1,1,1,0], [1,
-00007710: 312c 312c 312c 312c 312c 315d 5d29 0d0a  1,1,1,1,1,1]])..
-00007720: 0d0a 2020 7265 6374 5f6b 6572 6e65 6c20  ..  rect_kernel 
-00007730: 3d20 6565 2e4b 6572 6e65 6c2e 6669 7865  = ee.Kernel.fixe
-00007740: 6428 372c 372c 2072 6563 745f 7765 6967  d(7,7, rect_weig
-00007750: 6874 732c 2033 2c20 332c 2046 616c 7365  hts, 3, 3, False
-00007760: 290d 0a20 2064 6961 675f 6b65 726e 656c  )..  diag_kernel
-00007770: 203d 2065 652e 4b65 726e 656c 2e66 6978   = ee.Kernel.fix
-00007780: 6564 2837 2c37 2c20 6469 6167 5f77 6569  ed(7,7, diag_wei
-00007790: 6768 7473 2c20 332c 2033 2c20 4661 6c73  ghts, 3, 3, Fals
-000077a0: 6529 0d0a 0d0a 2020 2320 4372 6561 7465  e)....  # Create
-000077b0: 2073 7461 636b 7320 666f 7220 6d65 616e   stacks for mean
-000077c0: 2061 6e64 2076 6172 6961 6e63 6520 7573   and variance us
-000077d0: 696e 6720 7468 6520 6f72 6967 696e 616c  ing the original
-000077e0: 206b 6572 6e65 6c73 2e20 4d61 736b 2077   kernels. Mask w
-000077f0: 6974 6820 7265 6c65 7661 6e74 2064 6972  ith relevant dir
-00007800: 6563 7469 6f6e 2e0d 0a20 2064 6972 5f6d  ection...  dir_m
-00007810: 6561 6e20 3d20 696d 672e 7265 6475 6365  ean = img.reduce
-00007820: 4e65 6967 6862 6f72 686f 6f64 2865 652e  Neighborhood(ee.
-00007830: 5265 6475 6365 722e 6d65 616e 2829 2c20  Reducer.mean(), 
-00007840: 7265 6374 5f6b 6572 6e65 6c29 2e75 7064  rect_kernel).upd
-00007850: 6174 654d 6173 6b28 6469 7265 6374 696f  ateMask(directio
-00007860: 6e73 2e65 7128 3129 290d 0a20 2064 6972  ns.eq(1))..  dir
-00007870: 5f76 6172 203d 2069 6d67 2e72 6564 7563  _var = img.reduc
-00007880: 654e 6569 6768 626f 7268 6f6f 6428 6565  eNeighborhood(ee
-00007890: 2e52 6564 7563 6572 2e76 6172 6961 6e63  .Reducer.varianc
-000078a0: 6528 292c 2072 6563 745f 6b65 726e 656c  e(), rect_kernel
-000078b0: 292e 7570 6461 7465 4d61 736b 2864 6972  ).updateMask(dir
-000078c0: 6563 7469 6f6e 732e 6571 2831 2929 0d0a  ections.eq(1))..
-000078d0: 0d0a 2020 6469 725f 6d65 616e 203d 2064  ..  dir_mean = d
-000078e0: 6972 5f6d 6561 6e2e 6164 6442 616e 6473  ir_mean.addBands
-000078f0: 2869 6d67 2e72 6564 7563 654e 6569 6768  (img.reduceNeigh
-00007900: 626f 7268 6f6f 6428 6565 2e52 6564 7563  borhood(ee.Reduc
-00007910: 6572 2e6d 6561 6e28 292c 2064 6961 675f  er.mean(), diag_
-00007920: 6b65 726e 656c 292e 7570 6461 7465 4d61  kernel).updateMa
-00007930: 736b 2864 6972 6563 7469 6f6e 732e 6571  sk(directions.eq
-00007940: 2832 2929 290d 0a20 2064 6972 5f76 6172  (2)))..  dir_var
-00007950: 203d 2064 6972 5f76 6172 2e61 6464 4261   = dir_var.addBa
-00007960: 6e64 7328 696d 672e 7265 6475 6365 4e65  nds(img.reduceNe
-00007970: 6967 6862 6f72 686f 6f64 2865 652e 5265  ighborhood(ee.Re
-00007980: 6475 6365 722e 7661 7269 616e 6365 2829  ducer.variance()
-00007990: 2c20 6469 6167 5f6b 6572 6e65 6c29 2e75  , diag_kernel).u
-000079a0: 7064 6174 654d 6173 6b28 6469 7265 6374  pdateMask(direct
-000079b0: 696f 6e73 2e65 7128 3229 2929 0d0a 0d0a  ions.eq(2)))....
-000079c0: 2020 2320 616e 6420 6164 6420 7468 6520    # and add the 
-000079d0: 6261 6e64 7320 666f 7220 726f 7461 7465  bands for rotate
-000079e0: 6420 6b65 726e 656c 730d 0a20 2066 6f72  d kernels..  for
-000079f0: 2069 2069 6e20 7261 6e67 6528 312c 3429   i in range(1,4)
-00007a00: 3a0d 0a20 2020 2064 6972 5f6d 6561 6e20  :..    dir_mean 
-00007a10: 3d20 6469 725f 6d65 616e 2e61 6464 4261  = dir_mean.addBa
-00007a20: 6e64 7328 696d 672e 7265 6475 6365 4e65  nds(img.reduceNe
-00007a30: 6967 6862 6f72 686f 6f64 2865 652e 5265  ighborhood(ee.Re
-00007a40: 6475 6365 722e 6d65 616e 2829 2c20 7265  ducer.mean(), re
-00007a50: 6374 5f6b 6572 6e65 6c2e 726f 7461 7465  ct_kernel.rotate
-00007a60: 2869 2929 2e75 7064 6174 654d 6173 6b28  (i)).updateMask(
-00007a70: 6469 7265 6374 696f 6e73 2e65 7128 322a  directions.eq(2*
-00007a80: 692b 3129 2929 0d0a 2020 2020 6469 725f  i+1)))..    dir_
-00007a90: 7661 7220 3d20 6469 725f 7661 722e 6164  var = dir_var.ad
-00007aa0: 6442 616e 6473 2869 6d67 2e72 6564 7563  dBands(img.reduc
-00007ab0: 654e 6569 6768 626f 7268 6f6f 6428 6565  eNeighborhood(ee
-00007ac0: 2e52 6564 7563 6572 2e76 6172 6961 6e63  .Reducer.varianc
-00007ad0: 6528 292c 2072 6563 745f 6b65 726e 656c  e(), rect_kernel
-00007ae0: 2e72 6f74 6174 6528 6929 292e 7570 6461  .rotate(i)).upda
-00007af0: 7465 4d61 736b 2864 6972 6563 7469 6f6e  teMask(direction
-00007b00: 732e 6571 2832 2a69 2b31 2929 290d 0a20  s.eq(2*i+1))).. 
-00007b10: 2020 2064 6972 5f6d 6561 6e20 3d20 6469     dir_mean = di
-00007b20: 725f 6d65 616e 2e61 6464 4261 6e64 7328  r_mean.addBands(
-00007b30: 696d 672e 7265 6475 6365 4e65 6967 6862  img.reduceNeighb
-00007b40: 6f72 686f 6f64 2865 652e 5265 6475 6365  orhood(ee.Reduce
-00007b50: 722e 6d65 616e 2829 2c20 6469 6167 5f6b  r.mean(), diag_k
-00007b60: 6572 6e65 6c2e 726f 7461 7465 2869 2929  ernel.rotate(i))
-00007b70: 2e75 7064 6174 654d 6173 6b28 6469 7265  .updateMask(dire
-00007b80: 6374 696f 6e73 2e65 7128 322a 692b 3229  ctions.eq(2*i+2)
-00007b90: 2929 0d0a 2020 2020 6469 725f 7661 7220  ))..    dir_var 
-00007ba0: 3d20 6469 725f 7661 722e 6164 6442 616e  = dir_var.addBan
-00007bb0: 6473 2869 6d67 2e72 6564 7563 654e 6569  ds(img.reduceNei
-00007bc0: 6768 626f 7268 6f6f 6428 6565 2e52 6564  ghborhood(ee.Red
-00007bd0: 7563 6572 2e76 6172 6961 6e63 6528 292c  ucer.variance(),
-00007be0: 2064 6961 675f 6b65 726e 656c 2e72 6f74   diag_kernel.rot
-00007bf0: 6174 6528 6929 292e 7570 6461 7465 4d61  ate(i)).updateMa
-00007c00: 736b 2864 6972 6563 7469 6f6e 732e 6571  sk(directions.eq
-00007c10: 2832 2a69 2b32 2929 290d 0a20 200d 0a0d  (2*i+2)))..  ...
-00007c20: 0a20 2023 2022 636f 6c6c 6170 7365 2220  .  # "collapse" 
-00007c30: 7468 6520 7374 6163 6b20 696e 746f 2061  the stack into a
-00007c40: 2073 696e 676c 6520 6261 6e64 2069 6d61   single band ima
-00007c50: 6765 2028 6475 6520 746f 206d 6173 6b69  ge (due to maski
-00007c60: 6e67 2c20 6561 6368 2070 6978 656c 2068  ng, each pixel h
-00007c70: 6173 206a 7573 7420 6f6e 6520 7661 6c75  as just one valu
-00007c80: 6520 696e 2069 7427 7320 6469 7265 6374  e in it's direct
-00007c90: 696f 6e61 6c20 6261 6e64 2c20 616e 6420  ional band, and 
-00007ca0: 6973 206f 7468 6572 7769 7365 206d 6173  is otherwise mas
-00007cb0: 6b65 6429 0d0a 2020 6469 725f 6d65 616e  ked)..  dir_mean
-00007cc0: 203d 2064 6972 5f6d 6561 6e2e 7265 6475   = dir_mean.redu
-00007cd0: 6365 2865 652e 5265 6475 6365 722e 7375  ce(ee.Reducer.su
-00007ce0: 6d28 2929 0d0a 2020 6469 725f 7661 7220  m())..  dir_var 
-00007cf0: 3d20 6469 725f 7661 722e 7265 6475 6365  = dir_var.reduce
-00007d00: 2865 652e 5265 6475 6365 722e 7375 6d28  (ee.Reducer.sum(
-00007d10: 2929 0d0a 0d0a 2020 2320 4120 6669 6e61  ))....  # A fina
-00007d20: 6c6c 7920 6765 6e65 7261 7465 2074 6865  lly generate the
-00007d30: 2066 696c 7465 7265 6420 7661 6c75 650d   filtered value.
-00007d40: 0a20 2076 6172 5820 3d20 6469 725f 7661  .  varX = dir_va
-00007d50: 722e 7375 6274 7261 6374 2864 6972 5f6d  r.subtract(dir_m
-00007d60: 6561 6e2e 6d75 6c74 6970 6c79 2864 6972  ean.multiply(dir
-00007d70: 5f6d 6561 6e29 2e6d 756c 7469 706c 7928  _mean).multiply(
-00007d80: 7369 676d 6156 2929 2e64 6976 6964 6528  sigmaV)).divide(
-00007d90: 7369 676d 6156 2e61 6464 2831 2e30 2929  sigmaV.add(1.0))
-00007da0: 0d0a 0d0a 2020 6220 3d20 7661 7258 2e64  ....  b = varX.d
-00007db0: 6976 6964 6528 6469 725f 7661 7229 0d0a  ivide(dir_var)..
-00007dc0: 0d0a 2020 7265 7375 6c74 203d 2064 6972  ..  result = dir
-00007dd0: 5f6d 6561 6e2e 6164 6428 622e 6d75 6c74  _mean.add(b.mult
-00007de0: 6970 6c79 2869 6d67 2e73 7562 7472 6163  iply(img.subtrac
-00007df0: 7428 6469 725f 6d65 616e 2929 290d 0a20  t(dir_mean))).. 
-00007e00: 2072 6574 7572 6e28 7265 7375 6c74 2e61   return(result.a
-00007e10: 7272 6179 466c 6174 7465 6e28 5b5b 2773  rrayFlatten([['s
-00007e20: 756d 275d 5d29 290d 0a0d 0a23 2323 2323  um']]))....#####
-00007e30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00007e40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00007e50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00007e60: 2323 2323 2323 2323 2323 230d 0a0d 0a23  ###########....#
-00007e70: 204c 6f61 6420 616e 6420 6669 6c74 6572   Load and filter
-00007e80: 2053 656e 7469 6e65 6c2d 3120 4752 4420   Sentinel-1 GRD 
-00007e90: 6461 7461 2062 7920 7072 6564 6566 696e  data by predefin
-00007ea0: 6564 2070 6172 616d 6574 6572 7320 0d0a  ed parameters ..
-00007eb0: 6465 6620 6765 7453 3128 7374 7564 7941  def getS1(studyA
-00007ec0: 7265 612c 7374 6172 7459 6561 722c 656e  rea,startYear,en
-00007ed0: 6459 6561 722c 7374 6172 744a 756c 6961  dYear,startJulia
-00007ee0: 6e2c 656e 644a 756c 6961 6e2c 706f 6c61  n,endJulian,pola
-00007ef0: 7269 7a61 7469 6f6e 203d 2022 5656 222c  rization = "VV",
-00007f00: 7061 7373 5f64 6972 6563 7469 6f6e 203d  pass_direction =
-00007f10: 2022 4153 4345 4e44 494e 4722 293a 0d0a   "ASCENDING"):..
-00007f20: 2020 636f 6c6c 6563 7469 6f6e 3d20 6565    collection= ee
-00007f30: 2e49 6d61 6765 436f 6c6c 6563 7469 6f6e  .ImageCollection
-00007f40: 2827 434f 5045 524e 4943 5553 2f53 315f  ('COPERNICUS/S1_
-00007f50: 4752 4427 295c 0d0a 2020 2e66 696c 7465  GRD')\..  .filte
-00007f60: 7228 6565 2e46 696c 7465 722e 6361 6c65  r(ee.Filter.cale
-00007f70: 6e64 6172 5261 6e67 6528 7374 6172 7459  ndarRange(startY
-00007f80: 6561 722c 656e 6459 6561 722c 2779 6561  ear,endYear,'yea
-00007f90: 7227 2929 5c0d 0a20 202e 6669 6c74 6572  r'))\..  .filter
-00007fa0: 2865 652e 4669 6c74 6572 2e63 616c 656e  (ee.Filter.calen
-00007fb0: 6461 7252 616e 6765 2873 7461 7274 4a75  darRange(startJu
-00007fc0: 6c69 616e 2c65 6e64 4a75 6c69 616e 2929  lian,endJulian))
-00007fd0: 5c0d 0a20 202e 6669 6c74 6572 2865 652e  \..  .filter(ee.
-00007fe0: 4669 6c74 6572 2e65 7128 2769 6e73 7472  Filter.eq('instr
-00007ff0: 756d 656e 744d 6f64 6527 2c27 4957 2729  umentMode','IW')
-00008000: 295c 0d0a 2020 2e66 696c 7465 7228 6565  )\..  .filter(ee
-00008010: 2e46 696c 7465 722e 6c69 7374 436f 6e74  .Filter.listCont
-00008020: 6169 6e73 2827 7472 616e 736d 6974 7465  ains('transmitte
-00008030: 7252 6563 6569 7665 7250 6f6c 6172 6973  rReceiverPolaris
-00008040: 6174 696f 6e27 2c20 706f 6c61 7269 7a61  ation', polariza
-00008050: 7469 6f6e 2929 5c0d 0a20 202e 6669 6c74  tion))\..  .filt
-00008060: 6572 2865 652e 4669 6c74 6572 2e65 7128  er(ee.Filter.eq(
-00008070: 276f 7262 6974 5072 6f70 6572 7469 6573  'orbitProperties
-00008080: 5f70 6173 7327 2c70 6173 735f 6469 7265  _pass',pass_dire
-00008090: 6374 696f 6e29 295c 0d0a 2020 2e66 696c  ction))\..  .fil
-000080a0: 7465 7228 6565 2e46 696c 7465 722e 6571  ter(ee.Filter.eq
-000080b0: 2827 7265 736f 6c75 7469 6f6e 5f6d 6574  ('resolution_met
-000080c0: 6572 7327 2c31 3029 295c 0d0a 2020 2e66  ers',10))\..  .f
-000080d0: 696c 7465 7242 6f75 6e64 7328 7374 7564  ilterBounds(stud
-000080e0: 7941 7265 6129 5c0d 0a20 202e 7365 6c65  yArea)\..  .sele
-000080f0: 6374 285b 706f 6c61 7269 7a61 7469 6f6e  ct([polarization
-00008100: 5d29 0d0a 0d0a 2020 7265 7475 726e 2063  ])....  return c
-00008110: 6f6c 6c65 6374 696f 6e0d 0a23 2323 2323  ollection..#####
-00008120: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00008130: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00008140: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00008150: 2323 2323 2323 2323 2323 230d 0a23 2046  ###########..# F
-00008160: 756e 6374 696f 6e20 746f 2067 6574 2053  unction to get S
-00008170: 656e 7469 6e65 6c20 3220 4120 616e 6420  entinel 2 A and 
-00008180: 4220 6461 7461 2069 6e74 6f20 6120 7369  B data into a si
-00008190: 6e67 6c65 2063 6f6c 6c65 6374 696f 6e20  ngle collection 
-000081a0: 7769 7468 206d 6561 6e69 6e67 6675 6c20  with meaningful 
-000081b0: 6261 6e64 206e 616d 6573 2066 6f72 2061  band names for a
-000081c0: 2073 7065 6369 6669 6564 2061 7265 6120   specified area 
-000081d0: 616e 6420 6461 7465 2072 616e 6765 0d0a  and date range..
-000081e0: 2320 5769 6c6c 2061 6c73 6f20 6a6f 696e  # Will also join
-000081f0: 2074 6865 2053 3220 636c 6f75 646c 6573   the S2 cloudles
-00008200: 7320 636c 6f75 6420 7072 6f62 6162 696c  s cloud probabil
-00008210: 6974 7920 636f 6c6c 6563 7469 6f6e 2069  ity collection i
-00008220: 6620 7370 6563 6966 6965 640d 0a64 6566  f specified..def
-00008230: 2067 6574 5332 2873 7475 6479 4172 6561   getS2(studyArea
-00008240: 2c0d 0a20 2020 2020 2020 2020 2073 7461  ,..          sta
-00008250: 7274 4461 7465 2c0d 0a20 2020 2020 2020  rtDate,..       
-00008260: 2020 2065 6e64 4461 7465 2c0d 0a20 2020     endDate,..   
-00008270: 2020 2020 2020 2073 7461 7274 4a75 6c69         startJuli
-00008280: 616e 2c0d 0a20 2020 2020 2020 2020 2065  an,..          e
-00008290: 6e64 4a75 6c69 616e 2c0d 0a20 2020 2020  ndJulian,..     
-000082a0: 2020 2020 2072 6573 616d 706c 654d 6574       resampleMet
-000082b0: 686f 6420 3d20 2761 6767 7265 6761 7465  hod = 'aggregate
-000082c0: 272c 0d0a 2020 2020 2020 2020 2020 746f  ',..          to
-000082d0: 614f 7253 5220 3d20 2754 4f41 272c 0d0a  aOrSR = 'TOA',..
-000082e0: 2020 2020 2020 2020 2020 636f 6e76 6572            conver
-000082f0: 7454 6f44 6169 6c79 4d6f 7361 6963 7320  tToDailyMosaics 
-00008300: 3d20 5472 7565 2c0d 0a20 2020 2020 2020  = True,..       
-00008310: 2020 2061 6464 436c 6f75 6450 726f 6261     addCloudProba
-00008320: 6269 6c69 7479 203d 2054 7275 6529 3a0d  bility = True):.
-00008330: 0a0d 0a20 2061 7267 7320 3d20 666f 726d  ...  args = form
-00008340: 6174 4172 6773 286c 6f63 616c 7328 2929  atArgs(locals())
-00008350: 0d0a 0d0a 2020 746f 614f 7253 5220 3d20  ....  toaOrSR = 
-00008360: 746f 614f 7253 522e 7570 7065 7228 290d  toaOrSR.upper().
-00008370: 0a0d 0a20 2023 2033 2f32 3220 2d20 4368  ...  # 3/22 - Ch
-00008380: 616e 6765 6420 746f 2075 7369 6e67 2074  anged to using t
-00008390: 6865 205f 4841 524d 4f4e 495a 4544 2063  he _HARMONIZED c
-000083a0: 6f6c 6c65 6374 696f 6e73 2066 6f6c 6c6f  ollections follo
-000083b0: 7769 6e67 2074 6865 2069 6e74 726f 6475  wing the introdu
-000083c0: 6374 696f 6e20 6f66 2061 2031 3030 3020  ction of a 1000 
-000083d0: 7661 6c75 6520 6f66 6673 6574 2066 726f  value offset fro
-000083e0: 6d20 4a61 6e20 3235 2032 3032 3220 6f6e  m Jan 25 2022 on
-000083f0: 7761 7264 0d0a 2020 2320 5468 6573 6520  ward..  # These 
-00008400: 636f 6c6c 6563 7469 6f6e 7320 6163 636f  collections acco
-00008410: 756e 7420 666f 7220 7468 6573 6520 6469  unt for these di
-00008420: 6666 6572 656e 6365 730d 0a20 2073 3243  fferences..  s2C
-00008430: 6f6c 6c65 6374 696f 6e44 6963 7420 3d20  ollectionDict = 
-00008440: 7b27 544f 4127 3a27 434f 5045 524e 4943  {'TOA':'COPERNIC
-00008450: 5553 2f53 325f 4841 524d 4f4e 495a 4544  US/S2_HARMONIZED
-00008460: 272c 2753 5227 3a27 434f 5045 524e 4943  ','SR':'COPERNIC
-00008470: 5553 2f53 325f 5352 5f48 4152 4d4f 4e49  US/S2_SR_HARMONI
-00008480: 5a45 4427 7d0d 0a0d 0a20 2073 656e 736f  ZED'}....  senso
-00008490: 7242 616e 6444 6963 7420 3d20 7b5c 0d0a  rBandDict = {\..
-000084a0: 2020 2020 2020 2753 5227 3a20 5b27 4231        'SR': ['B1
-000084b0: 272c 2742 3227 2c27 4233 272c 2742 3427  ','B2','B3','B4'
-000084c0: 2c27 4235 272c 2742 3627 2c27 4237 272c  ,'B5','B6','B7',
-000084d0: 2742 3827 2c27 4238 4127 2c20 2742 3927  'B8','B8A', 'B9'
-000084e0: 2c20 2742 3131 272c 2742 3132 275d 2c0d  , 'B11','B12'],.
-000084f0: 0a20 2020 2020 2027 544f 4127 3a20 5b27  .      'TOA': ['
-00008500: 4231 272c 2742 3227 2c27 4233 272c 2742  B1','B2','B3','B
-00008510: 3427 2c27 4235 272c 2742 3627 2c27 4237  4','B5','B6','B7
-00008520: 272c 2742 3827 2c27 4238 4127 2c20 2742  ','B8','B8A', 'B
-00008530: 3927 2c20 2742 3130 272c 2027 4231 3127  9', 'B10', 'B11'
-00008540: 2c27 4231 3227 5d5c 0d0a 2020 7d0d 0a0d  ,'B12']\..  }...
-00008550: 0a20 2073 656e 736f 7242 616e 644e 616d  .  sensorBandNam
-00008560: 6544 6963 7420 3d20 7b5c 0d0a 2020 2020  eDict = {\..    
-00008570: 2020 2753 5227 3a20 5b27 6362 272c 2027    'SR': ['cb', '
-00008580: 626c 7565 272c 2027 6772 6565 6e27 2c20  blue', 'green', 
-00008590: 2772 6564 272c 2027 7265 3127 2c27 7265  'red', 're1','re
-000085a0: 3227 2c27 7265 3327 2c27 6e69 7227 2c20  2','re3','nir', 
-000085b0: 276e 6972 3227 2c20 2777 6174 6572 5661  'nir2', 'waterVa
-000085c0: 706f 7227 2c20 2773 7769 7231 272c 2027  por', 'swir1', '
-000085d0: 7377 6972 3227 5d2c 0d0a 2020 2020 2020  swir2'],..      
-000085e0: 2754 4f41 273a 205b 2763 6227 2c20 2762  'TOA': ['cb', 'b
-000085f0: 6c75 6527 2c20 2767 7265 656e 272c 2027  lue', 'green', '
-00008600: 7265 6427 2c20 2772 6531 272c 2772 6532  red', 're1','re2
-00008610: 272c 2772 6533 272c 276e 6972 272c 2027  ','re3','nir', '
-00008620: 6e69 7232 272c 2027 7761 7465 7256 6170  nir2', 'waterVap
-00008630: 6f72 272c 2027 6369 7272 7573 272c 2773  or', 'cirrus','s
-00008640: 7769 7231 272c 2027 7377 6972 3227 5d5c  wir1', 'swir2']\
-00008650: 0d0a 2020 7d0d 0a20 2023 2053 7065 6369  ..  }..  # Speci
-00008660: 6679 2053 3220 636f 6e74 696e 756f 7573  fy S2 continuous
-00008670: 2062 616e 6473 2069 6620 7265 7361 6d70   bands if resamp
-00008680: 6c69 6e67 2069 7320 7365 7420 746f 2073  ling is set to s
-00008690: 6f6d 6574 6869 6e67 206f 7468 6572 2074  omething other t
-000086a0: 6861 6e20 6e65 6172 0d0a 2020 7332 5f63  han near..  s2_c
-000086b0: 6f6e 7469 6e75 6f75 735f 6261 6e64 7320  ontinuous_bands 
-000086c0: 3d20 7365 6e73 6f72 4261 6e64 4e61 6d65  = sensorBandName
-000086d0: 4469 6374 5b74 6f61 4f72 5352 5d0d 0a20  Dict[toaOrSR].. 
-000086e0: 200d 0a20 2064 6566 206d 756c 7453 3228   ..  def multS2(
-000086f0: 696d 6729 3a0d 0a20 2020 2074 203d 2069  img):..    t = i
-00008700: 6d67 2e73 656c 6563 7428 7365 6e73 6f72  mg.select(sensor
-00008710: 4261 6e64 4469 6374 5b74 6f61 4f72 5352  BandDict[toaOrSR
-00008720: 5d29 2e64 6976 6964 6528 3130 3030 3029  ]).divide(10000)
-00008730: 0d0a 2020 2020 2320 7420 3d20 742e 6164  ..    # t = t.ad
-00008740: 6442 616e 6473 2869 6d67 2e73 656c 6563  dBands(img.selec
-00008750: 7428 5b27 5141 3630 275d 2929 0d0a 2020  t(['QA60']))..  
-00008760: 2020 2320 6f75 7420 3d20 742e 636f 7079    # out = t.copy
-00008770: 5072 6f70 6572 7469 6573 2869 6d67 292e  Properties(img).
-00008780: 636f 7079 5072 6f70 6572 7469 6573 2869  copyProperties(i
-00008790: 6d67 2c5b 2773 7973 7465 6d3a 7469 6d65  mg,['system:time
-000087a0: 5f73 7461 7274 275d 290d 0a20 2020 2072  _start'])..    r
-000087b0: 6574 7572 6e20 696d 672e 6164 6442 616e  eturn img.addBan
-000087c0: 6473 2874 2c4e 6f6e 652c 5472 7565 290d  ds(t,None,True).
-000087d0: 0a0d 0a20 2023 4765 7420 736f 6d65 2073  ...  #Get some s
-000087e0: 3220 6461 7461 0d0a 2020 7072 696e 7428  2 data..  print(
-000087f0: 2755 7369 6e67 2053 3220 436f 6c6c 6563  'Using S2 Collec
-00008800: 7469 6f6e 3a27 2c20 7332 436f 6c6c 6563  tion:', s2Collec
-00008810: 7469 6f6e 4469 6374 5b74 6f61 4f72 5352  tionDict[toaOrSR
-00008820: 5d29 0d0a 2020 7332 7320 3d20 6565 2e49  ])..  s2s = ee.I
-00008830: 6d61 6765 436f 6c6c 6563 7469 6f6e 2873  mageCollection(s
-00008840: 3243 6f6c 6c65 6374 696f 6e44 6963 745b  2CollectionDict[
-00008850: 746f 614f 7253 525d 295c 0d0a 2020 2020  toaOrSR])\..    
-00008860: 2020 2020 2020 2020 2e66 696c 7465 7244          .filterD
-00008870: 6174 6528 7374 6172 7444 6174 652c 2065  ate(startDate, e
-00008880: 6e64 4461 7465 2e61 6476 616e 6365 2831  ndDate.advance(1
-00008890: 2c27 6461 7927 2929 5c0d 0a20 2020 2020  ,'day'))\..     
-000088a0: 2020 2020 2020 202e 6669 6c74 6572 2865         .filter(e
-000088b0: 652e 4669 6c74 6572 2e63 616c 656e 6461  e.Filter.calenda
-000088c0: 7252 616e 6765 2873 7461 7274 4a75 6c69  rRange(startJuli
-000088d0: 616e 2c20 656e 644a 756c 6961 6e29 295c  an, endJulian))\
-000088e0: 0d0a 2020 2020 2020 2020 2020 2020 2e66  ..            .f
-000088f0: 696c 7465 7242 6f75 6e64 7328 7374 7564  ilterBounds(stud
-00008900: 7941 7265 6129 5c0d 0a20 2020 2020 2020  yArea)\..       
-00008910: 2020 2020 202e 6d61 7028 6d75 6c74 5332       .map(multS2
-00008920: 295c 0d0a 2020 2020 2020 2020 2020 2020  )\..            
-00008930: 2e73 656c 6563 7428 5b27 5141 3630 275d  .select(['QA60']
-00008940: 2b73 656e 736f 7242 616e 6444 6963 745b  +sensorBandDict[
-00008950: 746f 614f 7253 525d 2c5b 2751 4136 3027  toaOrSR],['QA60'
-00008960: 5d2b 7365 6e73 6f72 4261 6e64 4e61 6d65  ]+sensorBandName
-00008970: 4469 6374 5b74 6f61 4f72 5352 5d29 0d0a  Dict[toaOrSR])..
-00008980: 0d0a 0d0a 0d0a 2020 6966 2061 6464 436c  ......  if addCl
-00008990: 6f75 6450 726f 6261 6269 6c69 7479 3a0d  oudProbability:.
-000089a0: 0a20 2020 2070 7269 6e74 2827 4a6f 696e  .    print('Join
-000089b0: 696e 6720 7072 652d 636f 6d70 7574 6564  ing pre-computed
-000089c0: 2063 6c6f 7564 2070 726f 6261 6269 6c69   cloud probabili
-000089d0: 7469 6573 2066 726f 6d3a 2043 4f50 4552  ties from: COPER
-000089e0: 4e49 4355 532f 5332 5f43 4c4f 5544 5f50  NICUS/S2_CLOUD_P
-000089f0: 524f 4241 4249 4c49 5459 2729 0d0a 2020  ROBABILITY')..  
-00008a00: 2020 636c 6f75 6450 726f 6261 6269 6c69    cloudProbabili
-00008a10: 7469 6573 203d 2065 652e 496d 6167 6543  ties = ee.ImageC
-00008a20: 6f6c 6c65 6374 696f 6e28 2243 4f50 4552  ollection("COPER
-00008a30: 4e49 4355 532f 5332 5f43 4c4f 5544 5f50  NICUS/S2_CLOUD_P
-00008a40: 524f 4241 4249 4c49 5459 2229 5c0d 0a20  ROBABILITY")\.. 
-00008a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008a60: 2020 202e 6669 6c74 6572 4461 7465 2873     .filterDate(s
-00008a70: 7461 7274 4461 7465 2c20 656e 6444 6174  tartDate, endDat
-00008a80: 652e 6164 7661 6e63 6528 312c 2764 6179  e.advance(1,'day
-00008a90: 2729 295c 0d0a 2020 2020 2020 2020 2020  '))\..          
-00008aa0: 2020 2020 2020 2020 2020 2e66 696c 7465            .filte
-00008ab0: 7228 6565 2e46 696c 7465 722e 6361 6c65  r(ee.Filter.cale
-00008ac0: 6e64 6172 5261 6e67 6528 7374 6172 744a  ndarRange(startJ
-00008ad0: 756c 6961 6e2c 2065 6e64 4a75 6c69 616e  ulian, endJulian
-00008ae0: 2929 5c0d 0a20 2020 2020 2020 2020 2020  ))\..           
-00008af0: 2020 2020 2020 2020 202e 6669 6c74 6572           .filter
-00008b00: 426f 756e 6473 2873 7475 6479 4172 6561  Bounds(studyArea
-00008b10: 295c 0d0a 2020 2020 2020 2020 2020 2020  )\..            
-00008b20: 2020 2020 2020 2020 2e73 656c 6563 7428          .select(
-00008b30: 5b27 7072 6f62 6162 696c 6974 7927 5d2c  ['probability'],
-00008b40: 5b27 636c 6f75 645f 7072 6f62 6162 696c  ['cloud_probabil
-00008b50: 6974 7927 5d29 0d0a 0d0a 2020 2020 636c  ity'])....    cl
-00008b60: 6f75 6450 726f 6261 6269 6c69 7469 6573  oudProbabilities
-00008b70: 4964 7320 3d20 6565 2e4c 6973 7428 6565  Ids = ee.List(ee
-00008b80: 2e44 6963 7469 6f6e 6172 7928 636c 6f75  .Dictionary(clou
-00008b90: 6450 726f 6261 6269 6c69 7469 6573 2e61  dProbabilities.a
-00008ba0: 6767 7265 6761 7465 5f68 6973 746f 6772  ggregate_histogr
-00008bb0: 616d 2827 7379 7374 656d 3a69 6e64 6578  am('system:index
-00008bc0: 2729 292e 6b65 7973 2829 290d 0a20 2020  ')).keys())..   
-00008bd0: 2073 3273 4964 7320 3d20 6565 2e4c 6973   s2sIds = ee.Lis
-00008be0: 7428 6565 2e44 6963 7469 6f6e 6172 7928  t(ee.Dictionary(
-00008bf0: 7332 732e 6167 6772 6567 6174 655f 6869  s2s.aggregate_hi
-00008c00: 7374 6f67 7261 6d28 2773 7973 7465 6d3a  stogram('system:
-00008c10: 696e 6465 7827 2929 2e6b 6579 7328 2929  index')).keys())
-00008c20: 0d0a 2020 2020 6d69 7373 696e 6720 3d20  ..    missing = 
-00008c30: 7332 7349 6473 2e72 656d 6f76 6541 6c6c  s2sIds.removeAll
-00008c40: 2863 6c6f 7564 5072 6f62 6162 696c 6974  (cloudProbabilit
-00008c50: 6965 7349 6473 290d 0a20 2020 2023 2070  iesIds)..    # p
-00008c60: 7269 6e74 2827 4d69 7373 696e 6720 636c  rint('Missing cl
-00008c70: 6f75 6420 7072 6f62 6162 696c 6974 7920  oud probability 
-00008c80: 6964 733a 272c 206d 6973 7369 6e67 2e67  ids:', missing.g
-00008c90: 6574 496e 666f 2829 290d 0a20 2020 2023  etInfo())..    #
-00008ca0: 2070 7269 6e74 2827 4e20 7332 2069 6d61   print('N s2 ima
-00008cb0: 6765 7320 6265 666f 7265 206a 6f69 6e69  ges before joini
-00008cc0: 6e67 2077 6974 6820 636c 6f75 6420 7072  ng with cloud pr
-00008cd0: 6f62 3a27 2c20 7332 732e 7369 7a65 2829  ob:', s2s.size()
-00008ce0: 2e67 6574 496e 666f 2829 290d 0a20 2020  .getInfo())..   
-00008cf0: 2073 3273 203d 206a 6f69 6e43 6f6c 6c65   s2s = joinColle
-00008d00: 6374 696f 6e73 2873 3273 2c20 636c 6f75  ctions(s2s, clou
-00008d10: 6450 726f 6261 6269 6c69 7469 6573 2c20  dProbabilities, 
-00008d20: 4661 6c73 652c 2773 7973 7465 6d3a 696e  False,'system:in
-00008d30: 6465 7827 290d 0a20 2020 2023 2070 7269  dex')..    # pri
-00008d40: 6e74 2827 4e20 7332 2069 6d61 6765 7320  nt('N s2 images 
-00008d50: 6166 7465 7220 6a6f 696e 696e 6720 7769  after joining wi
-00008d60: 7468 2063 6c6f 7564 2070 726f 623a 272c  th cloud prob:',
-00008d70: 2073 3273 2e73 697a 6528 292e 6765 7449   s2s.size().getI
-00008d80: 6e66 6f28 2929 0d0a 0d0a 2020 2320 5365  nfo())....  # Se
-00008d90: 7420 7265 7361 6d70 6c69 6e67 206d 6574  t resampling met
-00008da0: 686f 6420 2d20 6f6e 6c79 2073 6574 7320  hod - only sets 
-00008db0: 746f 206e 6f6e 206e 6561 7265 7374 2d6e  to non nearest-n
-00008dc0: 6569 6768 626f 7220 666f 7220 636f 6e74  eighbor for cont
-00008dd0: 696e 756f 7573 2062 616e 6473 0d0a 2020  inuous bands..  
-00008de0: 6966 2072 6573 616d 706c 654d 6574 686f  if resampleMetho
-00008df0: 6420 3d3d 2027 6269 6c69 6e65 6172 2720  d == 'bilinear' 
-00008e00: 6f72 2072 6573 616d 706c 654d 6574 686f  or resampleMetho
-00008e10: 6420 3d3d 2027 6269 6375 6269 6327 3a0d  d == 'bicubic':.
-00008e20: 0a20 2020 2070 7269 6e74 2827 5365 7474  .    print('Sett
-00008e30: 696e 6720 7265 7361 6d70 6c65 206d 6574  ing resample met
-00008e40: 686f 6420 746f 2027 2c20 7265 7361 6d70  hod to ', resamp
-00008e50: 6c65 4d65 7468 6f64 290d 0a20 2020 2073  leMethod)..    s
-00008e60: 3273 203d 2073 3273 2e6d 6170 286c 616d  2s = s2s.map(lam
-00008e70: 6264 6120 696d 673a 2069 6d67 2e61 6464  bda img: img.add
-00008e80: 4261 6e64 7328 696d 672e 7365 6c65 6374  Bands(img.select
-00008e90: 2873 325f 636f 6e74 696e 756f 7573 5f62  (s2_continuous_b
-00008ea0: 616e 6473 292e 7265 7361 6d70 6c65 2872  ands).resample(r
-00008eb0: 6573 616d 706c 654d 6574 686f 6429 2c4e  esampleMethod),N
-00008ec0: 6f6e 652c 5472 7565 2929 0d0a 2020 656c  one,True))..  el
-00008ed0: 6966 2072 6573 616d 706c 654d 6574 686f  if resampleMetho
-00008ee0: 6420 3d3d 2027 6167 6772 6567 6174 6527  d == 'aggregate'
-00008ef0: 3a0d 0a20 2020 2070 7269 6e74 2827 5365  :..    print('Se
-00008f00: 7474 696e 6720 746f 2061 6767 7265 6761  tting to aggrega
-00008f10: 7465 2069 6e73 7465 6164 206f 6620 7265  te instead of re
-00008f20: 7361 6d70 6c65 2027 290d 0a20 2020 2073  sample ')..    s
-00008f30: 3273 203d 2073 3273 2e6d 6170 286c 616d  2s = s2s.map(lam
-00008f40: 6264 6120 696d 673a 2069 6d67 2e61 6464  bda img: img.add
-00008f50: 4261 6e64 7328 696d 672e 7365 6c65 6374  Bands(img.select
-00008f60: 2873 325f 636f 6e74 696e 756f 7573 5f62  (s2_continuous_b
-00008f70: 616e 6473 292e 7265 6475 6365 5265 736f  ands).reduceReso
-00008f80: 6c75 7469 6f6e 2865 652e 5265 6475 6365  lution(ee.Reduce
-00008f90: 722e 6d65 616e 2829 2c20 5472 7565 2c20  r.mean(), True, 
-00008fa0: 3634 292c 4e6f 6e65 2c54 7275 6529 290d  64),None,True)).
-00008fb0: 0a20 200d 0a20 2023 436f 6e76 6572 7420  .  ..  #Convert 
-00008fc0: 746f 2064 6169 6c79 206d 6f73 6169 6373  to daily mosaics
-00008fd0: 2074 6f20 6176 6f69 6420 7265 6475 6e64   to avoid redund
-00008fe0: 616e 7420 6f62 7365 7276 6174 696f 6e73  ant observations
-00008ff0: 2069 6e20 4d47 5253 206f 7665 726c 6170   in MGRS overlap
-00009000: 2061 7265 6173 2061 6e64 2065 6467 6520   areas and edge 
-00009010: 6172 7469 6661 6374 7320 666f 7220 7368  artifacts for sh
-00009020: 6164 6f77 206d 6173 6b69 6e67 0d0a 2020  adow masking..  
-00009030: 6966 2063 6f6e 7665 7274 546f 4461 696c  if convertToDail
-00009040: 794d 6f73 6169 6373 3a0d 0a20 2020 2070  yMosaics:..    p
-00009050: 7269 6e74 2827 436f 6e76 6572 7469 6e67  rint('Converting
-00009060: 2053 3220 6461 7461 2074 6f20 6461 696c   S2 data to dail
-00009070: 7920 6d6f 7361 6963 7327 290d 0a20 2020  y mosaics')..   
-00009080: 2073 3273 203d 2064 6169 6c79 4d6f 7361   s2s = dailyMosa
-00009090: 6963 7328 7332 7329 0d0a 0d0a 2020 2320  ics(s2s)....  # 
-000090a0: 5468 6973 206e 6565 6473 2074 6f20 6f63  This needs to oc
-000090b0: 6375 7220 4146 5445 5220 7468 6520 6d6f  cur AFTER the mo
-000090c0: 7361 6963 6b69 6e67 2074 6f20 7265 6d6f  saicking to remo
-000090d0: 7665 2072 656d 6169 6e69 6e67 2065 6467  ve remaining edg
-000090e0: 6520 6172 7469 6661 6374 732e 0d0a 2020  e artifacts...  
-000090f0: 7332 7320 3d20 7332 732e 6d61 7028 6c61  s2s = s2s.map(la
-00009100: 6d62 6461 2069 6d67 3a20 696d 672e 7570  mbda img: img.up
-00009110: 6461 7465 4d61 736b 2869 6d67 2e6d 6173  dateMask(img.mas
-00009120: 6b28 292e 7265 6475 6365 2865 652e 5265  k().reduce(ee.Re
-00009130: 6475 6365 722e 6d69 6e28 2929 2929 0d0a  ducer.min())))..
-00009140: 0d0a 2020 7265 7475 726e 2073 3273 2e73  ..  return s2s.s
-00009150: 6574 2861 7267 7329 0d0a 0d0a 6765 7453  et(args)....getS
-00009160: 656e 7469 6e65 6c32 203d 2067 6574 5332  entinel2 = getS2
-00009170: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
-00009180: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00009190: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000091a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000091b0: 2323 2323 0d0a 2353 6574 2075 7020 6469  ####..#Set up di
-000091c0: 6374 696f 6e61 7269 6573 2074 6f20 6d61  ctionaries to ma
-000091d0: 6e61 6765 2076 6172 696f 7573 204c 616e  nage various Lan
-000091e0: 6473 6174 2063 6f6c 6c65 6374 696f 6e73  dsat collections
-000091f0: 2c20 7265 7363 616c 6520 6661 6374 6f72  , rescale factor
-00009200: 732c 2062 616e 6420 6e61 6d65 732c 2065  s, band names, e
-00009210: 7463 0d0a 6c61 6e64 7361 745f 4332 5f4c  tc..landsat_C2_L
-00009220: 325f 7265 7363 616c 655f 6469 6374 203d  2_rescale_dict =
-00009230: 207b 0d0a 2020 2743 3127 3a7b 2772 6566   {..  'C1':{'ref
-00009240: 6c5f 6d75 6c74 273a 302e 3030 3031 2c27  l_mult':0.0001,'
-00009250: 7265 666c 5f61 6464 273a 302c 2774 656d  refl_add':0,'tem
-00009260: 705f 6d75 6c74 273a 302e 312c 2774 656d  p_mult':0.1,'tem
-00009270: 705f 6164 6427 3a30 7d2c 0d0a 2020 2743  p_add':0},..  'C
-00009280: 3227 3a7b 2772 6566 6c5f 6d75 6c74 273a  2':{'refl_mult':
-00009290: 302e 3030 3030 3237 352c 2772 6566 6c5f  0.0000275,'refl_
-000092a0: 6164 6427 3a2d 302e 322c 2774 656d 705f  add':-0.2,'temp_
-000092b0: 6d75 6c74 273a 302e 3030 3334 3138 3032  mult':0.00341802
-000092c0: 2c27 7465 6d70 5f61 6464 273a 3134 392e  ,'temp_add':149.
-000092d0: 307d 2c0d 0a20 207d 0d0a 2320 5370 6563  0},..  }..# Spec
-000092e0: 6966 7920 4c61 6e64 7361 7420 636f 6e74  ify Landsat cont
-000092f0: 696e 756f 7573 2062 616e 6473 2069 6620  inuous bands if 
-00009300: 7265 7361 6d70 6c69 6e67 2069 7320 7365  resampling is se
-00009310: 7420 746f 2073 6f6d 6574 6869 6e67 206f  t to something o
-00009320: 7468 6572 2074 6861 6e20 6e65 6172 0d0a  ther than near..
-00009330: 6c61 6e64 7361 745f 636f 6e74 696e 756f  landsat_continuo
-00009340: 7573 5f62 616e 6473 203d 205b 2762 6c75  us_bands = ['blu
-00009350: 6527 2c27 6772 6565 6e27 2c27 7265 6427  e','green','red'
-00009360: 2c27 6e69 7227 2c27 7377 6972 3127 2c27  ,'nir','swir1','
-00009370: 7465 6d70 272c 2027 7377 6972 3227 5d0d  temp', 'swir2'].
-00009380: 0a23 5365 7420 7570 2062 616e 6473 2061  .#Set up bands a
-00009390: 6e64 2063 6f72 7265 7370 6f6e 6469 6e67  nd corresponding
-000093a0: 2062 616e 6420 6e61 6d65 730d 0a6c 616e   band names..lan
-000093b0: 6473 6174 5365 6e73 6f72 4261 6e64 4469  dsatSensorBandDi
-000093c0: 6374 203d 207b 0d0a 2743 315f 4c34 5f54  ct = {..'C1_L4_T
-000093d0: 4f41 273a 5b27 4231 272c 2742 3227 2c27  OA':['B1','B2','
-000093e0: 4233 272c 2742 3427 2c27 4235 272c 2742  B3','B4','B5','B
-000093f0: 3627 2c27 4237 272c 2742 5141 275d 2c0d  6','B7','BQA'],.
-00009400: 0a27 4332 5f4c 345f 544f 4127 3a5b 2742  .'C2_L4_TOA':['B
-00009410: 3127 2c27 4232 272c 2742 3327 2c27 4234  1','B2','B3','B4
-00009420: 272c 2742 3527 2c27 4236 272c 2742 3727  ','B5','B6','B7'
-00009430: 2c27 5141 5f50 4958 454c 275d 2c0d 0a27  ,'QA_PIXEL'],..'
-00009440: 4331 5f4c 355f 544f 4127 3a5b 2742 3127  C1_L5_TOA':['B1'
-00009450: 2c27 4232 272c 2742 3327 2c27 4234 272c  ,'B2','B3','B4',
-00009460: 2742 3527 2c27 4236 272c 2742 3727 2c27  'B5','B6','B7','
-00009470: 4251 4127 5d2c 0d0a 2743 325f 4c35 5f54  BQA'],..'C2_L5_T
-00009480: 4f41 273a 5b27 4231 272c 2742 3227 2c27  OA':['B1','B2','
-00009490: 4233 272c 2742 3427 2c27 4235 272c 2742  B3','B4','B5','B
-000094a0: 3627 2c27 4237 272c 2751 415f 5049 5845  6','B7','QA_PIXE
-000094b0: 4c27 5d2c 0d0a 2743 315f 4c37 5f54 4f41  L'],..'C1_L7_TOA
-000094c0: 273a 5b27 4231 272c 2742 3227 2c27 4233  ':['B1','B2','B3
-000094d0: 272c 2742 3427 2c27 4235 272c 2742 365f  ','B4','B5','B6_
-000094e0: 5643 4944 5f31 272c 2742 3727 2c27 4251  VCID_1','B7','BQ
-000094f0: 4127 5d2c 0d0a 2743 325f 4c37 5f54 4f41  A'],..'C2_L7_TOA
-00009500: 273a 5b27 4231 272c 2742 3227 2c27 4233  ':['B1','B2','B3
-00009510: 272c 2742 3427 2c27 4235 272c 2742 365f  ','B4','B5','B6_
-00009520: 5643 4944 5f31 272c 2742 3727 2c27 5141  VCID_1','B7','QA
-00009530: 5f50 4958 454c 275d 2c0d 0a27 4331 5f4c  _PIXEL'],..'C1_L
-00009540: 385f 544f 4127 3a5b 2742 3227 2c27 4233  8_TOA':['B2','B3
-00009550: 272c 2742 3427 2c27 4235 272c 2742 3627  ','B4','B5','B6'
-00009560: 2c27 4231 3027 2c27 4237 272c 2742 5141  ,'B10','B7','BQA
-00009570: 275d 2c0d 0a27 4332 5f4c 385f 544f 4127  '],..'C2_L8_TOA'
-00009580: 3a5b 2742 3227 2c27 4233 272c 2742 3427  :['B2','B3','B4'
-00009590: 2c27 4235 272c 2742 3627 2c27 4231 3027  ,'B5','B6','B10'
-000095a0: 2c27 4237 272c 2751 415f 5049 5845 4c27  ,'B7','QA_PIXEL'
-000095b0: 5d2c 0d0a 2743 325f 4c39 5f54 4f41 273a  ],..'C2_L9_TOA':
-000095c0: 5b27 4232 272c 2742 3327 2c27 4234 272c  ['B2','B3','B4',
-000095d0: 2742 3527 2c27 4236 272c 2742 3130 272c  'B5','B6','B10',
-000095e0: 2742 3727 2c27 5141 5f50 4958 454c 275d  'B7','QA_PIXEL']
-000095f0: 2c0d 0a27 4331 5f4c 345f 5352 273a 5b27  ,..'C1_L4_SR':['
-00009600: 4231 272c 2742 3227 2c27 4233 272c 2742  B1','B2','B3','B
-00009610: 3427 2c27 4235 272c 2742 3627 2c27 4237  4','B5','B6','B7
-00009620: 272c 2770 6978 656c 5f71 6127 5d2c 0d0a  ','pixel_qa'],..
-00009630: 2743 325f 4c34 5f53 5227 3a5b 2753 525f  'C2_L4_SR':['SR_
-00009640: 4231 272c 2753 525f 4232 272c 2753 525f  B1','SR_B2','SR_
-00009650: 4233 272c 2753 525f 4234 272c 2753 525f  B3','SR_B4','SR_
-00009660: 4235 272c 2753 545f 4236 272c 2753 525f  B5','ST_B6','SR_
-00009670: 4237 272c 2751 415f 5049 5845 4c27 5d2c  B7','QA_PIXEL'],
-00009680: 0d0a 2743 315f 4c35 5f53 5227 3a5b 2742  ..'C1_L5_SR':['B
-00009690: 3127 2c27 4232 272c 2742 3327 2c27 4234  1','B2','B3','B4
-000096a0: 272c 2742 3527 2c27 4236 272c 2742 3727  ','B5','B6','B7'
-000096b0: 2c27 7069 7865 6c5f 7161 275d 2c0d 0a27  ,'pixel_qa'],..'
-000096c0: 4332 5f4c 355f 5352 273a 5b27 5352 5f42  C2_L5_SR':['SR_B
-000096d0: 3127 2c27 5352 5f42 3227 2c27 5352 5f42  1','SR_B2','SR_B
-000096e0: 3327 2c27 5352 5f42 3427 2c27 5352 5f42  3','SR_B4','SR_B
-000096f0: 3527 2c27 5354 5f42 3627 2c27 5352 5f42  5','ST_B6','SR_B
-00009700: 3727 2c27 5141 5f50 4958 454c 275d 2c0d  7','QA_PIXEL'],.
-00009710: 0a27 4331 5f4c 375f 5352 273a 5b27 4231  .'C1_L7_SR':['B1
-00009720: 272c 2742 3227 2c27 4233 272c 2742 3427  ','B2','B3','B4'
-00009730: 2c27 4235 272c 2742 3627 2c27 4237 272c  ,'B5','B6','B7',
-00009740: 2770 6978 656c 5f71 6127 5d2c 0d0a 2743  'pixel_qa'],..'C
-00009750: 325f 4c37 5f53 5227 3a5b 2753 525f 4231  2_L7_SR':['SR_B1
-00009760: 272c 2753 525f 4232 272c 2753 525f 4233  ','SR_B2','SR_B3
-00009770: 272c 2753 525f 4234 272c 2753 525f 4235  ','SR_B4','SR_B5
-00009780: 272c 2753 545f 4236 272c 2753 525f 4237  ','ST_B6','SR_B7
-00009790: 272c 2751 415f 5049 5845 4c27 5d2c 0d0a  ','QA_PIXEL'],..
-000097a0: 2743 315f 4c38 5f53 5227 3a5b 2742 3227  'C1_L8_SR':['B2'
-000097b0: 2c27 4233 272c 2742 3427 2c27 4235 272c  ,'B3','B4','B5',
-000097c0: 2742 3627 2c27 4231 3027 2c27 4237 272c  'B6','B10','B7',
-000097d0: 2770 6978 656c 5f71 6127 5d2c 0d0a 2743  'pixel_qa'],..'C
-000097e0: 325f 4c38 5f53 5227 3a5b 2753 525f 4232  2_L8_SR':['SR_B2
-000097f0: 272c 2753 525f 4233 272c 2753 525f 4234  ','SR_B3','SR_B4
-00009800: 272c 2753 525f 4235 272c 2753 525f 4236  ','SR_B5','SR_B6
-00009810: 272c 2753 545f 4231 3027 2c27 5352 5f42  ','ST_B10','SR_B
-00009820: 3727 2c27 5141 5f50 4958 454c 275d 2c0d  7','QA_PIXEL'],.
-00009830: 0a27 4332 5f4c 395f 5352 273a 5b27 5352  .'C2_L9_SR':['SR
-00009840: 5f42 3227 2c27 5352 5f42 3327 2c27 5352  _B2','SR_B3','SR
-00009850: 5f42 3427 2c27 5352 5f42 3527 2c27 5352  _B4','SR_B5','SR
-00009860: 5f42 3627 2c27 5354 5f42 3130 272c 2753  _B6','ST_B10','S
-00009870: 525f 4237 272c 2751 415f 5049 5845 4c27  R_B7','QA_PIXEL'
-00009880: 5d2c 0d0a 7d0d 0a0d 0a23 2050 726f 7669  ],..}....# Provi
-00009890: 6465 2063 6f6d 6d6f 6e20 6261 6e64 206e  de common band n
-000098a0: 616d 6573 0d0a 6c61 6e64 7361 7453 656e  ames..landsatSen
-000098b0: 736f 7242 616e 644e 616d 6544 6963 7420  sorBandNameDict 
-000098c0: 3d20 7b5c 0d0a 2020 2743 315f 544f 4127  = {\..  'C1_TOA'
-000098d0: 3a20 5b27 626c 7565 272c 2767 7265 656e  : ['blue','green
-000098e0: 272c 2772 6564 272c 276e 6972 272c 2773  ','red','nir','s
-000098f0: 7769 7231 272c 2774 656d 7027 2c27 7377  wir1','temp','sw
-00009900: 6972 3227 2c27 4251 4127 5d2c 5c0d 0a20  ir2','BQA'],\.. 
-00009910: 2027 4331 5f53 5227 3a20 5b27 626c 7565   'C1_SR': ['blue
-00009920: 272c 2767 7265 656e 272c 2772 6564 272c  ','green','red',
-00009930: 276e 6972 272c 2773 7769 7231 272c 2774  'nir','swir1','t
-00009940: 656d 7027 2c20 2773 7769 7232 272c 2770  emp', 'swir2','p
-00009950: 6978 656c 5f71 6127 5d2c 5c0d 0a20 2027  ixel_qa'],\..  '
-00009960: 4331 5f53 5246 4d41 534b 273a 205b 2770  C1_SRFMASK': ['p
-00009970: 6978 656c 5f71 6127 5d2c 5c0d 0a20 2027  ixel_qa'],\..  '
-00009980: 4332 5f54 4f41 273a 205b 2762 6c75 6527  C2_TOA': ['blue'
-00009990: 2c27 6772 6565 6e27 2c27 7265 6427 2c27  ,'green','red','
-000099a0: 6e69 7227 2c27 7377 6972 3127 2c27 7465  nir','swir1','te
-000099b0: 6d70 272c 2773 7769 7232 272c 2751 415f  mp','swir2','QA_
-000099c0: 5049 5845 4c27 5d2c 5c0d 0a20 2027 4332  PIXEL'],\..  'C2
-000099d0: 5f53 5227 3a20 5b27 626c 7565 272c 2767  _SR': ['blue','g
-000099e0: 7265 656e 272c 2772 6564 272c 276e 6972  reen','red','nir
-000099f0: 272c 2773 7769 7231 272c 2774 656d 7027  ','swir1','temp'
-00009a00: 2c20 2773 7769 7232 272c 2751 415f 5049  , 'swir2','QA_PI
-00009a10: 5845 4c27 5d0d 0a20 207d 0d0a 0d0a 2353  XEL']..  }....#S
-00009a20: 6574 2075 7020 636f 6c6c 6563 7469 6f6e  et up collection
-00009a30: 730d 0a6c 616e 6473 6174 436f 6c6c 6563  s..landsatCollec
-00009a40: 7469 6f6e 4469 6374 203d 207b 0d0a 2020  tionDict = {..  
-00009a50: 2743 315f 4c38 5f54 4f41 273a 2027 4c41  'C1_L8_TOA': 'LA
-00009a60: 4e44 5341 542f 4c43 3038 2f43 3031 2f54  NDSAT/LC08/C01/T
-00009a70: 3127 2c5c 0d0a 2020 2743 315f 4c37 5f54  1',\..  'C1_L7_T
-00009a80: 4f41 273a 2027 4c41 4e44 5341 542f 4c45  OA': 'LANDSAT/LE
-00009a90: 3037 2f43 3031 2f54 3127 2c5c 0d0a 2020  07/C01/T1',\..  
-00009aa0: 2743 315f 4c35 5f54 4f41 273a 2027 4c41  'C1_L5_TOA': 'LA
-00009ab0: 4e44 5341 542f 4c54 3035 2f43 3031 2f54  NDSAT/LT05/C01/T
-00009ac0: 3127 2c5c 0d0a 2020 2743 315f 4c34 5f54  1',\..  'C1_L4_T
-00009ad0: 4f41 273a 2027 4c41 4e44 5341 542f 4c54  OA': 'LANDSAT/LT
-00009ae0: 3034 2f43 3031 2f54 3127 2c5c 0d0a 2020  04/C01/T1',\..  
-00009af0: 2743 315f 4c38 5f53 5227 3a20 274c 414e  'C1_L8_SR': 'LAN
-00009b00: 4453 4154 2f4c 4330 382f 4330 312f 5431  DSAT/LC08/C01/T1
-00009b10: 5f53 5227 2c5c 0d0a 2020 2743 315f 4c37  _SR',\..  'C1_L7
-00009b20: 5f53 5227 3a20 274c 414e 4453 4154 2f4c  _SR': 'LANDSAT/L
-00009b30: 4530 372f 4330 312f 5431 5f53 5227 2c5c  E07/C01/T1_SR',\
-00009b40: 0d0a 2020 2743 315f 4c35 5f53 5227 3a20  ..  'C1_L5_SR': 
-00009b50: 274c 414e 4453 4154 2f4c 5430 352f 4330  'LANDSAT/LT05/C0
-00009b60: 312f 5431 5f53 5227 2c5c 0d0a 2020 2743  1/T1_SR',\..  'C
-00009b70: 315f 4c34 5f53 5227 3a20 274c 414e 4453  1_L4_SR': 'LANDS
-00009b80: 4154 2f4c 5430 342f 4330 312f 5431 5f53  AT/LT04/C01/T1_S
-00009b90: 5227 2c5c 0d0a 2020 2743 325f 4c39 5f54  R',\..  'C2_L9_T
-00009ba0: 4f41 273a 2027 4c41 4e44 5341 542f 4c43  OA': 'LANDSAT/LC
-00009bb0: 3039 2f43 3032 2f54 3127 2c5c 0d0a 2020  09/C02/T1',\..  
-00009bc0: 2743 325f 4c38 5f54 4f41 273a 2027 4c41  'C2_L8_TOA': 'LA
-00009bd0: 4e44 5341 542f 4c43 3038 2f43 3032 2f54  NDSAT/LC08/C02/T
-00009be0: 3127 2c5c 0d0a 2020 2743 325f 4c37 5f54  1',\..  'C2_L7_T
-00009bf0: 4f41 273a 2027 4c41 4e44 5341 542f 4c45  OA': 'LANDSAT/LE
-00009c00: 3037 2f43 3032 2f54 3127 2c5c 0d0a 2020  07/C02/T1',\..  
-00009c10: 2743 325f 4c35 5f54 4f41 273a 2027 4c41  'C2_L5_TOA': 'LA
-00009c20: 4e44 5341 542f 4c54 3035 2f43 3032 2f54  NDSAT/LT05/C02/T
-00009c30: 3127 2c5c 0d0a 2020 2743 325f 4c34 5f54  1',\..  'C2_L4_T
-00009c40: 4f41 273a 2027 4c41 4e44 5341 542f 4c54  OA': 'LANDSAT/LT
-00009c50: 3034 2f43 3032 2f54 3127 2c5c 0d0a 2020  04/C02/T1',\..  
-00009c60: 2743 325f 4c39 5f53 5227 3a20 274c 414e  'C2_L9_SR': 'LAN
-00009c70: 4453 4154 2f4c 4330 392f 4330 322f 5431  DSAT/LC09/C02/T1
-00009c80: 5f4c 3227 2c5c 0d0a 2020 2743 325f 4c38  _L2',\..  'C2_L8
-00009c90: 5f53 5227 3a20 274c 414e 4453 4154 2f4c  _SR': 'LANDSAT/L
-00009ca0: 4330 382f 4330 322f 5431 5f4c 3227 2c5c  C08/C02/T1_L2',\
-00009cb0: 0d0a 2020 2743 325f 4c37 5f53 5227 3a20  ..  'C2_L7_SR': 
-00009cc0: 274c 414e 4453 4154 2f4c 4530 372f 4330  'LANDSAT/LE07/C0
-00009cd0: 322f 5431 5f4c 3227 2c5c 0d0a 2020 2743  2/T1_L2',\..  'C
-00009ce0: 325f 4c35 5f53 5227 3a20 274c 414e 4453  2_L5_SR': 'LANDS
-00009cf0: 4154 2f4c 5430 352f 4330 322f 5431 5f4c  AT/LT05/C02/T1_L
-00009d00: 3227 2c5c 0d0a 2020 2743 325f 4c34 5f53  2',\..  'C2_L4_S
-00009d10: 5227 3a20 274c 414e 4453 4154 2f4c 5430  R': 'LANDSAT/LT0
-00009d20: 342f 4330 322f 5431 5f4c 3227 5c0d 0a20  4/C02/T1_L2'\.. 
-00009d30: 207d 3b0d 0a0d 0a23 204e 616d 6520 6f66   };....# Name of
-00009d40: 2063 466d 6173 6b20 7161 2062 6974 7320   cFmask qa bits 
-00009d50: 6261 6e64 2066 6f72 2043 6f6c 6c65 6374  band for Collect
-00009d60: 696f 6e73 2031 2061 6e64 2032 0d0a 6c61  ions 1 and 2..la
-00009d70: 6e64 7361 7446 6d61 736b 4261 6e64 4e61  ndsatFmaskBandNa
-00009d80: 6d65 4469 6374 203d 207b 2743 3127 3a27  meDict = {'C1':'
-00009d90: 7069 7865 6c5f 7161 272c 2743 3227 3a27  pixel_qa','C2':'
-00009da0: 5141 5f50 4958 454c 277d 0d0a 2323 2323  QA_PIXEL'}..####
-00009db0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00009dc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00009dd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00009de0: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
-00009df0: 2320 4d65 7468 6f64 2066 6f72 2072 6573  # Method for res
-00009e00: 6361 6c69 6e67 2072 6566 6c65 6374 616e  caling reflectan
-00009e10: 6365 2061 6e64 2073 7572 6661 6365 2074  ce and surface t
-00009e20: 656d 7065 7261 7475 7265 2064 6174 6120  emperature data 
-00009e30: 746f 2030 2d31 2061 6e64 204b 656c 7669  to 0-1 and Kelvi
-00009e40: 6e20 7265 7370 6563 7469 7665 6c79 0d0a  n respectively..
-00009e50: 2320 5468 6973 2077 6173 2061 6461 7074  # This was adapt
-00009e60: 6564 2066 726f 6d20 7468 6520 6d65 7468  ed from the meth
-00009e70: 6f64 2070 726f 7669 6465 6420 6279 2047  od provided by G
-00009e80: 6f6f 676c 6520 666f 7220 7265 7363 616c  oogle for rescal
-00009e90: 696e 6720 436f 6c6c 6563 7469 6f6e 2032  ing Collection 2
-00009ea0: 3a0d 0a23 2068 7474 7073 3a2f 2f63 6f64  :..# https://cod
-00009eb0: 652e 6561 7274 6865 6e67 696e 652e 676f  e.earthengine.go
-00009ec0: 6f67 6c65 2e63 6f6d 2f3f 7363 7269 7074  ogle.com/?script
-00009ed0: 5061 7468 3d45 7861 6d70 6c65 7325 3341  Path=Examples%3A
-00009ee0: 4461 7461 7365 7473 2532 464c 414e 4453  Datasets%2FLANDS
-00009ef0: 4154 5f4c 4330 385f 4330 325f 5431 5f4c  AT_LC08_C02_T1_L
-00009f00: 320d 0a64 6566 2061 7070 6c79 5363 616c  2..def applyScal
-00009f10: 6546 6163 746f 7273 2869 6d61 6765 2c6c  eFactors(image,l
-00009f20: 616e 6473 6174 436f 6c6c 6563 7469 6f6e  andsatCollection
-00009f30: 5665 7273 696f 6e29 3a0d 0a20 2066 6163  Version):..  fac
-00009f40: 746f 725f 6469 6374 203d 206c 616e 6473  tor_dict = lands
-00009f50: 6174 5f43 325f 4c32 5f72 6573 6361 6c65  at_C2_L2_rescale
-00009f60: 5f64 6963 745b 6c61 6e64 7361 7443 6f6c  _dict[landsatCol
-00009f70: 6c65 6374 696f 6e56 6572 7369 6f6e 5d0d  lectionVersion].
-00009f80: 0a20 206f 7074 6963 616c 4261 6e64 7320  .  opticalBands 
-00009f90: 3d20 696d 6167 652e 7365 6c65 6374 2827  = image.select('
-00009fa0: 626c 7565 272c 2767 7265 656e 272c 2772  blue','green','r
-00009fb0: 6564 272c 276e 6972 272c 2773 7769 7231  ed','nir','swir1
-00009fc0: 272c 2773 7769 7232 2729 2e6d 756c 7469  ','swir2').multi
-00009fd0: 706c 7928 6661 6374 6f72 5f64 6963 745b  ply(factor_dict[
-00009fe0: 2772 6566 6c5f 6d75 6c74 275d 292e 6164  'refl_mult']).ad
-00009ff0: 6428 6661 6374 6f72 5f64 6963 745b 2772  d(factor_dict['r
-0000a000: 6566 6c5f 6164 6427 5d29 2e66 6c6f 6174  efl_add']).float
-0000a010: 2829 0d0a 2020 7468 6572 6d61 6c42 616e  ()..  thermalBan
-0000a020: 6473 203d 2069 6d61 6765 2e73 656c 6563  ds = image.selec
-0000a030: 7428 2774 656d 7027 292e 6d75 6c74 6970  t('temp').multip
-0000a040: 6c79 2866 6163 746f 725f 6469 6374 5b27  ly(factor_dict['
-0000a050: 7465 6d70 5f6d 756c 7427 5d29 2e61 6464  temp_mult']).add
-0000a060: 2866 6163 746f 725f 6469 6374 5b27 7465  (factor_dict['te
-0000a070: 6d70 5f61 6464 275d 292e 666c 6f61 7428  mp_add']).float(
-0000a080: 290d 0a20 2072 6574 7572 6e20 696d 6167  )..  return imag
-0000a090: 652e 6164 6442 616e 6473 286f 7074 6963  e.addBands(optic
-0000a0a0: 616c 4261 6e64 732c 204e 6f6e 652c 2054  alBands, None, T
-0000a0b0: 7275 6529 5c0d 0a20 2020 2020 2020 2020  rue)\..         
-0000a0c0: 2020 2020 202e 6164 6442 616e 6473 2874       .addBands(t
-0000a0d0: 6865 726d 616c 4261 6e64 732c 204e 6f6e  hermalBands, Non
-0000a0e0: 652c 2054 7275 6529 0d0a 2323 2323 2323  e, True)..######
-0000a0f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000a100: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000a110: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000a120: 2323 2323 2323 2323 2323 2323 0d0a 2346  ############..#F
-0000a130: 756e 6374 696f 6e20 666f 7220 6163 7175  unction for acqu
-0000a140: 6972 696e 6720 4c61 6e64 7361 7420 696d  iring Landsat im
-0000a150: 6167 6520 636f 6c6c 6563 7469 6f6e 730d  age collections.
-0000a160: 0a64 6566 2067 6574 4c61 6e64 7361 7428  .def getLandsat(
-0000a170: 7374 7564 7941 7265 612c 0d0a 2020 2020  studyArea,..    
-0000a180: 2020 2020 2020 2020 2020 7374 6172 7444            startD
-0000a190: 6174 652c 0d0a 2020 2020 2020 2020 2020  ate,..          
-0000a1a0: 2020 2020 656e 6444 6174 652c 0d0a 2020      endDate,..  
-0000a1b0: 2020 2020 2020 2020 2020 2020 7374 6172              star
-0000a1c0: 744a 756c 6961 6e2c 0d0a 2020 2020 2020  tJulian,..      
-0000a1d0: 2020 2020 2020 2020 656e 644a 756c 6961          endJulia
-0000a1e0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-0000a1f0: 2020 746f 614f 7253 5220 3d20 2753 5227    toaOrSR = 'SR'
-0000a200: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000a210: 2069 6e63 6c75 6465 534c 434f 6666 4c37   includeSLCOffL7
-0000a220: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
-0000a230: 2020 2020 2020 2020 2064 6566 7269 6e67           defring
-0000a240: 654c 3520 3d20 4661 6c73 652c 0d0a 2020  eL5 = False,..  
-0000a250: 2020 2020 2020 2020 2020 2020 6164 6450              addP
-0000a260: 6978 656c 5141 203d 2046 616c 7365 2c0d  ixelQA = False,.
-0000a270: 0a20 2020 2020 2020 2020 2020 2020 2072  .              r
-0000a280: 6573 616d 706c 654d 6574 686f 6420 3d20  esampleMethod = 
-0000a290: 276e 6561 7227 2c0d 0a20 2020 2020 2020  'near',..       
-0000a2a0: 2020 2020 2020 206c 616e 6473 6174 436f         landsatCo
-0000a2b0: 6c6c 6563 7469 6f6e 5665 7273 696f 6e20  llectionVersion 
-0000a2c0: 3d20 2743 3227 293a 0d0a 0d0a 2020 6172  = 'C2'):....  ar
-0000a2d0: 6773 203d 2066 6f72 6d61 7441 7267 7328  gs = formatArgs(
-0000a2e0: 6c6f 6361 6c73 2829 290d 0a0d 0a0d 0a20  locals())...... 
-0000a2f0: 2064 6566 2067 6574 4c61 6e64 7361 7443   def getLandsatC
-0000a300: 6f6c 6c65 6374 696f 6e28 6c61 6e64 7361  ollection(landsa
-0000a310: 7443 6f6c 6c65 6374 696f 6e56 6572 7369  tCollectionVersi
-0000a320: 6f6e 2c77 6869 6368 432c 746f 614f 7253  on,whichC,toaOrS
-0000a330: 5229 3a0d 0a20 2020 2063 203d 2065 652e  R):..    c = ee.
-0000a340: 496d 6167 6543 6f6c 6c65 6374 696f 6e28  ImageCollection(
-0000a350: 6c61 6e64 7361 7443 6f6c 6c65 6374 696f  landsatCollectio
-0000a360: 6e44 6963 745b 6c61 6e64 7361 7443 6f6c  nDict[landsatCol
-0000a370: 6c65 6374 696f 6e56 6572 7369 6f6e 2b27  lectionVersion+'
-0000a380: 5f27 2b77 6869 6368 432b 275f 272b 746f  _'+whichC+'_'+to
-0000a390: 614f 7253 525d 295c 0d0a 2020 2020 2020  aOrSR])\..      
-0000a3a0: 2020 2e66 696c 7465 7244 6174 6528 7374    .filterDate(st
-0000a3b0: 6172 7444 6174 652c 656e 6444 6174 652e  artDate,endDate.
-0000a3c0: 6164 7661 6e63 6528 312c 2764 6179 2729  advance(1,'day')
-0000a3d0: 295c 0d0a 2020 2020 2020 2020 2e66 696c  )\..        .fil
-0000a3e0: 7465 7228 6565 2e46 696c 7465 722e 6361  ter(ee.Filter.ca
-0000a3f0: 6c65 6e64 6172 5261 6e67 6528 7374 6172  lendarRange(star
-0000a400: 744a 756c 6961 6e2c 656e 644a 756c 6961  tJulian,endJulia
-0000a410: 6e29 295c 0d0a 2020 2020 2020 2020 2e66  n))\..        .f
-0000a420: 696c 7465 7242 6f75 6e64 7328 7374 7564  ilterBounds(stud
-0000a430: 7941 7265 6129 5c0d 0a20 2020 2020 2020  yArea)\..       
-0000a440: 202e 6669 6c74 6572 2865 652e 4669 6c74   .filter(ee.Filt
-0000a450: 6572 2e6c 7465 2827 5752 535f 524f 5727  er.lte('WRS_ROW'
-0000a460: 2c31 3230 2929 0d0a 2020 2020 6966 2074  ,120))..    if t
-0000a470: 6f61 4f72 5352 2e6c 6f77 6572 2829 203d  oaOrSR.lower() =
-0000a480: 3d20 2774 6f61 273a 0d0a 2020 2020 2020  = 'toa':..      
-0000a490: 6320 3d20 632e 6d61 7028 6565 2e41 6c67  c = c.map(ee.Alg
-0000a4a0: 6f72 6974 686d 732e 4c61 6e64 7361 742e  orithms.Landsat.
-0000a4b0: 544f 4129 0d0a 0d0a 2020 2020 6320 3d20  TOA)....    c = 
-0000a4c0: 632e 7365 6c65 6374 286c 616e 6473 6174  c.select(landsat
-0000a4d0: 5365 6e73 6f72 4261 6e64 4469 6374 5b6c  SensorBandDict[l
-0000a4e0: 616e 6473 6174 436f 6c6c 6563 7469 6f6e  andsatCollection
-0000a4f0: 5665 7273 696f 6e2b 275f 272b 7768 6963  Version+'_'+whic
-0000a500: 6843 2b27 5f27 2b74 6f61 4f72 5352 5d2c  hC+'_'+toaOrSR],
-0000a510: 6c61 6e64 7361 7453 656e 736f 7242 616e  landsatSensorBan
-0000a520: 644e 616d 6544 6963 745b 6c61 6e64 7361  dNameDict[landsa
-0000a530: 7443 6f6c 6c65 6374 696f 6e56 6572 7369  tCollectionVersi
-0000a540: 6f6e 2b27 5f27 2b74 6f61 4f72 5352 5d29  on+'_'+toaOrSR])
-0000a550: 0d0a 0d0a 2020 2020 6966 2074 6f61 4f72  ....    if toaOr
-0000a560: 5352 2e6c 6f77 6572 2829 203d 3d20 2773  SR.lower() == 's
-0000a570: 7227 3a0d 0a20 2020 2020 2070 7269 6e74  r':..      print
-0000a580: 2827 4170 706c 7969 6e67 2073 6361 6c65  ('Applying scale
-0000a590: 2066 6163 746f 7273 2066 6f72 207b 7d20   factors for {} 
-0000a5a0: 7b7d 2064 6174 6127 2e66 6f72 6d61 7428  {} data'.format(
-0000a5b0: 6c61 6e64 7361 7443 6f6c 6c65 6374 696f  landsatCollectio
-0000a5c0: 6e56 6572 7369 6f6e 2c77 6869 6368 4329  nVersion,whichC)
-0000a5d0: 290d 0a20 2020 2020 2063 203d 2063 2e6d  )..      c = c.m
-0000a5e0: 6170 286c 616d 6264 6120 696d 6167 653a  ap(lambda image:
-0000a5f0: 6170 706c 7953 6361 6c65 4661 6374 6f72  applyScaleFactor
-0000a600: 7328 696d 6167 652c 6c61 6e64 7361 7443  s(image,landsatC
-0000a610: 6f6c 6c65 6374 696f 6e56 6572 7369 6f6e  ollectionVersion
-0000a620: 2929 0d0a 0d0a 2020 2020 7265 7475 726e  ))....    return
-0000a630: 2063 0d0a 2020 6465 6620 6765 744c 616e   c..  def getLan
-0000a640: 6473 6174 436f 6c6c 6563 7469 6f6e 7328  dsatCollections(
-0000a650: 746f 614f 7253 522c 6c61 6e64 7361 7443  toaOrSR,landsatC
-0000a660: 6f6c 6c65 6374 696f 6e56 6572 7369 6f6e  ollectionVersion
-0000a670: 293a 0d0a 2020 2020 2347 6574 204c 616e  ):..    #Get Lan
-0000a680: 6473 6174 2064 6174 610d 0a20 2020 206c  dsat data..    l
-0000a690: 3473 203d 2067 6574 4c61 6e64 7361 7443  4s = getLandsatC
-0000a6a0: 6f6c 6c65 6374 696f 6e28 6c61 6e64 7361  ollection(landsa
-0000a6b0: 7443 6f6c 6c65 6374 696f 6e56 6572 7369  tCollectionVersi
-0000a6c0: 6f6e 2c27 4c34 272c 746f 614f 7253 5229  on,'L4',toaOrSR)
-0000a6d0: 0d0a 2020 2020 6c35 7320 3d20 6765 744c  ..    l5s = getL
-0000a6e0: 616e 6473 6174 436f 6c6c 6563 7469 6f6e  andsatCollection
-0000a6f0: 286c 616e 6473 6174 436f 6c6c 6563 7469  (landsatCollecti
-0000a700: 6f6e 5665 7273 696f 6e2c 274c 3527 2c74  onVersion,'L5',t
-0000a710: 6f61 4f72 5352 290d 0a0d 0a20 2020 2069  oaOrSR)....    i
-0000a720: 6620 6465 6672 696e 6765 4c35 3a0d 0a20  f defringeL5:.. 
-0000a730: 2020 2020 2070 7269 6e74 2827 4465 6672       print('Defr
-0000a740: 696e 6769 6e67 204c 3420 616e 6420 4c35  inging L4 and L5
-0000a750: 2729 0d0a 2020 2020 2020 6c34 7320 3d20  ')..      l4s = 
-0000a760: 6c34 732e 6d61 7028 6465 6672 696e 6765  l4s.map(defringe
-0000a770: 4c61 6e64 7361 7429 0d0a 2020 2020 2020  Landsat)..      
-0000a780: 6c35 7320 3d20 6c35 732e 6d61 7028 6465  l5s = l5s.map(de
-0000a790: 6672 696e 6765 4c61 6e64 7361 7429 0d0a  fringeLandsat)..
-0000a7a0: 0d0a 2020 2020 6c38 7320 3d20 6765 744c  ..    l8s = getL
-0000a7b0: 616e 6473 6174 436f 6c6c 6563 7469 6f6e  andsatCollection
-0000a7c0: 286c 616e 6473 6174 436f 6c6c 6563 7469  (landsatCollecti
-0000a7d0: 6f6e 5665 7273 696f 6e2c 274c 3827 2c74  onVersion,'L8',t
-0000a7e0: 6f61 4f72 5352 290d 0a0d 0a0d 0a0d 0a20  oaOrSR)........ 
-0000a7f0: 2023 2020 2076 6172 206c 733b 2076 6172   #   var ls; var
-0000a800: 206c 3773 3b0d 0a20 2020 2069 6620 696e   l7s;..    if in
-0000a810: 636c 7564 6553 4c43 4f66 664c 373a 0d0a  cludeSLCOffL7:..
-0000a820: 2020 2020 2020 7072 696e 7428 2749 6e63        print('Inc
-0000a830: 6c75 6469 6e67 2041 6c6c 204c 616e 6473  luding All Lands
-0000a840: 6174 2037 2729 0d0a 2020 2020 2020 6c37  at 7')..      l7
-0000a850: 7320 3d67 6574 4c61 6e64 7361 7443 6f6c  s =getLandsatCol
-0000a860: 6c65 6374 696f 6e28 6c61 6e64 7361 7443  lection(landsatC
-0000a870: 6f6c 6c65 6374 696f 6e56 6572 7369 6f6e  ollectionVersion
-0000a880: 2c27 4c37 272c 746f 614f 7253 5229 0d0a  ,'L7',toaOrSR)..
-0000a890: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0000a8a0: 2070 7269 6e74 2827 4f6e 6c79 2069 6e63   print('Only inc
-0000a8b0: 6c75 6469 6e67 2053 4c43 204f 6e20 4c61  luding SLC On La
-0000a8c0: 6e64 7361 7420 3727 293b 0d0a 2020 2020  ndsat 7');..    
-0000a8d0: 2020 6c37 7320 3d20 6765 744c 616e 6473    l7s = getLands
-0000a8e0: 6174 436f 6c6c 6563 7469 6f6e 286c 616e  atCollection(lan
-0000a8f0: 6473 6174 436f 6c6c 6563 7469 6f6e 5665  dsatCollectionVe
-0000a900: 7273 696f 6e2c 274c 3727 2c74 6f61 4f72  rsion,'L7',toaOr
-0000a910: 5352 295c 0d0a 2020 2020 2020 2020 2020  SR)\..          
-0000a920: 2e66 696c 7465 7244 6174 6528 6565 2e44  .filterDate(ee.D
-0000a930: 6174 652e 6672 6f6d 594d 4428 3139 3938  ate.fromYMD(1998
-0000a940: 2c31 2c31 292c 6565 2e44 6174 652e 6672  ,1,1),ee.Date.fr
-0000a950: 6f6d 594d 4428 3230 3033 2c35 2c33 3129  omYMD(2003,5,31)
-0000a960: 2e61 6476 616e 6365 2831 2c27 6461 7927  .advance(1,'day'
-0000a970: 2929 5c0d 0a0d 0a20 2020 2023 4d65 7267  ))\....    #Merg
-0000a980: 6520 636f 6c6c 6563 7469 6f6e 730d 0a20  e collections.. 
-0000a990: 2020 206c 7320 3d20 6565 2e49 6d61 6765     ls = ee.Image
-0000a9a0: 436f 6c6c 6563 7469 6f6e 286c 3473 2e6d  Collection(l4s.m
-0000a9b0: 6572 6765 286c 3573 292e 6d65 7267 6528  erge(l5s).merge(
-0000a9c0: 6c37 7329 2e6d 6572 6765 286c 3873 2929  l7s).merge(l8s))
-0000a9d0: 0d0a 0d0a 2020 2020 2320 4272 696e 6720  ....    # Bring 
-0000a9e0: 696e 204c 616e 6473 6174 2039 2069 6620  in Landsat 9 if 
-0000a9f0: 7573 696e 6720 436f 6c6c 6563 7469 6f6e  using Collection
-0000aa00: 2032 0d0a 2020 2020 6966 206c 616e 6473   2..    if lands
-0000aa10: 6174 436f 6c6c 6563 7469 6f6e 5665 7273  atCollectionVers
-0000aa20: 696f 6e2e 6c6f 7765 7228 2920 3d3d 2027  ion.lower() == '
-0000aa30: 6332 273a 0d0a 2020 2020 2020 6c39 7320  c2':..      l9s 
-0000aa40: 3d20 6765 744c 616e 6473 6174 436f 6c6c  = getLandsatColl
-0000aa50: 6563 7469 6f6e 286c 616e 6473 6174 436f  ection(landsatCo
-0000aa60: 6c6c 6563 7469 6f6e 5665 7273 696f 6e2c  llectionVersion,
-0000aa70: 274c 3927 2c74 6f61 4f72 5352 290d 0a20  'L9',toaOrSR).. 
-0000aa80: 2020 2020 206c 7320 3d20 6565 2e49 6d61       ls = ee.Ima
-0000aa90: 6765 436f 6c6c 6563 7469 6f6e 286c 732e  geCollection(ls.
-0000aaa0: 6d65 7267 6528 6c39 7329 290d 0a0d 0a20  merge(l9s)).... 
-0000aab0: 2020 2072 6574 7572 6e20 6c73 0d0a 0d0a     return ls....
-0000aac0: 2020 6c73 203d 2067 6574 4c61 6e64 7361    ls = getLandsa
-0000aad0: 7443 6f6c 6c65 6374 696f 6e73 2874 6f61  tCollections(toa
-0000aae0: 4f72 5352 2c6c 616e 6473 6174 436f 6c6c  OrSR,landsatColl
-0000aaf0: 6563 7469 6f6e 5665 7273 696f 6e29 0d0a  ectionVersion)..
-0000ab00: 2020 2349 6620 544f 4120 616e 6420 466d    #If TOA and Fm
-0000ab10: 6173 6b20 6e65 6564 2074 6f20 6d65 7267  ask need to merg
-0000ab20: 6520 466d 6173 6b20 7161 2062 6974 7320  e Fmask qa bits 
-0000ab30: 7769 7468 2074 6f61 2d20 7468 6973 2067  with toa- this g
-0000ab40: 6574 7320 7468 6520 7161 2062 616e 6420  ets the qa band 
-0000ab50: 6672 6f6d 2074 6865 2073 7220 636f 6c6c  from the sr coll
-0000ab60: 6563 7469 6f6e 730d 0a20 2069 6620 746f  ections..  if to
-0000ab70: 614f 7253 522e 6c6f 7765 7228 2920 3d3d  aOrSR.lower() ==
-0000ab80: 2027 746f 6127 2061 6e64 2061 6464 5069   'toa' and addPi
-0000ab90: 7865 6c51 4120 616e 6420 6c61 6e64 7361  xelQA and landsa
-0000aba0: 7443 6f6c 6c65 6374 696f 6e56 6572 7369  tCollectionVersi
-0000abb0: 6f6e 2e6c 6f77 6572 2829 203d 3d20 2763  on.lower() == 'c
-0000abc0: 3127 3a0d 0a20 2020 2070 7269 6e74 2827  1':..    print('
-0000abd0: 4163 7175 6972 696e 6720 5352 2071 6120  Acquiring SR qa 
-0000abe0: 6261 6e64 7320 666f 7220 6170 706c 7969  bands for applyi
-0000abf0: 6e67 2046 6d61 736b 2074 6f20 544f 4120  ng Fmask to TOA 
-0000ac00: 6461 7461 2729 0d0a 2020 2020 6c34 7354  data')..    l4sT
-0000ac10: 4f41 464d 4153 4b20 3d20 6565 2e49 6d61  OAFMASK = ee.Ima
-0000ac20: 6765 436f 6c6c 6563 7469 6f6e 286c 616e  geCollection(lan
-0000ac30: 6473 6174 436f 6c6c 6563 7469 6f6e 4469  dsatCollectionDi
-0000ac40: 6374 5b27 4331 5f4c 345f 5352 275d 295c  ct['C1_L4_SR'])\
-0000ac50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ac60: 2e66 696c 7465 7244 6174 6528 7374 6172  .filterDate(star
-0000ac70: 7444 6174 652c 2065 6e64 4461 7465 2e61  tDate, endDate.a
-0000ac80: 6476 616e 6365 2831 2c27 6461 7927 2929  dvance(1,'day'))
-0000ac90: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
-0000aca0: 202e 6669 6c74 6572 2865 652e 4669 6c74   .filter(ee.Filt
-0000acb0: 6572 2e63 616c 656e 6461 7252 616e 6765  er.calendarRange
-0000acc0: 2873 7461 7274 4a75 6c69 616e 2c20 656e  (startJulian, en
-0000acd0: 644a 756c 6961 6e29 295c 0d0a 2020 2020  dJulian))\..    
-0000ace0: 2020 2020 2020 2020 2020 2e66 696c 7465            .filte
-0000acf0: 7242 6f75 6e64 7328 7374 7564 7941 7265  rBounds(studyAre
-0000ad00: 6129 5c0d 0a20 2020 2020 2020 2020 2020  a)\..           
-0000ad10: 2020 202e 6669 6c74 6572 2865 652e 4669     .filter(ee.Fi
-0000ad20: 6c74 6572 2e6c 7465 2827 5752 535f 524f  lter.lte('WRS_RO
-0000ad30: 5727 2c31 3230 2929 5c0d 0a20 2020 2020  W',120))\..     
-0000ad40: 2020 2020 2020 2020 202e 7365 6c65 6374           .select
-0000ad50: 286c 616e 6473 6174 5365 6e73 6f72 4261  (landsatSensorBa
-0000ad60: 6e64 4e61 6d65 4469 6374 5b27 4331 5f53  ndNameDict['C1_S
-0000ad70: 5246 4d41 534b 275d 290d 0a0d 0a20 2020  RFMASK'])....   
-0000ad80: 206c 3573 544f 4146 4d41 534b 203d 2065   l5sTOAFMASK = e
-0000ad90: 652e 496d 6167 6543 6f6c 6c65 6374 696f  e.ImageCollectio
-0000ada0: 6e28 6c61 6e64 7361 7443 6f6c 6c65 6374  n(landsatCollect
-0000adb0: 696f 6e44 6963 745b 2743 315f 4c35 5f53  ionDict['C1_L5_S
-0000adc0: 5227 5d29 5c0d 0a20 2020 2020 2020 2020  R'])\..         
-0000add0: 2020 2020 202e 6669 6c74 6572 4461 7465       .filterDate
-0000ade0: 2873 7461 7274 4461 7465 2c20 656e 6444  (startDate, endD
-0000adf0: 6174 652e 6164 7661 6e63 6528 312c 2764  ate.advance(1,'d
-0000ae00: 6179 2729 295c 0d0a 2020 2020 2020 2020  ay'))\..        
-0000ae10: 2020 2020 2020 2e66 696c 7465 7228 6565        .filter(ee
-0000ae20: 2e46 696c 7465 722e 6361 6c65 6e64 6172  .Filter.calendar
-0000ae30: 5261 6e67 6528 7374 6172 744a 756c 6961  Range(startJulia
-0000ae40: 6e2c 2065 6e64 4a75 6c69 616e 2929 5c0d  n, endJulian))\.
-0000ae50: 0a20 2020 2020 2020 2020 2020 2020 202e  .              .
-0000ae60: 6669 6c74 6572 426f 756e 6473 2873 7475  filterBounds(stu
-0000ae70: 6479 4172 6561 295c 0d0a 2020 2020 2020  dyArea)\..      
-0000ae80: 2020 2020 2020 2020 2e66 696c 7465 7228          .filter(
-0000ae90: 6565 2e46 696c 7465 722e 6c74 6528 2757  ee.Filter.lte('W
-0000aea0: 5253 5f52 4f57 272c 3132 3029 295c 0d0a  RS_ROW',120))\..
-0000aeb0: 2020 2020 2020 2020 2020 2020 2020 2e73                .s
-0000aec0: 656c 6563 7428 6c61 6e64 7361 7453 656e  elect(landsatSen
-0000aed0: 736f 7242 616e 644e 616d 6544 6963 745b  sorBandNameDict[
-0000aee0: 2743 315f 5352 464d 4153 4b27 5d29 0d0a  'C1_SRFMASK'])..
-0000aef0: 0d0a 2020 2020 6c38 7354 4f41 464d 4153  ..    l8sTOAFMAS
-0000af00: 4b20 3d20 6565 2e49 6d61 6765 436f 6c6c  K = ee.ImageColl
-0000af10: 6563 7469 6f6e 286c 616e 6473 6174 436f  ection(landsatCo
-0000af20: 6c6c 6563 7469 6f6e 4469 6374 5b27 4331  llectionDict['C1
-0000af30: 5f4c 385f 5352 275d 295c 0d0a 2020 2020  _L8_SR'])\..    
-0000af40: 2020 2020 2020 2020 2020 2e66 696c 7465            .filte
-0000af50: 7244 6174 6528 7374 6172 7444 6174 652c  rDate(startDate,
-0000af60: 2065 6e64 4461 7465 2e61 6476 616e 6365   endDate.advance
-0000af70: 2831 2c27 6461 7927 2929 5c0d 0a20 2020  (1,'day'))\..   
-0000af80: 2020 2020 2020 2020 2020 202e 6669 6c74             .filt
-0000af90: 6572 2865 652e 4669 6c74 6572 2e63 616c  er(ee.Filter.cal
-0000afa0: 656e 6461 7252 616e 6765 2873 7461 7274  endarRange(start
-0000afb0: 4a75 6c69 616e 2c20 656e 644a 756c 6961  Julian, endJulia
-0000afc0: 6e29 295c 0d0a 2020 2020 2020 2020 2020  n))\..          
-0000afd0: 2020 2020 2e66 696c 7465 7242 6f75 6e64      .filterBound
-0000afe0: 7328 7374 7564 7941 7265 6129 5c0d 0a20  s(studyArea)\.. 
-0000aff0: 2020 2020 2020 2020 2020 2020 202e 6669               .fi
-0000b000: 6c74 6572 2865 652e 4669 6c74 6572 2e6c  lter(ee.Filter.l
-0000b010: 7465 2827 5752 535f 524f 5727 2c31 3230  te('WRS_ROW',120
-0000b020: 2929 5c0d 0a20 2020 2020 2020 2020 2020  ))\..           
-0000b030: 2020 202e 7365 6c65 6374 286c 616e 6473     .select(lands
-0000b040: 6174 5365 6e73 6f72 4261 6e64 4e61 6d65  atSensorBandName
-0000b050: 4469 6374 5b27 4331 5f53 5246 4d41 534b  Dict['C1_SRFMASK
-0000b060: 275d 290d 0a0d 0a20 2020 2069 6620 696e  '])....    if in
-0000b070: 636c 7564 6553 4c43 4f66 664c 373a 0d0a  cludeSLCOffL7:..
-0000b080: 2020 2020 2020 7072 696e 7428 2749 6e63        print('Inc
-0000b090: 6c75 6469 6e67 2041 6c6c 204c 616e 6473  luding All Lands
-0000b0a0: 6174 2037 2066 6f72 2054 4f41 2051 4127  at 7 for TOA QA'
-0000b0b0: 290d 0a20 2020 2020 206c 3773 544f 4146  )..      l7sTOAF
-0000b0c0: 4d41 534b 203d 2065 652e 496d 6167 6543  MASK = ee.ImageC
-0000b0d0: 6f6c 6c65 6374 696f 6e28 6c61 6e64 7361  ollection(landsa
-0000b0e0: 7443 6f6c 6c65 6374 696f 6e44 6963 745b  tCollectionDict[
-0000b0f0: 2743 315f 4c37 5f53 5227 5d29 5c0d 0a20  'C1_L7_SR'])\.. 
-0000b100: 2020 2020 2020 2020 2020 2020 202e 6669               .fi
-0000b110: 6c74 6572 4461 7465 2873 7461 7274 4461  lterDate(startDa
-0000b120: 7465 2c20 656e 6444 6174 652e 6164 7661  te, endDate.adva
-0000b130: 6e63 6528 312c 2764 6179 2729 295c 0d0a  nce(1,'day'))\..
-0000b140: 2020 2020 2020 2020 2020 2020 2020 2e66                .f
-0000b150: 696c 7465 7228 6565 2e46 696c 7465 722e  ilter(ee.Filter.
-0000b160: 6361 6c65 6e64 6172 5261 6e67 6528 7374  calendarRange(st
-0000b170: 6172 744a 756c 6961 6e2c 2065 6e64 4a75  artJulian, endJu
-0000b180: 6c69 616e 2929 5c0d 0a20 2020 2020 2020  lian))\..       
-0000b190: 2020 2020 2020 202e 6669 6c74 6572 426f         .filterBo
-0000b1a0: 756e 6473 2873 7475 6479 4172 6561 295c  unds(studyArea)\
-0000b1b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b1c0: 2e66 696c 7465 7228 6565 2e46 696c 7465  .filter(ee.Filte
-0000b1d0: 722e 6c74 6528 2757 5253 5f52 4f57 272c  r.lte('WRS_ROW',
-0000b1e0: 3132 3029 295c 0d0a 2020 2020 2020 2020  120))\..        
-0000b1f0: 2020 2020 2020 2e73 656c 6563 7428 6c61        .select(la
-0000b200: 6e64 7361 7453 656e 736f 7242 616e 644e  ndsatSensorBandN
-0000b210: 616d 6544 6963 745b 2743 315f 5352 464d  ameDict['C1_SRFM
-0000b220: 4153 4b27 5d29 0d0a 2020 2020 656c 7365  ASK'])..    else
-0000b230: 3a0d 0a20 2020 2020 2070 7269 6e74 2827  :..      print('
-0000b240: 4f6e 6c79 2069 6e63 6c75 6469 6e67 2053  Only including S
-0000b250: 4c43 204f 6e20 4c61 6e64 7361 7420 3720  LC On Landsat 7 
-0000b260: 666f 7220 544f 4120 5141 2729 3b0d 0a20  for TOA QA');.. 
-0000b270: 2020 2020 206c 3773 544f 4146 4d41 534b       l7sTOAFMASK
-0000b280: 203d 2020 6565 2e49 6d61 6765 436f 6c6c   =  ee.ImageColl
-0000b290: 6563 7469 6f6e 286c 616e 6473 6174 436f  ection(landsatCo
-0000b2a0: 6c6c 6563 7469 6f6e 4469 6374 5b27 4331  llectionDict['C1
-0000b2b0: 5f4c 375f 5352 275d 295c 0d0a 2020 2020  _L7_SR'])\..    
-0000b2c0: 2020 2020 2020 2020 2020 2e66 696c 7465            .filte
-0000b2d0: 7244 6174 6528 6565 2e44 6174 652e 6672  rDate(ee.Date.fr
-0000b2e0: 6f6d 594d 4428 3139 3938 2c31 2c31 292c  omYMD(1998,1,1),
-0000b2f0: 2065 652e 4461 7465 2e66 726f 6d59 4d44   ee.Date.fromYMD
-0000b300: 2832 3030 332c 352c 3331 292e 6164 7661  (2003,5,31).adva
-0000b310: 6e63 6528 312c 2764 6179 2729 295c 0d0a  nce(1,'day'))\..
-0000b320: 2020 2020 2020 2020 2020 2020 2020 2e66                .f
-0000b330: 696c 7465 7244 6174 6528 7374 6172 7444  ilterDate(startD
-0000b340: 6174 652c 2065 6e64 4461 7465 2e61 6476  ate, endDate.adv
-0000b350: 616e 6365 2831 2c27 6461 7927 2929 5c0d  ance(1,'day'))\.
-0000b360: 0a20 2020 2020 2020 2020 2020 2020 202e  .              .
-0000b370: 6669 6c74 6572 2865 652e 4669 6c74 6572  filter(ee.Filter
-0000b380: 2e63 616c 656e 6461 7252 616e 6765 2873  .calendarRange(s
-0000b390: 7461 7274 4a75 6c69 616e 2c20 656e 644a  tartJulian, endJ
-0000b3a0: 756c 6961 6e29 295c 0d0a 2020 2020 2020  ulian))\..      
-0000b3b0: 2020 2020 2020 2020 2e66 696c 7465 7242          .filterB
-0000b3c0: 6f75 6e64 7328 7374 7564 7941 7265 6129  ounds(studyArea)
-0000b3d0: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
-0000b3e0: 202e 6669 6c74 6572 2865 652e 4669 6c74   .filter(ee.Filt
-0000b3f0: 6572 2e6c 7465 2827 5752 535f 524f 5727  er.lte('WRS_ROW'
-0000b400: 2c31 3230 2929 5c0d 0a20 2020 2020 2020  ,120))\..       
-0000b410: 2020 2020 2020 202e 7365 6c65 6374 286c         .select(l
-0000b420: 616e 6473 6174 5365 6e73 6f72 4261 6e64  andsatSensorBand
-0000b430: 4e61 6d65 4469 6374 5b27 4331 5f53 5246  NameDict['C1_SRF
-0000b440: 4d41 534b 275d 290d 0a0d 0a20 2020 206c  MASK'])....    l
-0000b450: 7354 4f41 464d 4153 4b20 3d20 6565 2e49  sTOAFMASK = ee.I
-0000b460: 6d61 6765 436f 6c6c 6563 7469 6f6e 286c  mageCollection(l
-0000b470: 3473 544f 4146 4d41 534b 2e6d 6572 6765  4sTOAFMASK.merge
-0000b480: 286c 3573 544f 4146 4d41 534b 292e 6d65  (l5sTOAFMASK).me
-0000b490: 7267 6528 6c37 7354 4f41 464d 4153 4b29  rge(l7sTOAFMASK)
-0000b4a0: 2e6d 6572 6765 286c 3873 544f 4146 4d41  .merge(l8sTOAFMA
-0000b4b0: 534b 2929 0d0a 0d0a 2020 2020 234a 6f69  SK))....    #Joi
-0000b4c0: 6e20 7468 6520 544f 4120 7769 7468 2053  n the TOA with S
-0000b4d0: 5220 5141 2062 616e 6473 0d0a 2020 2020  R QA bands..    
-0000b4e0: 7072 696e 7428 274a 6f69 6e69 6e67 2054  print('Joining T
-0000b4f0: 4f41 2077 6974 6820 5352 2051 4120 6261  OA with SR QA ba
-0000b500: 6e64 7327 290d 0a20 2020 2023 7072 696e  nds')..    #prin
-0000b510: 7428 6c73 2e73 697a 6528 292c 206c 7354  t(ls.size(), lsT
-0000b520: 4f41 464d 4153 4b2e 7369 7a65 2829 290d  OAFMASK.size()).
-0000b530: 0a20 2020 206c 7320 3d20 6a6f 696e 436f  .    ls = joinCo
-0000b540: 6c6c 6563 7469 6f6e 7328 6c73 2e73 656c  llections(ls.sel
-0000b550: 6563 7428 5b30 2c31 2c32 2c33 2c34 2c35  ect([0,1,2,3,4,5
-0000b560: 2c36 5d29 2c20 6c73 544f 4146 4d41 534b  ,6]), lsTOAFMASK
-0000b570: 2c20 4661 6c73 652c 2027 7379 7374 656d  , False, 'system
-0000b580: 3a69 6e64 6578 2729 0d0a 2020 2020 2320  :index')..    # 
-0000b590: 6c73 544f 4146 4d41 534b 203d 2067 6574  lsTOAFMASK = get
-0000b5a0: 4c61 6e64 7361 7428 2753 5227 292e 7365  Landsat('SR').se
-0000b5b0: 6c65 6374 285b 2770 6978 656c 5f71 6127  lect(['pixel_qa'
-0000b5c0: 5d29 0d0a 2020 2020 2320 234a 6f69 6e20  ])..    # #Join 
-0000b5d0: 7468 6520 544f 4120 7769 7468 2053 5220  the TOA with SR 
-0000b5e0: 5141 2062 616e 6473 0d0a 2020 2020 2320  QA bands..    # 
-0000b5f0: 7072 696e 7428 274a 6f69 6e69 6e67 2054  print('Joining T
-0000b600: 4f41 2077 6974 6820 5352 2051 4120 6261  OA with SR QA ba
-0000b610: 6e64 7327 290d 0a20 2020 2023 206c 7320  nds')..    # ls 
-0000b620: 3d20 6a6f 696e 436f 6c6c 6563 7469 6f6e  = joinCollection
-0000b630: 7328 6c73 2e73 656c 6563 7428 5b30 2c31  s(ls.select([0,1
-0000b640: 2c32 2c33 2c34 2c35 2c36 5d29 2c6c 7354  ,2,3,4,5,6]),lsT
-0000b650: 4f41 464d 4153 4b29 0d0a 0d0a 2020 6465  OAFMASK)....  de
-0000b660: 6620 6461 7461 496e 416c 6c42 616e 6473  f dataInAllBands
-0000b670: 2869 6d67 293a 0d0a 2020 2020 7265 7475  (img):..    retu
-0000b680: 726e 2069 6d67 2e75 7064 6174 654d 6173  rn img.updateMas
-0000b690: 6b28 696d 672e 7365 6c65 6374 285b 2762  k(img.select(['b
-0000b6a0: 6c75 6527 2c27 6772 6565 6e27 2c27 7265  lue','green','re
-0000b6b0: 6427 2c27 6e69 7227 2c27 7377 6972 3127  d','nir','swir1'
-0000b6c0: 2c27 7377 6972 3227 5d29 2e6d 6173 6b28  ,'swir2']).mask(
-0000b6d0: 292e 7265 6475 6365 2865 652e 5265 6475  ).reduce(ee.Redu
-0000b6e0: 6365 722e 6d69 6e28 2929 290d 0a20 2020  cer.min()))..   
-0000b6f0: 2023 2072 6574 7572 6e20 696d 672e 6d75   # return img.mu
-0000b700: 6c74 6970 6c79 286d 756c 7449 6d61 6765  ltiply(multImage
-0000b710: 4469 6374 5b74 6f61 4f72 5352 5d29 2e63  Dict[toaOrSR]).c
-0000b720: 6f70 7950 726f 7065 7274 6965 7328 696d  opyProperties(im
-0000b730: 672c 5b27 7379 7374 656d 3a74 696d 655f  g,['system:time_
-0000b740: 7374 6172 7427 5d29 2e63 6f70 7950 726f  start']).copyPro
-0000b750: 7065 7274 6965 7328 696d 6729 0d0a 0d0a  perties(img)....
-0000b760: 2020 234d 616b 6520 7375 7265 2061 6c6c    #Make sure all
-0000b770: 2062 616e 6473 2068 6176 6520 6461 7461   bands have data
-0000b780: 0d0a 2020 6c73 203d 206c 732e 6d61 7028  ..  ls = ls.map(
-0000b790: 6461 7461 496e 416c 6c42 616e 6473 290d  dataInAllBands).
-0000b7a0: 0a0d 0a20 2023 2053 6574 2072 6573 616d  ...  # Set resam
-0000b7b0: 706c 696e 6720 6d65 7468 6f64 202d 206f  pling method - o
-0000b7c0: 6e6c 7920 7365 7473 2074 6f20 6e6f 6e20  nly sets to non 
-0000b7d0: 6e65 6172 6573 742d 6e65 6967 6862 6f72  nearest-neighbor
-0000b7e0: 2066 6f72 2063 6f6e 7469 6e75 6f75 7320   for continuous 
-0000b7f0: 6261 6e64 730d 0a20 2064 6566 2073 6574  bands..  def set
-0000b800: 5265 7361 6d70 6c65 2869 6d67 293a 0d0a  Resample(img):..
-0000b810: 2020 2020 7265 7475 726e 2069 6d67 2e72      return img.r
-0000b820: 6573 616d 706c 6528 7265 7361 6d70 6c65  esample(resample
-0000b830: 4d65 7468 6f64 290d 0a0d 0a20 2069 6620  Method)....  if 
-0000b840: 7265 7361 6d70 6c65 4d65 7468 6f64 2069  resampleMethod i
-0000b850: 6e20 5b27 6269 6c69 6e65 6172 272c 2762  n ['bilinear','b
-0000b860: 6963 7562 6963 275d 3a0d 0a20 2020 2070  icubic']:..    p
-0000b870: 7269 6e74 2827 5365 7474 696e 6720 7265  rint('Setting re
-0000b880: 7361 6d70 6c65 206d 6574 686f 6420 746f  sample method to
-0000b890: 2027 2c72 6573 616d 706c 654d 6574 686f   ',resampleMetho
-0000b8a0: 6429 0d0a 2020 2020 6c73 203d 206c 732e  d)..    ls = ls.
-0000b8b0: 6d61 7028 6c61 6d62 6461 2069 6d67 3a20  map(lambda img: 
-0000b8c0: 696d 672e 6164 6442 616e 6473 2869 6d67  img.addBands(img
-0000b8d0: 2e73 656c 6563 7428 6c61 6e64 7361 745f  .select(landsat_
-0000b8e0: 636f 6e74 696e 756f 7573 5f62 616e 6473  continuous_bands
-0000b8f0: 292e 7265 7361 6d70 6c65 2872 6573 616d  ).resample(resam
-0000b900: 706c 654d 6574 686f 6429 2c4e 6f6e 652c  pleMethod),None,
-0000b910: 5472 7565 2929 0d0a 2020 656c 6966 2072  True))..  elif r
-0000b920: 6573 616d 706c 654d 6574 686f 6420 3d3d  esampleMethod ==
-0000b930: 2027 6167 6772 6567 6174 6527 3a0d 0a20   'aggregate':.. 
-0000b940: 2020 2070 7269 6e74 2827 5365 7474 696e     print('Settin
-0000b950: 6720 746f 2061 6767 7265 6761 7465 2069  g to aggregate i
-0000b960: 6e73 7465 6164 206f 6620 7265 7361 6d70  nstead of resamp
-0000b970: 6c65 2027 290d 0a20 2020 206c 7320 3d20  le ')..    ls = 
-0000b980: 6c73 2e6d 6170 286c 616d 6264 6120 696d  ls.map(lambda im
-0000b990: 673a 2069 6d67 2e61 6464 4261 6e64 7328  g: img.addBands(
-0000b9a0: 696d 672e 7365 6c65 6374 286c 616e 6473  img.select(lands
-0000b9b0: 6174 5f63 6f6e 7469 6e75 6f75 735f 6261  at_continuous_ba
-0000b9c0: 6e64 7329 2e72 6564 7563 6552 6573 6f6c  nds).reduceResol
-0000b9d0: 7574 696f 6e28 6565 2e52 6564 7563 6572  ution(ee.Reducer
-0000b9e0: 2e6d 6561 6e28 292c 2054 7275 652c 2036  .mean(), True, 6
-0000b9f0: 3429 2c4e 6f6e 652c 5472 7565 2929 0d0a  4),None,True))..
-0000ba00: 0d0a 2020 7265 7475 726e 206c 732e 7365  ..  return ls.se
-0000ba10: 7428 6172 6773 290d 0a0d 0a67 6574 496d  t(args)....getIm
-0000ba20: 6167 6543 6f6c 6c65 6374 696f 6e20 3d20  ageCollection = 
-0000ba30: 6765 744c 616e 6473 6174 0d0a 0d0a 2323  getLandsat....##
-0000ba40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000ba50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000ba60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000ba70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000ba80: 2323 2323 2323 2323 230d 0a23 4865 6c70  #########..#Help
-0000ba90: 6572 2066 756e 6374 696f 6e20 746f 2061  er function to a
-0000baa0: 7070 6c79 2061 6e20 6578 7072 6573 7369  pply an expressi
-0000bab0: 6f6e 2061 6e64 206c 696e 6561 726c 7920  on and linearly 
-0000bac0: 7265 7363 616c 6520 7468 6520 6f75 7470  rescale the outp
-0000bad0: 7574 2e0d 0a23 5573 6564 2069 6e20 7468  ut...#Used in th
-0000bae0: 6520 6c61 6e64 7361 7443 6c6f 7564 5363  e landsatCloudSc
-0000baf0: 6f72 6520 6675 6e63 7469 6f6e 2062 656c  ore function bel
-0000bb00: 6f77 2e0d 0a64 6566 2072 6573 6361 6c65  ow...def rescale
-0000bb10: 2869 6d67 2c20 7468 7265 7368 6f6c 6473  (img, thresholds
-0000bb20: 293a 0d0a 2020 2020 7265 7475 726e 2069  ):..    return i
-0000bb30: 6d67 2e73 7562 7472 6163 7428 7468 7265  mg.subtract(thre
-0000bb40: 7368 6f6c 6473 5b30 5d29 2e64 6976 6964  sholds[0]).divid
-0000bb50: 6528 7468 7265 7368 6f6c 6473 5b31 5d20  e(thresholds[1] 
-0000bb60: 2d20 7468 7265 7368 6f6c 6473 5b30 5d29  - thresholds[0])
-0000bb70: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
-0000bb80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000bb90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000bba0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000bbb0: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
-0000bbc0: 202f 2a2a 2a0d 0a23 2020 2a20 496d 706c   /***..#  * Impl
-0000bbd0: 656d 656e 7461 7469 6f6e 206f 6620 4261  ementation of Ba
-0000bbe0: 7369 6320 636c 6f75 6420 7368 6164 6f77  sic cloud shadow
-0000bbf0: 2073 6869 6674 0d0a 2320 202a 0d0a 2320   shift..#  *..# 
-0000bc00: 202a 2041 7574 686f 723a 2047 656e 6e61   * Author: Genna
-0000bc10: 6469 6920 446f 6e63 6879 7473 0d0a 2320  dii Donchyts..# 
-0000bc20: 202a 204c 6963 656e 7365 3a20 4170 6163   * License: Apac
-0000bc30: 6865 2032 2e30 0d0a 2320 202a 2f0d 0a23  he 2.0..#  */..#
-0000bc40: 436c 6f75 6420 6865 6967 6874 7320 6164  Cloud heights ad
-0000bc50: 6465 6420 6279 2049 616e 2048 6f75 736d  ded by Ian Housm
-0000bc60: 616e 0d0a 2320 794d 756c 7420 6275 6720  an..# yMult bug 
-0000bc70: 6669 7820 6164 6170 7465 6420 6672 6f6d  fix adapted from
-0000bc80: 2063 6f64 6520 7772 6974 7465 6e20 6279   code written by
-0000bc90: 204e 6f65 6c20 476f 7265 6c69 636b 2062   Noel Gorelick b
-0000bca0: 7920 4961 6e20 486f 7573 6d61 6e0d 0a64  y Ian Housman..d
-0000bcb0: 6566 2070 726f 6a65 6374 5368 6164 6f77  ef projectShadow
-0000bcc0: 7328 636c 6f75 644d 6173 6b2c 696d 6167  s(cloudMask,imag
-0000bcd0: 652c 6972 5375 6d54 6872 6573 682c 636f  e,irSumThresh,co
-0000bce0: 6e74 7261 6374 5069 7865 6c73 2c64 696c  ntractPixels,dil
-0000bcf0: 6174 6550 6978 656c 732c 636c 6f75 6448  atePixels,cloudH
-0000bd00: 6569 6768 7473 2c79 4d75 6c74 203d 204e  eights,yMult = N
-0000bd10: 6f6e 6529 3a0d 0a20 2069 6628 794d 756c  one):..  if(yMul
-0000bd20: 7420 3d3d 204e 6f6e 6529 3a0d 0a20 2020  t == None):..   
-0000bd30: 2079 4d75 6c74 203d 2065 652e 416c 676f   yMult = ee.Algo
-0000bd40: 7269 7468 6d73 2e49 6628 6565 2e41 6c67  rithms.If(ee.Alg
-0000bd50: 6f72 6974 686d 732e 4973 4571 7561 6c28  orithms.IsEqual(
-0000bd60: 696d 6167 652e 7365 6c65 6374 285b 335d  image.select([3]
-0000bd70: 292e 7072 6f6a 6563 7469 6f6e 2829 2c20  ).projection(), 
-0000bd80: 6565 2e50 726f 6a65 6374 696f 6e28 2245  ee.Projection("E
-0000bd90: 5053 473a 3433 3236 2229 292c 312c 2d31  PSG:4326")),1,-1
-0000bda0: 290d 0a0d 0a20 206d 6561 6e41 7a69 6d75  )....  meanAzimu
-0000bdb0: 7468 203d 2069 6d61 6765 2e67 6574 2827  th = image.get('
-0000bdc0: 4d45 414e 5f53 4f4c 4152 5f41 5a49 4d55  MEAN_SOLAR_AZIMU
-0000bdd0: 5448 5f41 4e47 4c45 2729 0d0a 2020 6d65  TH_ANGLE')..  me
-0000bde0: 616e 5a65 6e69 7468 203d 2069 6d61 6765  anZenith = image
-0000bdf0: 2e67 6574 2827 4d45 414e 5f53 4f4c 4152  .get('MEAN_SOLAR
-0000be00: 5f5a 454e 4954 485f 414e 474c 4527 290d  _ZENITH_ANGLE').
-0000be10: 0a20 2023 2323 2323 2323 2323 2323 2323  .  #############
-0000be20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000be30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000be40: 2323 2323 230d 0a20 2023 7072 696e 7428  #####..  #print(
-0000be50: 2761 272c 6d65 616e 417a 696d 7574 6829  'a',meanAzimuth)
-0000be60: 0d0a 2020 2370 7269 6e74 2827 7a27 2c6d  ..  #print('z',m
-0000be70: 6561 6e5a 656e 6974 6829 0d0a 0d0a 2020  eanZenith)....  
-0000be80: 2346 696e 6420 6461 726b 2070 6978 656c  #Find dark pixel
-0000be90: 730d 0a20 2064 6172 6b50 6978 656c 7320  s..  darkPixels 
-0000bea0: 3d20 696d 6167 652e 7365 6c65 6374 285b  = image.select([
-0000beb0: 276e 6972 272c 2773 7769 7231 272c 2773  'nir','swir1','s
-0000bec0: 7769 7232 275d 292e 7265 6475 6365 2865  wir2']).reduce(e
-0000bed0: 652e 5265 6475 6365 722e 7375 6d28 2929  e.Reducer.sum())
-0000bee0: 2e6c 7428 6972 5375 6d54 6872 6573 6829  .lt(irSumThresh)
-0000bef0: 5c0d 0a20 2020 202e 666f 6361 6c5f 6d69  \..    .focal_mi
-0000bf00: 6e28 636f 6e74 7261 6374 5069 7865 6c73  n(contractPixels
-0000bf10: 292e 666f 6361 6c5f 6d61 7828 6469 6c61  ).focal_max(dila
-0000bf20: 7465 5069 7865 6c73 290d 0a20 2020 2023  tePixels)..    #
-0000bf30: 2e67 7465 2831 290d 0a0d 0a0d 0a20 2023  .gte(1)......  #
-0000bf40: 4765 7420 7363 616c 6520 6f66 2069 6d61  Get scale of ima
-0000bf50: 6765 0d0a 2020 6e6f 6d69 6e61 6c53 6361  ge..  nominalSca
-0000bf60: 6c65 203d 2063 6c6f 7564 4d61 736b 2e70  le = cloudMask.p
-0000bf70: 726f 6a65 6374 696f 6e28 292e 6e6f 6d69  rojection().nomi
-0000bf80: 6e61 6c53 6361 6c65 2829 0d0a 2020 2346  nalScale()..  #F
-0000bf90: 696e 6420 7768 6572 6520 636c 6f75 6420  ind where cloud 
-0000bfa0: 7368 6164 6f77 7320 7368 6f75 6c64 2062  shadows should b
-0000bfb0: 6520 6261 7365 6420 6f6e 2073 6f6c 6172  e based on solar
-0000bfc0: 2067 656f 6d65 7472 790d 0a20 2023 436f   geometry..  #Co
-0000bfd0: 6e76 6572 7420 746f 2072 6164 6961 6e73  nvert to radians
-0000bfe0: 0d0a 2020 617a 5220 3d65 652e 4e75 6d62  ..  azR =ee.Numb
-0000bff0: 6572 286d 6561 6e41 7a69 6d75 7468 292e  er(meanAzimuth).
-0000c000: 6164 6428 3138 3029 2e6d 756c 7469 706c  add(180).multipl
-0000c010: 7928 4d61 7468 2e50 4929 2e64 6976 6964  y(Math.PI).divid
-0000c020: 6528 3138 302e 3029 0d0a 2020 7a65 6e52  e(180.0)..  zenR
-0000c030: 2020 3d65 652e 4e75 6d62 6572 286d 6561    =ee.Number(mea
-0000c040: 6e5a 656e 6974 6829 2e6d 756c 7469 706c  nZenith).multipl
-0000c050: 7928 4d61 7468 2e50 4929 2e64 6976 6964  y(Math.PI).divid
-0000c060: 6528 3138 302e 3029 0d0a 0d0a 0d0a 2020  e(180.0)......  
-0000c070: 6465 6620 6361 7374 5368 6164 6f77 7328  def castShadows(
-0000c080: 636c 6f75 6448 6569 6768 7429 3a0d 0a20  cloudHeight):.. 
-0000c090: 2020 2063 6c6f 7564 4865 6967 6874 203d     cloudHeight =
-0000c0a0: 2065 652e 4e75 6d62 6572 2863 6c6f 7564   ee.Number(cloud
-0000c0b0: 4865 6967 6874 290d 0a20 2020 2073 6861  Height)..    sha
-0000c0c0: 646f 7743 6173 7465 6444 6973 7461 6e63  dowCastedDistanc
-0000c0d0: 6520 3d20 7a65 6e52 2e74 616e 2829 2e6d  e = zenR.tan().m
-0000c0e0: 756c 7469 706c 7928 636c 6f75 6448 6569  ultiply(cloudHei
-0000c0f0: 6768 7429 2344 6973 7461 6e63 6520 7368  ght)#Distance sh
-0000c100: 6164 6f77 2069 7320 6361 7374 0d0a 2020  adow is cast..  
-0000c110: 2020 7820 3d20 617a 522e 7369 6e28 292e    x = azR.sin().
-0000c120: 6d75 6c74 6970 6c79 2873 6861 646f 7743  multiply(shadowC
-0000c130: 6173 7465 6444 6973 7461 6e63 6529 2e64  astedDistance).d
-0000c140: 6976 6964 6528 6e6f 6d69 6e61 6c53 6361  ivide(nominalSca
-0000c150: 6c65 2923 5820 6469 7374 616e 6365 206f  le)#X distance o
-0000c160: 6620 7368 6164 6f77 0d0a 2020 2020 7920  f shadow..    y 
-0000c170: 3d20 617a 522e 636f 7328 292e 6d75 6c74  = azR.cos().mult
-0000c180: 6970 6c79 2873 6861 646f 7743 6173 7465  iply(shadowCaste
-0000c190: 6444 6973 7461 6e63 6529 2e64 6976 6964  dDistance).divid
-0000c1a0: 6528 6e6f 6d69 6e61 6c53 6361 6c65 292e  e(nominalScale).
-0000c1b0: 6d75 6c74 6970 6c79 2879 4d75 6c74 293b  multiply(yMult);
-0000c1c0: 2359 2064 6973 7461 6e63 6520 6f66 2073  #Y distance of s
-0000c1d0: 6861 646f 770d 0a20 2020 2072 6574 7572  hadow..    retur
-0000c1e0: 6e20 636c 6f75 644d 6173 6b2e 6368 616e  n cloudMask.chan
-0000c1f0: 6765 5072 6f6a 2863 6c6f 7564 4d61 736b  geProj(cloudMask
-0000c200: 2e70 726f 6a65 6374 696f 6e28 292c 2063  .projection(), c
-0000c210: 6c6f 7564 4d61 736b 2e70 726f 6a65 6374  loudMask.project
-0000c220: 696f 6e28 292e 7472 616e 736c 6174 6528  ion().translate(
-0000c230: 782c 2079 2929 0d0a 0d0a 0d0a 2020 2346  x, y))......  #F
-0000c240: 696e 6420 7468 6520 7368 6164 6f77 730d  ind the shadows.
-0000c250: 0a20 2073 6861 646f 7773 203d 2063 6c6f  .  shadows = clo
-0000c260: 7564 4865 6967 6874 732e 6d61 7028 6361  udHeights.map(ca
-0000c270: 7374 5368 6164 6f77 7329 0d0a 0d0a 2020  stShadows)....  
-0000c280: 7368 6164 6f77 4d61 736b 203d 2065 652e  shadowMask = ee.
-0000c290: 496d 6167 6543 6f6c 6c65 6374 696f 6e2e  ImageCollection.
-0000c2a0: 6672 6f6d 496d 6167 6573 2873 6861 646f  fromImages(shado
-0000c2b0: 7773 292e 6d61 7828 290d 0a0d 0a20 2023  ws).max()....  #
-0000c2c0: 4372 6561 7465 2073 6861 646f 7720 6d61  Create shadow ma
-0000c2d0: 736b 0d0a 2020 7368 6164 6f77 4d61 736b  sk..  shadowMask
-0000c2e0: 203d 2073 6861 646f 774d 6173 6b2e 416e   = shadowMask.An
-0000c2f0: 6428 636c 6f75 644d 6173 6b2e 4e6f 7428  d(cloudMask.Not(
-0000c300: 2929 0d0a 2020 7368 6164 6f77 4d61 736b  ))..  shadowMask
-0000c310: 203d 2073 6861 646f 774d 6173 6b2e 416e   = shadowMask.An
-0000c320: 6428 6461 726b 5069 7865 6c73 292e 666f  d(darkPixels).fo
-0000c330: 6361 6c5f 6d69 6e28 636f 6e74 7261 6374  cal_min(contract
-0000c340: 5069 7865 6c73 292e 666f 6361 6c5f 6d61  Pixels).focal_ma
-0000c350: 7828 6469 6c61 7465 5069 7865 6c73 290d  x(dilatePixels).
-0000c360: 0a20 2023 4d61 702e 6164 644c 6179 6572  .  #Map.addLayer
-0000c370: 2863 6c6f 7564 4d61 736b 2e75 7064 6174  (cloudMask.updat
-0000c380: 654d 6173 6b28 636c 6f75 644d 6173 6b29  eMask(cloudMask)
+00005df0: 2030 2c20 305d 5d5c 0d0a 290d 0a0d 0a23   0, 0]]\..)....#
+00005e00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00005e10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00005e20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00005e30: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
+00005e40: 0a23 416c 676f 7269 7468 6d20 746f 2064  .#Algorithm to d
+00005e50: 6566 7269 6e67 6520 4c61 6e64 7361 7420  efringe Landsat 
+00005e60: 7363 656e 6573 0d0a 6465 6620 6465 6672  scenes..def defr
+00005e70: 696e 6765 4c61 6e64 7361 7428 696d 6729  ingeLandsat(img)
+00005e80: 3a0d 0a20 2023 4669 6e64 2061 6e79 2070  :..  #Find any p
+00005e90: 6978 656c 2077 6974 686f 7574 2073 7566  ixel without suf
+00005ea0: 6669 6369 656e 7420 6e6f 6e20 6e75 6c6c  ficient non null
+00005eb0: 2070 6978 656c 7320 2866 7269 6e67 6573   pixels (fringes
+00005ec0: 290d 0a20 206d 203d 2069 6d67 2e6d 6173  )..  m = img.mas
+00005ed0: 6b28 292e 7265 6475 6365 2865 652e 5265  k().reduce(ee.Re
+00005ee0: 6475 6365 722e 6d69 6e28 2929 0d0a 0d0a  ducer.min())....
+00005ef0: 2020 2341 7070 6c79 206b 6572 6e65 6c0d    #Apply kernel.
+00005f00: 0a20 206b 6572 6e65 6c53 756d 203d 206d  .  kernelSum = m
+00005f10: 2e72 6564 7563 654e 6569 6768 626f 7268  .reduceNeighborh
+00005f20: 6f6f 6428 6565 2e52 6564 7563 6572 2e73  ood(ee.Reducer.s
+00005f30: 756d 2829 2c20 6b2c 2027 6b65 726e 656c  um(), k, 'kernel
+00005f40: 2729 0d0a 2020 234d 6170 2e61 6464 4c61  ')..  #Map.addLa
+00005f50: 7965 7228 696d 672c 7669 7a50 6172 616d  yer(img,vizParam
+00005f60: 732c 2777 6974 6820 6672 696e 6765 7327  s,'with fringes'
+00005f70: 290d 0a20 2023 4d61 702e 6164 644c 6179  )..  #Map.addLay
+00005f80: 6572 2873 756d 2c7b 276d 696e 273a 3230  er(sum,{'min':20
+00005f90: 2c27 6d61 7827 3a32 3431 7d2c 2773 756d  ,'max':241},'sum
+00005fa0: 3431 272c 6661 6c73 6529 0d0a 0d0a 2020  41',false)....  
+00005fb0: 234d 6173 6b20 7069 7865 6c73 2077 2f6f  #Mask pixels w/o
+00005fc0: 2073 7566 6669 6369 656e 7420 6f62 730d   sufficient obs.
+00005fd0: 0a20 206b 6572 6e65 6c53 756d 203d 206b  .  kernelSum = k
+00005fe0: 6572 6e65 6c53 756d 2e67 7465 2866 7269  ernelSum.gte(fri
+00005ff0: 6e67 6543 6f75 6e74 5468 7265 7368 6f6c  ngeCountThreshol
+00006000: 6429 0d0a 2020 696d 6720 3d20 696d 672e  d)..  img = img.
+00006010: 6d61 736b 286b 6572 6e65 6c53 756d 290d  mask(kernelSum).
+00006020: 0a20 2023 4d61 702e 6164 644c 6179 6572  .  #Map.addLayer
+00006030: 2869 6d67 2c76 697a 5061 7261 6d73 2c27  (img,vizParams,'
+00006040: 6465 6672 696e 6765 6427 290d 0a20 2072  defringed')..  r
+00006050: 6574 7572 6e20 696d 670d 0a0d 0a0d 0a23  eturn img......#
+00006060: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00006070: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00006080: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00006090: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
+000060a0: 0a23 4675 6e63 7469 6f6e 2074 6f20 6669  .#Function to fi
+000060b0: 6e64 2075 6e69 7175 6520 7661 6c75 6573  nd unique values
+000060c0: 206f 6620 6120 6669 656c 6420 696e 2061   of a field in a
+000060d0: 2063 6f6c 6c65 6374 696f 6e0d 0a64 6566   collection..def
+000060e0: 2075 6e69 7175 6556 616c 7565 7328 636f   uniqueValues(co
+000060f0: 6c6c 6563 7469 6f6e 2c66 6965 6c64 293a  llection,field):
+00006100: 0d0a 2020 7661 6c75 6573 203d 2065 652e  ..  values = ee.
+00006110: 4469 6374 696f 6e61 7279 2863 6f6c 6c65  Dictionary(colle
+00006120: 6374 696f 6e2e 7265 6475 6365 436f 6c75  ction.reduceColu
+00006130: 6d6e 7328 6565 2e52 6564 7563 6572 2e66  mns(ee.Reducer.f
+00006140: 7265 7175 656e 6379 4869 7374 6f67 7261  requencyHistogra
+00006150: 6d28 292c 5b66 6965 6c64 5d29 2e67 6574  m(),[field]).get
+00006160: 2827 6869 7374 6f67 7261 6d27 2929 2e6b  ('histogram')).k
+00006170: 6579 7328 290d 0a20 2072 6574 7572 6e20  eys()..  return 
+00006180: 7661 6c75 6573 0d0a 0d0a 2323 2323 2323  values....######
+00006190: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000061a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000061b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000061c0: 2323 2323 2323 2323 230d 0a23 4675 6e63  #########..#Func
+000061d0: 7469 6f6e 2074 6f20 7369 6d70 6c69 6679  tion to simplify
+000061e0: 2064 6174 6120 696e 746f 2064 6169 6c79   data into daily
+000061f0: 206d 6f73 6169 6373 0d0a 2354 6869 7320   mosaics..#This 
+00006200: 7072 6f63 6564 7572 6520 6d75 7374 2062  procedure must b
+00006210: 6520 7573 6564 2066 6f72 2070 726f 7065  e used for prope
+00006220: 7220 7072 6f63 6573 7369 6e67 206f 6620  r processing of 
+00006230: 5332 2069 6d61 6765 7279 0d0a 6465 6620  S2 imagery..def 
+00006240: 6461 696c 794d 6f73 6169 6373 2869 6d67  dailyMosaics(img
+00006250: 7329 3a0d 0a20 2023 5369 6d70 6c69 6679  s):..  #Simplify
+00006260: 2064 6174 6520 746f 2065 7863 6c75 6465   date to exclude
+00006270: 2074 696d 6520 6f66 2064 6179 0d0a 2020   time of day..  
+00006280: 6465 6620 7072 6f70 5772 6170 7065 7228  def propWrapper(
+00006290: 696d 6729 3a0d 0a20 2020 2064 203d 2065  img):..    d = e
+000062a0: 652e 5374 7269 6e67 2865 652e 4461 7465  e.String(ee.Date
+000062b0: 2869 6d67 2e67 6574 2827 7379 7374 656d  (img.get('system
+000062c0: 3a74 696d 655f 7374 6172 7427 2929 2e66  :time_start')).f
+000062d0: 6f72 6d61 7428 2759 5959 592d 4d4d 2d64  ormat('YYYY-MM-d
+000062e0: 6427 2929 0d0a 2020 2020 6f72 6269 7420  d'))..    orbit 
+000062f0: 3d20 6565 2e4e 756d 6265 7228 696d 672e  = ee.Number(img.
+00006300: 6765 7428 2753 454e 5349 4e47 5f4f 5242  get('SENSING_ORB
+00006310: 4954 5f4e 554d 4245 5227 2929 2e66 6f72  IT_NUMBER')).for
+00006320: 6d61 7428 290d 0a20 2020 2072 6574 7572  mat()..    retur
+00006330: 6e20 696d 672e 7365 7428 7b27 6461 7465  n img.set({'date
+00006340: 2d6f 7262 6974 273a 642e 6361 7428 6565  -orbit':d.cat(ee
+00006350: 2e53 7472 696e 6728 275f 2729 292e 6361  .String('_')).ca
+00006360: 7428 6f72 6269 7429 2c27 6461 7465 273a  t(orbit),'date':
+00006370: 647d 290d 0a20 2069 6d67 7320 3d20 696d  d})..  imgs = im
+00006380: 6773 2e6d 6170 2870 726f 7057 7261 7070  gs.map(propWrapp
+00006390: 6572 290d 0a0d 0a20 2023 4669 6e64 2074  er)....  #Find t
+000063a0: 6865 2075 6e69 7175 6520 6461 7973 0d0a  he unique days..
+000063b0: 2020 6461 794f 7262 6974 7320 203d 2065    dayOrbits  = e
+000063c0: 652e 4469 6374 696f 6e61 7279 2869 6d67  e.Dictionary(img
+000063d0: 732e 6167 6772 6567 6174 655f 6869 7374  s.aggregate_hist
+000063e0: 6f67 7261 6d28 2764 6174 652d 6f72 6269  ogram('date-orbi
+000063f0: 7427 2929 2e6b 6579 7328 290d 0a0d 0a20  t')).keys().... 
+00006400: 2064 6566 2064 6179 5772 6170 7065 7228   def dayWrapper(
+00006410: 6429 3a0d 0a20 2020 2064 6174 6520 3d20  d):..    date = 
+00006420: 6565 2e44 6174 6528 6565 2e53 7472 696e  ee.Date(ee.Strin
+00006430: 6728 6429 2e73 706c 6974 2827 5f27 292e  g(d).split('_').
+00006440: 6765 7428 3029 290d 0a20 2020 206f 7262  get(0))..    orb
+00006450: 6974 203d 2065 652e 4e75 6d62 6572 2e70  it = ee.Number.p
+00006460: 6172 7365 2865 652e 5374 7269 6e67 2864  arse(ee.String(d
+00006470: 292e 7370 6c69 7428 275f 2729 2e67 6574  ).split('_').get
+00006480: 2831 2929 0d0a 2020 2020 7420 3d20 696d  (1))..    t = im
+00006490: 6773 2e66 696c 7465 7244 6174 6528 6461  gs.filterDate(da
+000064a0: 7465 2c64 6174 652e 6164 7661 6e63 6528  te,date.advance(
+000064b0: 312c 2764 6179 2729 295c 0d0a 2020 2020  1,'day'))\..    
+000064c0: 2e66 696c 7465 7228 6565 2e46 696c 7465  .filter(ee.Filte
+000064d0: 722e 6571 2827 5345 4e53 494e 475f 4f52  r.eq('SENSING_OR
+000064e0: 4249 545f 4e55 4d42 4552 272c 6f72 6269  BIT_NUMBER',orbi
+000064f0: 7429 290d 0a20 2020 2066 203d 2065 652e  t))..    f = ee.
+00006500: 496d 6167 6528 742e 6669 7273 7428 2929  Image(t.first())
+00006510: 0d0a 2020 2020 7420 3d20 742e 6d6f 7361  ..    t = t.mosa
+00006520: 6963 2829 0d0a 2020 2020 7420 3d20 742e  ic()..    t = t.
+00006530: 7365 7428 2773 7973 7465 6d3a 7469 6d65  set('system:time
+00006540: 5f73 7461 7274 272c 6461 7465 2e6d 696c  _start',date.mil
+00006550: 6c69 7328 2929 0d0a 2020 2020 7420 3d20  lis())..    t = 
+00006560: 742e 636f 7079 5072 6f70 6572 7469 6573  t.copyProperties
+00006570: 2866 290d 0a20 2020 2072 6574 7572 6e20  (f)..    return 
+00006580: 740d 0a20 2069 6d67 7320 3d20 6461 794f  t..  imgs = dayO
+00006590: 7262 6974 732e 6d61 7028 6461 7957 7261  rbits.map(dayWra
+000065a0: 7070 6572 290d 0a20 2069 6d67 7320 3d20  pper)..  imgs = 
+000065b0: 6565 2e49 6d61 6765 436f 6c6c 6563 7469  ee.ImageCollecti
+000065c0: 6f6e 2e66 726f 6d49 6d61 6765 7328 696d  on.fromImages(im
+000065d0: 6773 290d 0a0d 0a20 2072 6574 7572 6e20  gs)....  return 
+000065e0: 696d 6773 0d0a 2323 2323 2323 2323 2323  imgs..##########
+000065f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00006600: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00006610: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00006620: 2323 2323 2323 0d0a 2320 5365 6e74 696e  ######..# Sentin
+00006630: 656c 2031 2070 726f 6365 7373 696e 670d  el 1 processing.
+00006640: 0a23 2041 6461 7074 6564 2066 726f 6d3a  .# Adapted from:
+00006650: 2068 7474 7073 3a2f 2f63 6f64 652e 6561   https://code.ea
+00006660: 7274 6865 6e67 696e 652e 676f 6f67 6c65  rthengine.google
+00006670: 2e63 6f6d 2f33 3961 3361 6435 6163 3539  .com/39a3ad5ac59
+00006680: 6364 3861 6631 3465 3364 6264 3738 3433  cd8af14e3dbd7843
+00006690: 3664 3262 350d 0a23 2041 7574 686f 723a  6d2b5..# Author:
+000066a0: 2057 6172 7265 6e20 5363 6f74 740d 0a0d   Warren Scott...
+000066b0: 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  .#--------------
+000066c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000066d0: 2d2d 2d2d 2d2d 2d2d 2d20 4445 4649 4e45  --------- DEFINE
+000066e0: 2053 5045 434b 4c45 4655 4e43 5449 4f4e   SPECKLEFUNCTION
+000066f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00006700: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00006710: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00006720: 2d2d 2d2a 2f0d 0a0d 0a23 2053 6967 6d61  ---*/....# Sigma
+00006730: 204c 6565 2066 696c 7465 720d 0a64 6566   Lee filter..def
+00006740: 2074 6f4e 6174 7572 616c 2869 6d67 293a   toNatural(img):
+00006750: 0d0a 2020 7265 7475 726e 2065 652e 496d  ..  return ee.Im
+00006760: 6167 6528 3130 2e30 292e 706f 7728 696d  age(10.0).pow(im
+00006770: 672e 7365 6c65 6374 2830 292e 6469 7669  g.select(0).divi
+00006780: 6465 2831 302e 3029 290d 0a64 6566 2074  de(10.0))..def t
+00006790: 6f44 4228 696d 6729 3a0d 0a20 2072 6574  oDB(img):..  ret
+000067a0: 7572 6e20 6565 2e49 6d61 6765 2869 6d67  urn ee.Image(img
+000067b0: 292e 6c6f 6731 3028 292e 6d75 6c74 6970  ).log10().multip
+000067c0: 6c79 2831 302e 3029 0d0a 0d0a 0d0a 2320  ly(10.0)......# 
+000067d0: 5468 6520 524c 2073 7065 636b 6c65 2066  The RL speckle f
+000067e0: 696c 7465 7220 6672 6f6d 2068 7474 7073  ilter from https
+000067f0: 3a2f 2f63 6f64 652e 6561 7274 6865 6e67  ://code.eartheng
+00006800: 696e 652e 676f 6f67 6c65 2e63 6f6d 2f32  ine.google.com/2
+00006810: 6566 3338 3436 3365 6261 6635 6165 3133  ef38463ebaf5ae13
+00006820: 3361 3437 3866 3137 3366 6430 6162 3520  3a478f173fd0ab5 
+00006830: 6279 2047 7569 646f 204c 656d 6f69 6e65  by Guido Lemoine
+00006840: 0d0a 2320 4173 2063 6f64 6564 2069 6e20  ..# As coded in 
+00006850: 7468 6520 534e 4150 2033 2e30 2053 3154  the SNAP 3.0 S1T
+00006860: 4258 3a0d 0a64 6566 2052 6566 696e 6564  BX:..def Refined
+00006870: 4c65 6528 696d 6729 3a20 0d0a 2020 2320  Lee(img): ..  # 
+00006880: 696d 6720 6d75 7374 2062 6520 696e 206e  img must be in n
+00006890: 6174 7572 616c 2075 6e69 7473 2c20 692e  atural units, i.
+000068a0: 652e 206e 6f74 2069 6e20 6442 210d 0a20  e. not in dB!.. 
+000068b0: 2023 2053 6574 2075 7020 3378 3320 6b65   # Set up 3x3 ke
+000068c0: 726e 656c 7320 0d0a 2020 7765 6967 6874  rnels ..  weight
+000068d0: 7333 203d 2065 652e 4c69 7374 2e72 6570  s3 = ee.List.rep
+000068e0: 6561 7428 6565 2e4c 6973 742e 7265 7065  eat(ee.List.repe
+000068f0: 6174 2831 2c33 292c 3329 0d0a 2020 6b65  at(1,3),3)..  ke
+00006900: 726e 656c 3320 3d20 6565 2e4b 6572 6e65  rnel3 = ee.Kerne
+00006910: 6c2e 6669 7865 6428 332c 332c 2077 6569  l.fixed(3,3, wei
+00006920: 6768 7473 332c 2031 2c20 312c 2046 616c  ghts3, 1, 1, Fal
+00006930: 7365 290d 0a0d 0a20 206d 6561 6e33 203d  se)....  mean3 =
+00006940: 2069 6d67 2e72 6564 7563 654e 6569 6768   img.reduceNeigh
+00006950: 626f 7268 6f6f 6428 6565 2e52 6564 7563  borhood(ee.Reduc
+00006960: 6572 2e6d 6561 6e28 292c 206b 6572 6e65  er.mean(), kerne
+00006970: 6c33 290d 0a20 2076 6172 6961 6e63 6533  l3)..  variance3
+00006980: 203d 2069 6d67 2e72 6564 7563 654e 6569   = img.reduceNei
+00006990: 6768 626f 7268 6f6f 6428 6565 2e52 6564  ghborhood(ee.Red
+000069a0: 7563 6572 2e76 6172 6961 6e63 6528 292c  ucer.variance(),
+000069b0: 206b 6572 6e65 6c33 290d 0a0d 0a20 2023   kernel3)....  #
+000069c0: 2055 7365 2061 2073 616d 706c 6520 6f66   Use a sample of
+000069d0: 2074 6865 2033 7833 2077 696e 646f 7773   the 3x3 windows
+000069e0: 2069 6e73 6964 6520 6120 3778 3720 7769   inside a 7x7 wi
+000069f0: 6e64 6f77 7320 746f 2064 6574 6572 6d69  ndows to determi
+00006a00: 6e65 2067 7261 6469 656e 7473 2061 6e64  ne gradients and
+00006a10: 2064 6972 6563 7469 6f6e 730d 0a20 2073   directions..  s
+00006a20: 616d 706c 655f 7765 6967 6874 7320 3d20  ample_weights = 
+00006a30: 6565 2e4c 6973 7428 5b5b 302c 302c 302c  ee.List([[0,0,0,
+00006a40: 302c 302c 302c 305d 2c20 5b30 2c31 2c30  0,0,0,0], [0,1,0
+00006a50: 2c31 2c30 2c31 2c30 5d2c 5b30 2c30 2c30  ,1,0,1,0],[0,0,0
+00006a60: 2c30 2c30 2c30 2c30 5d2c 200d 0a20 2020  ,0,0,0,0], ..   
+00006a70: 205b 302c 312c 302c 312c 302c 312c 305d   [0,1,0,1,0,1,0]
+00006a80: 2c20 5b30 2c30 2c30 2c30 2c30 2c30 2c30  , [0,0,0,0,0,0,0
+00006a90: 5d2c 205b 302c 312c 302c 312c 302c 312c  ], [0,1,0,1,0,1,
+00006aa0: 305d 2c5b 302c 302c 302c 302c 302c 302c  0],[0,0,0,0,0,0,
+00006ab0: 305d 5d29 0d0a 0d0a 2020 7361 6d70 6c65  0]])....  sample
+00006ac0: 5f6b 6572 6e65 6c20 3d20 6565 2e4b 6572  _kernel = ee.Ker
+00006ad0: 6e65 6c2e 6669 7865 6428 372c 372c 2073  nel.fixed(7,7, s
+00006ae0: 616d 706c 655f 7765 6967 6874 732c 2033  ample_weights, 3
+00006af0: 2c33 2c20 4661 6c73 6529 0d0a 0d0a 2020  ,3, False)....  
+00006b00: 2320 4361 6c63 756c 6174 6520 6d65 616e  # Calculate mean
+00006b10: 2061 6e64 2076 6172 6961 6e63 6520 666f   and variance fo
+00006b20: 7220 7468 6520 7361 6d70 6c65 6420 7769  r the sampled wi
+00006b30: 6e64 6f77 7320 616e 6420 7374 6f72 6520  ndows and store 
+00006b40: 6173 2039 2062 616e 6473 0d0a 2020 7361  as 9 bands..  sa
+00006b50: 6d70 6c65 5f6d 6561 6e20 3d20 6d65 616e  mple_mean = mean
+00006b60: 332e 6e65 6967 6862 6f72 686f 6f64 546f  3.neighborhoodTo
+00006b70: 4261 6e64 7328 7361 6d70 6c65 5f6b 6572  Bands(sample_ker
+00006b80: 6e65 6c29 0d0a 2020 7361 6d70 6c65 5f76  nel)..  sample_v
+00006b90: 6172 203d 2076 6172 6961 6e63 6533 2e6e  ar = variance3.n
+00006ba0: 6569 6768 626f 7268 6f6f 6454 6f42 616e  eighborhoodToBan
+00006bb0: 6473 2873 616d 706c 655f 6b65 726e 656c  ds(sample_kernel
+00006bc0: 290d 0a0d 0a20 2023 2044 6574 6572 6d69  )....  # Determi
+00006bd0: 6e65 2074 6865 2034 2067 7261 6469 656e  ne the 4 gradien
+00006be0: 7473 2066 6f72 2074 6865 2073 616d 706c  ts for the sampl
+00006bf0: 6564 2077 696e 646f 7773 0d0a 2020 6772  ed windows..  gr
+00006c00: 6164 6965 6e74 7320 3d20 7361 6d70 6c65  adients = sample
+00006c10: 5f6d 6561 6e2e 7365 6c65 6374 2831 292e  _mean.select(1).
+00006c20: 7375 6274 7261 6374 2873 616d 706c 655f  subtract(sample_
+00006c30: 6d65 616e 2e73 656c 6563 7428 3729 292e  mean.select(7)).
+00006c40: 6162 7328 290d 0a20 2067 7261 6469 656e  abs()..  gradien
+00006c50: 7473 203d 2067 7261 6469 656e 7473 2e61  ts = gradients.a
+00006c60: 6464 4261 6e64 7328 7361 6d70 6c65 5f6d  ddBands(sample_m
+00006c70: 6561 6e2e 7365 6c65 6374 2836 292e 7375  ean.select(6).su
+00006c80: 6274 7261 6374 2873 616d 706c 655f 6d65  btract(sample_me
+00006c90: 616e 2e73 656c 6563 7428 3229 292e 6162  an.select(2)).ab
+00006ca0: 7328 2929 0d0a 2020 6772 6164 6965 6e74  s())..  gradient
+00006cb0: 7320 3d20 6772 6164 6965 6e74 732e 6164  s = gradients.ad
+00006cc0: 6442 616e 6473 2873 616d 706c 655f 6d65  dBands(sample_me
+00006cd0: 616e 2e73 656c 6563 7428 3329 2e73 7562  an.select(3).sub
+00006ce0: 7472 6163 7428 7361 6d70 6c65 5f6d 6561  tract(sample_mea
+00006cf0: 6e2e 7365 6c65 6374 2835 2929 2e61 6273  n.select(5)).abs
+00006d00: 2829 290d 0a20 2067 7261 6469 656e 7473  ())..  gradients
+00006d10: 203d 2067 7261 6469 656e 7473 2e61 6464   = gradients.add
+00006d20: 4261 6e64 7328 7361 6d70 6c65 5f6d 6561  Bands(sample_mea
+00006d30: 6e2e 7365 6c65 6374 2830 292e 7375 6274  n.select(0).subt
+00006d40: 7261 6374 2873 616d 706c 655f 6d65 616e  ract(sample_mean
+00006d50: 2e73 656c 6563 7428 3829 292e 6162 7328  .select(8)).abs(
+00006d60: 2929 0d0a 0d0a 2020 2320 416e 6420 6669  ))....  # And fi
+00006d70: 6e64 2074 6865 206d 6178 696d 756d 2067  nd the maximum g
+00006d80: 7261 6469 656e 7420 616d 6f6e 6773 7420  radient amongst 
+00006d90: 6772 6164 6965 6e74 2062 616e 6473 0d0a  gradient bands..
+00006da0: 2020 6d61 785f 6772 6164 6965 6e74 203d    max_gradient =
+00006db0: 2067 7261 6469 656e 7473 2e72 6564 7563   gradients.reduc
+00006dc0: 6528 6565 2e52 6564 7563 6572 2e6d 6178  e(ee.Reducer.max
+00006dd0: 2829 290d 0a0d 0a20 2023 2043 7265 6174  ())....  # Creat
+00006de0: 6520 6120 6d61 736b 2066 6f72 2062 616e  e a mask for ban
+00006df0: 6420 7069 7865 6c73 2074 6861 7420 6172  d pixels that ar
+00006e00: 6520 7468 6520 6d61 7869 6d75 6d20 6772  e the maximum gr
+00006e10: 6164 6965 6e74 0d0a 2020 6772 6164 6d61  adient..  gradma
+00006e20: 736b 203d 2067 7261 6469 656e 7473 2e65  sk = gradients.e
+00006e30: 7128 6d61 785f 6772 6164 6965 6e74 290d  q(max_gradient).
+00006e40: 0a0d 0a20 2023 2064 7570 6c69 6361 7465  ...  # duplicate
+00006e50: 2067 7261 646d 6173 6b20 6261 6e64 733a   gradmask bands:
+00006e60: 2065 6163 6820 6772 6164 6965 6e74 2072   each gradient r
+00006e70: 6570 7265 7365 6e74 7320 3220 6469 7265  epresents 2 dire
+00006e80: 6374 696f 6e73 0d0a 2020 6772 6164 6d61  ctions..  gradma
+00006e90: 736b 203d 2067 7261 646d 6173 6b2e 6164  sk = gradmask.ad
+00006ea0: 6442 616e 6473 2867 7261 646d 6173 6b29  dBands(gradmask)
+00006eb0: 0d0a 0d0a 2020 2320 4465 7465 726d 696e  ....  # Determin
+00006ec0: 6520 7468 6520 3820 6469 7265 6374 696f  e the 8 directio
+00006ed0: 6e73 0d0a 2020 6469 7265 6374 696f 6e73  ns..  directions
+00006ee0: 203d 2073 616d 706c 655f 6d65 616e 2e73   = sample_mean.s
+00006ef0: 656c 6563 7428 3129 2e73 7562 7472 6163  elect(1).subtrac
+00006f00: 7428 7361 6d70 6c65 5f6d 6561 6e2e 7365  t(sample_mean.se
+00006f10: 6c65 6374 2834 2929 5c0d 0a20 2020 202e  lect(4))\..    .
+00006f20: 6774 2873 616d 706c 655f 6d65 616e 2e73  gt(sample_mean.s
+00006f30: 656c 6563 7428 3429 2e73 7562 7472 6163  elect(4).subtrac
+00006f40: 7428 7361 6d70 6c65 5f6d 6561 6e2e 7365  t(sample_mean.se
+00006f50: 6c65 6374 2837 2929 292e 6d75 6c74 6970  lect(7))).multip
+00006f60: 6c79 2831 290d 0a20 2064 6972 6563 7469  ly(1)..  directi
+00006f70: 6f6e 7320 3d20 6469 7265 6374 696f 6e73  ons = directions
+00006f80: 2e61 6464 4261 6e64 7328 7361 6d70 6c65  .addBands(sample
+00006f90: 5f6d 6561 6e2e 7365 6c65 6374 2836 292e  _mean.select(6).
+00006fa0: 7375 6274 7261 6374 2873 616d 706c 655f  subtract(sample_
+00006fb0: 6d65 616e 2e73 656c 6563 7428 3429 295c  mean.select(4))\
+00006fc0: 0d0a 2020 2020 2e67 7428 7361 6d70 6c65  ..    .gt(sample
+00006fd0: 5f6d 6561 6e2e 7365 6c65 6374 2834 292e  _mean.select(4).
+00006fe0: 7375 6274 7261 6374 2873 616d 706c 655f  subtract(sample_
+00006ff0: 6d65 616e 2e73 656c 6563 7428 3229 2929  mean.select(2)))
+00007000: 2e6d 756c 7469 706c 7928 3229 290d 0a20  .multiply(2)).. 
+00007010: 2064 6972 6563 7469 6f6e 7320 3d20 6469   directions = di
+00007020: 7265 6374 696f 6e73 2e61 6464 4261 6e64  rections.addBand
+00007030: 7328 7361 6d70 6c65 5f6d 6561 6e2e 7365  s(sample_mean.se
+00007040: 6c65 6374 2833 292e 7375 6274 7261 6374  lect(3).subtract
+00007050: 2873 616d 706c 655f 6d65 616e 2e73 656c  (sample_mean.sel
+00007060: 6563 7428 3429 295c 0d0a 2020 2020 2e67  ect(4))\..    .g
+00007070: 7428 7361 6d70 6c65 5f6d 6561 6e2e 7365  t(sample_mean.se
+00007080: 6c65 6374 2834 292e 7375 6274 7261 6374  lect(4).subtract
+00007090: 2873 616d 706c 655f 6d65 616e 2e73 656c  (sample_mean.sel
+000070a0: 6563 7428 3529 2929 2e6d 756c 7469 706c  ect(5))).multipl
+000070b0: 7928 3329 290d 0a20 2064 6972 6563 7469  y(3))..  directi
+000070c0: 6f6e 7320 3d20 6469 7265 6374 696f 6e73  ons = directions
+000070d0: 2e61 6464 4261 6e64 7328 7361 6d70 6c65  .addBands(sample
+000070e0: 5f6d 6561 6e2e 7365 6c65 6374 2830 292e  _mean.select(0).
+000070f0: 7375 6274 7261 6374 2873 616d 706c 655f  subtract(sample_
+00007100: 6d65 616e 2e73 656c 6563 7428 3429 295c  mean.select(4))\
+00007110: 0d0a 2020 2020 2e67 7428 7361 6d70 6c65  ..    .gt(sample
+00007120: 5f6d 6561 6e2e 7365 6c65 6374 2834 292e  _mean.select(4).
+00007130: 7375 6274 7261 6374 2873 616d 706c 655f  subtract(sample_
+00007140: 6d65 616e 2e73 656c 6563 7428 3829 2929  mean.select(8)))
+00007150: 2e6d 756c 7469 706c 7928 3429 290d 0a20  .multiply(4)).. 
+00007160: 2020 200d 0a20 2023 2054 6865 206e 6578     ..  # The nex
+00007170: 7420 3420 6172 6520 7468 6520 6e6f 7428  t 4 are the not(
+00007180: 2920 6f66 2074 6865 2070 7265 7669 6f75  ) of the previou
+00007190: 7320 340d 0a20 2064 6972 6563 7469 6f6e  s 4..  direction
+000071a0: 7320 3d20 6469 7265 6374 696f 6e73 2e61  s = directions.a
+000071b0: 6464 4261 6e64 7328 6469 7265 6374 696f  ddBands(directio
+000071c0: 6e73 2e73 656c 6563 7428 3029 2e4e 6f74  ns.select(0).Not
+000071d0: 2829 2e6d 756c 7469 706c 7928 3529 290d  ().multiply(5)).
+000071e0: 0a20 2064 6972 6563 7469 6f6e 7320 3d20  .  directions = 
+000071f0: 6469 7265 6374 696f 6e73 2e61 6464 4261  directions.addBa
+00007200: 6e64 7328 6469 7265 6374 696f 6e73 2e73  nds(directions.s
+00007210: 656c 6563 7428 3129 2e4e 6f74 2829 2e6d  elect(1).Not().m
+00007220: 756c 7469 706c 7928 3629 290d 0a20 2064  ultiply(6))..  d
+00007230: 6972 6563 7469 6f6e 7320 3d20 6469 7265  irections = dire
+00007240: 6374 696f 6e73 2e61 6464 4261 6e64 7328  ctions.addBands(
+00007250: 6469 7265 6374 696f 6e73 2e73 656c 6563  directions.selec
+00007260: 7428 3229 2e4e 6f74 2829 2e6d 756c 7469  t(2).Not().multi
+00007270: 706c 7928 3729 290d 0a20 2064 6972 6563  ply(7))..  direc
+00007280: 7469 6f6e 7320 3d20 6469 7265 6374 696f  tions = directio
+00007290: 6e73 2e61 6464 4261 6e64 7328 6469 7265  ns.addBands(dire
+000072a0: 6374 696f 6e73 2e73 656c 6563 7428 3329  ctions.select(3)
+000072b0: 2e4e 6f74 2829 2e6d 756c 7469 706c 7928  .Not().multiply(
+000072c0: 3829 290d 0a0d 0a20 2023 204d 6173 6b20  8))....  # Mask 
+000072d0: 616c 6c20 7661 6c75 6573 2074 6861 7420  all values that 
+000072e0: 6172 6520 6e6f 7420 312d 380d 0a20 2064  are not 1-8..  d
+000072f0: 6972 6563 7469 6f6e 7320 3d20 6469 7265  irections = dire
+00007300: 6374 696f 6e73 2e75 7064 6174 654d 6173  ctions.updateMas
+00007310: 6b28 6772 6164 6d61 736b 290d 0a0d 0a20  k(gradmask).... 
+00007320: 2023 2022 636f 6c6c 6170 7365 2220 7468   # "collapse" th
+00007330: 6520 7374 6163 6b20 696e 746f 2061 2073  e stack into a s
+00007340: 696e 6765 2062 616e 6420 696d 6167 6520  inge band image 
+00007350: 2864 7565 2074 6f20 6d61 736b 696e 672c  (due to masking,
+00007360: 2065 6163 6820 7069 7865 6c20 6861 7320   each pixel has 
+00007370: 6a75 7374 206f 6e65 2076 616c 7565 2028  just one value (
+00007380: 312d 3829 2069 6e20 6974 2773 2064 6972  1-8) in it's dir
+00007390: 6563 7469 6f6e 616c 2062 616e 642c 2061  ectional band, a
+000073a0: 6e64 2069 7320 6f74 6865 7277 6973 6520  nd is otherwise 
+000073b0: 6d61 736b 6564 290d 0a20 2064 6972 6563  masked)..  direc
+000073c0: 7469 6f6e 7320 3d20 6469 7265 6374 696f  tions = directio
+000073d0: 6e73 2e72 6564 7563 6528 6565 2e52 6564  ns.reduce(ee.Red
+000073e0: 7563 6572 2e73 756d 2829 2920 200d 0a0d  ucer.sum())  ...
+000073f0: 0a20 2023 2076 6172 2070 616c 203d 205b  .  # var pal = [
+00007400: 2766 6666 6666 6627 2c27 6666 3030 3030  'ffffff','ff0000
+00007410: 272c 2766 6666 6630 3027 2c20 2730 3066  ','ffff00', '00f
+00007420: 6630 3027 2c20 2730 3066 6666 6627 2c20  f00', '00ffff', 
+00007430: 2730 3030 3066 6627 2c20 2766 6630 3066  '0000ff', 'ff00f
+00007440: 6627 2c20 2730 3030 3030 3027 5d3b 0d0a  f', '000000'];..
+00007450: 2020 2320 4d61 702e 6164 644c 6179 6572    # Map.addLayer
+00007460: 2864 6972 6563 7469 6f6e 732e 7265 6475  (directions.redu
+00007470: 6365 2865 652e 5265 6475 6365 722e 7375  ce(ee.Reducer.su
+00007480: 6d28 2929 2c20 7b6d 696e 3a31 2c20 6d61  m()), {min:1, ma
+00007490: 783a 382c 2070 616c 6574 7465 3a20 7061  x:8, palette: pa
+000074a0: 6c7d 2c20 2744 6972 6563 7469 6f6e 7327  l}, 'Directions'
+000074b0: 2c20 6661 6c73 6529 3b0d 0a0d 0a20 2073  , false);....  s
+000074c0: 616d 706c 655f 7374 6174 7320 3d20 7361  ample_stats = sa
+000074d0: 6d70 6c65 5f76 6172 2e64 6976 6964 6528  mple_var.divide(
+000074e0: 7361 6d70 6c65 5f6d 6561 6e2e 6d75 6c74  sample_mean.mult
+000074f0: 6970 6c79 2873 616d 706c 655f 6d65 616e  iply(sample_mean
+00007500: 2929 0d0a 0d0a 2020 2320 4361 6c63 756c  ))....  # Calcul
+00007510: 6174 6520 6c6f 6361 6c4e 6f69 7365 5661  ate localNoiseVa
+00007520: 7269 616e 6365 0d0a 2020 7369 676d 6156  riance..  sigmaV
+00007530: 203d 2073 616d 706c 655f 7374 6174 732e   = sample_stats.
+00007540: 746f 4172 7261 7928 292e 6172 7261 7953  toArray().arrayS
+00007550: 6f72 7428 292e 6172 7261 7953 6c69 6365  ort().arraySlice
+00007560: 2830 2c30 2c35 292e 6172 7261 7952 6564  (0,0,5).arrayRed
+00007570: 7563 6528 6565 2e52 6564 7563 6572 2e6d  uce(ee.Reducer.m
+00007580: 6561 6e28 292c 205b 305d 290d 0a0d 0a20  ean(), [0]).... 
+00007590: 2023 2053 6574 2075 7020 7468 6520 372a   # Set up the 7*
+000075a0: 3720 6b65 726e 656c 7320 666f 7220 6469  7 kernels for di
+000075b0: 7265 6374 696f 6e61 6c20 7374 6174 6973  rectional statis
+000075c0: 7469 6373 0d0a 2020 7265 6374 5f77 6569  tics..  rect_wei
+000075d0: 6768 7473 203d 2065 652e 4c69 7374 2e72  ghts = ee.List.r
+000075e0: 6570 6561 7428 6565 2e4c 6973 742e 7265  epeat(ee.List.re
+000075f0: 7065 6174 2830 2c37 292c 3329 2e63 6174  peat(0,7),3).cat
+00007600: 2865 652e 4c69 7374 2e72 6570 6561 7428  (ee.List.repeat(
+00007610: 6565 2e4c 6973 742e 7265 7065 6174 2831  ee.List.repeat(1
+00007620: 2c37 292c 3429 290d 0a0d 0a20 2064 6961  ,7),4))....  dia
+00007630: 675f 7765 6967 6874 7320 3d20 6565 2e4c  g_weights = ee.L
+00007640: 6973 7428 5b5b 312c 302c 302c 302c 302c  ist([[1,0,0,0,0,
+00007650: 302c 305d 2c20 5b31 2c31 2c30 2c30 2c30  0,0], [1,1,0,0,0
+00007660: 2c30 2c30 5d2c 205b 312c 312c 312c 302c  ,0,0], [1,1,1,0,
+00007670: 302c 302c 305d 2c5b 312c 312c 312c 312c  0,0,0],[1,1,1,1,
+00007680: 302c 302c 305d 2c20 5b31 2c31 2c31 2c31  0,0,0], [1,1,1,1
+00007690: 2c31 2c30 2c30 5d2c 205b 312c 312c 312c  ,1,0,0], [1,1,1,
+000076a0: 312c 312c 312c 305d 2c20 5b31 2c31 2c31  1,1,1,0], [1,1,1
+000076b0: 2c31 2c31 2c31 2c31 5d5d 290d 0a0d 0a20  ,1,1,1,1]]).... 
+000076c0: 2072 6563 745f 6b65 726e 656c 203d 2065   rect_kernel = e
+000076d0: 652e 4b65 726e 656c 2e66 6978 6564 2837  e.Kernel.fixed(7
+000076e0: 2c37 2c20 7265 6374 5f77 6569 6768 7473  ,7, rect_weights
+000076f0: 2c20 332c 2033 2c20 4661 6c73 6529 0d0a  , 3, 3, False)..
+00007700: 2020 6469 6167 5f6b 6572 6e65 6c20 3d20    diag_kernel = 
+00007710: 6565 2e4b 6572 6e65 6c2e 6669 7865 6428  ee.Kernel.fixed(
+00007720: 372c 372c 2064 6961 675f 7765 6967 6874  7,7, diag_weight
+00007730: 732c 2033 2c20 332c 2046 616c 7365 290d  s, 3, 3, False).
+00007740: 0a0d 0a20 2023 2043 7265 6174 6520 7374  ...  # Create st
+00007750: 6163 6b73 2066 6f72 206d 6561 6e20 616e  acks for mean an
+00007760: 6420 7661 7269 616e 6365 2075 7369 6e67  d variance using
+00007770: 2074 6865 206f 7269 6769 6e61 6c20 6b65   the original ke
+00007780: 726e 656c 732e 204d 6173 6b20 7769 7468  rnels. Mask with
+00007790: 2072 656c 6576 616e 7420 6469 7265 6374   relevant direct
+000077a0: 696f 6e2e 0d0a 2020 6469 725f 6d65 616e  ion...  dir_mean
+000077b0: 203d 2069 6d67 2e72 6564 7563 654e 6569   = img.reduceNei
+000077c0: 6768 626f 7268 6f6f 6428 6565 2e52 6564  ghborhood(ee.Red
+000077d0: 7563 6572 2e6d 6561 6e28 292c 2072 6563  ucer.mean(), rec
+000077e0: 745f 6b65 726e 656c 292e 7570 6461 7465  t_kernel).update
+000077f0: 4d61 736b 2864 6972 6563 7469 6f6e 732e  Mask(directions.
+00007800: 6571 2831 2929 0d0a 2020 6469 725f 7661  eq(1))..  dir_va
+00007810: 7220 3d20 696d 672e 7265 6475 6365 4e65  r = img.reduceNe
+00007820: 6967 6862 6f72 686f 6f64 2865 652e 5265  ighborhood(ee.Re
+00007830: 6475 6365 722e 7661 7269 616e 6365 2829  ducer.variance()
+00007840: 2c20 7265 6374 5f6b 6572 6e65 6c29 2e75  , rect_kernel).u
+00007850: 7064 6174 654d 6173 6b28 6469 7265 6374  pdateMask(direct
+00007860: 696f 6e73 2e65 7128 3129 290d 0a0d 0a20  ions.eq(1)).... 
+00007870: 2064 6972 5f6d 6561 6e20 3d20 6469 725f   dir_mean = dir_
+00007880: 6d65 616e 2e61 6464 4261 6e64 7328 696d  mean.addBands(im
+00007890: 672e 7265 6475 6365 4e65 6967 6862 6f72  g.reduceNeighbor
+000078a0: 686f 6f64 2865 652e 5265 6475 6365 722e  hood(ee.Reducer.
+000078b0: 6d65 616e 2829 2c20 6469 6167 5f6b 6572  mean(), diag_ker
+000078c0: 6e65 6c29 2e75 7064 6174 654d 6173 6b28  nel).updateMask(
+000078d0: 6469 7265 6374 696f 6e73 2e65 7128 3229  directions.eq(2)
+000078e0: 2929 0d0a 2020 6469 725f 7661 7220 3d20  ))..  dir_var = 
+000078f0: 6469 725f 7661 722e 6164 6442 616e 6473  dir_var.addBands
+00007900: 2869 6d67 2e72 6564 7563 654e 6569 6768  (img.reduceNeigh
+00007910: 626f 7268 6f6f 6428 6565 2e52 6564 7563  borhood(ee.Reduc
+00007920: 6572 2e76 6172 6961 6e63 6528 292c 2064  er.variance(), d
+00007930: 6961 675f 6b65 726e 656c 292e 7570 6461  iag_kernel).upda
+00007940: 7465 4d61 736b 2864 6972 6563 7469 6f6e  teMask(direction
+00007950: 732e 6571 2832 2929 290d 0a0d 0a20 2023  s.eq(2)))....  #
+00007960: 2061 6e64 2061 6464 2074 6865 2062 616e   and add the ban
+00007970: 6473 2066 6f72 2072 6f74 6174 6564 206b  ds for rotated k
+00007980: 6572 6e65 6c73 0d0a 2020 666f 7220 6920  ernels..  for i 
+00007990: 696e 2072 616e 6765 2831 2c34 293a 0d0a  in range(1,4):..
+000079a0: 2020 2020 6469 725f 6d65 616e 203d 2064      dir_mean = d
+000079b0: 6972 5f6d 6561 6e2e 6164 6442 616e 6473  ir_mean.addBands
+000079c0: 2869 6d67 2e72 6564 7563 654e 6569 6768  (img.reduceNeigh
+000079d0: 626f 7268 6f6f 6428 6565 2e52 6564 7563  borhood(ee.Reduc
+000079e0: 6572 2e6d 6561 6e28 292c 2072 6563 745f  er.mean(), rect_
+000079f0: 6b65 726e 656c 2e72 6f74 6174 6528 6929  kernel.rotate(i)
+00007a00: 292e 7570 6461 7465 4d61 736b 2864 6972  ).updateMask(dir
+00007a10: 6563 7469 6f6e 732e 6571 2832 2a69 2b31  ections.eq(2*i+1
+00007a20: 2929 290d 0a20 2020 2064 6972 5f76 6172  )))..    dir_var
+00007a30: 203d 2064 6972 5f76 6172 2e61 6464 4261   = dir_var.addBa
+00007a40: 6e64 7328 696d 672e 7265 6475 6365 4e65  nds(img.reduceNe
+00007a50: 6967 6862 6f72 686f 6f64 2865 652e 5265  ighborhood(ee.Re
+00007a60: 6475 6365 722e 7661 7269 616e 6365 2829  ducer.variance()
+00007a70: 2c20 7265 6374 5f6b 6572 6e65 6c2e 726f  , rect_kernel.ro
+00007a80: 7461 7465 2869 2929 2e75 7064 6174 654d  tate(i)).updateM
+00007a90: 6173 6b28 6469 7265 6374 696f 6e73 2e65  ask(directions.e
+00007aa0: 7128 322a 692b 3129 2929 0d0a 2020 2020  q(2*i+1)))..    
+00007ab0: 6469 725f 6d65 616e 203d 2064 6972 5f6d  dir_mean = dir_m
+00007ac0: 6561 6e2e 6164 6442 616e 6473 2869 6d67  ean.addBands(img
+00007ad0: 2e72 6564 7563 654e 6569 6768 626f 7268  .reduceNeighborh
+00007ae0: 6f6f 6428 6565 2e52 6564 7563 6572 2e6d  ood(ee.Reducer.m
+00007af0: 6561 6e28 292c 2064 6961 675f 6b65 726e  ean(), diag_kern
+00007b00: 656c 2e72 6f74 6174 6528 6929 292e 7570  el.rotate(i)).up
+00007b10: 6461 7465 4d61 736b 2864 6972 6563 7469  dateMask(directi
+00007b20: 6f6e 732e 6571 2832 2a69 2b32 2929 290d  ons.eq(2*i+2))).
+00007b30: 0a20 2020 2064 6972 5f76 6172 203d 2064  .    dir_var = d
+00007b40: 6972 5f76 6172 2e61 6464 4261 6e64 7328  ir_var.addBands(
+00007b50: 696d 672e 7265 6475 6365 4e65 6967 6862  img.reduceNeighb
+00007b60: 6f72 686f 6f64 2865 652e 5265 6475 6365  orhood(ee.Reduce
+00007b70: 722e 7661 7269 616e 6365 2829 2c20 6469  r.variance(), di
+00007b80: 6167 5f6b 6572 6e65 6c2e 726f 7461 7465  ag_kernel.rotate
+00007b90: 2869 2929 2e75 7064 6174 654d 6173 6b28  (i)).updateMask(
+00007ba0: 6469 7265 6374 696f 6e73 2e65 7128 322a  directions.eq(2*
+00007bb0: 692b 3229 2929 0d0a 2020 0d0a 0d0a 2020  i+2)))..  ....  
+00007bc0: 2320 2263 6f6c 6c61 7073 6522 2074 6865  # "collapse" the
+00007bd0: 2073 7461 636b 2069 6e74 6f20 6120 7369   stack into a si
+00007be0: 6e67 6c65 2062 616e 6420 696d 6167 6520  ngle band image 
+00007bf0: 2864 7565 2074 6f20 6d61 736b 696e 672c  (due to masking,
+00007c00: 2065 6163 6820 7069 7865 6c20 6861 7320   each pixel has 
+00007c10: 6a75 7374 206f 6e65 2076 616c 7565 2069  just one value i
+00007c20: 6e20 6974 2773 2064 6972 6563 7469 6f6e  n it's direction
+00007c30: 616c 2062 616e 642c 2061 6e64 2069 7320  al band, and is 
+00007c40: 6f74 6865 7277 6973 6520 6d61 736b 6564  otherwise masked
+00007c50: 290d 0a20 2064 6972 5f6d 6561 6e20 3d20  )..  dir_mean = 
+00007c60: 6469 725f 6d65 616e 2e72 6564 7563 6528  dir_mean.reduce(
+00007c70: 6565 2e52 6564 7563 6572 2e73 756d 2829  ee.Reducer.sum()
+00007c80: 290d 0a20 2064 6972 5f76 6172 203d 2064  )..  dir_var = d
+00007c90: 6972 5f76 6172 2e72 6564 7563 6528 6565  ir_var.reduce(ee
+00007ca0: 2e52 6564 7563 6572 2e73 756d 2829 290d  .Reducer.sum()).
+00007cb0: 0a0d 0a20 2023 2041 2066 696e 616c 6c79  ...  # A finally
+00007cc0: 2067 656e 6572 6174 6520 7468 6520 6669   generate the fi
+00007cd0: 6c74 6572 6564 2076 616c 7565 0d0a 2020  ltered value..  
+00007ce0: 7661 7258 203d 2064 6972 5f76 6172 2e73  varX = dir_var.s
+00007cf0: 7562 7472 6163 7428 6469 725f 6d65 616e  ubtract(dir_mean
+00007d00: 2e6d 756c 7469 706c 7928 6469 725f 6d65  .multiply(dir_me
+00007d10: 616e 292e 6d75 6c74 6970 6c79 2873 6967  an).multiply(sig
+00007d20: 6d61 5629 292e 6469 7669 6465 2873 6967  maV)).divide(sig
+00007d30: 6d61 562e 6164 6428 312e 3029 290d 0a0d  maV.add(1.0))...
+00007d40: 0a20 2062 203d 2076 6172 582e 6469 7669  .  b = varX.divi
+00007d50: 6465 2864 6972 5f76 6172 290d 0a0d 0a20  de(dir_var).... 
+00007d60: 2072 6573 756c 7420 3d20 6469 725f 6d65   result = dir_me
+00007d70: 616e 2e61 6464 2862 2e6d 756c 7469 706c  an.add(b.multipl
+00007d80: 7928 696d 672e 7375 6274 7261 6374 2864  y(img.subtract(d
+00007d90: 6972 5f6d 6561 6e29 2929 0d0a 2020 7265  ir_mean)))..  re
+00007da0: 7475 726e 2872 6573 756c 742e 6172 7261  turn(result.arra
+00007db0: 7946 6c61 7474 656e 285b 5b27 7375 6d27  yFlatten([['sum'
+00007dc0: 5d5d 2929 0d0a 0d0a 2323 2323 2323 2323  ]]))....########
+00007dd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00007de0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00007df0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00007e00: 2323 2323 2323 2323 0d0a 0d0a 2320 4c6f  ########....# Lo
+00007e10: 6164 2061 6e64 2066 696c 7465 7220 5365  ad and filter Se
+00007e20: 6e74 696e 656c 2d31 2047 5244 2064 6174  ntinel-1 GRD dat
+00007e30: 6120 6279 2070 7265 6465 6669 6e65 6420  a by predefined 
+00007e40: 7061 7261 6d65 7465 7273 200d 0a64 6566  parameters ..def
+00007e50: 2067 6574 5331 2873 7475 6479 4172 6561   getS1(studyArea
+00007e60: 2c73 7461 7274 5965 6172 2c65 6e64 5965  ,startYear,endYe
+00007e70: 6172 2c73 7461 7274 4a75 6c69 616e 2c65  ar,startJulian,e
+00007e80: 6e64 4a75 6c69 616e 2c70 6f6c 6172 697a  ndJulian,polariz
+00007e90: 6174 696f 6e20 3d20 2256 5622 2c70 6173  ation = "VV",pas
+00007ea0: 735f 6469 7265 6374 696f 6e20 3d20 2241  s_direction = "A
+00007eb0: 5343 454e 4449 4e47 2229 3a0d 0a20 2063  SCENDING"):..  c
+00007ec0: 6f6c 6c65 6374 696f 6e3d 2065 652e 496d  ollection= ee.Im
+00007ed0: 6167 6543 6f6c 6c65 6374 696f 6e28 2743  ageCollection('C
+00007ee0: 4f50 4552 4e49 4355 532f 5331 5f47 5244  OPERNICUS/S1_GRD
+00007ef0: 2729 5c0d 0a20 202e 6669 6c74 6572 2865  ')\..  .filter(e
+00007f00: 652e 4669 6c74 6572 2e63 616c 656e 6461  e.Filter.calenda
+00007f10: 7252 616e 6765 2873 7461 7274 5965 6172  rRange(startYear
+00007f20: 2c65 6e64 5965 6172 2c27 7965 6172 2729  ,endYear,'year')
+00007f30: 295c 0d0a 2020 2e66 696c 7465 7228 6565  )\..  .filter(ee
+00007f40: 2e46 696c 7465 722e 6361 6c65 6e64 6172  .Filter.calendar
+00007f50: 5261 6e67 6528 7374 6172 744a 756c 6961  Range(startJulia
+00007f60: 6e2c 656e 644a 756c 6961 6e29 295c 0d0a  n,endJulian))\..
+00007f70: 2020 2e66 696c 7465 7228 6565 2e46 696c    .filter(ee.Fil
+00007f80: 7465 722e 6571 2827 696e 7374 7275 6d65  ter.eq('instrume
+00007f90: 6e74 4d6f 6465 272c 2749 5727 2929 5c0d  ntMode','IW'))\.
+00007fa0: 0a20 202e 6669 6c74 6572 2865 652e 4669  .  .filter(ee.Fi
+00007fb0: 6c74 6572 2e6c 6973 7443 6f6e 7461 696e  lter.listContain
+00007fc0: 7328 2774 7261 6e73 6d69 7474 6572 5265  s('transmitterRe
+00007fd0: 6365 6976 6572 506f 6c61 7269 7361 7469  ceiverPolarisati
+00007fe0: 6f6e 272c 2070 6f6c 6172 697a 6174 696f  on', polarizatio
+00007ff0: 6e29 295c 0d0a 2020 2e66 696c 7465 7228  n))\..  .filter(
+00008000: 6565 2e46 696c 7465 722e 6571 2827 6f72  ee.Filter.eq('or
+00008010: 6269 7450 726f 7065 7274 6965 735f 7061  bitProperties_pa
+00008020: 7373 272c 7061 7373 5f64 6972 6563 7469  ss',pass_directi
+00008030: 6f6e 2929 5c0d 0a20 202e 6669 6c74 6572  on))\..  .filter
+00008040: 2865 652e 4669 6c74 6572 2e65 7128 2772  (ee.Filter.eq('r
+00008050: 6573 6f6c 7574 696f 6e5f 6d65 7465 7273  esolution_meters
+00008060: 272c 3130 2929 5c0d 0a20 202e 6669 6c74  ',10))\..  .filt
+00008070: 6572 426f 756e 6473 2873 7475 6479 4172  erBounds(studyAr
+00008080: 6561 295c 0d0a 2020 2e73 656c 6563 7428  ea)\..  .select(
+00008090: 5b70 6f6c 6172 697a 6174 696f 6e5d 290d  [polarization]).
+000080a0: 0a0d 0a20 2072 6574 7572 6e20 636f 6c6c  ...  return coll
+000080b0: 6563 7469 6f6e 0d0a 2323 2323 2323 2323  ection..########
+000080c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000080d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000080e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000080f0: 2323 2323 2323 2323 0d0a 2320 4675 6e63  ########..# Func
+00008100: 7469 6f6e 2074 6f20 6765 7420 5365 6e74  tion to get Sent
+00008110: 696e 656c 2032 2041 2061 6e64 2042 2064  inel 2 A and B d
+00008120: 6174 6120 696e 746f 2061 2073 696e 676c  ata into a singl
+00008130: 6520 636f 6c6c 6563 7469 6f6e 2077 6974  e collection wit
+00008140: 6820 6d65 616e 696e 6766 756c 2062 616e  h meaningful ban
+00008150: 6420 6e61 6d65 7320 666f 7220 6120 7370  d names for a sp
+00008160: 6563 6966 6965 6420 6172 6561 2061 6e64  ecified area and
+00008170: 2064 6174 6520 7261 6e67 650d 0a23 2057   date range..# W
+00008180: 696c 6c20 616c 736f 206a 6f69 6e20 7468  ill also join th
+00008190: 6520 5332 2063 6c6f 7564 6c65 7373 2063  e S2 cloudless c
+000081a0: 6c6f 7564 2070 726f 6261 6269 6c69 7479  loud probability
+000081b0: 2063 6f6c 6c65 6374 696f 6e20 6966 2073   collection if s
+000081c0: 7065 6369 6669 6564 0d0a 6465 6620 6765  pecified..def ge
+000081d0: 7453 3228 7374 7564 7941 7265 612c 0d0a  tS2(studyArea,..
+000081e0: 2020 2020 2020 2020 2020 7374 6172 7444            startD
+000081f0: 6174 652c 0d0a 2020 2020 2020 2020 2020  ate,..          
+00008200: 656e 6444 6174 652c 0d0a 2020 2020 2020  endDate,..      
+00008210: 2020 2020 7374 6172 744a 756c 6961 6e2c      startJulian,
+00008220: 0d0a 2020 2020 2020 2020 2020 656e 644a  ..          endJ
+00008230: 756c 6961 6e2c 0d0a 2020 2020 2020 2020  ulian,..        
+00008240: 2020 7265 7361 6d70 6c65 4d65 7468 6f64    resampleMethod
+00008250: 203d 2027 6167 6772 6567 6174 6527 2c0d   = 'aggregate',.
+00008260: 0a20 2020 2020 2020 2020 2074 6f61 4f72  .          toaOr
+00008270: 5352 203d 2027 544f 4127 2c0d 0a20 2020  SR = 'TOA',..   
+00008280: 2020 2020 2020 2063 6f6e 7665 7274 546f         convertTo
+00008290: 4461 696c 794d 6f73 6169 6373 203d 2054  DailyMosaics = T
+000082a0: 7275 652c 0d0a 2020 2020 2020 2020 2020  rue,..          
+000082b0: 6164 6443 6c6f 7564 5072 6f62 6162 696c  addCloudProbabil
+000082c0: 6974 7920 3d20 5472 7565 293a 0d0a 0d0a  ity = True):....
+000082d0: 2020 6172 6773 203d 2066 6f72 6d61 7441    args = formatA
+000082e0: 7267 7328 6c6f 6361 6c73 2829 290d 0a0d  rgs(locals())...
+000082f0: 0a20 2074 6f61 4f72 5352 203d 2074 6f61  .  toaOrSR = toa
+00008300: 4f72 5352 2e75 7070 6572 2829 0d0a 0d0a  OrSR.upper()....
+00008310: 2020 2320 332f 3232 202d 2043 6861 6e67    # 3/22 - Chang
+00008320: 6564 2074 6f20 7573 696e 6720 7468 6520  ed to using the 
+00008330: 5f48 4152 4d4f 4e49 5a45 4420 636f 6c6c  _HARMONIZED coll
+00008340: 6563 7469 6f6e 7320 666f 6c6c 6f77 696e  ections followin
+00008350: 6720 7468 6520 696e 7472 6f64 7563 7469  g the introducti
+00008360: 6f6e 206f 6620 6120 3130 3030 2076 616c  on of a 1000 val
+00008370: 7565 206f 6666 7365 7420 6672 6f6d 204a  ue offset from J
+00008380: 616e 2032 3520 3230 3232 206f 6e77 6172  an 25 2022 onwar
+00008390: 640d 0a20 2023 2054 6865 7365 2063 6f6c  d..  # These col
+000083a0: 6c65 6374 696f 6e73 2061 6363 6f75 6e74  lections account
+000083b0: 2066 6f72 2074 6865 7365 2064 6966 6665   for these diffe
+000083c0: 7265 6e63 6573 0d0a 2020 7332 436f 6c6c  rences..  s2Coll
+000083d0: 6563 7469 6f6e 4469 6374 203d 207b 2754  ectionDict = {'T
+000083e0: 4f41 273a 2743 4f50 4552 4e49 4355 532f  OA':'COPERNICUS/
+000083f0: 5332 5f48 4152 4d4f 4e49 5a45 4427 2c27  S2_HARMONIZED','
+00008400: 5352 273a 2743 4f50 4552 4e49 4355 532f  SR':'COPERNICUS/
+00008410: 5332 5f53 525f 4841 524d 4f4e 495a 4544  S2_SR_HARMONIZED
+00008420: 277d 0d0a 0d0a 2020 7365 6e73 6f72 4261  '}....  sensorBa
+00008430: 6e64 4469 6374 203d 207b 5c0d 0a20 2020  ndDict = {\..   
+00008440: 2020 2027 5352 273a 205b 2742 3127 2c27     'SR': ['B1','
+00008450: 4232 272c 2742 3327 2c27 4234 272c 2742  B2','B3','B4','B
+00008460: 3527 2c27 4236 272c 2742 3727 2c27 4238  5','B6','B7','B8
+00008470: 272c 2742 3841 272c 2027 4239 272c 2027  ','B8A', 'B9', '
+00008480: 4231 3127 2c27 4231 3227 5d2c 0d0a 2020  B11','B12'],..  
+00008490: 2020 2020 2754 4f41 273a 205b 2742 3127      'TOA': ['B1'
+000084a0: 2c27 4232 272c 2742 3327 2c27 4234 272c  ,'B2','B3','B4',
+000084b0: 2742 3527 2c27 4236 272c 2742 3727 2c27  'B5','B6','B7','
+000084c0: 4238 272c 2742 3841 272c 2027 4239 272c  B8','B8A', 'B9',
+000084d0: 2027 4231 3027 2c20 2742 3131 272c 2742   'B10', 'B11','B
+000084e0: 3132 275d 5c0d 0a20 207d 0d0a 0d0a 2020  12']\..  }....  
+000084f0: 7365 6e73 6f72 4261 6e64 4e61 6d65 4469  sensorBandNameDi
+00008500: 6374 203d 207b 5c0d 0a20 2020 2020 2027  ct = {\..      '
+00008510: 5352 273a 205b 2763 6227 2c20 2762 6c75  SR': ['cb', 'blu
+00008520: 6527 2c20 2767 7265 656e 272c 2027 7265  e', 'green', 're
+00008530: 6427 2c20 2772 6531 272c 2772 6532 272c  d', 're1','re2',
+00008540: 2772 6533 272c 276e 6972 272c 2027 6e69  're3','nir', 'ni
+00008550: 7232 272c 2027 7761 7465 7256 6170 6f72  r2', 'waterVapor
+00008560: 272c 2027 7377 6972 3127 2c20 2773 7769  ', 'swir1', 'swi
+00008570: 7232 275d 2c0d 0a20 2020 2020 2027 544f  r2'],..      'TO
+00008580: 4127 3a20 5b27 6362 272c 2027 626c 7565  A': ['cb', 'blue
+00008590: 272c 2027 6772 6565 6e27 2c20 2772 6564  ', 'green', 'red
+000085a0: 272c 2027 7265 3127 2c27 7265 3227 2c27  ', 're1','re2','
+000085b0: 7265 3327 2c27 6e69 7227 2c20 276e 6972  re3','nir', 'nir
+000085c0: 3227 2c20 2777 6174 6572 5661 706f 7227  2', 'waterVapor'
+000085d0: 2c20 2763 6972 7275 7327 2c27 7377 6972  , 'cirrus','swir
+000085e0: 3127 2c20 2773 7769 7232 275d 5c0d 0a20  1', 'swir2']\.. 
+000085f0: 207d 0d0a 2020 2320 5370 6563 6966 7920   }..  # Specify 
+00008600: 5332 2063 6f6e 7469 6e75 6f75 7320 6261  S2 continuous ba
+00008610: 6e64 7320 6966 2072 6573 616d 706c 696e  nds if resamplin
+00008620: 6720 6973 2073 6574 2074 6f20 736f 6d65  g is set to some
+00008630: 7468 696e 6720 6f74 6865 7220 7468 616e  thing other than
+00008640: 206e 6561 720d 0a20 2073 325f 636f 6e74   near..  s2_cont
+00008650: 696e 756f 7573 5f62 616e 6473 203d 2073  inuous_bands = s
+00008660: 656e 736f 7242 616e 644e 616d 6544 6963  ensorBandNameDic
+00008670: 745b 746f 614f 7253 525d 0d0a 2020 0d0a  t[toaOrSR]..  ..
+00008680: 2020 6465 6620 6d75 6c74 5332 2869 6d67    def multS2(img
+00008690: 293a 0d0a 2020 2020 7420 3d20 696d 672e  ):..    t = img.
+000086a0: 7365 6c65 6374 2873 656e 736f 7242 616e  select(sensorBan
+000086b0: 6444 6963 745b 746f 614f 7253 525d 292e  dDict[toaOrSR]).
+000086c0: 6469 7669 6465 2831 3030 3030 290d 0a20  divide(10000).. 
+000086d0: 2020 2023 2074 203d 2074 2e61 6464 4261     # t = t.addBa
+000086e0: 6e64 7328 696d 672e 7365 6c65 6374 285b  nds(img.select([
+000086f0: 2751 4136 3027 5d29 290d 0a20 2020 2023  'QA60']))..    #
+00008700: 206f 7574 203d 2074 2e63 6f70 7950 726f   out = t.copyPro
+00008710: 7065 7274 6965 7328 696d 6729 2e63 6f70  perties(img).cop
+00008720: 7950 726f 7065 7274 6965 7328 696d 672c  yProperties(img,
+00008730: 5b27 7379 7374 656d 3a74 696d 655f 7374  ['system:time_st
+00008740: 6172 7427 5d29 0d0a 2020 2020 7265 7475  art'])..    retu
+00008750: 726e 2069 6d67 2e61 6464 4261 6e64 7328  rn img.addBands(
+00008760: 742c 4e6f 6e65 2c54 7275 6529 0d0a 0d0a  t,None,True)....
+00008770: 2020 2347 6574 2073 6f6d 6520 7332 2064    #Get some s2 d
+00008780: 6174 610d 0a20 2070 7269 6e74 2827 5573  ata..  print('Us
+00008790: 696e 6720 5332 2043 6f6c 6c65 6374 696f  ing S2 Collectio
+000087a0: 6e3a 272c 2073 3243 6f6c 6c65 6374 696f  n:', s2Collectio
+000087b0: 6e44 6963 745b 746f 614f 7253 525d 290d  nDict[toaOrSR]).
+000087c0: 0a20 2073 3273 203d 2065 652e 496d 6167  .  s2s = ee.Imag
+000087d0: 6543 6f6c 6c65 6374 696f 6e28 7332 436f  eCollection(s2Co
+000087e0: 6c6c 6563 7469 6f6e 4469 6374 5b74 6f61  llectionDict[toa
+000087f0: 4f72 5352 5d29 5c0d 0a20 2020 2020 2020  OrSR])\..       
+00008800: 2020 2020 202e 6669 6c74 6572 4461 7465       .filterDate
+00008810: 2873 7461 7274 4461 7465 2c20 656e 6444  (startDate, endD
+00008820: 6174 652e 6164 7661 6e63 6528 312c 2764  ate.advance(1,'d
+00008830: 6179 2729 295c 0d0a 2020 2020 2020 2020  ay'))\..        
+00008840: 2020 2020 2e66 696c 7465 7228 6565 2e46      .filter(ee.F
+00008850: 696c 7465 722e 6361 6c65 6e64 6172 5261  ilter.calendarRa
+00008860: 6e67 6528 7374 6172 744a 756c 6961 6e2c  nge(startJulian,
+00008870: 2065 6e64 4a75 6c69 616e 2929 5c0d 0a20   endJulian))\.. 
+00008880: 2020 2020 2020 2020 2020 202e 6669 6c74             .filt
+00008890: 6572 426f 756e 6473 2873 7475 6479 4172  erBounds(studyAr
+000088a0: 6561 295c 0d0a 2020 2020 2020 2020 2020  ea)\..          
+000088b0: 2020 2e6d 6170 286d 756c 7453 3229 5c0d    .map(multS2)\.
+000088c0: 0a20 2020 2020 2020 2020 2020 202e 7365  .            .se
+000088d0: 6c65 6374 285b 2751 4136 3027 5d2b 7365  lect(['QA60']+se
+000088e0: 6e73 6f72 4261 6e64 4469 6374 5b74 6f61  nsorBandDict[toa
+000088f0: 4f72 5352 5d2c 5b27 5141 3630 275d 2b73  OrSR],['QA60']+s
+00008900: 656e 736f 7242 616e 644e 616d 6544 6963  ensorBandNameDic
+00008910: 745b 746f 614f 7253 525d 290d 0a0d 0a0d  t[toaOrSR]).....
+00008920: 0a0d 0a20 2069 6620 6164 6443 6c6f 7564  ...  if addCloud
+00008930: 5072 6f62 6162 696c 6974 793a 0d0a 2020  Probability:..  
+00008940: 2020 7072 696e 7428 274a 6f69 6e69 6e67    print('Joining
+00008950: 2070 7265 2d63 6f6d 7075 7465 6420 636c   pre-computed cl
+00008960: 6f75 6420 7072 6f62 6162 696c 6974 6965  oud probabilitie
+00008970: 7320 6672 6f6d 3a20 434f 5045 524e 4943  s from: COPERNIC
+00008980: 5553 2f53 325f 434c 4f55 445f 5052 4f42  US/S2_CLOUD_PROB
+00008990: 4142 494c 4954 5927 290d 0a20 2020 2063  ABILITY')..    c
+000089a0: 6c6f 7564 5072 6f62 6162 696c 6974 6965  loudProbabilitie
+000089b0: 7320 3d20 6565 2e49 6d61 6765 436f 6c6c  s = ee.ImageColl
+000089c0: 6563 7469 6f6e 2822 434f 5045 524e 4943  ection("COPERNIC
+000089d0: 5553 2f53 325f 434c 4f55 445f 5052 4f42  US/S2_CLOUD_PROB
+000089e0: 4142 494c 4954 5922 295c 0d0a 2020 2020  ABILITY")\..    
+000089f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008a00: 2e66 696c 7465 7244 6174 6528 7374 6172  .filterDate(star
+00008a10: 7444 6174 652c 2065 6e64 4461 7465 2e61  tDate, endDate.a
+00008a20: 6476 616e 6365 2831 2c27 6461 7927 2929  dvance(1,'day'))
+00008a30: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
+00008a40: 2020 2020 2020 202e 6669 6c74 6572 2865         .filter(e
+00008a50: 652e 4669 6c74 6572 2e63 616c 656e 6461  e.Filter.calenda
+00008a60: 7252 616e 6765 2873 7461 7274 4a75 6c69  rRange(startJuli
+00008a70: 616e 2c20 656e 644a 756c 6961 6e29 295c  an, endJulian))\
+00008a80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00008a90: 2020 2020 2020 2e66 696c 7465 7242 6f75        .filterBou
+00008aa0: 6e64 7328 7374 7564 7941 7265 6129 5c0d  nds(studyArea)\.
+00008ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008ac0: 2020 2020 202e 7365 6c65 6374 285b 2770       .select(['p
+00008ad0: 726f 6261 6269 6c69 7479 275d 2c5b 2763  robability'],['c
+00008ae0: 6c6f 7564 5f70 726f 6261 6269 6c69 7479  loud_probability
+00008af0: 275d 290d 0a0d 0a20 2020 2063 6c6f 7564  '])....    cloud
+00008b00: 5072 6f62 6162 696c 6974 6965 7349 6473  ProbabilitiesIds
+00008b10: 203d 2065 652e 4c69 7374 2865 652e 4469   = ee.List(ee.Di
+00008b20: 6374 696f 6e61 7279 2863 6c6f 7564 5072  ctionary(cloudPr
+00008b30: 6f62 6162 696c 6974 6965 732e 6167 6772  obabilities.aggr
+00008b40: 6567 6174 655f 6869 7374 6f67 7261 6d28  egate_histogram(
+00008b50: 2773 7973 7465 6d3a 696e 6465 7827 2929  'system:index'))
+00008b60: 2e6b 6579 7328 2929 0d0a 2020 2020 7332  .keys())..    s2
+00008b70: 7349 6473 203d 2065 652e 4c69 7374 2865  sIds = ee.List(e
+00008b80: 652e 4469 6374 696f 6e61 7279 2873 3273  e.Dictionary(s2s
+00008b90: 2e61 6767 7265 6761 7465 5f68 6973 746f  .aggregate_histo
+00008ba0: 6772 616d 2827 7379 7374 656d 3a69 6e64  gram('system:ind
+00008bb0: 6578 2729 292e 6b65 7973 2829 290d 0a20  ex')).keys()).. 
+00008bc0: 2020 206d 6973 7369 6e67 203d 2073 3273     missing = s2s
+00008bd0: 4964 732e 7265 6d6f 7665 416c 6c28 636c  Ids.removeAll(cl
+00008be0: 6f75 6450 726f 6261 6269 6c69 7469 6573  oudProbabilities
+00008bf0: 4964 7329 0d0a 2020 2020 2320 7072 696e  Ids)..    # prin
+00008c00: 7428 274d 6973 7369 6e67 2063 6c6f 7564  t('Missing cloud
+00008c10: 2070 726f 6261 6269 6c69 7479 2069 6473   probability ids
+00008c20: 3a27 2c20 6d69 7373 696e 672e 6765 7449  :', missing.getI
+00008c30: 6e66 6f28 2929 0d0a 2020 2020 2320 7072  nfo())..    # pr
+00008c40: 696e 7428 274e 2073 3220 696d 6167 6573  int('N s2 images
+00008c50: 2062 6566 6f72 6520 6a6f 696e 696e 6720   before joining 
+00008c60: 7769 7468 2063 6c6f 7564 2070 726f 623a  with cloud prob:
+00008c70: 272c 2073 3273 2e73 697a 6528 292e 6765  ', s2s.size().ge
+00008c80: 7449 6e66 6f28 2929 0d0a 2020 2020 7332  tInfo())..    s2
+00008c90: 7320 3d20 6a6f 696e 436f 6c6c 6563 7469  s = joinCollecti
+00008ca0: 6f6e 7328 7332 732c 2063 6c6f 7564 5072  ons(s2s, cloudPr
+00008cb0: 6f62 6162 696c 6974 6965 732c 2046 616c  obabilities, Fal
+00008cc0: 7365 2c27 7379 7374 656d 3a69 6e64 6578  se,'system:index
+00008cd0: 2729 0d0a 2020 2020 2320 7072 696e 7428  ')..    # print(
+00008ce0: 274e 2073 3220 696d 6167 6573 2061 6674  'N s2 images aft
+00008cf0: 6572 206a 6f69 6e69 6e67 2077 6974 6820  er joining with 
+00008d00: 636c 6f75 6420 7072 6f62 3a27 2c20 7332  cloud prob:', s2
+00008d10: 732e 7369 7a65 2829 2e67 6574 496e 666f  s.size().getInfo
+00008d20: 2829 290d 0a0d 0a20 2023 2053 6574 2072  ())....  # Set r
+00008d30: 6573 616d 706c 696e 6720 6d65 7468 6f64  esampling method
+00008d40: 202d 206f 6e6c 7920 7365 7473 2074 6f20   - only sets to 
+00008d50: 6e6f 6e20 6e65 6172 6573 742d 6e65 6967  non nearest-neig
+00008d60: 6862 6f72 2066 6f72 2063 6f6e 7469 6e75  hbor for continu
+00008d70: 6f75 7320 6261 6e64 730d 0a20 2069 6620  ous bands..  if 
+00008d80: 7265 7361 6d70 6c65 4d65 7468 6f64 203d  resampleMethod =
+00008d90: 3d20 2762 696c 696e 6561 7227 206f 7220  = 'bilinear' or 
+00008da0: 7265 7361 6d70 6c65 4d65 7468 6f64 203d  resampleMethod =
+00008db0: 3d20 2762 6963 7562 6963 273a 0d0a 2020  = 'bicubic':..  
+00008dc0: 2020 7072 696e 7428 2753 6574 7469 6e67    print('Setting
+00008dd0: 2072 6573 616d 706c 6520 6d65 7468 6f64   resample method
+00008de0: 2074 6f20 272c 2072 6573 616d 706c 654d   to ', resampleM
+00008df0: 6574 686f 6429 0d0a 2020 2020 7332 7320  ethod)..    s2s 
+00008e00: 3d20 7332 732e 6d61 7028 6c61 6d62 6461  = s2s.map(lambda
+00008e10: 2069 6d67 3a20 696d 672e 6164 6442 616e   img: img.addBan
+00008e20: 6473 2869 6d67 2e73 656c 6563 7428 7332  ds(img.select(s2
+00008e30: 5f63 6f6e 7469 6e75 6f75 735f 6261 6e64  _continuous_band
+00008e40: 7329 2e72 6573 616d 706c 6528 7265 7361  s).resample(resa
+00008e50: 6d70 6c65 4d65 7468 6f64 292c 4e6f 6e65  mpleMethod),None
+00008e60: 2c54 7275 6529 290d 0a20 2065 6c69 6620  ,True))..  elif 
+00008e70: 7265 7361 6d70 6c65 4d65 7468 6f64 203d  resampleMethod =
+00008e80: 3d20 2761 6767 7265 6761 7465 273a 0d0a  = 'aggregate':..
+00008e90: 2020 2020 7072 696e 7428 2753 6574 7469      print('Setti
+00008ea0: 6e67 2074 6f20 6167 6772 6567 6174 6520  ng to aggregate 
+00008eb0: 696e 7374 6561 6420 6f66 2072 6573 616d  instead of resam
+00008ec0: 706c 6520 2729 0d0a 2020 2020 7332 7320  ple ')..    s2s 
+00008ed0: 3d20 7332 732e 6d61 7028 6c61 6d62 6461  = s2s.map(lambda
+00008ee0: 2069 6d67 3a20 696d 672e 6164 6442 616e   img: img.addBan
+00008ef0: 6473 2869 6d67 2e73 656c 6563 7428 7332  ds(img.select(s2
+00008f00: 5f63 6f6e 7469 6e75 6f75 735f 6261 6e64  _continuous_band
+00008f10: 7329 2e72 6564 7563 6552 6573 6f6c 7574  s).reduceResolut
+00008f20: 696f 6e28 6565 2e52 6564 7563 6572 2e6d  ion(ee.Reducer.m
+00008f30: 6561 6e28 292c 2054 7275 652c 2036 3429  ean(), True, 64)
+00008f40: 2c4e 6f6e 652c 5472 7565 2929 0d0a 2020  ,None,True))..  
+00008f50: 0d0a 2020 2343 6f6e 7665 7274 2074 6f20  ..  #Convert to 
+00008f60: 6461 696c 7920 6d6f 7361 6963 7320 746f  daily mosaics to
+00008f70: 2061 766f 6964 2072 6564 756e 6461 6e74   avoid redundant
+00008f80: 206f 6273 6572 7661 7469 6f6e 7320 696e   observations in
+00008f90: 204d 4752 5320 6f76 6572 6c61 7020 6172   MGRS overlap ar
+00008fa0: 6561 7320 616e 6420 6564 6765 2061 7274  eas and edge art
+00008fb0: 6966 6163 7473 2066 6f72 2073 6861 646f  ifacts for shado
+00008fc0: 7720 6d61 736b 696e 670d 0a20 2069 6620  w masking..  if 
+00008fd0: 636f 6e76 6572 7454 6f44 6169 6c79 4d6f  convertToDailyMo
+00008fe0: 7361 6963 733a 0d0a 2020 2020 7072 696e  saics:..    prin
+00008ff0: 7428 2743 6f6e 7665 7274 696e 6720 5332  t('Converting S2
+00009000: 2064 6174 6120 746f 2064 6169 6c79 206d   data to daily m
+00009010: 6f73 6169 6373 2729 0d0a 2020 2020 7332  osaics')..    s2
+00009020: 7320 3d20 6461 696c 794d 6f73 6169 6373  s = dailyMosaics
+00009030: 2873 3273 290d 0a0d 0a20 2023 2054 6869  (s2s)....  # Thi
+00009040: 7320 6e65 6564 7320 746f 206f 6363 7572  s needs to occur
+00009050: 2041 4654 4552 2074 6865 206d 6f73 6169   AFTER the mosai
+00009060: 636b 696e 6720 746f 2072 656d 6f76 6520  cking to remove 
+00009070: 7265 6d61 696e 696e 6720 6564 6765 2061  remaining edge a
+00009080: 7274 6966 6163 7473 2e0d 0a20 2073 3273  rtifacts...  s2s
+00009090: 203d 2073 3273 2e6d 6170 286c 616d 6264   = s2s.map(lambd
+000090a0: 6120 696d 673a 2069 6d67 2e75 7064 6174  a img: img.updat
+000090b0: 654d 6173 6b28 696d 672e 6d61 736b 2829  eMask(img.mask()
+000090c0: 2e72 6564 7563 6528 6565 2e52 6564 7563  .reduce(ee.Reduc
+000090d0: 6572 2e6d 696e 2829 2929 290d 0a0d 0a20  er.min()))).... 
+000090e0: 2072 6574 7572 6e20 7332 732e 7365 7428   return s2s.set(
+000090f0: 6172 6773 290d 0a0d 0a67 6574 5365 6e74  args)....getSent
+00009100: 696e 656c 3220 3d20 6765 7453 320d 0a23  inel2 = getS2..#
+00009110: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00009120: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00009130: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00009140: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00009150: 230d 0a23 5365 7420 7570 2064 6963 7469  #..#Set up dicti
+00009160: 6f6e 6172 6965 7320 746f 206d 616e 6167  onaries to manag
+00009170: 6520 7661 7269 6f75 7320 4c61 6e64 7361  e various Landsa
+00009180: 7420 636f 6c6c 6563 7469 6f6e 732c 2072  t collections, r
+00009190: 6573 6361 6c65 2066 6163 746f 7273 2c20  escale factors, 
+000091a0: 6261 6e64 206e 616d 6573 2c20 6574 630d  band names, etc.
+000091b0: 0a6c 616e 6473 6174 5f43 325f 4c32 5f72  .landsat_C2_L2_r
+000091c0: 6573 6361 6c65 5f64 6963 7420 3d20 7b0d  escale_dict = {.
+000091d0: 0a20 2027 4331 273a 7b27 7265 666c 5f6d  .  'C1':{'refl_m
+000091e0: 756c 7427 3a30 2e30 3030 312c 2772 6566  ult':0.0001,'ref
+000091f0: 6c5f 6164 6427 3a30 2c27 7465 6d70 5f6d  l_add':0,'temp_m
+00009200: 756c 7427 3a30 2e31 2c27 7465 6d70 5f61  ult':0.1,'temp_a
+00009210: 6464 273a 307d 2c0d 0a20 2027 4332 273a  dd':0},..  'C2':
+00009220: 7b27 7265 666c 5f6d 756c 7427 3a30 2e30  {'refl_mult':0.0
+00009230: 3030 3032 3735 2c27 7265 666c 5f61 6464  000275,'refl_add
+00009240: 273a 2d30 2e32 2c27 7465 6d70 5f6d 756c  ':-0.2,'temp_mul
+00009250: 7427 3a30 2e30 3033 3431 3830 322c 2774  t':0.00341802,'t
+00009260: 656d 705f 6164 6427 3a31 3439 2e30 7d2c  emp_add':149.0},
+00009270: 0d0a 2020 7d0d 0a23 2053 7065 6369 6679  ..  }..# Specify
+00009280: 204c 616e 6473 6174 2063 6f6e 7469 6e75   Landsat continu
+00009290: 6f75 7320 6261 6e64 7320 6966 2072 6573  ous bands if res
+000092a0: 616d 706c 696e 6720 6973 2073 6574 2074  ampling is set t
+000092b0: 6f20 736f 6d65 7468 696e 6720 6f74 6865  o something othe
+000092c0: 7220 7468 616e 206e 6561 720d 0a6c 616e  r than near..lan
+000092d0: 6473 6174 5f63 6f6e 7469 6e75 6f75 735f  dsat_continuous_
+000092e0: 6261 6e64 7320 3d20 5b27 626c 7565 272c  bands = ['blue',
+000092f0: 2767 7265 656e 272c 2772 6564 272c 276e  'green','red','n
+00009300: 6972 272c 2773 7769 7231 272c 2774 656d  ir','swir1','tem
+00009310: 7027 2c20 2773 7769 7232 275d 0d0a 2353  p', 'swir2']..#S
+00009320: 6574 2075 7020 6261 6e64 7320 616e 6420  et up bands and 
+00009330: 636f 7272 6573 706f 6e64 696e 6720 6261  corresponding ba
+00009340: 6e64 206e 616d 6573 0d0a 6c61 6e64 7361  nd names..landsa
+00009350: 7453 656e 736f 7242 616e 6444 6963 7420  tSensorBandDict 
+00009360: 3d20 7b0d 0a27 4331 5f4c 345f 544f 4127  = {..'C1_L4_TOA'
+00009370: 3a5b 2742 3127 2c27 4232 272c 2742 3327  :['B1','B2','B3'
+00009380: 2c27 4234 272c 2742 3527 2c27 4236 272c  ,'B4','B5','B6',
+00009390: 2742 3727 2c27 4251 4127 5d2c 0d0a 2743  'B7','BQA'],..'C
+000093a0: 325f 4c34 5f54 4f41 273a 5b27 4231 272c  2_L4_TOA':['B1',
+000093b0: 2742 3227 2c27 4233 272c 2742 3427 2c27  'B2','B3','B4','
+000093c0: 4235 272c 2742 3627 2c27 4237 272c 2751  B5','B6','B7','Q
+000093d0: 415f 5049 5845 4c27 5d2c 0d0a 2743 315f  A_PIXEL'],..'C1_
+000093e0: 4c35 5f54 4f41 273a 5b27 4231 272c 2742  L5_TOA':['B1','B
+000093f0: 3227 2c27 4233 272c 2742 3427 2c27 4235  2','B3','B4','B5
+00009400: 272c 2742 3627 2c27 4237 272c 2742 5141  ','B6','B7','BQA
+00009410: 275d 2c0d 0a27 4332 5f4c 355f 544f 4127  '],..'C2_L5_TOA'
+00009420: 3a5b 2742 3127 2c27 4232 272c 2742 3327  :['B1','B2','B3'
+00009430: 2c27 4234 272c 2742 3527 2c27 4236 272c  ,'B4','B5','B6',
+00009440: 2742 3727 2c27 5141 5f50 4958 454c 275d  'B7','QA_PIXEL']
+00009450: 2c0d 0a27 4331 5f4c 375f 544f 4127 3a5b  ,..'C1_L7_TOA':[
+00009460: 2742 3127 2c27 4232 272c 2742 3327 2c27  'B1','B2','B3','
+00009470: 4234 272c 2742 3527 2c27 4236 5f56 4349  B4','B5','B6_VCI
+00009480: 445f 3127 2c27 4237 272c 2742 5141 275d  D_1','B7','BQA']
+00009490: 2c0d 0a27 4332 5f4c 375f 544f 4127 3a5b  ,..'C2_L7_TOA':[
+000094a0: 2742 3127 2c27 4232 272c 2742 3327 2c27  'B1','B2','B3','
+000094b0: 4234 272c 2742 3527 2c27 4236 5f56 4349  B4','B5','B6_VCI
+000094c0: 445f 3127 2c27 4237 272c 2751 415f 5049  D_1','B7','QA_PI
+000094d0: 5845 4c27 5d2c 0d0a 2743 315f 4c38 5f54  XEL'],..'C1_L8_T
+000094e0: 4f41 273a 5b27 4232 272c 2742 3327 2c27  OA':['B2','B3','
+000094f0: 4234 272c 2742 3527 2c27 4236 272c 2742  B4','B5','B6','B
+00009500: 3130 272c 2742 3727 2c27 4251 4127 5d2c  10','B7','BQA'],
+00009510: 0d0a 2743 325f 4c38 5f54 4f41 273a 5b27  ..'C2_L8_TOA':['
+00009520: 4232 272c 2742 3327 2c27 4234 272c 2742  B2','B3','B4','B
+00009530: 3527 2c27 4236 272c 2742 3130 272c 2742  5','B6','B10','B
+00009540: 3727 2c27 5141 5f50 4958 454c 275d 2c0d  7','QA_PIXEL'],.
+00009550: 0a27 4332 5f4c 395f 544f 4127 3a5b 2742  .'C2_L9_TOA':['B
+00009560: 3227 2c27 4233 272c 2742 3427 2c27 4235  2','B3','B4','B5
+00009570: 272c 2742 3627 2c27 4231 3027 2c27 4237  ','B6','B10','B7
+00009580: 272c 2751 415f 5049 5845 4c27 5d2c 0d0a  ','QA_PIXEL'],..
+00009590: 2743 315f 4c34 5f53 5227 3a5b 2742 3127  'C1_L4_SR':['B1'
+000095a0: 2c27 4232 272c 2742 3327 2c27 4234 272c  ,'B2','B3','B4',
+000095b0: 2742 3527 2c27 4236 272c 2742 3727 2c27  'B5','B6','B7','
+000095c0: 7069 7865 6c5f 7161 275d 2c0d 0a27 4332  pixel_qa'],..'C2
+000095d0: 5f4c 345f 5352 273a 5b27 5352 5f42 3127  _L4_SR':['SR_B1'
+000095e0: 2c27 5352 5f42 3227 2c27 5352 5f42 3327  ,'SR_B2','SR_B3'
+000095f0: 2c27 5352 5f42 3427 2c27 5352 5f42 3527  ,'SR_B4','SR_B5'
+00009600: 2c27 5354 5f42 3627 2c27 5352 5f42 3727  ,'ST_B6','SR_B7'
+00009610: 2c27 5141 5f50 4958 454c 275d 2c0d 0a27  ,'QA_PIXEL'],..'
+00009620: 4331 5f4c 355f 5352 273a 5b27 4231 272c  C1_L5_SR':['B1',
+00009630: 2742 3227 2c27 4233 272c 2742 3427 2c27  'B2','B3','B4','
+00009640: 4235 272c 2742 3627 2c27 4237 272c 2770  B5','B6','B7','p
+00009650: 6978 656c 5f71 6127 5d2c 0d0a 2743 325f  ixel_qa'],..'C2_
+00009660: 4c35 5f53 5227 3a5b 2753 525f 4231 272c  L5_SR':['SR_B1',
+00009670: 2753 525f 4232 272c 2753 525f 4233 272c  'SR_B2','SR_B3',
+00009680: 2753 525f 4234 272c 2753 525f 4235 272c  'SR_B4','SR_B5',
+00009690: 2753 545f 4236 272c 2753 525f 4237 272c  'ST_B6','SR_B7',
+000096a0: 2751 415f 5049 5845 4c27 5d2c 0d0a 2743  'QA_PIXEL'],..'C
+000096b0: 315f 4c37 5f53 5227 3a5b 2742 3127 2c27  1_L7_SR':['B1','
+000096c0: 4232 272c 2742 3327 2c27 4234 272c 2742  B2','B3','B4','B
+000096d0: 3527 2c27 4236 272c 2742 3727 2c27 7069  5','B6','B7','pi
+000096e0: 7865 6c5f 7161 275d 2c0d 0a27 4332 5f4c  xel_qa'],..'C2_L
+000096f0: 375f 5352 273a 5b27 5352 5f42 3127 2c27  7_SR':['SR_B1','
+00009700: 5352 5f42 3227 2c27 5352 5f42 3327 2c27  SR_B2','SR_B3','
+00009710: 5352 5f42 3427 2c27 5352 5f42 3527 2c27  SR_B4','SR_B5','
+00009720: 5354 5f42 3627 2c27 5352 5f42 3727 2c27  ST_B6','SR_B7','
+00009730: 5141 5f50 4958 454c 275d 2c0d 0a27 4331  QA_PIXEL'],..'C1
+00009740: 5f4c 385f 5352 273a 5b27 4232 272c 2742  _L8_SR':['B2','B
+00009750: 3327 2c27 4234 272c 2742 3527 2c27 4236  3','B4','B5','B6
+00009760: 272c 2742 3130 272c 2742 3727 2c27 7069  ','B10','B7','pi
+00009770: 7865 6c5f 7161 275d 2c0d 0a27 4332 5f4c  xel_qa'],..'C2_L
+00009780: 385f 5352 273a 5b27 5352 5f42 3227 2c27  8_SR':['SR_B2','
+00009790: 5352 5f42 3327 2c27 5352 5f42 3427 2c27  SR_B3','SR_B4','
+000097a0: 5352 5f42 3527 2c27 5352 5f42 3627 2c27  SR_B5','SR_B6','
+000097b0: 5354 5f42 3130 272c 2753 525f 4237 272c  ST_B10','SR_B7',
+000097c0: 2751 415f 5049 5845 4c27 5d2c 0d0a 2743  'QA_PIXEL'],..'C
+000097d0: 325f 4c39 5f53 5227 3a5b 2753 525f 4232  2_L9_SR':['SR_B2
+000097e0: 272c 2753 525f 4233 272c 2753 525f 4234  ','SR_B3','SR_B4
+000097f0: 272c 2753 525f 4235 272c 2753 525f 4236  ','SR_B5','SR_B6
+00009800: 272c 2753 545f 4231 3027 2c27 5352 5f42  ','ST_B10','SR_B
+00009810: 3727 2c27 5141 5f50 4958 454c 275d 2c0d  7','QA_PIXEL'],.
+00009820: 0a7d 0d0a 0d0a 2320 5072 6f76 6964 6520  .}....# Provide 
+00009830: 636f 6d6d 6f6e 2062 616e 6420 6e61 6d65  common band name
+00009840: 730d 0a6c 616e 6473 6174 5365 6e73 6f72  s..landsatSensor
+00009850: 4261 6e64 4e61 6d65 4469 6374 203d 207b  BandNameDict = {
+00009860: 5c0d 0a20 2027 4331 5f54 4f41 273a 205b  \..  'C1_TOA': [
+00009870: 2762 6c75 6527 2c27 6772 6565 6e27 2c27  'blue','green','
+00009880: 7265 6427 2c27 6e69 7227 2c27 7377 6972  red','nir','swir
+00009890: 3127 2c27 7465 6d70 272c 2773 7769 7232  1','temp','swir2
+000098a0: 272c 2742 5141 275d 2c5c 0d0a 2020 2743  ','BQA'],\..  'C
+000098b0: 315f 5352 273a 205b 2762 6c75 6527 2c27  1_SR': ['blue','
+000098c0: 6772 6565 6e27 2c27 7265 6427 2c27 6e69  green','red','ni
+000098d0: 7227 2c27 7377 6972 3127 2c27 7465 6d70  r','swir1','temp
+000098e0: 272c 2027 7377 6972 3227 2c27 7069 7865  ', 'swir2','pixe
+000098f0: 6c5f 7161 275d 2c5c 0d0a 2020 2743 315f  l_qa'],\..  'C1_
+00009900: 5352 464d 4153 4b27 3a20 5b27 7069 7865  SRFMASK': ['pixe
+00009910: 6c5f 7161 275d 2c5c 0d0a 2020 2743 325f  l_qa'],\..  'C2_
+00009920: 544f 4127 3a20 5b27 626c 7565 272c 2767  TOA': ['blue','g
+00009930: 7265 656e 272c 2772 6564 272c 276e 6972  reen','red','nir
+00009940: 272c 2773 7769 7231 272c 2774 656d 7027  ','swir1','temp'
+00009950: 2c27 7377 6972 3227 2c27 5141 5f50 4958  ,'swir2','QA_PIX
+00009960: 454c 275d 2c5c 0d0a 2020 2743 325f 5352  EL'],\..  'C2_SR
+00009970: 273a 205b 2762 6c75 6527 2c27 6772 6565  ': ['blue','gree
+00009980: 6e27 2c27 7265 6427 2c27 6e69 7227 2c27  n','red','nir','
+00009990: 7377 6972 3127 2c27 7465 6d70 272c 2027  swir1','temp', '
+000099a0: 7377 6972 3227 2c27 5141 5f50 4958 454c  swir2','QA_PIXEL
+000099b0: 275d 0d0a 2020 7d0d 0a0d 0a23 5365 7420  ']..  }....#Set 
+000099c0: 7570 2063 6f6c 6c65 6374 696f 6e73 0d0a  up collections..
+000099d0: 6c61 6e64 7361 7443 6f6c 6c65 6374 696f  landsatCollectio
+000099e0: 6e44 6963 7420 3d20 7b0d 0a20 2027 4331  nDict = {..  'C1
+000099f0: 5f4c 385f 544f 4127 3a20 274c 414e 4453  _L8_TOA': 'LANDS
+00009a00: 4154 2f4c 4330 382f 4330 312f 5431 272c  AT/LC08/C01/T1',
+00009a10: 5c0d 0a20 2027 4331 5f4c 375f 544f 4127  \..  'C1_L7_TOA'
+00009a20: 3a20 274c 414e 4453 4154 2f4c 4530 372f  : 'LANDSAT/LE07/
+00009a30: 4330 312f 5431 272c 5c0d 0a20 2027 4331  C01/T1',\..  'C1
+00009a40: 5f4c 355f 544f 4127 3a20 274c 414e 4453  _L5_TOA': 'LANDS
+00009a50: 4154 2f4c 5430 352f 4330 312f 5431 272c  AT/LT05/C01/T1',
+00009a60: 5c0d 0a20 2027 4331 5f4c 345f 544f 4127  \..  'C1_L4_TOA'
+00009a70: 3a20 274c 414e 4453 4154 2f4c 5430 342f  : 'LANDSAT/LT04/
+00009a80: 4330 312f 5431 272c 5c0d 0a20 2027 4331  C01/T1',\..  'C1
+00009a90: 5f4c 385f 5352 273a 2027 4c41 4e44 5341  _L8_SR': 'LANDSA
+00009aa0: 542f 4c43 3038 2f43 3031 2f54 315f 5352  T/LC08/C01/T1_SR
+00009ab0: 272c 5c0d 0a20 2027 4331 5f4c 375f 5352  ',\..  'C1_L7_SR
+00009ac0: 273a 2027 4c41 4e44 5341 542f 4c45 3037  ': 'LANDSAT/LE07
+00009ad0: 2f43 3031 2f54 315f 5352 272c 5c0d 0a20  /C01/T1_SR',\.. 
+00009ae0: 2027 4331 5f4c 355f 5352 273a 2027 4c41   'C1_L5_SR': 'LA
+00009af0: 4e44 5341 542f 4c54 3035 2f43 3031 2f54  NDSAT/LT05/C01/T
+00009b00: 315f 5352 272c 5c0d 0a20 2027 4331 5f4c  1_SR',\..  'C1_L
+00009b10: 345f 5352 273a 2027 4c41 4e44 5341 542f  4_SR': 'LANDSAT/
+00009b20: 4c54 3034 2f43 3031 2f54 315f 5352 272c  LT04/C01/T1_SR',
+00009b30: 5c0d 0a20 2027 4332 5f4c 395f 544f 4127  \..  'C2_L9_TOA'
+00009b40: 3a20 274c 414e 4453 4154 2f4c 4330 392f  : 'LANDSAT/LC09/
+00009b50: 4330 322f 5431 272c 5c0d 0a20 2027 4332  C02/T1',\..  'C2
+00009b60: 5f4c 385f 544f 4127 3a20 274c 414e 4453  _L8_TOA': 'LANDS
+00009b70: 4154 2f4c 4330 382f 4330 322f 5431 272c  AT/LC08/C02/T1',
+00009b80: 5c0d 0a20 2027 4332 5f4c 375f 544f 4127  \..  'C2_L7_TOA'
+00009b90: 3a20 274c 414e 4453 4154 2f4c 4530 372f  : 'LANDSAT/LE07/
+00009ba0: 4330 322f 5431 272c 5c0d 0a20 2027 4332  C02/T1',\..  'C2
+00009bb0: 5f4c 355f 544f 4127 3a20 274c 414e 4453  _L5_TOA': 'LANDS
+00009bc0: 4154 2f4c 5430 352f 4330 322f 5431 272c  AT/LT05/C02/T1',
+00009bd0: 5c0d 0a20 2027 4332 5f4c 345f 544f 4127  \..  'C2_L4_TOA'
+00009be0: 3a20 274c 414e 4453 4154 2f4c 5430 342f  : 'LANDSAT/LT04/
+00009bf0: 4330 322f 5431 272c 5c0d 0a20 2027 4332  C02/T1',\..  'C2
+00009c00: 5f4c 395f 5352 273a 2027 4c41 4e44 5341  _L9_SR': 'LANDSA
+00009c10: 542f 4c43 3039 2f43 3032 2f54 315f 4c32  T/LC09/C02/T1_L2
+00009c20: 272c 5c0d 0a20 2027 4332 5f4c 385f 5352  ',\..  'C2_L8_SR
+00009c30: 273a 2027 4c41 4e44 5341 542f 4c43 3038  ': 'LANDSAT/LC08
+00009c40: 2f43 3032 2f54 315f 4c32 272c 5c0d 0a20  /C02/T1_L2',\.. 
+00009c50: 2027 4332 5f4c 375f 5352 273a 2027 4c41   'C2_L7_SR': 'LA
+00009c60: 4e44 5341 542f 4c45 3037 2f43 3032 2f54  NDSAT/LE07/C02/T
+00009c70: 315f 4c32 272c 5c0d 0a20 2027 4332 5f4c  1_L2',\..  'C2_L
+00009c80: 355f 5352 273a 2027 4c41 4e44 5341 542f  5_SR': 'LANDSAT/
+00009c90: 4c54 3035 2f43 3032 2f54 315f 4c32 272c  LT05/C02/T1_L2',
+00009ca0: 5c0d 0a20 2027 4332 5f4c 345f 5352 273a  \..  'C2_L4_SR':
+00009cb0: 2027 4c41 4e44 5341 542f 4c54 3034 2f43   'LANDSAT/LT04/C
+00009cc0: 3032 2f54 315f 4c32 275c 0d0a 2020 7d3b  02/T1_L2'\..  };
+00009cd0: 0d0a 0d0a 2320 4e61 6d65 206f 6620 6346  ....# Name of cF
+00009ce0: 6d61 736b 2071 6120 6269 7473 2062 616e  mask qa bits ban
+00009cf0: 6420 666f 7220 436f 6c6c 6563 7469 6f6e  d for Collection
+00009d00: 7320 3120 616e 6420 320d 0a6c 616e 6473  s 1 and 2..lands
+00009d10: 6174 466d 6173 6b42 616e 644e 616d 6544  atFmaskBandNameD
+00009d20: 6963 7420 3d20 7b27 4331 273a 2770 6978  ict = {'C1':'pix
+00009d30: 656c 5f71 6127 2c27 4332 273a 2751 415f  el_qa','C2':'QA_
+00009d40: 5049 5845 4c27 7d0d 0a23 2323 2323 2323  PIXEL'}..#######
+00009d50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00009d60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00009d70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00009d80: 2323 2323 2323 2323 2323 230d 0a23 204d  ###########..# M
+00009d90: 6574 686f 6420 666f 7220 7265 7363 616c  ethod for rescal
+00009da0: 696e 6720 7265 666c 6563 7461 6e63 6520  ing reflectance 
+00009db0: 616e 6420 7375 7266 6163 6520 7465 6d70  and surface temp
+00009dc0: 6572 6174 7572 6520 6461 7461 2074 6f20  erature data to 
+00009dd0: 302d 3120 616e 6420 4b65 6c76 696e 2072  0-1 and Kelvin r
+00009de0: 6573 7065 6374 6976 656c 790d 0a23 2054  espectively..# T
+00009df0: 6869 7320 7761 7320 6164 6170 7465 6420  his was adapted 
+00009e00: 6672 6f6d 2074 6865 206d 6574 686f 6420  from the method 
+00009e10: 7072 6f76 6964 6564 2062 7920 476f 6f67  provided by Goog
+00009e20: 6c65 2066 6f72 2072 6573 6361 6c69 6e67  le for rescaling
+00009e30: 2043 6f6c 6c65 6374 696f 6e20 323a 0d0a   Collection 2:..
+00009e40: 2320 6874 7470 733a 2f2f 636f 6465 2e65  # https://code.e
+00009e50: 6172 7468 656e 6769 6e65 2e67 6f6f 676c  arthengine.googl
+00009e60: 652e 636f 6d2f 3f73 6372 6970 7450 6174  e.com/?scriptPat
+00009e70: 683d 4578 616d 706c 6573 2533 4144 6174  h=Examples%3ADat
+00009e80: 6173 6574 7325 3246 4c41 4e44 5341 545f  asets%2FLANDSAT_
+00009e90: 4c43 3038 5f43 3032 5f54 315f 4c32 0d0a  LC08_C02_T1_L2..
+00009ea0: 6465 6620 6170 706c 7953 6361 6c65 4661  def applyScaleFa
+00009eb0: 6374 6f72 7328 696d 6167 652c 6c61 6e64  ctors(image,land
+00009ec0: 7361 7443 6f6c 6c65 6374 696f 6e56 6572  satCollectionVer
+00009ed0: 7369 6f6e 293a 0d0a 2020 6661 6374 6f72  sion):..  factor
+00009ee0: 5f64 6963 7420 3d20 6c61 6e64 7361 745f  _dict = landsat_
+00009ef0: 4332 5f4c 325f 7265 7363 616c 655f 6469  C2_L2_rescale_di
+00009f00: 6374 5b6c 616e 6473 6174 436f 6c6c 6563  ct[landsatCollec
+00009f10: 7469 6f6e 5665 7273 696f 6e5d 0d0a 2020  tionVersion]..  
+00009f20: 6f70 7469 6361 6c42 616e 6473 203d 2069  opticalBands = i
+00009f30: 6d61 6765 2e73 656c 6563 7428 2762 6c75  mage.select('blu
+00009f40: 6527 2c27 6772 6565 6e27 2c27 7265 6427  e','green','red'
+00009f50: 2c27 6e69 7227 2c27 7377 6972 3127 2c27  ,'nir','swir1','
+00009f60: 7377 6972 3227 292e 6d75 6c74 6970 6c79  swir2').multiply
+00009f70: 2866 6163 746f 725f 6469 6374 5b27 7265  (factor_dict['re
+00009f80: 666c 5f6d 756c 7427 5d29 2e61 6464 2866  fl_mult']).add(f
+00009f90: 6163 746f 725f 6469 6374 5b27 7265 666c  actor_dict['refl
+00009fa0: 5f61 6464 275d 292e 666c 6f61 7428 290d  _add']).float().
+00009fb0: 0a20 2074 6865 726d 616c 4261 6e64 7320  .  thermalBands 
+00009fc0: 3d20 696d 6167 652e 7365 6c65 6374 2827  = image.select('
+00009fd0: 7465 6d70 2729 2e6d 756c 7469 706c 7928  temp').multiply(
+00009fe0: 6661 6374 6f72 5f64 6963 745b 2774 656d  factor_dict['tem
+00009ff0: 705f 6d75 6c74 275d 292e 6164 6428 6661  p_mult']).add(fa
+0000a000: 6374 6f72 5f64 6963 745b 2774 656d 705f  ctor_dict['temp_
+0000a010: 6164 6427 5d29 2e66 6c6f 6174 2829 0d0a  add']).float()..
+0000a020: 2020 7265 7475 726e 2069 6d61 6765 2e61    return image.a
+0000a030: 6464 4261 6e64 7328 6f70 7469 6361 6c42  ddBands(opticalB
+0000a040: 616e 6473 2c20 4e6f 6e65 2c20 5472 7565  ands, None, True
+0000a050: 295c 0d0a 2020 2020 2020 2020 2020 2020  )\..            
+0000a060: 2020 2e61 6464 4261 6e64 7328 7468 6572    .addBands(ther
+0000a070: 6d61 6c42 616e 6473 2c20 4e6f 6e65 2c20  malBands, None, 
+0000a080: 5472 7565 290d 0a23 2323 2323 2323 2323  True)..#########
+0000a090: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000a0a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000a0b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000a0c0: 2323 2323 2323 2323 230d 0a23 4675 6e63  #########..#Func
+0000a0d0: 7469 6f6e 2066 6f72 2061 6371 7569 7269  tion for acquiri
+0000a0e0: 6e67 204c 616e 6473 6174 2069 6d61 6765  ng Landsat image
+0000a0f0: 2063 6f6c 6c65 6374 696f 6e73 0d0a 6465   collections..de
+0000a100: 6620 6765 744c 616e 6473 6174 2873 7475  f getLandsat(stu
+0000a110: 6479 4172 6561 2c0d 0a20 2020 2020 2020  dyArea,..       
+0000a120: 2020 2020 2020 2073 7461 7274 4461 7465         startDate
+0000a130: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000a140: 2065 6e64 4461 7465 2c0d 0a20 2020 2020   endDate,..     
+0000a150: 2020 2020 2020 2020 2073 7461 7274 4a75           startJu
+0000a160: 6c69 616e 2c0d 0a20 2020 2020 2020 2020  lian,..         
+0000a170: 2020 2020 2065 6e64 4a75 6c69 616e 2c0d       endJulian,.
+0000a180: 0a20 2020 2020 2020 2020 2020 2020 2074  .              t
+0000a190: 6f61 4f72 5352 203d 2027 5352 272c 0d0a  oaOrSR = 'SR',..
+0000a1a0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0000a1b0: 636c 7564 6553 4c43 4f66 664c 3720 3d20  cludeSLCOffL7 = 
+0000a1c0: 4661 6c73 652c 0d0a 2020 2020 2020 2020  False,..        
+0000a1d0: 2020 2020 2020 6465 6672 696e 6765 4c35        defringeL5
+0000a1e0: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
+0000a1f0: 2020 2020 2020 2020 2061 6464 5069 7865           addPixe
+0000a200: 6c51 4120 3d20 4661 6c73 652c 0d0a 2020  lQA = False,..  
+0000a210: 2020 2020 2020 2020 2020 2020 7265 7361              resa
+0000a220: 6d70 6c65 4d65 7468 6f64 203d 2027 6e65  mpleMethod = 'ne
+0000a230: 6172 272c 0d0a 2020 2020 2020 2020 2020  ar',..          
+0000a240: 2020 2020 6c61 6e64 7361 7443 6f6c 6c65      landsatColle
+0000a250: 6374 696f 6e56 6572 7369 6f6e 203d 2027  ctionVersion = '
+0000a260: 4332 2729 3a0d 0a0d 0a20 2061 7267 7320  C2'):....  args 
+0000a270: 3d20 666f 726d 6174 4172 6773 286c 6f63  = formatArgs(loc
+0000a280: 616c 7328 2929 0d0a 0d0a 0d0a 2020 6465  als())......  de
+0000a290: 6620 6765 744c 616e 6473 6174 436f 6c6c  f getLandsatColl
+0000a2a0: 6563 7469 6f6e 286c 616e 6473 6174 436f  ection(landsatCo
+0000a2b0: 6c6c 6563 7469 6f6e 5665 7273 696f 6e2c  llectionVersion,
+0000a2c0: 7768 6963 6843 2c74 6f61 4f72 5352 293a  whichC,toaOrSR):
+0000a2d0: 0d0a 2020 2020 6320 3d20 6565 2e49 6d61  ..    c = ee.Ima
+0000a2e0: 6765 436f 6c6c 6563 7469 6f6e 286c 616e  geCollection(lan
+0000a2f0: 6473 6174 436f 6c6c 6563 7469 6f6e 4469  dsatCollectionDi
+0000a300: 6374 5b6c 616e 6473 6174 436f 6c6c 6563  ct[landsatCollec
+0000a310: 7469 6f6e 5665 7273 696f 6e2b 275f 272b  tionVersion+'_'+
+0000a320: 7768 6963 6843 2b27 5f27 2b74 6f61 4f72  whichC+'_'+toaOr
+0000a330: 5352 5d29 5c0d 0a20 2020 2020 2020 202e  SR])\..        .
+0000a340: 6669 6c74 6572 4461 7465 2873 7461 7274  filterDate(start
+0000a350: 4461 7465 2c65 6e64 4461 7465 2e61 6476  Date,endDate.adv
+0000a360: 616e 6365 2831 2c27 6461 7927 2929 5c0d  ance(1,'day'))\.
+0000a370: 0a20 2020 2020 2020 202e 6669 6c74 6572  .        .filter
+0000a380: 2865 652e 4669 6c74 6572 2e63 616c 656e  (ee.Filter.calen
+0000a390: 6461 7252 616e 6765 2873 7461 7274 4a75  darRange(startJu
+0000a3a0: 6c69 616e 2c65 6e64 4a75 6c69 616e 2929  lian,endJulian))
+0000a3b0: 5c0d 0a20 2020 2020 2020 202e 6669 6c74  \..        .filt
+0000a3c0: 6572 426f 756e 6473 2873 7475 6479 4172  erBounds(studyAr
+0000a3d0: 6561 295c 0d0a 2020 2020 2020 2020 2e66  ea)\..        .f
+0000a3e0: 696c 7465 7228 6565 2e46 696c 7465 722e  ilter(ee.Filter.
+0000a3f0: 6c74 6528 2757 5253 5f52 4f57 272c 3132  lte('WRS_ROW',12
+0000a400: 3029 290d 0a20 2020 2069 6620 746f 614f  0))..    if toaO
+0000a410: 7253 522e 6c6f 7765 7228 2920 3d3d 2027  rSR.lower() == '
+0000a420: 746f 6127 3a0d 0a20 2020 2020 2063 203d  toa':..      c =
+0000a430: 2063 2e6d 6170 2865 652e 416c 676f 7269   c.map(ee.Algori
+0000a440: 7468 6d73 2e4c 616e 6473 6174 2e54 4f41  thms.Landsat.TOA
+0000a450: 290d 0a0d 0a20 2020 2063 203d 2063 2e73  )....    c = c.s
+0000a460: 656c 6563 7428 6c61 6e64 7361 7453 656e  elect(landsatSen
+0000a470: 736f 7242 616e 6444 6963 745b 6c61 6e64  sorBandDict[land
+0000a480: 7361 7443 6f6c 6c65 6374 696f 6e56 6572  satCollectionVer
+0000a490: 7369 6f6e 2b27 5f27 2b77 6869 6368 432b  sion+'_'+whichC+
+0000a4a0: 275f 272b 746f 614f 7253 525d 2c6c 616e  '_'+toaOrSR],lan
+0000a4b0: 6473 6174 5365 6e73 6f72 4261 6e64 4e61  dsatSensorBandNa
+0000a4c0: 6d65 4469 6374 5b6c 616e 6473 6174 436f  meDict[landsatCo
+0000a4d0: 6c6c 6563 7469 6f6e 5665 7273 696f 6e2b  llectionVersion+
+0000a4e0: 275f 272b 746f 614f 7253 525d 290d 0a0d  '_'+toaOrSR])...
+0000a4f0: 0a20 2020 2069 6620 746f 614f 7253 522e  .    if toaOrSR.
+0000a500: 6c6f 7765 7228 2920 3d3d 2027 7372 273a  lower() == 'sr':
+0000a510: 0d0a 2020 2020 2020 7072 696e 7428 2741  ..      print('A
+0000a520: 7070 6c79 696e 6720 7363 616c 6520 6661  pplying scale fa
+0000a530: 6374 6f72 7320 666f 7220 7b7d 207b 7d20  ctors for {} {} 
+0000a540: 6461 7461 272e 666f 726d 6174 286c 616e  data'.format(lan
+0000a550: 6473 6174 436f 6c6c 6563 7469 6f6e 5665  dsatCollectionVe
+0000a560: 7273 696f 6e2c 7768 6963 6843 2929 0d0a  rsion,whichC))..
+0000a570: 2020 2020 2020 6320 3d20 632e 6d61 7028        c = c.map(
+0000a580: 6c61 6d62 6461 2069 6d61 6765 3a61 7070  lambda image:app
+0000a590: 6c79 5363 616c 6546 6163 746f 7273 2869  lyScaleFactors(i
+0000a5a0: 6d61 6765 2c6c 616e 6473 6174 436f 6c6c  mage,landsatColl
+0000a5b0: 6563 7469 6f6e 5665 7273 696f 6e29 290d  ectionVersion)).
+0000a5c0: 0a0d 0a20 2020 2072 6574 7572 6e20 630d  ...    return c.
+0000a5d0: 0a20 2064 6566 2067 6574 4c61 6e64 7361  .  def getLandsa
+0000a5e0: 7443 6f6c 6c65 6374 696f 6e73 2874 6f61  tCollections(toa
+0000a5f0: 4f72 5352 2c6c 616e 6473 6174 436f 6c6c  OrSR,landsatColl
+0000a600: 6563 7469 6f6e 5665 7273 696f 6e29 3a0d  ectionVersion):.
+0000a610: 0a20 2020 2023 4765 7420 4c61 6e64 7361  .    #Get Landsa
+0000a620: 7420 6461 7461 0d0a 2020 2020 6c34 7320  t data..    l4s 
+0000a630: 3d20 6765 744c 616e 6473 6174 436f 6c6c  = getLandsatColl
+0000a640: 6563 7469 6f6e 286c 616e 6473 6174 436f  ection(landsatCo
+0000a650: 6c6c 6563 7469 6f6e 5665 7273 696f 6e2c  llectionVersion,
+0000a660: 274c 3427 2c74 6f61 4f72 5352 290d 0a20  'L4',toaOrSR).. 
+0000a670: 2020 206c 3573 203d 2067 6574 4c61 6e64     l5s = getLand
+0000a680: 7361 7443 6f6c 6c65 6374 696f 6e28 6c61  satCollection(la
+0000a690: 6e64 7361 7443 6f6c 6c65 6374 696f 6e56  ndsatCollectionV
+0000a6a0: 6572 7369 6f6e 2c27 4c35 272c 746f 614f  ersion,'L5',toaO
+0000a6b0: 7253 5229 0d0a 0d0a 2020 2020 6966 2064  rSR)....    if d
+0000a6c0: 6566 7269 6e67 654c 353a 0d0a 2020 2020  efringeL5:..    
+0000a6d0: 2020 7072 696e 7428 2744 6566 7269 6e67    print('Defring
+0000a6e0: 696e 6720 4c34 2061 6e64 204c 3527 290d  ing L4 and L5').
+0000a6f0: 0a20 2020 2020 206c 3473 203d 206c 3473  .      l4s = l4s
+0000a700: 2e6d 6170 2864 6566 7269 6e67 654c 616e  .map(defringeLan
+0000a710: 6473 6174 290d 0a20 2020 2020 206c 3573  dsat)..      l5s
+0000a720: 203d 206c 3573 2e6d 6170 2864 6566 7269   = l5s.map(defri
+0000a730: 6e67 654c 616e 6473 6174 290d 0a0d 0a20  ngeLandsat).... 
+0000a740: 2020 206c 3873 203d 2067 6574 4c61 6e64     l8s = getLand
+0000a750: 7361 7443 6f6c 6c65 6374 696f 6e28 6c61  satCollection(la
+0000a760: 6e64 7361 7443 6f6c 6c65 6374 696f 6e56  ndsatCollectionV
+0000a770: 6572 7369 6f6e 2c27 4c38 272c 746f 614f  ersion,'L8',toaO
+0000a780: 7253 5229 0d0a 0d0a 0d0a 0d0a 2020 2320  rSR)........  # 
+0000a790: 2020 7661 7220 6c73 3b20 7661 7220 6c37    var ls; var l7
+0000a7a0: 733b 0d0a 2020 2020 6966 2069 6e63 6c75  s;..    if inclu
+0000a7b0: 6465 534c 434f 6666 4c37 3a0d 0a20 2020  deSLCOffL7:..   
+0000a7c0: 2020 2070 7269 6e74 2827 496e 636c 7564     print('Includ
+0000a7d0: 696e 6720 416c 6c20 4c61 6e64 7361 7420  ing All Landsat 
+0000a7e0: 3727 290d 0a20 2020 2020 206c 3773 203d  7')..      l7s =
+0000a7f0: 6765 744c 616e 6473 6174 436f 6c6c 6563  getLandsatCollec
+0000a800: 7469 6f6e 286c 616e 6473 6174 436f 6c6c  tion(landsatColl
+0000a810: 6563 7469 6f6e 5665 7273 696f 6e2c 274c  ectionVersion,'L
+0000a820: 3727 2c74 6f61 4f72 5352 290d 0a20 2020  7',toaOrSR)..   
+0000a830: 2065 6c73 653a 0d0a 2020 2020 2020 7072   else:..      pr
+0000a840: 696e 7428 274f 6e6c 7920 696e 636c 7564  int('Only includ
+0000a850: 696e 6720 534c 4320 4f6e 204c 616e 6473  ing SLC On Lands
+0000a860: 6174 2037 2729 3b0d 0a20 2020 2020 206c  at 7');..      l
+0000a870: 3773 203d 2067 6574 4c61 6e64 7361 7443  7s = getLandsatC
+0000a880: 6f6c 6c65 6374 696f 6e28 6c61 6e64 7361  ollection(landsa
+0000a890: 7443 6f6c 6c65 6374 696f 6e56 6572 7369  tCollectionVersi
+0000a8a0: 6f6e 2c27 4c37 272c 746f 614f 7253 5229  on,'L7',toaOrSR)
+0000a8b0: 5c0d 0a20 2020 2020 2020 2020 202e 6669  \..          .fi
+0000a8c0: 6c74 6572 4461 7465 2865 652e 4461 7465  lterDate(ee.Date
+0000a8d0: 2e66 726f 6d59 4d44 2831 3939 382c 312c  .fromYMD(1998,1,
+0000a8e0: 3129 2c65 652e 4461 7465 2e66 726f 6d59  1),ee.Date.fromY
+0000a8f0: 4d44 2832 3030 332c 352c 3331 292e 6164  MD(2003,5,31).ad
+0000a900: 7661 6e63 6528 312c 2764 6179 2729 295c  vance(1,'day'))\
+0000a910: 0d0a 0d0a 2020 2020 234d 6572 6765 2063  ....    #Merge c
+0000a920: 6f6c 6c65 6374 696f 6e73 0d0a 2020 2020  ollections..    
+0000a930: 6c73 203d 2065 652e 496d 6167 6543 6f6c  ls = ee.ImageCol
+0000a940: 6c65 6374 696f 6e28 6c34 732e 6d65 7267  lection(l4s.merg
+0000a950: 6528 6c35 7329 2e6d 6572 6765 286c 3773  e(l5s).merge(l7s
+0000a960: 292e 6d65 7267 6528 6c38 7329 290d 0a0d  ).merge(l8s))...
+0000a970: 0a20 2020 2023 2042 7269 6e67 2069 6e20  .    # Bring in 
+0000a980: 4c61 6e64 7361 7420 3920 6966 2075 7369  Landsat 9 if usi
+0000a990: 6e67 2043 6f6c 6c65 6374 696f 6e20 320d  ng Collection 2.
+0000a9a0: 0a20 2020 2069 6620 6c61 6e64 7361 7443  .    if landsatC
+0000a9b0: 6f6c 6c65 6374 696f 6e56 6572 7369 6f6e  ollectionVersion
+0000a9c0: 2e6c 6f77 6572 2829 203d 3d20 2763 3227  .lower() == 'c2'
+0000a9d0: 3a0d 0a20 2020 2020 206c 3973 203d 2067  :..      l9s = g
+0000a9e0: 6574 4c61 6e64 7361 7443 6f6c 6c65 6374  etLandsatCollect
+0000a9f0: 696f 6e28 6c61 6e64 7361 7443 6f6c 6c65  ion(landsatColle
+0000aa00: 6374 696f 6e56 6572 7369 6f6e 2c27 4c39  ctionVersion,'L9
+0000aa10: 272c 746f 614f 7253 5229 0d0a 2020 2020  ',toaOrSR)..    
+0000aa20: 2020 6c73 203d 2065 652e 496d 6167 6543    ls = ee.ImageC
+0000aa30: 6f6c 6c65 6374 696f 6e28 6c73 2e6d 6572  ollection(ls.mer
+0000aa40: 6765 286c 3973 2929 0d0a 0d0a 2020 2020  ge(l9s))....    
+0000aa50: 7265 7475 726e 206c 730d 0a0d 0a20 206c  return ls....  l
+0000aa60: 7320 3d20 6765 744c 616e 6473 6174 436f  s = getLandsatCo
+0000aa70: 6c6c 6563 7469 6f6e 7328 746f 614f 7253  llections(toaOrS
+0000aa80: 522c 6c61 6e64 7361 7443 6f6c 6c65 6374  R,landsatCollect
+0000aa90: 696f 6e56 6572 7369 6f6e 290d 0a20 2023  ionVersion)..  #
+0000aaa0: 4966 2054 4f41 2061 6e64 2046 6d61 736b  If TOA and Fmask
+0000aab0: 206e 6565 6420 746f 206d 6572 6765 2046   need to merge F
+0000aac0: 6d61 736b 2071 6120 6269 7473 2077 6974  mask qa bits wit
+0000aad0: 6820 746f 612d 2074 6869 7320 6765 7473  h toa- this gets
+0000aae0: 2074 6865 2071 6120 6261 6e64 2066 726f   the qa band fro
+0000aaf0: 6d20 7468 6520 7372 2063 6f6c 6c65 6374  m the sr collect
+0000ab00: 696f 6e73 0d0a 2020 6966 2074 6f61 4f72  ions..  if toaOr
+0000ab10: 5352 2e6c 6f77 6572 2829 203d 3d20 2774  SR.lower() == 't
+0000ab20: 6f61 2720 616e 6420 6164 6450 6978 656c  oa' and addPixel
+0000ab30: 5141 2061 6e64 206c 616e 6473 6174 436f  QA and landsatCo
+0000ab40: 6c6c 6563 7469 6f6e 5665 7273 696f 6e2e  llectionVersion.
+0000ab50: 6c6f 7765 7228 2920 3d3d 2027 6331 273a  lower() == 'c1':
+0000ab60: 0d0a 2020 2020 7072 696e 7428 2741 6371  ..    print('Acq
+0000ab70: 7569 7269 6e67 2053 5220 7161 2062 616e  uiring SR qa ban
+0000ab80: 6473 2066 6f72 2061 7070 6c79 696e 6720  ds for applying 
+0000ab90: 466d 6173 6b20 746f 2054 4f41 2064 6174  Fmask to TOA dat
+0000aba0: 6127 290d 0a20 2020 206c 3473 544f 4146  a')..    l4sTOAF
+0000abb0: 4d41 534b 203d 2065 652e 496d 6167 6543  MASK = ee.ImageC
+0000abc0: 6f6c 6c65 6374 696f 6e28 6c61 6e64 7361  ollection(landsa
+0000abd0: 7443 6f6c 6c65 6374 696f 6e44 6963 745b  tCollectionDict[
+0000abe0: 2743 315f 4c34 5f53 5227 5d29 5c0d 0a20  'C1_L4_SR'])\.. 
+0000abf0: 2020 2020 2020 2020 2020 2020 202e 6669               .fi
+0000ac00: 6c74 6572 4461 7465 2873 7461 7274 4461  lterDate(startDa
+0000ac10: 7465 2c20 656e 6444 6174 652e 6164 7661  te, endDate.adva
+0000ac20: 6e63 6528 312c 2764 6179 2729 295c 0d0a  nce(1,'day'))\..
+0000ac30: 2020 2020 2020 2020 2020 2020 2020 2e66                .f
+0000ac40: 696c 7465 7228 6565 2e46 696c 7465 722e  ilter(ee.Filter.
+0000ac50: 6361 6c65 6e64 6172 5261 6e67 6528 7374  calendarRange(st
+0000ac60: 6172 744a 756c 6961 6e2c 2065 6e64 4a75  artJulian, endJu
+0000ac70: 6c69 616e 2929 5c0d 0a20 2020 2020 2020  lian))\..       
+0000ac80: 2020 2020 2020 202e 6669 6c74 6572 426f         .filterBo
+0000ac90: 756e 6473 2873 7475 6479 4172 6561 295c  unds(studyArea)\
+0000aca0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000acb0: 2e66 696c 7465 7228 6565 2e46 696c 7465  .filter(ee.Filte
+0000acc0: 722e 6c74 6528 2757 5253 5f52 4f57 272c  r.lte('WRS_ROW',
+0000acd0: 3132 3029 295c 0d0a 2020 2020 2020 2020  120))\..        
+0000ace0: 2020 2020 2020 2e73 656c 6563 7428 6c61        .select(la
+0000acf0: 6e64 7361 7453 656e 736f 7242 616e 644e  ndsatSensorBandN
+0000ad00: 616d 6544 6963 745b 2743 315f 5352 464d  ameDict['C1_SRFM
+0000ad10: 4153 4b27 5d29 0d0a 0d0a 2020 2020 6c35  ASK'])....    l5
+0000ad20: 7354 4f41 464d 4153 4b20 3d20 6565 2e49  sTOAFMASK = ee.I
+0000ad30: 6d61 6765 436f 6c6c 6563 7469 6f6e 286c  mageCollection(l
+0000ad40: 616e 6473 6174 436f 6c6c 6563 7469 6f6e  andsatCollection
+0000ad50: 4469 6374 5b27 4331 5f4c 355f 5352 275d  Dict['C1_L5_SR']
+0000ad60: 295c 0d0a 2020 2020 2020 2020 2020 2020  )\..            
+0000ad70: 2020 2e66 696c 7465 7244 6174 6528 7374    .filterDate(st
+0000ad80: 6172 7444 6174 652c 2065 6e64 4461 7465  artDate, endDate
+0000ad90: 2e61 6476 616e 6365 2831 2c27 6461 7927  .advance(1,'day'
+0000ada0: 2929 5c0d 0a20 2020 2020 2020 2020 2020  ))\..           
+0000adb0: 2020 202e 6669 6c74 6572 2865 652e 4669     .filter(ee.Fi
+0000adc0: 6c74 6572 2e63 616c 656e 6461 7252 616e  lter.calendarRan
+0000add0: 6765 2873 7461 7274 4a75 6c69 616e 2c20  ge(startJulian, 
+0000ade0: 656e 644a 756c 6961 6e29 295c 0d0a 2020  endJulian))\..  
+0000adf0: 2020 2020 2020 2020 2020 2020 2e66 696c              .fil
+0000ae00: 7465 7242 6f75 6e64 7328 7374 7564 7941  terBounds(studyA
+0000ae10: 7265 6129 5c0d 0a20 2020 2020 2020 2020  rea)\..         
+0000ae20: 2020 2020 202e 6669 6c74 6572 2865 652e       .filter(ee.
+0000ae30: 4669 6c74 6572 2e6c 7465 2827 5752 535f  Filter.lte('WRS_
+0000ae40: 524f 5727 2c31 3230 2929 5c0d 0a20 2020  ROW',120))\..   
+0000ae50: 2020 2020 2020 2020 2020 202e 7365 6c65             .sele
+0000ae60: 6374 286c 616e 6473 6174 5365 6e73 6f72  ct(landsatSensor
+0000ae70: 4261 6e64 4e61 6d65 4469 6374 5b27 4331  BandNameDict['C1
+0000ae80: 5f53 5246 4d41 534b 275d 290d 0a0d 0a20  _SRFMASK']).... 
+0000ae90: 2020 206c 3873 544f 4146 4d41 534b 203d     l8sTOAFMASK =
+0000aea0: 2065 652e 496d 6167 6543 6f6c 6c65 6374   ee.ImageCollect
+0000aeb0: 696f 6e28 6c61 6e64 7361 7443 6f6c 6c65  ion(landsatColle
+0000aec0: 6374 696f 6e44 6963 745b 2743 315f 4c38  ctionDict['C1_L8
+0000aed0: 5f53 5227 5d29 5c0d 0a20 2020 2020 2020  _SR'])\..       
+0000aee0: 2020 2020 2020 202e 6669 6c74 6572 4461         .filterDa
+0000aef0: 7465 2873 7461 7274 4461 7465 2c20 656e  te(startDate, en
+0000af00: 6444 6174 652e 6164 7661 6e63 6528 312c  dDate.advance(1,
+0000af10: 2764 6179 2729 295c 0d0a 2020 2020 2020  'day'))\..      
+0000af20: 2020 2020 2020 2020 2e66 696c 7465 7228          .filter(
+0000af30: 6565 2e46 696c 7465 722e 6361 6c65 6e64  ee.Filter.calend
+0000af40: 6172 5261 6e67 6528 7374 6172 744a 756c  arRange(startJul
+0000af50: 6961 6e2c 2065 6e64 4a75 6c69 616e 2929  ian, endJulian))
+0000af60: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
+0000af70: 202e 6669 6c74 6572 426f 756e 6473 2873   .filterBounds(s
+0000af80: 7475 6479 4172 6561 295c 0d0a 2020 2020  tudyArea)\..    
+0000af90: 2020 2020 2020 2020 2020 2e66 696c 7465            .filte
+0000afa0: 7228 6565 2e46 696c 7465 722e 6c74 6528  r(ee.Filter.lte(
+0000afb0: 2757 5253 5f52 4f57 272c 3132 3029 295c  'WRS_ROW',120))\
+0000afc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000afd0: 2e73 656c 6563 7428 6c61 6e64 7361 7453  .select(landsatS
+0000afe0: 656e 736f 7242 616e 644e 616d 6544 6963  ensorBandNameDic
+0000aff0: 745b 2743 315f 5352 464d 4153 4b27 5d29  t['C1_SRFMASK'])
+0000b000: 0d0a 0d0a 2020 2020 6966 2069 6e63 6c75  ....    if inclu
+0000b010: 6465 534c 434f 6666 4c37 3a0d 0a20 2020  deSLCOffL7:..   
+0000b020: 2020 2070 7269 6e74 2827 496e 636c 7564     print('Includ
+0000b030: 696e 6720 416c 6c20 4c61 6e64 7361 7420  ing All Landsat 
+0000b040: 3720 666f 7220 544f 4120 5141 2729 0d0a  7 for TOA QA')..
+0000b050: 2020 2020 2020 6c37 7354 4f41 464d 4153        l7sTOAFMAS
+0000b060: 4b20 3d20 6565 2e49 6d61 6765 436f 6c6c  K = ee.ImageColl
+0000b070: 6563 7469 6f6e 286c 616e 6473 6174 436f  ection(landsatCo
+0000b080: 6c6c 6563 7469 6f6e 4469 6374 5b27 4331  llectionDict['C1
+0000b090: 5f4c 375f 5352 275d 295c 0d0a 2020 2020  _L7_SR'])\..    
+0000b0a0: 2020 2020 2020 2020 2020 2e66 696c 7465            .filte
+0000b0b0: 7244 6174 6528 7374 6172 7444 6174 652c  rDate(startDate,
+0000b0c0: 2065 6e64 4461 7465 2e61 6476 616e 6365   endDate.advance
+0000b0d0: 2831 2c27 6461 7927 2929 5c0d 0a20 2020  (1,'day'))\..   
+0000b0e0: 2020 2020 2020 2020 2020 202e 6669 6c74             .filt
+0000b0f0: 6572 2865 652e 4669 6c74 6572 2e63 616c  er(ee.Filter.cal
+0000b100: 656e 6461 7252 616e 6765 2873 7461 7274  endarRange(start
+0000b110: 4a75 6c69 616e 2c20 656e 644a 756c 6961  Julian, endJulia
+0000b120: 6e29 295c 0d0a 2020 2020 2020 2020 2020  n))\..          
+0000b130: 2020 2020 2e66 696c 7465 7242 6f75 6e64      .filterBound
+0000b140: 7328 7374 7564 7941 7265 6129 5c0d 0a20  s(studyArea)\.. 
+0000b150: 2020 2020 2020 2020 2020 2020 202e 6669               .fi
+0000b160: 6c74 6572 2865 652e 4669 6c74 6572 2e6c  lter(ee.Filter.l
+0000b170: 7465 2827 5752 535f 524f 5727 2c31 3230  te('WRS_ROW',120
+0000b180: 2929 5c0d 0a20 2020 2020 2020 2020 2020  ))\..           
+0000b190: 2020 202e 7365 6c65 6374 286c 616e 6473     .select(lands
+0000b1a0: 6174 5365 6e73 6f72 4261 6e64 4e61 6d65  atSensorBandName
+0000b1b0: 4469 6374 5b27 4331 5f53 5246 4d41 534b  Dict['C1_SRFMASK
+0000b1c0: 275d 290d 0a20 2020 2065 6c73 653a 0d0a  '])..    else:..
+0000b1d0: 2020 2020 2020 7072 696e 7428 274f 6e6c        print('Onl
+0000b1e0: 7920 696e 636c 7564 696e 6720 534c 4320  y including SLC 
+0000b1f0: 4f6e 204c 616e 6473 6174 2037 2066 6f72  On Landsat 7 for
+0000b200: 2054 4f41 2051 4127 293b 0d0a 2020 2020   TOA QA');..    
+0000b210: 2020 6c37 7354 4f41 464d 4153 4b20 3d20    l7sTOAFMASK = 
+0000b220: 2065 652e 496d 6167 6543 6f6c 6c65 6374   ee.ImageCollect
+0000b230: 696f 6e28 6c61 6e64 7361 7443 6f6c 6c65  ion(landsatColle
+0000b240: 6374 696f 6e44 6963 745b 2743 315f 4c37  ctionDict['C1_L7
+0000b250: 5f53 5227 5d29 5c0d 0a20 2020 2020 2020  _SR'])\..       
+0000b260: 2020 2020 2020 202e 6669 6c74 6572 4461         .filterDa
+0000b270: 7465 2865 652e 4461 7465 2e66 726f 6d59  te(ee.Date.fromY
+0000b280: 4d44 2831 3939 382c 312c 3129 2c20 6565  MD(1998,1,1), ee
+0000b290: 2e44 6174 652e 6672 6f6d 594d 4428 3230  .Date.fromYMD(20
+0000b2a0: 3033 2c35 2c33 3129 2e61 6476 616e 6365  03,5,31).advance
+0000b2b0: 2831 2c27 6461 7927 2929 5c0d 0a20 2020  (1,'day'))\..   
+0000b2c0: 2020 2020 2020 2020 2020 202e 6669 6c74             .filt
+0000b2d0: 6572 4461 7465 2873 7461 7274 4461 7465  erDate(startDate
+0000b2e0: 2c20 656e 6444 6174 652e 6164 7661 6e63  , endDate.advanc
+0000b2f0: 6528 312c 2764 6179 2729 295c 0d0a 2020  e(1,'day'))\..  
+0000b300: 2020 2020 2020 2020 2020 2020 2e66 696c              .fil
+0000b310: 7465 7228 6565 2e46 696c 7465 722e 6361  ter(ee.Filter.ca
+0000b320: 6c65 6e64 6172 5261 6e67 6528 7374 6172  lendarRange(star
+0000b330: 744a 756c 6961 6e2c 2065 6e64 4a75 6c69  tJulian, endJuli
+0000b340: 616e 2929 5c0d 0a20 2020 2020 2020 2020  an))\..         
+0000b350: 2020 2020 202e 6669 6c74 6572 426f 756e       .filterBoun
+0000b360: 6473 2873 7475 6479 4172 6561 295c 0d0a  ds(studyArea)\..
+0000b370: 2020 2020 2020 2020 2020 2020 2020 2e66                .f
+0000b380: 696c 7465 7228 6565 2e46 696c 7465 722e  ilter(ee.Filter.
+0000b390: 6c74 6528 2757 5253 5f52 4f57 272c 3132  lte('WRS_ROW',12
+0000b3a0: 3029 295c 0d0a 2020 2020 2020 2020 2020  0))\..          
+0000b3b0: 2020 2020 2e73 656c 6563 7428 6c61 6e64      .select(land
+0000b3c0: 7361 7453 656e 736f 7242 616e 644e 616d  satSensorBandNam
+0000b3d0: 6544 6963 745b 2743 315f 5352 464d 4153  eDict['C1_SRFMAS
+0000b3e0: 4b27 5d29 0d0a 0d0a 2020 2020 6c73 544f  K'])....    lsTO
+0000b3f0: 4146 4d41 534b 203d 2065 652e 496d 6167  AFMASK = ee.Imag
+0000b400: 6543 6f6c 6c65 6374 696f 6e28 6c34 7354  eCollection(l4sT
+0000b410: 4f41 464d 4153 4b2e 6d65 7267 6528 6c35  OAFMASK.merge(l5
+0000b420: 7354 4f41 464d 4153 4b29 2e6d 6572 6765  sTOAFMASK).merge
+0000b430: 286c 3773 544f 4146 4d41 534b 292e 6d65  (l7sTOAFMASK).me
+0000b440: 7267 6528 6c38 7354 4f41 464d 4153 4b29  rge(l8sTOAFMASK)
+0000b450: 290d 0a0d 0a20 2020 2023 4a6f 696e 2074  )....    #Join t
+0000b460: 6865 2054 4f41 2077 6974 6820 5352 2051  he TOA with SR Q
+0000b470: 4120 6261 6e64 730d 0a20 2020 2070 7269  A bands..    pri
+0000b480: 6e74 2827 4a6f 696e 696e 6720 544f 4120  nt('Joining TOA 
+0000b490: 7769 7468 2053 5220 5141 2062 616e 6473  with SR QA bands
+0000b4a0: 2729 0d0a 2020 2020 2370 7269 6e74 286c  ')..    #print(l
+0000b4b0: 732e 7369 7a65 2829 2c20 6c73 544f 4146  s.size(), lsTOAF
+0000b4c0: 4d41 534b 2e73 697a 6528 2929 0d0a 2020  MASK.size())..  
+0000b4d0: 2020 6c73 203d 206a 6f69 6e43 6f6c 6c65    ls = joinColle
+0000b4e0: 6374 696f 6e73 286c 732e 7365 6c65 6374  ctions(ls.select
+0000b4f0: 285b 302c 312c 322c 332c 342c 352c 365d  ([0,1,2,3,4,5,6]
+0000b500: 292c 206c 7354 4f41 464d 4153 4b2c 2046  ), lsTOAFMASK, F
+0000b510: 616c 7365 2c20 2773 7973 7465 6d3a 696e  alse, 'system:in
+0000b520: 6465 7827 290d 0a20 2020 2023 206c 7354  dex')..    # lsT
+0000b530: 4f41 464d 4153 4b20 3d20 6765 744c 616e  OAFMASK = getLan
+0000b540: 6473 6174 2827 5352 2729 2e73 656c 6563  dsat('SR').selec
+0000b550: 7428 5b27 7069 7865 6c5f 7161 275d 290d  t(['pixel_qa']).
+0000b560: 0a20 2020 2023 2023 4a6f 696e 2074 6865  .    # #Join the
+0000b570: 2054 4f41 2077 6974 6820 5352 2051 4120   TOA with SR QA 
+0000b580: 6261 6e64 730d 0a20 2020 2023 2070 7269  bands..    # pri
+0000b590: 6e74 2827 4a6f 696e 696e 6720 544f 4120  nt('Joining TOA 
+0000b5a0: 7769 7468 2053 5220 5141 2062 616e 6473  with SR QA bands
+0000b5b0: 2729 0d0a 2020 2020 2320 6c73 203d 206a  ')..    # ls = j
+0000b5c0: 6f69 6e43 6f6c 6c65 6374 696f 6e73 286c  oinCollections(l
+0000b5d0: 732e 7365 6c65 6374 285b 302c 312c 322c  s.select([0,1,2,
+0000b5e0: 332c 342c 352c 365d 292c 6c73 544f 4146  3,4,5,6]),lsTOAF
+0000b5f0: 4d41 534b 290d 0a0d 0a20 2064 6566 2064  MASK)....  def d
+0000b600: 6174 6149 6e41 6c6c 4261 6e64 7328 696d  ataInAllBands(im
+0000b610: 6729 3a0d 0a20 2020 2072 6574 7572 6e20  g):..    return 
+0000b620: 696d 672e 7570 6461 7465 4d61 736b 2869  img.updateMask(i
+0000b630: 6d67 2e73 656c 6563 7428 5b27 626c 7565  mg.select(['blue
+0000b640: 272c 2767 7265 656e 272c 2772 6564 272c  ','green','red',
+0000b650: 276e 6972 272c 2773 7769 7231 272c 2773  'nir','swir1','s
+0000b660: 7769 7232 275d 292e 6d61 736b 2829 2e72  wir2']).mask().r
+0000b670: 6564 7563 6528 6565 2e52 6564 7563 6572  educe(ee.Reducer
+0000b680: 2e6d 696e 2829 2929 0d0a 2020 2020 2320  .min()))..    # 
+0000b690: 7265 7475 726e 2069 6d67 2e6d 756c 7469  return img.multi
+0000b6a0: 706c 7928 6d75 6c74 496d 6167 6544 6963  ply(multImageDic
+0000b6b0: 745b 746f 614f 7253 525d 292e 636f 7079  t[toaOrSR]).copy
+0000b6c0: 5072 6f70 6572 7469 6573 2869 6d67 2c5b  Properties(img,[
+0000b6d0: 2773 7973 7465 6d3a 7469 6d65 5f73 7461  'system:time_sta
+0000b6e0: 7274 275d 292e 636f 7079 5072 6f70 6572  rt']).copyProper
+0000b6f0: 7469 6573 2869 6d67 290d 0a0d 0a20 2023  ties(img)....  #
+0000b700: 4d61 6b65 2073 7572 6520 616c 6c20 6261  Make sure all ba
+0000b710: 6e64 7320 6861 7665 2064 6174 610d 0a20  nds have data.. 
+0000b720: 206c 7320 3d20 6c73 2e6d 6170 2864 6174   ls = ls.map(dat
+0000b730: 6149 6e41 6c6c 4261 6e64 7329 0d0a 0d0a  aInAllBands)....
+0000b740: 2020 2320 5365 7420 7265 7361 6d70 6c69    # Set resampli
+0000b750: 6e67 206d 6574 686f 6420 2d20 6f6e 6c79  ng method - only
+0000b760: 2073 6574 7320 746f 206e 6f6e 206e 6561   sets to non nea
+0000b770: 7265 7374 2d6e 6569 6768 626f 7220 666f  rest-neighbor fo
+0000b780: 7220 636f 6e74 696e 756f 7573 2062 616e  r continuous ban
+0000b790: 6473 0d0a 2020 6465 6620 7365 7452 6573  ds..  def setRes
+0000b7a0: 616d 706c 6528 696d 6729 3a0d 0a20 2020  ample(img):..   
+0000b7b0: 2072 6574 7572 6e20 696d 672e 7265 7361   return img.resa
+0000b7c0: 6d70 6c65 2872 6573 616d 706c 654d 6574  mple(resampleMet
+0000b7d0: 686f 6429 0d0a 0d0a 2020 6966 2072 6573  hod)....  if res
+0000b7e0: 616d 706c 654d 6574 686f 6420 696e 205b  ampleMethod in [
+0000b7f0: 2762 696c 696e 6561 7227 2c27 6269 6375  'bilinear','bicu
+0000b800: 6269 6327 5d3a 0d0a 2020 2020 7072 696e  bic']:..    prin
+0000b810: 7428 2753 6574 7469 6e67 2072 6573 616d  t('Setting resam
+0000b820: 706c 6520 6d65 7468 6f64 2074 6f20 272c  ple method to ',
+0000b830: 7265 7361 6d70 6c65 4d65 7468 6f64 290d  resampleMethod).
+0000b840: 0a20 2020 206c 7320 3d20 6c73 2e6d 6170  .    ls = ls.map
+0000b850: 286c 616d 6264 6120 696d 673a 2069 6d67  (lambda img: img
+0000b860: 2e61 6464 4261 6e64 7328 696d 672e 7365  .addBands(img.se
+0000b870: 6c65 6374 286c 616e 6473 6174 5f63 6f6e  lect(landsat_con
+0000b880: 7469 6e75 6f75 735f 6261 6e64 7329 2e72  tinuous_bands).r
+0000b890: 6573 616d 706c 6528 7265 7361 6d70 6c65  esample(resample
+0000b8a0: 4d65 7468 6f64 292c 4e6f 6e65 2c54 7275  Method),None,Tru
+0000b8b0: 6529 290d 0a20 2065 6c69 6620 7265 7361  e))..  elif resa
+0000b8c0: 6d70 6c65 4d65 7468 6f64 203d 3d20 2761  mpleMethod == 'a
+0000b8d0: 6767 7265 6761 7465 273a 0d0a 2020 2020  ggregate':..    
+0000b8e0: 7072 696e 7428 2753 6574 7469 6e67 2074  print('Setting t
+0000b8f0: 6f20 6167 6772 6567 6174 6520 696e 7374  o aggregate inst
+0000b900: 6561 6420 6f66 2072 6573 616d 706c 6520  ead of resample 
+0000b910: 2729 0d0a 2020 2020 6c73 203d 206c 732e  ')..    ls = ls.
+0000b920: 6d61 7028 6c61 6d62 6461 2069 6d67 3a20  map(lambda img: 
+0000b930: 696d 672e 6164 6442 616e 6473 2869 6d67  img.addBands(img
+0000b940: 2e73 656c 6563 7428 6c61 6e64 7361 745f  .select(landsat_
+0000b950: 636f 6e74 696e 756f 7573 5f62 616e 6473  continuous_bands
+0000b960: 292e 7265 6475 6365 5265 736f 6c75 7469  ).reduceResoluti
+0000b970: 6f6e 2865 652e 5265 6475 6365 722e 6d65  on(ee.Reducer.me
+0000b980: 616e 2829 2c20 5472 7565 2c20 3634 292c  an(), True, 64),
+0000b990: 4e6f 6e65 2c54 7275 6529 290d 0a0d 0a20  None,True)).... 
+0000b9a0: 2072 6574 7572 6e20 6c73 2e73 6574 2861   return ls.set(a
+0000b9b0: 7267 7329 0d0a 0d0a 6765 7449 6d61 6765  rgs)....getImage
+0000b9c0: 436f 6c6c 6563 7469 6f6e 203d 2067 6574  Collection = get
+0000b9d0: 4c61 6e64 7361 740d 0a0d 0a23 2323 2323  Landsat....#####
+0000b9e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000b9f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000ba00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000ba10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000ba20: 2323 2323 2323 0d0a 2348 656c 7065 7220  ######..#Helper 
+0000ba30: 6675 6e63 7469 6f6e 2074 6f20 6170 706c  function to appl
+0000ba40: 7920 616e 2065 7870 7265 7373 696f 6e20  y an expression 
+0000ba50: 616e 6420 6c69 6e65 6172 6c79 2072 6573  and linearly res
+0000ba60: 6361 6c65 2074 6865 206f 7574 7075 742e  cale the output.
+0000ba70: 0d0a 2355 7365 6420 696e 2074 6865 206c  ..#Used in the l
+0000ba80: 616e 6473 6174 436c 6f75 6453 636f 7265  andsatCloudScore
+0000ba90: 2066 756e 6374 696f 6e20 6265 6c6f 772e   function below.
+0000baa0: 0d0a 6465 6620 7265 7363 616c 6528 696d  ..def rescale(im
+0000bab0: 672c 2074 6872 6573 686f 6c64 7329 3a0d  g, thresholds):.
+0000bac0: 0a20 2020 2072 6574 7572 6e20 696d 672e  .    return img.
+0000bad0: 7375 6274 7261 6374 2874 6872 6573 686f  subtract(thresho
+0000bae0: 6c64 735b 305d 292e 6469 7669 6465 2874  lds[0]).divide(t
+0000baf0: 6872 6573 686f 6c64 735b 315d 202d 2074  hresholds[1] - t
+0000bb00: 6872 6573 686f 6c64 735b 305d 290d 0a23  hresholds[0])..#
+0000bb10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000bb20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000bb30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000bb40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000bb50: 2323 2323 2323 2323 2323 0d0a 2320 2f2a  ##########..# /*
+0000bb60: 2a2a 0d0a 2320 202a 2049 6d70 6c65 6d65  **..#  * Impleme
+0000bb70: 6e74 6174 696f 6e20 6f66 2042 6173 6963  ntation of Basic
+0000bb80: 2063 6c6f 7564 2073 6861 646f 7720 7368   cloud shadow sh
+0000bb90: 6966 740d 0a23 2020 2a0d 0a23 2020 2a20  ift..#  *..#  * 
+0000bba0: 4175 7468 6f72 3a20 4765 6e6e 6164 6969  Author: Gennadii
+0000bbb0: 2044 6f6e 6368 7974 730d 0a23 2020 2a20   Donchyts..#  * 
+0000bbc0: 4c69 6365 6e73 653a 2041 7061 6368 6520  License: Apache 
+0000bbd0: 322e 300d 0a23 2020 2a2f 0d0a 2343 6c6f  2.0..#  */..#Clo
+0000bbe0: 7564 2068 6569 6768 7473 2061 6464 6564  ud heights added
+0000bbf0: 2062 7920 4961 6e20 486f 7573 6d61 6e0d   by Ian Housman.
+0000bc00: 0a23 2079 4d75 6c74 2062 7567 2066 6978  .# yMult bug fix
+0000bc10: 2061 6461 7074 6564 2066 726f 6d20 636f   adapted from co
+0000bc20: 6465 2077 7269 7474 656e 2062 7920 4e6f  de written by No
+0000bc30: 656c 2047 6f72 656c 6963 6b20 6279 2049  el Gorelick by I
+0000bc40: 616e 2048 6f75 736d 616e 0d0a 6465 6620  an Housman..def 
+0000bc50: 7072 6f6a 6563 7453 6861 646f 7773 2863  projectShadows(c
+0000bc60: 6c6f 7564 4d61 736b 2c69 6d61 6765 2c69  loudMask,image,i
+0000bc70: 7253 756d 5468 7265 7368 2c63 6f6e 7472  rSumThresh,contr
+0000bc80: 6163 7450 6978 656c 732c 6469 6c61 7465  actPixels,dilate
+0000bc90: 5069 7865 6c73 2c63 6c6f 7564 4865 6967  Pixels,cloudHeig
+0000bca0: 6874 732c 794d 756c 7420 3d20 4e6f 6e65  hts,yMult = None
+0000bcb0: 293a 0d0a 2020 6966 2879 4d75 6c74 203d  ):..  if(yMult =
+0000bcc0: 3d20 4e6f 6e65 293a 0d0a 2020 2020 794d  = None):..    yM
+0000bcd0: 756c 7420 3d20 6565 2e41 6c67 6f72 6974  ult = ee.Algorit
+0000bce0: 686d 732e 4966 2865 652e 416c 676f 7269  hms.If(ee.Algori
+0000bcf0: 7468 6d73 2e49 7345 7175 616c 2869 6d61  thms.IsEqual(ima
+0000bd00: 6765 2e73 656c 6563 7428 5b33 5d29 2e70  ge.select([3]).p
+0000bd10: 726f 6a65 6374 696f 6e28 292c 2065 652e  rojection(), ee.
+0000bd20: 5072 6f6a 6563 7469 6f6e 2822 4550 5347  Projection("EPSG
+0000bd30: 3a34 3332 3622 2929 2c31 2c2d 3129 0d0a  :4326")),1,-1)..
+0000bd40: 0d0a 2020 6d65 616e 417a 696d 7574 6820  ..  meanAzimuth 
+0000bd50: 3d20 696d 6167 652e 6765 7428 274d 4541  = image.get('MEA
+0000bd60: 4e5f 534f 4c41 525f 415a 494d 5554 485f  N_SOLAR_AZIMUTH_
+0000bd70: 414e 474c 4527 290d 0a20 206d 6561 6e5a  ANGLE')..  meanZ
+0000bd80: 656e 6974 6820 3d20 696d 6167 652e 6765  enith = image.ge
+0000bd90: 7428 274d 4541 4e5f 534f 4c41 525f 5a45  t('MEAN_SOLAR_ZE
+0000bda0: 4e49 5448 5f41 4e47 4c45 2729 0d0a 2020  NITH_ANGLE')..  
+0000bdb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000bdc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000bdd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000bde0: 2323 0d0a 2020 2370 7269 6e74 2827 6127  ##..  #print('a'
+0000bdf0: 2c6d 6561 6e41 7a69 6d75 7468 290d 0a20  ,meanAzimuth).. 
+0000be00: 2023 7072 696e 7428 277a 272c 6d65 616e   #print('z',mean
+0000be10: 5a65 6e69 7468 290d 0a0d 0a20 2023 4669  Zenith)....  #Fi
+0000be20: 6e64 2064 6172 6b20 7069 7865 6c73 0d0a  nd dark pixels..
+0000be30: 2020 6461 726b 5069 7865 6c73 203d 2069    darkPixels = i
+0000be40: 6d61 6765 2e73 656c 6563 7428 5b27 6e69  mage.select(['ni
+0000be50: 7227 2c27 7377 6972 3127 2c27 7377 6972  r','swir1','swir
+0000be60: 3227 5d29 2e72 6564 7563 6528 6565 2e52  2']).reduce(ee.R
+0000be70: 6564 7563 6572 2e73 756d 2829 292e 6c74  educer.sum()).lt
+0000be80: 2869 7253 756d 5468 7265 7368 295c 0d0a  (irSumThresh)\..
+0000be90: 2020 2020 2e66 6f63 616c 5f6d 696e 2863      .focal_min(c
+0000bea0: 6f6e 7472 6163 7450 6978 656c 7329 2e66  ontractPixels).f
+0000beb0: 6f63 616c 5f6d 6178 2864 696c 6174 6550  ocal_max(dilateP
+0000bec0: 6978 656c 7329 0d0a 2020 2020 232e 6774  ixels)..    #.gt
+0000bed0: 6528 3129 0d0a 0d0a 0d0a 2020 2347 6574  e(1)......  #Get
+0000bee0: 2073 6361 6c65 206f 6620 696d 6167 650d   scale of image.
+0000bef0: 0a20 206e 6f6d 696e 616c 5363 616c 6520  .  nominalScale 
+0000bf00: 3d20 636c 6f75 644d 6173 6b2e 7072 6f6a  = cloudMask.proj
+0000bf10: 6563 7469 6f6e 2829 2e6e 6f6d 696e 616c  ection().nominal
+0000bf20: 5363 616c 6528 290d 0a20 2023 4669 6e64  Scale()..  #Find
+0000bf30: 2077 6865 7265 2063 6c6f 7564 2073 6861   where cloud sha
+0000bf40: 646f 7773 2073 686f 756c 6420 6265 2062  dows should be b
+0000bf50: 6173 6564 206f 6e20 736f 6c61 7220 6765  ased on solar ge
+0000bf60: 6f6d 6574 7279 0d0a 2020 2343 6f6e 7665  ometry..  #Conve
+0000bf70: 7274 2074 6f20 7261 6469 616e 730d 0a20  rt to radians.. 
+0000bf80: 2061 7a52 203d 6565 2e4e 756d 6265 7228   azR =ee.Number(
+0000bf90: 6d65 616e 417a 696d 7574 6829 2e61 6464  meanAzimuth).add
+0000bfa0: 2831 3830 292e 6d75 6c74 6970 6c79 284d  (180).multiply(M
+0000bfb0: 6174 682e 5049 292e 6469 7669 6465 2831  ath.PI).divide(1
+0000bfc0: 3830 2e30 290d 0a20 207a 656e 5220 203d  80.0)..  zenR  =
+0000bfd0: 6565 2e4e 756d 6265 7228 6d65 616e 5a65  ee.Number(meanZe
+0000bfe0: 6e69 7468 292e 6d75 6c74 6970 6c79 284d  nith).multiply(M
+0000bff0: 6174 682e 5049 292e 6469 7669 6465 2831  ath.PI).divide(1
+0000c000: 3830 2e30 290d 0a0d 0a0d 0a20 2064 6566  80.0)......  def
+0000c010: 2063 6173 7453 6861 646f 7773 2863 6c6f   castShadows(clo
+0000c020: 7564 4865 6967 6874 293a 0d0a 2020 2020  udHeight):..    
+0000c030: 636c 6f75 6448 6569 6768 7420 3d20 6565  cloudHeight = ee
+0000c040: 2e4e 756d 6265 7228 636c 6f75 6448 6569  .Number(cloudHei
+0000c050: 6768 7429 0d0a 2020 2020 7368 6164 6f77  ght)..    shadow
+0000c060: 4361 7374 6564 4469 7374 616e 6365 203d  CastedDistance =
+0000c070: 207a 656e 522e 7461 6e28 292e 6d75 6c74   zenR.tan().mult
+0000c080: 6970 6c79 2863 6c6f 7564 4865 6967 6874  iply(cloudHeight
+0000c090: 2923 4469 7374 616e 6365 2073 6861 646f  )#Distance shado
+0000c0a0: 7720 6973 2063 6173 740d 0a20 2020 2078  w is cast..    x
+0000c0b0: 203d 2061 7a52 2e73 696e 2829 2e6d 756c   = azR.sin().mul
+0000c0c0: 7469 706c 7928 7368 6164 6f77 4361 7374  tiply(shadowCast
+0000c0d0: 6564 4469 7374 616e 6365 292e 6469 7669  edDistance).divi
+0000c0e0: 6465 286e 6f6d 696e 616c 5363 616c 6529  de(nominalScale)
+0000c0f0: 2358 2064 6973 7461 6e63 6520 6f66 2073  #X distance of s
+0000c100: 6861 646f 770d 0a20 2020 2079 203d 2061  hadow..    y = a
+0000c110: 7a52 2e63 6f73 2829 2e6d 756c 7469 706c  zR.cos().multipl
+0000c120: 7928 7368 6164 6f77 4361 7374 6564 4469  y(shadowCastedDi
+0000c130: 7374 616e 6365 292e 6469 7669 6465 286e  stance).divide(n
+0000c140: 6f6d 696e 616c 5363 616c 6529 2e6d 756c  ominalScale).mul
+0000c150: 7469 706c 7928 794d 756c 7429 3b23 5920  tiply(yMult);#Y 
+0000c160: 6469 7374 616e 6365 206f 6620 7368 6164  distance of shad
+0000c170: 6f77 0d0a 2020 2020 7265 7475 726e 2063  ow..    return c
+0000c180: 6c6f 7564 4d61 736b 2e63 6861 6e67 6550  loudMask.changeP
+0000c190: 726f 6a28 636c 6f75 644d 6173 6b2e 7072  roj(cloudMask.pr
+0000c1a0: 6f6a 6563 7469 6f6e 2829 2c20 636c 6f75  ojection(), clou
+0000c1b0: 644d 6173 6b2e 7072 6f6a 6563 7469 6f6e  dMask.projection
+0000c1c0: 2829 2e74 7261 6e73 6c61 7465 2878 2c20  ().translate(x, 
+0000c1d0: 7929 290d 0a0d 0a0d 0a20 2023 4669 6e64  y))......  #Find
+0000c1e0: 2074 6865 2073 6861 646f 7773 0d0a 2020   the shadows..  
+0000c1f0: 7368 6164 6f77 7320 3d20 636c 6f75 6448  shadows = cloudH
+0000c200: 6569 6768 7473 2e6d 6170 2863 6173 7453  eights.map(castS
+0000c210: 6861 646f 7773 290d 0a0d 0a20 2073 6861  hadows)....  sha
+0000c220: 646f 774d 6173 6b20 3d20 6565 2e49 6d61  dowMask = ee.Ima
+0000c230: 6765 436f 6c6c 6563 7469 6f6e 2e66 726f  geCollection.fro
+0000c240: 6d49 6d61 6765 7328 7368 6164 6f77 7329  mImages(shadows)
+0000c250: 2e6d 6178 2829 0d0a 0d0a 2020 2343 7265  .max()....  #Cre
+0000c260: 6174 6520 7368 6164 6f77 206d 6173 6b0d  ate shadow mask.
+0000c270: 0a20 2073 6861 646f 774d 6173 6b20 3d20  .  shadowMask = 
+0000c280: 7368 6164 6f77 4d61 736b 2e41 6e64 2863  shadowMask.And(c
+0000c290: 6c6f 7564 4d61 736b 2e4e 6f74 2829 290d  loudMask.Not()).
+0000c2a0: 0a20 2073 6861 646f 774d 6173 6b20 3d20  .  shadowMask = 
+0000c2b0: 7368 6164 6f77 4d61 736b 2e41 6e64 2864  shadowMask.And(d
+0000c2c0: 6172 6b50 6978 656c 7329 2e66 6f63 616c  arkPixels).focal
+0000c2d0: 5f6d 696e 2863 6f6e 7472 6163 7450 6978  _min(contractPix
+0000c2e0: 656c 7329 2e66 6f63 616c 5f6d 6178 2864  els).focal_max(d
+0000c2f0: 696c 6174 6550 6978 656c 7329 0d0a 2020  ilatePixels)..  
+0000c300: 234d 6170 2e61 6464 4c61 7965 7228 636c  #Map.addLayer(cl
+0000c310: 6f75 644d 6173 6b2e 7570 6461 7465 4d61  oudMask.updateMa
+0000c320: 736b 2863 6c6f 7564 4d61 736b 292c 7b27  sk(cloudMask),{'
+0000c330: 6d69 6e27 3a31 2c27 6d61 7827 3a31 2c27  min':1,'max':1,'
+0000c340: 7061 6c65 7474 6527 3a27 3838 4627 7d2c  palette':'88F'},
+0000c350: 2743 6c6f 7564 206d 6173 6b27 290d 0a20  'Cloud mask').. 
+0000c360: 2023 4d61 702e 6164 644c 6179 6572 2873   #Map.addLayer(s
+0000c370: 6861 646f 774d 6173 6b2e 7570 6461 7465  hadowMask.update
+0000c380: 4d61 736b 2873 6861 646f 774d 6173 6b29  Mask(shadowMask)
 0000c390: 2c7b 276d 696e 273a 312c 276d 6178 273a  ,{'min':1,'max':
-0000c3a0: 312c 2770 616c 6574 7465 273a 2738 3846  1,'palette':'88F
-0000c3b0: 277d 2c27 436c 6f75 6420 6d61 736b 2729  '},'Cloud mask')
-0000c3c0: 0d0a 2020 234d 6170 2e61 6464 4c61 7965  ..  #Map.addLaye
-0000c3d0: 7228 7368 6164 6f77 4d61 736b 2e75 7064  r(shadowMask.upd
-0000c3e0: 6174 654d 6173 6b28 7368 6164 6f77 4d61  ateMask(shadowMa
-0000c3f0: 736b 292c 7b27 6d69 6e27 3a31 2c27 6d61  sk),{'min':1,'ma
-0000c400: 7827 3a31 2c27 7061 6c65 7474 6527 3a27  x':1,'palette':'
-0000c410: 3838 3027 7d2c 2753 6861 646f 7720 6d61  880'},'Shadow ma
-0000c420: 736b 2729 0d0a 0d0a 2020 636c 6f75 6453  sk')....  cloudS
-0000c430: 6861 646f 774d 6173 6b20 3d20 7368 6164  hadowMask = shad
-0000c440: 6f77 4d61 736b 2e4f 7228 636c 6f75 644d  owMask.Or(cloudM
-0000c450: 6173 6b29 0d0a 0d0a 2020 696d 6167 6520  ask)....  image 
-0000c460: 3d20 696d 6167 652e 7570 6461 7465 4d61  = image.updateMa
-0000c470: 736b 2863 6c6f 7564 5368 6164 6f77 4d61  sk(cloudShadowMa
-0000c480: 736b 2e4e 6f74 2829 292e 6164 6442 616e  sk.Not()).addBan
-0000c490: 6473 2873 6861 646f 774d 6173 6b2e 7265  ds(shadowMask.re
-0000c4a0: 6e61 6d65 285b 2763 6c6f 7564 5368 6164  name(['cloudShad
-0000c4b0: 6f77 4d61 736b 275d 2929 0d0a 2020 7265  owMask']))..  re
-0000c4c0: 7475 726e 2069 6d61 6765 0d0a 0d0a 6465  turn image....de
-0000c4d0: 6620 7072 6f6a 6563 7453 6861 646f 7773  f projectShadows
-0000c4e0: 5772 6170 7065 7228 5c0d 0a20 2069 6d67  Wrapper(\..  img
-0000c4f0: 2c0d 0a20 2063 6c6f 7564 5468 7265 7368  ,..  cloudThresh
-0000c500: 203d 2032 302c 0d0a 2020 6972 5375 6d54   = 20,..  irSumT
-0000c510: 6872 6573 6820 3d20 302e 3335 2c0d 0a20  hresh = 0.35,.. 
-0000c520: 2063 6f6e 7472 6163 7450 6978 656c 7320   contractPixels 
-0000c530: 3d20 312e 352c 0d0a 2020 6469 6c61 7465  = 1.5,..  dilate
-0000c540: 5069 7865 6c73 203d 2033 2e35 2c0d 0a20  Pixels = 3.5,.. 
-0000c550: 2063 6c6f 7564 4865 6967 6874 7320 3d20   cloudHeights = 
-0000c560: 6565 2e4c 6973 742e 7365 7175 656e 6365  ee.List.sequence
-0000c570: 2835 3030 2c31 3030 3030 2c35 3030 2929  (500,10000,500))
-0000c580: 3a0d 0a0d 0a20 2061 7267 7320 3d20 666f  :....  args = fo
-0000c590: 726d 6174 4172 6773 286c 6f63 616c 7328  rmatArgs(locals(
-0000c5a0: 2929 0d0a 0d0a 2020 636c 6f75 644d 6173  ))....  cloudMas
-0000c5b0: 6b20 3d20 7365 6e74 696e 656c 3243 6c6f  k = sentinel2Clo
-0000c5c0: 7564 5363 6f72 6528 696d 6729 2e67 7428  udScore(img).gt(
-0000c5d0: 636c 6f75 6454 6872 6573 6829 5c0d 0a20  cloudThresh)\.. 
-0000c5e0: 2020 202e 666f 6361 6c5f 6d69 6e28 636f     .focal_min(co
-0000c5f0: 6e74 7261 6374 5069 7865 6c73 292e 666f  ntractPixels).fo
-0000c600: 6361 6c5f 6d61 7828 6469 6c61 7465 5069  cal_max(dilatePi
-0000c610: 7865 6c73 290d 0a0d 0a20 2069 6d67 203d  xels)....  img =
-0000c620: 2070 726f 6a65 6374 5368 6164 6f77 7328   projectShadows(
-0000c630: 636c 6f75 644d 6173 6b2c 696d 672c 6972  cloudMask,img,ir
-0000c640: 5375 6d54 6872 6573 682c 636f 6e74 7261  SumThresh,contra
-0000c650: 6374 5069 7865 6c73 2c64 696c 6174 6550  ctPixels,dilateP
-0000c660: 6978 656c 732c 636c 6f75 6448 6569 6768  ixels,cloudHeigh
-0000c670: 7473 290d 0a0d 0a20 2072 6574 7572 6e20  ts)....  return 
-0000c680: 696d 672e 7365 7428 6172 6773 290d 0a0d  img.set(args)...
-0000c690: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+0000c3a0: 312c 2770 616c 6574 7465 273a 2738 3830  1,'palette':'880
+0000c3b0: 277d 2c27 5368 6164 6f77 206d 6173 6b27  '},'Shadow mask'
+0000c3c0: 290d 0a0d 0a20 2063 6c6f 7564 5368 6164  )....  cloudShad
+0000c3d0: 6f77 4d61 736b 203d 2073 6861 646f 774d  owMask = shadowM
+0000c3e0: 6173 6b2e 4f72 2863 6c6f 7564 4d61 736b  ask.Or(cloudMask
+0000c3f0: 290d 0a0d 0a20 2069 6d61 6765 203d 2069  )....  image = i
+0000c400: 6d61 6765 2e75 7064 6174 654d 6173 6b28  mage.updateMask(
+0000c410: 636c 6f75 6453 6861 646f 774d 6173 6b2e  cloudShadowMask.
+0000c420: 4e6f 7428 2929 2e61 6464 4261 6e64 7328  Not()).addBands(
+0000c430: 7368 6164 6f77 4d61 736b 2e72 656e 616d  shadowMask.renam
+0000c440: 6528 5b27 636c 6f75 6453 6861 646f 774d  e(['cloudShadowM
+0000c450: 6173 6b27 5d29 290d 0a20 2072 6574 7572  ask']))..  retur
+0000c460: 6e20 696d 6167 650d 0a0d 0a64 6566 2070  n image....def p
+0000c470: 726f 6a65 6374 5368 6164 6f77 7357 7261  rojectShadowsWra
+0000c480: 7070 6572 285c 0d0a 2020 696d 672c 0d0a  pper(\..  img,..
+0000c490: 2020 636c 6f75 6454 6872 6573 6820 3d20    cloudThresh = 
+0000c4a0: 3230 2c0d 0a20 2069 7253 756d 5468 7265  20,..  irSumThre
+0000c4b0: 7368 203d 2030 2e33 352c 0d0a 2020 636f  sh = 0.35,..  co
+0000c4c0: 6e74 7261 6374 5069 7865 6c73 203d 2031  ntractPixels = 1
+0000c4d0: 2e35 2c0d 0a20 2064 696c 6174 6550 6978  .5,..  dilatePix
+0000c4e0: 656c 7320 3d20 332e 352c 0d0a 2020 636c  els = 3.5,..  cl
+0000c4f0: 6f75 6448 6569 6768 7473 203d 2065 652e  oudHeights = ee.
+0000c500: 4c69 7374 2e73 6571 7565 6e63 6528 3530  List.sequence(50
+0000c510: 302c 3130 3030 302c 3530 3029 293a 0d0a  0,10000,500)):..
+0000c520: 0d0a 2020 6172 6773 203d 2066 6f72 6d61  ..  args = forma
+0000c530: 7441 7267 7328 6c6f 6361 6c73 2829 290d  tArgs(locals()).
+0000c540: 0a0d 0a20 2063 6c6f 7564 4d61 736b 203d  ...  cloudMask =
+0000c550: 2073 656e 7469 6e65 6c32 436c 6f75 6453   sentinel2CloudS
+0000c560: 636f 7265 2869 6d67 292e 6774 2863 6c6f  core(img).gt(clo
+0000c570: 7564 5468 7265 7368 295c 0d0a 2020 2020  udThresh)\..    
+0000c580: 2e66 6f63 616c 5f6d 696e 2863 6f6e 7472  .focal_min(contr
+0000c590: 6163 7450 6978 656c 7329 2e66 6f63 616c  actPixels).focal
+0000c5a0: 5f6d 6178 2864 696c 6174 6550 6978 656c  _max(dilatePixel
+0000c5b0: 7329 0d0a 0d0a 2020 696d 6720 3d20 7072  s)....  img = pr
+0000c5c0: 6f6a 6563 7453 6861 646f 7773 2863 6c6f  ojectShadows(clo
+0000c5d0: 7564 4d61 736b 2c69 6d67 2c69 7253 756d  udMask,img,irSum
+0000c5e0: 5468 7265 7368 2c63 6f6e 7472 6163 7450  Thresh,contractP
+0000c5f0: 6978 656c 732c 6469 6c61 7465 5069 7865  ixels,dilatePixe
+0000c600: 6c73 2c63 6c6f 7564 4865 6967 6874 7329  ls,cloudHeights)
+0000c610: 0d0a 0d0a 2020 7265 7475 726e 2069 6d67  ....  return img
+0000c620: 2e73 6574 2861 7267 7329 0d0a 0d0a 2323  .set(args)....##
+0000c630: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c640: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c650: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c660: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c670: 2323 2323 2323 230d 0a23 2323 2323 2323  #######..#######
+0000c680: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c690: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000c6a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000c6b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c6c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c6d0: 2323 2323 2323 2323 2323 0d0a 2323 2323  ##########..####
-0000c6e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c6f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c700: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c710: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c720: 2323 2323 230d 0a23 4675 6e63 7469 6f6e  #####..#Function
-0000c730: 2074 6f20 6d61 736b 2063 6c6f 7564 7320   to mask clouds 
-0000c740: 7573 696e 6720 7468 6520 5365 6e74 696e  using the Sentin
-0000c750: 656c 2d32 2051 4120 6261 6e64 2e0d 0a64  el-2 QA band...d
-0000c760: 6566 206d 6173 6b53 3263 6c6f 7564 7328  ef maskS2clouds(
-0000c770: 696d 6167 6529 3a0d 0a20 2071 6120 3d20  image):..  qa = 
-0000c780: 696d 6167 652e 7365 6c65 6374 2827 5141  image.select('QA
-0000c790: 3630 2729 2e69 6e74 3136 2829 0d0a 0d0a  60').int16()....
-0000c7a0: 2020 2342 6974 7320 3130 2061 6e64 2031    #Bits 10 and 1
-0000c7b0: 3120 6172 6520 636c 6f75 6473 2061 6e64  1 are clouds and
-0000c7c0: 2063 6972 7275 732c 2072 6573 7065 6374   cirrus, respect
-0000c7d0: 6976 656c 792e 0d0a 2020 636c 6f75 6442  ively...  cloudB
-0000c7e0: 6974 4d61 736b 203d 2031 3c3c 3130 0d0a  itMask = 1<<10..
-0000c7f0: 2020 6369 7272 7573 4269 744d 6173 6b20    cirrusBitMask 
-0000c800: 3d20 313c 3c31 310d 0a0d 0a20 2023 426f  = 1<<11....  #Bo
-0000c810: 7468 2066 6c61 6773 2073 686f 756c 6420  th flags should 
-0000c820: 6265 2073 6574 2074 6f20 7a65 726f 2c20  be set to zero, 
-0000c830: 696e 6469 6361 7469 6e67 2063 6c65 6172  indicating clear
-0000c840: 2063 6f6e 6469 7469 6f6e 732e 0d0a 2020   conditions...  
-0000c850: 6d61 736b 203d 2071 612e 6269 7477 6973  mask = qa.bitwis
-0000c860: 6541 6e64 2863 6c6f 7564 4269 744d 6173  eAnd(cloudBitMas
-0000c870: 6b29 2e65 7128 3029 2e41 6e64 285c 0d0a  k).eq(0).And(\..
-0000c880: 2020 2020 2020 2020 2020 2020 2020 7161                qa
-0000c890: 2e62 6974 7769 7365 416e 6428 6369 7272  .bitwiseAnd(cirr
-0000c8a0: 7573 4269 744d 6173 6b29 2e65 7128 3029  usBitMask).eq(0)
-0000c8b0: 290d 0a0d 0a20 2023 5265 7475 726e 2074  )....  #Return t
-0000c8c0: 6865 206d 6173 6b65 6420 616e 6420 7363  he masked and sc
-0000c8d0: 616c 6564 2064 6174 612e 0d0a 2020 7265  aled data...  re
-0000c8e0: 7475 726e 2069 6d61 6765 2e75 7064 6174  turn image.updat
-0000c8f0: 654d 6173 6b28 6d61 736b 290d 0a0d 0a23  eMask(mask)....#
+0000c6c0: 2323 0d0a 2346 756e 6374 696f 6e20 746f  ##..#Function to
+0000c6d0: 206d 6173 6b20 636c 6f75 6473 2075 7369   mask clouds usi
+0000c6e0: 6e67 2074 6865 2053 656e 7469 6e65 6c2d  ng the Sentinel-
+0000c6f0: 3220 5141 2062 616e 642e 0d0a 6465 6620  2 QA band...def 
+0000c700: 6d61 736b 5332 636c 6f75 6473 2869 6d61  maskS2clouds(ima
+0000c710: 6765 293a 0d0a 2020 7161 203d 2069 6d61  ge):..  qa = ima
+0000c720: 6765 2e73 656c 6563 7428 2751 4136 3027  ge.select('QA60'
+0000c730: 292e 696e 7431 3628 290d 0a0d 0a20 2023  ).int16()....  #
+0000c740: 4269 7473 2031 3020 616e 6420 3131 2061  Bits 10 and 11 a
+0000c750: 7265 2063 6c6f 7564 7320 616e 6420 6369  re clouds and ci
+0000c760: 7272 7573 2c20 7265 7370 6563 7469 7665  rrus, respective
+0000c770: 6c79 2e0d 0a20 2063 6c6f 7564 4269 744d  ly...  cloudBitM
+0000c780: 6173 6b20 3d20 313c 3c31 300d 0a20 2063  ask = 1<<10..  c
+0000c790: 6972 7275 7342 6974 4d61 736b 203d 2031  irrusBitMask = 1
+0000c7a0: 3c3c 3131 0d0a 0d0a 2020 2342 6f74 6820  <<11....  #Both 
+0000c7b0: 666c 6167 7320 7368 6f75 6c64 2062 6520  flags should be 
+0000c7c0: 7365 7420 746f 207a 6572 6f2c 2069 6e64  set to zero, ind
+0000c7d0: 6963 6174 696e 6720 636c 6561 7220 636f  icating clear co
+0000c7e0: 6e64 6974 696f 6e73 2e0d 0a20 206d 6173  nditions...  mas
+0000c7f0: 6b20 3d20 7161 2e62 6974 7769 7365 416e  k = qa.bitwiseAn
+0000c800: 6428 636c 6f75 6442 6974 4d61 736b 292e  d(cloudBitMask).
+0000c810: 6571 2830 292e 416e 6428 5c0d 0a20 2020  eq(0).And(\..   
+0000c820: 2020 2020 2020 2020 2020 2071 612e 6269             qa.bi
+0000c830: 7477 6973 6541 6e64 2863 6972 7275 7342  twiseAnd(cirrusB
+0000c840: 6974 4d61 736b 292e 6571 2830 2929 0d0a  itMask).eq(0))..
+0000c850: 0d0a 2020 2352 6574 7572 6e20 7468 6520  ..  #Return the 
+0000c860: 6d61 736b 6564 2061 6e64 2073 6361 6c65  masked and scale
+0000c870: 6420 6461 7461 2e0d 0a20 2072 6574 7572  d data...  retur
+0000c880: 6e20 696d 6167 652e 7570 6461 7465 4d61  n image.updateMa
+0000c890: 736b 286d 6173 6b29 0d0a 0d0a 2323 2323  sk(mask)....####
+0000c8a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c8b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c8c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c8d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c8e0: 2323 2323 230d 0a23 2323 2323 2323 2323  #####..#########
+0000c8f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000c900: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000c910: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000c920: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c930: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c940: 2323 2323 2323 2323 0d0a 2323 2323 2323  ########..######
-0000c950: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c960: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c970: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c980: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c990: 2323 230d 0a23 436f 6d70 7574 6520 6120  ###..#Compute a 
-0000c9a0: 636c 6f75 6420 7363 6f72 6520 616e 6420  cloud score and 
-0000c9b0: 6164 6473 2061 2062 616e 6420 7468 6174  adds a band that
-0000c9c0: 2072 6570 7265 7365 6e74 7320 7468 6520   represents the 
-0000c9d0: 636c 6f75 6420 6d61 736b 2e0d 0a23 5468  cloud mask...#Th
-0000c9e0: 6973 2065 7870 6563 7473 2074 6865 2069  is expects the i
-0000c9f0: 6e70 7574 2069 6d61 6765 2074 6f20 6861  nput image to ha
-0000ca00: 7665 2074 6865 2063 6f6d 6d6f 6e20 6261  ve the common ba
-0000ca10: 6e64 206e 616d 6573 3a0d 0a23 5b22 7265  nd names:..#["re
-0000ca20: 6422 2c20 2262 6c75 6522 2c20 6574 635d  d", "blue", etc]
-0000ca30: 2c20 736f 2069 7420 6361 6e20 776f 726b  , so it can work
-0000ca40: 2061 6372 6f73 7320 7365 6e73 6f72 732e   across sensors.
-0000ca50: 0d0a 6465 6620 6c61 6e64 7361 7443 6c6f  ..def landsatClo
-0000ca60: 7564 5363 6f72 6528 696d 6729 3a0d 0a20  udScore(img):.. 
-0000ca70: 2023 436f 6d70 7574 6520 7365 7665 7261   #Compute severa
-0000ca80: 6c20 696e 6469 6361 746f 7273 206f 6620  l indicators of 
-0000ca90: 636c 6f75 6469 6e65 7373 2061 6e64 2074  cloudiness and t
-0000caa0: 616b 6520 7468 6520 6d69 6e69 6d75 6d20  ake the minimum 
-0000cab0: 6f66 2074 6865 6d2e 0d0a 2020 7363 6f72  of them...  scor
-0000cac0: 6520 3d20 6565 2e49 6d61 6765 2831 2e30  e = ee.Image(1.0
-0000cad0: 290d 0a20 2023 436c 6f75 6473 2061 7265  )..  #Clouds are
-0000cae0: 2072 6561 736f 6e61 626c 7920 6272 6967   reasonably brig
-0000caf0: 6874 2069 6e20 7468 6520 626c 7565 2062  ht in the blue b
-0000cb00: 616e 642e 0d0a 2020 7363 6f72 6520 3d20  and...  score = 
-0000cb10: 7363 6f72 652e 6d69 6e28 7265 7363 616c  score.min(rescal
-0000cb20: 6528 696d 672e 7365 6c65 6374 285b 2762  e(img.select(['b
-0000cb30: 6c75 6527 5d29 2c20 5b30 2e31 2c20 302e  lue']), [0.1, 0.
-0000cb40: 335d 2929 0d0a 0d0a 2020 2343 6c6f 7564  3]))....  #Cloud
-0000cb50: 7320 6172 6520 7265 6173 6f6e 6162 6c79  s are reasonably
-0000cb60: 2062 7269 6768 7420 696e 2061 6c6c 2076   bright in all v
-0000cb70: 6973 6962 6c65 2062 616e 6473 2e0d 0a20  isible bands... 
-0000cb80: 2073 636f 7265 203d 2073 636f 7265 2e6d   score = score.m
-0000cb90: 696e 2872 6573 6361 6c65 2869 6d67 2e73  in(rescale(img.s
-0000cba0: 656c 6563 7428 5b27 7265 6427 2c27 6772  elect(['red','gr
-0000cbb0: 6565 6e27 2c27 626c 7565 275d 292e 7265  een','blue']).re
-0000cbc0: 6475 6365 2865 652e 5265 6475 6365 722e  duce(ee.Reducer.
-0000cbd0: 7375 6d28 2929 2c20 5b30 2e32 2c20 302e  sum()), [0.2, 0.
-0000cbe0: 385d 2929 0d0a 0d0a 2020 2343 6c6f 7564  8]))....  #Cloud
-0000cbf0: 7320 6172 6520 7265 6173 6f6e 6162 6c79  s are reasonably
-0000cc00: 2062 7269 6768 7420 696e 2061 6c6c 2069   bright in all i
-0000cc10: 6e66 7261 7265 6420 6261 6e64 732e 0d0a  nfrared bands...
-0000cc20: 2020 7363 6f72 6520 3d20 7363 6f72 652e    score = score.
-0000cc30: 6d69 6e28 7265 7363 616c 6528 696d 672e  min(rescale(img.
-0000cc40: 7365 6c65 6374 285b 2773 7769 7231 272c  select(['swir1',
-0000cc50: 2773 7769 7232 272c 276e 6972 275d 292e  'swir2','nir']).
-0000cc60: 7265 6475 6365 2865 652e 5265 6475 6365  reduce(ee.Reduce
-0000cc70: 722e 7375 6d28 2929 2c20 5b30 2e33 2c20  r.sum()), [0.3, 
-0000cc80: 302e 385d 2929 0d0a 0d0a 0d0a 0d0a 2020  0.8]))........  
-0000cc90: 2343 6c6f 7564 7320 6172 6520 7265 6173  #Clouds are reas
-0000cca0: 6f6e 6162 6c79 2063 6f6f 6c20 696e 2074  onably cool in t
-0000ccb0: 656d 7065 7261 7475 7265 2e0d 0a20 2023  emperature...  #
-0000ccc0: 2055 6e6d 6173 6b20 7465 6d70 6572 6174   Unmask temperat
-0000ccd0: 7572 6520 746f 2061 2063 6f6c 6420 636f  ure to a cold co
-0000cce0: 6c64 2074 656d 7020 736f 2069 7420 646f  ld temp so it do
-0000ccf0: 6573 6e27 7420 6578 636c 7564 6520 7468  esn't exclude th
-0000cd00: 6520 7069 7865 6c73 2065 6e74 6972 656c  e pixels entirel
-0000cd10: 790d 0a20 2023 2054 6869 7320 6973 2061  y..  # This is a
-0000cd20: 6e20 6973 7375 6520 6c61 7267 656c 7920  n issue largely 
-0000cd30: 7769 7468 2053 5220 6461 7461 2077 6865  with SR data whe
-0000cd40: 7265 2061 2073 7573 7065 6374 6564 2063  re a suspected c
-0000cd50: 6c6f 7564 2074 656d 7065 7261 7475 7265  loud temperature
-0000cd60: 2076 616c 7565 2069 7320 6d61 736b 6564   value is masked
-0000cd70: 206f 7574 0d0a 2020 7465 6d70 556e 6d61   out..  tempUnma
-0000cd80: 736b 6564 203d 2069 6d67 2e73 656c 6563  sked = img.selec
-0000cd90: 7428 5b27 7465 6d70 275d 292e 756e 6d61  t(['temp']).unma
-0000cda0: 736b 2832 3730 290d 0a20 2073 636f 7265  sk(270)..  score
-0000cdb0: 203d 2073 636f 7265 2e6d 696e 2872 6573   = score.min(res
-0000cdc0: 6361 6c65 2874 656d 7055 6e6d 6173 6b65  cale(tempUnmaske
-0000cdd0: 642c 205b 3330 302c 2032 3930 5d29 290d  d, [300, 290])).
-0000cde0: 0a0d 0a20 2023 486f 7765 7665 722c 2063  ...  #However, c
-0000cdf0: 6c6f 7564 7320 6172 6520 6e6f 7420 736e  louds are not sn
-0000ce00: 6f77 2e0d 0a20 206e 6473 6920 3d20 696d  ow...  ndsi = im
-0000ce10: 672e 6e6f 726d 616c 697a 6564 4469 6666  g.normalizedDiff
-0000ce20: 6572 656e 6365 285b 2767 7265 656e 272c  erence(['green',
-0000ce30: 2027 7377 6972 3127 5d29 0d0a 2020 7363   'swir1'])..  sc
-0000ce40: 6f72 6520 3d20 7363 6f72 652e 6d69 6e28  ore = score.min(
-0000ce50: 7265 7363 616c 6528 6e64 7369 2c20 5b30  rescale(ndsi, [0
-0000ce60: 2e38 2c20 302e 365d 2929 0d0a 0d0a 2020  .8, 0.6]))....  
-0000ce70: 2373 7320 3d20 736e 6f77 5363 6f72 6528  #ss = snowScore(
-0000ce80: 696d 6729 2e73 656c 6563 7428 5b27 736e  img).select(['sn
-0000ce90: 6f77 5363 6f72 6527 5d29 0d0a 2020 2373  owScore'])..  #s
-0000cea0: 636f 7265 203d 2073 636f 7265 2e6d 696e  core = score.min
-0000ceb0: 2872 6573 6361 6c65 2873 732c 2027 696d  (rescale(ss, 'im
-0000cec0: 6727 2c20 5b30 2e33 2c20 305d 2929 0d0a  g', [0.3, 0]))..
-0000ced0: 0d0a 2020 7363 6f72 6520 3d20 7363 6f72  ..  score = scor
-0000cee0: 652e 6d75 6c74 6970 6c79 2831 3030 292e  e.multiply(100).
-0000cef0: 6279 7465 2829 0d0a 2020 7363 6f72 6520  byte()..  score 
-0000cf00: 3d20 7363 6f72 652e 636c 616d 7028 302c  = score.clamp(0,
-0000cf10: 3130 3029 0d0a 2020 7265 7475 726e 2073  100)..  return s
-0000cf20: 636f 7265 2e72 656e 616d 6528 5b27 636c  core.rename(['cl
-0000cf30: 6f75 6453 636f 7265 275d 290d 0a0d 0a23  oudScore'])....#
+0000c930: 0d0a 2343 6f6d 7075 7465 2061 2063 6c6f  ..#Compute a clo
+0000c940: 7564 2073 636f 7265 2061 6e64 2061 6464  ud score and add
+0000c950: 7320 6120 6261 6e64 2074 6861 7420 7265  s a band that re
+0000c960: 7072 6573 656e 7473 2074 6865 2063 6c6f  presents the clo
+0000c970: 7564 206d 6173 6b2e 0d0a 2354 6869 7320  ud mask...#This 
+0000c980: 6578 7065 6374 7320 7468 6520 696e 7075  expects the inpu
+0000c990: 7420 696d 6167 6520 746f 2068 6176 6520  t image to have 
+0000c9a0: 7468 6520 636f 6d6d 6f6e 2062 616e 6420  the common band 
+0000c9b0: 6e61 6d65 733a 0d0a 235b 2272 6564 222c  names:..#["red",
+0000c9c0: 2022 626c 7565 222c 2065 7463 5d2c 2073   "blue", etc], s
+0000c9d0: 6f20 6974 2063 616e 2077 6f72 6b20 6163  o it can work ac
+0000c9e0: 726f 7373 2073 656e 736f 7273 2e0d 0a64  ross sensors...d
+0000c9f0: 6566 206c 616e 6473 6174 436c 6f75 6453  ef landsatCloudS
+0000ca00: 636f 7265 2869 6d67 293a 0d0a 2020 2343  core(img):..  #C
+0000ca10: 6f6d 7075 7465 2073 6576 6572 616c 2069  ompute several i
+0000ca20: 6e64 6963 6174 6f72 7320 6f66 2063 6c6f  ndicators of clo
+0000ca30: 7564 696e 6573 7320 616e 6420 7461 6b65  udiness and take
+0000ca40: 2074 6865 206d 696e 696d 756d 206f 6620   the minimum of 
+0000ca50: 7468 656d 2e0d 0a20 2073 636f 7265 203d  them...  score =
+0000ca60: 2065 652e 496d 6167 6528 312e 3029 0d0a   ee.Image(1.0)..
+0000ca70: 2020 2343 6c6f 7564 7320 6172 6520 7265    #Clouds are re
+0000ca80: 6173 6f6e 6162 6c79 2062 7269 6768 7420  asonably bright 
+0000ca90: 696e 2074 6865 2062 6c75 6520 6261 6e64  in the blue band
+0000caa0: 2e0d 0a20 2073 636f 7265 203d 2073 636f  ...  score = sco
+0000cab0: 7265 2e6d 696e 2872 6573 6361 6c65 2869  re.min(rescale(i
+0000cac0: 6d67 2e73 656c 6563 7428 5b27 626c 7565  mg.select(['blue
+0000cad0: 275d 292c 205b 302e 312c 2030 2e33 5d29  ']), [0.1, 0.3])
+0000cae0: 290d 0a0d 0a20 2023 436c 6f75 6473 2061  )....  #Clouds a
+0000caf0: 7265 2072 6561 736f 6e61 626c 7920 6272  re reasonably br
+0000cb00: 6967 6874 2069 6e20 616c 6c20 7669 7369  ight in all visi
+0000cb10: 626c 6520 6261 6e64 732e 0d0a 2020 7363  ble bands...  sc
+0000cb20: 6f72 6520 3d20 7363 6f72 652e 6d69 6e28  ore = score.min(
+0000cb30: 7265 7363 616c 6528 696d 672e 7365 6c65  rescale(img.sele
+0000cb40: 6374 285b 2772 6564 272c 2767 7265 656e  ct(['red','green
+0000cb50: 272c 2762 6c75 6527 5d29 2e72 6564 7563  ','blue']).reduc
+0000cb60: 6528 6565 2e52 6564 7563 6572 2e73 756d  e(ee.Reducer.sum
+0000cb70: 2829 292c 205b 302e 322c 2030 2e38 5d29  ()), [0.2, 0.8])
+0000cb80: 290d 0a0d 0a20 2023 436c 6f75 6473 2061  )....  #Clouds a
+0000cb90: 7265 2072 6561 736f 6e61 626c 7920 6272  re reasonably br
+0000cba0: 6967 6874 2069 6e20 616c 6c20 696e 6672  ight in all infr
+0000cbb0: 6172 6564 2062 616e 6473 2e0d 0a20 2073  ared bands...  s
+0000cbc0: 636f 7265 203d 2073 636f 7265 2e6d 696e  core = score.min
+0000cbd0: 2872 6573 6361 6c65 2869 6d67 2e73 656c  (rescale(img.sel
+0000cbe0: 6563 7428 5b27 7377 6972 3127 2c27 7377  ect(['swir1','sw
+0000cbf0: 6972 3227 2c27 6e69 7227 5d29 2e72 6564  ir2','nir']).red
+0000cc00: 7563 6528 6565 2e52 6564 7563 6572 2e73  uce(ee.Reducer.s
+0000cc10: 756d 2829 292c 205b 302e 332c 2030 2e38  um()), [0.3, 0.8
+0000cc20: 5d29 290d 0a0d 0a0d 0a0d 0a20 2023 436c  ]))........  #Cl
+0000cc30: 6f75 6473 2061 7265 2072 6561 736f 6e61  ouds are reasona
+0000cc40: 626c 7920 636f 6f6c 2069 6e20 7465 6d70  bly cool in temp
+0000cc50: 6572 6174 7572 652e 0d0a 2020 2320 556e  erature...  # Un
+0000cc60: 6d61 736b 2074 656d 7065 7261 7475 7265  mask temperature
+0000cc70: 2074 6f20 6120 636f 6c64 2063 6f6c 6420   to a cold cold 
+0000cc80: 7465 6d70 2073 6f20 6974 2064 6f65 736e  temp so it doesn
+0000cc90: 2774 2065 7863 6c75 6465 2074 6865 2070  't exclude the p
+0000cca0: 6978 656c 7320 656e 7469 7265 6c79 0d0a  ixels entirely..
+0000ccb0: 2020 2320 5468 6973 2069 7320 616e 2069    # This is an i
+0000ccc0: 7373 7565 206c 6172 6765 6c79 2077 6974  ssue largely wit
+0000ccd0: 6820 5352 2064 6174 6120 7768 6572 6520  h SR data where 
+0000cce0: 6120 7375 7370 6563 7465 6420 636c 6f75  a suspected clou
+0000ccf0: 6420 7465 6d70 6572 6174 7572 6520 7661  d temperature va
+0000cd00: 6c75 6520 6973 206d 6173 6b65 6420 6f75  lue is masked ou
+0000cd10: 740d 0a20 2074 656d 7055 6e6d 6173 6b65  t..  tempUnmaske
+0000cd20: 6420 3d20 696d 672e 7365 6c65 6374 285b  d = img.select([
+0000cd30: 2774 656d 7027 5d29 2e75 6e6d 6173 6b28  'temp']).unmask(
+0000cd40: 3237 3029 0d0a 2020 7363 6f72 6520 3d20  270)..  score = 
+0000cd50: 7363 6f72 652e 6d69 6e28 7265 7363 616c  score.min(rescal
+0000cd60: 6528 7465 6d70 556e 6d61 736b 6564 2c20  e(tempUnmasked, 
+0000cd70: 5b33 3030 2c20 3239 305d 2929 0d0a 0d0a  [300, 290]))....
+0000cd80: 2020 2348 6f77 6576 6572 2c20 636c 6f75    #However, clou
+0000cd90: 6473 2061 7265 206e 6f74 2073 6e6f 772e  ds are not snow.
+0000cda0: 0d0a 2020 6e64 7369 203d 2069 6d67 2e6e  ..  ndsi = img.n
+0000cdb0: 6f72 6d61 6c69 7a65 6444 6966 6665 7265  ormalizedDiffere
+0000cdc0: 6e63 6528 5b27 6772 6565 6e27 2c20 2773  nce(['green', 's
+0000cdd0: 7769 7231 275d 290d 0a20 2073 636f 7265  wir1'])..  score
+0000cde0: 203d 2073 636f 7265 2e6d 696e 2872 6573   = score.min(res
+0000cdf0: 6361 6c65 286e 6473 692c 205b 302e 382c  cale(ndsi, [0.8,
+0000ce00: 2030 2e36 5d29 290d 0a0d 0a20 2023 7373   0.6]))....  #ss
+0000ce10: 203d 2073 6e6f 7753 636f 7265 2869 6d67   = snowScore(img
+0000ce20: 292e 7365 6c65 6374 285b 2773 6e6f 7753  ).select(['snowS
+0000ce30: 636f 7265 275d 290d 0a20 2023 7363 6f72  core'])..  #scor
+0000ce40: 6520 3d20 7363 6f72 652e 6d69 6e28 7265  e = score.min(re
+0000ce50: 7363 616c 6528 7373 2c20 2769 6d67 272c  scale(ss, 'img',
+0000ce60: 205b 302e 332c 2030 5d29 290d 0a0d 0a20   [0.3, 0])).... 
+0000ce70: 2073 636f 7265 203d 2073 636f 7265 2e6d   score = score.m
+0000ce80: 756c 7469 706c 7928 3130 3029 2e62 7974  ultiply(100).byt
+0000ce90: 6528 290d 0a20 2073 636f 7265 203d 2073  e()..  score = s
+0000cea0: 636f 7265 2e63 6c61 6d70 2830 2c31 3030  core.clamp(0,100
+0000ceb0: 290d 0a20 2072 6574 7572 6e20 7363 6f72  )..  return scor
+0000cec0: 652e 7265 6e61 6d65 285b 2763 6c6f 7564  e.rename(['cloud
+0000ced0: 5363 6f72 6527 5d29 0d0a 0d0a 2323 2323  Score'])....####
+0000cee0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000cef0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000cf00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000cf10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000cf20: 2323 2323 230d 0a23 2323 2323 2323 2323  #####..#########
+0000cf30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000cf40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000cf50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000cf60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000cf70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000cf80: 2323 2323 2323 2323 0d0a 2323 2323 2323  ########..######
-0000cf90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000cfa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000cfb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000cfc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000cfd0: 2323 230d 0a23 5772 6170 7065 7220 666f  ###..#Wrapper fo
-0000cfe0: 7220 6170 706c 7969 6e67 2063 6c6f 7564  r applying cloud
-0000cff0: 5363 6f72 6520 6675 6e63 7469 6f6e 0d0a  Score function..
-0000d000: 6465 6620 6170 706c 7943 6c6f 7564 5363  def applyCloudSc
-0000d010: 6f72 6541 6c67 6f72 6974 686d 285c 0d0a  oreAlgorithm(\..
-0000d020: 2020 2020 636f 6c6c 6563 7469 6f6e 2c0d      collection,.
-0000d030: 0a20 2020 2063 6c6f 7564 5363 6f72 6546  .    cloudScoreF
-0000d040: 756e 6374 696f 6e2c 0d0a 2020 2020 636c  unction,..    cl
-0000d050: 6f75 6453 636f 7265 5468 7265 7368 203d  oudScoreThresh =
-0000d060: 2032 302c 0d0a 2020 2020 636c 6f75 6453   20,..    cloudS
-0000d070: 636f 7265 5063 746c 203d 2031 302c 0d0a  corePctl = 10,..
-0000d080: 2020 2020 636f 6e74 7261 6374 5069 7865      contractPixe
-0000d090: 6c73 203d 2031 2e35 2c0d 0a20 2020 2064  ls = 1.5,..    d
-0000d0a0: 696c 6174 6550 6978 656c 7320 3d20 332e  ilatePixels = 3.
-0000d0b0: 352c 0d0a 2020 2020 7065 7266 6f72 6d43  5,..    performC
-0000d0c0: 6c6f 7564 5363 6f72 654f 6666 7365 7420  loudScoreOffset 
-0000d0d0: 3d20 5472 7565 2c0d 0a20 2020 2070 7265  = True,..    pre
-0000d0e0: 436f 6d70 7574 6564 436c 6f75 6453 636f  ComputedCloudSco
-0000d0f0: 7265 4f66 6673 6574 203d 204e 6f6e 6529  reOffset = None)
-0000d100: 3a0d 0a0d 0a20 2023 4164 6420 636c 6f75  :....  #Add clou
-0000d110: 6453 636f 7265 0d0a 2020 6465 6620 636c  dScore..  def cl
-0000d120: 6f75 6453 636f 7265 5772 6170 7065 7228  oudScoreWrapper(
-0000d130: 696d 6729 3a0d 0a20 2020 2069 6d67 203d  img):..    img =
-0000d140: 2065 652e 496d 6167 6528 696d 6729 0d0a   ee.Image(img)..
-0000d150: 2020 2020 6373 203d 2063 6c6f 7564 5363      cs = cloudSc
-0000d160: 6f72 6546 756e 6374 696f 6e28 696d 6729  oreFunction(img)
-0000d170: 2e72 656e 616d 6528 5b22 636c 6f75 6453  .rename(["cloudS
-0000d180: 636f 7265 225d 290d 0a20 2020 2072 6574  core"])..    ret
-0000d190: 7572 6e20 696d 672e 6164 6442 616e 6473  urn img.addBands
-0000d1a0: 2863 7329 0d0a 2020 636f 6c6c 6563 7469  (cs)..  collecti
-0000d1b0: 6f6e 203d 2063 6f6c 6c65 6374 696f 6e2e  on = collection.
-0000d1c0: 6d61 7028 636c 6f75 6453 636f 7265 5772  map(cloudScoreWr
-0000d1d0: 6170 7065 7229 0d0a 0d0a 2020 6966 2070  apper)....  if p
-0000d1e0: 6572 666f 726d 436c 6f75 6453 636f 7265  erformCloudScore
-0000d1f0: 4f66 6673 6574 3a0d 0a20 2020 2069 6620  Offset:..    if 
-0000d200: 7072 6543 6f6d 7075 7465 6443 6c6f 7564  preComputedCloud
-0000d210: 5363 6f72 654f 6666 7365 7420 3d3d 204e  ScoreOffset == N
-0000d220: 6f6e 653a 0d0a 2020 2020 2020 2346 696e  one:..      #Fin
-0000d230: 6420 6c6f 7720 636c 6f75 6420 7363 6f72  d low cloud scor
-0000d240: 6520 7063 746c 2066 6f72 2065 6163 6820  e pctl for each 
-0000d250: 7069 7865 6c20 746f 2061 766f 6964 2063  pixel to avoid c
-0000d260: 6f6d 6d69 7373 696f 6e20 6572 726f 7273  ommission errors
-0000d270: 0d0a 2020 2020 2020 7072 696e 7428 2743  ..      print('C
-0000d280: 6f6d 7075 7469 6e67 2063 6c6f 7564 5363  omputing cloudSc
-0000d290: 6f72 6520 6f66 6673 6574 2729 0d0a 2020  ore offset')..  
-0000d2a0: 2020 2020 6d69 6e43 6c6f 7564 5363 6f72      minCloudScor
-0000d2b0: 6520 3d20 636f 6c6c 6563 7469 6f6e 2e73  e = collection.s
-0000d2c0: 656c 6563 7428 5b27 636c 6f75 6453 636f  elect(['cloudSco
-0000d2d0: 7265 275d 295c 0d0a 2020 2020 2020 2020  re'])\..        
-0000d2e0: 2e72 6564 7563 6528 6565 2e52 6564 7563  .reduce(ee.Reduc
-0000d2f0: 6572 2e70 6572 6365 6e74 696c 6528 5b63  er.percentile([c
-0000d300: 6c6f 7564 5363 6f72 6550 6374 6c5d 2929  loudScorePctl]))
-0000d310: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
-0000d320: 2020 2070 7269 6e74 2827 5573 696e 6720     print('Using 
-0000d330: 7072 652d 636f 6d70 7574 6564 2063 6c6f  pre-computed clo
-0000d340: 7564 5363 6f72 6520 6f66 6673 6574 2729  udScore offset')
-0000d350: 0d0a 2020 2020 2020 6d69 6e43 6c6f 7564  ..      minCloud
-0000d360: 5363 6f72 6520 3d20 7072 6543 6f6d 7075  Score = preCompu
-0000d370: 7465 6443 6c6f 7564 5363 6f72 654f 6666  tedCloudScoreOff
-0000d380: 7365 742e 7265 6e61 6d65 285b 2763 6c6f  set.rename(['clo
-0000d390: 7564 5363 6f72 6527 5d29 0d0a 2020 656c  udScore'])..  el
-0000d3a0: 7365 3a0d 0a20 2020 2070 7269 6e74 2827  se:..    print('
-0000d3b0: 4e6f 7420 636f 6d70 7574 696e 6720 636c  Not computing cl
-0000d3c0: 6f75 6453 636f 7265 206f 6666 7365 7427  oudScore offset'
-0000d3d0: 290d 0a20 2020 206d 696e 436c 6f75 6453  )..    minCloudS
-0000d3e0: 636f 7265 203d 2065 652e 496d 6167 6528  core = ee.Image(
-0000d3f0: 3029 2e72 656e 616d 6528 5b27 636c 6f75  0).rename(['clou
-0000d400: 6453 636f 7265 275d 290d 0a0d 0a0d 0a20  dScore'])...... 
-0000d410: 2023 4170 706c 7920 636c 6f75 6453 636f   #Apply cloudSco
-0000d420: 7265 0d0a 2020 6465 6620 636c 6f75 6453  re..  def cloudS
-0000d430: 636f 7265 4275 7374 6572 5772 6170 7065  coreBusterWrappe
-0000d440: 7228 696d 6729 3a0d 0a20 2020 2063 6c6f  r(img):..    clo
-0000d450: 7564 4d61 736b 203d 2069 6d67 2e73 656c  udMask = img.sel
-0000d460: 6563 7428 5b27 636c 6f75 6453 636f 7265  ect(['cloudScore
-0000d470: 275d 292e 7375 6274 7261 6374 286d 696e  ']).subtract(min
-0000d480: 436c 6f75 6453 636f 7265 295c 0d0a 2020  CloudScore)\..  
-0000d490: 2020 2020 2e6c 7428 636c 6f75 6453 636f      .lt(cloudSco
-0000d4a0: 7265 5468 7265 7368 295c 0d0a 2020 2020  reThresh)\..    
-0000d4b0: 2020 2e66 6f63 616c 5f6d 6178 2863 6f6e    .focal_max(con
-0000d4c0: 7472 6163 7450 6978 656c 7329 2e66 6f63  tractPixels).foc
-0000d4d0: 616c 5f6d 696e 2864 696c 6174 6550 6978  al_min(dilatePix
-0000d4e0: 656c 7329 2e72 656e 616d 6528 5b27 636c  els).rename(['cl
-0000d4f0: 6f75 644d 6173 6b27 5d29 0d0a 2020 2020  oudMask'])..    
-0000d500: 7265 7475 726e 2069 6d67 2e75 7064 6174  return img.updat
-0000d510: 654d 6173 6b28 636c 6f75 644d 6173 6b29  eMask(cloudMask)
-0000d520: 0d0a 0d0a 2020 636f 6c6c 6563 7469 6f6e  ....  collection
-0000d530: 203d 2063 6f6c 6c65 6374 696f 6e2e 6d61   = collection.ma
-0000d540: 7028 636c 6f75 6453 636f 7265 4275 7374  p(cloudScoreBust
-0000d550: 6572 5772 6170 7065 7229 0d0a 2020 7265  erWrapper)..  re
-0000d560: 7475 726e 2063 6f6c 6c65 6374 696f 6e0d  turn collection.
-0000d570: 0a0d 0a23 2323 2323 2323 2323 2323 2323  ...#############
+0000cf70: 0d0a 2357 7261 7070 6572 2066 6f72 2061  ..#Wrapper for a
+0000cf80: 7070 6c79 696e 6720 636c 6f75 6453 636f  pplying cloudSco
+0000cf90: 7265 2066 756e 6374 696f 6e0d 0a64 6566  re function..def
+0000cfa0: 2061 7070 6c79 436c 6f75 6453 636f 7265   applyCloudScore
+0000cfb0: 416c 676f 7269 7468 6d28 5c0d 0a20 2020  Algorithm(\..   
+0000cfc0: 2063 6f6c 6c65 6374 696f 6e2c 0d0a 2020   collection,..  
+0000cfd0: 2020 636c 6f75 6453 636f 7265 4675 6e63    cloudScoreFunc
+0000cfe0: 7469 6f6e 2c0d 0a20 2020 2063 6c6f 7564  tion,..    cloud
+0000cff0: 5363 6f72 6554 6872 6573 6820 3d20 3230  ScoreThresh = 20
+0000d000: 2c0d 0a20 2020 2063 6c6f 7564 5363 6f72  ,..    cloudScor
+0000d010: 6550 6374 6c20 3d20 3130 2c0d 0a20 2020  ePctl = 10,..   
+0000d020: 2063 6f6e 7472 6163 7450 6978 656c 7320   contractPixels 
+0000d030: 3d20 312e 352c 0d0a 2020 2020 6469 6c61  = 1.5,..    dila
+0000d040: 7465 5069 7865 6c73 203d 2033 2e35 2c0d  tePixels = 3.5,.
+0000d050: 0a20 2020 2070 6572 666f 726d 436c 6f75  .    performClou
+0000d060: 6453 636f 7265 4f66 6673 6574 203d 2054  dScoreOffset = T
+0000d070: 7275 652c 0d0a 2020 2020 7072 6543 6f6d  rue,..    preCom
+0000d080: 7075 7465 6443 6c6f 7564 5363 6f72 654f  putedCloudScoreO
+0000d090: 6666 7365 7420 3d20 4e6f 6e65 293a 0d0a  ffset = None):..
+0000d0a0: 0d0a 2020 2341 6464 2063 6c6f 7564 5363  ..  #Add cloudSc
+0000d0b0: 6f72 650d 0a20 2064 6566 2063 6c6f 7564  ore..  def cloud
+0000d0c0: 5363 6f72 6557 7261 7070 6572 2869 6d67  ScoreWrapper(img
+0000d0d0: 293a 0d0a 2020 2020 696d 6720 3d20 6565  ):..    img = ee
+0000d0e0: 2e49 6d61 6765 2869 6d67 290d 0a20 2020  .Image(img)..   
+0000d0f0: 2063 7320 3d20 636c 6f75 6453 636f 7265   cs = cloudScore
+0000d100: 4675 6e63 7469 6f6e 2869 6d67 292e 7265  Function(img).re
+0000d110: 6e61 6d65 285b 2263 6c6f 7564 5363 6f72  name(["cloudScor
+0000d120: 6522 5d29 0d0a 2020 2020 7265 7475 726e  e"])..    return
+0000d130: 2069 6d67 2e61 6464 4261 6e64 7328 6373   img.addBands(cs
+0000d140: 290d 0a20 2063 6f6c 6c65 6374 696f 6e20  )..  collection 
+0000d150: 3d20 636f 6c6c 6563 7469 6f6e 2e6d 6170  = collection.map
+0000d160: 2863 6c6f 7564 5363 6f72 6557 7261 7070  (cloudScoreWrapp
+0000d170: 6572 290d 0a0d 0a20 2069 6620 7065 7266  er)....  if perf
+0000d180: 6f72 6d43 6c6f 7564 5363 6f72 654f 6666  ormCloudScoreOff
+0000d190: 7365 743a 0d0a 2020 2020 6966 2070 7265  set:..    if pre
+0000d1a0: 436f 6d70 7574 6564 436c 6f75 6453 636f  ComputedCloudSco
+0000d1b0: 7265 4f66 6673 6574 203d 3d20 4e6f 6e65  reOffset == None
+0000d1c0: 3a0d 0a20 2020 2020 2023 4669 6e64 206c  :..      #Find l
+0000d1d0: 6f77 2063 6c6f 7564 2073 636f 7265 2070  ow cloud score p
+0000d1e0: 6374 6c20 666f 7220 6561 6368 2070 6978  ctl for each pix
+0000d1f0: 656c 2074 6f20 6176 6f69 6420 636f 6d6d  el to avoid comm
+0000d200: 6973 7369 6f6e 2065 7272 6f72 730d 0a20  ission errors.. 
+0000d210: 2020 2020 2070 7269 6e74 2827 436f 6d70       print('Comp
+0000d220: 7574 696e 6720 636c 6f75 6453 636f 7265  uting cloudScore
+0000d230: 206f 6666 7365 7427 290d 0a20 2020 2020   offset')..     
+0000d240: 206d 696e 436c 6f75 6453 636f 7265 203d   minCloudScore =
+0000d250: 2063 6f6c 6c65 6374 696f 6e2e 7365 6c65   collection.sele
+0000d260: 6374 285b 2763 6c6f 7564 5363 6f72 6527  ct(['cloudScore'
+0000d270: 5d29 5c0d 0a20 2020 2020 2020 202e 7265  ])\..        .re
+0000d280: 6475 6365 2865 652e 5265 6475 6365 722e  duce(ee.Reducer.
+0000d290: 7065 7263 656e 7469 6c65 285b 636c 6f75  percentile([clou
+0000d2a0: 6453 636f 7265 5063 746c 5d29 290d 0a20  dScorePctl])).. 
+0000d2b0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0000d2c0: 7072 696e 7428 2755 7369 6e67 2070 7265  print('Using pre
+0000d2d0: 2d63 6f6d 7075 7465 6420 636c 6f75 6453  -computed cloudS
+0000d2e0: 636f 7265 206f 6666 7365 7427 290d 0a20  core offset').. 
+0000d2f0: 2020 2020 206d 696e 436c 6f75 6453 636f       minCloudSco
+0000d300: 7265 203d 2070 7265 436f 6d70 7574 6564  re = preComputed
+0000d310: 436c 6f75 6453 636f 7265 4f66 6673 6574  CloudScoreOffset
+0000d320: 2e72 656e 616d 6528 5b27 636c 6f75 6453  .rename(['cloudS
+0000d330: 636f 7265 275d 290d 0a20 2065 6c73 653a  core'])..  else:
+0000d340: 0d0a 2020 2020 7072 696e 7428 274e 6f74  ..    print('Not
+0000d350: 2063 6f6d 7075 7469 6e67 2063 6c6f 7564   computing cloud
+0000d360: 5363 6f72 6520 6f66 6673 6574 2729 0d0a  Score offset')..
+0000d370: 2020 2020 6d69 6e43 6c6f 7564 5363 6f72      minCloudScor
+0000d380: 6520 3d20 6565 2e49 6d61 6765 2830 292e  e = ee.Image(0).
+0000d390: 7265 6e61 6d65 285b 2763 6c6f 7564 5363  rename(['cloudSc
+0000d3a0: 6f72 6527 5d29 0d0a 0d0a 0d0a 2020 2341  ore'])......  #A
+0000d3b0: 7070 6c79 2063 6c6f 7564 5363 6f72 650d  pply cloudScore.
+0000d3c0: 0a20 2064 6566 2063 6c6f 7564 5363 6f72  .  def cloudScor
+0000d3d0: 6542 7573 7465 7257 7261 7070 6572 2869  eBusterWrapper(i
+0000d3e0: 6d67 293a 0d0a 2020 2020 636c 6f75 644d  mg):..    cloudM
+0000d3f0: 6173 6b20 3d20 696d 672e 7365 6c65 6374  ask = img.select
+0000d400: 285b 2763 6c6f 7564 5363 6f72 6527 5d29  (['cloudScore'])
+0000d410: 2e73 7562 7472 6163 7428 6d69 6e43 6c6f  .subtract(minClo
+0000d420: 7564 5363 6f72 6529 5c0d 0a20 2020 2020  udScore)\..     
+0000d430: 202e 6c74 2863 6c6f 7564 5363 6f72 6554   .lt(cloudScoreT
+0000d440: 6872 6573 6829 5c0d 0a20 2020 2020 202e  hresh)\..      .
+0000d450: 666f 6361 6c5f 6d61 7828 636f 6e74 7261  focal_max(contra
+0000d460: 6374 5069 7865 6c73 292e 666f 6361 6c5f  ctPixels).focal_
+0000d470: 6d69 6e28 6469 6c61 7465 5069 7865 6c73  min(dilatePixels
+0000d480: 292e 7265 6e61 6d65 285b 2763 6c6f 7564  ).rename(['cloud
+0000d490: 4d61 736b 275d 290d 0a20 2020 2072 6574  Mask'])..    ret
+0000d4a0: 7572 6e20 696d 672e 7570 6461 7465 4d61  urn img.updateMa
+0000d4b0: 736b 2863 6c6f 7564 4d61 736b 290d 0a0d  sk(cloudMask)...
+0000d4c0: 0a20 2063 6f6c 6c65 6374 696f 6e20 3d20  .  collection = 
+0000d4d0: 636f 6c6c 6563 7469 6f6e 2e6d 6170 2863  collection.map(c
+0000d4e0: 6c6f 7564 5363 6f72 6542 7573 7465 7257  loudScoreBusterW
+0000d4f0: 7261 7070 6572 290d 0a20 2072 6574 7572  rapper)..  retur
+0000d500: 6e20 636f 6c6c 6563 7469 6f6e 0d0a 0d0a  n collection....
+0000d510: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000d520: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000d530: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000d540: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000d550: 2323 2323 2323 2323 230d 0a23 2323 2323  #########..#####
+0000d560: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000d570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000d580: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000d590: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000d5a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000d5b0: 2323 2323 2323 2323 2323 2323 0d0a 2323  ############..##
-0000d5c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000d5d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000d5e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000d5f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000d600: 2323 2323 2323 230d 0a23 4675 6e63 7469  #######..#Functi
-0000d610: 6f6e 7320 666f 7220 6170 706c 7969 6e67  ons for applying
-0000d620: 2066 6d61 736b 2074 6f20 5352 2064 6174   fmask to SR dat
-0000d630: 610d 0a66 6d61 736b 4269 7444 6963 7420  a..fmaskBitDict 
-0000d640: 3d20 7b27 4331 273a 7b0d 0a20 2020 2020  = {'C1':{..     
-0000d650: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0000d660: 636c 6f75 6427 203a 2035 2c0d 0a20 2020  cloud' : 5,..   
-0000d670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d680: 2027 7368 6164 6f77 273a 2033 2c0d 0a20   'shadow': 3,.. 
-0000d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d6a0: 2020 2027 736e 6f77 273a 340d 0a20 2020     'snow':4..   
-0000d6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d6c0: 207d 2c0d 0a20 2020 2020 2020 2020 2020   },..           
-0000d6d0: 2020 2020 2027 4332 273a 7b0d 0a20 2020       'C2':{..   
-0000d6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d6f0: 2027 636c 6f75 6427 203a 2033 2c0d 0a20   'cloud' : 3,.. 
-0000d700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d710: 2020 2027 7368 6164 6f77 273a 2034 2c0d     'shadow': 4,.
-0000d720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d730: 2020 2020 2027 736e 6f77 273a 350d 0a20       'snow':5.. 
-0000d740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d750: 207d 0d0a 2020 2020 2020 2020 2020 2020   }..            
-0000d760: 2020 2020 7d0d 0a0d 0a23 204c 5343 2075      }....# LSC u
-0000d770: 7064 6174 6564 2034 2f31 362f 3139 2074  pdated 4/16/19 t
-0000d780: 6f20 6164 6420 6d65 6469 756d 2061 6e64  o add medium and
-0000d790: 2068 6967 6820 636f 6e66 6964 656e 6365   high confidence
-0000d7a0: 2063 6c6f 7564 206d 6173 6b73 0d0a 2320   cloud masks..# 
-0000d7b0: 5375 7070 6f72 7465 6420 666d 6173 6b43  Supported fmaskC
-0000d7c0: 6c61 7373 206f 7074 696f 6e73 3a20 2763  lass options: 'c
-0000d7d0: 6c6f 7564 272c 2027 7368 6164 6f77 272c  loud', 'shadow',
-0000d7e0: 2027 736e 6f77 272c 2027 6869 6768 5f63   'snow', 'high_c
-0000d7f0: 6f6e 6669 6465 6e63 655f 636c 6f75 6427  onfidence_cloud'
-0000d800: 2c20 276d 6564 5f63 6f6e 6669 6465 6e63  , 'med_confidenc
-0000d810: 655f 636c 6f75 6427 0d0a 6465 6620 6346  e_cloud'..def cF
-0000d820: 6d61 736b 2869 6d67 2c66 6d61 736b 436c  mask(img,fmaskCl
-0000d830: 6173 732c 6269 744d 6173 6b42 616e 644e  ass,bitMaskBandN
-0000d840: 616d 6520 3d20 2751 415f 5049 5845 4c27  ame = 'QA_PIXEL'
-0000d850: 293a 0d0a 0d0a 2020 7161 203d 2069 6d67  ):....  qa = img
-0000d860: 2e73 656c 6563 7428 6269 744d 6173 6b42  .select(bitMaskB
-0000d870: 616e 644e 616d 6529 2e75 696e 7431 3628  andName).uint16(
-0000d880: 290d 0a20 2069 6620 666d 6173 6b43 6c61  )..  if fmaskCla
-0000d890: 7373 203d 3d20 2768 6967 685f 636f 6e66  ss == 'high_conf
-0000d8a0: 6964 656e 6365 5f63 6c6f 7564 273a 0d0a  idence_cloud':..
-0000d8b0: 2020 2020 206d 203d 2071 612e 6269 7477       m = qa.bitw
-0000d8c0: 6973 6541 6e64 2831 203c 3c20 3629 2e6e  iseAnd(1 << 6).n
-0000d8d0: 6571 2830 292e 416e 6428 7161 2e62 6974  eq(0).And(qa.bit
-0000d8e0: 7769 7365 416e 6428 3120 3c3c 2037 292e  wiseAnd(1 << 7).
-0000d8f0: 6e65 7128 3029 290d 0a20 2065 6c69 6620  neq(0))..  elif 
-0000d900: 666d 6173 6b43 6c61 7373 203d 3d20 276d  fmaskClass == 'm
-0000d910: 6564 5f63 6f6e 6669 6465 6e63 655f 636c  ed_confidence_cl
-0000d920: 6f75 6427 3a0d 0a20 2020 2020 6d20 3d20  oud':..     m = 
-0000d930: 7161 2e62 6974 7769 7365 416e 6428 3120  qa.bitwiseAnd(1 
-0000d940: 3c3c 2037 292e 6e65 7128 3029 0d0a 2020  << 7).neq(0)..  
-0000d950: 656c 7365 3a0d 0a20 2020 206d 203d 2071  else:..    m = q
-0000d960: 612e 6269 7477 6973 6541 6e64 2866 6d61  a.bitwiseAnd(fma
-0000d970: 736b 4269 7444 6963 745b 666d 6173 6b43  skBitDict[fmaskC
-0000d980: 6c61 7373 5d29 2e6e 6571 2830 290d 0a0d  lass]).neq(0)...
-0000d990: 0a20 2072 6574 7572 6e20 696d 672e 7570  .  return img.up
-0000d9a0: 6461 7465 4d61 736b 286d 2e4e 6f74 2829  dateMask(m.Not()
-0000d9b0: 290d 0a0d 0a23 204d 6574 686f 6420 666f  )....# Method fo
-0000d9c0: 7220 6170 706c 7969 6e67 2061 2073 696e  r applying a sin
-0000d9d0: 676c 6520 6269 7420 6269 7420 6d61 736b  gle bit bit mask
-0000d9e0: 0d0a 6465 6620 6170 706c 7942 6974 4d61  ..def applyBitMa
-0000d9f0: 736b 2869 6d67 2c62 6974 2c62 6974 4d61  sk(img,bit,bitMa
-0000da00: 736b 4261 6e64 4e61 6d65 203d 2027 5141  skBandName = 'QA
-0000da10: 5f50 4958 454c 2729 3a0d 0a20 206d 203d  _PIXEL'):..  m =
-0000da20: 2069 6d67 2e73 656c 6563 7428 5b62 6974   img.select([bit
-0000da30: 4d61 736b 4261 6e64 4e61 6d65 5d29 2e75  MaskBandName]).u
-0000da40: 696e 7431 3628 293b 0d0a 2020 6d20 3d20  int16();..  m = 
-0000da50: 6d2e 6269 7477 6973 6541 6e64 2831 3c3c  m.bitwiseAnd(1<<
-0000da60: 6269 7429 2e6e 6571 2830 290d 0a20 2072  bit).neq(0)..  r
-0000da70: 6574 7572 6e20 696d 672e 7570 6461 7465  eturn img.update
-0000da80: 4d61 736b 286d 2e4e 6f74 2829 290d 0a0d  Mask(m.Not())...
-0000da90: 0a0d 0a64 6566 2063 466d 6173 6b43 6c6f  ...def cFmaskClo
-0000daa0: 7564 2869 6d67 2c6c 616e 6473 6174 436f  ud(img,landsatCo
-0000dab0: 6c6c 6563 7469 6f6e 5665 7273 696f 6e2c  llectionVersion,
-0000dac0: 6269 744d 6173 6b42 616e 644e 616d 6520  bitMaskBandName 
-0000dad0: 3d20 2751 415f 5049 5845 4c27 293a 0d0a  = 'QA_PIXEL'):..
-0000dae0: 2020 7265 7475 726e 2061 7070 6c79 4269    return applyBi
-0000daf0: 744d 6173 6b28 696d 672c 666d 6173 6b42  tMask(img,fmaskB
-0000db00: 6974 4469 6374 5b6c 616e 6473 6174 436f  itDict[landsatCo
-0000db10: 6c6c 6563 7469 6f6e 5665 7273 696f 6e5d  llectionVersion]
-0000db20: 5b27 636c 6f75 6427 5d2c 6269 744d 6173  ['cloud'],bitMas
-0000db30: 6b42 616e 644e 616d 6529 0d0a 0d0a 6465  kBandName)....de
-0000db40: 6620 6346 6d61 736b 436c 6f75 6453 6861  f cFmaskCloudSha
-0000db50: 646f 7728 696d 672c 6c61 6e64 7361 7443  dow(img,landsatC
-0000db60: 6f6c 6c65 6374 696f 6e56 6572 7369 6f6e  ollectionVersion
-0000db70: 2c62 6974 4d61 736b 4261 6e64 4e61 6d65  ,bitMaskBandName
-0000db80: 203d 2027 5141 5f50 4958 454c 2729 3a0d   = 'QA_PIXEL'):.
-0000db90: 0a20 2072 6574 7572 6e20 6170 706c 7942  .  return applyB
-0000dba0: 6974 4d61 736b 2869 6d67 2c66 6d61 736b  itMask(img,fmask
-0000dbb0: 4269 7444 6963 745b 6c61 6e64 7361 7443  BitDict[landsatC
-0000dbc0: 6f6c 6c65 6374 696f 6e56 6572 7369 6f6e  ollectionVersion
-0000dbd0: 5d5b 2773 6861 646f 7727 5d2c 6269 744d  ]['shadow'],bitM
-0000dbe0: 6173 6b42 616e 644e 616d 6529 0d0a 0d0a  askBandName)....
+0000d5a0: 2323 2323 0d0a 2346 756e 6374 696f 6e73  ####..#Functions
+0000d5b0: 2066 6f72 2061 7070 6c79 696e 6720 666d   for applying fm
+0000d5c0: 6173 6b20 746f 2053 5220 6461 7461 0d0a  ask to SR data..
+0000d5d0: 666d 6173 6b42 6974 4469 6374 203d 207b  fmaskBitDict = {
+0000d5e0: 2743 3127 3a7b 0d0a 2020 2020 2020 2020  'C1':{..        
+0000d5f0: 2020 2020 2020 2020 2020 2020 2763 6c6f              'clo
+0000d600: 7564 2720 3a20 352c 0d0a 2020 2020 2020  ud' : 5,..      
+0000d610: 2020 2020 2020 2020 2020 2020 2020 2773                's
+0000d620: 6861 646f 7727 3a20 332c 0d0a 2020 2020  hadow': 3,..    
+0000d630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d640: 2773 6e6f 7727 3a34 0d0a 2020 2020 2020  'snow':4..      
+0000d650: 2020 2020 2020 2020 2020 2020 2020 7d2c                },
+0000d660: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d670: 2020 2743 3227 3a7b 0d0a 2020 2020 2020    'C2':{..      
+0000d680: 2020 2020 2020 2020 2020 2020 2020 2763                'c
+0000d690: 6c6f 7564 2720 3a20 332c 0d0a 2020 2020  loud' : 3,..    
+0000d6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d6b0: 2773 6861 646f 7727 3a20 342c 0d0a 2020  'shadow': 4,..  
+0000d6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d6d0: 2020 2773 6e6f 7727 3a35 0d0a 2020 2020    'snow':5..    
+0000d6e0: 2020 2020 2020 2020 2020 2020 2020 7d0d                }.
+0000d6f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d700: 207d 0d0a 0d0a 2320 4c53 4320 7570 6461   }....# LSC upda
+0000d710: 7465 6420 342f 3136 2f31 3920 746f 2061  ted 4/16/19 to a
+0000d720: 6464 206d 6564 6975 6d20 616e 6420 6869  dd medium and hi
+0000d730: 6768 2063 6f6e 6669 6465 6e63 6520 636c  gh confidence cl
+0000d740: 6f75 6420 6d61 736b 730d 0a23 2053 7570  oud masks..# Sup
+0000d750: 706f 7274 6564 2066 6d61 736b 436c 6173  ported fmaskClas
+0000d760: 7320 6f70 7469 6f6e 733a 2027 636c 6f75  s options: 'clou
+0000d770: 6427 2c20 2773 6861 646f 7727 2c20 2773  d', 'shadow', 's
+0000d780: 6e6f 7727 2c20 2768 6967 685f 636f 6e66  now', 'high_conf
+0000d790: 6964 656e 6365 5f63 6c6f 7564 272c 2027  idence_cloud', '
+0000d7a0: 6d65 645f 636f 6e66 6964 656e 6365 5f63  med_confidence_c
+0000d7b0: 6c6f 7564 270d 0a64 6566 2063 466d 6173  loud'..def cFmas
+0000d7c0: 6b28 696d 672c 666d 6173 6b43 6c61 7373  k(img,fmaskClass
+0000d7d0: 2c62 6974 4d61 736b 4261 6e64 4e61 6d65  ,bitMaskBandName
+0000d7e0: 203d 2027 5141 5f50 4958 454c 2729 3a0d   = 'QA_PIXEL'):.
+0000d7f0: 0a0d 0a20 2071 6120 3d20 696d 672e 7365  ...  qa = img.se
+0000d800: 6c65 6374 2862 6974 4d61 736b 4261 6e64  lect(bitMaskBand
+0000d810: 4e61 6d65 292e 7569 6e74 3136 2829 0d0a  Name).uint16()..
+0000d820: 2020 6966 2066 6d61 736b 436c 6173 7320    if fmaskClass 
+0000d830: 3d3d 2027 6869 6768 5f63 6f6e 6669 6465  == 'high_confide
+0000d840: 6e63 655f 636c 6f75 6427 3a0d 0a20 2020  nce_cloud':..   
+0000d850: 2020 6d20 3d20 7161 2e62 6974 7769 7365    m = qa.bitwise
+0000d860: 416e 6428 3120 3c3c 2036 292e 6e65 7128  And(1 << 6).neq(
+0000d870: 3029 2e41 6e64 2871 612e 6269 7477 6973  0).And(qa.bitwis
+0000d880: 6541 6e64 2831 203c 3c20 3729 2e6e 6571  eAnd(1 << 7).neq
+0000d890: 2830 2929 0d0a 2020 656c 6966 2066 6d61  (0))..  elif fma
+0000d8a0: 736b 436c 6173 7320 3d3d 2027 6d65 645f  skClass == 'med_
+0000d8b0: 636f 6e66 6964 656e 6365 5f63 6c6f 7564  confidence_cloud
+0000d8c0: 273a 0d0a 2020 2020 206d 203d 2071 612e  ':..     m = qa.
+0000d8d0: 6269 7477 6973 6541 6e64 2831 203c 3c20  bitwiseAnd(1 << 
+0000d8e0: 3729 2e6e 6571 2830 290d 0a20 2065 6c73  7).neq(0)..  els
+0000d8f0: 653a 0d0a 2020 2020 6d20 3d20 7161 2e62  e:..    m = qa.b
+0000d900: 6974 7769 7365 416e 6428 666d 6173 6b42  itwiseAnd(fmaskB
+0000d910: 6974 4469 6374 5b66 6d61 736b 436c 6173  itDict[fmaskClas
+0000d920: 735d 292e 6e65 7128 3029 0d0a 0d0a 2020  s]).neq(0)....  
+0000d930: 7265 7475 726e 2069 6d67 2e75 7064 6174  return img.updat
+0000d940: 654d 6173 6b28 6d2e 4e6f 7428 2929 0d0a  eMask(m.Not())..
+0000d950: 0d0a 2320 4d65 7468 6f64 2066 6f72 2061  ..# Method for a
+0000d960: 7070 6c79 696e 6720 6120 7369 6e67 6c65  pplying a single
+0000d970: 2062 6974 2062 6974 206d 6173 6b0d 0a64   bit bit mask..d
+0000d980: 6566 2061 7070 6c79 4269 744d 6173 6b28  ef applyBitMask(
+0000d990: 696d 672c 6269 742c 6269 744d 6173 6b42  img,bit,bitMaskB
+0000d9a0: 616e 644e 616d 6520 3d20 2751 415f 5049  andName = 'QA_PI
+0000d9b0: 5845 4c27 293a 0d0a 2020 6d20 3d20 696d  XEL'):..  m = im
+0000d9c0: 672e 7365 6c65 6374 285b 6269 744d 6173  g.select([bitMas
+0000d9d0: 6b42 616e 644e 616d 655d 292e 7569 6e74  kBandName]).uint
+0000d9e0: 3136 2829 3b0d 0a20 206d 203d 206d 2e62  16();..  m = m.b
+0000d9f0: 6974 7769 7365 416e 6428 313c 3c62 6974  itwiseAnd(1<<bit
+0000da00: 292e 6e65 7128 3029 0d0a 2020 7265 7475  ).neq(0)..  retu
+0000da10: 726e 2069 6d67 2e75 7064 6174 654d 6173  rn img.updateMas
+0000da20: 6b28 6d2e 4e6f 7428 2929 0d0a 0d0a 0d0a  k(m.Not())......
+0000da30: 6465 6620 6346 6d61 736b 436c 6f75 6428  def cFmaskCloud(
+0000da40: 696d 672c 6c61 6e64 7361 7443 6f6c 6c65  img,landsatColle
+0000da50: 6374 696f 6e56 6572 7369 6f6e 2c62 6974  ctionVersion,bit
+0000da60: 4d61 736b 4261 6e64 4e61 6d65 203d 2027  MaskBandName = '
+0000da70: 5141 5f50 4958 454c 2729 3a0d 0a20 2072  QA_PIXEL'):..  r
+0000da80: 6574 7572 6e20 6170 706c 7942 6974 4d61  eturn applyBitMa
+0000da90: 736b 2869 6d67 2c66 6d61 736b 4269 7444  sk(img,fmaskBitD
+0000daa0: 6963 745b 6c61 6e64 7361 7443 6f6c 6c65  ict[landsatColle
+0000dab0: 6374 696f 6e56 6572 7369 6f6e 5d5b 2763  ctionVersion]['c
+0000dac0: 6c6f 7564 275d 2c62 6974 4d61 736b 4261  loud'],bitMaskBa
+0000dad0: 6e64 4e61 6d65 290d 0a0d 0a64 6566 2063  ndName)....def c
+0000dae0: 466d 6173 6b43 6c6f 7564 5368 6164 6f77  FmaskCloudShadow
+0000daf0: 2869 6d67 2c6c 616e 6473 6174 436f 6c6c  (img,landsatColl
+0000db00: 6563 7469 6f6e 5665 7273 696f 6e2c 6269  ectionVersion,bi
+0000db10: 744d 6173 6b42 616e 644e 616d 6520 3d20  tMaskBandName = 
+0000db20: 2751 415f 5049 5845 4c27 293a 0d0a 2020  'QA_PIXEL'):..  
+0000db30: 7265 7475 726e 2061 7070 6c79 4269 744d  return applyBitM
+0000db40: 6173 6b28 696d 672c 666d 6173 6b42 6974  ask(img,fmaskBit
+0000db50: 4469 6374 5b6c 616e 6473 6174 436f 6c6c  Dict[landsatColl
+0000db60: 6563 7469 6f6e 5665 7273 696f 6e5d 5b27  ectionVersion]['
+0000db70: 7368 6164 6f77 275d 2c62 6974 4d61 736b  shadow'],bitMask
+0000db80: 4261 6e64 4e61 6d65 290d 0a0d 0a23 2323  BandName)....###
+0000db90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000dba0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000dbb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000dbc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000dbd0: 2323 2323 2323 0d0a 2323 2323 2323 2323  ######..########
+0000dbe0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000dbf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000dc00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000dc10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000dc20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000dc30: 2323 2323 2323 2323 230d 0a23 2323 2323  #########..#####
-0000dc40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000dc50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000dc60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000dc70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000dc80: 2323 2323 0d0a 2346 756e 6374 696f 6e20  ####..#Function 
-0000dc90: 666f 7220 6669 6e64 696e 6720 6461 726b  for finding dark
-0000dca0: 206f 7574 6c69 6572 7320 696e 2074 696d   outliers in tim
-0000dcb0: 6520 7365 7269 6573 2e0d 0a23 4f72 6967  e series...#Orig
-0000dcc0: 696e 616c 2063 6f6e 6365 7074 2077 7269  inal concept wri
-0000dcd0: 7474 656e 2062 7920 4361 7273 6f6e 2053  tten by Carson S
-0000dce0: 7461 6d20 616e 6420 6164 6170 7465 6420  tam and adapted 
-0000dcf0: 6279 2049 616e 2048 6f75 736d 616e 2e0d  by Ian Housman..
-0000dd00: 0a23 4164 6473 2061 2062 616e 6420 7468  .#Adds a band th
-0000dd10: 6174 2069 7320 6120 6d61 736b 206f 6620  at is a mask of 
-0000dd20: 7069 7865 6c73 2074 6861 7420 6172 6520  pixels that are 
-0000dd30: 6461 726b 2c20 616e 6420 6461 726b 206f  dark, and dark o
-0000dd40: 7574 6c69 6572 732e 0d0a 6465 6620 7369  utliers...def si
-0000dd50: 6d70 6c65 5444 4f4d 3228 0d0a 2020 2020  mpleTDOM2(..    
-0000dd60: 636f 6c6c 6563 7469 6f6e 2c0d 0a20 2020  collection,..   
-0000dd70: 207a 5363 6f72 6554 6872 6573 6820 3d20   zScoreThresh = 
-0000dd80: 2d31 2c0d 0a20 2020 2073 6861 646f 7753  -1,..    shadowS
-0000dd90: 756d 5468 7265 7368 203d 2030 2e33 352c  umThresh = 0.35,
-0000dda0: 0d0a 2020 2020 636f 6e74 7261 6374 5069  ..    contractPi
-0000ddb0: 7865 6c73 203d 2031 2e35 2c0d 0a20 2020  xels = 1.5,..   
-0000ddc0: 2064 696c 6174 6550 6978 656c 7320 3d20   dilatePixels = 
-0000ddd0: 332e 352c 0d0a 2020 2020 7368 6164 6f77  3.5,..    shadow
-0000dde0: 5375 6d42 616e 6473 203d 205b 276e 6972  SumBands = ['nir
-0000ddf0: 272c 2773 7769 7231 275d 2c0d 0a20 2020  ','swir1'],..   
-0000de00: 2070 7265 436f 6d70 7574 6564 5444 4f4d   preComputedTDOM
-0000de10: 4952 4d65 616e 203d 204e 6f6e 652c 0d0a  IRMean = None,..
-0000de20: 2020 2020 7072 6543 6f6d 7075 7465 6454      preComputedT
-0000de30: 444f 4d49 5253 7464 4465 7620 3d20 4e6f  DOMIRStdDev = No
-0000de40: 6e65 293a 0d0a 0d0a 2020 6172 6773 203d  ne):....  args =
-0000de50: 2066 6f72 6d61 7441 7267 7328 6c6f 6361   formatArgs(loca
-0000de60: 6c73 2829 290d 0a0d 0a20 2023 4765 7420  ls())....  #Get 
-0000de70: 736f 6d65 2070 6978 656c 2d77 6973 6520  some pixel-wise 
-0000de80: 7374 6174 7320 666f 7220 7468 6520 7469  stats for the ti
-0000de90: 6d65 2073 6572 6965 730d 0a20 2069 6620  me series..  if 
-0000dea0: 7072 6543 6f6d 7075 7465 6454 444f 4d49  preComputedTDOMI
-0000deb0: 524d 6561 6e20 3d3d 204e 6f6e 653a 0d0a  RMean == None:..
-0000dec0: 2020 2020 7072 696e 7428 2743 6f6d 7075      print('Compu
-0000ded0: 7469 6e67 2069 724d 6561 6e20 666f 7220  ting irMean for 
-0000dee0: 5444 4f4d 2729 0d0a 2020 2020 6972 4d65  TDOM')..    irMe
-0000def0: 616e 203d 2063 6f6c 6c65 6374 696f 6e2e  an = collection.
-0000df00: 7365 6c65 6374 2873 6861 646f 7753 756d  select(shadowSum
-0000df10: 4261 6e64 7329 2e6d 6561 6e28 290d 0a20  Bands).mean().. 
-0000df20: 2065 6c73 653a 0d0a 2020 2020 7072 696e   else:..    prin
-0000df30: 7428 2755 7369 6e67 2070 7265 2d63 6f6d  t('Using pre-com
-0000df40: 7075 7465 6420 6972 4d65 616e 2066 6f72  puted irMean for
-0000df50: 2054 444f 4d27 290d 0a20 2020 2069 724d   TDOM')..    irM
-0000df60: 6561 6e20 3d20 7072 6543 6f6d 7075 7465  ean = preCompute
-0000df70: 6454 444f 4d49 524d 6561 6e0d 0a0d 0a20  dTDOMIRMean.... 
-0000df80: 2069 6620 7072 6543 6f6d 7075 7465 6454   if preComputedT
-0000df90: 444f 4d49 5253 7464 4465 7620 3d3d 204e  DOMIRStdDev == N
-0000dfa0: 6f6e 653a 0d0a 2020 2020 7072 696e 7428  one:..    print(
-0000dfb0: 2743 6f6d 7075 7469 6e67 2069 7253 7464  'Computing irStd
-0000dfc0: 4465 7620 666f 7220 5444 4f4d 2729 0d0a  Dev for TDOM')..
-0000dfd0: 2020 2020 6972 5374 6444 6576 203d 2063      irStdDev = c
-0000dfe0: 6f6c 6c65 6374 696f 6e2e 7365 6c65 6374  ollection.select
-0000dff0: 2873 6861 646f 7753 756d 4261 6e64 7329  (shadowSumBands)
-0000e000: 2e72 6564 7563 6528 6565 2e52 6564 7563  .reduce(ee.Reduc
-0000e010: 6572 2e73 7464 4465 7628 2929 0d0a 2020  er.stdDev())..  
-0000e020: 656c 7365 3a0d 0a20 2020 2070 7269 6e74  else:..    print
-0000e030: 2827 5573 696e 6720 7072 652d 636f 6d70  ('Using pre-comp
-0000e040: 7574 6564 2069 7253 7464 4465 7620 666f  uted irStdDev fo
-0000e050: 7220 5444 4f4d 2729 0d0a 2020 2020 6972  r TDOM')..    ir
-0000e060: 5374 6444 6576 203d 2070 7265 436f 6d70  StdDev = preComp
-0000e070: 7574 6564 5444 4f4d 4952 5374 6444 6576  utedTDOMIRStdDev
-0000e080: 0d0a 0d0a 2020 6465 6620 7a54 6872 6573  ....  def zThres
-0000e090: 686f 6c64 6572 2869 6d67 293a 0d0a 2020  holder(img):..  
-0000e0a0: 2020 7a53 636f 7265 203d 2069 6d67 2e73    zScore = img.s
-0000e0b0: 656c 6563 7428 7368 6164 6f77 5375 6d42  elect(shadowSumB
-0000e0c0: 616e 6473 292e 7375 6274 7261 6374 2869  ands).subtract(i
-0000e0d0: 724d 6561 6e29 2e64 6976 6964 6528 6972  rMean).divide(ir
-0000e0e0: 5374 6444 6576 290d 0a20 2020 2069 7253  StdDev)..    irS
-0000e0f0: 756d 203d 2069 6d67 2e73 656c 6563 7428  um = img.select(
-0000e100: 7368 6164 6f77 5375 6d42 616e 6473 292e  shadowSumBands).
-0000e110: 7265 6475 6365 2865 652e 5265 6475 6365  reduce(ee.Reduce
-0000e120: 722e 7375 6d28 2929 0d0a 2020 2020 5444  r.sum())..    TD
-0000e130: 4f4d 4d61 736b 203d 207a 5363 6f72 652e  OMMask = zScore.
-0000e140: 6c74 287a 5363 6f72 6554 6872 6573 6829  lt(zScoreThresh)
-0000e150: 2e72 6564 7563 6528 6565 2e52 6564 7563  .reduce(ee.Reduc
-0000e160: 6572 2e73 756d 2829 292e 6571 286c 656e  er.sum()).eq(len
-0000e170: 2873 6861 646f 7753 756d 4261 6e64 7329  (shadowSumBands)
-0000e180: 292e 416e 6428 6972 5375 6d2e 6c74 2873  ).And(irSum.lt(s
-0000e190: 6861 646f 7753 756d 5468 7265 7368 2929  hadowSumThresh))
-0000e1a0: 0d0a 2020 2020 5444 4f4d 4d61 736b 203d  ..    TDOMMask =
-0000e1b0: 2054 444f 4d4d 6173 6b2e 666f 6361 6c5f   TDOMMask.focal_
-0000e1c0: 6d69 6e28 636f 6e74 7261 6374 5069 7865  min(contractPixe
-0000e1d0: 6c73 292e 666f 6361 6c5f 6d61 7828 6469  ls).focal_max(di
-0000e1e0: 6c61 7465 5069 7865 6c73 290d 0a20 2020  latePixels)..   
-0000e1f0: 2072 6574 7572 6e20 696d 672e 7570 6461   return img.upda
-0000e200: 7465 4d61 736b 2854 444f 4d4d 6173 6b2e  teMask(TDOMMask.
-0000e210: 4e6f 7428 2929 0d0a 0d0a 2020 234d 6173  Not())....  #Mas
-0000e220: 6b20 6f75 7420 6461 726b 2064 6172 6b20  k out dark dark 
-0000e230: 6f75 746c 6965 7273 0d0a 2020 636f 6c6c  outliers..  coll
-0000e240: 6563 7469 6f6e 203d 2063 6f6c 6c65 6374  ection = collect
-0000e250: 696f 6e2e 6d61 7028 7a54 6872 6573 686f  ion.map(zThresho
-0000e260: 6c64 6572 290d 0a20 2072 6574 7572 6e20  lder)..  return 
-0000e270: 636f 6c6c 6563 7469 6f6e 2e73 6574 2861  collection.set(a
-0000e280: 7267 7329 0d0a 0d0a 0d0a 2323 2323 2323  rgs)......######
+0000dc20: 230d 0a23 4675 6e63 7469 6f6e 2066 6f72  #..#Function for
+0000dc30: 2066 696e 6469 6e67 2064 6172 6b20 6f75   finding dark ou
+0000dc40: 746c 6965 7273 2069 6e20 7469 6d65 2073  tliers in time s
+0000dc50: 6572 6965 732e 0d0a 234f 7269 6769 6e61  eries...#Origina
+0000dc60: 6c20 636f 6e63 6570 7420 7772 6974 7465  l concept writte
+0000dc70: 6e20 6279 2043 6172 736f 6e20 5374 616d  n by Carson Stam
+0000dc80: 2061 6e64 2061 6461 7074 6564 2062 7920   and adapted by 
+0000dc90: 4961 6e20 486f 7573 6d61 6e2e 0d0a 2341  Ian Housman...#A
+0000dca0: 6464 7320 6120 6261 6e64 2074 6861 7420  dds a band that 
+0000dcb0: 6973 2061 206d 6173 6b20 6f66 2070 6978  is a mask of pix
+0000dcc0: 656c 7320 7468 6174 2061 7265 2064 6172  els that are dar
+0000dcd0: 6b2c 2061 6e64 2064 6172 6b20 6f75 746c  k, and dark outl
+0000dce0: 6965 7273 2e0d 0a64 6566 2073 696d 706c  iers...def simpl
+0000dcf0: 6554 444f 4d32 280d 0a20 2020 2063 6f6c  eTDOM2(..    col
+0000dd00: 6c65 6374 696f 6e2c 0d0a 2020 2020 7a53  lection,..    zS
+0000dd10: 636f 7265 5468 7265 7368 203d 202d 312c  coreThresh = -1,
+0000dd20: 0d0a 2020 2020 7368 6164 6f77 5375 6d54  ..    shadowSumT
+0000dd30: 6872 6573 6820 3d20 302e 3335 2c0d 0a20  hresh = 0.35,.. 
+0000dd40: 2020 2063 6f6e 7472 6163 7450 6978 656c     contractPixel
+0000dd50: 7320 3d20 312e 352c 0d0a 2020 2020 6469  s = 1.5,..    di
+0000dd60: 6c61 7465 5069 7865 6c73 203d 2033 2e35  latePixels = 3.5
+0000dd70: 2c0d 0a20 2020 2073 6861 646f 7753 756d  ,..    shadowSum
+0000dd80: 4261 6e64 7320 3d20 5b27 6e69 7227 2c27  Bands = ['nir','
+0000dd90: 7377 6972 3127 5d2c 0d0a 2020 2020 7072  swir1'],..    pr
+0000dda0: 6543 6f6d 7075 7465 6454 444f 4d49 524d  eComputedTDOMIRM
+0000ddb0: 6561 6e20 3d20 4e6f 6e65 2c0d 0a20 2020  ean = None,..   
+0000ddc0: 2070 7265 436f 6d70 7574 6564 5444 4f4d   preComputedTDOM
+0000ddd0: 4952 5374 6444 6576 203d 204e 6f6e 6529  IRStdDev = None)
+0000dde0: 3a0d 0a0d 0a20 2061 7267 7320 3d20 666f  :....  args = fo
+0000ddf0: 726d 6174 4172 6773 286c 6f63 616c 7328  rmatArgs(locals(
+0000de00: 2929 0d0a 0d0a 2020 2347 6574 2073 6f6d  ))....  #Get som
+0000de10: 6520 7069 7865 6c2d 7769 7365 2073 7461  e pixel-wise sta
+0000de20: 7473 2066 6f72 2074 6865 2074 696d 6520  ts for the time 
+0000de30: 7365 7269 6573 0d0a 2020 6966 2070 7265  series..  if pre
+0000de40: 436f 6d70 7574 6564 5444 4f4d 4952 4d65  ComputedTDOMIRMe
+0000de50: 616e 203d 3d20 4e6f 6e65 3a0d 0a20 2020  an == None:..   
+0000de60: 2070 7269 6e74 2827 436f 6d70 7574 696e   print('Computin
+0000de70: 6720 6972 4d65 616e 2066 6f72 2054 444f  g irMean for TDO
+0000de80: 4d27 290d 0a20 2020 2069 724d 6561 6e20  M')..    irMean 
+0000de90: 3d20 636f 6c6c 6563 7469 6f6e 2e73 656c  = collection.sel
+0000dea0: 6563 7428 7368 6164 6f77 5375 6d42 616e  ect(shadowSumBan
+0000deb0: 6473 292e 6d65 616e 2829 0d0a 2020 656c  ds).mean()..  el
+0000dec0: 7365 3a0d 0a20 2020 2070 7269 6e74 2827  se:..    print('
+0000ded0: 5573 696e 6720 7072 652d 636f 6d70 7574  Using pre-comput
+0000dee0: 6564 2069 724d 6561 6e20 666f 7220 5444  ed irMean for TD
+0000def0: 4f4d 2729 0d0a 2020 2020 6972 4d65 616e  OM')..    irMean
+0000df00: 203d 2070 7265 436f 6d70 7574 6564 5444   = preComputedTD
+0000df10: 4f4d 4952 4d65 616e 0d0a 0d0a 2020 6966  OMIRMean....  if
+0000df20: 2070 7265 436f 6d70 7574 6564 5444 4f4d   preComputedTDOM
+0000df30: 4952 5374 6444 6576 203d 3d20 4e6f 6e65  IRStdDev == None
+0000df40: 3a0d 0a20 2020 2070 7269 6e74 2827 436f  :..    print('Co
+0000df50: 6d70 7574 696e 6720 6972 5374 6444 6576  mputing irStdDev
+0000df60: 2066 6f72 2054 444f 4d27 290d 0a20 2020   for TDOM')..   
+0000df70: 2069 7253 7464 4465 7620 3d20 636f 6c6c   irStdDev = coll
+0000df80: 6563 7469 6f6e 2e73 656c 6563 7428 7368  ection.select(sh
+0000df90: 6164 6f77 5375 6d42 616e 6473 292e 7265  adowSumBands).re
+0000dfa0: 6475 6365 2865 652e 5265 6475 6365 722e  duce(ee.Reducer.
+0000dfb0: 7374 6444 6576 2829 290d 0a20 2065 6c73  stdDev())..  els
+0000dfc0: 653a 0d0a 2020 2020 7072 696e 7428 2755  e:..    print('U
+0000dfd0: 7369 6e67 2070 7265 2d63 6f6d 7075 7465  sing pre-compute
+0000dfe0: 6420 6972 5374 6444 6576 2066 6f72 2054  d irStdDev for T
+0000dff0: 444f 4d27 290d 0a20 2020 2069 7253 7464  DOM')..    irStd
+0000e000: 4465 7620 3d20 7072 6543 6f6d 7075 7465  Dev = preCompute
+0000e010: 6454 444f 4d49 5253 7464 4465 760d 0a0d  dTDOMIRStdDev...
+0000e020: 0a20 2064 6566 207a 5468 7265 7368 6f6c  .  def zThreshol
+0000e030: 6465 7228 696d 6729 3a0d 0a20 2020 207a  der(img):..    z
+0000e040: 5363 6f72 6520 3d20 696d 672e 7365 6c65  Score = img.sele
+0000e050: 6374 2873 6861 646f 7753 756d 4261 6e64  ct(shadowSumBand
+0000e060: 7329 2e73 7562 7472 6163 7428 6972 4d65  s).subtract(irMe
+0000e070: 616e 292e 6469 7669 6465 2869 7253 7464  an).divide(irStd
+0000e080: 4465 7629 0d0a 2020 2020 6972 5375 6d20  Dev)..    irSum 
+0000e090: 3d20 696d 672e 7365 6c65 6374 2873 6861  = img.select(sha
+0000e0a0: 646f 7753 756d 4261 6e64 7329 2e72 6564  dowSumBands).red
+0000e0b0: 7563 6528 6565 2e52 6564 7563 6572 2e73  uce(ee.Reducer.s
+0000e0c0: 756d 2829 290d 0a20 2020 2054 444f 4d4d  um())..    TDOMM
+0000e0d0: 6173 6b20 3d20 7a53 636f 7265 2e6c 7428  ask = zScore.lt(
+0000e0e0: 7a53 636f 7265 5468 7265 7368 292e 7265  zScoreThresh).re
+0000e0f0: 6475 6365 2865 652e 5265 6475 6365 722e  duce(ee.Reducer.
+0000e100: 7375 6d28 2929 2e65 7128 6c65 6e28 7368  sum()).eq(len(sh
+0000e110: 6164 6f77 5375 6d42 616e 6473 2929 2e41  adowSumBands)).A
+0000e120: 6e64 2869 7253 756d 2e6c 7428 7368 6164  nd(irSum.lt(shad
+0000e130: 6f77 5375 6d54 6872 6573 6829 290d 0a20  owSumThresh)).. 
+0000e140: 2020 2054 444f 4d4d 6173 6b20 3d20 5444     TDOMMask = TD
+0000e150: 4f4d 4d61 736b 2e66 6f63 616c 5f6d 696e  OMMask.focal_min
+0000e160: 2863 6f6e 7472 6163 7450 6978 656c 7329  (contractPixels)
+0000e170: 2e66 6f63 616c 5f6d 6178 2864 696c 6174  .focal_max(dilat
+0000e180: 6550 6978 656c 7329 0d0a 2020 2020 7265  ePixels)..    re
+0000e190: 7475 726e 2069 6d67 2e75 7064 6174 654d  turn img.updateM
+0000e1a0: 6173 6b28 5444 4f4d 4d61 736b 2e4e 6f74  ask(TDOMMask.Not
+0000e1b0: 2829 290d 0a0d 0a20 2023 4d61 736b 206f  ())....  #Mask o
+0000e1c0: 7574 2064 6172 6b20 6461 726b 206f 7574  ut dark dark out
+0000e1d0: 6c69 6572 730d 0a20 2063 6f6c 6c65 6374  liers..  collect
+0000e1e0: 696f 6e20 3d20 636f 6c6c 6563 7469 6f6e  ion = collection
+0000e1f0: 2e6d 6170 287a 5468 7265 7368 6f6c 6465  .map(zThresholde
+0000e200: 7229 0d0a 2020 7265 7475 726e 2063 6f6c  r)..  return col
+0000e210: 6c65 6374 696f 6e2e 7365 7428 6172 6773  lection.set(args
+0000e220: 290d 0a0d 0a0d 0a23 2323 2323 2323 2323  )......#########
+0000e230: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e240: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e250: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e260: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e270: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
+0000e280: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000e290: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000e2a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e2b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e2c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e2d0: 2323 230d 0a23 2323 2323 2323 2323 2323  ###..###########
-0000e2e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e2f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e310: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
-0000e320: 2346 756e 6374 696f 6e20 746f 2061 6464  #Function to add
-0000e330: 2063 6f6d 6d6f 6e20 2861 6e64 206c 6573   common (and les
-0000e340: 7320 636f 6d6d 6f6e 2920 7370 6563 7472  s common) spectr
-0000e350: 616c 2069 6e64 6963 6573 2074 6f20 616e  al indices to an
-0000e360: 2069 6d61 6765 2e0d 0a23 496e 636c 7564   image...#Includ
-0000e370: 6573 2074 6865 204e 6f72 6d61 6c69 7a65  es the Normalize
-0000e380: 6420 4469 6666 6572 656e 6365 2053 7065  d Difference Spe
-0000e390: 6374 7261 6c20 5665 6374 6f72 2066 726f  ctral Vector fro
-0000e3a0: 6d20 2841 6e67 6975 6c69 2061 6e64 2054  m (Angiuli and T
-0000e3b0: 7269 616e 6e69 2c20 3230 3134 290d 0a64  rianni, 2014)..d
-0000e3c0: 6566 2061 6464 496e 6469 6365 7328 696d  ef addIndices(im
-0000e3d0: 6729 3a0d 0a20 2023 4164 6420 4e6f 726d  g):..  #Add Norm
-0000e3e0: 616c 697a 6564 2044 6966 6665 7265 6e63  alized Differenc
-0000e3f0: 6520 5370 6563 7472 616c 2056 6563 746f  e Spectral Vecto
-0000e400: 7220 284e 4453 5629 0d0a 2020 696d 6720  r (NDSV)..  img 
-0000e410: 3d20 696d 672e 6164 6442 616e 6473 2869  = img.addBands(i
-0000e420: 6d67 2e6e 6f72 6d61 6c69 7a65 6444 6966  mg.normalizedDif
-0000e430: 6665 7265 6e63 6528 5b27 626c 7565 272c  ference(['blue',
-0000e440: 2767 7265 656e 275d 292e 7265 6e61 6d65  'green']).rename
-0000e450: 285b 274e 445f 626c 7565 5f67 7265 656e  (['ND_blue_green
-0000e460: 275d 2929 0d0a 2020 696d 6720 3d20 696d  ']))..  img = im
-0000e470: 672e 6164 6442 616e 6473 2869 6d67 2e6e  g.addBands(img.n
-0000e480: 6f72 6d61 6c69 7a65 6444 6966 6665 7265  ormalizedDiffere
-0000e490: 6e63 6528 5b27 626c 7565 272c 2772 6564  nce(['blue','red
-0000e4a0: 275d 292e 7265 6e61 6d65 285b 274e 445f  ']).rename(['ND_
-0000e4b0: 626c 7565 5f72 6564 275d 2929 0d0a 2020  blue_red']))..  
-0000e4c0: 696d 6720 3d20 696d 672e 6164 6442 616e  img = img.addBan
-0000e4d0: 6473 2869 6d67 2e6e 6f72 6d61 6c69 7a65  ds(img.normalize
-0000e4e0: 6444 6966 6665 7265 6e63 6528 5b27 626c  dDifference(['bl
-0000e4f0: 7565 272c 276e 6972 275d 292e 7265 6e61  ue','nir']).rena
-0000e500: 6d65 285b 274e 445f 626c 7565 5f6e 6972  me(['ND_blue_nir
-0000e510: 275d 2929 0d0a 2020 696d 6720 3d20 696d  ']))..  img = im
-0000e520: 672e 6164 6442 616e 6473 2869 6d67 2e6e  g.addBands(img.n
-0000e530: 6f72 6d61 6c69 7a65 6444 6966 6665 7265  ormalizedDiffere
-0000e540: 6e63 6528 5b27 626c 7565 272c 2773 7769  nce(['blue','swi
-0000e550: 7231 275d 292e 7265 6e61 6d65 285b 274e  r1']).rename(['N
-0000e560: 445f 626c 7565 5f73 7769 7231 275d 2929  D_blue_swir1']))
-0000e570: 0d0a 2020 696d 6720 3d20 696d 672e 6164  ..  img = img.ad
-0000e580: 6442 616e 6473 2869 6d67 2e6e 6f72 6d61  dBands(img.norma
-0000e590: 6c69 7a65 6444 6966 6665 7265 6e63 6528  lizedDifference(
-0000e5a0: 5b27 626c 7565 272c 2773 7769 7232 275d  ['blue','swir2']
-0000e5b0: 292e 7265 6e61 6d65 285b 274e 445f 626c  ).rename(['ND_bl
-0000e5c0: 7565 5f73 7769 7232 275d 2929 0d0a 0d0a  ue_swir2']))....
-0000e5d0: 2020 696d 6720 3d20 696d 672e 6164 6442    img = img.addB
-0000e5e0: 616e 6473 2869 6d67 2e6e 6f72 6d61 6c69  ands(img.normali
-0000e5f0: 7a65 6444 6966 6665 7265 6e63 6528 5b27  zedDifference(['
-0000e600: 6772 6565 6e27 2c27 7265 6427 5d29 2e72  green','red']).r
-0000e610: 656e 616d 6528 5b27 4e44 5f67 7265 656e  ename(['ND_green
-0000e620: 5f72 6564 275d 2929 0d0a 2020 696d 6720  _red']))..  img 
-0000e630: 3d20 696d 672e 6164 6442 616e 6473 2869  = img.addBands(i
-0000e640: 6d67 2e6e 6f72 6d61 6c69 7a65 6444 6966  mg.normalizedDif
-0000e650: 6665 7265 6e63 6528 5b27 6772 6565 6e27  ference(['green'
-0000e660: 2c27 6e69 7227 5d29 2e72 656e 616d 6528  ,'nir']).rename(
-0000e670: 5b27 4e44 5f67 7265 656e 5f6e 6972 275d  ['ND_green_nir']
-0000e680: 2929 234e 4457 4249 0d0a 2020 696d 6720  ))#NDWBI..  img 
-0000e690: 3d20 696d 672e 6164 6442 616e 6473 2869  = img.addBands(i
-0000e6a0: 6d67 2e6e 6f72 6d61 6c69 7a65 6444 6966  mg.normalizedDif
-0000e6b0: 6665 7265 6e63 6528 5b27 6772 6565 6e27  ference(['green'
-0000e6c0: 2c27 7377 6972 3127 5d29 2e72 656e 616d  ,'swir1']).renam
-0000e6d0: 6528 5b27 4e44 5f67 7265 656e 5f73 7769  e(['ND_green_swi
-0000e6e0: 7231 275d 2929 234e 4453 492c 204d 4e44  r1']))#NDSI, MND
-0000e6f0: 5749 0d0a 2020 696d 6720 3d20 696d 672e  WI..  img = img.
-0000e700: 6164 6442 616e 6473 2869 6d67 2e6e 6f72  addBands(img.nor
-0000e710: 6d61 6c69 7a65 6444 6966 6665 7265 6e63  malizedDifferenc
-0000e720: 6528 5b27 6772 6565 6e27 2c27 7377 6972  e(['green','swir
-0000e730: 3227 5d29 2e72 656e 616d 6528 5b27 4e44  2']).rename(['ND
-0000e740: 5f67 7265 656e 5f73 7769 7232 275d 2929  _green_swir2']))
-0000e750: 0d0a 0d0a 2020 696d 6720 3d20 696d 672e  ....  img = img.
-0000e760: 6164 6442 616e 6473 2869 6d67 2e6e 6f72  addBands(img.nor
-0000e770: 6d61 6c69 7a65 6444 6966 6665 7265 6e63  malizedDifferenc
-0000e780: 6528 5b27 7265 6427 2c27 7377 6972 3127  e(['red','swir1'
-0000e790: 5d29 2e72 656e 616d 6528 5b27 4e44 5f72  ]).rename(['ND_r
-0000e7a0: 6564 5f73 7769 7231 275d 2929 0d0a 2020  ed_swir1']))..  
-0000e7b0: 696d 6720 3d20 696d 672e 6164 6442 616e  img = img.addBan
-0000e7c0: 6473 2869 6d67 2e6e 6f72 6d61 6c69 7a65  ds(img.normalize
-0000e7d0: 6444 6966 6665 7265 6e63 6528 5b27 7265  dDifference(['re
-0000e7e0: 6427 2c27 7377 6972 3227 5d29 2e72 656e  d','swir2']).ren
-0000e7f0: 616d 6528 5b27 4e44 5f72 6564 5f73 7769  ame(['ND_red_swi
-0000e800: 7232 275d 2929 0d0a 0d0a 0d0a 2020 696d  r2']))......  im
-0000e810: 6720 3d20 696d 672e 6164 6442 616e 6473  g = img.addBands
-0000e820: 2869 6d67 2e6e 6f72 6d61 6c69 7a65 6444  (img.normalizedD
-0000e830: 6966 6665 7265 6e63 6528 5b27 6e69 7227  ifference(['nir'
-0000e840: 2c27 7265 6427 5d29 2e72 656e 616d 6528  ,'red']).rename(
-0000e850: 5b27 4e44 5f6e 6972 5f72 6564 275d 2929  ['ND_nir_red']))
-0000e860: 234e 4456 490d 0a20 2069 6d67 203d 2069  #NDVI..  img = i
-0000e870: 6d67 2e61 6464 4261 6e64 7328 696d 672e  mg.addBands(img.
-0000e880: 6e6f 726d 616c 697a 6564 4469 6666 6572  normalizedDiffer
-0000e890: 656e 6365 285b 276e 6972 272c 2773 7769  ence(['nir','swi
-0000e8a0: 7231 275d 292e 7265 6e61 6d65 285b 274e  r1']).rename(['N
-0000e8b0: 445f 6e69 725f 7377 6972 3127 5d29 2923  D_nir_swir1']))#
-0000e8c0: 4e44 5749 2c20 4c53 5749 2c20 2d4e 4442  NDWI, LSWI, -NDB
-0000e8d0: 490d 0a20 2069 6d67 203d 2069 6d67 2e61  I..  img = img.a
-0000e8e0: 6464 4261 6e64 7328 696d 672e 6e6f 726d  ddBands(img.norm
-0000e8f0: 616c 697a 6564 4469 6666 6572 656e 6365  alizedDifference
-0000e900: 285b 276e 6972 272c 2773 7769 7232 275d  (['nir','swir2']
-0000e910: 292e 7265 6e61 6d65 285b 274e 445f 6e69  ).rename(['ND_ni
-0000e920: 725f 7377 6972 3227 5d29 2923 4e42 522c  r_swir2']))#NBR,
-0000e930: 204d 4e44 5649 0d0a 0d0a 2020 696d 6720   MNDVI....  img 
-0000e940: 3d20 696d 672e 6164 6442 616e 6473 2869  = img.addBands(i
-0000e950: 6d67 2e6e 6f72 6d61 6c69 7a65 6444 6966  mg.normalizedDif
-0000e960: 6665 7265 6e63 6528 5b27 7377 6972 3127  ference(['swir1'
-0000e970: 2c27 7377 6972 3227 5d29 2e72 656e 616d  ,'swir2']).renam
-0000e980: 6528 5b27 4e44 5f73 7769 7231 5f73 7769  e(['ND_swir1_swi
-0000e990: 7232 275d 2929 3b0d 0a0d 0a20 2023 4164  r2']));....  #Ad
-0000e9a0: 6420 7261 7469 6f73 0d0a 2020 696d 6720  d ratios..  img 
-0000e9b0: 3d20 696d 672e 6164 6442 616e 6473 2869  = img.addBands(i
-0000e9c0: 6d67 2e73 656c 6563 7428 2773 7769 7231  mg.select('swir1
-0000e9d0: 2729 2e64 6976 6964 6528 696d 672e 7365  ').divide(img.se
-0000e9e0: 6c65 6374 2827 6e69 7227 2929 2e72 656e  lect('nir')).ren
-0000e9f0: 616d 6528 5b27 525f 7377 6972 315f 6e69  ame(['R_swir1_ni
-0000ea00: 7227 5d29 2923 7261 7469 6f20 352f 340d  r']))#ratio 5/4.
-0000ea10: 0a20 2069 6d67 203d 2069 6d67 2e61 6464  .  img = img.add
-0000ea20: 4261 6e64 7328 696d 672e 7365 6c65 6374  Bands(img.select
-0000ea30: 2827 7265 6427 292e 6469 7669 6465 2869  ('red').divide(i
-0000ea40: 6d67 2e73 656c 6563 7428 2773 7769 7231  mg.select('swir1
-0000ea50: 2729 292e 7265 6e61 6d65 285b 2752 5f72  ')).rename(['R_r
-0000ea60: 6564 5f73 7769 7231 275d 2929 2372 6174  ed_swir1']))#rat
-0000ea70: 696f 2033 2f35 0d0a 0d0a 2020 2341 6464  io 3/5....  #Add
-0000ea80: 2045 6e68 616e 6365 6420 5665 6765 7461   Enhanced Vegeta
-0000ea90: 7469 6f6e 2049 6e64 6578 2028 4556 4929  tion Index (EVI)
-0000eaa0: 0d0a 2020 6576 6920 3d20 696d 672e 6578  ..  evi = img.ex
-0000eab0: 7072 6573 7369 6f6e 285c 0d0a 2020 2020  pression(\..    
-0000eac0: 2732 2e35 202a 2028 284e 4952 202d 2052  '2.5 * ((NIR - R
-0000ead0: 4544 2920 2f20 284e 4952 202b 2036 202a  ED) / (NIR + 6 *
-0000eae0: 2052 4544 202d 2037 2e35 202a 2042 4c55   RED - 7.5 * BLU
-0000eaf0: 4520 2b20 3129 2927 2c20 7b5c 0d0a 2020  E + 1))', {\..  
-0000eb00: 2020 2020 274e 4952 273a 2069 6d67 2e73      'NIR': img.s
-0000eb10: 656c 6563 7428 276e 6972 2729 2c5c 0d0a  elect('nir'),\..
-0000eb20: 2020 2020 2020 2752 4544 273a 2069 6d67        'RED': img
-0000eb30: 2e73 656c 6563 7428 2772 6564 2729 2c5c  .select('red'),\
-0000eb40: 0d0a 2020 2020 2020 2742 4c55 4527 3a20  ..      'BLUE': 
-0000eb50: 696d 672e 7365 6c65 6374 2827 626c 7565  img.select('blue
-0000eb60: 2729 5c0d 0a20 207d 292e 666c 6f61 7428  ')\..  }).float(
-0000eb70: 290d 0a20 2069 6d67 203d 2069 6d67 2e61  )..  img = img.a
-0000eb80: 6464 4261 6e64 7328 6576 692e 7265 6e61  ddBands(evi.rena
-0000eb90: 6d65 2827 4556 4927 2929 0d0a 0d0a 2020  me('EVI'))....  
-0000eba0: 2341 6464 2053 6f69 6c20 4164 6a75 7374  #Add Soil Adjust
-0000ebb0: 2056 6567 6574 6174 696f 6e20 496e 6465   Vegetation Inde
-0000ebc0: 7820 2853 4156 4929 0d0a 2020 2375 7369  x (SAVI)..  #usi
-0000ebd0: 6e67 204c 203d 2030 2e35 3b0d 0a20 2073  ng L = 0.5;..  s
-0000ebe0: 6176 6920 3d20 696d 672e 6578 7072 6573  avi = img.expres
-0000ebf0: 7369 6f6e 285c 0d0a 2020 2020 2728 4e49  sion(\..    '(NI
-0000ec00: 5220 2d20 5245 4429 202a 2028 3120 2b20  R - RED) * (1 + 
-0000ec10: 302e 3529 2f28 4e49 5220 2b20 5245 4420  0.5)/(NIR + RED 
-0000ec20: 2b20 302e 3529 272c 207b 5c0d 0a20 2020  + 0.5)', {\..   
-0000ec30: 2020 2027 4e49 5227 3a20 696d 672e 7365     'NIR': img.se
-0000ec40: 6c65 6374 2827 6e69 7227 292c 5c0d 0a20  lect('nir'),\.. 
-0000ec50: 2020 2020 2027 5245 4427 3a20 696d 672e       'RED': img.
-0000ec60: 7365 6c65 6374 2827 7265 6427 295c 0d0a  select('red')\..
-0000ec70: 2020 7d29 2e66 6c6f 6174 2829 0d0a 2020    }).float()..  
-0000ec80: 696d 6720 3d20 696d 672e 6164 6442 616e  img = img.addBan
-0000ec90: 6473 2873 6176 692e 7265 6e61 6d65 285b  ds(savi.rename([
-0000eca0: 2753 4156 4927 5d29 290d 0a0d 0a20 2023  'SAVI']))....  #
-0000ecb0: 4164 6420 496e 6465 782d 4261 7365 6420  Add Index-Based 
-0000ecc0: 4275 696c 742d 5570 2049 6e64 6578 2028  Built-Up Index (
-0000ecd0: 4942 4929 0d0a 2020 6962 695f 6120 3d20  IBI)..  ibi_a = 
-0000ece0: 696d 672e 6578 7072 6573 7369 6f6e 285c  img.expression(\
-0000ecf0: 0d0a 2020 2020 2732 2a53 5749 5231 2f28  ..    '2*SWIR1/(
-0000ed00: 5357 4952 3120 2b20 4e49 5229 272c 207b  SWIR1 + NIR)', {
-0000ed10: 5c0d 0a20 2020 2020 2027 5357 4952 3127  \..      'SWIR1'
-0000ed20: 3a20 696d 672e 7365 6c65 6374 2827 7377  : img.select('sw
-0000ed30: 6972 3127 292c 5c0d 0a20 2020 2020 2027  ir1'),\..      '
-0000ed40: 4e49 5227 3a20 696d 672e 7365 6c65 6374  NIR': img.select
-0000ed50: 2827 6e69 7227 295c 0d0a 2020 2020 7d29  ('nir')\..    })
-0000ed60: 2e72 656e 616d 6528 5b27 4942 495f 4127  .rename(['IBI_A'
-0000ed70: 5d29 0d0a 0d0a 2020 6962 695f 6220 3d20  ])....  ibi_b = 
-0000ed80: 696d 672e 6578 7072 6573 7369 6f6e 285c  img.expression(\
-0000ed90: 0d0a 2020 2020 2728 4e49 522f 284e 4952  ..    '(NIR/(NIR
-0000eda0: 202b 2052 4544 2929 202b 2028 4752 4545   + RED)) + (GREE
-0000edb0: 4e2f 2847 5245 454e 202b 2053 5749 5231  N/(GREEN + SWIR1
-0000edc0: 2929 272c 207b 5c0d 0a20 2020 2020 2027  ))', {\..      '
-0000edd0: 4e49 5227 3a20 696d 672e 7365 6c65 6374  NIR': img.select
-0000ede0: 2827 6e69 7227 292c 5c0d 0a20 2020 2020  ('nir'),\..     
-0000edf0: 2027 5245 4427 3a20 696d 672e 7365 6c65   'RED': img.sele
-0000ee00: 6374 2827 7265 6427 292c 5c0d 0a20 2020  ct('red'),\..   
-0000ee10: 2020 2027 4752 4545 4e27 3a20 696d 672e     'GREEN': img.
-0000ee20: 7365 6c65 6374 2827 6772 6565 6e27 292c  select('green'),
-0000ee30: 5c0d 0a20 2020 2020 2027 5357 4952 3127  \..      'SWIR1'
-0000ee40: 3a20 696d 672e 7365 6c65 6374 2827 7377  : img.select('sw
-0000ee50: 6972 3127 295c 0d0a 2020 2020 7d29 2e72  ir1')\..    }).r
-0000ee60: 656e 616d 6528 5b27 4942 495f 4227 5d29  ename(['IBI_B'])
-0000ee70: 0d0a 0d0a 2020 6962 695f 6120 3d20 6962  ....  ibi_a = ib
-0000ee80: 695f 612e 6164 6442 616e 6473 2869 6269  i_a.addBands(ibi
-0000ee90: 5f62 290d 0a20 2069 6269 203d 2069 6269  _b)..  ibi = ibi
-0000eea0: 5f61 2e6e 6f72 6d61 6c69 7a65 6444 6966  _a.normalizedDif
-0000eeb0: 6665 7265 6e63 6528 5b27 4942 495f 4127  ference(['IBI_A'
-0000eec0: 2c27 4942 495f 4227 5d29 0d0a 2020 696d  ,'IBI_B'])..  im
-0000eed0: 6720 3d20 696d 672e 6164 6442 616e 6473  g = img.addBands
-0000eee0: 2869 6269 2e72 656e 616d 6528 5b27 4942  (ibi.rename(['IB
-0000eef0: 4927 5d29 290d 0a0d 0a20 2072 6574 7572  I']))....  retur
-0000ef00: 6e20 696d 670d 0a23 2323 2323 2323 2323  n img..#########
+0000e2b0: 2323 2323 2323 2323 2323 230d 0a23 4675  ###########..#Fu
+0000e2c0: 6e63 7469 6f6e 2074 6f20 6164 6420 636f  nction to add co
+0000e2d0: 6d6d 6f6e 2028 616e 6420 6c65 7373 2063  mmon (and less c
+0000e2e0: 6f6d 6d6f 6e29 2073 7065 6374 7261 6c20  ommon) spectral 
+0000e2f0: 696e 6469 6365 7320 746f 2061 6e20 696d  indices to an im
+0000e300: 6167 652e 0d0a 2349 6e63 6c75 6465 7320  age...#Includes 
+0000e310: 7468 6520 4e6f 726d 616c 697a 6564 2044  the Normalized D
+0000e320: 6966 6665 7265 6e63 6520 5370 6563 7472  ifference Spectr
+0000e330: 616c 2056 6563 746f 7220 6672 6f6d 2028  al Vector from (
+0000e340: 416e 6769 756c 6920 616e 6420 5472 6961  Angiuli and Tria
+0000e350: 6e6e 692c 2032 3031 3429 0d0a 6465 6620  nni, 2014)..def 
+0000e360: 6164 6449 6e64 6963 6573 2869 6d67 293a  addIndices(img):
+0000e370: 0d0a 2020 2341 6464 204e 6f72 6d61 6c69  ..  #Add Normali
+0000e380: 7a65 6420 4469 6666 6572 656e 6365 2053  zed Difference S
+0000e390: 7065 6374 7261 6c20 5665 6374 6f72 2028  pectral Vector (
+0000e3a0: 4e44 5356 290d 0a20 2069 6d67 203d 2069  NDSV)..  img = i
+0000e3b0: 6d67 2e61 6464 4261 6e64 7328 696d 672e  mg.addBands(img.
+0000e3c0: 6e6f 726d 616c 697a 6564 4469 6666 6572  normalizedDiffer
+0000e3d0: 656e 6365 285b 2762 6c75 6527 2c27 6772  ence(['blue','gr
+0000e3e0: 6565 6e27 5d29 2e72 656e 616d 6528 5b27  een']).rename(['
+0000e3f0: 4e44 5f62 6c75 655f 6772 6565 6e27 5d29  ND_blue_green'])
+0000e400: 290d 0a20 2069 6d67 203d 2069 6d67 2e61  )..  img = img.a
+0000e410: 6464 4261 6e64 7328 696d 672e 6e6f 726d  ddBands(img.norm
+0000e420: 616c 697a 6564 4469 6666 6572 656e 6365  alizedDifference
+0000e430: 285b 2762 6c75 6527 2c27 7265 6427 5d29  (['blue','red'])
+0000e440: 2e72 656e 616d 6528 5b27 4e44 5f62 6c75  .rename(['ND_blu
+0000e450: 655f 7265 6427 5d29 290d 0a20 2069 6d67  e_red']))..  img
+0000e460: 203d 2069 6d67 2e61 6464 4261 6e64 7328   = img.addBands(
+0000e470: 696d 672e 6e6f 726d 616c 697a 6564 4469  img.normalizedDi
+0000e480: 6666 6572 656e 6365 285b 2762 6c75 6527  fference(['blue'
+0000e490: 2c27 6e69 7227 5d29 2e72 656e 616d 6528  ,'nir']).rename(
+0000e4a0: 5b27 4e44 5f62 6c75 655f 6e69 7227 5d29  ['ND_blue_nir'])
+0000e4b0: 290d 0a20 2069 6d67 203d 2069 6d67 2e61  )..  img = img.a
+0000e4c0: 6464 4261 6e64 7328 696d 672e 6e6f 726d  ddBands(img.norm
+0000e4d0: 616c 697a 6564 4469 6666 6572 656e 6365  alizedDifference
+0000e4e0: 285b 2762 6c75 6527 2c27 7377 6972 3127  (['blue','swir1'
+0000e4f0: 5d29 2e72 656e 616d 6528 5b27 4e44 5f62  ]).rename(['ND_b
+0000e500: 6c75 655f 7377 6972 3127 5d29 290d 0a20  lue_swir1'])).. 
+0000e510: 2069 6d67 203d 2069 6d67 2e61 6464 4261   img = img.addBa
+0000e520: 6e64 7328 696d 672e 6e6f 726d 616c 697a  nds(img.normaliz
+0000e530: 6564 4469 6666 6572 656e 6365 285b 2762  edDifference(['b
+0000e540: 6c75 6527 2c27 7377 6972 3227 5d29 2e72  lue','swir2']).r
+0000e550: 656e 616d 6528 5b27 4e44 5f62 6c75 655f  ename(['ND_blue_
+0000e560: 7377 6972 3227 5d29 290d 0a0d 0a20 2069  swir2']))....  i
+0000e570: 6d67 203d 2069 6d67 2e61 6464 4261 6e64  mg = img.addBand
+0000e580: 7328 696d 672e 6e6f 726d 616c 697a 6564  s(img.normalized
+0000e590: 4469 6666 6572 656e 6365 285b 2767 7265  Difference(['gre
+0000e5a0: 656e 272c 2772 6564 275d 292e 7265 6e61  en','red']).rena
+0000e5b0: 6d65 285b 274e 445f 6772 6565 6e5f 7265  me(['ND_green_re
+0000e5c0: 6427 5d29 290d 0a20 2069 6d67 203d 2069  d']))..  img = i
+0000e5d0: 6d67 2e61 6464 4261 6e64 7328 696d 672e  mg.addBands(img.
+0000e5e0: 6e6f 726d 616c 697a 6564 4469 6666 6572  normalizedDiffer
+0000e5f0: 656e 6365 285b 2767 7265 656e 272c 276e  ence(['green','n
+0000e600: 6972 275d 292e 7265 6e61 6d65 285b 274e  ir']).rename(['N
+0000e610: 445f 6772 6565 6e5f 6e69 7227 5d29 2923  D_green_nir']))#
+0000e620: 4e44 5742 490d 0a20 2069 6d67 203d 2069  NDWBI..  img = i
+0000e630: 6d67 2e61 6464 4261 6e64 7328 696d 672e  mg.addBands(img.
+0000e640: 6e6f 726d 616c 697a 6564 4469 6666 6572  normalizedDiffer
+0000e650: 656e 6365 285b 2767 7265 656e 272c 2773  ence(['green','s
+0000e660: 7769 7231 275d 292e 7265 6e61 6d65 285b  wir1']).rename([
+0000e670: 274e 445f 6772 6565 6e5f 7377 6972 3127  'ND_green_swir1'
+0000e680: 5d29 2923 4e44 5349 2c20 4d4e 4457 490d  ]))#NDSI, MNDWI.
+0000e690: 0a20 2069 6d67 203d 2069 6d67 2e61 6464  .  img = img.add
+0000e6a0: 4261 6e64 7328 696d 672e 6e6f 726d 616c  Bands(img.normal
+0000e6b0: 697a 6564 4469 6666 6572 656e 6365 285b  izedDifference([
+0000e6c0: 2767 7265 656e 272c 2773 7769 7232 275d  'green','swir2']
+0000e6d0: 292e 7265 6e61 6d65 285b 274e 445f 6772  ).rename(['ND_gr
+0000e6e0: 6565 6e5f 7377 6972 3227 5d29 290d 0a0d  een_swir2']))...
+0000e6f0: 0a20 2069 6d67 203d 2069 6d67 2e61 6464  .  img = img.add
+0000e700: 4261 6e64 7328 696d 672e 6e6f 726d 616c  Bands(img.normal
+0000e710: 697a 6564 4469 6666 6572 656e 6365 285b  izedDifference([
+0000e720: 2772 6564 272c 2773 7769 7231 275d 292e  'red','swir1']).
+0000e730: 7265 6e61 6d65 285b 274e 445f 7265 645f  rename(['ND_red_
+0000e740: 7377 6972 3127 5d29 290d 0a20 2069 6d67  swir1']))..  img
+0000e750: 203d 2069 6d67 2e61 6464 4261 6e64 7328   = img.addBands(
+0000e760: 696d 672e 6e6f 726d 616c 697a 6564 4469  img.normalizedDi
+0000e770: 6666 6572 656e 6365 285b 2772 6564 272c  fference(['red',
+0000e780: 2773 7769 7232 275d 292e 7265 6e61 6d65  'swir2']).rename
+0000e790: 285b 274e 445f 7265 645f 7377 6972 3227  (['ND_red_swir2'
+0000e7a0: 5d29 290d 0a0d 0a0d 0a20 2069 6d67 203d  ]))......  img =
+0000e7b0: 2069 6d67 2e61 6464 4261 6e64 7328 696d   img.addBands(im
+0000e7c0: 672e 6e6f 726d 616c 697a 6564 4469 6666  g.normalizedDiff
+0000e7d0: 6572 656e 6365 285b 276e 6972 272c 2772  erence(['nir','r
+0000e7e0: 6564 275d 292e 7265 6e61 6d65 285b 274e  ed']).rename(['N
+0000e7f0: 445f 6e69 725f 7265 6427 5d29 2923 4e44  D_nir_red']))#ND
+0000e800: 5649 0d0a 2020 696d 6720 3d20 696d 672e  VI..  img = img.
+0000e810: 6164 6442 616e 6473 2869 6d67 2e6e 6f72  addBands(img.nor
+0000e820: 6d61 6c69 7a65 6444 6966 6665 7265 6e63  malizedDifferenc
+0000e830: 6528 5b27 6e69 7227 2c27 7377 6972 3127  e(['nir','swir1'
+0000e840: 5d29 2e72 656e 616d 6528 5b27 4e44 5f6e  ]).rename(['ND_n
+0000e850: 6972 5f73 7769 7231 275d 2929 234e 4457  ir_swir1']))#NDW
+0000e860: 492c 204c 5357 492c 202d 4e44 4249 0d0a  I, LSWI, -NDBI..
+0000e870: 2020 696d 6720 3d20 696d 672e 6164 6442    img = img.addB
+0000e880: 616e 6473 2869 6d67 2e6e 6f72 6d61 6c69  ands(img.normali
+0000e890: 7a65 6444 6966 6665 7265 6e63 6528 5b27  zedDifference(['
+0000e8a0: 6e69 7227 2c27 7377 6972 3227 5d29 2e72  nir','swir2']).r
+0000e8b0: 656e 616d 6528 5b27 4e44 5f6e 6972 5f73  ename(['ND_nir_s
+0000e8c0: 7769 7232 275d 2929 234e 4252 2c20 4d4e  wir2']))#NBR, MN
+0000e8d0: 4456 490d 0a0d 0a20 2069 6d67 203d 2069  DVI....  img = i
+0000e8e0: 6d67 2e61 6464 4261 6e64 7328 696d 672e  mg.addBands(img.
+0000e8f0: 6e6f 726d 616c 697a 6564 4469 6666 6572  normalizedDiffer
+0000e900: 656e 6365 285b 2773 7769 7231 272c 2773  ence(['swir1','s
+0000e910: 7769 7232 275d 292e 7265 6e61 6d65 285b  wir2']).rename([
+0000e920: 274e 445f 7377 6972 315f 7377 6972 3227  'ND_swir1_swir2'
+0000e930: 5d29 293b 0d0a 0d0a 2020 2341 6464 2072  ]));....  #Add r
+0000e940: 6174 696f 730d 0a20 2069 6d67 203d 2069  atios..  img = i
+0000e950: 6d67 2e61 6464 4261 6e64 7328 696d 672e  mg.addBands(img.
+0000e960: 7365 6c65 6374 2827 7377 6972 3127 292e  select('swir1').
+0000e970: 6469 7669 6465 2869 6d67 2e73 656c 6563  divide(img.selec
+0000e980: 7428 276e 6972 2729 292e 7265 6e61 6d65  t('nir')).rename
+0000e990: 285b 2752 5f73 7769 7231 5f6e 6972 275d  (['R_swir1_nir']
+0000e9a0: 2929 2372 6174 696f 2035 2f34 0d0a 2020  ))#ratio 5/4..  
+0000e9b0: 696d 6720 3d20 696d 672e 6164 6442 616e  img = img.addBan
+0000e9c0: 6473 2869 6d67 2e73 656c 6563 7428 2772  ds(img.select('r
+0000e9d0: 6564 2729 2e64 6976 6964 6528 696d 672e  ed').divide(img.
+0000e9e0: 7365 6c65 6374 2827 7377 6972 3127 2929  select('swir1'))
+0000e9f0: 2e72 656e 616d 6528 5b27 525f 7265 645f  .rename(['R_red_
+0000ea00: 7377 6972 3127 5d29 2923 7261 7469 6f20  swir1']))#ratio 
+0000ea10: 332f 350d 0a0d 0a20 2023 4164 6420 456e  3/5....  #Add En
+0000ea20: 6861 6e63 6564 2056 6567 6574 6174 696f  hanced Vegetatio
+0000ea30: 6e20 496e 6465 7820 2845 5649 290d 0a20  n Index (EVI).. 
+0000ea40: 2065 7669 203d 2069 6d67 2e65 7870 7265   evi = img.expre
+0000ea50: 7373 696f 6e28 5c0d 0a20 2020 2027 322e  ssion(\..    '2.
+0000ea60: 3520 2a20 2828 4e49 5220 2d20 5245 4429  5 * ((NIR - RED)
+0000ea70: 202f 2028 4e49 5220 2b20 3620 2a20 5245   / (NIR + 6 * RE
+0000ea80: 4420 2d20 372e 3520 2a20 424c 5545 202b  D - 7.5 * BLUE +
+0000ea90: 2031 2929 272c 207b 5c0d 0a20 2020 2020   1))', {\..     
+0000eaa0: 2027 4e49 5227 3a20 696d 672e 7365 6c65   'NIR': img.sele
+0000eab0: 6374 2827 6e69 7227 292c 5c0d 0a20 2020  ct('nir'),\..   
+0000eac0: 2020 2027 5245 4427 3a20 696d 672e 7365     'RED': img.se
+0000ead0: 6c65 6374 2827 7265 6427 292c 5c0d 0a20  lect('red'),\.. 
+0000eae0: 2020 2020 2027 424c 5545 273a 2069 6d67       'BLUE': img
+0000eaf0: 2e73 656c 6563 7428 2762 6c75 6527 295c  .select('blue')\
+0000eb00: 0d0a 2020 7d29 2e66 6c6f 6174 2829 0d0a  ..  }).float()..
+0000eb10: 2020 696d 6720 3d20 696d 672e 6164 6442    img = img.addB
+0000eb20: 616e 6473 2865 7669 2e72 656e 616d 6528  ands(evi.rename(
+0000eb30: 2745 5649 2729 290d 0a0d 0a20 2023 4164  'EVI'))....  #Ad
+0000eb40: 6420 536f 696c 2041 646a 7573 7420 5665  d Soil Adjust Ve
+0000eb50: 6765 7461 7469 6f6e 2049 6e64 6578 2028  getation Index (
+0000eb60: 5341 5649 290d 0a20 2023 7573 696e 6720  SAVI)..  #using 
+0000eb70: 4c20 3d20 302e 353b 0d0a 2020 7361 7669  L = 0.5;..  savi
+0000eb80: 203d 2069 6d67 2e65 7870 7265 7373 696f   = img.expressio
+0000eb90: 6e28 5c0d 0a20 2020 2027 284e 4952 202d  n(\..    '(NIR -
+0000eba0: 2052 4544 2920 2a20 2831 202b 2030 2e35   RED) * (1 + 0.5
+0000ebb0: 292f 284e 4952 202b 2052 4544 202b 2030  )/(NIR + RED + 0
+0000ebc0: 2e35 2927 2c20 7b5c 0d0a 2020 2020 2020  .5)', {\..      
+0000ebd0: 274e 4952 273a 2069 6d67 2e73 656c 6563  'NIR': img.selec
+0000ebe0: 7428 276e 6972 2729 2c5c 0d0a 2020 2020  t('nir'),\..    
+0000ebf0: 2020 2752 4544 273a 2069 6d67 2e73 656c    'RED': img.sel
+0000ec00: 6563 7428 2772 6564 2729 5c0d 0a20 207d  ect('red')\..  }
+0000ec10: 292e 666c 6f61 7428 290d 0a20 2069 6d67  ).float()..  img
+0000ec20: 203d 2069 6d67 2e61 6464 4261 6e64 7328   = img.addBands(
+0000ec30: 7361 7669 2e72 656e 616d 6528 5b27 5341  savi.rename(['SA
+0000ec40: 5649 275d 2929 0d0a 0d0a 2020 2341 6464  VI']))....  #Add
+0000ec50: 2049 6e64 6578 2d42 6173 6564 2042 7569   Index-Based Bui
+0000ec60: 6c74 2d55 7020 496e 6465 7820 2849 4249  lt-Up Index (IBI
+0000ec70: 290d 0a20 2069 6269 5f61 203d 2069 6d67  )..  ibi_a = img
+0000ec80: 2e65 7870 7265 7373 696f 6e28 5c0d 0a20  .expression(\.. 
+0000ec90: 2020 2027 322a 5357 4952 312f 2853 5749     '2*SWIR1/(SWI
+0000eca0: 5231 202b 204e 4952 2927 2c20 7b5c 0d0a  R1 + NIR)', {\..
+0000ecb0: 2020 2020 2020 2753 5749 5231 273a 2069        'SWIR1': i
+0000ecc0: 6d67 2e73 656c 6563 7428 2773 7769 7231  mg.select('swir1
+0000ecd0: 2729 2c5c 0d0a 2020 2020 2020 274e 4952  '),\..      'NIR
+0000ece0: 273a 2069 6d67 2e73 656c 6563 7428 276e  ': img.select('n
+0000ecf0: 6972 2729 5c0d 0a20 2020 207d 292e 7265  ir')\..    }).re
+0000ed00: 6e61 6d65 285b 2749 4249 5f41 275d 290d  name(['IBI_A']).
+0000ed10: 0a0d 0a20 2069 6269 5f62 203d 2069 6d67  ...  ibi_b = img
+0000ed20: 2e65 7870 7265 7373 696f 6e28 5c0d 0a20  .expression(\.. 
+0000ed30: 2020 2027 284e 4952 2f28 4e49 5220 2b20     '(NIR/(NIR + 
+0000ed40: 5245 4429 2920 2b20 2847 5245 454e 2f28  RED)) + (GREEN/(
+0000ed50: 4752 4545 4e20 2b20 5357 4952 3129 2927  GREEN + SWIR1))'
+0000ed60: 2c20 7b5c 0d0a 2020 2020 2020 274e 4952  , {\..      'NIR
+0000ed70: 273a 2069 6d67 2e73 656c 6563 7428 276e  ': img.select('n
+0000ed80: 6972 2729 2c5c 0d0a 2020 2020 2020 2752  ir'),\..      'R
+0000ed90: 4544 273a 2069 6d67 2e73 656c 6563 7428  ED': img.select(
+0000eda0: 2772 6564 2729 2c5c 0d0a 2020 2020 2020  'red'),\..      
+0000edb0: 2747 5245 454e 273a 2069 6d67 2e73 656c  'GREEN': img.sel
+0000edc0: 6563 7428 2767 7265 656e 2729 2c5c 0d0a  ect('green'),\..
+0000edd0: 2020 2020 2020 2753 5749 5231 273a 2069        'SWIR1': i
+0000ede0: 6d67 2e73 656c 6563 7428 2773 7769 7231  mg.select('swir1
+0000edf0: 2729 5c0d 0a20 2020 207d 292e 7265 6e61  ')\..    }).rena
+0000ee00: 6d65 285b 2749 4249 5f42 275d 290d 0a0d  me(['IBI_B'])...
+0000ee10: 0a20 2069 6269 5f61 203d 2069 6269 5f61  .  ibi_a = ibi_a
+0000ee20: 2e61 6464 4261 6e64 7328 6962 695f 6229  .addBands(ibi_b)
+0000ee30: 0d0a 2020 6962 6920 3d20 6962 695f 612e  ..  ibi = ibi_a.
+0000ee40: 6e6f 726d 616c 697a 6564 4469 6666 6572  normalizedDiffer
+0000ee50: 656e 6365 285b 2749 4249 5f41 272c 2749  ence(['IBI_A','I
+0000ee60: 4249 5f42 275d 290d 0a20 2069 6d67 203d  BI_B'])..  img =
+0000ee70: 2069 6d67 2e61 6464 4261 6e64 7328 6962   img.addBands(ib
+0000ee80: 692e 7265 6e61 6d65 285b 2749 4249 275d  i.rename(['IBI']
+0000ee90: 2929 0d0a 0d0a 2020 7265 7475 726e 2069  ))....  return i
+0000eea0: 6d67 0d0a 2323 2323 2323 2323 2323 2323  mg..############
+0000eeb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000eec0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000eed0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000eee0: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
+0000eef0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000ef00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000ef10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000ef20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000ef30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000ef40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000ef50: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
-0000ef60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000ef70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000ef80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000ef90: 2323 2323 2323 2323 2323 230d 0a23 4675  ###########..#Fu
-0000efa0: 6e63 7469 6f6e 2074 6f20 2061 6464 2053  nction to  add S
-0000efb0: 4156 4920 616e 6420 4556 490d 0a64 6566  AVI and EVI..def
-0000efc0: 2061 6464 5341 5649 616e 6445 5649 2869   addSAVIandEVI(i
-0000efd0: 6d67 293a 0d0a 2020 2341 6464 2045 6e68  mg):..  #Add Enh
-0000efe0: 616e 6365 6420 5665 6765 7461 7469 6f6e  anced Vegetation
-0000eff0: 2049 6e64 6578 2028 4556 4929 0d0a 2020   Index (EVI)..  
-0000f000: 6576 6920 3d20 696d 672e 6578 7072 6573  evi = img.expres
-0000f010: 7369 6f6e 285c 0d0a 2020 2020 2732 2e35  sion(\..    '2.5
-0000f020: 202a 2028 284e 4952 202d 2052 4544 2920   * ((NIR - RED) 
-0000f030: 2f20 284e 4952 202b 2036 202a 2052 4544  / (NIR + 6 * RED
-0000f040: 202d 2037 2e35 202a 2042 4c55 4520 2b20   - 7.5 * BLUE + 
-0000f050: 3129 2927 2c20 7b5c 0d0a 2020 2020 2020  1))', {\..      
-0000f060: 274e 4952 273a 2069 6d67 2e73 656c 6563  'NIR': img.selec
-0000f070: 7428 276e 6972 2729 2c5c 0d0a 2020 2020  t('nir'),\..    
-0000f080: 2020 2752 4544 273a 2069 6d67 2e73 656c    'RED': img.sel
-0000f090: 6563 7428 2772 6564 2729 2c5c 0d0a 2020  ect('red'),\..  
-0000f0a0: 2020 2020 2742 4c55 4527 3a20 696d 672e      'BLUE': img.
-0000f0b0: 7365 6c65 6374 2827 626c 7565 2729 5c0d  select('blue')\.
-0000f0c0: 0a20 207d 292e 666c 6f61 7428 290d 0a20  .  }).float().. 
-0000f0d0: 2069 6d67 203d 2069 6d67 2e61 6464 4261   img = img.addBa
-0000f0e0: 6e64 7328 6576 692e 7265 6e61 6d65 285b  nds(evi.rename([
-0000f0f0: 2745 5649 275d 2929 0d0a 0d0a 2020 2341  'EVI']))....  #A
-0000f100: 6464 2053 6f69 6c20 4164 6a75 7374 2056  dd Soil Adjust V
-0000f110: 6567 6574 6174 696f 6e20 496e 6465 7820  egetation Index 
-0000f120: 2853 4156 4929 0d0a 2020 2375 7369 6e67  (SAVI)..  #using
-0000f130: 204c 203d 2030 2e35 0d0a 2020 7361 7669   L = 0.5..  savi
-0000f140: 203d 2069 6d67 2e65 7870 7265 7373 696f   = img.expressio
-0000f150: 6e28 5c0d 0a20 2020 2027 284e 4952 202d  n(\..    '(NIR -
-0000f160: 2052 4544 2920 2a20 2831 202b 2030 2e35   RED) * (1 + 0.5
-0000f170: 292f 284e 4952 202b 2052 4544 202b 2030  )/(NIR + RED + 0
-0000f180: 2e35 2927 2c20 7b5c 0d0a 2020 2020 2020  .5)', {\..      
-0000f190: 274e 4952 273a 2069 6d67 2e73 656c 6563  'NIR': img.selec
-0000f1a0: 7428 276e 6972 2729 2c5c 0d0a 2020 2020  t('nir'),\..    
-0000f1b0: 2020 2752 4544 273a 2069 6d67 2e73 656c    'RED': img.sel
-0000f1c0: 6563 7428 2772 6564 2729 5c0d 0a20 207d  ect('red')\..  }
-0000f1d0: 292e 666c 6f61 7428 290d 0a0d 0a0d 0a20  ).float()...... 
-0000f1e0: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-0000f1f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f200: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f210: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f220: 2323 2323 2323 2323 2323 0d0a 2020 234e  ##########..  #N
-0000f230: 4952 763a 2042 6164 676c 6579 2c20 472e  IRv: Badgley, G.
-0000f240: 2c20 4669 656c 642c 2043 2e20 422e 2c20  , Field, C. B., 
-0000f250: 2620 4265 7272 792c 204a 2e20 412e 2028  & Berry, J. A. (
-0000f260: 3230 3137 292e 2043 616e 6f70 7920 6e65  2017). Canopy ne
-0000f270: 6172 2d69 6e66 7261 7265 6420 7265 666c  ar-infrared refl
-0000f280: 6563 7461 6e63 6520 616e 6420 7465 7272  ectance and terr
-0000f290: 6573 7472 6961 6c20 7068 6f74 6f73 796e  estrial photosyn
-0000f2a0: 7468 6573 6973 2e20 5363 6965 6e63 6520  thesis. Science 
-0000f2b0: 4164 7661 6e63 6573 2c20 332c 2065 3136  Advances, 3, e16
-0000f2c0: 3032 3234 342e 0d0a 2020 2368 7474 7073  02244...  #https
-0000f2d0: 3a2f 2f77 7777 2e72 6573 6561 7263 6867  ://www.researchg
-0000f2e0: 6174 652e 6e65 742f 7075 626c 6963 6174  ate.net/publicat
-0000f2f0: 696f 6e2f 3331 3535 3334 3130 375f 4361  ion/315534107_Ca
-0000f300: 6e6f 7079 5f6e 6561 722d 696e 6672 6172  nopy_near-infrar
-0000f310: 6564 5f72 6566 6c65 6374 616e 6365 5f61  ed_reflectance_a
-0000f320: 6e64 5f74 6572 7265 7374 7269 616c 5f70  nd_terrestrial_p
-0000f330: 686f 746f 7379 6e74 6865 7369 730d 0a20  hotosynthesis.. 
-0000f340: 2023 4e49 5276 2066 756e 6374 696f 6e3a   #NIRv function:
-0000f350: 2027 696d 6167 6527 2069 7320 6120 3220   'image' is a 2 
-0000f360: 6261 6e64 2073 7461 636b 206f 6620 4e44  band stack of ND
-0000f370: 5649 2061 6e64 204e 4952 0d0a 2020 2323  VI and NIR..  ##
-0000f380: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f390: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f3a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f3b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f3c0: 2323 2323 2323 230d 0a20 204e 4952 7620  #######..  NIRv 
-0000f3d0: 3d20 2069 6d67 2e73 656c 6563 7428 5b27  =  img.select(['
-0000f3e0: 4e44 5649 275d 292e 7375 6274 7261 6374  NDVI']).subtract
-0000f3f0: 2830 2e30 3829 2e6d 756c 7469 706c 7928  (0.08).multiply(
-0000f400: 696d 672e 7365 6c65 6374 285b 276e 6972  img.select(['nir
-0000f410: 275d 2929 232e 6d75 6c74 6970 6c79 2830  ']))#.multiply(0
-0000f420: 2e30 3030 3129 290d 0a0d 0a20 2069 6d67  .0001))....  img
-0000f430: 203d 2069 6d67 2e61 6464 4261 6e64 7328   = img.addBands(
-0000f440: 7361 7669 2e72 656e 616d 6528 5b27 5341  savi.rename(['SA
-0000f450: 5649 275d 2929 2e61 6464 4261 6e64 7328  VI'])).addBands(
-0000f460: 4e49 5276 2e72 656e 616d 6528 5b27 4e49  NIRv.rename(['NI
-0000f470: 5276 275d 2929 0d0a 2020 7265 7475 726e  Rv']))..  return
-0000f480: 2069 6d67 0d0a 0d0a 2323 2323 2323 2323   img....########
+0000ef30: 2323 2323 2323 2323 0d0a 2346 756e 6374  ########..#Funct
+0000ef40: 696f 6e20 746f 2020 6164 6420 5341 5649  ion to  add SAVI
+0000ef50: 2061 6e64 2045 5649 0d0a 6465 6620 6164   and EVI..def ad
+0000ef60: 6453 4156 4961 6e64 4556 4928 696d 6729  dSAVIandEVI(img)
+0000ef70: 3a0d 0a20 2023 4164 6420 456e 6861 6e63  :..  #Add Enhanc
+0000ef80: 6564 2056 6567 6574 6174 696f 6e20 496e  ed Vegetation In
+0000ef90: 6465 7820 2845 5649 290d 0a20 2065 7669  dex (EVI)..  evi
+0000efa0: 203d 2069 6d67 2e65 7870 7265 7373 696f   = img.expressio
+0000efb0: 6e28 5c0d 0a20 2020 2027 322e 3520 2a20  n(\..    '2.5 * 
+0000efc0: 2828 4e49 5220 2d20 5245 4429 202f 2028  ((NIR - RED) / (
+0000efd0: 4e49 5220 2b20 3620 2a20 5245 4420 2d20  NIR + 6 * RED - 
+0000efe0: 372e 3520 2a20 424c 5545 202b 2031 2929  7.5 * BLUE + 1))
+0000eff0: 272c 207b 5c0d 0a20 2020 2020 2027 4e49  ', {\..      'NI
+0000f000: 5227 3a20 696d 672e 7365 6c65 6374 2827  R': img.select('
+0000f010: 6e69 7227 292c 5c0d 0a20 2020 2020 2027  nir'),\..      '
+0000f020: 5245 4427 3a20 696d 672e 7365 6c65 6374  RED': img.select
+0000f030: 2827 7265 6427 292c 5c0d 0a20 2020 2020  ('red'),\..     
+0000f040: 2027 424c 5545 273a 2069 6d67 2e73 656c   'BLUE': img.sel
+0000f050: 6563 7428 2762 6c75 6527 295c 0d0a 2020  ect('blue')\..  
+0000f060: 7d29 2e66 6c6f 6174 2829 0d0a 2020 696d  }).float()..  im
+0000f070: 6720 3d20 696d 672e 6164 6442 616e 6473  g = img.addBands
+0000f080: 2865 7669 2e72 656e 616d 6528 5b27 4556  (evi.rename(['EV
+0000f090: 4927 5d29 290d 0a0d 0a20 2023 4164 6420  I']))....  #Add 
+0000f0a0: 536f 696c 2041 646a 7573 7420 5665 6765  Soil Adjust Vege
+0000f0b0: 7461 7469 6f6e 2049 6e64 6578 2028 5341  tation Index (SA
+0000f0c0: 5649 290d 0a20 2023 7573 696e 6720 4c20  VI)..  #using L 
+0000f0d0: 3d20 302e 350d 0a20 2073 6176 6920 3d20  = 0.5..  savi = 
+0000f0e0: 696d 672e 6578 7072 6573 7369 6f6e 285c  img.expression(\
+0000f0f0: 0d0a 2020 2020 2728 4e49 5220 2d20 5245  ..    '(NIR - RE
+0000f100: 4429 202a 2028 3120 2b20 302e 3529 2f28  D) * (1 + 0.5)/(
+0000f110: 4e49 5220 2b20 5245 4420 2b20 302e 3529  NIR + RED + 0.5)
+0000f120: 272c 207b 5c0d 0a20 2020 2020 2027 4e49  ', {\..      'NI
+0000f130: 5227 3a20 696d 672e 7365 6c65 6374 2827  R': img.select('
+0000f140: 6e69 7227 292c 5c0d 0a20 2020 2020 2027  nir'),\..      '
+0000f150: 5245 4427 3a20 696d 672e 7365 6c65 6374  RED': img.select
+0000f160: 2827 7265 6427 295c 0d0a 2020 7d29 2e66  ('red')\..  }).f
+0000f170: 6c6f 6174 2829 0d0a 0d0a 0d0a 2020 2323  loat()......  ##
+0000f180: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f190: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f1a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f1b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f1c0: 2323 2323 2323 230d 0a20 2023 4e49 5276  #######..  #NIRv
+0000f1d0: 3a20 4261 6467 6c65 792c 2047 2e2c 2046  : Badgley, G., F
+0000f1e0: 6965 6c64 2c20 432e 2042 2e2c 2026 2042  ield, C. B., & B
+0000f1f0: 6572 7279 2c20 4a2e 2041 2e20 2832 3031  erry, J. A. (201
+0000f200: 3729 2e20 4361 6e6f 7079 206e 6561 722d  7). Canopy near-
+0000f210: 696e 6672 6172 6564 2072 6566 6c65 6374  infrared reflect
+0000f220: 616e 6365 2061 6e64 2074 6572 7265 7374  ance and terrest
+0000f230: 7269 616c 2070 686f 746f 7379 6e74 6865  rial photosynthe
+0000f240: 7369 732e 2053 6369 656e 6365 2041 6476  sis. Science Adv
+0000f250: 616e 6365 732c 2033 2c20 6531 3630 3232  ances, 3, e16022
+0000f260: 3434 2e0d 0a20 2023 6874 7470 733a 2f2f  44...  #https://
+0000f270: 7777 772e 7265 7365 6172 6368 6761 7465  www.researchgate
+0000f280: 2e6e 6574 2f70 7562 6c69 6361 7469 6f6e  .net/publication
+0000f290: 2f33 3135 3533 3431 3037 5f43 616e 6f70  /315534107_Canop
+0000f2a0: 795f 6e65 6172 2d69 6e66 7261 7265 645f  y_near-infrared_
+0000f2b0: 7265 666c 6563 7461 6e63 655f 616e 645f  reflectance_and_
+0000f2c0: 7465 7272 6573 7472 6961 6c5f 7068 6f74  terrestrial_phot
+0000f2d0: 6f73 796e 7468 6573 6973 0d0a 2020 234e  osynthesis..  #N
+0000f2e0: 4952 7620 6675 6e63 7469 6f6e 3a20 2769  IRv function: 'i
+0000f2f0: 6d61 6765 2720 6973 2061 2032 2062 616e  mage' is a 2 ban
+0000f300: 6420 7374 6163 6b20 6f66 204e 4456 4920  d stack of NDVI 
+0000f310: 616e 6420 4e49 520d 0a20 2023 2323 2323  and NIR..  #####
+0000f320: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f330: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f340: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f350: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f360: 2323 2323 0d0a 2020 4e49 5276 203d 2020  ####..  NIRv =  
+0000f370: 696d 672e 7365 6c65 6374 285b 274e 4456  img.select(['NDV
+0000f380: 4927 5d29 2e73 7562 7472 6163 7428 302e  I']).subtract(0.
+0000f390: 3038 292e 6d75 6c74 6970 6c79 2869 6d67  08).multiply(img
+0000f3a0: 2e73 656c 6563 7428 5b27 6e69 7227 5d29  .select(['nir'])
+0000f3b0: 2923 2e6d 756c 7469 706c 7928 302e 3030  )#.multiply(0.00
+0000f3c0: 3031 2929 0d0a 0d0a 2020 696d 6720 3d20  01))....  img = 
+0000f3d0: 696d 672e 6164 6442 616e 6473 2873 6176  img.addBands(sav
+0000f3e0: 692e 7265 6e61 6d65 285b 2753 4156 4927  i.rename(['SAVI'
+0000f3f0: 5d29 292e 6164 6442 616e 6473 284e 4952  ])).addBands(NIR
+0000f400: 762e 7265 6e61 6d65 285b 274e 4952 7627  v.rename(['NIRv'
+0000f410: 5d29 290d 0a20 2072 6574 7572 6e20 696d  ]))..  return im
+0000f420: 670d 0a0d 0a23 2323 2323 2323 2323 2323  g....###########
+0000f430: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f440: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f450: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f460: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
+0000f470: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f480: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000f490: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f4a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f4b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f4c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f4d0: 230d 0a23 2323 2323 2323 2323 2323 2323  #..#############
-0000f4e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f4f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f500: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f510: 2323 0d0a 2341 7070 6c79 2062 6c6f 6f6d  ##..#Apply bloom
-0000f520: 2064 6574 6563 7469 6f6e 2061 6c67 6f72   detection algor
-0000f530: 6974 686d 0d0a 6465 6620 486f 4361 6c63  ithm..def HoCalc
-0000f540: 416c 676f 7269 7468 6d32 2869 6d61 6765  Algorithm2(image
-0000f550: 293a 0d0a 2020 2320 416c 676f 7269 7468  ):..  # Algorith
-0000f560: 6d20 3220 6261 7365 6420 6f6e 3a0d 0a20  m 2 based on:.. 
-0000f570: 2023 204d 6174 7468 6577 732c 204d 2e20   # Matthews, M. 
-0000f580: 2832 3031 3129 2041 2063 7572 7265 6e74  (2011) A current
-0000f590: 2072 6576 6965 7720 6f66 2065 6d70 6972   review of empir
-0000f5a0: 6963 616c 2070 726f 6365 6475 7265 730d  ical procedures.
-0000f5b0: 0a20 2023 2020 6f66 2072 656d 6f74 6520  .  #  of remote 
-0000f5c0: 7365 6e73 696e 6720 696e 2069 6e6c 616e  sensing in inlan
-0000f5d0: 6420 616e 6420 6e65 6172 2d63 6f61 7374  d and near-coast
-0000f5e0: 616c 2074 7261 6e73 6974 696f 6e61 6c0d  al transitional.
-0000f5f0: 0a20 2023 2020 7761 7465 7273 2c20 496e  .  #  waters, In
-0000f600: 7465 726e 6174 696f 6e61 6c20 4a6f 7572  ternational Jour
-0000f610: 6e61 6c20 6f66 2052 656d 6f74 6520 5365  nal of Remote Se
-0000f620: 6e73 696e 672c 2033 323a 3231 2c0d 0a20  nsing, 32:21,.. 
-0000f630: 2023 2020 3638 3535 2d36 3839 392c 2044   #  6855-6899, D
-0000f640: 4f49 3a20 3130 2e31 3038 302f 3031 3433  OI: 10.1080/0143
-0000f650: 3131 3631 2e32 3031 302e 3531 3239 3437  1161.2010.512947
-0000f660: 0d0a 0d0a 2020 2320 4170 706c 7920 616c  ....  # Apply al
-0000f670: 676f 7269 7468 6d20 323a 2042 322f 4231  gorithm 2: B2/B1
-0000f680: 0d0a 2020 626c 6f6f 6d32 203d 2069 6d61  ..  bloom2 = ima
-0000f690: 6765 2e73 656c 6563 7428 2767 7265 656e  ge.select('green
-0000f6a0: 2729 5c0d 0a20 2020 2020 2020 2020 2020  ')\..           
-0000f6b0: 2020 202e 6469 7669 6465 2869 6d61 6765     .divide(image
-0000f6c0: 2e73 656c 6563 7428 2762 6c75 6527 2929  .select('blue'))
-0000f6d0: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
-0000f6e0: 202e 7265 6e61 6d65 285b 2762 6c6f 6f6d   .rename(['bloom
-0000f6f0: 3227 5d29 0d0a 2020 6e64 6769 203d 2069  2'])..  ndgi = i
-0000f700: 6d61 6765 2e6e 6f72 6d61 6c69 7a65 6444  mage.normalizedD
-0000f710: 6966 6665 7265 6e63 6528 5b27 6772 6565  ifference(['gree
-0000f720: 6e27 2c27 626c 7565 275d 292e 7265 6e61  n','blue']).rena
-0000f730: 6d65 285b 274e 4447 4927 5d29 0d0a 2020  me(['NDGI'])..  
-0000f740: 7265 7475 726e 2069 6d61 6765 2e61 6464  return image.add
-0000f750: 4261 6e64 7328 626c 6f6f 6d32 292e 6164  Bands(bloom2).ad
-0000f760: 6442 616e 6473 286e 6467 6929 0d0a 0d0a  dBands(ndgi)....
-0000f770: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f780: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f790: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f7a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f7b0: 2323 2323 2323 2323 230d 0a23 4675 6e63  #########..#Func
-0000f7c0: 7469 6f6e 2066 6f72 206f 6e6c 7920 6164  tion for only ad
-0000f7d0: 6469 6e67 2063 6f6d 6d6f 6e20 696e 6469  ding common indi
-0000f7e0: 6365 730d 0a64 6566 2073 696d 706c 6541  ces..def simpleA
-0000f7f0: 6464 496e 6469 6365 7328 696e 5f69 6d61  ddIndices(in_ima
-0000f800: 6765 293a 0d0a 2020 696e 5f69 6d61 6765  ge):..  in_image
-0000f810: 203d 2069 6e5f 696d 6167 652e 6164 6442   = in_image.addB
-0000f820: 616e 6473 2869 6e5f 696d 6167 652e 6e6f  ands(in_image.no
-0000f830: 726d 616c 697a 6564 4469 6666 6572 656e  rmalizedDifferen
-0000f840: 6365 285b 276e 6972 272c 2027 7265 6427  ce(['nir', 'red'
-0000f850: 5d29 2e73 656c 6563 7428 5b30 5d2c 5b27  ]).select([0],['
-0000f860: 4e44 5649 275d 2929 0d0a 2020 696e 5f69  NDVI']))..  in_i
-0000f870: 6d61 6765 203d 2069 6e5f 696d 6167 652e  mage = in_image.
-0000f880: 6164 6442 616e 6473 2869 6e5f 696d 6167  addBands(in_imag
-0000f890: 652e 6e6f 726d 616c 697a 6564 4469 6666  e.normalizedDiff
-0000f8a0: 6572 656e 6365 285b 276e 6972 272c 2027  erence(['nir', '
-0000f8b0: 7377 6972 3227 5d29 2e73 656c 6563 7428  swir2']).select(
-0000f8c0: 5b30 5d2c 5b27 4e42 5227 5d29 290d 0a20  [0],['NBR'])).. 
-0000f8d0: 2069 6e5f 696d 6167 6520 3d20 696e 5f69   in_image = in_i
-0000f8e0: 6d61 6765 2e61 6464 4261 6e64 7328 696e  mage.addBands(in
-0000f8f0: 5f69 6d61 6765 2e6e 6f72 6d61 6c69 7a65  _image.normalize
-0000f900: 6444 6966 6665 7265 6e63 6528 5b27 6e69  dDifference(['ni
-0000f910: 7227 2c20 2773 7769 7231 275d 292e 7365  r', 'swir1']).se
-0000f920: 6c65 6374 285b 305d 2c5b 274e 444d 4927  lect([0],['NDMI'
-0000f930: 5d29 290d 0a20 2069 6e5f 696d 6167 6520  ]))..  in_image 
-0000f940: 3d20 696e 5f69 6d61 6765 2e61 6464 4261  = in_image.addBa
-0000f950: 6e64 7328 696e 5f69 6d61 6765 2e6e 6f72  nds(in_image.nor
-0000f960: 6d61 6c69 7a65 6444 6966 6665 7265 6e63  malizedDifferenc
-0000f970: 6528 5b27 6772 6565 6e27 2c20 2773 7769  e(['green', 'swi
-0000f980: 7231 275d 292e 7365 6c65 6374 285b 305d  r1']).select([0]
-0000f990: 2c5b 274e 4453 4927 5d29 290d 0a0d 0a20  ,['NDSI'])).... 
-0000f9a0: 2072 6574 7572 6e20 696e 5f69 6d61 6765   return in_image
-0000f9b0: 0d0a 0d0a 2323 2323 2323 2323 2323 2323  ....############
+0000f4a0: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
+0000f4b0: 0a23 4170 706c 7920 626c 6f6f 6d20 6465  .#Apply bloom de
+0000f4c0: 7465 6374 696f 6e20 616c 676f 7269 7468  tection algorith
+0000f4d0: 6d0d 0a64 6566 2048 6f43 616c 6341 6c67  m..def HoCalcAlg
+0000f4e0: 6f72 6974 686d 3228 696d 6167 6529 3a0d  orithm2(image):.
+0000f4f0: 0a20 2023 2041 6c67 6f72 6974 686d 2032  .  # Algorithm 2
+0000f500: 2062 6173 6564 206f 6e3a 0d0a 2020 2320   based on:..  # 
+0000f510: 4d61 7474 6865 7773 2c20 4d2e 2028 3230  Matthews, M. (20
+0000f520: 3131 2920 4120 6375 7272 656e 7420 7265  11) A current re
+0000f530: 7669 6577 206f 6620 656d 7069 7269 6361  view of empirica
+0000f540: 6c20 7072 6f63 6564 7572 6573 0d0a 2020  l procedures..  
+0000f550: 2320 206f 6620 7265 6d6f 7465 2073 656e  #  of remote sen
+0000f560: 7369 6e67 2069 6e20 696e 6c61 6e64 2061  sing in inland a
+0000f570: 6e64 206e 6561 722d 636f 6173 7461 6c20  nd near-coastal 
+0000f580: 7472 616e 7369 7469 6f6e 616c 0d0a 2020  transitional..  
+0000f590: 2320 2077 6174 6572 732c 2049 6e74 6572  #  waters, Inter
+0000f5a0: 6e61 7469 6f6e 616c 204a 6f75 726e 616c  national Journal
+0000f5b0: 206f 6620 5265 6d6f 7465 2053 656e 7369   of Remote Sensi
+0000f5c0: 6e67 2c20 3332 3a32 312c 0d0a 2020 2320  ng, 32:21,..  # 
+0000f5d0: 2036 3835 352d 3638 3939 2c20 444f 493a   6855-6899, DOI:
+0000f5e0: 2031 302e 3130 3830 2f30 3134 3331 3136   10.1080/0143116
+0000f5f0: 312e 3230 3130 2e35 3132 3934 370d 0a0d  1.2010.512947...
+0000f600: 0a20 2023 2041 7070 6c79 2061 6c67 6f72  .  # Apply algor
+0000f610: 6974 686d 2032 3a20 4232 2f42 310d 0a20  ithm 2: B2/B1.. 
+0000f620: 2062 6c6f 6f6d 3220 3d20 696d 6167 652e   bloom2 = image.
+0000f630: 7365 6c65 6374 2827 6772 6565 6e27 295c  select('green')\
+0000f640: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000f650: 2e64 6976 6964 6528 696d 6167 652e 7365  .divide(image.se
+0000f660: 6c65 6374 2827 626c 7565 2729 295c 0d0a  lect('blue'))\..
+0000f670: 2020 2020 2020 2020 2020 2020 2020 2e72                .r
+0000f680: 656e 616d 6528 5b27 626c 6f6f 6d32 275d  ename(['bloom2']
+0000f690: 290d 0a20 206e 6467 6920 3d20 696d 6167  )..  ndgi = imag
+0000f6a0: 652e 6e6f 726d 616c 697a 6564 4469 6666  e.normalizedDiff
+0000f6b0: 6572 656e 6365 285b 2767 7265 656e 272c  erence(['green',
+0000f6c0: 2762 6c75 6527 5d29 2e72 656e 616d 6528  'blue']).rename(
+0000f6d0: 5b27 4e44 4749 275d 290d 0a20 2072 6574  ['NDGI'])..  ret
+0000f6e0: 7572 6e20 696d 6167 652e 6164 6442 616e  urn image.addBan
+0000f6f0: 6473 2862 6c6f 6f6d 3229 2e61 6464 4261  ds(bloom2).addBa
+0000f700: 6e64 7328 6e64 6769 290d 0a0d 0a23 2323  nds(ndgi)....###
+0000f710: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f720: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f730: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f740: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f750: 2323 2323 2323 0d0a 2346 756e 6374 696f  ######..#Functio
+0000f760: 6e20 666f 7220 6f6e 6c79 2061 6464 696e  n for only addin
+0000f770: 6720 636f 6d6d 6f6e 2069 6e64 6963 6573  g common indices
+0000f780: 0d0a 6465 6620 7369 6d70 6c65 4164 6449  ..def simpleAddI
+0000f790: 6e64 6963 6573 2869 6e5f 696d 6167 6529  ndices(in_image)
+0000f7a0: 3a0d 0a20 2069 6e5f 696d 6167 6520 3d20  :..  in_image = 
+0000f7b0: 696e 5f69 6d61 6765 2e61 6464 4261 6e64  in_image.addBand
+0000f7c0: 7328 696e 5f69 6d61 6765 2e6e 6f72 6d61  s(in_image.norma
+0000f7d0: 6c69 7a65 6444 6966 6665 7265 6e63 6528  lizedDifference(
+0000f7e0: 5b27 6e69 7227 2c20 2772 6564 275d 292e  ['nir', 'red']).
+0000f7f0: 7365 6c65 6374 285b 305d 2c5b 274e 4456  select([0],['NDV
+0000f800: 4927 5d29 290d 0a20 2069 6e5f 696d 6167  I']))..  in_imag
+0000f810: 6520 3d20 696e 5f69 6d61 6765 2e61 6464  e = in_image.add
+0000f820: 4261 6e64 7328 696e 5f69 6d61 6765 2e6e  Bands(in_image.n
+0000f830: 6f72 6d61 6c69 7a65 6444 6966 6665 7265  ormalizedDiffere
+0000f840: 6e63 6528 5b27 6e69 7227 2c20 2773 7769  nce(['nir', 'swi
+0000f850: 7232 275d 292e 7365 6c65 6374 285b 305d  r2']).select([0]
+0000f860: 2c5b 274e 4252 275d 2929 0d0a 2020 696e  ,['NBR']))..  in
+0000f870: 5f69 6d61 6765 203d 2069 6e5f 696d 6167  _image = in_imag
+0000f880: 652e 6164 6442 616e 6473 2869 6e5f 696d  e.addBands(in_im
+0000f890: 6167 652e 6e6f 726d 616c 697a 6564 4469  age.normalizedDi
+0000f8a0: 6666 6572 656e 6365 285b 276e 6972 272c  fference(['nir',
+0000f8b0: 2027 7377 6972 3127 5d29 2e73 656c 6563   'swir1']).selec
+0000f8c0: 7428 5b30 5d2c 5b27 4e44 4d49 275d 2929  t([0],['NDMI']))
+0000f8d0: 0d0a 2020 696e 5f69 6d61 6765 203d 2069  ..  in_image = i
+0000f8e0: 6e5f 696d 6167 652e 6164 6442 616e 6473  n_image.addBands
+0000f8f0: 2869 6e5f 696d 6167 652e 6e6f 726d 616c  (in_image.normal
+0000f900: 697a 6564 4469 6666 6572 656e 6365 285b  izedDifference([
+0000f910: 2767 7265 656e 272c 2027 7377 6972 3127  'green', 'swir1'
+0000f920: 5d29 2e73 656c 6563 7428 5b30 5d2c 5b27  ]).select([0],['
+0000f930: 4e44 5349 275d 2929 0d0a 0d0a 2020 7265  NDSI']))....  re
+0000f940: 7475 726e 2069 6e5f 696d 6167 650d 0a0d  turn in_image...
+0000f950: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+0000f960: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f970: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f980: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f990: 2323 2323 2323 2323 2323 0d0a 2323 2323  ##########..####
+0000f9a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f9b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000f9c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000f9d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f9e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000f9f0: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
-0000fa00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000f9e0: 2323 2323 230d 0a23 4675 6e63 7469 6f6e  #####..#Function
+0000f9f0: 2066 6f72 2061 6464 696e 6720 636f 6d6d   for adding comm
+0000fa00: 6f6e 2069 6e64 6963 6573 0d0a 2323 2323  on indices..####
 0000fa10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000fa20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000fa30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fa40: 2323 2323 2323 2323 0d0a 2346 756e 6374  ########..#Funct
-0000fa50: 696f 6e20 666f 7220 6164 6469 6e67 2063  ion for adding c
-0000fa60: 6f6d 6d6f 6e20 696e 6469 6365 730d 0a23  ommon indices..#
-0000fa70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fa80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fa90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000faa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fab0: 2323 2323 2323 2323 0d0a 6465 6620 6164  ########..def ad
-0000fac0: 6453 6f69 6c49 6e64 6963 6573 2869 6d67  dSoilIndices(img
-0000fad0: 293a 0d0a 2020 696d 6720 3d20 696d 672e  ):..  img = img.
-0000fae0: 6164 6442 616e 6473 2869 6d67 2e6e 6f72  addBands(img.nor
-0000faf0: 6d61 6c69 7a65 6444 6966 6665 7265 6e63  malizedDifferenc
-0000fb00: 6528 5b27 7265 6427 2c27 6772 6565 6e27  e(['red','green'
-0000fb10: 5d29 2e72 656e 616d 6528 5b27 4e44 4349  ]).rename(['NDCI
-0000fb20: 275d 2929 0d0a 2020 696d 6720 3d20 696d  ']))..  img = im
-0000fb30: 672e 6164 6442 616e 6473 2869 6d67 2e6e  g.addBands(img.n
-0000fb40: 6f72 6d61 6c69 7a65 6444 6966 6665 7265  ormalizedDiffere
-0000fb50: 6e63 6528 5b27 7265 6427 2c27 7377 6972  nce(['red','swir
-0000fb60: 3227 5d29 2e72 656e 616d 6528 5b27 4e44  2']).rename(['ND
-0000fb70: 4949 275d 2929 0d0a 2020 696d 6720 3d20  II']))..  img = 
-0000fb80: 696d 672e 6164 6442 616e 6473 2869 6d67  img.addBands(img
-0000fb90: 2e6e 6f72 6d61 6c69 7a65 6444 6966 6665  .normalizedDiffe
-0000fba0: 7265 6e63 6528 5b27 7377 6972 3127 2c27  rence(['swir1','
-0000fbb0: 6e69 7227 5d29 2e72 656e 616d 6528 5b27  nir']).rename(['
-0000fbc0: 4e44 4649 275d 2929 0d0a 0d0a 2020 6273  NDFI']))....  bs
-0000fbd0: 6920 3d20 696d 672e 6578 7072 6573 7369  i = img.expressi
-0000fbe0: 6f6e 285c 0d0a 2020 2728 2853 5749 5231  on(\..  '((SWIR1
-0000fbf0: 202b 2052 4544 2920 2d20 284e 4952 202b   + RED) - (NIR +
-0000fc00: 2042 4c55 4529 2920 2f20 2828 5357 4952   BLUE)) / ((SWIR
-0000fc10: 3120 2b20 5245 4429 202b 2028 4e49 5220  1 + RED) + (NIR 
-0000fc20: 2b20 424c 5545 2929 272c 207b 5c0d 0a20  + BLUE))', {\.. 
-0000fc30: 2020 2027 424c 5545 273a 2069 6d67 2e73     'BLUE': img.s
-0000fc40: 656c 6563 7428 2762 6c75 6527 292c 5c0d  elect('blue'),\.
-0000fc50: 0a20 2020 2027 5245 4427 3a20 696d 672e  .    'RED': img.
-0000fc60: 7365 6c65 6374 2827 7265 6427 292c 5c0d  select('red'),\.
-0000fc70: 0a20 2020 2027 4e49 5227 3a20 696d 672e  .    'NIR': img.
-0000fc80: 7365 6c65 6374 2827 6e69 7227 292c 5c0d  select('nir'),\.
-0000fc90: 0a20 2020 2027 5357 4952 3127 3a20 696d  .    'SWIR1': im
-0000fca0: 672e 7365 6c65 6374 2827 7377 6972 3127  g.select('swir1'
-0000fcb0: 295c 0d0a 2020 7d29 2e66 6c6f 6174 2829  )\..  }).float()
-0000fcc0: 0d0a 0d0a 2020 696d 6720 3d20 696d 672e  ....  img = img.
-0000fcd0: 6164 6442 616e 6473 2862 7369 2e72 656e  addBands(bsi.ren
-0000fce0: 616d 6528 5b27 4253 4927 5d29 290d 0a0d  ame(['BSI']))...
-0000fcf0: 0a20 2068 6920 3d20 696d 672e 6578 7072  .  hi = img.expr
-0000fd00: 6573 7369 6f6e 285c 0d0a 2020 2020 2753  ession(\..    'S
-0000fd10: 5749 5231 202f 2053 5749 5232 272c 7b5c  WIR1 / SWIR2',{\
-0000fd20: 0d0a 2020 2020 2020 2753 5749 5231 273a  ..      'SWIR1':
-0000fd30: 2069 6d67 2e73 656c 6563 7428 2773 7769   img.select('swi
-0000fd40: 7231 2729 2c5c 0d0a 2020 2020 2020 2753  r1'),\..      'S
-0000fd50: 5749 5232 273a 2069 6d67 2e73 656c 6563  WIR2': img.selec
-0000fd60: 7428 2773 7769 7232 2729 5c0d 0a20 2020  t('swir2')\..   
-0000fd70: 207d 292e 666c 6f61 7428 290d 0a20 2069   }).float()..  i
-0000fd80: 6d67 203d 2069 6d67 2e61 6464 4261 6e64  mg = img.addBand
-0000fd90: 7328 6869 2e72 656e 616d 6528 5b27 4849  s(hi.rename(['HI
-0000fda0: 275d 2929 2e66 6c6f 6174 2829 0d0a 2020  '])).float()..  
-0000fdb0: 7265 7475 726e 2069 6d67 0d0a 0d0a 2323  return img....##
+0000fa40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fa50: 2323 2323 230d 0a64 6566 2061 6464 536f  #####..def addSo
+0000fa60: 696c 496e 6469 6365 7328 696d 6729 3a0d  ilIndices(img):.
+0000fa70: 0a20 2069 6d67 203d 2069 6d67 2e61 6464  .  img = img.add
+0000fa80: 4261 6e64 7328 696d 672e 6e6f 726d 616c  Bands(img.normal
+0000fa90: 697a 6564 4469 6666 6572 656e 6365 285b  izedDifference([
+0000faa0: 2772 6564 272c 2767 7265 656e 275d 292e  'red','green']).
+0000fab0: 7265 6e61 6d65 285b 274e 4443 4927 5d29  rename(['NDCI'])
+0000fac0: 290d 0a20 2069 6d67 203d 2069 6d67 2e61  )..  img = img.a
+0000fad0: 6464 4261 6e64 7328 696d 672e 6e6f 726d  ddBands(img.norm
+0000fae0: 616c 697a 6564 4469 6666 6572 656e 6365  alizedDifference
+0000faf0: 285b 2772 6564 272c 2773 7769 7232 275d  (['red','swir2']
+0000fb00: 292e 7265 6e61 6d65 285b 274e 4449 4927  ).rename(['NDII'
+0000fb10: 5d29 290d 0a20 2069 6d67 203d 2069 6d67  ]))..  img = img
+0000fb20: 2e61 6464 4261 6e64 7328 696d 672e 6e6f  .addBands(img.no
+0000fb30: 726d 616c 697a 6564 4469 6666 6572 656e  rmalizedDifferen
+0000fb40: 6365 285b 2773 7769 7231 272c 276e 6972  ce(['swir1','nir
+0000fb50: 275d 292e 7265 6e61 6d65 285b 274e 4446  ']).rename(['NDF
+0000fb60: 4927 5d29 290d 0a0d 0a20 2062 7369 203d  I']))....  bsi =
+0000fb70: 2069 6d67 2e65 7870 7265 7373 696f 6e28   img.expression(
+0000fb80: 5c0d 0a20 2027 2828 5357 4952 3120 2b20  \..  '((SWIR1 + 
+0000fb90: 5245 4429 202d 2028 4e49 5220 2b20 424c  RED) - (NIR + BL
+0000fba0: 5545 2929 202f 2028 2853 5749 5231 202b  UE)) / ((SWIR1 +
+0000fbb0: 2052 4544 2920 2b20 284e 4952 202b 2042   RED) + (NIR + B
+0000fbc0: 4c55 4529 2927 2c20 7b5c 0d0a 2020 2020  LUE))', {\..    
+0000fbd0: 2742 4c55 4527 3a20 696d 672e 7365 6c65  'BLUE': img.sele
+0000fbe0: 6374 2827 626c 7565 2729 2c5c 0d0a 2020  ct('blue'),\..  
+0000fbf0: 2020 2752 4544 273a 2069 6d67 2e73 656c    'RED': img.sel
+0000fc00: 6563 7428 2772 6564 2729 2c5c 0d0a 2020  ect('red'),\..  
+0000fc10: 2020 274e 4952 273a 2069 6d67 2e73 656c    'NIR': img.sel
+0000fc20: 6563 7428 276e 6972 2729 2c5c 0d0a 2020  ect('nir'),\..  
+0000fc30: 2020 2753 5749 5231 273a 2069 6d67 2e73    'SWIR1': img.s
+0000fc40: 656c 6563 7428 2773 7769 7231 2729 5c0d  elect('swir1')\.
+0000fc50: 0a20 207d 292e 666c 6f61 7428 290d 0a0d  .  }).float()...
+0000fc60: 0a20 2069 6d67 203d 2069 6d67 2e61 6464  .  img = img.add
+0000fc70: 4261 6e64 7328 6273 692e 7265 6e61 6d65  Bands(bsi.rename
+0000fc80: 285b 2742 5349 275d 2929 0d0a 0d0a 2020  (['BSI']))....  
+0000fc90: 6869 203d 2069 6d67 2e65 7870 7265 7373  hi = img.express
+0000fca0: 696f 6e28 5c0d 0a20 2020 2027 5357 4952  ion(\..    'SWIR
+0000fcb0: 3120 2f20 5357 4952 3227 2c7b 5c0d 0a20  1 / SWIR2',{\.. 
+0000fcc0: 2020 2020 2027 5357 4952 3127 3a20 696d       'SWIR1': im
+0000fcd0: 672e 7365 6c65 6374 2827 7377 6972 3127  g.select('swir1'
+0000fce0: 292c 5c0d 0a20 2020 2020 2027 5357 4952  ),\..      'SWIR
+0000fcf0: 3227 3a20 696d 672e 7365 6c65 6374 2827  2': img.select('
+0000fd00: 7377 6972 3227 295c 0d0a 2020 2020 7d29  swir2')\..    })
+0000fd10: 2e66 6c6f 6174 2829 0d0a 2020 696d 6720  .float()..  img 
+0000fd20: 3d20 696d 672e 6164 6442 616e 6473 2868  = img.addBands(h
+0000fd30: 692e 7265 6e61 6d65 285b 2748 4927 5d29  i.rename(['HI'])
+0000fd40: 292e 666c 6f61 7428 290d 0a20 2072 6574  ).float()..  ret
+0000fd50: 7572 6e20 696d 670d 0a0d 0a23 2323 2323  urn img....#####
+0000fd60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fd70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fd80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fd90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fda0: 2323 2323 0d0a 2323 2323 2323 2323 2323  ####..##########
+0000fdb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000fdc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000fdd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fde0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fdf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fe00: 2323 2323 2323 230d 0a23 2323 2323 2323  #######..#######
-0000fe10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fe20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fe30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fe40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fe50: 2323 0d0a 2346 756e 6374 696f 6e20 746f  ##..#Function to
-0000fe60: 2063 6f6d 7075 7465 2074 6865 2054 6173   compute the Tas
-0000fe70: 7365 6c65 6420 4361 7020 7472 616e 7366  seled Cap transf
-0000fe80: 6f72 6d61 7469 6f6e 2061 6e64 2072 6574  ormation and ret
-0000fe90: 7572 6e20 616e 2069 6d61 6765 0d0a 2377  urn an image..#w
-0000fea0: 6974 6820 7468 6520 666f 6c6c 6f77 696e  ith the followin
-0000feb0: 6720 6261 6e64 7320 6164 6465 643a 205b  g bands added: [
-0000fec0: 2762 7269 6768 746e 6573 7327 2c20 2767  'brightness', 'g
-0000fed0: 7265 656e 6e65 7373 272c 2027 7765 746e  reenness', 'wetn
-0000fee0: 6573 7327 2c0d 0a23 2766 6f75 7274 6827  ess',..#'fourth'
-0000fef0: 2c20 2766 6966 7468 272c 2027 7369 7874  , 'fifth', 'sixt
-0000ff00: 6827 5d0d 0a64 6566 2067 6574 5461 7373  h']..def getTass
-0000ff10: 656c 6564 4361 7028 696d 6167 6529 3a0d  eledCap(image):.
-0000ff20: 0a0d 0a20 2062 616e 6473 203d 2065 652e  ...  bands = ee.
-0000ff30: 4c69 7374 285b 2762 6c75 6527 2c27 6772  List(['blue','gr
-0000ff40: 6565 6e27 2c27 7265 6427 2c27 6e69 7227  een','red','nir'
-0000ff50: 2c27 7377 6972 3127 2c27 7377 6972 3227  ,'swir1','swir2'
-0000ff60: 5d29 0d0a 2020 2320 2020 2f2f 202f 2f20  ])..  #   // // 
-0000ff70: 4b61 7574 682d 5468 6f6d 6173 2063 6f65  Kauth-Thomas coe
-0000ff80: 6666 6963 6965 6e74 7320 666f 7220 5468  fficients for Th
-0000ff90: 656d 6174 6963 204d 6170 7065 7220 6461  ematic Mapper da
-0000ffa0: 7461 0d0a 2020 2320 2020 2f2f 2076 6172  ta..  #   // var
-0000ffb0: 2063 6f65 6666 6963 6965 6e74 7320 3d20   coefficients = 
-0000ffc0: 6565 2e41 7272 6179 285b 0d0a 2020 2320  ee.Array([..  # 
-0000ffd0: 2020 2f2f 2020 205b 302e 3330 3337 2c20    //   [0.3037, 
-0000ffe0: 302e 3237 3933 2c20 302e 3437 3433 2c20  0.2793, 0.4743, 
-0000fff0: 302e 3535 3835 2c20 302e 3530 3832 2c20  0.5585, 0.5082, 
-00010000: 302e 3138 3633 5d2c 0d0a 2020 2320 2020  0.1863],..  #   
-00010010: 2f2f 2020 205b 2d30 2e32 3834 382c 202d  //   [-0.2848, -
-00010020: 302e 3234 3335 2c20 2d30 2e35 3433 362c  0.2435, -0.5436,
-00010030: 2030 2e37 3234 332c 2030 2e30 3834 302c   0.7243, 0.0840,
-00010040: 202d 302e 3138 3030 5d2c 0d0a 2020 2320   -0.1800],..  # 
-00010050: 2020 2f2f 2020 205b 302e 3135 3039 2c20    //   [0.1509, 
-00010060: 302e 3139 3733 2c20 302e 3332 3739 2c20  0.1973, 0.3279, 
-00010070: 302e 3334 3036 2c20 2d30 2e37 3131 322c  0.3406, -0.7112,
-00010080: 202d 302e 3435 3732 5d2c 0d0a 2020 2320   -0.4572],..  # 
-00010090: 2020 2f2f 2020 205b 2d30 2e38 3234 322c    //   [-0.8242,
-000100a0: 2030 2e30 3834 392c 2030 2e34 3339 322c   0.0849, 0.4392,
-000100b0: 202d 302e 3035 3830 2c20 302e 3230 3132   -0.0580, 0.2012
-000100c0: 2c20 2d30 2e32 3736 385d 2c0d 0a20 2023  , -0.2768],..  #
-000100d0: 2020 202f 2f20 2020 5b2d 302e 3332 3830     //   [-0.3280
-000100e0: 2c20 302e 3035 3439 2c20 302e 3130 3735  , 0.0549, 0.1075
-000100f0: 2c20 302e 3138 3535 2c20 2d30 2e34 3335  , 0.1855, -0.435
-00010100: 372c 2030 2e38 3038 355d 2c0d 0a20 2023  7, 0.8085],..  #
-00010110: 2020 202f 2f20 2020 5b30 2e31 3038 342c     //   [0.1084,
-00010120: 202d 302e 3930 3232 2c20 302e 3431 3230   -0.9022, 0.4120
-00010130: 2c20 302e 3035 3733 2c20 2d30 2e30 3235  , 0.0573, -0.025
-00010140: 312c 2030 2e30 3233 385d 0d0a 2020 2320  1, 0.0238]..  # 
-00010150: 2020 2f2f 205d 293b 0d0a 0d0a 2020 2343    // ]);....  #C
-00010160: 7269 7374 2031 3938 3520 636f 6566 6673  rist 1985 coeffs
-00010170: 202d 2054 4f41 2072 6566 6c20 2868 7474   - TOA refl (htt
-00010180: 703a 2f2f 7777 772e 6769 732e 7573 752e  p://www.gis.usu.
-00010190: 6564 752f 7e64 6f75 672f 5253 3537 3530  edu/~doug/RS5750
-000101a0: 2f61 7373 6967 6e2f 4f4c 442f 5253 4528  /assign/OLD/RSE(
-000101b0: 3137 292d 3330 312e 7064 6629 0d0a 2020  17)-301.pdf)..  
-000101c0: 636f 6566 6669 6369 656e 7473 203d 2065  coefficients = e
-000101d0: 652e 4172 7261 7928 5b5b 302e 3230 3433  e.Array([[0.2043
-000101e0: 2c20 302e 3431 3538 2c20 302e 3535 3234  , 0.4158, 0.5524
-000101f0: 2c20 302e 3537 3431 2c20 302e 3331 3234  , 0.5741, 0.3124
-00010200: 2c20 302e 3233 3033 5d2c 5c0d 0a20 2020  , 0.2303],\..   
-00010210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010220: 2020 205b 2d30 2e31 3630 332c 202d 302e     [-0.1603, -0.
-00010230: 3238 3139 2c20 2d30 2e34 3933 342c 2030  2819, -0.4934, 0
-00010240: 2e37 3934 302c 202d 302e 3030 3032 2c20  .7940, -0.0002, 
-00010250: 2d30 2e31 3434 365d 2c5c 0d0a 2020 2020  -0.1446],\..    
-00010260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010270: 2020 5b30 2e30 3331 352c 2030 2e32 3032    [0.0315, 0.202
-00010280: 312c 2030 2e33 3130 322c 2030 2e31 3539  1, 0.3102, 0.159
-00010290: 342c 202d 302e 3638 3036 2c20 2d30 2e36  4, -0.6806, -0.6
-000102a0: 3130 395d 2c5c 0d0a 2020 2020 2020 2020  109],\..        
-000102b0: 2020 2020 2020 2020 2020 2020 2020 5b2d                [-
-000102c0: 302e 3231 3137 2c20 2d30 2e30 3238 342c  0.2117, -0.0284,
-000102d0: 2030 2e31 3330 322c 202d 302e 3130 3037   0.1302, -0.1007
-000102e0: 2c20 302e 3635 3239 2c20 2d30 2e37 3037  , 0.6529, -0.707
-000102f0: 385d 2c5c 0d0a 2020 2020 2020 2020 2020  8],\..          
-00010300: 2020 2020 2020 2020 2020 2020 5b2d 302e              [-0.
-00010310: 3836 3639 2c20 2d30 2e31 3833 352c 2030  8669, -0.1835, 0
-00010320: 2e33 3835 362c 2030 2e30 3430 382c 202d  .3856, 0.0408, -
-00010330: 302e 3131 3332 2c20 302e 3232 3732 5d2c  0.1132, 0.2272],
-00010340: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
-00010350: 2020 2020 2020 2020 5b30 2e33 3637 372c          [0.3677,
-00010360: 202d 302e 3832 3030 2c20 302e 3433 3534   -0.8200, 0.4354
-00010370: 2c20 302e 3035 3138 2c20 2d30 2e30 3036  , 0.0518, -0.006
-00010380: 362c 202d 302e 3031 3034 5d5d 290d 0a20  6, -0.0104]]).. 
-00010390: 2023 4d61 6b65 2061 6e20 4172 7261 7920   #Make an Array 
-000103a0: 496d 6167 652c 2077 6974 6820 6120 312d  Image, with a 1-
-000103b0: 4420 4172 7261 7920 7065 7220 7069 7865  D Array per pixe
-000103c0: 6c2e 0d0a 2020 6172 7261 7949 6d61 6765  l...  arrayImage
-000103d0: 3144 203d 2069 6d61 6765 2e73 656c 6563  1D = image.selec
-000103e0: 7428 6261 6e64 7329 2e74 6f41 7272 6179  t(bands).toArray
-000103f0: 2829 0d0a 0d0a 2020 234d 616b 6520 616e  ()....  #Make an
-00010400: 2041 7272 6179 2049 6d61 6765 2077 6974   Array Image wit
-00010410: 6820 6120 322d 4420 4172 7261 7920 7065  h a 2-D Array pe
-00010420: 7220 7069 7865 6c2c 2036 7831 2e0d 0a20  r pixel, 6x1... 
-00010430: 2061 7272 6179 496d 6167 6532 4420 3d20   arrayImage2D = 
-00010440: 6172 7261 7949 6d61 6765 3144 2e74 6f41  arrayImage1D.toA
-00010450: 7272 6179 2831 290d 0a0d 0a20 2063 6f6d  rray(1)....  com
-00010460: 706f 6e65 6e74 7349 6d61 6765 203d 2065  ponentsImage = e
-00010470: 652e 496d 6167 6528 636f 6566 6669 6369  e.Image(coeffici
-00010480: 656e 7473 292e 6d61 7472 6978 4d75 6c74  ents).matrixMult
-00010490: 6970 6c79 2861 7272 6179 496d 6167 6532  iply(arrayImage2
-000104a0: 4429 5c0d 0a20 202e 6172 7261 7950 726f  D)\..  .arrayPro
-000104b0: 6a65 6374 285b 305d 295c 0d0a 2020 2e61  ject([0])\..  .a
-000104c0: 7272 6179 466c 6174 7465 6e28 5b5b 2762  rrayFlatten([['b
-000104d0: 7269 6768 746e 6573 7327 2c20 2767 7265  rightness', 'gre
-000104e0: 656e 6e65 7373 272c 2027 7765 746e 6573  enness', 'wetnes
-000104f0: 7327 2c20 2766 6f75 7274 6827 2c20 2766  s', 'fourth', 'f
-00010500: 6966 7468 272c 2027 7369 7874 6827 5d5d  ifth', 'sixth']]
-00010510: 292e 666c 6f61 7428 290d 0a0d 0a20 2072  ).float()....  r
-00010520: 6574 7572 6e20 696d 6167 652e 6164 6442  eturn image.addB
-00010530: 616e 6473 2863 6f6d 706f 6e65 6e74 7349  ands(componentsI
-00010540: 6d61 6765 290d 0a0d 0a23 2323 2323 2323  mage)....#######
+0000fde0: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
+0000fdf0: 0a23 4675 6e63 7469 6f6e 2074 6f20 636f  .#Function to co
+0000fe00: 6d70 7574 6520 7468 6520 5461 7373 656c  mpute the Tassel
+0000fe10: 6564 2043 6170 2074 7261 6e73 666f 726d  ed Cap transform
+0000fe20: 6174 696f 6e20 616e 6420 7265 7475 726e  ation and return
+0000fe30: 2061 6e20 696d 6167 650d 0a23 7769 7468   an image..#with
+0000fe40: 2074 6865 2066 6f6c 6c6f 7769 6e67 2062   the following b
+0000fe50: 616e 6473 2061 6464 6564 3a20 5b27 6272  ands added: ['br
+0000fe60: 6967 6874 6e65 7373 272c 2027 6772 6565  ightness', 'gree
+0000fe70: 6e6e 6573 7327 2c20 2777 6574 6e65 7373  nness', 'wetness
+0000fe80: 272c 0d0a 2327 666f 7572 7468 272c 2027  ',..#'fourth', '
+0000fe90: 6669 6674 6827 2c20 2773 6978 7468 275d  fifth', 'sixth']
+0000fea0: 0d0a 6465 6620 6765 7454 6173 7365 6c65  ..def getTassele
+0000feb0: 6443 6170 2869 6d61 6765 293a 0d0a 0d0a  dCap(image):....
+0000fec0: 2020 6261 6e64 7320 3d20 6565 2e4c 6973    bands = ee.Lis
+0000fed0: 7428 5b27 626c 7565 272c 2767 7265 656e  t(['blue','green
+0000fee0: 272c 2772 6564 272c 276e 6972 272c 2773  ','red','nir','s
+0000fef0: 7769 7231 272c 2773 7769 7232 275d 290d  wir1','swir2']).
+0000ff00: 0a20 2023 2020 202f 2f20 2f2f 204b 6175  .  #   // // Kau
+0000ff10: 7468 2d54 686f 6d61 7320 636f 6566 6669  th-Thomas coeffi
+0000ff20: 6369 656e 7473 2066 6f72 2054 6865 6d61  cients for Thema
+0000ff30: 7469 6320 4d61 7070 6572 2064 6174 610d  tic Mapper data.
+0000ff40: 0a20 2023 2020 202f 2f20 7661 7220 636f  .  #   // var co
+0000ff50: 6566 6669 6369 656e 7473 203d 2065 652e  efficients = ee.
+0000ff60: 4172 7261 7928 5b0d 0a20 2023 2020 202f  Array([..  #   /
+0000ff70: 2f20 2020 5b30 2e33 3033 372c 2030 2e32  /   [0.3037, 0.2
+0000ff80: 3739 332c 2030 2e34 3734 332c 2030 2e35  793, 0.4743, 0.5
+0000ff90: 3538 352c 2030 2e35 3038 322c 2030 2e31  585, 0.5082, 0.1
+0000ffa0: 3836 335d 2c0d 0a20 2023 2020 202f 2f20  863],..  #   // 
+0000ffb0: 2020 5b2d 302e 3238 3438 2c20 2d30 2e32    [-0.2848, -0.2
+0000ffc0: 3433 352c 202d 302e 3534 3336 2c20 302e  435, -0.5436, 0.
+0000ffd0: 3732 3433 2c20 302e 3038 3430 2c20 2d30  7243, 0.0840, -0
+0000ffe0: 2e31 3830 305d 2c0d 0a20 2023 2020 202f  .1800],..  #   /
+0000fff0: 2f20 2020 5b30 2e31 3530 392c 2030 2e31  /   [0.1509, 0.1
+00010000: 3937 332c 2030 2e33 3237 392c 2030 2e33  973, 0.3279, 0.3
+00010010: 3430 362c 202d 302e 3731 3132 2c20 2d30  406, -0.7112, -0
+00010020: 2e34 3537 325d 2c0d 0a20 2023 2020 202f  .4572],..  #   /
+00010030: 2f20 2020 5b2d 302e 3832 3432 2c20 302e  /   [-0.8242, 0.
+00010040: 3038 3439 2c20 302e 3433 3932 2c20 2d30  0849, 0.4392, -0
+00010050: 2e30 3538 302c 2030 2e32 3031 322c 202d  .0580, 0.2012, -
+00010060: 302e 3237 3638 5d2c 0d0a 2020 2320 2020  0.2768],..  #   
+00010070: 2f2f 2020 205b 2d30 2e33 3238 302c 2030  //   [-0.3280, 0
+00010080: 2e30 3534 392c 2030 2e31 3037 352c 2030  .0549, 0.1075, 0
+00010090: 2e31 3835 352c 202d 302e 3433 3537 2c20  .1855, -0.4357, 
+000100a0: 302e 3830 3835 5d2c 0d0a 2020 2320 2020  0.8085],..  #   
+000100b0: 2f2f 2020 205b 302e 3130 3834 2c20 2d30  //   [0.1084, -0
+000100c0: 2e39 3032 322c 2030 2e34 3132 302c 2030  .9022, 0.4120, 0
+000100d0: 2e30 3537 332c 202d 302e 3032 3531 2c20  .0573, -0.0251, 
+000100e0: 302e 3032 3338 5d0d 0a20 2023 2020 202f  0.0238]..  #   /
+000100f0: 2f20 5d29 3b0d 0a0d 0a20 2023 4372 6973  / ]);....  #Cris
+00010100: 7420 3139 3835 2063 6f65 6666 7320 2d20  t 1985 coeffs - 
+00010110: 544f 4120 7265 666c 2028 6874 7470 3a2f  TOA refl (http:/
+00010120: 2f77 7777 2e67 6973 2e75 7375 2e65 6475  /www.gis.usu.edu
+00010130: 2f7e 646f 7567 2f52 5335 3735 302f 6173  /~doug/RS5750/as
+00010140: 7369 676e 2f4f 4c44 2f52 5345 2831 3729  sign/OLD/RSE(17)
+00010150: 2d33 3031 2e70 6466 290d 0a20 2063 6f65  -301.pdf)..  coe
+00010160: 6666 6963 6965 6e74 7320 3d20 6565 2e41  fficients = ee.A
+00010170: 7272 6179 285b 5b30 2e32 3034 332c 2030  rray([[0.2043, 0
+00010180: 2e34 3135 382c 2030 2e35 3532 342c 2030  .4158, 0.5524, 0
+00010190: 2e35 3734 312c 2030 2e33 3132 342c 2030  .5741, 0.3124, 0
+000101a0: 2e32 3330 335d 2c5c 0d0a 2020 2020 2020  .2303],\..      
+000101b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101c0: 5b2d 302e 3136 3033 2c20 2d30 2e32 3831  [-0.1603, -0.281
+000101d0: 392c 202d 302e 3439 3334 2c20 302e 3739  9, -0.4934, 0.79
+000101e0: 3430 2c20 2d30 2e30 3030 322c 202d 302e  40, -0.0002, -0.
+000101f0: 3134 3436 5d2c 5c0d 0a20 2020 2020 2020  1446],\..       
+00010200: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00010210: 302e 3033 3135 2c20 302e 3230 3231 2c20  0.0315, 0.2021, 
+00010220: 302e 3331 3032 2c20 302e 3135 3934 2c20  0.3102, 0.1594, 
+00010230: 2d30 2e36 3830 362c 202d 302e 3631 3039  -0.6806, -0.6109
+00010240: 5d2c 5c0d 0a20 2020 2020 2020 2020 2020  ],\..           
+00010250: 2020 2020 2020 2020 2020 205b 2d30 2e32             [-0.2
+00010260: 3131 372c 202d 302e 3032 3834 2c20 302e  117, -0.0284, 0.
+00010270: 3133 3032 2c20 2d30 2e31 3030 372c 2030  1302, -0.1007, 0
+00010280: 2e36 3532 392c 202d 302e 3730 3738 5d2c  .6529, -0.7078],
+00010290: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
+000102a0: 2020 2020 2020 2020 205b 2d30 2e38 3636           [-0.866
+000102b0: 392c 202d 302e 3138 3335 2c20 302e 3338  9, -0.1835, 0.38
+000102c0: 3536 2c20 302e 3034 3038 2c20 2d30 2e31  56, 0.0408, -0.1
+000102d0: 3133 322c 2030 2e32 3237 325d 2c5c 0d0a  132, 0.2272],\..
+000102e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000102f0: 2020 2020 205b 302e 3336 3737 2c20 2d30       [0.3677, -0
+00010300: 2e38 3230 302c 2030 2e34 3335 342c 2030  .8200, 0.4354, 0
+00010310: 2e30 3531 382c 202d 302e 3030 3636 2c20  .0518, -0.0066, 
+00010320: 2d30 2e30 3130 345d 5d29 0d0a 2020 234d  -0.0104]])..  #M
+00010330: 616b 6520 616e 2041 7272 6179 2049 6d61  ake an Array Ima
+00010340: 6765 2c20 7769 7468 2061 2031 2d44 2041  ge, with a 1-D A
+00010350: 7272 6179 2070 6572 2070 6978 656c 2e0d  rray per pixel..
+00010360: 0a20 2061 7272 6179 496d 6167 6531 4420  .  arrayImage1D 
+00010370: 3d20 696d 6167 652e 7365 6c65 6374 2862  = image.select(b
+00010380: 616e 6473 292e 746f 4172 7261 7928 290d  ands).toArray().
+00010390: 0a0d 0a20 2023 4d61 6b65 2061 6e20 4172  ...  #Make an Ar
+000103a0: 7261 7920 496d 6167 6520 7769 7468 2061  ray Image with a
+000103b0: 2032 2d44 2041 7272 6179 2070 6572 2070   2-D Array per p
+000103c0: 6978 656c 2c20 3678 312e 0d0a 2020 6172  ixel, 6x1...  ar
+000103d0: 7261 7949 6d61 6765 3244 203d 2061 7272  rayImage2D = arr
+000103e0: 6179 496d 6167 6531 442e 746f 4172 7261  ayImage1D.toArra
+000103f0: 7928 3129 0d0a 0d0a 2020 636f 6d70 6f6e  y(1)....  compon
+00010400: 656e 7473 496d 6167 6520 3d20 6565 2e49  entsImage = ee.I
+00010410: 6d61 6765 2863 6f65 6666 6963 6965 6e74  mage(coefficient
+00010420: 7329 2e6d 6174 7269 784d 756c 7469 706c  s).matrixMultipl
+00010430: 7928 6172 7261 7949 6d61 6765 3244 295c  y(arrayImage2D)\
+00010440: 0d0a 2020 2e61 7272 6179 5072 6f6a 6563  ..  .arrayProjec
+00010450: 7428 5b30 5d29 5c0d 0a20 202e 6172 7261  t([0])\..  .arra
+00010460: 7946 6c61 7474 656e 285b 5b27 6272 6967  yFlatten([['brig
+00010470: 6874 6e65 7373 272c 2027 6772 6565 6e6e  htness', 'greenn
+00010480: 6573 7327 2c20 2777 6574 6e65 7373 272c  ess', 'wetness',
+00010490: 2027 666f 7572 7468 272c 2027 6669 6674   'fourth', 'fift
+000104a0: 6827 2c20 2773 6978 7468 275d 5d29 2e66  h', 'sixth']]).f
+000104b0: 6c6f 6174 2829 0d0a 0d0a 2020 7265 7475  loat()....  retu
+000104c0: 726e 2069 6d61 6765 2e61 6464 4261 6e64  rn image.addBand
+000104d0: 7328 636f 6d70 6f6e 656e 7473 496d 6167  s(componentsImag
+000104e0: 6529 0d0a 0d0a 2323 2323 2323 2323 2323  e)....##########
+000104f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00010500: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00010510: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00010520: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
+00010530: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+00010540: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00010550: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00010560: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00010570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00010580: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00010590: 2323 0d0a 2323 2323 2323 2323 2323 2323  ##..############
-000105a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000105b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000105c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000105d0: 2323 2323 2323 2323 2323 2323 230d 0a64  #############..d
-000105e0: 6566 2073 696d 706c 6547 6574 5461 7373  ef simpleGetTass
-000105f0: 656c 6564 4361 7028 696d 6167 6529 3a0d  eledCap(image):.
-00010600: 0a0d 0a20 2062 616e 6473 203d 2065 652e  ...  bands = ee.
-00010610: 4c69 7374 285b 2762 6c75 6527 2c27 6772  List(['blue','gr
-00010620: 6565 6e27 2c27 7265 6427 2c27 6e69 7227  een','red','nir'
-00010630: 2c27 7377 6972 3127 2c27 7377 6972 3227  ,'swir1','swir2'
-00010640: 5d29 0d0a 2020 2320 2020 2f2f 202f 2f20  ])..  #   // // 
-00010650: 4b61 7574 682d 5468 6f6d 6173 2063 6f65  Kauth-Thomas coe
-00010660: 6666 6963 6965 6e74 7320 666f 7220 5468  fficients for Th
-00010670: 656d 6174 6963 204d 6170 7065 7220 6461  ematic Mapper da
-00010680: 7461 0d0a 2020 2320 2020 2f2f 2076 6172  ta..  #   // var
-00010690: 2063 6f65 6666 6963 6965 6e74 7320 3d20   coefficients = 
-000106a0: 6565 2e41 7272 6179 285b 0d0a 2020 2320  ee.Array([..  # 
-000106b0: 2020 2f2f 2020 205b 302e 3330 3337 2c20    //   [0.3037, 
-000106c0: 302e 3237 3933 2c20 302e 3437 3433 2c20  0.2793, 0.4743, 
-000106d0: 302e 3535 3835 2c20 302e 3530 3832 2c20  0.5585, 0.5082, 
-000106e0: 302e 3138 3633 5d2c 0d0a 2020 2320 2020  0.1863],..  #   
-000106f0: 2f2f 2020 205b 2d30 2e32 3834 382c 202d  //   [-0.2848, -
-00010700: 302e 3234 3335 2c20 2d30 2e35 3433 362c  0.2435, -0.5436,
-00010710: 2030 2e37 3234 332c 2030 2e30 3834 302c   0.7243, 0.0840,
-00010720: 202d 302e 3138 3030 5d2c 0d0a 2020 2320   -0.1800],..  # 
-00010730: 2020 2f2f 2020 205b 302e 3135 3039 2c20    //   [0.1509, 
-00010740: 302e 3139 3733 2c20 302e 3332 3739 2c20  0.1973, 0.3279, 
-00010750: 302e 3334 3036 2c20 2d30 2e37 3131 322c  0.3406, -0.7112,
-00010760: 202d 302e 3435 3732 5d2c 0d0a 2020 2320   -0.4572],..  # 
-00010770: 2020 2f2f 2020 205b 2d30 2e38 3234 322c    //   [-0.8242,
-00010780: 2030 2e30 3834 392c 2030 2e34 3339 322c   0.0849, 0.4392,
-00010790: 202d 302e 3035 3830 2c20 302e 3230 3132   -0.0580, 0.2012
-000107a0: 2c20 2d30 2e32 3736 385d 2c0d 0a20 2023  , -0.2768],..  #
-000107b0: 2020 202f 2f20 2020 5b2d 302e 3332 3830     //   [-0.3280
-000107c0: 2c20 302e 3035 3439 2c20 302e 3130 3735  , 0.0549, 0.1075
-000107d0: 2c20 302e 3138 3535 2c20 2d30 2e34 3335  , 0.1855, -0.435
-000107e0: 372c 2030 2e38 3038 355d 2c0d 0a20 2023  7, 0.8085],..  #
-000107f0: 2020 202f 2f20 2020 5b30 2e31 3038 342c     //   [0.1084,
-00010800: 202d 302e 3930 3232 2c20 302e 3431 3230   -0.9022, 0.4120
-00010810: 2c20 302e 3035 3733 2c20 2d30 2e30 3235  , 0.0573, -0.025
-00010820: 312c 2030 2e30 3233 385d 0d0a 2020 2320  1, 0.0238]..  # 
-00010830: 2020 2f2f 205d 293b 0d0a 0d0a 2020 2343    // ]);....  #C
-00010840: 7269 7374 2031 3938 3520 636f 6566 6673  rist 1985 coeffs
-00010850: 202d 2054 4f41 2072 6566 6c20 2868 7474   - TOA refl (htt
-00010860: 703a 2f2f 7777 772e 6769 732e 7573 752e  p://www.gis.usu.
-00010870: 6564 752f 7e64 6f75 672f 5253 3537 3530  edu/~doug/RS5750
-00010880: 2f61 7373 6967 6e2f 4f4c 442f 5253 4528  /assign/OLD/RSE(
-00010890: 3137 292d 3330 312e 7064 6629 0d0a 2020  17)-301.pdf)..  
-000108a0: 636f 6566 6669 6369 656e 7473 203d 2065  coefficients = e
-000108b0: 652e 4172 7261 7928 5b5b 302e 3230 3433  e.Array([[0.2043
-000108c0: 2c20 302e 3431 3538 2c20 302e 3535 3234  , 0.4158, 0.5524
-000108d0: 2c20 302e 3537 3431 2c20 302e 3331 3234  , 0.5741, 0.3124
-000108e0: 2c20 302e 3233 3033 5d2c 5c0d 0a20 2020  , 0.2303],\..   
-000108f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010900: 2020 205b 2d30 2e31 3630 332c 202d 302e     [-0.1603, -0.
-00010910: 3238 3139 2c20 2d30 2e34 3933 342c 2030  2819, -0.4934, 0
-00010920: 2e37 3934 302c 202d 302e 3030 3032 2c20  .7940, -0.0002, 
-00010930: 2d30 2e31 3434 365d 2c5c 0d0a 2020 2020  -0.1446],\..    
-00010940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010950: 2020 5b30 2e30 3331 352c 2030 2e32 3032    [0.0315, 0.202
-00010960: 312c 2030 2e33 3130 322c 2030 2e31 3539  1, 0.3102, 0.159
-00010970: 342c 202d 302e 3638 3036 2c20 2d30 2e36  4, -0.6806, -0.6
-00010980: 3130 395d 5d29 0d0a 2020 234d 616b 6520  109]])..  #Make 
-00010990: 616e 2041 7272 6179 2049 6d61 6765 2c20  an Array Image, 
-000109a0: 7769 7468 2061 2031 2d44 2041 7272 6179  with a 1-D Array
-000109b0: 2070 6572 2070 6978 656c 2e0d 0a20 2061   per pixel...  a
-000109c0: 7272 6179 496d 6167 6531 4420 3d20 696d  rrayImage1D = im
-000109d0: 6167 652e 7365 6c65 6374 2862 616e 6473  age.select(bands
-000109e0: 292e 746f 4172 7261 7928 290d 0a0d 0a20  ).toArray().... 
-000109f0: 2023 4d61 6b65 2061 6e20 4172 7261 7920   #Make an Array 
-00010a00: 496d 6167 6520 7769 7468 2061 2032 2d44  Image with a 2-D
-00010a10: 2041 7272 6179 2070 6572 2070 6978 656c   Array per pixel
-00010a20: 2c20 3678 312e 0d0a 2020 6172 7261 7949  , 6x1...  arrayI
-00010a30: 6d61 6765 3244 203d 2061 7272 6179 496d  mage2D = arrayIm
-00010a40: 6167 6531 442e 746f 4172 7261 7928 3129  age1D.toArray(1)
-00010a50: 0d0a 0d0a 2020 636f 6d70 6f6e 656e 7473  ....  components
-00010a60: 496d 6167 6520 3d20 6565 2e49 6d61 6765  Image = ee.Image
-00010a70: 2863 6f65 6666 6963 6965 6e74 7329 2e6d  (coefficients).m
-00010a80: 6174 7269 784d 756c 7469 706c 7928 6172  atrixMultiply(ar
-00010a90: 7261 7949 6d61 6765 3244 295c 0d0a 2020  rayImage2D)\..  
-00010aa0: 2e61 7272 6179 5072 6f6a 6563 7428 5b30  .arrayProject([0
-00010ab0: 5d29 5c0d 0a20 202e 6172 7261 7946 6c61  ])\..  .arrayFla
-00010ac0: 7474 656e 285b 5b27 6272 6967 6874 6e65  tten([['brightne
-00010ad0: 7373 272c 2027 6772 6565 6e6e 6573 7327  ss', 'greenness'
-00010ae0: 2c20 2777 6574 6e65 7373 275d 5d29 2e66  , 'wetness']]).f
-00010af0: 6c6f 6174 2829 0d0a 0d0a 2020 7265 7475  loat()....  retu
-00010b00: 726e 2069 6d61 6765 2e61 6464 4261 6e64  rn image.addBand
-00010b10: 7328 636f 6d70 6f6e 656e 7473 496d 6167  s(componentsImag
-00010b20: 6529 0d0a 0d0a 2323 2323 2323 2323 2323  e)....##########
+00010570: 2323 2323 2323 2323 2323 0d0a 6465 6620  ##########..def 
+00010580: 7369 6d70 6c65 4765 7454 6173 7365 6c65  simpleGetTassele
+00010590: 6443 6170 2869 6d61 6765 293a 0d0a 0d0a  dCap(image):....
+000105a0: 2020 6261 6e64 7320 3d20 6565 2e4c 6973    bands = ee.Lis
+000105b0: 7428 5b27 626c 7565 272c 2767 7265 656e  t(['blue','green
+000105c0: 272c 2772 6564 272c 276e 6972 272c 2773  ','red','nir','s
+000105d0: 7769 7231 272c 2773 7769 7232 275d 290d  wir1','swir2']).
+000105e0: 0a20 2023 2020 202f 2f20 2f2f 204b 6175  .  #   // // Kau
+000105f0: 7468 2d54 686f 6d61 7320 636f 6566 6669  th-Thomas coeffi
+00010600: 6369 656e 7473 2066 6f72 2054 6865 6d61  cients for Thema
+00010610: 7469 6320 4d61 7070 6572 2064 6174 610d  tic Mapper data.
+00010620: 0a20 2023 2020 202f 2f20 7661 7220 636f  .  #   // var co
+00010630: 6566 6669 6369 656e 7473 203d 2065 652e  efficients = ee.
+00010640: 4172 7261 7928 5b0d 0a20 2023 2020 202f  Array([..  #   /
+00010650: 2f20 2020 5b30 2e33 3033 372c 2030 2e32  /   [0.3037, 0.2
+00010660: 3739 332c 2030 2e34 3734 332c 2030 2e35  793, 0.4743, 0.5
+00010670: 3538 352c 2030 2e35 3038 322c 2030 2e31  585, 0.5082, 0.1
+00010680: 3836 335d 2c0d 0a20 2023 2020 202f 2f20  863],..  #   // 
+00010690: 2020 5b2d 302e 3238 3438 2c20 2d30 2e32    [-0.2848, -0.2
+000106a0: 3433 352c 202d 302e 3534 3336 2c20 302e  435, -0.5436, 0.
+000106b0: 3732 3433 2c20 302e 3038 3430 2c20 2d30  7243, 0.0840, -0
+000106c0: 2e31 3830 305d 2c0d 0a20 2023 2020 202f  .1800],..  #   /
+000106d0: 2f20 2020 5b30 2e31 3530 392c 2030 2e31  /   [0.1509, 0.1
+000106e0: 3937 332c 2030 2e33 3237 392c 2030 2e33  973, 0.3279, 0.3
+000106f0: 3430 362c 202d 302e 3731 3132 2c20 2d30  406, -0.7112, -0
+00010700: 2e34 3537 325d 2c0d 0a20 2023 2020 202f  .4572],..  #   /
+00010710: 2f20 2020 5b2d 302e 3832 3432 2c20 302e  /   [-0.8242, 0.
+00010720: 3038 3439 2c20 302e 3433 3932 2c20 2d30  0849, 0.4392, -0
+00010730: 2e30 3538 302c 2030 2e32 3031 322c 202d  .0580, 0.2012, -
+00010740: 302e 3237 3638 5d2c 0d0a 2020 2320 2020  0.2768],..  #   
+00010750: 2f2f 2020 205b 2d30 2e33 3238 302c 2030  //   [-0.3280, 0
+00010760: 2e30 3534 392c 2030 2e31 3037 352c 2030  .0549, 0.1075, 0
+00010770: 2e31 3835 352c 202d 302e 3433 3537 2c20  .1855, -0.4357, 
+00010780: 302e 3830 3835 5d2c 0d0a 2020 2320 2020  0.8085],..  #   
+00010790: 2f2f 2020 205b 302e 3130 3834 2c20 2d30  //   [0.1084, -0
+000107a0: 2e39 3032 322c 2030 2e34 3132 302c 2030  .9022, 0.4120, 0
+000107b0: 2e30 3537 332c 202d 302e 3032 3531 2c20  .0573, -0.0251, 
+000107c0: 302e 3032 3338 5d0d 0a20 2023 2020 202f  0.0238]..  #   /
+000107d0: 2f20 5d29 3b0d 0a0d 0a20 2023 4372 6973  / ]);....  #Cris
+000107e0: 7420 3139 3835 2063 6f65 6666 7320 2d20  t 1985 coeffs - 
+000107f0: 544f 4120 7265 666c 2028 6874 7470 3a2f  TOA refl (http:/
+00010800: 2f77 7777 2e67 6973 2e75 7375 2e65 6475  /www.gis.usu.edu
+00010810: 2f7e 646f 7567 2f52 5335 3735 302f 6173  /~doug/RS5750/as
+00010820: 7369 676e 2f4f 4c44 2f52 5345 2831 3729  sign/OLD/RSE(17)
+00010830: 2d33 3031 2e70 6466 290d 0a20 2063 6f65  -301.pdf)..  coe
+00010840: 6666 6963 6965 6e74 7320 3d20 6565 2e41  fficients = ee.A
+00010850: 7272 6179 285b 5b30 2e32 3034 332c 2030  rray([[0.2043, 0
+00010860: 2e34 3135 382c 2030 2e35 3532 342c 2030  .4158, 0.5524, 0
+00010870: 2e35 3734 312c 2030 2e33 3132 342c 2030  .5741, 0.3124, 0
+00010880: 2e32 3330 335d 2c5c 0d0a 2020 2020 2020  .2303],\..      
+00010890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000108a0: 5b2d 302e 3136 3033 2c20 2d30 2e32 3831  [-0.1603, -0.281
+000108b0: 392c 202d 302e 3439 3334 2c20 302e 3739  9, -0.4934, 0.79
+000108c0: 3430 2c20 2d30 2e30 3030 322c 202d 302e  40, -0.0002, -0.
+000108d0: 3134 3436 5d2c 5c0d 0a20 2020 2020 2020  1446],\..       
+000108e0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+000108f0: 302e 3033 3135 2c20 302e 3230 3231 2c20  0.0315, 0.2021, 
+00010900: 302e 3331 3032 2c20 302e 3135 3934 2c20  0.3102, 0.1594, 
+00010910: 2d30 2e36 3830 362c 202d 302e 3631 3039  -0.6806, -0.6109
+00010920: 5d5d 290d 0a20 2023 4d61 6b65 2061 6e20  ]])..  #Make an 
+00010930: 4172 7261 7920 496d 6167 652c 2077 6974  Array Image, wit
+00010940: 6820 6120 312d 4420 4172 7261 7920 7065  h a 1-D Array pe
+00010950: 7220 7069 7865 6c2e 0d0a 2020 6172 7261  r pixel...  arra
+00010960: 7949 6d61 6765 3144 203d 2069 6d61 6765  yImage1D = image
+00010970: 2e73 656c 6563 7428 6261 6e64 7329 2e74  .select(bands).t
+00010980: 6f41 7272 6179 2829 0d0a 0d0a 2020 234d  oArray()....  #M
+00010990: 616b 6520 616e 2041 7272 6179 2049 6d61  ake an Array Ima
+000109a0: 6765 2077 6974 6820 6120 322d 4420 4172  ge with a 2-D Ar
+000109b0: 7261 7920 7065 7220 7069 7865 6c2c 2036  ray per pixel, 6
+000109c0: 7831 2e0d 0a20 2061 7272 6179 496d 6167  x1...  arrayImag
+000109d0: 6532 4420 3d20 6172 7261 7949 6d61 6765  e2D = arrayImage
+000109e0: 3144 2e74 6f41 7272 6179 2831 290d 0a0d  1D.toArray(1)...
+000109f0: 0a20 2063 6f6d 706f 6e65 6e74 7349 6d61  .  componentsIma
+00010a00: 6765 203d 2065 652e 496d 6167 6528 636f  ge = ee.Image(co
+00010a10: 6566 6669 6369 656e 7473 292e 6d61 7472  efficients).matr
+00010a20: 6978 4d75 6c74 6970 6c79 2861 7272 6179  ixMultiply(array
+00010a30: 496d 6167 6532 4429 5c0d 0a20 202e 6172  Image2D)\..  .ar
+00010a40: 7261 7950 726f 6a65 6374 285b 305d 295c  rayProject([0])\
+00010a50: 0d0a 2020 2e61 7272 6179 466c 6174 7465  ..  .arrayFlatte
+00010a60: 6e28 5b5b 2762 7269 6768 746e 6573 7327  n([['brightness'
+00010a70: 2c20 2767 7265 656e 6e65 7373 272c 2027  , 'greenness', '
+00010a80: 7765 746e 6573 7327 5d5d 292e 666c 6f61  wetness']]).floa
+00010a90: 7428 290d 0a0d 0a20 2072 6574 7572 6e20  t()....  return 
+00010aa0: 696d 6167 652e 6164 6442 616e 6473 2863  image.addBands(c
+00010ab0: 6f6d 706f 6e65 6e74 7349 6d61 6765 290d  omponentsImage).
+00010ac0: 0a0d 0a23 2323 2323 2323 2323 2323 2323  ...#############
+00010ad0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00010ae0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00010af0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00010b00: 2323 2323 2323 2323 2323 2323 0d0a 2323  ############..##
+00010b10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00010b20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00010b30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00010b40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00010b50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00010b60: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
-00010b70: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
-00010b80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00010b90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00010ba0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00010bb0: 2323 2323 2323 2323 2323 0d0a 2346 756e  ##########..#Fun
-00010bc0: 6374 696f 6e20 746f 2061 6464 2054 6173  ction to add Tas
-00010bd0: 7365 6c65 6420 4361 7020 616e 676c 6573  seled Cap angles
-00010be0: 2061 6e64 2064 6973 7461 6e63 6573 2074   and distances t
-00010bf0: 6f20 616e 2069 6d61 6765 2e0d 0a23 4173  o an image...#As
-00010c00: 7375 6d65 7320 696d 6167 6520 6861 7320  sumes image has 
-00010c10: 6261 6e64 733a 2027 6272 6967 6874 6e65  bands: 'brightne
-00010c20: 7373 272c 2027 6772 6565 6e6e 6573 7327  ss', 'greenness'
-00010c30: 2c20 616e 6420 2777 6574 6e65 7373 272e  , and 'wetness'.
-00010c40: 0d0a 6465 6620 6164 6454 4341 6e67 6c65  ..def addTCAngle
-00010c50: 7328 696d 6167 6529 3a0d 0a20 2023 5365  s(image):..  #Se
-00010c60: 6c65 6374 2062 7269 6768 746e 6573 732c  lect brightness,
-00010c70: 2067 7265 656e 6e65 7373 2c20 616e 6420   greenness, and 
-00010c80: 7765 746e 6573 7320 6261 6e64 730d 0a20  wetness bands.. 
-00010c90: 2062 7269 6768 746e 6573 7320 3d20 696d   brightness = im
-00010ca0: 6167 652e 7365 6c65 6374 285b 2762 7269  age.select(['bri
-00010cb0: 6768 746e 6573 7327 5d29 0d0a 2020 6772  ghtness'])..  gr
-00010cc0: 6565 6e6e 6573 7320 3d20 696d 6167 652e  eenness = image.
-00010cd0: 7365 6c65 6374 285b 2767 7265 656e 6e65  select(['greenne
-00010ce0: 7373 275d 290d 0a20 2077 6574 6e65 7373  ss'])..  wetness
-00010cf0: 203d 2069 6d61 6765 2e73 656c 6563 7428   = image.select(
-00010d00: 5b27 7765 746e 6573 7327 5d29 0d0a 0d0a  ['wetness'])....
-00010d10: 2020 2343 616c 6375 6c61 7465 2054 6173    #Calculate Tas
-00010d20: 7365 6c65 6420 4361 7020 616e 676c 6573  seled Cap angles
-00010d30: 2061 6e64 2064 6973 7461 6e63 6573 0d0a   and distances..
-00010d40: 2020 7463 416e 676c 6542 4720 3d20 6272    tcAngleBG = br
-00010d50: 6967 6874 6e65 7373 2e61 7461 6e32 2867  ightness.atan2(g
-00010d60: 7265 656e 6e65 7373 292e 6469 7669 6465  reenness).divide
-00010d70: 286d 6174 682e 7069 292e 7265 6e61 6d65  (math.pi).rename
-00010d80: 285b 2774 6341 6e67 6c65 4247 275d 290d  (['tcAngleBG']).
-00010d90: 0a20 2074 6341 6e67 6c65 4757 203d 2067  .  tcAngleGW = g
-00010da0: 7265 656e 6e65 7373 2e61 7461 6e32 2877  reenness.atan2(w
-00010db0: 6574 6e65 7373 292e 6469 7669 6465 286d  etness).divide(m
-00010dc0: 6174 682e 7069 292e 7265 6e61 6d65 285b  ath.pi).rename([
-00010dd0: 2774 6341 6e67 6c65 4757 275d 290d 0a20  'tcAngleGW']).. 
-00010de0: 2074 6341 6e67 6c65 4257 203d 2062 7269   tcAngleBW = bri
-00010df0: 6768 746e 6573 732e 6174 616e 3228 7765  ghtness.atan2(we
-00010e00: 746e 6573 7329 2e64 6976 6964 6528 6d61  tness).divide(ma
-00010e10: 7468 2e70 6929 2e72 656e 616d 6528 5b27  th.pi).rename(['
-00010e20: 7463 416e 676c 6542 5727 5d29 0d0a 2020  tcAngleBW'])..  
-00010e30: 7463 4469 7374 4247 203d 2062 7269 6768  tcDistBG = brigh
-00010e40: 746e 6573 732e 6879 706f 7428 6772 6565  tness.hypot(gree
-00010e50: 6e6e 6573 7329 2e72 656e 616d 6528 5b27  nness).rename(['
-00010e60: 7463 4469 7374 4247 275d 290d 0a20 2074  tcDistBG'])..  t
-00010e70: 6344 6973 7447 5720 3d20 6772 6565 6e6e  cDistGW = greenn
-00010e80: 6573 732e 6879 706f 7428 7765 746e 6573  ess.hypot(wetnes
-00010e90: 7329 2e72 656e 616d 6528 5b27 7463 4469  s).rename(['tcDi
-00010ea0: 7374 4757 275d 290d 0a20 2074 6344 6973  stGW'])..  tcDis
-00010eb0: 7442 5720 3d20 6272 6967 6874 6e65 7373  tBW = brightness
-00010ec0: 2e68 7970 6f74 2877 6574 6e65 7373 292e  .hypot(wetness).
-00010ed0: 7265 6e61 6d65 285b 2774 6344 6973 7442  rename(['tcDistB
-00010ee0: 5727 5d29 0d0a 2020 696d 6167 6520 3d20  W'])..  image = 
-00010ef0: 696d 6167 652e 6164 6442 616e 6473 2874  image.addBands(t
-00010f00: 6341 6e67 6c65 4247 292e 6164 6442 616e  cAngleBG).addBan
-00010f10: 6473 2874 6341 6e67 6c65 4757 295c 0d0a  ds(tcAngleGW)\..
-00010f20: 2020 2020 2e61 6464 4261 6e64 7328 7463      .addBands(tc
-00010f30: 416e 676c 6542 5729 2e61 6464 4261 6e64  AngleBW).addBand
-00010f40: 7328 7463 4469 7374 4247 292e 6164 6442  s(tcDistBG).addB
-00010f50: 616e 6473 2874 6344 6973 7447 5729 5c0d  ands(tcDistGW)\.
-00010f60: 0a20 2020 202e 6164 6442 616e 6473 2874  .    .addBands(t
-00010f70: 6344 6973 7442 5729 0d0a 2020 7265 7475  cDistBW)..  retu
-00010f80: 726e 2069 6d61 6765 0d0a 0d0a 2323 2323  rn image....####
+00010b50: 2323 2323 2323 230d 0a23 4675 6e63 7469  #######..#Functi
+00010b60: 6f6e 2074 6f20 6164 6420 5461 7373 656c  on to add Tassel
+00010b70: 6564 2043 6170 2061 6e67 6c65 7320 616e  ed Cap angles an
+00010b80: 6420 6469 7374 616e 6365 7320 746f 2061  d distances to a
+00010b90: 6e20 696d 6167 652e 0d0a 2341 7373 756d  n image...#Assum
+00010ba0: 6573 2069 6d61 6765 2068 6173 2062 616e  es image has ban
+00010bb0: 6473 3a20 2762 7269 6768 746e 6573 7327  ds: 'brightness'
+00010bc0: 2c20 2767 7265 656e 6e65 7373 272c 2061  , 'greenness', a
+00010bd0: 6e64 2027 7765 746e 6573 7327 2e0d 0a64  nd 'wetness'...d
+00010be0: 6566 2061 6464 5443 416e 676c 6573 2869  ef addTCAngles(i
+00010bf0: 6d61 6765 293a 0d0a 2020 2353 656c 6563  mage):..  #Selec
+00010c00: 7420 6272 6967 6874 6e65 7373 2c20 6772  t brightness, gr
+00010c10: 6565 6e6e 6573 732c 2061 6e64 2077 6574  eenness, and wet
+00010c20: 6e65 7373 2062 616e 6473 0d0a 2020 6272  ness bands..  br
+00010c30: 6967 6874 6e65 7373 203d 2069 6d61 6765  ightness = image
+00010c40: 2e73 656c 6563 7428 5b27 6272 6967 6874  .select(['bright
+00010c50: 6e65 7373 275d 290d 0a20 2067 7265 656e  ness'])..  green
+00010c60: 6e65 7373 203d 2069 6d61 6765 2e73 656c  ness = image.sel
+00010c70: 6563 7428 5b27 6772 6565 6e6e 6573 7327  ect(['greenness'
+00010c80: 5d29 0d0a 2020 7765 746e 6573 7320 3d20  ])..  wetness = 
+00010c90: 696d 6167 652e 7365 6c65 6374 285b 2777  image.select(['w
+00010ca0: 6574 6e65 7373 275d 290d 0a0d 0a20 2023  etness'])....  #
+00010cb0: 4361 6c63 756c 6174 6520 5461 7373 656c  Calculate Tassel
+00010cc0: 6564 2043 6170 2061 6e67 6c65 7320 616e  ed Cap angles an
+00010cd0: 6420 6469 7374 616e 6365 730d 0a20 2074  d distances..  t
+00010ce0: 6341 6e67 6c65 4247 203d 2062 7269 6768  cAngleBG = brigh
+00010cf0: 746e 6573 732e 6174 616e 3228 6772 6565  tness.atan2(gree
+00010d00: 6e6e 6573 7329 2e64 6976 6964 6528 6d61  nness).divide(ma
+00010d10: 7468 2e70 6929 2e72 656e 616d 6528 5b27  th.pi).rename(['
+00010d20: 7463 416e 676c 6542 4727 5d29 0d0a 2020  tcAngleBG'])..  
+00010d30: 7463 416e 676c 6547 5720 3d20 6772 6565  tcAngleGW = gree
+00010d40: 6e6e 6573 732e 6174 616e 3228 7765 746e  nness.atan2(wetn
+00010d50: 6573 7329 2e64 6976 6964 6528 6d61 7468  ess).divide(math
+00010d60: 2e70 6929 2e72 656e 616d 6528 5b27 7463  .pi).rename(['tc
+00010d70: 416e 676c 6547 5727 5d29 0d0a 2020 7463  AngleGW'])..  tc
+00010d80: 416e 676c 6542 5720 3d20 6272 6967 6874  AngleBW = bright
+00010d90: 6e65 7373 2e61 7461 6e32 2877 6574 6e65  ness.atan2(wetne
+00010da0: 7373 292e 6469 7669 6465 286d 6174 682e  ss).divide(math.
+00010db0: 7069 292e 7265 6e61 6d65 285b 2774 6341  pi).rename(['tcA
+00010dc0: 6e67 6c65 4257 275d 290d 0a20 2074 6344  ngleBW'])..  tcD
+00010dd0: 6973 7442 4720 3d20 6272 6967 6874 6e65  istBG = brightne
+00010de0: 7373 2e68 7970 6f74 2867 7265 656e 6e65  ss.hypot(greenne
+00010df0: 7373 292e 7265 6e61 6d65 285b 2774 6344  ss).rename(['tcD
+00010e00: 6973 7442 4727 5d29 0d0a 2020 7463 4469  istBG'])..  tcDi
+00010e10: 7374 4757 203d 2067 7265 656e 6e65 7373  stGW = greenness
+00010e20: 2e68 7970 6f74 2877 6574 6e65 7373 292e  .hypot(wetness).
+00010e30: 7265 6e61 6d65 285b 2774 6344 6973 7447  rename(['tcDistG
+00010e40: 5727 5d29 0d0a 2020 7463 4469 7374 4257  W'])..  tcDistBW
+00010e50: 203d 2062 7269 6768 746e 6573 732e 6879   = brightness.hy
+00010e60: 706f 7428 7765 746e 6573 7329 2e72 656e  pot(wetness).ren
+00010e70: 616d 6528 5b27 7463 4469 7374 4257 275d  ame(['tcDistBW']
+00010e80: 290d 0a20 2069 6d61 6765 203d 2069 6d61  )..  image = ima
+00010e90: 6765 2e61 6464 4261 6e64 7328 7463 416e  ge.addBands(tcAn
+00010ea0: 676c 6542 4729 2e61 6464 4261 6e64 7328  gleBG).addBands(
+00010eb0: 7463 416e 676c 6547 5729 5c0d 0a20 2020  tcAngleGW)\..   
+00010ec0: 202e 6164 6442 616e 6473 2874 6341 6e67   .addBands(tcAng
+00010ed0: 6c65 4257 292e 6164 6442 616e 6473 2874  leBW).addBands(t
+00010ee0: 6344 6973 7442 4729 2e61 6464 4261 6e64  cDistBG).addBand
+00010ef0: 7328 7463 4469 7374 4757 295c 0d0a 2020  s(tcDistGW)\..  
+00010f00: 2020 2e61 6464 4261 6e64 7328 7463 4469    .addBands(tcDi
+00010f10: 7374 4257 290d 0a20 2072 6574 7572 6e20  stBW)..  return 
+00010f20: 696d 6167 650d 0a0d 0a23 2323 2323 2323  image....#######
+00010f30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00010f40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00010f50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00010f60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00010f70: 2323 0d0a 2323 2323 2323 2323 2323 2323  ##..############
+00010f80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00010f90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00010fa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00010fb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00010fc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00010fd0: 2323 2323 230d 0a23 2323 2323 2323 2323  #####..#########
-00010fe0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00010ff0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011000: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011010: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011020: 0d0a 234f 6e6c 7920 6164 6473 2074 6320  ..#Only adds tc 
-00011030: 6267 2061 6e67 6c65 2061 7320 696e 2050  bg angle as in P
-00011040: 6f77 656c 6c20 6574 2061 6c20 3230 3039  owell et al 2009
-00011050: 0d0a 2368 7474 7073 3a2f 2f77 7777 2e73  ..#https://www.s
-00011060: 6369 656e 6365 6469 7265 6374 2e63 6f6d  ciencedirect.com
-00011070: 2f73 6369 656e 6365 2f61 7274 6963 6c65  /science/article
-00011080: 2f70 6969 2f53 3030 3334 3432 3537 3039  /pii/S0034425709
-00011090: 3030 3337 3435 3f76 6961 2533 4469 6875  003745?via%3Dihu
-000110a0: 620d 0a64 6566 2073 696d 706c 6541 6464  b..def simpleAdd
-000110b0: 5443 416e 676c 6573 2869 6d61 6765 293a  TCAngles(image):
-000110c0: 0d0a 2020 2353 656c 6563 7420 6272 6967  ..  #Select brig
-000110d0: 6874 6e65 7373 2c20 6772 6565 6e6e 6573  htness, greennes
-000110e0: 732c 2061 6e64 2077 6574 6e65 7373 2062  s, and wetness b
-000110f0: 616e 6473 0d0a 2020 6272 6967 6874 6e65  ands..  brightne
-00011100: 7373 203d 2069 6d61 6765 2e73 656c 6563  ss = image.selec
-00011110: 7428 5b27 6272 6967 6874 6e65 7373 275d  t(['brightness']
-00011120: 290d 0a20 2067 7265 656e 6e65 7373 203d  )..  greenness =
-00011130: 2069 6d61 6765 2e73 656c 6563 7428 5b27   image.select(['
-00011140: 6772 6565 6e6e 6573 7327 5d29 0d0a 2020  greenness'])..  
-00011150: 7765 746e 6573 7320 3d20 696d 6167 652e  wetness = image.
-00011160: 7365 6c65 6374 285b 2777 6574 6e65 7373  select(['wetness
-00011170: 275d 290d 0a0d 0a20 2023 4361 6c63 756c  '])....  #Calcul
-00011180: 6174 6520 5461 7373 656c 6564 2043 6170  ate Tasseled Cap
-00011190: 2061 6e67 6c65 7320 616e 6420 6469 7374   angles and dist
-000111a0: 616e 6365 730d 0a20 2074 6341 6e67 6c65  ances..  tcAngle
-000111b0: 4247 203d 2062 7269 6768 746e 6573 732e  BG = brightness.
-000111c0: 6174 616e 3228 6772 6565 6e6e 6573 7329  atan2(greenness)
-000111d0: 2e64 6976 6964 6528 6d61 7468 2e70 6929  .divide(math.pi)
-000111e0: 2e72 656e 616d 6528 5b27 7463 416e 676c  .rename(['tcAngl
-000111f0: 6542 4727 5d29 0d0a 0d0a 2020 7265 7475  eBG'])....  retu
-00011200: 726e 2069 6d61 6765 2e61 6464 4261 6e64  rn image.addBand
-00011210: 7328 7463 416e 676c 6542 4729 0d0a 0d0a  s(tcAngleBG)....
+00010fb0: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
+00010fc0: 4f6e 6c79 2061 6464 7320 7463 2062 6720  Only adds tc bg 
+00010fd0: 616e 676c 6520 6173 2069 6e20 506f 7765  angle as in Powe
+00010fe0: 6c6c 2065 7420 616c 2032 3030 390d 0a23  ll et al 2009..#
+00010ff0: 6874 7470 733a 2f2f 7777 772e 7363 6965  https://www.scie
+00011000: 6e63 6564 6972 6563 742e 636f 6d2f 7363  ncedirect.com/sc
+00011010: 6965 6e63 652f 6172 7469 636c 652f 7069  ience/article/pi
+00011020: 692f 5330 3033 3434 3235 3730 3930 3033  i/S0034425709003
+00011030: 3734 353f 7669 6125 3344 6968 7562 0d0a  745?via%3Dihub..
+00011040: 6465 6620 7369 6d70 6c65 4164 6454 4341  def simpleAddTCA
+00011050: 6e67 6c65 7328 696d 6167 6529 3a0d 0a20  ngles(image):.. 
+00011060: 2023 5365 6c65 6374 2062 7269 6768 746e   #Select brightn
+00011070: 6573 732c 2067 7265 656e 6e65 7373 2c20  ess, greenness, 
+00011080: 616e 6420 7765 746e 6573 7320 6261 6e64  and wetness band
+00011090: 730d 0a20 2062 7269 6768 746e 6573 7320  s..  brightness 
+000110a0: 3d20 696d 6167 652e 7365 6c65 6374 285b  = image.select([
+000110b0: 2762 7269 6768 746e 6573 7327 5d29 0d0a  'brightness'])..
+000110c0: 2020 6772 6565 6e6e 6573 7320 3d20 696d    greenness = im
+000110d0: 6167 652e 7365 6c65 6374 285b 2767 7265  age.select(['gre
+000110e0: 656e 6e65 7373 275d 290d 0a20 2077 6574  enness'])..  wet
+000110f0: 6e65 7373 203d 2069 6d61 6765 2e73 656c  ness = image.sel
+00011100: 6563 7428 5b27 7765 746e 6573 7327 5d29  ect(['wetness'])
+00011110: 0d0a 0d0a 2020 2343 616c 6375 6c61 7465  ....  #Calculate
+00011120: 2054 6173 7365 6c65 6420 4361 7020 616e   Tasseled Cap an
+00011130: 676c 6573 2061 6e64 2064 6973 7461 6e63  gles and distanc
+00011140: 6573 0d0a 2020 7463 416e 676c 6542 4720  es..  tcAngleBG 
+00011150: 3d20 6272 6967 6874 6e65 7373 2e61 7461  = brightness.ata
+00011160: 6e32 2867 7265 656e 6e65 7373 292e 6469  n2(greenness).di
+00011170: 7669 6465 286d 6174 682e 7069 292e 7265  vide(math.pi).re
+00011180: 6e61 6d65 285b 2774 6341 6e67 6c65 4247  name(['tcAngleBG
+00011190: 275d 290d 0a0d 0a20 2072 6574 7572 6e20  '])....  return 
+000111a0: 696d 6167 652e 6164 6442 616e 6473 2874  image.addBands(t
+000111b0: 6341 6e67 6c65 4247 290d 0a0d 0a23 2323  cAngleBG)....###
+000111c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000111d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000111e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000111f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011200: 2323 2323 2323 0d0a 2323 2323 2323 2323  ######..########
+00011210: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00011220: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00011230: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00011240: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011250: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011260: 2323 2323 2323 2323 230d 0a23 2323 2323  #########..#####
-00011270: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011280: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011290: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000112a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000112b0: 2323 2323 0d0a 2346 756e 6374 696f 6e20  ####..#Function 
-000112c0: 746f 2061 6464 2073 6f6c 6172 207a 656e  to add solar zen
-000112d0: 6974 6820 616e 6420 617a 696d 7574 6820  ith and azimuth 
-000112e0: 696e 2072 6164 6961 6e73 2061 7320 6261  in radians as ba
-000112f0: 6e64 7320 746f 2069 6d61 6765 0d0a 6465  nds to image..de
-00011300: 6620 6164 645a 656e 6974 6841 7a69 6d75  f addZenithAzimu
-00011310: 7468 280d 0a20 2020 2069 6d67 2c0d 0a20  th(..    img,.. 
-00011320: 2020 2074 6f61 4f72 5352 2c0d 0a20 2020     toaOrSR,..   
-00011330: 207a 656e 6974 6844 6963 7420 3d20 7b27   zenithDict = {'
-00011340: 544f 4127 3a20 2753 554e 5f45 4c45 5641  TOA': 'SUN_ELEVA
-00011350: 5449 4f4e 272c 2753 5227 3a20 2753 4f4c  TION','SR': 'SOL
-00011360: 4152 5f5a 454e 4954 485f 414e 474c 4527  AR_ZENITH_ANGLE'
-00011370: 7d2c 0d0a 2020 2020 617a 696d 7574 6844  },..    azimuthD
-00011380: 6963 7420 3d20 7b27 544f 4127 3a20 2753  ict = {'TOA': 'S
-00011390: 554e 5f41 5a49 4d55 5448 272c 2753 5227  UN_AZIMUTH','SR'
-000113a0: 3a20 2753 4f4c 4152 5f41 5a49 4d55 5448  : 'SOLAR_AZIMUTH
-000113b0: 5f41 4e47 4c45 277d 293a 0d0a 0d0a 2020  _ANGLE'}):....  
-000113c0: 7a65 6e69 7468 203d 2065 652e 496d 6167  zenith = ee.Imag
-000113d0: 652e 636f 6e73 7461 6e74 2869 6d67 2e67  e.constant(img.g
-000113e0: 6574 287a 656e 6974 6844 6963 745b 746f  et(zenithDict[to
-000113f0: 614f 7253 525d 2929 5c0d 0a20 2020 2020  aOrSR]))\..     
-00011400: 2020 2020 202e 6d75 6c74 6970 6c79 286d       .multiply(m
-00011410: 6174 682e 7069 292e 6469 7669 6465 2831  ath.pi).divide(1
-00011420: 3830 292e 666c 6f61 7428 292e 7265 6e61  80).float().rena
-00011430: 6d65 285b 277a 656e 6974 6827 5d29 0d0a  me(['zenith'])..
-00011440: 0d0a 2020 617a 696d 7574 6820 3d20 6565  ..  azimuth = ee
-00011450: 2e49 6d61 6765 2e63 6f6e 7374 616e 7428  .Image.constant(
-00011460: 696d 672e 6765 7428 617a 696d 7574 6844  img.get(azimuthD
-00011470: 6963 745b 746f 614f 7253 525d 2929 5c0d  ict[toaOrSR]))\.
-00011480: 0a20 2020 2020 2020 2020 202e 6d75 6c74  .          .mult
-00011490: 6970 6c79 286d 6174 682e 7069 292e 6469  iply(math.pi).di
-000114a0: 7669 6465 2831 3830 292e 666c 6f61 7428  vide(180).float(
-000114b0: 292e 7265 6e61 6d65 285b 2761 7a69 6d75  ).rename(['azimu
-000114c0: 7468 275d 290d 0a0d 0a20 2072 6574 7572  th'])....  retur
-000114d0: 6e20 696d 672e 6164 6442 616e 6473 287a  n img.addBands(z
-000114e0: 656e 6974 6829 2e61 6464 4261 6e64 7328  enith).addBands(
-000114f0: 617a 696d 7574 6829 0d0a 0d0a 2323 2323  azimuth)....####
+00011250: 230d 0a23 4675 6e63 7469 6f6e 2074 6f20  #..#Function to 
+00011260: 6164 6420 736f 6c61 7220 7a65 6e69 7468  add solar zenith
+00011270: 2061 6e64 2061 7a69 6d75 7468 2069 6e20   and azimuth in 
+00011280: 7261 6469 616e 7320 6173 2062 616e 6473  radians as bands
+00011290: 2074 6f20 696d 6167 650d 0a64 6566 2061   to image..def a
+000112a0: 6464 5a65 6e69 7468 417a 696d 7574 6828  ddZenithAzimuth(
+000112b0: 0d0a 2020 2020 696d 672c 0d0a 2020 2020  ..    img,..    
+000112c0: 746f 614f 7253 522c 0d0a 2020 2020 7a65  toaOrSR,..    ze
+000112d0: 6e69 7468 4469 6374 203d 207b 2754 4f41  nithDict = {'TOA
+000112e0: 273a 2027 5355 4e5f 454c 4556 4154 494f  ': 'SUN_ELEVATIO
+000112f0: 4e27 2c27 5352 273a 2027 534f 4c41 525f  N','SR': 'SOLAR_
+00011300: 5a45 4e49 5448 5f41 4e47 4c45 277d 2c0d  ZENITH_ANGLE'},.
+00011310: 0a20 2020 2061 7a69 6d75 7468 4469 6374  .    azimuthDict
+00011320: 203d 207b 2754 4f41 273a 2027 5355 4e5f   = {'TOA': 'SUN_
+00011330: 415a 494d 5554 4827 2c27 5352 273a 2027  AZIMUTH','SR': '
+00011340: 534f 4c41 525f 415a 494d 5554 485f 414e  SOLAR_AZIMUTH_AN
+00011350: 474c 4527 7d29 3a0d 0a0d 0a20 207a 656e  GLE'}):....  zen
+00011360: 6974 6820 3d20 6565 2e49 6d61 6765 2e63  ith = ee.Image.c
+00011370: 6f6e 7374 616e 7428 696d 672e 6765 7428  onstant(img.get(
+00011380: 7a65 6e69 7468 4469 6374 5b74 6f61 4f72  zenithDict[toaOr
+00011390: 5352 5d29 295c 0d0a 2020 2020 2020 2020  SR]))\..        
+000113a0: 2020 2e6d 756c 7469 706c 7928 6d61 7468    .multiply(math
+000113b0: 2e70 6929 2e64 6976 6964 6528 3138 3029  .pi).divide(180)
+000113c0: 2e66 6c6f 6174 2829 2e72 656e 616d 6528  .float().rename(
+000113d0: 5b27 7a65 6e69 7468 275d 290d 0a0d 0a20  ['zenith']).... 
+000113e0: 2061 7a69 6d75 7468 203d 2065 652e 496d   azimuth = ee.Im
+000113f0: 6167 652e 636f 6e73 7461 6e74 2869 6d67  age.constant(img
+00011400: 2e67 6574 2861 7a69 6d75 7468 4469 6374  .get(azimuthDict
+00011410: 5b74 6f61 4f72 5352 5d29 295c 0d0a 2020  [toaOrSR]))\..  
+00011420: 2020 2020 2020 2020 2e6d 756c 7469 706c          .multipl
+00011430: 7928 6d61 7468 2e70 6929 2e64 6976 6964  y(math.pi).divid
+00011440: 6528 3138 3029 2e66 6c6f 6174 2829 2e72  e(180).float().r
+00011450: 656e 616d 6528 5b27 617a 696d 7574 6827  ename(['azimuth'
+00011460: 5d29 0d0a 0d0a 2020 7265 7475 726e 2069  ])....  return i
+00011470: 6d67 2e61 6464 4261 6e64 7328 7a65 6e69  mg.addBands(zeni
+00011480: 7468 292e 6164 6442 616e 6473 2861 7a69  th).addBands(azi
+00011490: 6d75 7468 290d 0a0d 0a23 2323 2323 2323  muth)....#######
+000114a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000114b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000114c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000114d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000114e0: 2323 0d0a 2323 2323 2323 2323 2323 2323  ##..############
+000114f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00011500: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00011510: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011520: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011530: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011540: 2323 2323 230d 0a23 2323 2323 2323 2323  #####..#########
-00011550: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011560: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011580: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011590: 0d0a 2346 756e 6374 696f 6e20 666f 7220  ..#Function for 
-000115a0: 636f 6d70 7574 696e 6720 7468 6520 6d65  computing the me
-000115b0: 616e 2073 7175 6172 6564 2064 6966 6665  an squared diffe
-000115c0: 7265 6e63 6520 6d65 646f 6964 2066 726f  rence medoid fro
-000115d0: 6d20 616e 2069 6d61 6765 2063 6f6c 6c65  m an image colle
-000115e0: 6374 696f 6e0d 0a23 2041 7320 7468 6520  ction..# As the 
-000115f0: 6461 7461 2061 7265 206e 6f74 206e 6f72  data are not nor
-00011600: 6d61 6c69 7a65 6420 696e 2074 6869 7320  malized in this 
-00011610: 6d65 7468 6f64 2c20 656e 7375 7269 6e67  method, ensuring
-00011620: 2074 6865 206d 6564 6f69 6449 6e63 6c75   the medoidInclu
-00011630: 6465 4261 6e64 7320 6861 7665 2072 6f75  deBands have rou
-00011640: 6768 6c79 2063 6f6d 7061 7261 626c 6520  ghly comparable 
-00011650: 7261 6e67 6573 206f 6620 7661 6c75 6573  ranges of values
-00011660: 0d0a 2320 6865 6c70 7320 7468 6520 6675  ..# helps the fu
-00011670: 6e63 7469 6f6e 2077 6f72 6b20 7072 6f70  nction work prop
-00011680: 6572 6c79 2e20 466f 7220 6578 616d 706c  erly. For exampl
-00011690: 652c 2069 6620 7465 6d70 6572 6174 7572  e, if temperatur
-000116a0: 6520 6973 2069 6e63 6c75 6465 642c 2069  e is included, i
-000116b0: 7420 7769 6c6c 2061 6363 6f75 6e74 2066  t will account f
-000116c0: 6f72 206d 6f73 7420 6f66 2074 6865 2076  or most of the v
-000116d0: 6172 6961 6e63 650d 0a23 2074 6875 7320  ariance..# thus 
-000116e0: 7265 7375 6c74 696e 6720 696e 2061 206d  resulting in a m
-000116f0: 6564 6f69 6420 6d6f 7361 6963 2074 6861  edoid mosaic tha
-00011700: 7420 7769 6c6c 206d 6f72 6520 6f72 206c  t will more or l
-00011710: 6573 7320 6368 6f6f 7365 2076 616c 7565  ess choose value
-00011720: 7320 636c 6f73 6573 7420 746f 2074 6865  s closest to the
-00011730: 206d 6564 6961 6e20 7465 6d70 6572 6174   median temperat
-00011740: 7572 6520 6f6e 6c79 2c20 7261 7468 6572  ure only, rather
-00011750: 2074 6861 6e0d 0a23 2061 6c6c 2074 6865   than..# all the
-00011760: 2062 616e 6473 0d0a 6465 6620 6d65 646f   bands..def medo
-00011770: 6964 4d6f 7361 6963 4d53 4428 696e 436f  idMosaicMSD(inCo
-00011780: 6c6c 6563 7469 6f6e 2c20 6d65 646f 6964  llection, medoid
-00011790: 496e 636c 7564 6542 616e 6473 203d 204e  IncludeBands = N
-000117a0: 6f6e 6529 3a0d 0a0d 0a20 2069 6620 6d65  one):....  if me
-000117b0: 646f 6964 496e 636c 7564 6542 616e 6473  doidIncludeBands
-000117c0: 203d 3d20 4e6f 6e65 3a0d 0a20 2020 206d   == None:..    m
-000117d0: 6564 6f69 6449 6e63 6c75 6465 4261 6e64  edoidIncludeBand
-000117e0: 7320 3d20 6565 2e49 6d61 6765 2869 6e43  s = ee.Image(inC
-000117f0: 6f6c 6c65 6374 696f 6e2e 6669 7273 7428  ollection.first(
-00011800: 2929 2e62 616e 644e 616d 6573 2829 0d0a  )).bandNames()..
-00011810: 0d0a 2020 2346 696e 6420 7468 6520 6d65  ..  #Find the me
-00011820: 6469 616e 0d0a 2020 6d65 6469 616e 203d  dian..  median =
-00011830: 2069 6e43 6f6c 6c65 6374 696f 6e2e 7365   inCollection.se
-00011840: 6c65 6374 286d 6564 6f69 6449 6e63 6c75  lect(medoidInclu
-00011850: 6465 4261 6e64 7329 2e6d 6564 6961 6e28  deBands).median(
-00011860: 290d 0a0d 0a20 2023 4669 6e64 2074 6865  )....  #Find the
-00011870: 2073 7175 6172 6564 2064 6966 6665 7265   squared differe
-00011880: 6e63 6520 6672 6f6d 2074 6865 206d 6564  nce from the med
-00011890: 6961 6e20 666f 7220 6561 6368 2069 6d61  ian for each ima
-000118a0: 6765 0d0a 2020 2320 4d75 6c74 6970 6c79  ge..  # Multiply
-000118b0: 2062 7920 2d31 2073 6f20 7175 616c 6974   by -1 so qualit
-000118c0: 7920 6d6f 7361 6963 2066 756e 6374 696f  y mosaic functio
-000118d0: 6e20 6361 6e20 6265 2075 7365 640d 0a20  n can be used.. 
-000118e0: 2064 6566 206d 7364 4765 7474 6572 2869   def msdGetter(i
-000118f0: 6d67 293a 0d0a 2020 2020 6469 6666 203d  mg):..    diff =
-00011900: 2065 652e 496d 6167 6528 696d 6729 2e73   ee.Image(img).s
-00011910: 656c 6563 7428 6d65 646f 6964 496e 636c  elect(medoidIncl
-00011920: 7564 6542 616e 6473 292e 7375 6274 7261  udeBands).subtra
-00011930: 6374 286d 6564 6961 6e29 2e70 6f77 2832  ct(median).pow(2
-00011940: 290d 0a20 2020 2069 6d67 203d 2061 6464  )..    img = add
-00011950: 5965 6172 4261 6e64 2869 6d67 290d 0a20  YearBand(img).. 
-00011960: 2020 2069 6d67 203d 2061 6464 4a75 6c69     img = addJuli
-00011970: 616e 4461 7942 616e 6428 696d 6729 0d0a  anDayBand(img)..
-00011980: 2020 2020 7265 7475 726e 2064 6966 662e      return diff.
-00011990: 7265 6475 6365 2827 7375 6d27 292e 6d75  reduce('sum').mu
-000119a0: 6c74 6970 6c79 282d 3129 2e61 6464 4261  ltiply(-1).addBa
-000119b0: 6e64 7328 696d 6729 0d0a 2020 6d65 646f  nds(img)..  medo
-000119c0: 6964 203d 2069 6e43 6f6c 6c65 6374 696f  id = inCollectio
-000119d0: 6e2e 6d61 7028 6d73 6447 6574 7465 7229  n.map(msdGetter)
-000119e0: 0d0a 0d0a 2020 234d 696e 696d 697a 6520  ....  #Minimize 
-000119f0: 7468 6520 6469 7374 616e 6365 2061 6372  the distance acr
-00011a00: 6f73 7320 616c 6c20 6261 6e64 7320 6279  oss all bands by
-00011a10: 2066 696e 6469 6e67 2074 6865 2070 6978   finding the pix
-00011a20: 656c 7320 7468 6174 2063 6f72 7265 7370  els that corresp
-00011a30: 6f6e 6420 746f 2074 6865 206d 696e 696d  ond to the minim
-00011a40: 756d 2064 6973 7461 6e63 6520 286d 756c  um distance (mul
-00011a50: 7469 706c 6965 6420 6279 202d 3120 6162  tiplied by -1 ab
-00011a60: 6f76 6529 0d0a 2020 6d65 646f 6964 203d  ove)..  medoid =
-00011a70: 206d 6564 6f69 642e 7175 616c 6974 794d   medoid.qualityM
-00011a80: 6f73 6169 6328 2773 756d 2729 0d0a 2020  osaic('sum')..  
-00011a90: 6d65 646f 6964 203d 206d 6564 6f69 642e  medoid = medoid.
-00011aa0: 7365 6c65 6374 286d 6564 6f69 642e 6261  select(medoid.ba
-00011ab0: 6e64 4e61 6d65 7328 292e 7265 6d6f 7665  ndNames().remove
-00011ac0: 2827 7375 6d27 2929 0d0a 0d0a 2020 7265  ('sum'))....  re
-00011ad0: 7475 726e 206d 6564 6f69 640d 0a23 2323  turn medoid..###
+00011520: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
+00011530: 4675 6e63 7469 6f6e 2066 6f72 2063 6f6d  Function for com
+00011540: 7075 7469 6e67 2074 6865 206d 6561 6e20  puting the mean 
+00011550: 7371 7561 7265 6420 6469 6666 6572 656e  squared differen
+00011560: 6365 206d 6564 6f69 6420 6672 6f6d 2061  ce medoid from a
+00011570: 6e20 696d 6167 6520 636f 6c6c 6563 7469  n image collecti
+00011580: 6f6e 0d0a 2320 4173 2074 6865 2064 6174  on..# As the dat
+00011590: 6120 6172 6520 6e6f 7420 6e6f 726d 616c  a are not normal
+000115a0: 697a 6564 2069 6e20 7468 6973 206d 6574  ized in this met
+000115b0: 686f 642c 2065 6e73 7572 696e 6720 7468  hod, ensuring th
+000115c0: 6520 6d65 646f 6964 496e 636c 7564 6542  e medoidIncludeB
+000115d0: 616e 6473 2068 6176 6520 726f 7567 686c  ands have roughl
+000115e0: 7920 636f 6d70 6172 6162 6c65 2072 616e  y comparable ran
+000115f0: 6765 7320 6f66 2076 616c 7565 730d 0a23  ges of values..#
+00011600: 2068 656c 7073 2074 6865 2066 756e 6374   helps the funct
+00011610: 696f 6e20 776f 726b 2070 726f 7065 726c  ion work properl
+00011620: 792e 2046 6f72 2065 7861 6d70 6c65 2c20  y. For example, 
+00011630: 6966 2074 656d 7065 7261 7475 7265 2069  if temperature i
+00011640: 7320 696e 636c 7564 6564 2c20 6974 2077  s included, it w
+00011650: 696c 6c20 6163 636f 756e 7420 666f 7220  ill account for 
+00011660: 6d6f 7374 206f 6620 7468 6520 7661 7269  most of the vari
+00011670: 616e 6365 0d0a 2320 7468 7573 2072 6573  ance..# thus res
+00011680: 756c 7469 6e67 2069 6e20 6120 6d65 646f  ulting in a medo
+00011690: 6964 206d 6f73 6169 6320 7468 6174 2077  id mosaic that w
+000116a0: 696c 6c20 6d6f 7265 206f 7220 6c65 7373  ill more or less
+000116b0: 2063 686f 6f73 6520 7661 6c75 6573 2063   choose values c
+000116c0: 6c6f 7365 7374 2074 6f20 7468 6520 6d65  losest to the me
+000116d0: 6469 616e 2074 656d 7065 7261 7475 7265  dian temperature
+000116e0: 206f 6e6c 792c 2072 6174 6865 7220 7468   only, rather th
+000116f0: 616e 0d0a 2320 616c 6c20 7468 6520 6261  an..# all the ba
+00011700: 6e64 730d 0a64 6566 206d 6564 6f69 644d  nds..def medoidM
+00011710: 6f73 6169 634d 5344 2869 6e43 6f6c 6c65  osaicMSD(inColle
+00011720: 6374 696f 6e2c 206d 6564 6f69 6449 6e63  ction, medoidInc
+00011730: 6c75 6465 4261 6e64 7320 3d20 4e6f 6e65  ludeBands = None
+00011740: 293a 0d0a 0d0a 2020 6966 206d 6564 6f69  ):....  if medoi
+00011750: 6449 6e63 6c75 6465 4261 6e64 7320 3d3d  dIncludeBands ==
+00011760: 204e 6f6e 653a 0d0a 2020 2020 6d65 646f   None:..    medo
+00011770: 6964 496e 636c 7564 6542 616e 6473 203d  idIncludeBands =
+00011780: 2065 652e 496d 6167 6528 696e 436f 6c6c   ee.Image(inColl
+00011790: 6563 7469 6f6e 2e66 6972 7374 2829 292e  ection.first()).
+000117a0: 6261 6e64 4e61 6d65 7328 290d 0a0d 0a20  bandNames().... 
+000117b0: 2023 4669 6e64 2074 6865 206d 6564 6961   #Find the media
+000117c0: 6e0d 0a20 206d 6564 6961 6e20 3d20 696e  n..  median = in
+000117d0: 436f 6c6c 6563 7469 6f6e 2e73 656c 6563  Collection.selec
+000117e0: 7428 6d65 646f 6964 496e 636c 7564 6542  t(medoidIncludeB
+000117f0: 616e 6473 292e 6d65 6469 616e 2829 0d0a  ands).median()..
+00011800: 0d0a 2020 2346 696e 6420 7468 6520 7371  ..  #Find the sq
+00011810: 7561 7265 6420 6469 6666 6572 656e 6365  uared difference
+00011820: 2066 726f 6d20 7468 6520 6d65 6469 616e   from the median
+00011830: 2066 6f72 2065 6163 6820 696d 6167 650d   for each image.
+00011840: 0a20 2023 204d 756c 7469 706c 7920 6279  .  # Multiply by
+00011850: 202d 3120 736f 2071 7561 6c69 7479 206d   -1 so quality m
+00011860: 6f73 6169 6320 6675 6e63 7469 6f6e 2063  osaic function c
+00011870: 616e 2062 6520 7573 6564 0d0a 2020 6465  an be used..  de
+00011880: 6620 6d73 6447 6574 7465 7228 696d 6729  f msdGetter(img)
+00011890: 3a0d 0a20 2020 2064 6966 6620 3d20 6565  :..    diff = ee
+000118a0: 2e49 6d61 6765 2869 6d67 292e 7365 6c65  .Image(img).sele
+000118b0: 6374 286d 6564 6f69 6449 6e63 6c75 6465  ct(medoidInclude
+000118c0: 4261 6e64 7329 2e73 7562 7472 6163 7428  Bands).subtract(
+000118d0: 6d65 6469 616e 292e 706f 7728 3229 0d0a  median).pow(2)..
+000118e0: 2020 2020 696d 6720 3d20 6164 6459 6561      img = addYea
+000118f0: 7242 616e 6428 696d 6729 0d0a 2020 2020  rBand(img)..    
+00011900: 696d 6720 3d20 6164 644a 756c 6961 6e44  img = addJulianD
+00011910: 6179 4261 6e64 2869 6d67 290d 0a20 2020  ayBand(img)..   
+00011920: 2072 6574 7572 6e20 6469 6666 2e72 6564   return diff.red
+00011930: 7563 6528 2773 756d 2729 2e6d 756c 7469  uce('sum').multi
+00011940: 706c 7928 2d31 292e 6164 6442 616e 6473  ply(-1).addBands
+00011950: 2869 6d67 290d 0a20 206d 6564 6f69 6420  (img)..  medoid 
+00011960: 3d20 696e 436f 6c6c 6563 7469 6f6e 2e6d  = inCollection.m
+00011970: 6170 286d 7364 4765 7474 6572 290d 0a0d  ap(msdGetter)...
+00011980: 0a20 2023 4d69 6e69 6d69 7a65 2074 6865  .  #Minimize the
+00011990: 2064 6973 7461 6e63 6520 6163 726f 7373   distance across
+000119a0: 2061 6c6c 2062 616e 6473 2062 7920 6669   all bands by fi
+000119b0: 6e64 696e 6720 7468 6520 7069 7865 6c73  nding the pixels
+000119c0: 2074 6861 7420 636f 7272 6573 706f 6e64   that correspond
+000119d0: 2074 6f20 7468 6520 6d69 6e69 6d75 6d20   to the minimum 
+000119e0: 6469 7374 616e 6365 2028 6d75 6c74 6970  distance (multip
+000119f0: 6c69 6564 2062 7920 2d31 2061 626f 7665  lied by -1 above
+00011a00: 290d 0a20 206d 6564 6f69 6420 3d20 6d65  )..  medoid = me
+00011a10: 646f 6964 2e71 7561 6c69 7479 4d6f 7361  doid.qualityMosa
+00011a20: 6963 2827 7375 6d27 290d 0a20 206d 6564  ic('sum')..  med
+00011a30: 6f69 6420 3d20 6d65 646f 6964 2e73 656c  oid = medoid.sel
+00011a40: 6563 7428 6d65 646f 6964 2e62 616e 644e  ect(medoid.bandN
+00011a50: 616d 6573 2829 2e72 656d 6f76 6528 2773  ames().remove('s
+00011a60: 756d 2729 290d 0a0d 0a20 2072 6574 7572  um'))....  retur
+00011a70: 6e20 6d65 646f 6964 0d0a 2323 2323 2323  n medoid..######
+00011a80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011a90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011aa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011ab0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011ac0: 2323 230d 0a23 2323 2323 2323 2323 2323  ###..###########
+00011ad0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00011ae0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00011af0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011b00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011b10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011b20: 2323 2323 2323 0d0a 2323 2323 2323 2323  ######..########
-00011b30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011b40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011b50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011b60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011b70: 230d 0a23 4675 6e63 7469 6f6e 2074 6f20  #..#Function to 
-00011b80: 6578 706f 7274 2061 2070 726f 7669 6465  export a provide
-00011b90: 6420 696d 6167 6520 746f 2061 6e20 4545  d image to an EE
-00011ba0: 2061 7373 6574 0d0a 2320 466f 7220 6561   asset..# For ea
-00011bb0: 7274 6865 6e67 696e 652d 6170 6920 7665  rthengine-api ve
-00011bc0: 7273 696f 6e20 302e 312e 3232 360d 0a23  rsion 0.1.226..#
-00011bd0: 2054 6865 7265 2077 6173 2061 6e20 6973   There was an is
-00011be0: 7375 6520 7769 7468 2074 6865 2072 6567  sue with the reg
-00011bf0: 696f 6e20 7769 7468 2074 6869 7320 6e65  ion with this ne
-00011c00: 7720 7665 7273 696f 6e2e 0d0a 2346 726f  w version...#Fro
-00011c10: 6d20 6561 7274 6865 6e67 696e 652d 6170  m earthengine-ap
-00011c20: 6920 6261 7463 682e 4578 706f 7274 2e74  i batch.Export.t
-00011c30: 6f41 7373 6574 2064 6f63 756d 656e 7461  oAsset documenta
-00011c40: 7469 6f6e 3a20 2272 6567 696f 6e3a 2054  tion: "region: T
-00011c50: 6865 206c 6f6e 2c6c 6174 2063 6f6f 7264  he lon,lat coord
-00011c60: 696e 6174 6573 2066 6f72 2061 204c 696e  inates for a Lin
-00011c70: 6561 7252 696e 6720 6f72 2050 6f6c 7967  earRing or Polyg
-00011c80: 6f6e 2073 7065 6369 6679 696e 6720 7468  on specifying th
-00011c90: 6520 7265 6769 6f6e 2074 6f20 6578 706f  e region to expo
-00011ca0: 7274 2e0d 0a23 2020 2020 2043 616e 2062  rt...#     Can b
-00011cb0: 6520 7370 6563 6966 6965 6420 6173 2061  e specified as a
-00011cc0: 206e 6573 7465 6420 6c69 7374 7320 6f66   nested lists of
-00011cd0: 206e 756d 6265 7273 206f 7220 6120 7365   numbers or a se
-00011ce0: 7269 616c 697a 6564 2073 7472 696e 672e  rialized string.
-00011cf0: 2044 6566 6175 6c74 7320 746f 2074 6865   Defaults to the
-00011d00: 2069 6d61 6765 2773 2072 6567 696f 6e2e   image's region.
-00011d10: 220d 0a64 6566 2065 7870 6f72 7454 6f41  "..def exportToA
-00011d20: 7373 6574 5772 6170 7065 7228 696d 6167  ssetWrapper(imag
-00011d30: 6546 6f72 4578 706f 7274 2c61 7373 6574  eForExport,asset
-00011d40: 4e61 6d65 2c61 7373 6574 5061 7468 2c70  Name,assetPath,p
-00011d50: 7972 616d 6964 696e 6750 6f6c 6963 794f  yramidingPolicyO
-00011d60: 626a 6563 7420 3d20 4e6f 6e65 2c72 6f69  bject = None,roi
-00011d70: 3d20 4e6f 6e65 2c73 6361 6c65 3d20 4e6f  = None,scale= No
-00011d80: 6e65 2c63 7273 203d 204e 6f6e 652c 7472  ne,crs = None,tr
-00011d90: 616e 7366 6f72 6d20 3d20 4e6f 6e65 293a  ansform = None):
-00011da0: 0d0a 2020 2347 6574 2072 6964 206f 6620  ..  #Get rid of 
-00011db0: 616e 7920 7370 6163 6573 0d0a 2020 6173  any spaces..  as
-00011dc0: 7365 744e 616d 6520 3d20 6173 7365 744e  setName = assetN
-00011dd0: 616d 652e 7265 706c 6163 6528 222f 5c73  ame.replace("/\s
-00011de0: 2b2f 6722 2c27 2d27 290d 0a20 2061 7373  +/g",'-')..  ass
-00011df0: 6574 5061 7468 203d 2061 7373 6574 5061  etPath = assetPa
-00011e00: 7468 2e72 6570 6c61 6365 2822 2f5c 732b  th.replace("/\s+
-00011e10: 2f67 222c 272d 2729 0d0a 0d0a 2020 2350  /g",'-')....  #P
-00011e20: 756c 6c20 6765 6f6d 6574 7279 2069 6620  ull geometry if 
-00011e30: 6665 6174 7572 6520 6f72 2066 6561 7475  feature or featu
-00011e40: 7265 436f 6c6c 6563 7469 6f6e 0d0a 2020  reCollection..  
-00011e50: 6966 2072 6f69 2021 3d20 4e6f 6e65 3a0d  if roi != None:.
-00011e60: 0a20 2020 2074 7279 3a0d 0a20 2020 2020  .    try:..     
-00011e70: 2072 6f69 203d 2072 6f69 2e67 656f 6d65   roi = roi.geome
-00011e80: 7472 7928 290d 0a20 2020 2065 7863 6570  try()..    excep
-00011e90: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00011ea0: 3a0d 0a20 2020 2020 2078 203d 2065 0d0a  :..      x = e..
-00011eb0: 2020 2020 696d 6167 6546 6f72 4578 706f      imageForExpo
-00011ec0: 7274 203d 2069 6d61 6765 466f 7245 7870  rt = imageForExp
-00011ed0: 6f72 742e 636c 6970 2872 6f69 290d 0a20  ort.clip(roi).. 
-00011ee0: 2020 206f 7574 5265 6769 6f6e 203d 2072     outRegion = r
-00011ef0: 6f69 2e62 6f75 6e64 7328 3130 302c 6372  oi.bounds(100,cr
-00011f00: 7329 0d0a 2020 656c 7365 3a0d 0a20 2020  s)..  else:..   
-00011f10: 206f 7574 5265 6769 6f6e 203d 204e 6f6e   outRegion = Non
-00011f20: 650d 0a0d 0a0d 0a20 2069 6620 7472 616e  e......  if tran
-00011f30: 7366 6f72 6d20 213d 204e 6f6e 6520 616e  sform != None an
-00011f40: 6420 2873 7472 2874 7970 6528 7472 616e  d (str(type(tran
-00011f50: 7366 6f72 6d29 2920 3d3d 2022 3c74 7970  sform)) == "<typ
-00011f60: 6520 276c 6973 7427 3e22 206f 7220 7374  e 'list'>" or st
-00011f70: 7228 7479 7065 2874 7261 6e73 666f 726d  r(type(transform
-00011f80: 2929 203d 3d20 223c 636c 6173 7320 276c  )) == "<class 'l
-00011f90: 6973 7427 3e22 293a 0d0a 2020 2020 7472  ist'>"):..    tr
-00011fa0: 616e 7366 6f72 6d20 3d20 7374 7228 7472  ansform = str(tr
-00011fb0: 616e 7366 6f72 6d29 0d0a 0d0a 2020 6966  ansform)....  if
-00011fc0: 2070 7972 616d 6964 696e 6750 6f6c 6963   pyramidingPolic
-00011fd0: 794f 626a 6563 7420 3d3d 204e 6f6e 653a  yObject == None:
-00011fe0: 0d0a 2020 2020 7079 7261 6d69 6469 6e67  ..    pyramiding
-00011ff0: 506f 6c69 6379 4f62 6a65 6374 203d 207b  PolicyObject = {
-00012000: 272e 6465 6661 756c 7427 3a27 6d65 616e  '.default':'mean
-00012010: 277d 0d0a 2020 656c 6966 2074 7970 6528  '}..  elif type(
-00012020: 7079 7261 6d69 6469 6e67 506f 6c69 6379  pyramidingPolicy
-00012030: 4f62 6a65 6374 2920 3d3d 2073 7472 3a0d  Object) == str:.
-00012040: 0a20 2020 2070 7972 616d 6964 696e 6750  .    pyramidingP
-00012050: 6f6c 6963 794f 626a 6563 7420 3d20 7b27  olicyObject = {'
-00012060: 2e64 6566 6175 6c74 273a 2070 7972 616d  .default': pyram
-00012070: 6964 696e 6750 6f6c 6963 794f 626a 6563  idingPolicyObjec
-00012080: 747d 0d0a 2020 2320 7079 7261 6d69 6469  t}..  # pyramidi
-00012090: 6e67 506f 6c69 6379 4f62 6a65 6374 203d  ngPolicyObject =
-000120a0: 206a 736f 6e2e 6475 6d70 7328 7079 7261   json.dumps(pyra
-000120b0: 6d69 6469 6e67 506f 6c69 6379 4f62 6a65  midingPolicyObje
-000120c0: 6374 290d 0a20 2070 7269 6e74 2827 7079  ct)..  print('py
-000120d0: 7261 6d69 6469 6e67 206f 626a 6563 743a  ramiding object:
-000120e0: 272c 7079 7261 6d69 6469 6e67 506f 6c69  ',pyramidingPoli
-000120f0: 6379 4f62 6a65 6374 290d 0a0d 0a20 2023  cyObject)....  #
-00012100: 204c 5343 2031 2f36 2f32 3020 7761 7320   LSC 1/6/20 was 
-00012110: 6765 7474 696e 6720 6572 726f 723a 2022  getting error: "
-00012120: 6565 2e65 655f 6578 6365 7074 696f 6e2e  ee.ee_exception.
-00012130: 4545 4578 6365 7074 696f 6e3a 204a 534f  EEException: JSO
-00012140: 4e20 7072 6f76 6964 6564 2066 6f72 2072  N provided for r
-00012150: 6564 7563 7469 6f6e 506f 6c69 6379 206d  eductionPolicy m
-00012160: 7573 7420 6265 2061 6e20 6f62 6a65 6374  ust be an object
-00012170: 2e22 2047 6574 7469 6e67 2072 6964 206f  ." Getting rid o
-00012180: 6620 6a73 6f6e 2e64 756d 7073 2829 2073  f json.dumps() s
-00012190: 6565 6d65 6420 746f 2066 6978 2074 6865  eemed to fix the
-000121a0: 2070 726f 626c 656d 0d0a 2020 7420 3d20   problem..  t = 
-000121b0: 6565 2e62 6174 6368 2e45 7870 6f72 742e  ee.batch.Export.
-000121c0: 696d 6167 652e 746f 4173 7365 7428 696d  image.toAsset(im
-000121d0: 6167 6546 6f72 4578 706f 7274 2c0d 0a20  ageForExport,.. 
-000121e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121f0: 2020 2064 6573 6372 6970 7469 6f6e 203d     description =
-00012200: 2061 7373 6574 4e61 6d65 2c0d 0a20 2020   assetName,..   
-00012210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012220: 2061 7373 6574 4964 203d 2061 7373 6574   assetId = asset
-00012230: 5061 7468 2c0d 0a20 2020 2020 2020 2020  Path,..         
-00012240: 2020 2020 2020 2020 2020 2070 7972 616d             pyram
-00012250: 6964 696e 6750 6f6c 6963 7920 3d20 7079  idingPolicy = py
-00012260: 7261 6d69 6469 6e67 506f 6c69 6379 4f62  ramidingPolicyOb
-00012270: 6a65 6374 2c0d 0a20 2020 2020 2020 2020  ject,..         
-00012280: 2020 2020 2020 2020 2020 2064 696d 656e             dimen
-00012290: 7369 6f6e 7320 3d20 4e6f 6e65 2c0d 0a20  sions = None,.. 
-000122a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000122b0: 2020 2072 6567 696f 6e20 3d20 4e6f 6e65     region = None
-000122c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000122d0: 2020 2020 2020 2073 6361 6c65 203d 2073         scale = s
-000122e0: 6361 6c65 2c0d 0a20 2020 2020 2020 2020  cale,..         
-000122f0: 2020 2020 2020 2020 2020 2063 7273 203d             crs =
-00012300: 2063 7273 2c0d 0a20 2020 2020 2020 2020   crs,..         
-00012310: 2020 2020 2020 2020 2020 2063 7273 5472             crsTr
-00012320: 616e 7366 6f72 6d20 3d20 7472 616e 7366  ansform = transf
-00012330: 6f72 6d2c 0d0a 2020 2020 2020 2020 2020  orm,..          
-00012340: 2020 2020 2020 2020 2020 6d61 7850 6978            maxPix
-00012350: 656c 7320 3d20 3165 3133 290d 0a20 2070  els = 1e13)..  p
-00012360: 7269 6e74 2827 4578 706f 7274 696e 673a  rint('Exporting:
-00012370: 272c 6173 7365 744e 616d 6529 0d0a 2020  ',assetName)..  
-00012380: 7072 696e 7428 7429 0d0a 2020 742e 7374  print(t)..  t.st
-00012390: 6172 7428 290d 0a20 2023 204d 6170 2e61  art()..  # Map.a
-000123a0: 6464 4c61 7965 7228 696d 6167 6546 6f72  ddLayer(imageFor
-000123b0: 4578 706f 7274 2c76 697a 5061 7261 6d73  Export,vizParams
-000123c0: 4661 6c73 652c 6173 7365 744e 616d 6529  False,assetName)
-000123d0: 0d0a 6578 706f 7274 546f 4173 7365 7457  ..exportToAssetW
-000123e0: 7261 7070 6572 3320 3d20 6578 706f 7274  rapper3 = export
-000123f0: 546f 4173 7365 7457 7261 7070 6572 0d0a  ToAssetWrapper..
-00012400: 6578 706f 7274 546f 4173 7365 7457 7261  exportToAssetWra
-00012410: 7070 6572 3220 3d20 6578 706f 7274 546f  pper2 = exportTo
-00012420: 4173 7365 7457 7261 7070 6572 0d0a 2323  AssetWrapper..##
-00012430: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012440: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012450: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012460: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012470: 2323 2323 2323 230d 0a64 6566 2065 7870  #######..def exp
-00012480: 6f72 7454 6f44 7269 7665 5772 6170 7065  ortToDriveWrappe
-00012490: 7228 696d 6167 6546 6f72 4578 706f 7274  r(imageForExport
-000124a0: 2c6f 7574 7075 744e 616d 652c 6472 6976  ,outputName,driv
-000124b0: 6546 6f6c 6465 724e 616d 652c 726f 692c  eFolderName,roi,
-000124c0: 7363 616c 653d 204e 6f6e 652c 6372 7320  scale= None,crs 
-000124d0: 3d20 4e6f 6e65 2c74 7261 6e73 666f 726d  = None,transform
-000124e0: 203d 204e 6f6e 652c 6f75 7470 7574 4e6f   = None,outputNo
-000124f0: 4461 7461 203d 202d 3332 3736 3829 3a0d  Data = -32768):.
-00012500: 0a20 206f 7574 7075 744e 616d 6520 3d20  .  outputName = 
-00012510: 6f75 7470 7574 4e61 6d65 2e72 6570 6c61  outputName.repla
-00012520: 6365 2822 2f5c 732b 2f67 222c 272d 2729  ce("/\s+/g",'-')
-00012530: 2347 6574 2072 6964 206f 6620 616e 7920  #Get rid of any 
-00012540: 7370 6163 6573 0d0a 0d0a 2020 2350 756c  spaces....  #Pul
-00012550: 6c20 6765 6f6d 6574 7279 2069 6620 6665  l geometry if fe
-00012560: 6174 7572 6520 6f72 2066 6561 7475 7265  ature or feature
-00012570: 436f 6c6c 6563 7469 6f6e 0d0a 2020 7472  Collection..  tr
-00012580: 793a 0d0a 2020 2020 726f 6920 3d20 726f  y:..    roi = ro
-00012590: 692e 6765 6f6d 6574 7279 2829 0d0a 2020  i.geometry()..  
-000125a0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-000125b0: 2061 7320 653a 0d0a 2020 2020 7820 3d20   as e:..    x = 
-000125c0: 650d 0a0d 0a20 2023 4d61 6b65 2073 7572  e....  #Make sur
-000125d0: 6520 696d 6167 6520 6973 2063 6c69 7070  e image is clipp
-000125e0: 6564 2074 6f20 726f 6920 696e 2063 6173  ed to roi in cas
-000125f0: 6520 6974 2773 2061 206d 756c 7469 2d70  e it's a multi-p
-00012600: 6172 7420 706f 6c79 676f 6e0d 0a20 2069  art polygon..  i
-00012610: 6d61 6765 466f 7245 7870 6f72 7420 3d20  mageForExport = 
-00012620: 696d 6167 6546 6f72 4578 706f 7274 2e63  imageForExport.c
-00012630: 6c69 7028 726f 6929 2e75 6e6d 6173 6b28  lip(roi).unmask(
-00012640: 6f75 7470 7574 4e6f 4461 7461 2c46 616c  outputNoData,Fal
-00012650: 7365 290d 0a0d 0a20 2069 6620 7472 616e  se)....  if tran
-00012660: 7366 6f72 6d20 213d 204e 6f6e 6520 616e  sform != None an
-00012670: 6420 2873 7472 2874 7970 6528 7472 616e  d (str(type(tran
-00012680: 7366 6f72 6d29 2920 3d3d 2022 3c74 7970  sform)) == "<typ
-00012690: 6520 276c 6973 7427 3e22 206f 7220 7374  e 'list'>" or st
-000126a0: 7228 7479 7065 2874 7261 6e73 666f 726d  r(type(transform
-000126b0: 2929 203d 3d20 223c 636c 6173 7320 276c  )) == "<class 'l
-000126c0: 6973 7427 3e22 293a 0d0a 2020 2020 7472  ist'>"):..    tr
-000126d0: 616e 7366 6f72 6d20 3d20 7374 7228 7472  ansform = str(tr
-000126e0: 616e 7366 6f72 6d29 0d0a 0d0a 0d0a 2020  ansform)......  
-000126f0: 2345 6e73 7572 6520 626f 756e 6473 2061  #Ensure bounds a
-00012700: 7265 2069 6e20 6578 706f 7274 2070 726f  re in export pro
-00012710: 6a65 6374 696f 6e0d 0a20 206f 7574 5265  jection..  outRe
-00012720: 6769 6f6e 203d 2072 6f69 2e62 6f75 6e64  gion = roi.bound
-00012730: 7328 3130 302c 6372 7329 0d0a 0d0a 2020  s(100,crs)....  
-00012740: 2320 4d61 702e 6164 644c 6179 6572 2869  # Map.addLayer(i
-00012750: 6d61 6765 466f 7245 7870 6f72 742c 7b7d  mageForExport,{}
-00012760: 2c6f 7574 7075 744e 616d 652c 4661 6c73  ,outputName,Fals
-00012770: 6529 0d0a 2020 7420 3d20 6565 2e62 6174  e)..  t = ee.bat
-00012780: 6368 2e45 7870 6f72 742e 696d 6167 652e  ch.Export.image.
-00012790: 746f 4472 6976 6528 696d 6167 6546 6f72  toDrive(imageFor
-000127a0: 4578 706f 7274 2c20 6f75 7470 7574 4e61  Export, outputNa
-000127b0: 6d65 2c20 6472 6976 6546 6f6c 6465 724e  me, driveFolderN
-000127c0: 616d 652c 206f 7574 7075 744e 616d 652c  ame, outputName,
-000127d0: 204e 6f6e 652c 206f 7574 5265 6769 6f6e   None, outRegion
-000127e0: 2c20 7363 616c 652c 2063 7273 2c20 7472  , scale, crs, tr
-000127f0: 616e 7366 6f72 6d2c 2031 6531 3329 0d0a  ansform, 1e13)..
-00012800: 2020 7072 696e 7428 2745 7870 6f72 7469    print('Exporti
-00012810: 6e67 3a27 2c6f 7574 7075 744e 616d 6529  ng:',outputName)
-00012820: 0d0a 2020 742e 7374 6172 7428 290d 0a23  ..  t.start()..#
-00012830: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012840: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012850: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012860: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012870: 2323 2323 2323 2323 0d0a 6465 6620 6578  ########..def ex
-00012880: 706f 7274 546f 436c 6f75 6453 746f 7261  portToCloudStora
-00012890: 6765 5772 6170 7065 7228 696d 6167 6546  geWrapper(imageF
-000128a0: 6f72 4578 706f 7274 2c6f 7574 7075 744e  orExport,outputN
-000128b0: 616d 652c 6275 636b 6574 4e61 6d65 2c72  ame,bucketName,r
-000128c0: 6f69 2c73 6361 6c65 3d20 4e6f 6e65 2c63  oi,scale= None,c
-000128d0: 7273 203d 204e 6f6e 652c 7472 616e 7366  rs = None,transf
-000128e0: 6f72 6d20 3d20 4e6f 6e65 2c6f 7574 7075  orm = None,outpu
-000128f0: 744e 6f44 6174 6120 3d20 2d33 3237 3638  tNoData = -32768
-00012900: 293a 0d0a 2020 6f75 7470 7574 4e61 6d65  ):..  outputName
-00012910: 203d 206f 7574 7075 744e 616d 652e 7265   = outputName.re
-00012920: 706c 6163 6528 222f 5c73 2b2f 6722 2c27  place("/\s+/g",'
-00012930: 2d27 2923 4765 7420 7269 6420 6f66 2061  -')#Get rid of a
-00012940: 6e79 2073 7061 6365 730d 0a0d 0a20 2023  ny spaces....  #
-00012950: 5075 6c6c 2067 656f 6d65 7472 7920 6966  Pull geometry if
-00012960: 2066 6561 7475 7265 206f 7220 6665 6174   feature or feat
-00012970: 7572 6543 6f6c 6c65 6374 696f 6e0d 0a20  ureCollection.. 
-00012980: 2074 7279 3a0d 0a20 2020 2072 6f69 203d   try:..    roi =
-00012990: 2072 6f69 2e67 656f 6d65 7472 7928 290d   roi.geometry().
-000129a0: 0a20 2065 7863 6570 7420 4578 6365 7074  .  except Except
-000129b0: 696f 6e20 6173 2065 3a0d 0a20 2020 2078  ion as e:..    x
-000129c0: 203d 2065 0d0a 0d0a 2020 234d 616b 6520   = e....  #Make 
-000129d0: 7375 7265 2069 6d61 6765 2069 7320 636c  sure image is cl
-000129e0: 6970 7065 6420 746f 2072 6f69 2069 6e20  ipped to roi in 
-000129f0: 6361 7365 2069 7427 7320 6120 6d75 6c74  case it's a mult
-00012a00: 692d 7061 7274 2070 6f6c 7967 6f6e 0d0a  i-part polygon..
-00012a10: 2020 696d 6167 6546 6f72 4578 706f 7274    imageForExport
-00012a20: 203d 2069 6d61 6765 466f 7245 7870 6f72   = imageForExpor
-00012a30: 742e 636c 6970 2872 6f69 292e 756e 6d61  t.clip(roi).unma
-00012a40: 736b 286f 7574 7075 744e 6f44 6174 612c  sk(outputNoData,
-00012a50: 4661 6c73 6529 0d0a 0d0a 2020 6966 2074  False)....  if t
-00012a60: 7261 6e73 666f 726d 2021 3d20 4e6f 6e65  ransform != None
-00012a70: 2061 6e64 2028 7374 7228 7479 7065 2874   and (str(type(t
-00012a80: 7261 6e73 666f 726d 2929 203d 3d20 223c  ransform)) == "<
-00012a90: 7479 7065 2027 6c69 7374 273e 2220 6f72  type 'list'>" or
-00012aa0: 2073 7472 2874 7970 6528 7472 616e 7366   str(type(transf
-00012ab0: 6f72 6d29 2920 3d3d 2022 3c63 6c61 7373  orm)) == "<class
-00012ac0: 2027 6c69 7374 273e 2229 3a0d 0a20 2020   'list'>"):..   
-00012ad0: 2074 7261 6e73 666f 726d 203d 2073 7472   transform = str
-00012ae0: 2874 7261 6e73 666f 726d 290d 0a0d 0a0d  (transform).....
-00012af0: 0a20 2023 456e 7375 7265 2062 6f75 6e64  .  #Ensure bound
-00012b00: 7320 6172 6520 696e 2065 7870 6f72 7420  s are in export 
-00012b10: 7072 6f6a 6563 7469 6f6e 0d0a 2020 6f75  projection..  ou
-00012b20: 7452 6567 696f 6e20 3d20 726f 692e 626f  tRegion = roi.bo
-00012b30: 756e 6473 2831 3030 2c63 7273 290d 0a0d  unds(100,crs)...
-00012b40: 0a20 2074 203d 2065 652e 6261 7463 682e  .  t = ee.batch.
-00012b50: 4578 706f 7274 2e69 6d61 6765 2e74 6f43  Export.image.toC
-00012b60: 6c6f 7564 5374 6f72 6167 6528 696d 6167  loudStorage(imag
-00012b70: 6546 6f72 4578 706f 7274 2c20 6f75 7470  eForExport, outp
-00012b80: 7574 4e61 6d65 2c20 6275 636b 6574 4e61  utName, bucketNa
-00012b90: 6d65 2c20 6f75 7470 7574 4e61 6d65 2c20  me, outputName, 
-00012ba0: 4e6f 6e65 2c20 6f75 7452 6567 696f 6e2c  None, outRegion,
-00012bb0: 2073 6361 6c65 2c20 6372 732c 2074 7261   scale, crs, tra
-00012bc0: 6e73 666f 726d 2c20 3165 3133 290d 0a20  nsform, 1e13).. 
-00012bd0: 2070 7269 6e74 2827 4578 706f 7274 696e   print('Exportin
-00012be0: 673a 272c 6f75 7470 7574 4e61 6d65 290d  g:',outputName).
-00012bf0: 0a20 2070 7269 6e74 2874 290d 0a20 2074  .  print(t)..  t
-00012c00: 2e73 7461 7274 2829 0d0a 0d0a 0d0a 2323  .start()......##
+00011b00: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
+00011b10: 2346 756e 6374 696f 6e20 746f 2065 7870  #Function to exp
+00011b20: 6f72 7420 6120 7072 6f76 6964 6564 2069  ort a provided i
+00011b30: 6d61 6765 2074 6f20 616e 2045 4520 6173  mage to an EE as
+00011b40: 7365 740d 0a23 2046 6f72 2065 6172 7468  set..# For earth
+00011b50: 656e 6769 6e65 2d61 7069 2076 6572 7369  engine-api versi
+00011b60: 6f6e 2030 2e31 2e32 3236 0d0a 2320 5468  on 0.1.226..# Th
+00011b70: 6572 6520 7761 7320 616e 2069 7373 7565  ere was an issue
+00011b80: 2077 6974 6820 7468 6520 7265 6769 6f6e   with the region
+00011b90: 2077 6974 6820 7468 6973 206e 6577 2076   with this new v
+00011ba0: 6572 7369 6f6e 2e0d 0a23 4672 6f6d 2065  ersion...#From e
+00011bb0: 6172 7468 656e 6769 6e65 2d61 7069 2062  arthengine-api b
+00011bc0: 6174 6368 2e45 7870 6f72 742e 746f 4173  atch.Export.toAs
+00011bd0: 7365 7420 646f 6375 6d65 6e74 6174 696f  set documentatio
+00011be0: 6e3a 2022 7265 6769 6f6e 3a20 5468 6520  n: "region: The 
+00011bf0: 6c6f 6e2c 6c61 7420 636f 6f72 6469 6e61  lon,lat coordina
+00011c00: 7465 7320 666f 7220 6120 4c69 6e65 6172  tes for a Linear
+00011c10: 5269 6e67 206f 7220 506f 6c79 676f 6e20  Ring or Polygon 
+00011c20: 7370 6563 6966 7969 6e67 2074 6865 2072  specifying the r
+00011c30: 6567 696f 6e20 746f 2065 7870 6f72 742e  egion to export.
+00011c40: 0d0a 2320 2020 2020 4361 6e20 6265 2073  ..#     Can be s
+00011c50: 7065 6369 6669 6564 2061 7320 6120 6e65  pecified as a ne
+00011c60: 7374 6564 206c 6973 7473 206f 6620 6e75  sted lists of nu
+00011c70: 6d62 6572 7320 6f72 2061 2073 6572 6961  mbers or a seria
+00011c80: 6c69 7a65 6420 7374 7269 6e67 2e20 4465  lized string. De
+00011c90: 6661 756c 7473 2074 6f20 7468 6520 696d  faults to the im
+00011ca0: 6167 6527 7320 7265 6769 6f6e 2e22 0d0a  age's region."..
+00011cb0: 6465 6620 6578 706f 7274 546f 4173 7365  def exportToAsse
+00011cc0: 7457 7261 7070 6572 2869 6d61 6765 466f  tWrapper(imageFo
+00011cd0: 7245 7870 6f72 742c 6173 7365 744e 616d  rExport,assetNam
+00011ce0: 652c 6173 7365 7450 6174 682c 7079 7261  e,assetPath,pyra
+00011cf0: 6d69 6469 6e67 506f 6c69 6379 4f62 6a65  midingPolicyObje
+00011d00: 6374 203d 204e 6f6e 652c 726f 693d 204e  ct = None,roi= N
+00011d10: 6f6e 652c 7363 616c 653d 204e 6f6e 652c  one,scale= None,
+00011d20: 6372 7320 3d20 4e6f 6e65 2c74 7261 6e73  crs = None,trans
+00011d30: 666f 726d 203d 204e 6f6e 6529 3a0d 0a20  form = None):.. 
+00011d40: 2023 4765 7420 7269 6420 6f66 2061 6e79   #Get rid of any
+00011d50: 2073 7061 6365 730d 0a20 2061 7373 6574   spaces..  asset
+00011d60: 4e61 6d65 203d 2061 7373 6574 4e61 6d65  Name = assetName
+00011d70: 2e72 6570 6c61 6365 2822 2f5c 732b 2f67  .replace("/\s+/g
+00011d80: 222c 272d 2729 0d0a 2020 6173 7365 7450  ",'-')..  assetP
+00011d90: 6174 6820 3d20 6173 7365 7450 6174 682e  ath = assetPath.
+00011da0: 7265 706c 6163 6528 222f 5c73 2b2f 6722  replace("/\s+/g"
+00011db0: 2c27 2d27 290d 0a0d 0a20 2023 5075 6c6c  ,'-')....  #Pull
+00011dc0: 2067 656f 6d65 7472 7920 6966 2066 6561   geometry if fea
+00011dd0: 7475 7265 206f 7220 6665 6174 7572 6543  ture or featureC
+00011de0: 6f6c 6c65 6374 696f 6e0d 0a20 2069 6620  ollection..  if 
+00011df0: 726f 6920 213d 204e 6f6e 653a 0d0a 2020  roi != None:..  
+00011e00: 2020 7472 793a 0d0a 2020 2020 2020 726f    try:..      ro
+00011e10: 6920 3d20 726f 692e 6765 6f6d 6574 7279  i = roi.geometry
+00011e20: 2829 0d0a 2020 2020 6578 6365 7074 2045  ()..    except E
+00011e30: 7863 6570 7469 6f6e 2061 7320 653a 0d0a  xception as e:..
+00011e40: 2020 2020 2020 7820 3d20 650d 0a20 2020        x = e..   
+00011e50: 2069 6d61 6765 466f 7245 7870 6f72 7420   imageForExport 
+00011e60: 3d20 696d 6167 6546 6f72 4578 706f 7274  = imageForExport
+00011e70: 2e63 6c69 7028 726f 6929 0d0a 2020 2020  .clip(roi)..    
+00011e80: 6f75 7452 6567 696f 6e20 3d20 726f 692e  outRegion = roi.
+00011e90: 626f 756e 6473 2831 3030 2c63 7273 290d  bounds(100,crs).
+00011ea0: 0a20 2065 6c73 653a 0d0a 2020 2020 6f75  .  else:..    ou
+00011eb0: 7452 6567 696f 6e20 3d20 4e6f 6e65 0d0a  tRegion = None..
+00011ec0: 0d0a 0d0a 2020 6966 2074 7261 6e73 666f  ....  if transfo
+00011ed0: 726d 2021 3d20 4e6f 6e65 2061 6e64 2028  rm != None and (
+00011ee0: 7374 7228 7479 7065 2874 7261 6e73 666f  str(type(transfo
+00011ef0: 726d 2929 203d 3d20 223c 7479 7065 2027  rm)) == "<type '
+00011f00: 6c69 7374 273e 2220 6f72 2073 7472 2874  list'>" or str(t
+00011f10: 7970 6528 7472 616e 7366 6f72 6d29 2920  ype(transform)) 
+00011f20: 3d3d 2022 3c63 6c61 7373 2027 6c69 7374  == "<class 'list
+00011f30: 273e 2229 3a0d 0a20 2020 2074 7261 6e73  '>"):..    trans
+00011f40: 666f 726d 203d 2073 7472 2874 7261 6e73  form = str(trans
+00011f50: 666f 726d 290d 0a0d 0a20 2069 6620 7079  form)....  if py
+00011f60: 7261 6d69 6469 6e67 506f 6c69 6379 4f62  ramidingPolicyOb
+00011f70: 6a65 6374 203d 3d20 4e6f 6e65 3a0d 0a20  ject == None:.. 
+00011f80: 2020 2070 7972 616d 6964 696e 6750 6f6c     pyramidingPol
+00011f90: 6963 794f 626a 6563 7420 3d20 7b27 2e64  icyObject = {'.d
+00011fa0: 6566 6175 6c74 273a 276d 6561 6e27 7d0d  efault':'mean'}.
+00011fb0: 0a20 2065 6c69 6620 7479 7065 2870 7972  .  elif type(pyr
+00011fc0: 616d 6964 696e 6750 6f6c 6963 794f 626a  amidingPolicyObj
+00011fd0: 6563 7429 203d 3d20 7374 723a 0d0a 2020  ect) == str:..  
+00011fe0: 2020 7079 7261 6d69 6469 6e67 506f 6c69    pyramidingPoli
+00011ff0: 6379 4f62 6a65 6374 203d 207b 272e 6465  cyObject = {'.de
+00012000: 6661 756c 7427 3a20 7079 7261 6d69 6469  fault': pyramidi
+00012010: 6e67 506f 6c69 6379 4f62 6a65 6374 7d0d  ngPolicyObject}.
+00012020: 0a20 2023 2070 7972 616d 6964 696e 6750  .  # pyramidingP
+00012030: 6f6c 6963 794f 626a 6563 7420 3d20 6a73  olicyObject = js
+00012040: 6f6e 2e64 756d 7073 2870 7972 616d 6964  on.dumps(pyramid
+00012050: 696e 6750 6f6c 6963 794f 626a 6563 7429  ingPolicyObject)
+00012060: 0d0a 2020 7072 696e 7428 2770 7972 616d  ..  print('pyram
+00012070: 6964 696e 6720 6f62 6a65 6374 3a27 2c70  iding object:',p
+00012080: 7972 616d 6964 696e 6750 6f6c 6963 794f  yramidingPolicyO
+00012090: 626a 6563 7429 0d0a 0d0a 2020 2320 4c53  bject)....  # LS
+000120a0: 4320 312f 362f 3230 2077 6173 2067 6574  C 1/6/20 was get
+000120b0: 7469 6e67 2065 7272 6f72 3a20 2265 652e  ting error: "ee.
+000120c0: 6565 5f65 7863 6570 7469 6f6e 2e45 4545  ee_exception.EEE
+000120d0: 7863 6570 7469 6f6e 3a20 4a53 4f4e 2070  xception: JSON p
+000120e0: 726f 7669 6465 6420 666f 7220 7265 6475  rovided for redu
+000120f0: 6374 696f 6e50 6f6c 6963 7920 6d75 7374  ctionPolicy must
+00012100: 2062 6520 616e 206f 626a 6563 742e 2220   be an object." 
+00012110: 4765 7474 696e 6720 7269 6420 6f66 206a  Getting rid of j
+00012120: 736f 6e2e 6475 6d70 7328 2920 7365 656d  son.dumps() seem
+00012130: 6564 2074 6f20 6669 7820 7468 6520 7072  ed to fix the pr
+00012140: 6f62 6c65 6d0d 0a20 2074 203d 2065 652e  oblem..  t = ee.
+00012150: 6261 7463 682e 4578 706f 7274 2e69 6d61  batch.Export.ima
+00012160: 6765 2e74 6f41 7373 6574 2869 6d61 6765  ge.toAsset(image
+00012170: 466f 7245 7870 6f72 742c 0d0a 2020 2020  ForExport,..    
+00012180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012190: 6465 7363 7269 7074 696f 6e20 3d20 6173  description = as
+000121a0: 7365 744e 616d 652c 0d0a 2020 2020 2020  setName,..      
+000121b0: 2020 2020 2020 2020 2020 2020 2020 6173                as
+000121c0: 7365 7449 6420 3d20 6173 7365 7450 6174  setId = assetPat
+000121d0: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
+000121e0: 2020 2020 2020 2020 7079 7261 6d69 6469          pyramidi
+000121f0: 6e67 506f 6c69 6379 203d 2070 7972 616d  ngPolicy = pyram
+00012200: 6964 696e 6750 6f6c 6963 794f 626a 6563  idingPolicyObjec
+00012210: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+00012220: 2020 2020 2020 2020 6469 6d65 6e73 696f          dimensio
+00012230: 6e73 203d 204e 6f6e 652c 0d0a 2020 2020  ns = None,..    
+00012240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012250: 7265 6769 6f6e 203d 204e 6f6e 652c 0d0a  region = None,..
+00012260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012270: 2020 2020 7363 616c 6520 3d20 7363 616c      scale = scal
+00012280: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00012290: 2020 2020 2020 2020 6372 7320 3d20 6372          crs = cr
+000122a0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+000122b0: 2020 2020 2020 2020 6372 7354 7261 6e73          crsTrans
+000122c0: 666f 726d 203d 2074 7261 6e73 666f 726d  form = transform
+000122d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000122e0: 2020 2020 2020 206d 6178 5069 7865 6c73         maxPixels
+000122f0: 203d 2031 6531 3329 0d0a 2020 7072 696e   = 1e13)..  prin
+00012300: 7428 2745 7870 6f72 7469 6e67 3a27 2c61  t('Exporting:',a
+00012310: 7373 6574 4e61 6d65 290d 0a20 2070 7269  ssetName)..  pri
+00012320: 6e74 2874 290d 0a20 2074 2e73 7461 7274  nt(t)..  t.start
+00012330: 2829 0d0a 2020 2320 4d61 702e 6164 644c  ()..  # Map.addL
+00012340: 6179 6572 2869 6d61 6765 466f 7245 7870  ayer(imageForExp
+00012350: 6f72 742c 7669 7a50 6172 616d 7346 616c  ort,vizParamsFal
+00012360: 7365 2c61 7373 6574 4e61 6d65 290d 0a65  se,assetName)..e
+00012370: 7870 6f72 7454 6f41 7373 6574 5772 6170  xportToAssetWrap
+00012380: 7065 7233 203d 2065 7870 6f72 7454 6f41  per3 = exportToA
+00012390: 7373 6574 5772 6170 7065 720d 0a65 7870  ssetWrapper..exp
+000123a0: 6f72 7454 6f41 7373 6574 5772 6170 7065  ortToAssetWrappe
+000123b0: 7232 203d 2065 7870 6f72 7454 6f41 7373  r2 = exportToAss
+000123c0: 6574 5772 6170 7065 720d 0a23 2323 2323  etWrapper..#####
+000123d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000123e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000123f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012400: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012410: 2323 2323 0d0a 6465 6620 6578 706f 7274  ####..def export
+00012420: 546f 4472 6976 6557 7261 7070 6572 2869  ToDriveWrapper(i
+00012430: 6d61 6765 466f 7245 7870 6f72 742c 6f75  mageForExport,ou
+00012440: 7470 7574 4e61 6d65 2c64 7269 7665 466f  tputName,driveFo
+00012450: 6c64 6572 4e61 6d65 2c72 6f69 2c73 6361  lderName,roi,sca
+00012460: 6c65 3d20 4e6f 6e65 2c63 7273 203d 204e  le= None,crs = N
+00012470: 6f6e 652c 7472 616e 7366 6f72 6d20 3d20  one,transform = 
+00012480: 4e6f 6e65 2c6f 7574 7075 744e 6f44 6174  None,outputNoDat
+00012490: 6120 3d20 2d33 3237 3638 293a 0d0a 2020  a = -32768):..  
+000124a0: 6f75 7470 7574 4e61 6d65 203d 206f 7574  outputName = out
+000124b0: 7075 744e 616d 652e 7265 706c 6163 6528  putName.replace(
+000124c0: 222f 5c73 2b2f 6722 2c27 2d27 2923 4765  "/\s+/g",'-')#Ge
+000124d0: 7420 7269 6420 6f66 2061 6e79 2073 7061  t rid of any spa
+000124e0: 6365 730d 0a0d 0a20 2023 5075 6c6c 2067  ces....  #Pull g
+000124f0: 656f 6d65 7472 7920 6966 2066 6561 7475  eometry if featu
+00012500: 7265 206f 7220 6665 6174 7572 6543 6f6c  re or featureCol
+00012510: 6c65 6374 696f 6e0d 0a20 2074 7279 3a0d  lection..  try:.
+00012520: 0a20 2020 2072 6f69 203d 2072 6f69 2e67  .    roi = roi.g
+00012530: 656f 6d65 7472 7928 290d 0a20 2065 7863  eometry()..  exc
+00012540: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+00012550: 2065 3a0d 0a20 2020 2078 203d 2065 0d0a   e:..    x = e..
+00012560: 0d0a 2020 234d 616b 6520 7375 7265 2069  ..  #Make sure i
+00012570: 6d61 6765 2069 7320 636c 6970 7065 6420  mage is clipped 
+00012580: 746f 2072 6f69 2069 6e20 6361 7365 2069  to roi in case i
+00012590: 7427 7320 6120 6d75 6c74 692d 7061 7274  t's a multi-part
+000125a0: 2070 6f6c 7967 6f6e 0d0a 2020 696d 6167   polygon..  imag
+000125b0: 6546 6f72 4578 706f 7274 203d 2069 6d61  eForExport = ima
+000125c0: 6765 466f 7245 7870 6f72 742e 636c 6970  geForExport.clip
+000125d0: 2872 6f69 292e 756e 6d61 736b 286f 7574  (roi).unmask(out
+000125e0: 7075 744e 6f44 6174 612c 4661 6c73 6529  putNoData,False)
+000125f0: 0d0a 0d0a 2020 6966 2074 7261 6e73 666f  ....  if transfo
+00012600: 726d 2021 3d20 4e6f 6e65 2061 6e64 2028  rm != None and (
+00012610: 7374 7228 7479 7065 2874 7261 6e73 666f  str(type(transfo
+00012620: 726d 2929 203d 3d20 223c 7479 7065 2027  rm)) == "<type '
+00012630: 6c69 7374 273e 2220 6f72 2073 7472 2874  list'>" or str(t
+00012640: 7970 6528 7472 616e 7366 6f72 6d29 2920  ype(transform)) 
+00012650: 3d3d 2022 3c63 6c61 7373 2027 6c69 7374  == "<class 'list
+00012660: 273e 2229 3a0d 0a20 2020 2074 7261 6e73  '>"):..    trans
+00012670: 666f 726d 203d 2073 7472 2874 7261 6e73  form = str(trans
+00012680: 666f 726d 290d 0a0d 0a0d 0a20 2023 456e  form)......  #En
+00012690: 7375 7265 2062 6f75 6e64 7320 6172 6520  sure bounds are 
+000126a0: 696e 2065 7870 6f72 7420 7072 6f6a 6563  in export projec
+000126b0: 7469 6f6e 0d0a 2020 6f75 7452 6567 696f  tion..  outRegio
+000126c0: 6e20 3d20 726f 692e 626f 756e 6473 2831  n = roi.bounds(1
+000126d0: 3030 2c63 7273 290d 0a0d 0a20 2023 204d  00,crs)....  # M
+000126e0: 6170 2e61 6464 4c61 7965 7228 696d 6167  ap.addLayer(imag
+000126f0: 6546 6f72 4578 706f 7274 2c7b 7d2c 6f75  eForExport,{},ou
+00012700: 7470 7574 4e61 6d65 2c46 616c 7365 290d  tputName,False).
+00012710: 0a20 2074 203d 2065 652e 6261 7463 682e  .  t = ee.batch.
+00012720: 4578 706f 7274 2e69 6d61 6765 2e74 6f44  Export.image.toD
+00012730: 7269 7665 2869 6d61 6765 466f 7245 7870  rive(imageForExp
+00012740: 6f72 742c 206f 7574 7075 744e 616d 652c  ort, outputName,
+00012750: 2064 7269 7665 466f 6c64 6572 4e61 6d65   driveFolderName
+00012760: 2c20 6f75 7470 7574 4e61 6d65 2c20 4e6f  , outputName, No
+00012770: 6e65 2c20 6f75 7452 6567 696f 6e2c 2073  ne, outRegion, s
+00012780: 6361 6c65 2c20 6372 732c 2074 7261 6e73  cale, crs, trans
+00012790: 666f 726d 2c20 3165 3133 290d 0a20 2070  form, 1e13)..  p
+000127a0: 7269 6e74 2827 4578 706f 7274 696e 673a  rint('Exporting:
+000127b0: 272c 6f75 7470 7574 4e61 6d65 290d 0a20  ',outputName).. 
+000127c0: 2074 2e73 7461 7274 2829 0d0a 2323 2323   t.start()..####
+000127d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000127e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000127f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012800: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012810: 2323 2323 230d 0a64 6566 2065 7870 6f72  #####..def expor
+00012820: 7454 6f43 6c6f 7564 5374 6f72 6167 6557  tToCloudStorageW
+00012830: 7261 7070 6572 2869 6d61 6765 466f 7245  rapper(imageForE
+00012840: 7870 6f72 742c 6f75 7470 7574 4e61 6d65  xport,outputName
+00012850: 2c62 7563 6b65 744e 616d 652c 726f 692c  ,bucketName,roi,
+00012860: 7363 616c 653d 204e 6f6e 652c 6372 7320  scale= None,crs 
+00012870: 3d20 4e6f 6e65 2c74 7261 6e73 666f 726d  = None,transform
+00012880: 203d 204e 6f6e 652c 6f75 7470 7574 4e6f   = None,outputNo
+00012890: 4461 7461 203d 202d 3332 3736 3829 3a0d  Data = -32768):.
+000128a0: 0a20 206f 7574 7075 744e 616d 6520 3d20  .  outputName = 
+000128b0: 6f75 7470 7574 4e61 6d65 2e72 6570 6c61  outputName.repla
+000128c0: 6365 2822 2f5c 732b 2f67 222c 272d 2729  ce("/\s+/g",'-')
+000128d0: 2347 6574 2072 6964 206f 6620 616e 7920  #Get rid of any 
+000128e0: 7370 6163 6573 0d0a 0d0a 2020 2350 756c  spaces....  #Pul
+000128f0: 6c20 6765 6f6d 6574 7279 2069 6620 6665  l geometry if fe
+00012900: 6174 7572 6520 6f72 2066 6561 7475 7265  ature or feature
+00012910: 436f 6c6c 6563 7469 6f6e 0d0a 2020 7472  Collection..  tr
+00012920: 793a 0d0a 2020 2020 726f 6920 3d20 726f  y:..    roi = ro
+00012930: 692e 6765 6f6d 6574 7279 2829 0d0a 2020  i.geometry()..  
+00012940: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00012950: 2061 7320 653a 0d0a 2020 2020 7820 3d20   as e:..    x = 
+00012960: 650d 0a0d 0a20 2023 4d61 6b65 2073 7572  e....  #Make sur
+00012970: 6520 696d 6167 6520 6973 2063 6c69 7070  e image is clipp
+00012980: 6564 2074 6f20 726f 6920 696e 2063 6173  ed to roi in cas
+00012990: 6520 6974 2773 2061 206d 756c 7469 2d70  e it's a multi-p
+000129a0: 6172 7420 706f 6c79 676f 6e0d 0a20 2069  art polygon..  i
+000129b0: 6d61 6765 466f 7245 7870 6f72 7420 3d20  mageForExport = 
+000129c0: 696d 6167 6546 6f72 4578 706f 7274 2e63  imageForExport.c
+000129d0: 6c69 7028 726f 6929 2e75 6e6d 6173 6b28  lip(roi).unmask(
+000129e0: 6f75 7470 7574 4e6f 4461 7461 2c46 616c  outputNoData,Fal
+000129f0: 7365 290d 0a0d 0a20 2069 6620 7472 616e  se)....  if tran
+00012a00: 7366 6f72 6d20 213d 204e 6f6e 6520 616e  sform != None an
+00012a10: 6420 2873 7472 2874 7970 6528 7472 616e  d (str(type(tran
+00012a20: 7366 6f72 6d29 2920 3d3d 2022 3c74 7970  sform)) == "<typ
+00012a30: 6520 276c 6973 7427 3e22 206f 7220 7374  e 'list'>" or st
+00012a40: 7228 7479 7065 2874 7261 6e73 666f 726d  r(type(transform
+00012a50: 2929 203d 3d20 223c 636c 6173 7320 276c  )) == "<class 'l
+00012a60: 6973 7427 3e22 293a 0d0a 2020 2020 7472  ist'>"):..    tr
+00012a70: 616e 7366 6f72 6d20 3d20 7374 7228 7472  ansform = str(tr
+00012a80: 616e 7366 6f72 6d29 0d0a 0d0a 0d0a 2020  ansform)......  
+00012a90: 2345 6e73 7572 6520 626f 756e 6473 2061  #Ensure bounds a
+00012aa0: 7265 2069 6e20 6578 706f 7274 2070 726f  re in export pro
+00012ab0: 6a65 6374 696f 6e0d 0a20 206f 7574 5265  jection..  outRe
+00012ac0: 6769 6f6e 203d 2072 6f69 2e62 6f75 6e64  gion = roi.bound
+00012ad0: 7328 3130 302c 6372 7329 0d0a 0d0a 2020  s(100,crs)....  
+00012ae0: 7420 3d20 6565 2e62 6174 6368 2e45 7870  t = ee.batch.Exp
+00012af0: 6f72 742e 696d 6167 652e 746f 436c 6f75  ort.image.toClou
+00012b00: 6453 746f 7261 6765 2869 6d61 6765 466f  dStorage(imageFo
+00012b10: 7245 7870 6f72 742c 206f 7574 7075 744e  rExport, outputN
+00012b20: 616d 652c 2062 7563 6b65 744e 616d 652c  ame, bucketName,
+00012b30: 206f 7574 7075 744e 616d 652c 204e 6f6e   outputName, Non
+00012b40: 652c 206f 7574 5265 6769 6f6e 2c20 7363  e, outRegion, sc
+00012b50: 616c 652c 2063 7273 2c20 7472 616e 7366  ale, crs, transf
+00012b60: 6f72 6d2c 2031 6531 3329 0d0a 2020 7072  orm, 1e13)..  pr
+00012b70: 696e 7428 2745 7870 6f72 7469 6e67 3a27  int('Exporting:'
+00012b80: 2c6f 7574 7075 744e 616d 6529 0d0a 2020  ,outputName)..  
+00012b90: 7072 696e 7428 7429 0d0a 2020 742e 7374  print(t)..  t.st
+00012ba0: 6172 7428 290d 0a0d 0a0d 0a23 2323 2323  art()......#####
+00012bb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012bc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012bd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012be0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012bf0: 2323 2323 0d0a 2323 2323 2323 2323 2323  ####..##########
+00012c00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00012c10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00012c20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012c30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012c40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012c50: 2323 2323 2323 230d 0a23 2323 2323 2323  #######..#######
-00012c60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012c70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012c80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012c90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012ca0: 2323 0d0a 2346 756e 6374 696f 6e20 666f  ##..#Function fo
-00012cb0: 7220 7772 6170 7069 6e67 2064 6174 6573  r wrapping dates
-00012cc0: 2077 6865 6e20 7468 6520 7374 6172 744a   when the startJ
-00012cd0: 756c 6961 6e20 3c20 656e 644a 756c 6961  ulian < endJulia
-00012ce0: 6e0d 0a23 4368 6563 6b73 2066 6f72 2079  n..#Checks for y
-00012cf0: 6561 7220 7769 7468 206d 616a 6f72 6974  ear with majorit
-00012d00: 7920 6f66 2074 6865 2064 6179 7320 616e  y of the days an
-00012d10: 6420 7468 6520 7772 6170 4f66 6673 6574  d the wrapOffset
-00012d20: 0d0a 6465 6620 7772 6170 4461 7465 7328  ..def wrapDates(
-00012d30: 7374 6172 744a 756c 6961 6e2c 656e 644a  startJulian,endJ
-00012d40: 756c 6961 6e29 3a0d 0a20 2023 5365 7420  ulian):..  #Set 
-00012d50: 7570 2064 6174 6520 7772 6170 7069 6e67  up date wrapping
-00012d60: 0d0a 2020 7772 6170 4f66 6673 6574 203d  ..  wrapOffset =
-00012d70: 2030 0d0a 2020 7965 6172 5769 7468 4d61   0..  yearWithMa
-00012d80: 6a6f 7269 7479 203d 2030 0d0a 2020 6966  jority = 0..  if
-00012d90: 2073 7461 7274 4a75 6c69 616e 203e 2065   startJulian > e
-00012da0: 6e64 4a75 6c69 616e 3a0d 0a20 2020 2077  ndJulian:..    w
-00012db0: 7261 704f 6666 7365 7420 3d20 3336 350d  rapOffset = 365.
-00012dc0: 0a20 2020 2079 314e 4461 7973 203d 2033  .    y1NDays = 3
-00012dd0: 3635 2d73 7461 7274 4a75 6c69 616e 0d0a  65-startJulian..
-00012de0: 2020 2020 7932 4e44 6179 7320 3d20 656e      y2NDays = en
-00012df0: 644a 756c 6961 6e0d 0a20 2020 2069 6620  dJulian..    if 
-00012e00: 7932 4e44 6179 7320 3e20 7931 4e44 6179  y2NDays > y1NDay
-00012e10: 733a 0d0a 2020 2020 2020 7965 6172 5769  s:..      yearWi
-00012e20: 7468 4d61 6a6f 7269 7479 203d 2031 0d0a  thMajority = 1..
-00012e30: 0d0a 2020 7265 7475 726e 205b 7772 6170  ..  return [wrap
-00012e40: 4f66 6673 6574 2c79 6561 7257 6974 684d  Offset,yearWithM
-00012e50: 616a 6f72 6974 795d 0d0a 0d0a 2323 2323  ajority]....####
+00012c30: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
+00012c40: 0a23 4675 6e63 7469 6f6e 2066 6f72 2077  .#Function for w
+00012c50: 7261 7070 696e 6720 6461 7465 7320 7768  rapping dates wh
+00012c60: 656e 2074 6865 2073 7461 7274 4a75 6c69  en the startJuli
+00012c70: 616e 203c 2065 6e64 4a75 6c69 616e 0d0a  an < endJulian..
+00012c80: 2343 6865 636b 7320 666f 7220 7965 6172  #Checks for year
+00012c90: 2077 6974 6820 6d61 6a6f 7269 7479 206f   with majority o
+00012ca0: 6620 7468 6520 6461 7973 2061 6e64 2074  f the days and t
+00012cb0: 6865 2077 7261 704f 6666 7365 740d 0a64  he wrapOffset..d
+00012cc0: 6566 2077 7261 7044 6174 6573 2873 7461  ef wrapDates(sta
+00012cd0: 7274 4a75 6c69 616e 2c65 6e64 4a75 6c69  rtJulian,endJuli
+00012ce0: 616e 293a 0d0a 2020 2353 6574 2075 7020  an):..  #Set up 
+00012cf0: 6461 7465 2077 7261 7070 696e 670d 0a20  date wrapping.. 
+00012d00: 2077 7261 704f 6666 7365 7420 3d20 300d   wrapOffset = 0.
+00012d10: 0a20 2079 6561 7257 6974 684d 616a 6f72  .  yearWithMajor
+00012d20: 6974 7920 3d20 300d 0a20 2069 6620 7374  ity = 0..  if st
+00012d30: 6172 744a 756c 6961 6e20 3e20 656e 644a  artJulian > endJ
+00012d40: 756c 6961 6e3a 0d0a 2020 2020 7772 6170  ulian:..    wrap
+00012d50: 4f66 6673 6574 203d 2033 3635 0d0a 2020  Offset = 365..  
+00012d60: 2020 7931 4e44 6179 7320 3d20 3336 352d    y1NDays = 365-
+00012d70: 7374 6172 744a 756c 6961 6e0d 0a20 2020  startJulian..   
+00012d80: 2079 324e 4461 7973 203d 2065 6e64 4a75   y2NDays = endJu
+00012d90: 6c69 616e 0d0a 2020 2020 6966 2079 324e  lian..    if y2N
+00012da0: 4461 7973 203e 2079 314e 4461 7973 3a0d  Days > y1NDays:.
+00012db0: 0a20 2020 2020 2079 6561 7257 6974 684d  .      yearWithM
+00012dc0: 616a 6f72 6974 7920 3d20 310d 0a0d 0a20  ajority = 1.... 
+00012dd0: 2072 6574 7572 6e20 5b77 7261 704f 6666   return [wrapOff
+00012de0: 7365 742c 7965 6172 5769 7468 4d61 6a6f  set,yearWithMajo
+00012df0: 7269 7479 5d0d 0a0d 0a23 2323 2323 2323  rity]....#######
+00012e00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012e10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012e20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012e30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012e40: 2323 0d0a 2323 2323 2323 2323 2323 2323  ##..############
+00012e50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00012e60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00012e70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012e80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012e90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012ea0: 2323 2323 230d 0a23 2323 2323 2323 2323  #####..#########
-00012eb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012ec0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012ed0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012ee0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012ef0: 0d0a 2343 7265 6174 6520 636f 6d70 6f73  ..#Create compos
-00012f00: 6974 6573 2066 6f72 2065 6163 6820 7965  ites for each ye
-00012f10: 6172 2077 6974 6869 6e20 7374 6172 7459  ar within startY
-00012f20: 6561 7220 616e 6420 656e 6459 6561 7220  ear and endYear 
-00012f30: 7261 6e67 650d 0a64 6566 2063 6f6d 706f  range..def compo
-00012f40: 7369 7465 5469 6d65 5365 7269 6573 280d  siteTimeSeries(.
-00012f50: 0a20 2020 2020 206c 732c 0d0a 2020 2020  .      ls,..    
-00012f60: 2020 7374 6172 7459 6561 722c 0d0a 2020    startYear,..  
-00012f70: 2020 2020 656e 6459 6561 722c 0d0a 2020      endYear,..  
-00012f80: 2020 2020 7374 6172 744a 756c 6961 6e2c      startJulian,
-00012f90: 0d0a 2020 2020 2020 656e 644a 756c 6961  ..      endJulia
-00012fa0: 6e2c 0d0a 2020 2020 2020 7469 6d65 6275  n,..      timebu
-00012fb0: 6666 6572 203d 2030 2c0d 0a20 2020 2020  ffer = 0,..     
-00012fc0: 2077 6569 6768 7473 203d 205b 315d 2c0d   weights = [1],.
-00012fd0: 0a20 2020 2020 2063 6f6d 706f 7369 7469  .      compositi
-00012fe0: 6e67 4d65 7468 6f64 203d 204e 6f6e 652c  ngMethod = None,
-00012ff0: 0d0a 2020 2020 2020 636f 6d70 6f73 6974  ..      composit
-00013000: 696e 6752 6564 7563 6572 203d 204e 6f6e  ingReducer = Non
-00013010: 6529 3a0d 0a0d 0a20 2061 7267 7320 3d20  e):....  args = 
-00013020: 666f 726d 6174 4172 6773 286c 6f63 616c  formatArgs(local
-00013030: 7328 2929 0d0a 2020 6966 2027 6172 6773  s())..  if 'args
-00013040: 2720 696e 2061 7267 732e 6b65 7973 2829  ' in args.keys()
-00013050: 3a0d 0a20 2020 2064 656c 2061 7267 735b  :..    del args[
-00013060: 2761 7267 7327 5d0d 0a0d 0a20 2064 756d  'args']....  dum
-00013070: 6d79 496d 6167 6520 3d20 6565 2e49 6d61  myImage = ee.Ima
-00013080: 6765 286c 732e 6669 7273 7428 2929 0d0a  ge(ls.first())..
-00013090: 0d0a 2020 6461 7465 5772 6170 7069 6e67  ..  dateWrapping
-000130a0: 203d 2077 7261 7044 6174 6573 2873 7461   = wrapDates(sta
-000130b0: 7274 4a75 6c69 616e 2c65 6e64 4a75 6c69  rtJulian,endJuli
-000130c0: 616e 290d 0a20 2077 7261 704f 6666 7365  an)..  wrapOffse
-000130d0: 7420 3d20 6461 7465 5772 6170 7069 6e67  t = dateWrapping
-000130e0: 5b30 5d0d 0a20 2079 6561 7257 6974 684d  [0]..  yearWithM
-000130f0: 616a 6f72 6974 7920 3d20 6461 7465 5772  ajority = dateWr
-00013100: 6170 7069 6e67 5b31 5d0d 0a0d 0a0d 0a0d  apping[1].......
-00013110: 0a20 2064 6566 2079 6561 7243 6f6d 706f  .  def yearCompo
-00013120: 7369 7465 4765 7474 6572 2879 6561 7229  siteGetter(year)
-00013130: 3a0d 0a0d 0a20 2020 2023 5365 7420 7570  :....    #Set up
-00013140: 2064 6174 6573 0d0a 2020 2020 7374 6172   dates..    star
-00013150: 7459 6561 7254 203d 2079 6561 722d 7469  tYearT = year-ti
-00013160: 6d65 6275 6666 6572 0d0a 2020 2020 656e  mebuffer..    en
-00013170: 6459 6561 7254 203d 2079 6561 722b 7469  dYearT = year+ti
-00013180: 6d65 6275 6666 6572 0d0a 2020 2020 7374  mebuffer..    st
-00013190: 6172 7444 6174 6554 203d 2065 652e 4461  artDateT = ee.Da
-000131a0: 7465 2e66 726f 6d59 4d44 2873 7461 7274  te.fromYMD(start
-000131b0: 5965 6172 542c 312c 3129 2e61 6476 616e  YearT,1,1).advan
-000131c0: 6365 2873 7461 7274 4a75 6c69 616e 2d31  ce(startJulian-1
-000131d0: 2c27 6461 7927 290d 0a20 2020 2065 6e64  ,'day')..    end
-000131e0: 4461 7465 5420 3d20 6565 2e44 6174 652e  DateT = ee.Date.
-000131f0: 6672 6f6d 594d 4428 656e 6459 6561 7254  fromYMD(endYearT
-00013200: 2c31 2c31 292e 6164 7661 6e63 6528 656e  ,1,1).advance(en
-00013210: 644a 756c 6961 6e2d 312b 7772 6170 4f66  dJulian-1+wrapOf
-00013220: 6673 6574 2c27 6461 7927 290d 0a0d 0a0d  fset,'day').....
-00013230: 0a20 2020 2023 7072 696e 7428 7965 6172  .    #print(year
-00013240: 2c73 7461 7274 4461 7465 542c 656e 6444  ,startDateT,endD
-00013250: 6174 6554 290d 0a0d 0a20 2020 2023 5365  ateT)....    #Se
-00013260: 7420 7570 2077 6569 6768 7465 6420 6d6f  t up weighted mo
-00013270: 7669 6e67 2077 6964 6f77 0d0a 2020 2020  ving widow..    
-00013280: 7965 6172 7354 203d 2065 652e 4c69 7374  yearsT = ee.List
-00013290: 2e73 6571 7565 6e63 6528 7374 6172 7459  .sequence(startY
-000132a0: 6561 7254 2c65 6e64 5965 6172 5429 0d0a  earT,endYearT)..
-000132b0: 0d0a 2020 2020 6465 6620 7a69 7070 6572  ..    def zipper
-000132c0: 2869 293a 0d0a 2020 2020 2020 6920 3d20  (i):..      i = 
-000132d0: 6565 2e4c 6973 7428 6929 0d0a 2020 2020  ee.List(i)..    
-000132e0: 2020 7265 7475 726e 2065 652e 4c69 7374    return ee.List
-000132f0: 2e72 6570 6561 7428 692e 6765 7428 3029  .repeat(i.get(0)
-00013300: 2c69 2e67 6574 2831 2929 0d0a 0d0a 2020  ,i.get(1))....  
-00013310: 2020 7a20 3d20 7965 6172 7354 2e7a 6970    z = yearsT.zip
-00013320: 2877 6569 6768 7473 290d 0a0d 0a20 2020  (weights)....   
-00013330: 2079 6561 7273 5454 203d 207a 2e6d 6170   yearsTT = z.map
-00013340: 287a 6970 7065 7229 2e66 6c61 7474 656e  (zipper).flatten
-00013350: 2829 0d0a 0d0a 2020 2020 2320 7072 696e  ()....    # prin
-00013360: 7428 2757 6569 6768 7465 6420 636f 6d70  t('Weighted comp
-00013370: 6f73 6974 6520 7965 6172 7320 666f 7220  osite years for 
-00013380: 7965 6172 3a27 2c79 6561 722c 7965 6172  year:',year,year
-00013390: 7354 542e 6765 7449 6e66 6f28 2929 0d0a  sTT.getInfo())..
-000133a0: 0d0a 2020 2020 2349 7465 7261 7465 2061  ..    #Iterate a
-000133b0: 6372 6f73 7320 6561 6368 2079 6561 7220  cross each year 
-000133c0: 696e 206c 6973 740d 0a20 2020 2064 6566  in list..    def
-000133d0: 2079 7247 6574 7465 7228 7972 293a 0d0a   yrGetter(yr):..
-000133e0: 2020 2020 2020 2353 6574 2075 7020 6461        #Set up da
-000133f0: 7465 730d 0a20 2020 2020 2073 7461 7274  tes..      start
-00013400: 4461 7465 5420 3d20 6565 2e44 6174 652e  DateT = ee.Date.
-00013410: 6672 6f6d 594d 4428 7972 2c31 2c31 292e  fromYMD(yr,1,1).
-00013420: 6164 7661 6e63 6528 7374 6172 744a 756c  advance(startJul
-00013430: 6961 6e2d 312c 2764 6179 2729 0d0a 2020  ian-1,'day')..  
-00013440: 2020 2020 656e 6444 6174 6554 203d 2065      endDateT = e
-00013450: 652e 4461 7465 2e66 726f 6d59 4d44 2879  e.Date.fromYMD(y
-00013460: 722c 312c 3129 2e61 6476 616e 6365 2865  r,1,1).advance(e
-00013470: 6e64 4a75 6c69 616e 2d31 2b77 7261 704f  ndJulian-1+wrapO
-00013480: 6666 7365 742c 2764 6179 2729 0d0a 0d0a  ffset,'day')....
-00013490: 2020 2020 2020 2346 696c 7465 7220 696d        #Filter im
-000134a0: 6167 6573 2066 6f72 2067 6976 656e 2064  ages for given d
-000134b0: 6174 6520 7261 6e67 650d 0a20 2020 2020  ate range..     
-000134c0: 206c 7354 203d 206c 732e 6669 6c74 6572   lsT = ls.filter
-000134d0: 4461 7465 2873 7461 7274 4461 7465 542c  Date(startDateT,
-000134e0: 656e 6444 6174 6554 2e61 6476 616e 6365  endDateT.advance
-000134f0: 2831 2c27 6461 7927 2929 0d0a 2020 2020  (1,'day'))..    
-00013500: 2020 6c73 5420 3d20 6669 6c6c 456d 7074    lsT = fillEmpt
-00013510: 7943 6f6c 6c65 6374 696f 6e73 286c 7354  yCollections(lsT
-00013520: 2c64 756d 6d79 496d 6167 6529 0d0a 2020  ,dummyImage)..  
-00013530: 2020 2020 7265 7475 726e 206c 7354 0d0a      return lsT..
-00013540: 2020 2020 696d 6167 6573 203d 2079 6561      images = yea
-00013550: 7273 5454 2e6d 6170 2879 7247 6574 7465  rsTT.map(yrGette
-00013560: 7229 0d0a 2020 2020 6c73 5420 3d20 6565  r)..    lsT = ee
-00013570: 2e49 6d61 6765 436f 6c6c 6563 7469 6f6e  .ImageCollection
-00013580: 2865 652e 4665 6174 7572 6543 6f6c 6c65  (ee.FeatureColle
-00013590: 6374 696f 6e28 696d 6167 6573 292e 666c  ction(images).fl
-000135a0: 6174 7465 6e28 2929 0d0a 0d0a 2020 2020  atten())....    
-000135b0: 636f 756e 7420 3d20 6c73 542e 7365 6c65  count = lsT.sele
-000135c0: 6374 285b 305d 292e 636f 756e 7428 292e  ct([0]).count().
-000135d0: 7265 6e61 6d65 285b 2763 6f6d 706f 7369  rename(['composi
-000135e0: 7465 4f62 7343 6f75 6e74 275d 290d 0a20  teObsCount']).. 
-000135f0: 2020 2023 436f 6d70 7574 6520 6d65 6469     #Compute medi
-00013600: 616e 206f 7220 6d65 646f 6964 206f 7220  an or medoid or 
-00013610: 6170 706c 7920 7265 6475 6365 720d 0a20  apply reducer.. 
-00013620: 2020 2069 6620 636f 6d70 6f73 6974 696e     if compositin
-00013630: 6752 6564 7563 6572 2021 3d20 4e6f 6e65  gReducer != None
+00012e80: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
+00012e90: 4372 6561 7465 2063 6f6d 706f 7369 7465  Create composite
+00012ea0: 7320 666f 7220 6561 6368 2079 6561 7220  s for each year 
+00012eb0: 7769 7468 696e 2073 7461 7274 5965 6172  within startYear
+00012ec0: 2061 6e64 2065 6e64 5965 6172 2072 616e   and endYear ran
+00012ed0: 6765 0d0a 6465 6620 636f 6d70 6f73 6974  ge..def composit
+00012ee0: 6554 696d 6553 6572 6965 7328 0d0a 2020  eTimeSeries(..  
+00012ef0: 2020 2020 6c73 2c0d 0a20 2020 2020 2073      ls,..      s
+00012f00: 7461 7274 5965 6172 2c0d 0a20 2020 2020  tartYear,..     
+00012f10: 2065 6e64 5965 6172 2c0d 0a20 2020 2020   endYear,..     
+00012f20: 2073 7461 7274 4a75 6c69 616e 2c0d 0a20   startJulian,.. 
+00012f30: 2020 2020 2065 6e64 4a75 6c69 616e 2c0d       endJulian,.
+00012f40: 0a20 2020 2020 2074 696d 6562 7566 6665  .      timebuffe
+00012f50: 7220 3d20 302c 0d0a 2020 2020 2020 7765  r = 0,..      we
+00012f60: 6967 6874 7320 3d20 5b31 5d2c 0d0a 2020  ights = [1],..  
+00012f70: 2020 2020 636f 6d70 6f73 6974 696e 674d      compositingM
+00012f80: 6574 686f 6420 3d20 4e6f 6e65 2c0d 0a20  ethod = None,.. 
+00012f90: 2020 2020 2063 6f6d 706f 7369 7469 6e67       compositing
+00012fa0: 5265 6475 6365 7220 3d20 4e6f 6e65 293a  Reducer = None):
+00012fb0: 0d0a 0d0a 2020 6172 6773 203d 2066 6f72  ....  args = for
+00012fc0: 6d61 7441 7267 7328 6c6f 6361 6c73 2829  matArgs(locals()
+00012fd0: 290d 0a20 2069 6620 2761 7267 7327 2069  )..  if 'args' i
+00012fe0: 6e20 6172 6773 2e6b 6579 7328 293a 0d0a  n args.keys():..
+00012ff0: 2020 2020 6465 6c20 6172 6773 5b27 6172      del args['ar
+00013000: 6773 275d 0d0a 0d0a 2020 6475 6d6d 7949  gs']....  dummyI
+00013010: 6d61 6765 203d 2065 652e 496d 6167 6528  mage = ee.Image(
+00013020: 6c73 2e66 6972 7374 2829 290d 0a0d 0a20  ls.first()).... 
+00013030: 2064 6174 6557 7261 7070 696e 6720 3d20   dateWrapping = 
+00013040: 7772 6170 4461 7465 7328 7374 6172 744a  wrapDates(startJ
+00013050: 756c 6961 6e2c 656e 644a 756c 6961 6e29  ulian,endJulian)
+00013060: 0d0a 2020 7772 6170 4f66 6673 6574 203d  ..  wrapOffset =
+00013070: 2064 6174 6557 7261 7070 696e 675b 305d   dateWrapping[0]
+00013080: 0d0a 2020 7965 6172 5769 7468 4d61 6a6f  ..  yearWithMajo
+00013090: 7269 7479 203d 2064 6174 6557 7261 7070  rity = dateWrapp
+000130a0: 696e 675b 315d 0d0a 0d0a 0d0a 0d0a 2020  ing[1]........  
+000130b0: 6465 6620 7965 6172 436f 6d70 6f73 6974  def yearComposit
+000130c0: 6547 6574 7465 7228 7965 6172 293a 0d0a  eGetter(year):..
+000130d0: 0d0a 2020 2020 2353 6574 2075 7020 6461  ..    #Set up da
+000130e0: 7465 730d 0a20 2020 2073 7461 7274 5965  tes..    startYe
+000130f0: 6172 5420 3d20 7965 6172 2d74 696d 6562  arT = year-timeb
+00013100: 7566 6665 720d 0a20 2020 2065 6e64 5965  uffer..    endYe
+00013110: 6172 5420 3d20 7965 6172 2b74 696d 6562  arT = year+timeb
+00013120: 7566 6665 720d 0a20 2020 2073 7461 7274  uffer..    start
+00013130: 4461 7465 5420 3d20 6565 2e44 6174 652e  DateT = ee.Date.
+00013140: 6672 6f6d 594d 4428 7374 6172 7459 6561  fromYMD(startYea
+00013150: 7254 2c31 2c31 292e 6164 7661 6e63 6528  rT,1,1).advance(
+00013160: 7374 6172 744a 756c 6961 6e2d 312c 2764  startJulian-1,'d
+00013170: 6179 2729 0d0a 2020 2020 656e 6444 6174  ay')..    endDat
+00013180: 6554 203d 2065 652e 4461 7465 2e66 726f  eT = ee.Date.fro
+00013190: 6d59 4d44 2865 6e64 5965 6172 542c 312c  mYMD(endYearT,1,
+000131a0: 3129 2e61 6476 616e 6365 2865 6e64 4a75  1).advance(endJu
+000131b0: 6c69 616e 2d31 2b77 7261 704f 6666 7365  lian-1+wrapOffse
+000131c0: 742c 2764 6179 2729 0d0a 0d0a 0d0a 2020  t,'day')......  
+000131d0: 2020 2370 7269 6e74 2879 6561 722c 7374    #print(year,st
+000131e0: 6172 7444 6174 6554 2c65 6e64 4461 7465  artDateT,endDate
+000131f0: 5429 0d0a 0d0a 2020 2020 2353 6574 2075  T)....    #Set u
+00013200: 7020 7765 6967 6874 6564 206d 6f76 696e  p weighted movin
+00013210: 6720 7769 646f 770d 0a20 2020 2079 6561  g widow..    yea
+00013220: 7273 5420 3d20 6565 2e4c 6973 742e 7365  rsT = ee.List.se
+00013230: 7175 656e 6365 2873 7461 7274 5965 6172  quence(startYear
+00013240: 542c 656e 6459 6561 7254 290d 0a0d 0a20  T,endYearT).... 
+00013250: 2020 2064 6566 207a 6970 7065 7228 6929     def zipper(i)
+00013260: 3a0d 0a20 2020 2020 2069 203d 2065 652e  :..      i = ee.
+00013270: 4c69 7374 2869 290d 0a20 2020 2020 2072  List(i)..      r
+00013280: 6574 7572 6e20 6565 2e4c 6973 742e 7265  eturn ee.List.re
+00013290: 7065 6174 2869 2e67 6574 2830 292c 692e  peat(i.get(0),i.
+000132a0: 6765 7428 3129 290d 0a0d 0a20 2020 207a  get(1))....    z
+000132b0: 203d 2079 6561 7273 542e 7a69 7028 7765   = yearsT.zip(we
+000132c0: 6967 6874 7329 0d0a 0d0a 2020 2020 7965  ights)....    ye
+000132d0: 6172 7354 5420 3d20 7a2e 6d61 7028 7a69  arsTT = z.map(zi
+000132e0: 7070 6572 292e 666c 6174 7465 6e28 290d  pper).flatten().
+000132f0: 0a0d 0a20 2020 2023 2070 7269 6e74 2827  ...    # print('
+00013300: 5765 6967 6874 6564 2063 6f6d 706f 7369  Weighted composi
+00013310: 7465 2079 6561 7273 2066 6f72 2079 6561  te years for yea
+00013320: 723a 272c 7965 6172 2c79 6561 7273 5454  r:',year,yearsTT
+00013330: 2e67 6574 496e 666f 2829 290d 0a0d 0a20  .getInfo()).... 
+00013340: 2020 2023 4974 6572 6174 6520 6163 726f     #Iterate acro
+00013350: 7373 2065 6163 6820 7965 6172 2069 6e20  ss each year in 
+00013360: 6c69 7374 0d0a 2020 2020 6465 6620 7972  list..    def yr
+00013370: 4765 7474 6572 2879 7229 3a0d 0a20 2020  Getter(yr):..   
+00013380: 2020 2023 5365 7420 7570 2064 6174 6573     #Set up dates
+00013390: 0d0a 2020 2020 2020 7374 6172 7444 6174  ..      startDat
+000133a0: 6554 203d 2065 652e 4461 7465 2e66 726f  eT = ee.Date.fro
+000133b0: 6d59 4d44 2879 722c 312c 3129 2e61 6476  mYMD(yr,1,1).adv
+000133c0: 616e 6365 2873 7461 7274 4a75 6c69 616e  ance(startJulian
+000133d0: 2d31 2c27 6461 7927 290d 0a20 2020 2020  -1,'day')..     
+000133e0: 2065 6e64 4461 7465 5420 3d20 6565 2e44   endDateT = ee.D
+000133f0: 6174 652e 6672 6f6d 594d 4428 7972 2c31  ate.fromYMD(yr,1
+00013400: 2c31 292e 6164 7661 6e63 6528 656e 644a  ,1).advance(endJ
+00013410: 756c 6961 6e2d 312b 7772 6170 4f66 6673  ulian-1+wrapOffs
+00013420: 6574 2c27 6461 7927 290d 0a0d 0a20 2020  et,'day')....   
+00013430: 2020 2023 4669 6c74 6572 2069 6d61 6765     #Filter image
+00013440: 7320 666f 7220 6769 7665 6e20 6461 7465  s for given date
+00013450: 2072 616e 6765 0d0a 2020 2020 2020 6c73   range..      ls
+00013460: 5420 3d20 6c73 2e66 696c 7465 7244 6174  T = ls.filterDat
+00013470: 6528 7374 6172 7444 6174 6554 2c65 6e64  e(startDateT,end
+00013480: 4461 7465 542e 6164 7661 6e63 6528 312c  DateT.advance(1,
+00013490: 2764 6179 2729 290d 0a20 2020 2020 206c  'day'))..      l
+000134a0: 7354 203d 2066 696c 6c45 6d70 7479 436f  sT = fillEmptyCo
+000134b0: 6c6c 6563 7469 6f6e 7328 6c73 542c 6475  llections(lsT,du
+000134c0: 6d6d 7949 6d61 6765 290d 0a20 2020 2020  mmyImage)..     
+000134d0: 2072 6574 7572 6e20 6c73 540d 0a20 2020   return lsT..   
+000134e0: 2069 6d61 6765 7320 3d20 7965 6172 7354   images = yearsT
+000134f0: 542e 6d61 7028 7972 4765 7474 6572 290d  T.map(yrGetter).
+00013500: 0a20 2020 206c 7354 203d 2065 652e 496d  .    lsT = ee.Im
+00013510: 6167 6543 6f6c 6c65 6374 696f 6e28 6565  ageCollection(ee
+00013520: 2e46 6561 7475 7265 436f 6c6c 6563 7469  .FeatureCollecti
+00013530: 6f6e 2869 6d61 6765 7329 2e66 6c61 7474  on(images).flatt
+00013540: 656e 2829 290d 0a0d 0a20 2020 2063 6f75  en())....    cou
+00013550: 6e74 203d 206c 7354 2e73 656c 6563 7428  nt = lsT.select(
+00013560: 5b30 5d29 2e63 6f75 6e74 2829 2e72 656e  [0]).count().ren
+00013570: 616d 6528 5b27 636f 6d70 6f73 6974 654f  ame(['compositeO
+00013580: 6273 436f 756e 7427 5d29 0d0a 2020 2020  bsCount'])..    
+00013590: 2343 6f6d 7075 7465 206d 6564 6961 6e20  #Compute median 
+000135a0: 6f72 206d 6564 6f69 6420 6f72 2061 7070  or medoid or app
+000135b0: 6c79 2072 6564 7563 6572 0d0a 2020 2020  ly reducer..    
+000135c0: 6966 2063 6f6d 706f 7369 7469 6e67 5265  if compositingRe
+000135d0: 6475 6365 7220 213d 204e 6f6e 653a 0d0a  ducer != None:..
+000135e0: 2020 2020 2020 636f 6d70 6f73 6974 6520        composite 
+000135f0: 3d20 6c73 542e 7265 6475 6365 2863 6f6d  = lsT.reduce(com
+00013600: 706f 7369 7469 6e67 5265 6475 6365 7229  positingReducer)
+00013610: 0d0a 2020 2020 656c 6966 2063 6f6d 706f  ..    elif compo
+00013620: 7369 7469 6e67 4d65 7468 6f64 2e6c 6f77  sitingMethod.low
+00013630: 6572 2829 203d 3d20 276d 6564 6961 6e27  er() == 'median'
 00013640: 3a0d 0a20 2020 2020 2063 6f6d 706f 7369  :..      composi
-00013650: 7465 203d 206c 7354 2e72 6564 7563 6528  te = lsT.reduce(
-00013660: 636f 6d70 6f73 6974 696e 6752 6564 7563  compositingReduc
-00013670: 6572 290d 0a20 2020 2065 6c69 6620 636f  er)..    elif co
-00013680: 6d70 6f73 6974 696e 674d 6574 686f 642e  mpositingMethod.
-00013690: 6c6f 7765 7228 2920 3d3d 2027 6d65 6469  lower() == 'medi
-000136a0: 616e 273a 0d0a 2020 2020 2020 636f 6d70  an':..      comp
-000136b0: 6f73 6974 6520 3d20 6c73 542e 6d65 6469  osite = lsT.medi
-000136c0: 616e 2829 0d0a 2020 2020 656c 7365 3a0d  an()..    else:.
-000136d0: 0a20 2020 2020 2063 6f6d 706f 7369 7465  .      composite
-000136e0: 203d 206d 6564 6f69 644d 6f73 6169 634d   = medoidMosaicM
-000136f0: 5344 286c 7354 2c5b 2767 7265 656e 272c  SD(lsT,['green',
-00013700: 2772 6564 272c 276e 6972 272c 2773 7769  'red','nir','swi
-00013710: 7231 272c 2773 7769 7232 275d 290d 0a20  r1','swir2']).. 
-00013720: 2020 2063 6f6d 706f 7369 7465 203d 2063     composite = c
-00013730: 6f6d 706f 7369 7465 2e61 6464 4261 6e64  omposite.addBand
-00013740: 7328 636f 756e 7429 2e66 6c6f 6174 2829  s(count).float()
-00013750: 0d0a 0d0a 2020 2020 7265 7475 726e 2063  ....    return c
-00013760: 6f6d 706f 7369 7465 2e73 6574 287b 2773  omposite.set({'s
-00013770: 7973 7465 6d3a 7469 6d65 5f73 7461 7274  ystem:time_start
-00013780: 273a 6565 2e44 6174 652e 6672 6f6d 594d  ':ee.Date.fromYM
-00013790: 4428 7965 6172 2b20 7965 6172 5769 7468  D(year+ yearWith
-000137a0: 4d61 6a6f 7269 7479 2c36 2c31 292e 6d69  Majority,6,1).mi
-000137b0: 6c6c 6973 2829 2c5c 0d0a 2020 2020 2020  llis(),\..      
-000137c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000137d0: 2020 2773 7461 7274 4461 7465 273a 7374    'startDate':st
-000137e0: 6172 7444 6174 6554 2e6d 696c 6c69 7328  artDateT.millis(
-000137f0: 292c 5c0d 0a20 2020 2020 2020 2020 2020  ),\..           
-00013800: 2020 2020 2020 2020 2020 2020 2027 656e               'en
-00013810: 6444 6174 6527 3a65 6e64 4461 7465 542e  dDate':endDateT.
-00013820: 6d69 6c6c 6973 2829 2c5c 0d0a 2020 2020  millis(),\..    
+00013650: 7465 203d 206c 7354 2e6d 6564 6961 6e28  te = lsT.median(
+00013660: 290d 0a20 2020 2065 6c73 653a 0d0a 2020  )..    else:..  
+00013670: 2020 2020 636f 6d70 6f73 6974 6520 3d20      composite = 
+00013680: 6d65 646f 6964 4d6f 7361 6963 4d53 4428  medoidMosaicMSD(
+00013690: 6c73 542c 5b27 6772 6565 6e27 2c27 7265  lsT,['green','re
+000136a0: 6427 2c27 6e69 7227 2c27 7377 6972 3127  d','nir','swir1'
+000136b0: 2c27 7377 6972 3227 5d29 0d0a 2020 2020  ,'swir2'])..    
+000136c0: 636f 6d70 6f73 6974 6520 3d20 636f 6d70  composite = comp
+000136d0: 6f73 6974 652e 6164 6442 616e 6473 2863  osite.addBands(c
+000136e0: 6f75 6e74 292e 666c 6f61 7428 290d 0a0d  ount).float()...
+000136f0: 0a20 2020 2072 6574 7572 6e20 636f 6d70  .    return comp
+00013700: 6f73 6974 652e 7365 7428 7b27 7379 7374  osite.set({'syst
+00013710: 656d 3a74 696d 655f 7374 6172 7427 3a65  em:time_start':e
+00013720: 652e 4461 7465 2e66 726f 6d59 4d44 2879  e.Date.fromYMD(y
+00013730: 6561 722b 2079 6561 7257 6974 684d 616a  ear+ yearWithMaj
+00013740: 6f72 6974 792c 362c 3129 2e6d 696c 6c69  ority,6,1).milli
+00013750: 7328 292c 5c0d 0a20 2020 2020 2020 2020  s(),\..         
+00013760: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00013770: 7374 6172 7444 6174 6527 3a73 7461 7274  startDate':start
+00013780: 4461 7465 542e 6d69 6c6c 6973 2829 2c5c  DateT.millis(),\
+00013790: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000137a0: 2020 2020 2020 2020 2020 2765 6e64 4461            'endDa
+000137b0: 7465 273a 656e 6444 6174 6554 2e6d 696c  te':endDateT.mil
+000137c0: 6c69 7328 292c 5c0d 0a20 2020 2020 2020  lis(),\..       
+000137d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000137e0: 2027 7374 6172 744a 756c 6961 6e27 3a73   'startJulian':s
+000137f0: 7461 7274 4a75 6c69 616e 2c5c 0d0a 2020  tartJulian,\..  
+00013800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013810: 2020 2020 2020 2765 6e64 4a75 6c69 616e        'endJulian
+00013820: 273a 656e 644a 756c 6961 6e2c 5c0d 0a20  ':endJulian,\.. 
 00013830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013840: 2020 2020 2773 7461 7274 4a75 6c69 616e      'startJulian
-00013850: 273a 7374 6172 744a 756c 6961 6e2c 5c0d  ':startJulian,\.
-00013860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013870: 2020 2020 2020 2020 2027 656e 644a 756c           'endJul
-00013880: 6961 6e27 3a65 6e64 4a75 6c69 616e 2c5c  ian':endJulian,\
-00013890: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000138a0: 2020 2020 2020 2020 2020 2779 6561 7242            'yearB
-000138b0: 7566 6665 7227 3a74 696d 6562 7566 6665  uffer':timebuffe
-000138c0: 722c 5c0d 0a20 2020 2020 2020 2020 2020  r,\..           
-000138d0: 2020 2020 2020 2020 2020 2020 2027 7965               'ye
-000138e0: 6172 5765 6967 6874 7327 3a20 7374 7228  arWeights': str(
-000138f0: 7765 6967 6874 7329 2c5c 0d0a 2020 2020  weights),\..    
-00013900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013910: 2020 2020 2779 724f 7269 6769 6e61 6c27      'yrOriginal'
-00013920: 3a79 6561 722c 5c0d 0a20 2020 2020 2020  :year,\..       
-00013930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013940: 2027 7972 5573 6564 273a 2079 6561 7220   'yrUsed': year 
-00013950: 2b20 7965 6172 5769 7468 4d61 6a6f 7269  + yearWithMajori
-00013960: 7479 7d29 0d0a 0d0a 2020 2349 7465 7261  ty})....  #Itera
-00013970: 7465 2061 6372 6f73 7320 6561 6368 2079  te across each y
-00013980: 6561 720d 0a20 2074 7320 3d20 5b79 6561  ear..  ts = [yea
-00013990: 7243 6f6d 706f 7369 7465 4765 7474 6572  rCompositeGetter
-000139a0: 2879 7229 2066 6f72 2079 7220 696e 2065  (yr) for yr in e
-000139b0: 652e 4c69 7374 2e73 6571 7565 6e63 6528  e.List.sequence(
-000139c0: 7374 6172 7459 6561 722b 7469 6d65 6275  startYear+timebu
-000139d0: 6666 6572 2c65 6e64 5965 6172 2d74 696d  ffer,endYear-tim
-000139e0: 6562 7566 6665 7229 2e67 6574 496e 666f  ebuffer).getInfo
-000139f0: 2829 5d0d 0a20 2074 7320 3d20 6565 2e49  ()]..  ts = ee.I
-00013a00: 6d61 6765 436f 6c6c 6563 7469 6f6e 2874  mageCollection(t
-00013a10: 7329 2e73 6574 2861 7267 7329 0d0a 0d0a  s).set(args)....
-00013a20: 2020 7265 7475 726e 2074 730d 0a0d 0a23    return ts....#
-00013a30: 202f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f   ///////////////
-00013a40: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
-00013a50: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
-00013a60: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
-00013a70: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
-00013a80: 2f0d 0a23 2046 756e 6374 696f 6e20 746f  /..# Function to
-00013a90: 2063 616c 6375 6c61 7465 2069 6c6c 756d   calculate illum
-00013aa0: 696e 6174 696f 6e20 636f 6e64 6974 696f  ination conditio
-00013ab0: 6e20 2849 4329 2e20 4675 6e63 7469 6f6e  n (IC). Function
-00013ac0: 2062 7920 5061 7472 6963 6b20 4275 726e   by Patrick Burn
-00013ad0: 730d 0a23 2028 7062 3436 3340 6e61 752e  s..# (pb463@nau.
-00013ae0: 6564 7529 2061 6e64 204d 6174 7420 4d61  edu) and Matt Ma
-00013af0: 6361 6e64 6572 0d0a 2320 286d 6d61 6361  cander..# (mmaca
-00013b00: 6e64 6572 4061 6272 696e 632e 636f 6d29  nder@abrinc.com)
-00013b10: 0d0a 6465 6620 696c 6c75 6d69 6e61 7469  ..def illuminati
-00013b20: 6f6e 436f 6e64 6974 696f 6e28 696d 6729  onCondition(img)
-00013b30: 3a0d 0a20 2023 2045 7874 7261 6374 2073  :..  # Extract s
-00013b40: 6f6c 6172 207a 656e 6974 6820 616e 6420  olar zenith and 
-00013b50: 617a 696d 7574 6820 6261 6e64 730d 0a20  azimuth bands.. 
-00013b60: 2053 5a5f 7261 6420 3d20 696d 672e 7365   SZ_rad = img.se
-00013b70: 6c65 6374 2827 7a65 6e69 7468 2729 0d0a  lect('zenith')..
-00013b80: 2020 5341 5f72 6164 203d 2069 6d67 2e73    SA_rad = img.s
-00013b90: 656c 6563 7428 2761 7a69 6d75 7468 2729  elect('azimuth')
-00013ba0: 0d0a 0d0a 2020 2320 4372 6561 7420 7465  ....  # Creat te
-00013bb0: 7272 6169 6e20 6c61 7965 7273 0d0a 2020  rrain layers..  
-00013bc0: 2320 6465 6d20 3d20 6565 2e49 6d61 6765  # dem = ee.Image
-00013bd0: 2827 4347 4941 522f 5352 544d 3930 5f56  ('CGIAR/SRTM90_V
-00013be0: 3427 290d 0a20 2064 656d 203d 2065 652e  4')..  dem = ee.
-00013bf0: 496d 6167 6528 2755 5347 532f 4e45 4427  Image('USGS/NED'
-00013c00: 290d 0a20 2073 6c70 203d 2065 652e 5465  )..  slp = ee.Te
-00013c10: 7272 6169 6e2e 736c 6f70 6528 6465 6d29  rrain.slope(dem)
-00013c20: 0d0a 2020 736c 705f 7261 6420 3d20 6565  ..  slp_rad = ee
-00013c30: 2e54 6572 7261 696e 2e73 6c6f 7065 2864  .Terrain.slope(d
-00013c40: 656d 292e 6d75 6c74 6970 6c79 286d 6174  em).multiply(mat
-00013c50: 682e 7069 292e 6469 7669 6465 2831 3830  h.pi).divide(180
-00013c60: 290d 0a20 2061 7370 5f72 6164 203d 2065  )..  asp_rad = e
-00013c70: 652e 5465 7272 6169 6e2e 6173 7065 6374  e.Terrain.aspect
-00013c80: 2864 656d 292e 6d75 6c74 6970 6c79 286d  (dem).multiply(m
-00013c90: 6174 682e 7069 292e 6469 7669 6465 2831  ath.pi).divide(1
-00013ca0: 3830 290d 0a0d 0a20 2023 2043 616c 6375  80)....  # Calcu
-00013cb0: 6c61 7465 2074 6865 2049 6c6c 756d 696e  late the Illumin
-00013cc0: 6174 696f 6e20 436f 6e64 6974 696f 6e20  ation Condition 
-00013cd0: 2849 4329 0d0a 2020 2320 736c 6f70 6520  (IC)..  # slope 
-00013ce0: 7061 7274 206f 6620 7468 6520 696c 6c75  part of the illu
-00013cf0: 6d69 6e61 7469 6f6e 2063 6f6e 6469 7469  mination conditi
-00013d00: 6f6e 0d0a 2020 636f 735a 203d 2053 5a5f  on..  cosZ = SZ_
-00013d10: 7261 642e 636f 7328 290d 0a20 2063 6f73  rad.cos()..  cos
-00013d20: 5320 3d20 736c 705f 7261 642e 636f 7328  S = slp_rad.cos(
-00013d30: 290d 0a20 2073 6c6f 7065 5f69 6c6c 756d  )..  slope_illum
-00013d40: 696e 6174 696f 6e20 3d20 636f 7353 2e65  ination = cosS.e
-00013d50: 7870 7265 7373 696f 6e28 2263 6f73 5a20  xpression("cosZ 
-00013d60: 2a20 636f 7353 222c 0d0a 2020 2020 2020  * cosS",..      
-00013d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d90: 2020 2020 7b27 636f 735a 273a 2063 6f73      {'cosZ': cos
-00013da0: 5a2c 0d0a 2020 2020 2020 2020 2020 2020  Z,..            
-00013db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013dc0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00013dd0: 636f 7353 273a 2063 6f73 532e 7365 6c65  cosS': cosS.sele
-00013de0: 6374 2827 736c 6f70 6527 297d 290d 0a20  ct('slope')}).. 
-00013df0: 2023 2061 7370 6563 7420 7061 7274 206f   # aspect part o
-00013e00: 6620 7468 6520 696c 6c75 6d69 6e61 7469  f the illuminati
-00013e10: 6f6e 2063 6f6e 6469 7469 6f6e 0d0a 2020  on condition..  
-00013e20: 7369 6e5a 203d 2053 5a5f 7261 642e 7369  sinZ = SZ_rad.si
-00013e30: 6e28 290d 0a20 2073 696e 5320 3d20 736c  n()..  sinS = sl
-00013e40: 705f 7261 642e 7369 6e28 290d 0a20 2063  p_rad.sin()..  c
-00013e50: 6f73 417a 6944 6966 6620 3d20 2853 415f  osAziDiff = (SA_
-00013e60: 7261 642e 7375 6274 7261 6374 2861 7370  rad.subtract(asp
-00013e70: 5f72 6164 2929 2e63 6f73 2829 0d0a 2020  _rad)).cos()..  
-00013e80: 6173 7065 6374 5f69 6c6c 756d 696e 6174  aspect_illuminat
-00013e90: 696f 6e20 3d20 7369 6e5a 2e65 7870 7265  ion = sinZ.expre
-00013ea0: 7373 696f 6e28 2273 696e 5a20 2a20 7369  ssion("sinZ * si
-00013eb0: 6e53 202a 2063 6f73 417a 6944 6966 6622  nS * cosAziDiff"
-00013ec0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00013ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ee0: 2020 2020 2020 2020 2020 2020 2020 7b27                {'
-00013ef0: 7369 6e5a 273a 2073 696e 5a2c 0d0a 2020  sinZ': sinZ,..  
-00013f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f20: 2020 2020 2020 2020 2020 2773 696e 5327            'sinS'
-00013f30: 3a20 7369 6e53 2c0d 0a20 2020 2020 2020  : sinS,..       
-00013f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f60: 2020 2020 2027 636f 7341 7a69 4469 6666       'cosAziDiff
-00013f70: 273a 2063 6f73 417a 6944 6966 667d 290d  ': cosAziDiff}).
-00013f80: 0a20 2023 2066 756c 6c20 696c 6c75 6d69  .  # full illumi
-00013f90: 6e61 7469 6f6e 2063 6f6e 6469 7469 6f6e  nation condition
-00013fa0: 2028 4943 290d 0a20 2069 6320 3d20 736c   (IC)..  ic = sl
-00013fb0: 6f70 655f 696c 6c75 6d69 6e61 7469 6f6e  ope_illumination
-00013fc0: 2e61 6464 2861 7370 6563 745f 696c 6c75  .add(aspect_illu
-00013fd0: 6d69 6e61 7469 6f6e 290d 0a0d 0a20 2023  mination)....  #
-00013fe0: 2041 6464 2049 4320 746f 206f 7269 6769   Add IC to origi
-00013ff0: 6e61 6c20 696d 6167 650d 0a20 2072 6574  nal image..  ret
-00014000: 7572 6e20 696d 672e 6164 6442 616e 6473  urn img.addBands
-00014010: 2869 632e 7265 6e61 6d65 2827 4943 2729  (ic.rename('IC')
-00014020: 295c 0d0a 2020 2020 2020 2020 2020 2020  )\..            
-00014030: 2e61 6464 4261 6e64 7328 636f 735a 2e72  .addBands(cosZ.r
-00014040: 656e 616d 6528 2763 6f73 5a27 2929 5c0d  ename('cosZ'))\.
-00014050: 0a20 2020 2020 2020 2020 2020 202e 6164  .            .ad
-00014060: 6442 616e 6473 2863 6f73 532e 7265 6e61  dBands(cosS.rena
-00014070: 6d65 2827 636f 7353 2729 295c 0d0a 2020  me('cosS'))\..  
-00014080: 2020 2020 2020 2020 2020 2e61 6464 4261            .addBa
-00014090: 6e64 7328 736c 702e 7265 6e61 6d65 2827  nds(slp.rename('
-000140a0: 736c 6f70 6527 2929 0d0a 0d0a 2323 2323  slope'))....####
-000140b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000140c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000140d0: 2323 2323 0d0a 2320 4675 6e63 7469 6f6e  ####..# Function
-000140e0: 2074 6f20 6170 706c 7920 7468 6520 5375   to apply the Su
-000140f0: 6e2d 4361 6e6f 7079 2d53 656e 736f 7220  n-Canopy-Sensor 
-00014100: 2b20 4320 2853 4353 6329 2063 6f72 7265  + C (SCSc) corre
-00014110: 6374 696f 6e20 6d65 7468 6f64 2074 6f20  ction method to 
-00014120: 6561 6368 0d0a 2320 696d 6167 652e 2046  each..# image. F
-00014130: 756e 6374 696f 6e20 6279 2050 6174 7269  unction by Patri
-00014140: 636b 2042 7572 6e73 2028 7062 3436 3340  ck Burns (pb463@
-00014150: 6e61 752e 6564 7529 2061 6e64 204d 6174  nau.edu) and Mat
-00014160: 7420 4d61 6361 6e64 6572 0d0a 2320 286d  t Macander..# (m
-00014170: 6d61 6361 6e64 6572 4073 2e63 6f6d 290d  macander@s.com).
-00014180: 0a64 6566 2020 696c 6c75 6d69 6e61 7469  .def  illuminati
-00014190: 6f6e 436f 7272 6563 7469 6f6e 2869 6d67  onCorrection(img
-000141a0: 2c20 7363 616c 652c 7374 7564 7941 7265  , scale,studyAre
-000141b0: 612c 2062 616e 644c 6973 7420 3d20 5b27  a, bandList = ['
-000141c0: 626c 7565 272c 2027 6772 6565 6e27 2c20  blue', 'green', 
-000141d0: 2772 6564 272c 2027 6e69 7227 2c20 2773  'red', 'nir', 's
-000141e0: 7769 7231 272c 2027 7377 6972 3227 2c20  wir1', 'swir2', 
-000141f0: 2774 656d 7027 5d29 3a0d 0a0d 0a20 2070  'temp']):....  p
-00014200: 726f 7073 203d 2069 6d67 2e74 6f44 6963  rops = img.toDic
-00014210: 7469 6f6e 6172 7928 290d 0a20 2073 7420  tionary()..  st 
-00014220: 3d20 696d 672e 6765 7428 2773 7973 7465  = img.get('syste
-00014230: 6d3a 7469 6d65 5f73 7461 7274 2729 0d0a  m:time_start')..
-00014240: 2020 696d 675f 706c 7573 5f69 6320 3d20    img_plus_ic = 
-00014250: 696d 670d 0a20 206d 6173 6b32 203d 2069  img..  mask2 = i
-00014260: 6d67 5f70 6c75 735f 6963 2e73 656c 6563  mg_plus_ic.selec
-00014270: 7428 2773 6c6f 7065 2729 2e67 7465 2835  t('slope').gte(5
-00014280: 295c 0d0a 2020 2020 2020 2020 2020 2020  )\..            
-00014290: 2020 2020 2020 2020 2e41 6e64 2869 6d67          .And(img
-000142a0: 5f70 6c75 735f 6963 2e73 656c 6563 7428  _plus_ic.select(
-000142b0: 2749 4327 292e 6774 6528 3029 295c 0d0a  'IC').gte(0))\..
-000142c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142d0: 2020 2020 2e41 6e64 2869 6d67 5f70 6c75      .And(img_plu
-000142e0: 735f 6963 2e73 656c 6563 7428 276e 6972  s_ic.select('nir
-000142f0: 2729 2e67 7428 2d30 2e31 2929 0d0a 2020  ').gt(-0.1))..  
-00014300: 696d 675f 706c 7573 5f69 635f 6d61 736b  img_plus_ic_mask
-00014310: 3220 3d20 6565 2e49 6d61 6765 2869 6d67  2 = ee.Image(img
-00014320: 5f70 6c75 735f 6963 2e75 7064 6174 654d  _plus_ic.updateM
-00014330: 6173 6b28 6d61 736b 3229 290d 0a0d 0a20  ask(mask2)).... 
-00014340: 2023 2053 7065 6369 6679 2042 616e 6473   # Specify Bands
-00014350: 2074 6f20 746f 706f 6772 6170 6869 6361   to topographica
-00014360: 6c6c 7920 636f 7272 6563 740d 0a20 2063  lly correct..  c
-00014370: 6f6d 706f 7369 7465 4261 6e64 7320 3d20  ompositeBands = 
-00014380: 696d 672e 6261 6e64 4e61 6d65 7328 290d  img.bandNames().
-00014390: 0a20 206e 6f6e 436f 7272 6563 7442 616e  .  nonCorrectBan
-000143a0: 6473 203d 2069 6d67 2e73 656c 6563 7428  ds = img.select(
-000143b0: 636f 6d70 6f73 6974 6542 616e 6473 2e72  compositeBands.r
-000143c0: 656d 6f76 6541 6c6c 2862 616e 644c 6973  emoveAll(bandLis
-000143d0: 7429 290d 0a0d 0a20 2064 6566 2061 7070  t))....  def app
-000143e0: 6c79 5f53 4353 6363 6f72 7228 6261 6e64  ly_SCSccorr(band
-000143f0: 4c69 7374 293a 0d0a 2020 2020 6d65 7468  List):..    meth
-00014400: 6f64 203d 2027 5343 5363 270d 0a20 2020  od = 'SCSc'..   
-00014410: 206f 7574 203d 2069 6d67 5f70 6c75 735f   out = img_plus_
-00014420: 6963 5f6d 6173 6b32 2e73 656c 6563 7428  ic_mask2.select(
-00014430: 2749 4327 2c20 6261 6e64 4c69 7374 292e  'IC', bandList).
-00014440: 7265 6475 6365 5265 6769 6f6e 282a 2a7b  reduceRegion(**{
-00014450: 0d0a 2020 2020 2020 2772 6564 7563 6572  ..      'reducer
-00014460: 273a 2065 652e 5265 6475 6365 722e 6c69  ': ee.Reducer.li
-00014470: 6e65 6172 4669 7428 292c 0d0a 2020 2020  nearFit(),..    
-00014480: 2020 2767 656f 6d65 7472 7927 3a20 7374    'geometry': st
-00014490: 7564 7941 7265 612c 0d0a 2020 2020 2020  udyArea,..      
-000144a0: 2773 6361 6c65 273a 2073 6361 6c65 2c0d  'scale': scale,.
-000144b0: 0a20 2020 2020 2027 6d61 7850 6978 656c  .      'maxPixel
-000144c0: 7327 3a20 3165 3133 7d29 0d0a 0d0a 2020  s': 1e13})....  
-000144d0: 2020 6f75 745f 6120 3d20 6565 2e4e 756d    out_a = ee.Num
-000144e0: 6265 7228 6f75 742e 6765 7428 2773 6361  ber(out.get('sca
-000144f0: 6c65 2729 290d 0a20 2020 206f 7574 5f62  le'))..    out_b
-00014500: 203d 2065 652e 4e75 6d62 6572 286f 7574   = ee.Number(out
-00014510: 2e67 6574 2827 6f66 6673 6574 2729 290d  .get('offset')).
-00014520: 0a20 2020 206f 7574 5f63 203d 206f 7574  .    out_c = out
-00014530: 5f62 2e64 6976 6964 6528 6f75 745f 6129  _b.divide(out_a)
-00014540: 0d0a 2020 2020 2320 4170 706c 7920 7468  ..    # Apply th
-00014550: 6520 5343 5363 2063 6f72 7265 6374 696f  e SCSc correctio
-00014560: 6e0d 0a20 2020 2053 4353 635f 6f75 7470  n..    SCSc_outp
-00014570: 7574 203d 2069 6d67 5f70 6c75 735f 6963  ut = img_plus_ic
-00014580: 5f6d 6173 6b32 2e65 7870 7265 7373 696f  _mask2.expressio
-00014590: 6e28 5c0d 0a20 2020 2020 2022 2828 696d  n(\..      "((im
-000145a0: 6167 6520 2a20 2863 6f73 4220 2a20 636f  age * (cosB * co
-000145b0: 735a 202b 2063 7661 6c75 6529 2920 2f20  sZ + cvalue)) / 
-000145c0: 2869 6320 2b20 6376 616c 7565 2929 222c  (ic + cvalue))",
-000145d0: 207b 5c0d 0a20 2020 2020 2027 696d 6167   {\..      'imag
-000145e0: 6527 3a20 696d 675f 706c 7573 5f69 635f  e': img_plus_ic_
-000145f0: 6d61 736b 322e 7365 6c65 6374 2862 616e  mask2.select(ban
-00014600: 644c 6973 7429 2c0d 0a20 2020 2020 2027  dList),..      '
-00014610: 6963 273a 2069 6d67 5f70 6c75 735f 6963  ic': img_plus_ic
-00014620: 5f6d 6173 6b32 2e73 656c 6563 7428 2749  _mask2.select('I
-00014630: 4327 292c 0d0a 2020 2020 2020 2763 6f73  C'),..      'cos
-00014640: 4227 3a20 696d 675f 706c 7573 5f69 635f  B': img_plus_ic_
-00014650: 6d61 736b 322e 7365 6c65 6374 2827 636f  mask2.select('co
-00014660: 7353 2729 2c0d 0a20 2020 2020 2027 636f  sS'),..      'co
-00014670: 735a 273a 2069 6d67 5f70 6c75 735f 6963  sZ': img_plus_ic
-00014680: 5f6d 6173 6b32 2e73 656c 6563 7428 2763  _mask2.select('c
-00014690: 6f73 5a27 292c 0d0a 2020 2020 2020 2763  osZ'),..      'c
-000146a0: 7661 6c75 6527 3a20 6f75 745f 635c 0d0a  value': out_c\..
-000146b0: 2020 2020 7d29 0d0a 0d0a 2020 2020 7265      })....    re
-000146c0: 7475 726e 2053 4353 635f 6f75 7470 7574  turn SCSc_output
-000146d0: 0d0a 0d0a 2020 696d 675f 5343 5363 636f  ....  img_SCScco
-000146e0: 7272 203d 2065 652e 496d 6167 6528 6261  rr = ee.Image(ba
-000146f0: 6e64 4c69 7374 2e6d 6170 2861 7070 6c79  ndList.map(apply
-00014700: 5f53 4353 6363 6f72 7229 295c 0d0a 2020  _SCSccorr))\..  
-00014710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014720: 2020 2020 2e61 6464 4261 6e64 7328 696d      .addBands(im
-00014730: 675f 706c 7573 5f69 632e 7365 6c65 6374  g_plus_ic.select
-00014740: 2827 4943 2729 290d 0a20 2062 616e 644c  ('IC'))..  bandL
-00014750: 6973 745f 4943 203d 2065 652e 4c69 7374  ist_IC = ee.List
-00014760: 285b 6261 6e64 4c69 7374 2c20 2749 4327  ([bandList, 'IC'
-00014770: 5d29 2e66 6c61 7474 656e 2829 0d0a 2020  ]).flatten()..  
-00014780: 696d 675f 5343 5363 636f 7272 203d 2069  img_SCSccorr = i
-00014790: 6d67 5f53 4353 6363 6f72 722e 756e 6d61  mg_SCSccorr.unma
-000147a0: 736b 2869 6d67 5f70 6c75 735f 6963 2e73  sk(img_plus_ic.s
-000147b0: 656c 6563 7428 6261 6e64 4c69 7374 5f49  elect(bandList_I
-000147c0: 4329 292e 7365 6c65 6374 2862 616e 644c  C)).select(bandL
-000147d0: 6973 7429 0d0a 0d0a 2020 7265 7475 726e  ist)....  return
-000147e0: 2069 6d67 5f53 4353 6363 6f72 722e 6164   img_SCSccorr.ad
-000147f0: 6442 616e 6473 286e 6f6e 436f 7272 6563  dBands(nonCorrec
-00014800: 7442 616e 6473 295c 0d0a 2020 2020 2020  tBands)\..      
-00014810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014820: 2e73 6574 4d75 6c74 6928 7072 6f70 7329  .setMulti(props)
-00014830: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
-00014840: 2020 2020 2020 2020 202e 7365 7428 2773           .set('s
-00014850: 7973 7465 6d3a 7469 6d65 5f73 7461 7274  ystem:time_start
-00014860: 272c 7374 290d 0a0d 0a23 2323 2323 2323  ',st)....#######
+00013840: 2020 2020 2020 2027 7965 6172 4275 6666         'yearBuff
+00013850: 6572 273a 7469 6d65 6275 6666 6572 2c5c  er':timebuffer,\
+00013860: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013870: 2020 2020 2020 2020 2020 2779 6561 7257            'yearW
+00013880: 6569 6768 7473 273a 2073 7472 2877 6569  eights': str(wei
+00013890: 6768 7473 292c 5c0d 0a20 2020 2020 2020  ghts),\..       
+000138a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000138b0: 2027 7972 4f72 6967 696e 616c 273a 7965   'yrOriginal':ye
+000138c0: 6172 2c5c 0d0a 2020 2020 2020 2020 2020  ar,\..          
+000138d0: 2020 2020 2020 2020 2020 2020 2020 2779                'y
+000138e0: 7255 7365 6427 3a20 7965 6172 202b 2079  rUsed': year + y
+000138f0: 6561 7257 6974 684d 616a 6f72 6974 797d  earWithMajority}
+00013900: 290d 0a0d 0a20 2023 4974 6572 6174 6520  )....  #Iterate 
+00013910: 6163 726f 7373 2065 6163 6820 7965 6172  across each year
+00013920: 0d0a 2020 7473 203d 205b 7965 6172 436f  ..  ts = [yearCo
+00013930: 6d70 6f73 6974 6547 6574 7465 7228 7972  mpositeGetter(yr
+00013940: 2920 666f 7220 7972 2069 6e20 6565 2e4c  ) for yr in ee.L
+00013950: 6973 742e 7365 7175 656e 6365 2873 7461  ist.sequence(sta
+00013960: 7274 5965 6172 2b74 696d 6562 7566 6665  rtYear+timebuffe
+00013970: 722c 656e 6459 6561 722d 7469 6d65 6275  r,endYear-timebu
+00013980: 6666 6572 292e 6765 7449 6e66 6f28 295d  ffer).getInfo()]
+00013990: 0d0a 2020 7473 203d 2065 652e 496d 6167  ..  ts = ee.Imag
+000139a0: 6543 6f6c 6c65 6374 696f 6e28 7473 292e  eCollection(ts).
+000139b0: 7365 7428 6172 6773 290d 0a0d 0a20 2072  set(args)....  r
+000139c0: 6574 7572 6e20 7473 0d0a 0d0a 2320 2f2f  eturn ts....# //
+000139d0: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
+000139e0: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
+000139f0: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
+00013a00: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
+00013a10: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 0d0a  //////////////..
+00013a20: 2320 4675 6e63 7469 6f6e 2074 6f20 6361  # Function to ca
+00013a30: 6c63 756c 6174 6520 696c 6c75 6d69 6e61  lculate illumina
+00013a40: 7469 6f6e 2063 6f6e 6469 7469 6f6e 2028  tion condition (
+00013a50: 4943 292e 2046 756e 6374 696f 6e20 6279  IC). Function by
+00013a60: 2050 6174 7269 636b 2042 7572 6e73 0d0a   Patrick Burns..
+00013a70: 2320 2870 6234 3633 406e 6175 2e65 6475  # (pb463@nau.edu
+00013a80: 2920 616e 6420 4d61 7474 204d 6163 616e  ) and Matt Macan
+00013a90: 6465 720d 0a23 2028 6d6d 6163 616e 6465  der..# (mmacande
+00013aa0: 7240 6162 7269 6e63 2e63 6f6d 290d 0a64  r@abrinc.com)..d
+00013ab0: 6566 2069 6c6c 756d 696e 6174 696f 6e43  ef illuminationC
+00013ac0: 6f6e 6469 7469 6f6e 2869 6d67 293a 0d0a  ondition(img):..
+00013ad0: 2020 2320 4578 7472 6163 7420 736f 6c61    # Extract sola
+00013ae0: 7220 7a65 6e69 7468 2061 6e64 2061 7a69  r zenith and azi
+00013af0: 6d75 7468 2062 616e 6473 0d0a 2020 535a  muth bands..  SZ
+00013b00: 5f72 6164 203d 2069 6d67 2e73 656c 6563  _rad = img.selec
+00013b10: 7428 277a 656e 6974 6827 290d 0a20 2053  t('zenith')..  S
+00013b20: 415f 7261 6420 3d20 696d 672e 7365 6c65  A_rad = img.sele
+00013b30: 6374 2827 617a 696d 7574 6827 290d 0a0d  ct('azimuth')...
+00013b40: 0a20 2023 2043 7265 6174 2074 6572 7261  .  # Creat terra
+00013b50: 696e 206c 6179 6572 730d 0a20 2023 2064  in layers..  # d
+00013b60: 656d 203d 2065 652e 496d 6167 6528 2743  em = ee.Image('C
+00013b70: 4749 4152 2f53 5254 4d39 305f 5634 2729  GIAR/SRTM90_V4')
+00013b80: 0d0a 2020 6465 6d20 3d20 6565 2e49 6d61  ..  dem = ee.Ima
+00013b90: 6765 2827 5553 4753 2f4e 4544 2729 0d0a  ge('USGS/NED')..
+00013ba0: 2020 736c 7020 3d20 6565 2e54 6572 7261    slp = ee.Terra
+00013bb0: 696e 2e73 6c6f 7065 2864 656d 290d 0a20  in.slope(dem).. 
+00013bc0: 2073 6c70 5f72 6164 203d 2065 652e 5465   slp_rad = ee.Te
+00013bd0: 7272 6169 6e2e 736c 6f70 6528 6465 6d29  rrain.slope(dem)
+00013be0: 2e6d 756c 7469 706c 7928 6d61 7468 2e70  .multiply(math.p
+00013bf0: 6929 2e64 6976 6964 6528 3138 3029 0d0a  i).divide(180)..
+00013c00: 2020 6173 705f 7261 6420 3d20 6565 2e54    asp_rad = ee.T
+00013c10: 6572 7261 696e 2e61 7370 6563 7428 6465  errain.aspect(de
+00013c20: 6d29 2e6d 756c 7469 706c 7928 6d61 7468  m).multiply(math
+00013c30: 2e70 6929 2e64 6976 6964 6528 3138 3029  .pi).divide(180)
+00013c40: 0d0a 0d0a 2020 2320 4361 6c63 756c 6174  ....  # Calculat
+00013c50: 6520 7468 6520 496c 6c75 6d69 6e61 7469  e the Illuminati
+00013c60: 6f6e 2043 6f6e 6469 7469 6f6e 2028 4943  on Condition (IC
+00013c70: 290d 0a20 2023 2073 6c6f 7065 2070 6172  )..  # slope par
+00013c80: 7420 6f66 2074 6865 2069 6c6c 756d 696e  t of the illumin
+00013c90: 6174 696f 6e20 636f 6e64 6974 696f 6e0d  ation condition.
+00013ca0: 0a20 2063 6f73 5a20 3d20 535a 5f72 6164  .  cosZ = SZ_rad
+00013cb0: 2e63 6f73 2829 0d0a 2020 636f 7353 203d  .cos()..  cosS =
+00013cc0: 2073 6c70 5f72 6164 2e63 6f73 2829 0d0a   slp_rad.cos()..
+00013cd0: 2020 736c 6f70 655f 696c 6c75 6d69 6e61    slope_illumina
+00013ce0: 7469 6f6e 203d 2063 6f73 532e 6578 7072  tion = cosS.expr
+00013cf0: 6573 7369 6f6e 2822 636f 735a 202a 2063  ession("cosZ * c
+00013d00: 6f73 5322 2c0d 0a20 2020 2020 2020 2020  osS",..         
+00013d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d30: 207b 2763 6f73 5a27 3a20 636f 735a 2c0d   {'cosZ': cosZ,.
+00013d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d60: 2020 2020 2020 2020 2020 2020 2763 6f73              'cos
+00013d70: 5327 3a20 636f 7353 2e73 656c 6563 7428  S': cosS.select(
+00013d80: 2773 6c6f 7065 2729 7d29 0d0a 2020 2320  'slope')})..  # 
+00013d90: 6173 7065 6374 2070 6172 7420 6f66 2074  aspect part of t
+00013da0: 6865 2069 6c6c 756d 696e 6174 696f 6e20  he illumination 
+00013db0: 636f 6e64 6974 696f 6e0d 0a20 2073 696e  condition..  sin
+00013dc0: 5a20 3d20 535a 5f72 6164 2e73 696e 2829  Z = SZ_rad.sin()
+00013dd0: 0d0a 2020 7369 6e53 203d 2073 6c70 5f72  ..  sinS = slp_r
+00013de0: 6164 2e73 696e 2829 0d0a 2020 636f 7341  ad.sin()..  cosA
+00013df0: 7a69 4469 6666 203d 2028 5341 5f72 6164  ziDiff = (SA_rad
+00013e00: 2e73 7562 7472 6163 7428 6173 705f 7261  .subtract(asp_ra
+00013e10: 6429 292e 636f 7328 290d 0a20 2061 7370  d)).cos()..  asp
+00013e20: 6563 745f 696c 6c75 6d69 6e61 7469 6f6e  ect_illumination
+00013e30: 203d 2073 696e 5a2e 6578 7072 6573 7369   = sinZ.expressi
+00013e40: 6f6e 2822 7369 6e5a 202a 2073 696e 5320  on("sinZ * sinS 
+00013e50: 2a20 636f 7341 7a69 4469 6666 222c 0d0a  * cosAziDiff",..
+00013e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e80: 2020 2020 2020 2020 2020 207b 2773 696e             {'sin
+00013e90: 5a27 3a20 7369 6e5a 2c0d 0a20 2020 2020  Z': sinZ,..     
+00013ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ec0: 2020 2020 2020 2027 7369 6e53 273a 2073         'sinS': s
+00013ed0: 696e 532c 0d0a 2020 2020 2020 2020 2020  inS,..          
+00013ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f00: 2020 2763 6f73 417a 6944 6966 6627 3a20    'cosAziDiff': 
+00013f10: 636f 7341 7a69 4469 6666 7d29 0d0a 2020  cosAziDiff})..  
+00013f20: 2320 6675 6c6c 2069 6c6c 756d 696e 6174  # full illuminat
+00013f30: 696f 6e20 636f 6e64 6974 696f 6e20 2849  ion condition (I
+00013f40: 4329 0d0a 2020 6963 203d 2073 6c6f 7065  C)..  ic = slope
+00013f50: 5f69 6c6c 756d 696e 6174 696f 6e2e 6164  _illumination.ad
+00013f60: 6428 6173 7065 6374 5f69 6c6c 756d 696e  d(aspect_illumin
+00013f70: 6174 696f 6e29 0d0a 0d0a 2020 2320 4164  ation)....  # Ad
+00013f80: 6420 4943 2074 6f20 6f72 6967 696e 616c  d IC to original
+00013f90: 2069 6d61 6765 0d0a 2020 7265 7475 726e   image..  return
+00013fa0: 2069 6d67 2e61 6464 4261 6e64 7328 6963   img.addBands(ic
+00013fb0: 2e72 656e 616d 6528 2749 4327 2929 5c0d  .rename('IC'))\.
+00013fc0: 0a20 2020 2020 2020 2020 2020 202e 6164  .            .ad
+00013fd0: 6442 616e 6473 2863 6f73 5a2e 7265 6e61  dBands(cosZ.rena
+00013fe0: 6d65 2827 636f 735a 2729 295c 0d0a 2020  me('cosZ'))\..  
+00013ff0: 2020 2020 2020 2020 2020 2e61 6464 4261            .addBa
+00014000: 6e64 7328 636f 7353 2e72 656e 616d 6528  nds(cosS.rename(
+00014010: 2763 6f73 5327 2929 5c0d 0a20 2020 2020  'cosS'))\..     
+00014020: 2020 2020 2020 202e 6164 6442 616e 6473         .addBands
+00014030: 2873 6c70 2e72 656e 616d 6528 2773 6c6f  (slp.rename('slo
+00014040: 7065 2729 290d 0a0d 0a23 2323 2323 2323  pe'))....#######
+00014050: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014060: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014070: 230d 0a23 2046 756e 6374 696f 6e20 746f  #..# Function to
+00014080: 2061 7070 6c79 2074 6865 2053 756e 2d43   apply the Sun-C
+00014090: 616e 6f70 792d 5365 6e73 6f72 202b 2043  anopy-Sensor + C
+000140a0: 2028 5343 5363 2920 636f 7272 6563 7469   (SCSc) correcti
+000140b0: 6f6e 206d 6574 686f 6420 746f 2065 6163  on method to eac
+000140c0: 680d 0a23 2069 6d61 6765 2e20 4675 6e63  h..# image. Func
+000140d0: 7469 6f6e 2062 7920 5061 7472 6963 6b20  tion by Patrick 
+000140e0: 4275 726e 7320 2870 6234 3633 406e 6175  Burns (pb463@nau
+000140f0: 2e65 6475 2920 616e 6420 4d61 7474 204d  .edu) and Matt M
+00014100: 6163 616e 6465 720d 0a23 2028 6d6d 6163  acander..# (mmac
+00014110: 616e 6465 7240 732e 636f 6d29 0d0a 6465  ander@s.com)..de
+00014120: 6620 2069 6c6c 756d 696e 6174 696f 6e43  f  illuminationC
+00014130: 6f72 7265 6374 696f 6e28 696d 672c 2073  orrection(img, s
+00014140: 6361 6c65 2c73 7475 6479 4172 6561 2c20  cale,studyArea, 
+00014150: 6261 6e64 4c69 7374 203d 205b 2762 6c75  bandList = ['blu
+00014160: 6527 2c20 2767 7265 656e 272c 2027 7265  e', 'green', 're
+00014170: 6427 2c20 276e 6972 272c 2027 7377 6972  d', 'nir', 'swir
+00014180: 3127 2c20 2773 7769 7232 272c 2027 7465  1', 'swir2', 'te
+00014190: 6d70 275d 293a 0d0a 0d0a 2020 7072 6f70  mp']):....  prop
+000141a0: 7320 3d20 696d 672e 746f 4469 6374 696f  s = img.toDictio
+000141b0: 6e61 7279 2829 0d0a 2020 7374 203d 2069  nary()..  st = i
+000141c0: 6d67 2e67 6574 2827 7379 7374 656d 3a74  mg.get('system:t
+000141d0: 696d 655f 7374 6172 7427 290d 0a20 2069  ime_start')..  i
+000141e0: 6d67 5f70 6c75 735f 6963 203d 2069 6d67  mg_plus_ic = img
+000141f0: 0d0a 2020 6d61 736b 3220 3d20 696d 675f  ..  mask2 = img_
+00014200: 706c 7573 5f69 632e 7365 6c65 6374 2827  plus_ic.select('
+00014210: 736c 6f70 6527 292e 6774 6528 3529 5c0d  slope').gte(5)\.
+00014220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014230: 2020 2020 202e 416e 6428 696d 675f 706c       .And(img_pl
+00014240: 7573 5f69 632e 7365 6c65 6374 2827 4943  us_ic.select('IC
+00014250: 2729 2e67 7465 2830 2929 5c0d 0a20 2020  ').gte(0))\..   
+00014260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014270: 202e 416e 6428 696d 675f 706c 7573 5f69   .And(img_plus_i
+00014280: 632e 7365 6c65 6374 2827 6e69 7227 292e  c.select('nir').
+00014290: 6774 282d 302e 3129 290d 0a20 2069 6d67  gt(-0.1))..  img
+000142a0: 5f70 6c75 735f 6963 5f6d 6173 6b32 203d  _plus_ic_mask2 =
+000142b0: 2065 652e 496d 6167 6528 696d 675f 706c   ee.Image(img_pl
+000142c0: 7573 5f69 632e 7570 6461 7465 4d61 736b  us_ic.updateMask
+000142d0: 286d 6173 6b32 2929 0d0a 0d0a 2020 2320  (mask2))....  # 
+000142e0: 5370 6563 6966 7920 4261 6e64 7320 746f  Specify Bands to
+000142f0: 2074 6f70 6f67 7261 7068 6963 616c 6c79   topographically
+00014300: 2063 6f72 7265 6374 0d0a 2020 636f 6d70   correct..  comp
+00014310: 6f73 6974 6542 616e 6473 203d 2069 6d67  ositeBands = img
+00014320: 2e62 616e 644e 616d 6573 2829 0d0a 2020  .bandNames()..  
+00014330: 6e6f 6e43 6f72 7265 6374 4261 6e64 7320  nonCorrectBands 
+00014340: 3d20 696d 672e 7365 6c65 6374 2863 6f6d  = img.select(com
+00014350: 706f 7369 7465 4261 6e64 732e 7265 6d6f  positeBands.remo
+00014360: 7665 416c 6c28 6261 6e64 4c69 7374 2929  veAll(bandList))
+00014370: 0d0a 0d0a 2020 6465 6620 6170 706c 795f  ....  def apply_
+00014380: 5343 5363 636f 7272 2862 616e 644c 6973  SCSccorr(bandLis
+00014390: 7429 3a0d 0a20 2020 206d 6574 686f 6420  t):..    method 
+000143a0: 3d20 2753 4353 6327 0d0a 2020 2020 6f75  = 'SCSc'..    ou
+000143b0: 7420 3d20 696d 675f 706c 7573 5f69 635f  t = img_plus_ic_
+000143c0: 6d61 736b 322e 7365 6c65 6374 2827 4943  mask2.select('IC
+000143d0: 272c 2062 616e 644c 6973 7429 2e72 6564  ', bandList).red
+000143e0: 7563 6552 6567 696f 6e28 2a2a 7b0d 0a20  uceRegion(**{.. 
+000143f0: 2020 2020 2027 7265 6475 6365 7227 3a20       'reducer': 
+00014400: 6565 2e52 6564 7563 6572 2e6c 696e 6561  ee.Reducer.linea
+00014410: 7246 6974 2829 2c0d 0a20 2020 2020 2027  rFit(),..      '
+00014420: 6765 6f6d 6574 7279 273a 2073 7475 6479  geometry': study
+00014430: 4172 6561 2c0d 0a20 2020 2020 2027 7363  Area,..      'sc
+00014440: 616c 6527 3a20 7363 616c 652c 0d0a 2020  ale': scale,..  
+00014450: 2020 2020 276d 6178 5069 7865 6c73 273a      'maxPixels':
+00014460: 2031 6531 337d 290d 0a0d 0a20 2020 206f   1e13})....    o
+00014470: 7574 5f61 203d 2065 652e 4e75 6d62 6572  ut_a = ee.Number
+00014480: 286f 7574 2e67 6574 2827 7363 616c 6527  (out.get('scale'
+00014490: 2929 0d0a 2020 2020 6f75 745f 6220 3d20  ))..    out_b = 
+000144a0: 6565 2e4e 756d 6265 7228 6f75 742e 6765  ee.Number(out.ge
+000144b0: 7428 276f 6666 7365 7427 2929 0d0a 2020  t('offset'))..  
+000144c0: 2020 6f75 745f 6320 3d20 6f75 745f 622e    out_c = out_b.
+000144d0: 6469 7669 6465 286f 7574 5f61 290d 0a20  divide(out_a).. 
+000144e0: 2020 2023 2041 7070 6c79 2074 6865 2053     # Apply the S
+000144f0: 4353 6320 636f 7272 6563 7469 6f6e 0d0a  CSc correction..
+00014500: 2020 2020 5343 5363 5f6f 7574 7075 7420      SCSc_output 
+00014510: 3d20 696d 675f 706c 7573 5f69 635f 6d61  = img_plus_ic_ma
+00014520: 736b 322e 6578 7072 6573 7369 6f6e 285c  sk2.expression(\
+00014530: 0d0a 2020 2020 2020 2228 2869 6d61 6765  ..      "((image
+00014540: 202a 2028 636f 7342 202a 2063 6f73 5a20   * (cosB * cosZ 
+00014550: 2b20 6376 616c 7565 2929 202f 2028 6963  + cvalue)) / (ic
+00014560: 202b 2063 7661 6c75 6529 2922 2c20 7b5c   + cvalue))", {\
+00014570: 0d0a 2020 2020 2020 2769 6d61 6765 273a  ..      'image':
+00014580: 2069 6d67 5f70 6c75 735f 6963 5f6d 6173   img_plus_ic_mas
+00014590: 6b32 2e73 656c 6563 7428 6261 6e64 4c69  k2.select(bandLi
+000145a0: 7374 292c 0d0a 2020 2020 2020 2769 6327  st),..      'ic'
+000145b0: 3a20 696d 675f 706c 7573 5f69 635f 6d61  : img_plus_ic_ma
+000145c0: 736b 322e 7365 6c65 6374 2827 4943 2729  sk2.select('IC')
+000145d0: 2c0d 0a20 2020 2020 2027 636f 7342 273a  ,..      'cosB':
+000145e0: 2069 6d67 5f70 6c75 735f 6963 5f6d 6173   img_plus_ic_mas
+000145f0: 6b32 2e73 656c 6563 7428 2763 6f73 5327  k2.select('cosS'
+00014600: 292c 0d0a 2020 2020 2020 2763 6f73 5a27  ),..      'cosZ'
+00014610: 3a20 696d 675f 706c 7573 5f69 635f 6d61  : img_plus_ic_ma
+00014620: 736b 322e 7365 6c65 6374 2827 636f 735a  sk2.select('cosZ
+00014630: 2729 2c0d 0a20 2020 2020 2027 6376 616c  '),..      'cval
+00014640: 7565 273a 206f 7574 5f63 5c0d 0a20 2020  ue': out_c\..   
+00014650: 207d 290d 0a0d 0a20 2020 2072 6574 7572   })....    retur
+00014660: 6e20 5343 5363 5f6f 7574 7075 740d 0a0d  n SCSc_output...
+00014670: 0a20 2069 6d67 5f53 4353 6363 6f72 7220  .  img_SCSccorr 
+00014680: 3d20 6565 2e49 6d61 6765 2862 616e 644c  = ee.Image(bandL
+00014690: 6973 742e 6d61 7028 6170 706c 795f 5343  ist.map(apply_SC
+000146a0: 5363 636f 7272 2929 5c0d 0a20 2020 2020  Sccorr))\..     
+000146b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000146c0: 202e 6164 6442 616e 6473 2869 6d67 5f70   .addBands(img_p
+000146d0: 6c75 735f 6963 2e73 656c 6563 7428 2749  lus_ic.select('I
+000146e0: 4327 2929 0d0a 2020 6261 6e64 4c69 7374  C'))..  bandList
+000146f0: 5f49 4320 3d20 6565 2e4c 6973 7428 5b62  _IC = ee.List([b
+00014700: 616e 644c 6973 742c 2027 4943 275d 292e  andList, 'IC']).
+00014710: 666c 6174 7465 6e28 290d 0a20 2069 6d67  flatten()..  img
+00014720: 5f53 4353 6363 6f72 7220 3d20 696d 675f  _SCSccorr = img_
+00014730: 5343 5363 636f 7272 2e75 6e6d 6173 6b28  SCSccorr.unmask(
+00014740: 696d 675f 706c 7573 5f69 632e 7365 6c65  img_plus_ic.sele
+00014750: 6374 2862 616e 644c 6973 745f 4943 2929  ct(bandList_IC))
+00014760: 2e73 656c 6563 7428 6261 6e64 4c69 7374  .select(bandList
+00014770: 290d 0a0d 0a20 2072 6574 7572 6e20 696d  )....  return im
+00014780: 675f 5343 5363 636f 7272 2e61 6464 4261  g_SCSccorr.addBa
+00014790: 6e64 7328 6e6f 6e43 6f72 7265 6374 4261  nds(nonCorrectBa
+000147a0: 6e64 7329 5c0d 0a20 2020 2020 2020 2020  nds)\..         
+000147b0: 2020 2020 2020 2020 2020 2020 202e 7365               .se
+000147c0: 744d 756c 7469 2870 726f 7073 295c 0d0a  tMulti(props)\..
+000147d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000147e0: 2020 2020 2020 2e73 6574 2827 7379 7374        .set('syst
+000147f0: 656d 3a74 696d 655f 7374 6172 7427 2c73  em:time_start',s
+00014800: 7429 0d0a 0d0a 2323 2323 2323 2323 2323  t)....##########
+00014810: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014820: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014830: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014840: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
+00014850: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+00014860: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00014870: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00014880: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014890: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000148a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000148b0: 2323 0d0a 2323 2323 2323 2323 2323 2323  ##..############
-000148c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000148d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000148e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000148f0: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
-00014900: 4120 6675 6e63 7469 6f6e 2074 6f20 6d61  A function to ma
-00014910: 736b 206f 7574 2070 6978 656c 7320 7468  sk out pixels th
-00014920: 6174 2064 6964 206e 6f74 2068 6176 6520  at did not have 
-00014930: 6f62 7365 7276 6174 696f 6e73 2066 6f72  observations for
-00014940: 204d 4f44 4953 2e0d 0a64 6566 206d 6173   MODIS...def mas
-00014950: 6b45 6d70 7479 5069 7865 6c73 2869 6d61  kEmptyPixels(ima
-00014960: 6765 293a 0d0a 2020 2346 696e 6420 7069  ge):..  #Find pi
-00014970: 7865 6c73 2074 6861 7420 6861 6420 6f62  xels that had ob
-00014980: 7365 7276 6174 696f 6e73 2e0d 0a20 2077  servations...  w
-00014990: 6974 684f 6273 203d 2069 6d61 6765 2e73  ithObs = image.s
-000149a0: 656c 6563 7428 276e 756d 5f6f 6273 6572  elect('num_obser
-000149b0: 7661 7469 6f6e 735f 316b 6d27 292e 6774  vations_1km').gt
-000149c0: 2830 290d 0a20 2072 6574 7572 6e20 696d  (0)..  return im
-000149d0: 6167 652e 6d61 736b 2869 6d61 6765 2e6d  age.mask(image.m
-000149e0: 6173 6b28 292e 416e 6428 7769 7468 4f62  ask().And(withOb
-000149f0: 7329 290d 0a0d 0a23 2323 2323 2323 2323  s))....#########
+00014890: 2323 2323 2323 2323 2323 0d0a 2341 2066  ##########..#A f
+000148a0: 756e 6374 696f 6e20 746f 206d 6173 6b20  unction to mask 
+000148b0: 6f75 7420 7069 7865 6c73 2074 6861 7420  out pixels that 
+000148c0: 6469 6420 6e6f 7420 6861 7665 206f 6273  did not have obs
+000148d0: 6572 7661 7469 6f6e 7320 666f 7220 4d4f  ervations for MO
+000148e0: 4449 532e 0d0a 6465 6620 6d61 736b 456d  DIS...def maskEm
+000148f0: 7074 7950 6978 656c 7328 696d 6167 6529  ptyPixels(image)
+00014900: 3a0d 0a20 2023 4669 6e64 2070 6978 656c  :..  #Find pixel
+00014910: 7320 7468 6174 2068 6164 206f 6273 6572  s that had obser
+00014920: 7661 7469 6f6e 732e 0d0a 2020 7769 7468  vations...  with
+00014930: 4f62 7320 3d20 696d 6167 652e 7365 6c65  Obs = image.sele
+00014940: 6374 2827 6e75 6d5f 6f62 7365 7276 6174  ct('num_observat
+00014950: 696f 6e73 5f31 6b6d 2729 2e67 7428 3029  ions_1km').gt(0)
+00014960: 0d0a 2020 7265 7475 726e 2069 6d61 6765  ..  return image
+00014970: 2e6d 6173 6b28 696d 6167 652e 6d61 736b  .mask(image.mask
+00014980: 2829 2e41 6e64 2877 6974 684f 6273 2929  ().And(withObs))
+00014990: 0d0a 0d0a 2323 2323 2323 2323 2323 2323  ....############
+000149a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000149b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000149c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000149d0: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
+000149e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000149f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00014a00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00014a10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014a20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014a30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014a40: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
-00014a50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014a60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014a70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014a80: 2323 2323 2323 2323 2323 230d 0a23 2041  ###########..# A
-00014a90: 2066 756e 6374 696f 6e20 7468 6174 2072   function that r
-00014aa0: 6574 7572 6e73 2061 6e20 696d 6167 6520  eturns an image 
-00014ab0: 636f 6e74 6169 6e69 6e67 206a 7573 7420  containing just 
-00014ac0: 7468 6520 7370 6563 6966 6965 6420 5141  the specified QA
-00014ad0: 2062 6974 732e 0d0a 230d 0a23 2041 7267   bits...#..# Arg
-00014ae0: 733a 0d0a 2320 2020 696d 6167 6520 2d20  s:..#   image - 
-00014af0: 5468 6520 5141 2049 6d61 6765 2074 6f20  The QA Image to 
-00014b00: 6765 7420 6269 7473 2066 726f 6d2e 0d0a  get bits from...
-00014b10: 2320 2020 7374 6172 7420 2d20 5468 6520  #   start - The 
-00014b20: 6669 7273 7420 6269 7420 706f 7369 7469  first bit positi
-00014b30: 6f6e 2c20 302d 6261 7365 642e 0d0a 2320  on, 0-based...# 
-00014b40: 2020 656e 6420 2020 2d20 5468 6520 6c61    end   - The la
-00014b50: 7374 2062 6974 2070 6f73 6974 696f 6e2c  st bit position,
-00014b60: 2069 6e63 6c75 7369 7665 2e0d 0a23 2020   inclusive...#  
-00014b70: 206e 616d 6520 202d 2041 206e 616d 6520   name  - A name 
-00014b80: 666f 7220 7468 6520 6f75 7470 7574 2069  for the output i
-00014b90: 6d61 6765 2e0d 0a0d 0a64 6566 2067 6574  mage.....def get
-00014ba0: 5141 4269 7473 2869 6d61 6765 2c20 7374  QABits(image, st
-00014bb0: 6172 742c 2065 6e64 2c20 6e65 774e 616d  art, end, newNam
-00014bc0: 6529 3a0d 0a20 2023 436f 6d70 7574 6520  e):..  #Compute 
-00014bd0: 7468 6520 6269 7473 2077 6520 6e65 6564  the bits we need
-00014be0: 2074 6f20 6578 7472 6163 742e 0d0a 2020   to extract...  
-00014bf0: 7061 7474 6572 6e20 3d20 300d 0a20 2066  pattern = 0..  f
-00014c00: 6f72 2069 2069 6e20 7261 6e67 6528 7374  or i in range(st
-00014c10: 6172 742c 656e 642b 3129 3a0d 0a20 2020  art,end+1):..   
-00014c20: 2070 6174 7465 726e 202b 3d20 6d61 7468   pattern += math
-00014c30: 2e70 6f77 2832 2c20 6929 0d0a 0d0a 2020  .pow(2, i)....  
-00014c40: 2352 6574 7572 6e20 6120 7369 6e67 6c65  #Return a single
-00014c50: 2062 616e 6420 696d 6167 6520 6f66 2074   band image of t
-00014c60: 6865 2065 7874 7261 6374 6564 2051 4120  he extracted QA 
-00014c70: 6269 7473 2c20 6769 7669 6e67 2074 6865  bits, giving the
-00014c80: 2062 616e 6420 6120 6e65 7720 6e61 6d65   band a new name
-00014c90: 2e0d 0a20 2072 6574 7572 6e20 696d 6167  ...  return imag
-00014ca0: 652e 7365 6c65 6374 285b 305d 2c20 5b6e  e.select([0], [n
-00014cb0: 6577 4e61 6d65 5d29 2e62 6974 7769 7365  ewName]).bitwise
-00014cc0: 416e 6428 7061 7474 6572 6e29 2e72 6967  And(pattern).rig
-00014cd0: 6874 5368 6966 7428 7374 6172 7429 0d0a  htShift(start)..
-00014ce0: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
+00014a20: 2323 2323 2323 2323 0d0a 2320 4120 6675  ########..# A fu
+00014a30: 6e63 7469 6f6e 2074 6861 7420 7265 7475  nction that retu
+00014a40: 726e 7320 616e 2069 6d61 6765 2063 6f6e  rns an image con
+00014a50: 7461 696e 696e 6720 6a75 7374 2074 6865  taining just the
+00014a60: 2073 7065 6369 6669 6564 2051 4120 6269   specified QA bi
+00014a70: 7473 2e0d 0a23 0d0a 2320 4172 6773 3a0d  ts...#..# Args:.
+00014a80: 0a23 2020 2069 6d61 6765 202d 2054 6865  .#   image - The
+00014a90: 2051 4120 496d 6167 6520 746f 2067 6574   QA Image to get
+00014aa0: 2062 6974 7320 6672 6f6d 2e0d 0a23 2020   bits from...#  
+00014ab0: 2073 7461 7274 202d 2054 6865 2066 6972   start - The fir
+00014ac0: 7374 2062 6974 2070 6f73 6974 696f 6e2c  st bit position,
+00014ad0: 2030 2d62 6173 6564 2e0d 0a23 2020 2065   0-based...#   e
+00014ae0: 6e64 2020 202d 2054 6865 206c 6173 7420  nd   - The last 
+00014af0: 6269 7420 706f 7369 7469 6f6e 2c20 696e  bit position, in
+00014b00: 636c 7573 6976 652e 0d0a 2320 2020 6e61  clusive...#   na
+00014b10: 6d65 2020 2d20 4120 6e61 6d65 2066 6f72  me  - A name for
+00014b20: 2074 6865 206f 7574 7075 7420 696d 6167   the output imag
+00014b30: 652e 0d0a 0d0a 6465 6620 6765 7451 4142  e.....def getQAB
+00014b40: 6974 7328 696d 6167 652c 2073 7461 7274  its(image, start
+00014b50: 2c20 656e 642c 206e 6577 4e61 6d65 293a  , end, newName):
+00014b60: 0d0a 2020 2343 6f6d 7075 7465 2074 6865  ..  #Compute the
+00014b70: 2062 6974 7320 7765 206e 6565 6420 746f   bits we need to
+00014b80: 2065 7874 7261 6374 2e0d 0a20 2070 6174   extract...  pat
+00014b90: 7465 726e 203d 2030 0d0a 2020 666f 7220  tern = 0..  for 
+00014ba0: 6920 696e 2072 616e 6765 2873 7461 7274  i in range(start
+00014bb0: 2c65 6e64 2b31 293a 0d0a 2020 2020 7061  ,end+1):..    pa
+00014bc0: 7474 6572 6e20 2b3d 206d 6174 682e 706f  ttern += math.po
+00014bd0: 7728 322c 2069 290d 0a0d 0a20 2023 5265  w(2, i)....  #Re
+00014be0: 7475 726e 2061 2073 696e 676c 6520 6261  turn a single ba
+00014bf0: 6e64 2069 6d61 6765 206f 6620 7468 6520  nd image of the 
+00014c00: 6578 7472 6163 7465 6420 5141 2062 6974  extracted QA bit
+00014c10: 732c 2067 6976 696e 6720 7468 6520 6261  s, giving the ba
+00014c20: 6e64 2061 206e 6577 206e 616d 652e 0d0a  nd a new name...
+00014c30: 2020 7265 7475 726e 2069 6d61 6765 2e73    return image.s
+00014c40: 656c 6563 7428 5b30 5d2c 205b 6e65 774e  elect([0], [newN
+00014c50: 616d 655d 292e 6269 7477 6973 6541 6e64  ame]).bitwiseAnd
+00014c60: 2870 6174 7465 726e 292e 7269 6768 7453  (pattern).rightS
+00014c70: 6869 6674 2873 7461 7274 290d 0a0d 0a23  hift(start)....#
+00014c80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014c90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014ca0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014cb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014cc0: 2323 2323 2323 2323 0d0a 2323 2323 2323  ########..######
+00014cd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014ce0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00014cf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00014d00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014d10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014d20: 2323 2323 2323 2323 2323 230d 0a23 2323  ###########..###
-00014d30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014d40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014d50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014d60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014d70: 2323 2323 2323 0d0a 2341 2066 756e 6374  ######..#A funct
-00014d80: 696f 6e20 746f 206d 6173 6b20 6f75 7420  ion to mask out 
-00014d90: 636c 6f75 6479 2070 6978 656c 732e 0d0a  cloudy pixels...
-00014da0: 6465 6620 6d61 736b 436c 6f75 6473 5751  def maskCloudsWQ
-00014db0: 4128 696d 6167 6529 3a0d 0a20 2023 5365  A(image):..  #Se
-00014dc0: 6c65 6374 2074 6865 2051 4120 6261 6e64  lect the QA band
-00014dd0: 2e0d 0a20 2051 4120 3d20 696d 6167 652e  ...  QA = image.
-00014de0: 7365 6c65 6374 2827 7374 6174 655f 316b  select('state_1k
-00014df0: 6d27 290d 0a20 2023 4765 7420 7468 6520  m')..  #Get the 
-00014e00: 696e 7465 726e 616c 5f63 6c6f 7564 5f61  internal_cloud_a
-00014e10: 6c67 6f72 6974 686d 5f66 6c61 6720 6269  lgorithm_flag bi
-00014e20: 742e 0d0a 2020 696e 7465 726e 616c 436c  t...  internalCl
-00014e30: 6f75 6420 3d20 6765 7451 4142 6974 7328  oud = getQABits(
-00014e40: 5141 2c20 3130 2c20 3130 2c20 2769 6e74  QA, 10, 10, 'int
-00014e50: 6572 6e61 6c5f 636c 6f75 645f 616c 676f  ernal_cloud_algo
-00014e60: 7269 7468 6d5f 666c 6167 2729 0d0a 2020  rithm_flag')..  
-00014e70: 2352 6574 7572 6e20 616e 2069 6d61 6765  #Return an image
-00014e80: 206d 6173 6b69 6e67 206f 7574 2063 6c6f   masking out clo
-00014e90: 7564 7920 6172 6561 732e 0d0a 2020 7265  udy areas...  re
-00014ea0: 7475 726e 2069 6d61 6765 2e6d 6173 6b28  turn image.mask(
-00014eb0: 696d 6167 652e 6d61 736b 2829 2e41 6e64  image.mask().And
-00014ec0: 2869 6e74 6572 6e61 6c43 6c6f 7564 2e65  (internalCloud.e
-00014ed0: 7128 3029 2929 0d0a 0d0a 2323 2323 2323  q(0)))....######
+00014d10: 2323 230d 0a23 4120 6675 6e63 7469 6f6e  ###..#A function
+00014d20: 2074 6f20 6d61 736b 206f 7574 2063 6c6f   to mask out clo
+00014d30: 7564 7920 7069 7865 6c73 2e0d 0a64 6566  udy pixels...def
+00014d40: 206d 6173 6b43 6c6f 7564 7357 5141 2869   maskCloudsWQA(i
+00014d50: 6d61 6765 293a 0d0a 2020 2353 656c 6563  mage):..  #Selec
+00014d60: 7420 7468 6520 5141 2062 616e 642e 0d0a  t the QA band...
+00014d70: 2020 5141 203d 2069 6d61 6765 2e73 656c    QA = image.sel
+00014d80: 6563 7428 2773 7461 7465 5f31 6b6d 2729  ect('state_1km')
+00014d90: 0d0a 2020 2347 6574 2074 6865 2069 6e74  ..  #Get the int
+00014da0: 6572 6e61 6c5f 636c 6f75 645f 616c 676f  ernal_cloud_algo
+00014db0: 7269 7468 6d5f 666c 6167 2062 6974 2e0d  rithm_flag bit..
+00014dc0: 0a20 2069 6e74 6572 6e61 6c43 6c6f 7564  .  internalCloud
+00014dd0: 203d 2067 6574 5141 4269 7473 2851 412c   = getQABits(QA,
+00014de0: 2031 302c 2031 302c 2027 696e 7465 726e   10, 10, 'intern
+00014df0: 616c 5f63 6c6f 7564 5f61 6c67 6f72 6974  al_cloud_algorit
+00014e00: 686d 5f66 6c61 6727 290d 0a20 2023 5265  hm_flag')..  #Re
+00014e10: 7475 726e 2061 6e20 696d 6167 6520 6d61  turn an image ma
+00014e20: 736b 696e 6720 6f75 7420 636c 6f75 6479  sking out cloudy
+00014e30: 2061 7265 6173 2e0d 0a20 2072 6574 7572   areas...  retur
+00014e40: 6e20 696d 6167 652e 6d61 736b 2869 6d61  n image.mask(ima
+00014e50: 6765 2e6d 6173 6b28 292e 416e 6428 696e  ge.mask().And(in
+00014e60: 7465 726e 616c 436c 6f75 642e 6571 2830  ternalCloud.eq(0
+00014e70: 2929 290d 0a0d 0a23 2323 2323 2323 2323  )))....#########
+00014e80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014e90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014ea0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014eb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014ec0: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
+00014ed0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00014ee0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00014ef0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014f00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014f10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014f20: 2323 230d 0a23 2323 2323 2323 2323 2323  ###..###########
-00014f30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014f40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014f50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014f60: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
-00014f70: 2353 6f75 7263 653a 2063 6f64 652e 6561  #Source: code.ea
-00014f80: 7274 6865 6e67 696e 652e 676f 6f67 6c65  rthengine.google
-00014f90: 2e63 6f6d 0d0a 2343 6f6d 7075 7465 2061  .com..#Compute a
-00014fa0: 2063 6c6f 7564 2073 636f 7265 2e20 2054   cloud score.  T
-00014fb0: 6869 7320 6578 7065 6374 7320 7468 6520  his expects the 
-00014fc0: 696e 7075 7420 696d 6167 6520 746f 2068  input image to h
-00014fd0: 6176 6520 7468 6520 636f 6d6d 6f6e 0d0a  ave the common..
-00014fe0: 2362 616e 6420 6e61 6d65 733a 205b 2272  #band names: ["r
-00014ff0: 6564 222c 2022 626c 7565 222c 2065 7463  ed", "blue", etc
-00015000: 5d2c 2073 6f20 6974 2063 616e 2077 6f72  ], so it can wor
-00015010: 6b20 6163 726f 7373 2073 656e 736f 7273  k across sensors
-00015020: 2e0d 0a64 6566 206d 6f64 6973 436c 6f75  ...def modisClou
-00015030: 6453 636f 7265 2869 6d67 293a 0d0a 0d0a  dScore(img):....
-00015040: 2020 7573 6554 656d 7049 6e43 6c6f 7564    useTempInCloud
-00015050: 4d61 736b 203d 2054 7275 650d 0a20 2023  Mask = True..  #
-00015060: 436f 6d70 7574 6520 7365 7665 7261 6c20  Compute several 
-00015070: 696e 6469 6361 746f 7273 206f 6620 636c  indicators of cl
-00015080: 6f75 6479 6e65 7373 2061 6e64 2074 616b  oudyness and tak
-00015090: 6520 7468 6520 6d69 6e69 6d75 6d20 6f66  e the minimum of
-000150a0: 2074 6865 6d2e 0d0a 2020 7363 6f72 6520   them...  score 
-000150b0: 3d20 6565 2e49 6d61 6765 2831 2e30 293b  = ee.Image(1.0);
-000150c0: 0d0a 0d0a 2020 2343 6c6f 7564 7320 6172  ....  #Clouds ar
-000150d0: 6520 7265 6173 6f6e 6162 6c79 2062 7269  e reasonably bri
-000150e0: 6768 7420 696e 2074 6865 2062 6c75 6520  ght in the blue 
-000150f0: 6261 6e64 2e0d 0a20 2023 2073 636f 7265  band...  # score
-00015100: 203d 2073 636f 7265 2e6d 696e 2872 6573   = score.min(res
-00015110: 6361 6c65 2869 6d67 2c20 2769 6d67 2e62  cale(img, 'img.b
-00015120: 6c75 6527 2c20 5b30 2e31 2c20 302e 335d  lue', [0.1, 0.3]
-00015130: 2929 0d0a 2020 2343 6c6f 7564 7320 6172  ))..  #Clouds ar
-00015140: 6520 7265 6173 6f6e 6162 6c79 2062 7269  e reasonably bri
-00015150: 6768 7420 696e 2061 6c6c 2076 6973 6962  ght in all visib
-00015160: 6c65 2062 616e 6473 2e0d 0a20 2076 697a  le bands...  viz
-00015170: 5375 6d20 3d20 7265 7363 616c 6528 696d  Sum = rescale(im
-00015180: 672e 7365 6c65 6374 285b 2772 6564 272c  g.select(['red',
-00015190: 2767 7265 656e 272c 2762 6c75 6527 5d29  'green','blue'])
-000151a0: 2e72 6564 7563 6528 6565 2e52 6564 7563  .reduce(ee.Reduc
-000151b0: 6572 2e73 756d 2829 292c 205b 302e 322c  er.sum()), [0.2,
-000151c0: 2030 2e38 5d29 0d0a 2020 7363 6f72 6520   0.8])..  score 
-000151d0: 3d20 7363 6f72 652e 6d69 6e28 7669 7a53  = score.min(vizS
-000151e0: 756d 290d 0a0d 0a20 2023 436c 6f75 6473  um)....  #Clouds
-000151f0: 2061 7265 2072 6561 736f 6e61 626c 7920   are reasonably 
-00015200: 6272 6967 6874 2069 6e20 616c 6c20 696e  bright in all in
-00015210: 6672 6172 6564 2062 616e 6473 2e0d 0a20  frared bands... 
-00015220: 2023 2069 7253 756d 203d 7265 7363 616c   # irSum =rescal
-00015230: 6528 696d 672c 2027 696d 672e 6e69 7220  e(img, 'img.nir 
-00015240: 2b20 696d 672e 7377 6972 3227 2c20 5b30  + img.swir2', [0
-00015250: 2e33 2c20 302e 375d 290d 0a20 2069 7253  .3, 0.7])..  irS
-00015260: 756d 203d 7265 7363 616c 6528 696d 672e  um =rescale(img.
-00015270: 7365 6c65 6374 285b 276e 6972 272c 2773  select(['nir','s
-00015280: 7769 7231 272c 2773 7769 7232 275d 292e  wir1','swir2']).
-00015290: 7265 6475 6365 2865 652e 5265 6475 6365  reduce(ee.Reduce
-000152a0: 722e 7375 6d28 2929 2c20 5b30 2e33 2c20  r.sum()), [0.3, 
-000152b0: 302e 385d 290d 0a20 2073 636f 7265 203d  0.8])..  score =
-000152c0: 2073 636f 7265 2e6d 696e 2869 7253 756d   score.min(irSum
-000152d0: 290d 0a0d 0a20 2023 486f 7765 7665 722c  )....  #However,
-000152e0: 2063 6c6f 7564 7320 6172 6520 6e6f 7420   clouds are not 
-000152f0: 736e 6f77 2e0d 0a20 206e 6473 6920 3d20  snow...  ndsi = 
-00015300: 696d 672e 6e6f 726d 616c 697a 6564 4469  img.normalizedDi
-00015310: 6666 6572 656e 6365 285b 2767 7265 656e  fference(['green
-00015320: 272c 2027 7377 6972 3227 5d29 0d0a 2020  ', 'swir2'])..  
-00015330: 736e 6f77 5363 6f72 6520 3d20 7265 7363  snowScore = resc
-00015340: 616c 6528 6e64 7369 2c20 205b 302e 382c  ale(ndsi,  [0.8,
-00015350: 2030 2e36 5d29 0d0a 2020 7363 6f72 6520   0.6])..  score 
-00015360: 3d73 636f 7265 2e6d 696e 2873 6e6f 7753  =score.min(snowS
-00015370: 636f 7265 290d 0a0d 0a20 2023 466f 7220  core)....  #For 
-00015380: 4d4f 4449 532c 2070 726f 7669 6465 2074  MODIS, provide t
-00015390: 6865 206f 7074 696f 6e20 6f66 206e 6f74  he option of not
-000153a0: 2075 7369 6e67 2074 6865 726d 616c 2073   using thermal s
-000153b0: 696e 6365 2069 7420 696e 7472 6f64 7563  ince it introduc
-000153c0: 6573 0d0a 2020 2361 2070 7265 636f 6d70  es..  #a precomp
-000153d0: 7574 6564 206d 6173 6b20 7468 6174 206d  uted mask that m
-000153e0: 6179 206f 7220 6d61 7920 6e6f 7420 6265  ay or may not be
-000153f0: 2077 616e 7465 640d 0a20 2069 6620 7573   wanted..  if us
-00015400: 6554 656d 7049 6e43 6c6f 7564 4d61 736b  eTempInCloudMask
-00015410: 3a0d 0a20 2020 2020 2023 436c 6f75 6473  :..      #Clouds
-00015420: 2061 7265 2072 6561 736f 6e61 626c 7920   are reasonably 
-00015430: 636f 6f6c 2069 6e20 7465 6d70 6572 6174  cool in temperat
-00015440: 7572 652e 0d0a 2020 2020 2020 2320 7465  ure...      # te
-00015450: 6d70 5363 6f72 6520 3d20 7265 7363 616c  mpScore = rescal
-00015460: 6528 696d 672c 2027 696d 672e 7465 6d70  e(img, 'img.temp
-00015470: 272c 205b 3330 352c 2033 3030 5d29 0d0a  ', [305, 300])..
-00015480: 2020 2020 2020 2320 4d61 702e 6164 644c        # Map.addL
-00015490: 6179 6572 2874 656d 7053 636f 7265 2c7b  ayer(tempScore,{
-000154a0: 7d2c 2774 656d 7073 636f 7265 2729 0d0a  },'tempscore')..
-000154b0: 2020 2020 2020 2373 636f 7265 203d 2073        #score = s
-000154c0: 636f 7265 2e6d 696e 2874 656d 7053 636f  core.min(tempSco
-000154d0: 7265 290d 0a20 2020 2020 2073 636f 7265  re)..      score
-000154e0: 203d 2073 636f 7265 2e77 6865 7265 2869   = score.where(i
-000154f0: 6d67 2e73 656c 6563 7428 5b27 7465 6d70  mg.select(['temp
-00015500: 275d 292e 6d61 736b 2829 2e4e 6f74 2829  ']).mask().Not()
-00015510: 2c31 290d 0a0d 0a20 2073 636f 7265 203d  ,1)....  score =
-00015520: 2073 636f 7265 2e6d 756c 7469 706c 7928   score.multiply(
-00015530: 3130 3029 0d0a 2020 7363 6f72 6520 3d20  100)..  score = 
-00015540: 7363 6f72 652e 636c 616d 7028 302c 3130  score.clamp(0,10
-00015550: 3029 2e62 7974 6528 290d 0a0d 0a20 2072  0).byte()....  r
-00015560: 6574 7572 6e20 7363 6f72 652e 7265 6e61  eturn score.rena
-00015570: 6d65 285b 2763 6c6f 7564 5363 6f72 6527  me(['cloudScore'
-00015580: 5d29 3b0d 0a0d 0a23 2323 2323 2323 2323  ]);....#########
+00014f00: 2323 2323 2323 2323 2323 230d 0a23 536f  ###########..#So
+00014f10: 7572 6365 3a20 636f 6465 2e65 6172 7468  urce: code.earth
+00014f20: 656e 6769 6e65 2e67 6f6f 676c 652e 636f  engine.google.co
+00014f30: 6d0d 0a23 436f 6d70 7574 6520 6120 636c  m..#Compute a cl
+00014f40: 6f75 6420 7363 6f72 652e 2020 5468 6973  oud score.  This
+00014f50: 2065 7870 6563 7473 2074 6865 2069 6e70   expects the inp
+00014f60: 7574 2069 6d61 6765 2074 6f20 6861 7665  ut image to have
+00014f70: 2074 6865 2063 6f6d 6d6f 6e0d 0a23 6261   the common..#ba
+00014f80: 6e64 206e 616d 6573 3a20 5b22 7265 6422  nd names: ["red"
+00014f90: 2c20 2262 6c75 6522 2c20 6574 635d 2c20  , "blue", etc], 
+00014fa0: 736f 2069 7420 6361 6e20 776f 726b 2061  so it can work a
+00014fb0: 6372 6f73 7320 7365 6e73 6f72 732e 0d0a  cross sensors...
+00014fc0: 6465 6620 6d6f 6469 7343 6c6f 7564 5363  def modisCloudSc
+00014fd0: 6f72 6528 696d 6729 3a0d 0a0d 0a20 2075  ore(img):....  u
+00014fe0: 7365 5465 6d70 496e 436c 6f75 644d 6173  seTempInCloudMas
+00014ff0: 6b20 3d20 5472 7565 0d0a 2020 2343 6f6d  k = True..  #Com
+00015000: 7075 7465 2073 6576 6572 616c 2069 6e64  pute several ind
+00015010: 6963 6174 6f72 7320 6f66 2063 6c6f 7564  icators of cloud
+00015020: 796e 6573 7320 616e 6420 7461 6b65 2074  yness and take t
+00015030: 6865 206d 696e 696d 756d 206f 6620 7468  he minimum of th
+00015040: 656d 2e0d 0a20 2073 636f 7265 203d 2065  em...  score = e
+00015050: 652e 496d 6167 6528 312e 3029 3b0d 0a0d  e.Image(1.0);...
+00015060: 0a20 2023 436c 6f75 6473 2061 7265 2072  .  #Clouds are r
+00015070: 6561 736f 6e61 626c 7920 6272 6967 6874  easonably bright
+00015080: 2069 6e20 7468 6520 626c 7565 2062 616e   in the blue ban
+00015090: 642e 0d0a 2020 2320 7363 6f72 6520 3d20  d...  # score = 
+000150a0: 7363 6f72 652e 6d69 6e28 7265 7363 616c  score.min(rescal
+000150b0: 6528 696d 672c 2027 696d 672e 626c 7565  e(img, 'img.blue
+000150c0: 272c 205b 302e 312c 2030 2e33 5d29 290d  ', [0.1, 0.3])).
+000150d0: 0a20 2023 436c 6f75 6473 2061 7265 2072  .  #Clouds are r
+000150e0: 6561 736f 6e61 626c 7920 6272 6967 6874  easonably bright
+000150f0: 2069 6e20 616c 6c20 7669 7369 626c 6520   in all visible 
+00015100: 6261 6e64 732e 0d0a 2020 7669 7a53 756d  bands...  vizSum
+00015110: 203d 2072 6573 6361 6c65 2869 6d67 2e73   = rescale(img.s
+00015120: 656c 6563 7428 5b27 7265 6427 2c27 6772  elect(['red','gr
+00015130: 6565 6e27 2c27 626c 7565 275d 292e 7265  een','blue']).re
+00015140: 6475 6365 2865 652e 5265 6475 6365 722e  duce(ee.Reducer.
+00015150: 7375 6d28 2929 2c20 5b30 2e32 2c20 302e  sum()), [0.2, 0.
+00015160: 385d 290d 0a20 2073 636f 7265 203d 2073  8])..  score = s
+00015170: 636f 7265 2e6d 696e 2876 697a 5375 6d29  core.min(vizSum)
+00015180: 0d0a 0d0a 2020 2343 6c6f 7564 7320 6172  ....  #Clouds ar
+00015190: 6520 7265 6173 6f6e 6162 6c79 2062 7269  e reasonably bri
+000151a0: 6768 7420 696e 2061 6c6c 2069 6e66 7261  ght in all infra
+000151b0: 7265 6420 6261 6e64 732e 0d0a 2020 2320  red bands...  # 
+000151c0: 6972 5375 6d20 3d72 6573 6361 6c65 2869  irSum =rescale(i
+000151d0: 6d67 2c20 2769 6d67 2e6e 6972 202b 2069  mg, 'img.nir + i
+000151e0: 6d67 2e73 7769 7232 272c 205b 302e 332c  mg.swir2', [0.3,
+000151f0: 2030 2e37 5d29 0d0a 2020 6972 5375 6d20   0.7])..  irSum 
+00015200: 3d72 6573 6361 6c65 2869 6d67 2e73 656c  =rescale(img.sel
+00015210: 6563 7428 5b27 6e69 7227 2c27 7377 6972  ect(['nir','swir
+00015220: 3127 2c27 7377 6972 3227 5d29 2e72 6564  1','swir2']).red
+00015230: 7563 6528 6565 2e52 6564 7563 6572 2e73  uce(ee.Reducer.s
+00015240: 756d 2829 292c 205b 302e 332c 2030 2e38  um()), [0.3, 0.8
+00015250: 5d29 0d0a 2020 7363 6f72 6520 3d20 7363  ])..  score = sc
+00015260: 6f72 652e 6d69 6e28 6972 5375 6d29 0d0a  ore.min(irSum)..
+00015270: 0d0a 2020 2348 6f77 6576 6572 2c20 636c  ..  #However, cl
+00015280: 6f75 6473 2061 7265 206e 6f74 2073 6e6f  ouds are not sno
+00015290: 772e 0d0a 2020 6e64 7369 203d 2069 6d67  w...  ndsi = img
+000152a0: 2e6e 6f72 6d61 6c69 7a65 6444 6966 6665  .normalizedDiffe
+000152b0: 7265 6e63 6528 5b27 6772 6565 6e27 2c20  rence(['green', 
+000152c0: 2773 7769 7232 275d 290d 0a20 2073 6e6f  'swir2'])..  sno
+000152d0: 7753 636f 7265 203d 2072 6573 6361 6c65  wScore = rescale
+000152e0: 286e 6473 692c 2020 5b30 2e38 2c20 302e  (ndsi,  [0.8, 0.
+000152f0: 365d 290d 0a20 2073 636f 7265 203d 7363  6])..  score =sc
+00015300: 6f72 652e 6d69 6e28 736e 6f77 5363 6f72  ore.min(snowScor
+00015310: 6529 0d0a 0d0a 2020 2346 6f72 204d 4f44  e)....  #For MOD
+00015320: 4953 2c20 7072 6f76 6964 6520 7468 6520  IS, provide the 
+00015330: 6f70 7469 6f6e 206f 6620 6e6f 7420 7573  option of not us
+00015340: 696e 6720 7468 6572 6d61 6c20 7369 6e63  ing thermal sinc
+00015350: 6520 6974 2069 6e74 726f 6475 6365 730d  e it introduces.
+00015360: 0a20 2023 6120 7072 6563 6f6d 7075 7465  .  #a precompute
+00015370: 6420 6d61 736b 2074 6861 7420 6d61 7920  d mask that may 
+00015380: 6f72 206d 6179 206e 6f74 2062 6520 7761  or may not be wa
+00015390: 6e74 6564 0d0a 2020 6966 2075 7365 5465  nted..  if useTe
+000153a0: 6d70 496e 436c 6f75 644d 6173 6b3a 0d0a  mpInCloudMask:..
+000153b0: 2020 2020 2020 2343 6c6f 7564 7320 6172        #Clouds ar
+000153c0: 6520 7265 6173 6f6e 6162 6c79 2063 6f6f  e reasonably coo
+000153d0: 6c20 696e 2074 656d 7065 7261 7475 7265  l in temperature
+000153e0: 2e0d 0a20 2020 2020 2023 2074 656d 7053  ...      # tempS
+000153f0: 636f 7265 203d 2072 6573 6361 6c65 2869  core = rescale(i
+00015400: 6d67 2c20 2769 6d67 2e74 656d 7027 2c20  mg, 'img.temp', 
+00015410: 5b33 3035 2c20 3330 305d 290d 0a20 2020  [305, 300])..   
+00015420: 2020 2023 204d 6170 2e61 6464 4c61 7965     # Map.addLaye
+00015430: 7228 7465 6d70 5363 6f72 652c 7b7d 2c27  r(tempScore,{},'
+00015440: 7465 6d70 7363 6f72 6527 290d 0a20 2020  tempscore')..   
+00015450: 2020 2023 7363 6f72 6520 3d20 7363 6f72     #score = scor
+00015460: 652e 6d69 6e28 7465 6d70 5363 6f72 6529  e.min(tempScore)
+00015470: 0d0a 2020 2020 2020 7363 6f72 6520 3d20  ..      score = 
+00015480: 7363 6f72 652e 7768 6572 6528 696d 672e  score.where(img.
+00015490: 7365 6c65 6374 285b 2774 656d 7027 5d29  select(['temp'])
+000154a0: 2e6d 6173 6b28 292e 4e6f 7428 292c 3129  .mask().Not(),1)
+000154b0: 0d0a 0d0a 2020 7363 6f72 6520 3d20 7363  ....  score = sc
+000154c0: 6f72 652e 6d75 6c74 6970 6c79 2831 3030  ore.multiply(100
+000154d0: 290d 0a20 2073 636f 7265 203d 2073 636f  )..  score = sco
+000154e0: 7265 2e63 6c61 6d70 2830 2c31 3030 292e  re.clamp(0,100).
+000154f0: 6279 7465 2829 0d0a 0d0a 2020 7265 7475  byte()....  retu
+00015500: 726e 2073 636f 7265 2e72 656e 616d 6528  rn score.rename(
+00015510: 5b27 636c 6f75 6453 636f 7265 275d 293b  ['cloudScore']);
+00015520: 0d0a 0d0a 2323 2323 2323 2323 2323 2323  ....############
+00015530: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015540: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015550: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015560: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
+00015570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015580: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00015590: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000155a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000155b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000155c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000155d0: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
-000155e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000155f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015600: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015610: 2323 2323 2323 2323 2323 230d 0a23 436c  ###########..#Cl
-00015620: 6f75 6420 6d61 736b 696e 6720 616c 676f  oud masking algo
-00015630: 7269 7468 6d20 666f 7220 5365 6e74 696e  rithm for Sentin
-00015640: 656c 320d 0a23 4275 696c 7420 6f6e 2069  el2..#Built on i
-00015650: 6465 6173 2066 726f 6d20 4c61 6e64 7361  deas from Landsa
-00015660: 7420 636c 6f75 6453 636f 7265 2061 6c67  t cloudScore alg
-00015670: 6f72 6974 686d 0d0a 2343 7572 7265 6e74  orithm..#Current
-00015680: 6c79 2069 6e20 6265 7461 2061 6e64 206d  ly in beta and m
-00015690: 6179 206e 6565 6420 7477 6561 6b69 6e67  ay need tweaking
-000156a0: 2066 6f72 2069 6e64 6976 6964 7561 6c20   for individual 
-000156b0: 7374 7564 7920 6172 6561 730d 0a64 6566  study areas..def
-000156c0: 2073 656e 7469 6e65 6c32 436c 6f75 6453   sentinel2CloudS
-000156d0: 636f 7265 2869 6d67 293a 0d0a 2020 2343  core(img):..  #C
-000156e0: 6f6d 7075 7465 2073 6576 6572 616c 2069  ompute several i
-000156f0: 6e64 6963 6174 6f72 7320 6f66 2063 6c6f  ndicators of clo
-00015700: 7564 796e 6573 7320 616e 6420 7461 6b65  udyness and take
-00015710: 2074 6865 206d 696e 696d 756d 206f 6620   the minimum of 
-00015720: 7468 656d 2e0d 0a20 2073 636f 7265 203d  them...  score =
-00015730: 2065 652e 496d 6167 6528 3129 0d0a 2020   ee.Image(1)..  
-00015740: 626c 7565 4369 7272 7573 5363 6f72 6520  blueCirrusScore 
-00015750: 3d20 6565 2e49 6d61 6765 2830 290d 0a0d  = ee.Image(0)...
-00015760: 0a20 2023 436c 6f75 6473 2061 7265 2072  .  #Clouds are r
-00015770: 6561 736f 6e61 626c 7920 6272 6967 6874  easonably bright
-00015780: 2069 6e20 7468 6520 626c 7565 206f 7220   in the blue or 
-00015790: 6369 7272 7573 2062 616e 6473 2e0d 0a20  cirrus bands... 
-000157a0: 2023 5573 6520 2e6d 6178 2061 7320 6120   #Use .max as a 
-000157b0: 7073 6575 646f 204f 5220 636f 6e64 6974  pseudo OR condit
-000157c0: 696f 6e61 6c0d 0a20 2062 6c75 6543 6972  ional..  blueCir
-000157d0: 7275 7353 636f 7265 203d 2062 6c75 6543  rusScore = blueC
-000157e0: 6972 7275 7353 636f 7265 2e6d 6178 2872  irrusScore.max(r
-000157f0: 6573 6361 6c65 2869 6d67 2e73 656c 6563  escale(img.selec
-00015800: 7428 5b27 626c 7565 275d 292c 205b 302e  t(['blue']), [0.
-00015810: 312c 2030 2e35 5d29 290d 0a20 2062 6c75  1, 0.5]))..  blu
-00015820: 6543 6972 7275 7353 636f 7265 203d 2062  eCirrusScore = b
-00015830: 6c75 6543 6972 7275 7353 636f 7265 2e6d  lueCirrusScore.m
-00015840: 6178 2872 6573 6361 6c65 2869 6d67 2e73  ax(rescale(img.s
-00015850: 656c 6563 7428 5b27 6362 275d 292c 205b  elect(['cb']), [
-00015860: 302e 312c 2030 2e35 5d29 290d 0a20 2023  0.1, 0.5]))..  #
-00015870: 2062 6c75 6543 6972 7275 7353 636f 7265   blueCirrusScore
-00015880: 203d 2062 6c75 6543 6972 7275 7353 636f   = blueCirrusSco
-00015890: 7265 2e6d 6178 2872 6573 6361 6c65 2869  re.max(rescale(i
-000158a0: 6d67 2c20 2769 6d67 2e63 6972 7275 7327  mg, 'img.cirrus'
-000158b0: 2c20 5b30 2e31 2c20 302e 335d 2929 0d0a  , [0.1, 0.3]))..
-000158c0: 0d0a 2020 2372 6553 756d 203d 2072 6573  ..  #reSum = res
-000158d0: 6361 6c65 2869 6d67 2c27 2869 6d67 2e72  cale(img,'(img.r
-000158e0: 6531 2b69 6d67 2e72 6532 2b69 6d67 2e72  e1+img.re2+img.r
-000158f0: 6533 292f 3327 2c5b 302e 352c 2030 2e37  e3)/3',[0.5, 0.7
-00015900: 5d29 0d0a 0d0a 2020 7363 6f72 6520 3d20  ])....  score = 
-00015910: 7363 6f72 652e 6d69 6e28 626c 7565 4369  score.min(blueCi
-00015920: 7272 7573 5363 6f72 6529 0d0a 0d0a 2020  rrusScore)....  
-00015930: 2343 6c6f 7564 7320 6172 6520 7265 6173  #Clouds are reas
-00015940: 6f6e 6162 6c79 2062 7269 6768 7420 696e  onably bright in
-00015950: 2061 6c6c 2076 6973 6962 6c65 2062 616e   all visible ban
-00015960: 6473 2e0d 0a20 2073 636f 7265 203d 2073  ds...  score = s
-00015970: 636f 7265 2e6d 696e 2872 6573 6361 6c65  core.min(rescale
-00015980: 2869 6d67 2e73 656c 6563 7428 5b27 7265  (img.select(['re
-00015990: 6427 2c27 6772 6565 6e27 2c27 626c 7565  d','green','blue
-000159a0: 275d 292e 7265 6475 6365 2865 652e 5265  ']).reduce(ee.Re
-000159b0: 6475 6365 722e 7375 6d28 2929 2c20 5b30  ducer.sum()), [0
-000159c0: 2e32 2c20 302e 385d 2929 0d0a 0d0a 2020  .2, 0.8]))....  
-000159d0: 2343 6c6f 7564 7320 6172 6520 7265 6173  #Clouds are reas
-000159e0: 6f6e 6162 6c79 2062 7269 6768 7420 696e  onably bright in
-000159f0: 2061 6c6c 2069 6e66 7261 7265 6420 6261   all infrared ba
-00015a00: 6e64 732e 0d0a 2020 7363 6f72 6520 3d20  nds...  score = 
-00015a10: 7363 6f72 652e 6d69 6e28 7265 7363 616c  score.min(rescal
-00015a20: 6528 696d 672e 7365 6c65 6374 285b 276e  e(img.select(['n
-00015a30: 6972 272c 2773 7769 7231 272c 2773 7769  ir','swir1','swi
-00015a40: 7232 275d 292e 7265 6475 6365 2865 652e  r2']).reduce(ee.
-00015a50: 5265 6475 6365 722e 7375 6d28 2929 2c20  Reducer.sum()), 
-00015a60: 5b30 2e33 2c20 302e 385d 2929 0d0a 0d0a  [0.3, 0.8]))....
-00015a70: 2020 2348 6f77 6576 6572 2c20 636c 6f75    #However, clou
-00015a80: 6473 2061 7265 206e 6f74 2073 6e6f 772e  ds are not snow.
-00015a90: 0d0a 2020 6e64 7369 203d 2020 696d 672e  ..  ndsi =  img.
-00015aa0: 6e6f 726d 616c 697a 6564 4469 6666 6572  normalizedDiffer
-00015ab0: 656e 6365 285b 2767 7265 656e 272c 2027  ence(['green', '
-00015ac0: 7377 6972 3127 5d29 0d0a 2020 7363 6f72  swir1'])..  scor
-00015ad0: 653d 7363 6f72 652e 6d69 6e28 7265 7363  e=score.min(resc
-00015ae0: 616c 6528 6e64 7369 2c20 5b30 2e38 2c20  ale(ndsi, [0.8, 
-00015af0: 302e 365d 2929 0d0a 0d0a 2020 7363 6f72  0.6]))....  scor
-00015b00: 6520 3d20 7363 6f72 652e 6d75 6c74 6970  e = score.multip
-00015b10: 6c79 2831 3030 292e 6279 7465 2829 2e63  ly(100).byte().c
-00015b20: 6c61 6d70 2830 2c31 3030 292e 7265 6e61  lamp(0,100).rena
-00015b30: 6d65 285b 2763 6c6f 7564 5363 6f72 6527  me(['cloudScore'
-00015b40: 5d29 0d0a 2020 7265 7475 726e 2073 636f  ])..  return sco
-00015b50: 7265 0d0a 2323 2323 2323 2323 2323 2323  re..############
-00015b60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015b70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015b80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015b90: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
-00015ba0: 4164 6170 7465 6420 6672 6f6d 3a20 6874  Adapted from: ht
-00015bb0: 7470 733a 2f2f 6561 7274 682e 6573 612e  tps://earth.esa.
-00015bc0: 696e 742f 646f 6375 6d65 6e74 732f 3130  int/documents/10
-00015bd0: 3137 342f 3331 3636 3030 382f 4553 415f  174/3166008/ESA_
-00015be0: 5472 6169 6e69 6e67 5f56 696c 6e69 7573  Training_Vilnius
-00015bf0: 5f30 3730 3732 3031 375f 5341 525f 4f70  _07072017_SAR_Op
-00015c00: 7469 6361 6c5f 536e 6f77 5f49 6365 5f45  tical_Snow_Ice_E
-00015c10: 7865 7263 6973 6573 2e70 6466 0d0a 6465  xercises.pdf..de
-00015c20: 6620 7365 6e74 696e 656c 3253 6e6f 774d  f sentinel2SnowM
-00015c30: 6173 6b28 696d 672c 6469 6c61 7465 5069  ask(img,dilatePi
-00015c40: 7865 6c73 203d 2033 2e35 293a 0d0a 2020  xels = 3.5):..  
-00015c50: 6e64 7369 203d 2020 696d 672e 6e6f 726d  ndsi =  img.norm
-00015c60: 616c 697a 6564 4469 6666 6572 656e 6365  alizedDifference
-00015c70: 285b 2767 7265 656e 272c 2027 7377 6972  (['green', 'swir
-00015c80: 3127 5d29 0d0a 0d0a 2020 2349 4620 4e44  1'])....  #IF ND
-00015c90: 5349 203e 2030 2e34 3020 414e 4420 cf81  SI > 0.40 AND ..
-00015ca0: 284e 4952 2920 3e20 302e 3131 2054 4845  (NIR) > 0.11 THE
-00015cb0: 4e20 736e 6f77 2069 6e20 6f70 656e 206c  N snow in open l
-00015cc0: 616e 640d 0a20 2023 4946 2030 2e31 203c  and..  #IF 0.1 <
-00015cd0: 204e 4453 4920 3c20 302e 3420 5448 454e   NDSI < 0.4 THEN
-00015ce0: 2073 6e6f 7720 696e 2066 6f72 6573 740d   snow in forest.
-00015cf0: 0a20 2073 6e6f 774f 7065 6e4c 616e 6420  .  snowOpenLand 
-00015d00: 3d20 6e64 7369 2e67 7428 302e 3429 2e41  = ndsi.gt(0.4).A
-00015d10: 6e64 2869 6d67 2e73 656c 6563 7428 5b27  nd(img.select(['
-00015d20: 6e69 7227 5d29 2e67 7428 302e 3131 2929  nir']).gt(0.11))
-00015d30: 0d0a 2020 736e 6f77 466f 7265 7374 203d  ..  snowForest =
-00015d40: 206e 6473 692e 6774 2830 2e31 292e 416e   ndsi.gt(0.1).An
-00015d50: 6428 6e64 7369 2e6c 7428 302e 3429 290d  d(ndsi.lt(0.4)).
-00015d60: 0a0d 0a20 2023 204d 6170 2e61 6464 4c61  ...  # Map.addLa
-00015d70: 7965 7228 736e 6f77 4f70 656e 4c61 6e64  yer(snowOpenLand
-00015d80: 2e73 656c 664d 6173 6b28 292c 7b27 6d69  .selfMask(),{'mi
-00015d90: 6e27 3a31 2c27 6d61 7827 3a31 2c27 7061  n':1,'max':1,'pa
-00015da0: 6c65 7474 6527 3a27 3838 4627 7d2c 2753  lette':'88F'},'S
-00015db0: 6e6f 7720 4f70 656e 204c 616e 6427 290d  now Open Land').
-00015dc0: 0a20 2023 204d 6170 2e61 6464 4c61 7965  .  # Map.addLaye
-00015dd0: 7228 736e 6f77 466f 7265 7374 2e73 656c  r(snowForest.sel
-00015de0: 664d 6173 6b28 292c 7b27 6d69 6e27 3a31  fMask(),{'min':1
-00015df0: 2c27 6d61 7827 3a31 2c27 7061 6c65 7474  ,'max':1,'palett
-00015e00: 6527 3a27 3030 4627 7d2c 2753 6e6f 7720  e':'00F'},'Snow 
-00015e10: 466f 7265 7374 2729 0d0a 2020 2346 7261  Forest')..  #Fra
-00015e20: 6374 696f 6e61 6c20 736e 6f77 2063 6f76  ctional snow cov
-00015e30: 6572 2028 4653 432c 2030 2025 202d 2031  er (FSC, 0 % - 1
-00015e40: 3030 2520 736e 6f77 2920 6361 6e20 6265  00% snow) can be
-00015e50: 2064 6574 6563 7465 6420 6279 2074 6865   detected by the
-00015e60: 2061 7070 726f 6163 6820 6f66 2053 616c   approach of Sal
-00015e70: 6f6d 6f6e 736f 6e0d 0a20 2023 616e 6420  omonson..  #and 
-00015e80: 4170 7065 6c20 2832 3030 342c 2032 3030  Appel (2004, 200
-00015e90: 3629 2c20 7768 6963 6820 7761 7320 6f72  6), which was or
-00015ea0: 6967 696e 616c 6c79 2064 6576 656c 6f70  iginally develop
-00015eb0: 6564 2066 6f72 204d 4f44 4953 2064 6174  ed for MODIS dat
-00015ec0: 613a 0d0a 2020 2346 5343 203d 20e2 8093  a:..  #FSC = ...
-00015ed0: 302e 3031 202b 2031 2e34 3520 2a20 4e44  0.01 + 1.45 * ND
-00015ee0: 5349 0d0a 2020 6673 6320 3d20 6e64 7369  SI..  fsc = ndsi
-00015ef0: 2e6d 756c 7469 706c 7928 312e 3435 292e  .multiply(1.45).
-00015f00: 7375 6274 7261 6374 2830 2e30 3129 0d0a  subtract(0.01)..
-00015f10: 2020 2320 4d61 702e 6164 644c 6179 6572    # Map.addLayer
-00015f20: 2866 7363 2c7b 276d 696e 273a 302c 276d  (fsc,{'min':0,'m
-00015f30: 6178 273a 312c 2770 616c 6574 7465 273a  ax':1,'palette':
-00015f40: 2730 3830 2c30 3038 277d 2c27 4672 6163  '080,008'},'Frac
-00015f50: 7469 6f6e 616c 2053 6e6f 7720 436f 7665  tional Snow Cove
-00015f60: 7227 290d 0a20 2073 6e6f 774d 6173 6b20  r')..  snowMask 
-00015f70: 3d20 2828 736e 6f77 4f70 656e 4c61 6e64  = ((snowOpenLand
-00015f80: 2e4f 7228 736e 6f77 466f 7265 7374 2929  .Or(snowForest))
-00015f90: 2e4e 6f74 2829 292e 666f 6361 6c5f 6d69  .Not()).focal_mi
-00015fa0: 6e28 6469 6c61 7465 5069 7865 6c73 290d  n(dilatePixels).
-00015fb0: 0a20 2072 6574 7572 6e20 696d 672e 7570  .  return img.up
-00015fc0: 6461 7465 4d61 736b 2873 6e6f 774d 6173  dateMask(snowMas
-00015fd0: 6b29 0d0a 2323 2323 2323 2323 2323 2323  k)..############
+000155b0: 2323 2323 2323 2323 0d0a 2343 6c6f 7564  ########..#Cloud
+000155c0: 206d 6173 6b69 6e67 2061 6c67 6f72 6974   masking algorit
+000155d0: 686d 2066 6f72 2053 656e 7469 6e65 6c32  hm for Sentinel2
+000155e0: 0d0a 2342 7569 6c74 206f 6e20 6964 6561  ..#Built on idea
+000155f0: 7320 6672 6f6d 204c 616e 6473 6174 2063  s from Landsat c
+00015600: 6c6f 7564 5363 6f72 6520 616c 676f 7269  loudScore algori
+00015610: 7468 6d0d 0a23 4375 7272 656e 746c 7920  thm..#Currently 
+00015620: 696e 2062 6574 6120 616e 6420 6d61 7920  in beta and may 
+00015630: 6e65 6564 2074 7765 616b 696e 6720 666f  need tweaking fo
+00015640: 7220 696e 6469 7669 6475 616c 2073 7475  r individual stu
+00015650: 6479 2061 7265 6173 0d0a 6465 6620 7365  dy areas..def se
+00015660: 6e74 696e 656c 3243 6c6f 7564 5363 6f72  ntinel2CloudScor
+00015670: 6528 696d 6729 3a0d 0a20 2023 436f 6d70  e(img):..  #Comp
+00015680: 7574 6520 7365 7665 7261 6c20 696e 6469  ute several indi
+00015690: 6361 746f 7273 206f 6620 636c 6f75 6479  cators of cloudy
+000156a0: 6e65 7373 2061 6e64 2074 616b 6520 7468  ness and take th
+000156b0: 6520 6d69 6e69 6d75 6d20 6f66 2074 6865  e minimum of the
+000156c0: 6d2e 0d0a 2020 7363 6f72 6520 3d20 6565  m...  score = ee
+000156d0: 2e49 6d61 6765 2831 290d 0a20 2062 6c75  .Image(1)..  blu
+000156e0: 6543 6972 7275 7353 636f 7265 203d 2065  eCirrusScore = e
+000156f0: 652e 496d 6167 6528 3029 0d0a 0d0a 2020  e.Image(0)....  
+00015700: 2343 6c6f 7564 7320 6172 6520 7265 6173  #Clouds are reas
+00015710: 6f6e 6162 6c79 2062 7269 6768 7420 696e  onably bright in
+00015720: 2074 6865 2062 6c75 6520 6f72 2063 6972   the blue or cir
+00015730: 7275 7320 6261 6e64 732e 0d0a 2020 2355  rus bands...  #U
+00015740: 7365 202e 6d61 7820 6173 2061 2070 7365  se .max as a pse
+00015750: 7564 6f20 4f52 2063 6f6e 6469 7469 6f6e  udo OR condition
+00015760: 616c 0d0a 2020 626c 7565 4369 7272 7573  al..  blueCirrus
+00015770: 5363 6f72 6520 3d20 626c 7565 4369 7272  Score = blueCirr
+00015780: 7573 5363 6f72 652e 6d61 7828 7265 7363  usScore.max(resc
+00015790: 616c 6528 696d 672e 7365 6c65 6374 285b  ale(img.select([
+000157a0: 2762 6c75 6527 5d29 2c20 5b30 2e31 2c20  'blue']), [0.1, 
+000157b0: 302e 355d 2929 0d0a 2020 626c 7565 4369  0.5]))..  blueCi
+000157c0: 7272 7573 5363 6f72 6520 3d20 626c 7565  rrusScore = blue
+000157d0: 4369 7272 7573 5363 6f72 652e 6d61 7828  CirrusScore.max(
+000157e0: 7265 7363 616c 6528 696d 672e 7365 6c65  rescale(img.sele
+000157f0: 6374 285b 2763 6227 5d29 2c20 5b30 2e31  ct(['cb']), [0.1
+00015800: 2c20 302e 355d 2929 0d0a 2020 2320 626c  , 0.5]))..  # bl
+00015810: 7565 4369 7272 7573 5363 6f72 6520 3d20  ueCirrusScore = 
+00015820: 626c 7565 4369 7272 7573 5363 6f72 652e  blueCirrusScore.
+00015830: 6d61 7828 7265 7363 616c 6528 696d 672c  max(rescale(img,
+00015840: 2027 696d 672e 6369 7272 7573 272c 205b   'img.cirrus', [
+00015850: 302e 312c 2030 2e33 5d29 290d 0a0d 0a20  0.1, 0.3])).... 
+00015860: 2023 7265 5375 6d20 3d20 7265 7363 616c   #reSum = rescal
+00015870: 6528 696d 672c 2728 696d 672e 7265 312b  e(img,'(img.re1+
+00015880: 696d 672e 7265 322b 696d 672e 7265 3329  img.re2+img.re3)
+00015890: 2f33 272c 5b30 2e35 2c20 302e 375d 290d  /3',[0.5, 0.7]).
+000158a0: 0a0d 0a20 2073 636f 7265 203d 2073 636f  ...  score = sco
+000158b0: 7265 2e6d 696e 2862 6c75 6543 6972 7275  re.min(blueCirru
+000158c0: 7353 636f 7265 290d 0a0d 0a20 2023 436c  sScore)....  #Cl
+000158d0: 6f75 6473 2061 7265 2072 6561 736f 6e61  ouds are reasona
+000158e0: 626c 7920 6272 6967 6874 2069 6e20 616c  bly bright in al
+000158f0: 6c20 7669 7369 626c 6520 6261 6e64 732e  l visible bands.
+00015900: 0d0a 2020 7363 6f72 6520 3d20 7363 6f72  ..  score = scor
+00015910: 652e 6d69 6e28 7265 7363 616c 6528 696d  e.min(rescale(im
+00015920: 672e 7365 6c65 6374 285b 2772 6564 272c  g.select(['red',
+00015930: 2767 7265 656e 272c 2762 6c75 6527 5d29  'green','blue'])
+00015940: 2e72 6564 7563 6528 6565 2e52 6564 7563  .reduce(ee.Reduc
+00015950: 6572 2e73 756d 2829 292c 205b 302e 322c  er.sum()), [0.2,
+00015960: 2030 2e38 5d29 290d 0a0d 0a20 2023 436c   0.8]))....  #Cl
+00015970: 6f75 6473 2061 7265 2072 6561 736f 6e61  ouds are reasona
+00015980: 626c 7920 6272 6967 6874 2069 6e20 616c  bly bright in al
+00015990: 6c20 696e 6672 6172 6564 2062 616e 6473  l infrared bands
+000159a0: 2e0d 0a20 2073 636f 7265 203d 2073 636f  ...  score = sco
+000159b0: 7265 2e6d 696e 2872 6573 6361 6c65 2869  re.min(rescale(i
+000159c0: 6d67 2e73 656c 6563 7428 5b27 6e69 7227  mg.select(['nir'
+000159d0: 2c27 7377 6972 3127 2c27 7377 6972 3227  ,'swir1','swir2'
+000159e0: 5d29 2e72 6564 7563 6528 6565 2e52 6564  ]).reduce(ee.Red
+000159f0: 7563 6572 2e73 756d 2829 292c 205b 302e  ucer.sum()), [0.
+00015a00: 332c 2030 2e38 5d29 290d 0a0d 0a20 2023  3, 0.8]))....  #
+00015a10: 486f 7765 7665 722c 2063 6c6f 7564 7320  However, clouds 
+00015a20: 6172 6520 6e6f 7420 736e 6f77 2e0d 0a20  are not snow... 
+00015a30: 206e 6473 6920 3d20 2069 6d67 2e6e 6f72   ndsi =  img.nor
+00015a40: 6d61 6c69 7a65 6444 6966 6665 7265 6e63  malizedDifferenc
+00015a50: 6528 5b27 6772 6565 6e27 2c20 2773 7769  e(['green', 'swi
+00015a60: 7231 275d 290d 0a20 2073 636f 7265 3d73  r1'])..  score=s
+00015a70: 636f 7265 2e6d 696e 2872 6573 6361 6c65  core.min(rescale
+00015a80: 286e 6473 692c 205b 302e 382c 2030 2e36  (ndsi, [0.8, 0.6
+00015a90: 5d29 290d 0a0d 0a20 2073 636f 7265 203d  ]))....  score =
+00015aa0: 2073 636f 7265 2e6d 756c 7469 706c 7928   score.multiply(
+00015ab0: 3130 3029 2e62 7974 6528 292e 636c 616d  100).byte().clam
+00015ac0: 7028 302c 3130 3029 2e72 656e 616d 6528  p(0,100).rename(
+00015ad0: 5b27 636c 6f75 6453 636f 7265 275d 290d  ['cloudScore']).
+00015ae0: 0a20 2072 6574 7572 6e20 7363 6f72 650d  .  return score.
+00015af0: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+00015b00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015b10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015b20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015b30: 2323 2323 2323 2323 2323 0d0a 2341 6461  ##########..#Ada
+00015b40: 7074 6564 2066 726f 6d3a 2068 7474 7073  pted from: https
+00015b50: 3a2f 2f65 6172 7468 2e65 7361 2e69 6e74  ://earth.esa.int
+00015b60: 2f64 6f63 756d 656e 7473 2f31 3031 3734  /documents/10174
+00015b70: 2f33 3136 3630 3038 2f45 5341 5f54 7261  /3166008/ESA_Tra
+00015b80: 696e 696e 675f 5669 6c6e 6975 735f 3037  ining_Vilnius_07
+00015b90: 3037 3230 3137 5f53 4152 5f4f 7074 6963  072017_SAR_Optic
+00015ba0: 616c 5f53 6e6f 775f 4963 655f 4578 6572  al_Snow_Ice_Exer
+00015bb0: 6369 7365 732e 7064 660d 0a64 6566 2073  cises.pdf..def s
+00015bc0: 656e 7469 6e65 6c32 536e 6f77 4d61 736b  entinel2SnowMask
+00015bd0: 2869 6d67 2c64 696c 6174 6550 6978 656c  (img,dilatePixel
+00015be0: 7320 3d20 332e 3529 3a0d 0a20 206e 6473  s = 3.5):..  nds
+00015bf0: 6920 3d20 2069 6d67 2e6e 6f72 6d61 6c69  i =  img.normali
+00015c00: 7a65 6444 6966 6665 7265 6e63 6528 5b27  zedDifference(['
+00015c10: 6772 6565 6e27 2c20 2773 7769 7231 275d  green', 'swir1']
+00015c20: 290d 0a0d 0a20 2023 4946 204e 4453 4920  )....  #IF NDSI 
+00015c30: 3e20 302e 3430 2041 4e44 20cf 8128 4e49  > 0.40 AND ..(NI
+00015c40: 5229 203e 2030 2e31 3120 5448 454e 2073  R) > 0.11 THEN s
+00015c50: 6e6f 7720 696e 206f 7065 6e20 6c61 6e64  now in open land
+00015c60: 0d0a 2020 2349 4620 302e 3120 3c20 4e44  ..  #IF 0.1 < ND
+00015c70: 5349 203c 2030 2e34 2054 4845 4e20 736e  SI < 0.4 THEN sn
+00015c80: 6f77 2069 6e20 666f 7265 7374 0d0a 2020  ow in forest..  
+00015c90: 736e 6f77 4f70 656e 4c61 6e64 203d 206e  snowOpenLand = n
+00015ca0: 6473 692e 6774 2830 2e34 292e 416e 6428  dsi.gt(0.4).And(
+00015cb0: 696d 672e 7365 6c65 6374 285b 276e 6972  img.select(['nir
+00015cc0: 275d 292e 6774 2830 2e31 3129 290d 0a20  ']).gt(0.11)).. 
+00015cd0: 2073 6e6f 7746 6f72 6573 7420 3d20 6e64   snowForest = nd
+00015ce0: 7369 2e67 7428 302e 3129 2e41 6e64 286e  si.gt(0.1).And(n
+00015cf0: 6473 692e 6c74 2830 2e34 2929 0d0a 0d0a  dsi.lt(0.4))....
+00015d00: 2020 2320 4d61 702e 6164 644c 6179 6572    # Map.addLayer
+00015d10: 2873 6e6f 774f 7065 6e4c 616e 642e 7365  (snowOpenLand.se
+00015d20: 6c66 4d61 736b 2829 2c7b 276d 696e 273a  lfMask(),{'min':
+00015d30: 312c 276d 6178 273a 312c 2770 616c 6574  1,'max':1,'palet
+00015d40: 7465 273a 2738 3846 277d 2c27 536e 6f77  te':'88F'},'Snow
+00015d50: 204f 7065 6e20 4c61 6e64 2729 0d0a 2020   Open Land')..  
+00015d60: 2320 4d61 702e 6164 644c 6179 6572 2873  # Map.addLayer(s
+00015d70: 6e6f 7746 6f72 6573 742e 7365 6c66 4d61  nowForest.selfMa
+00015d80: 736b 2829 2c7b 276d 696e 273a 312c 276d  sk(),{'min':1,'m
+00015d90: 6178 273a 312c 2770 616c 6574 7465 273a  ax':1,'palette':
+00015da0: 2730 3046 277d 2c27 536e 6f77 2046 6f72  '00F'},'Snow For
+00015db0: 6573 7427 290d 0a20 2023 4672 6163 7469  est')..  #Fracti
+00015dc0: 6f6e 616c 2073 6e6f 7720 636f 7665 7220  onal snow cover 
+00015dd0: 2846 5343 2c20 3020 2520 2d20 3130 3025  (FSC, 0 % - 100%
+00015de0: 2073 6e6f 7729 2063 616e 2062 6520 6465   snow) can be de
+00015df0: 7465 6374 6564 2062 7920 7468 6520 6170  tected by the ap
+00015e00: 7072 6f61 6368 206f 6620 5361 6c6f 6d6f  proach of Salomo
+00015e10: 6e73 6f6e 0d0a 2020 2361 6e64 2041 7070  nson..  #and App
+00015e20: 656c 2028 3230 3034 2c20 3230 3036 292c  el (2004, 2006),
+00015e30: 2077 6869 6368 2077 6173 206f 7269 6769   which was origi
+00015e40: 6e61 6c6c 7920 6465 7665 6c6f 7065 6420  nally developed 
+00015e50: 666f 7220 4d4f 4449 5320 6461 7461 3a0d  for MODIS data:.
+00015e60: 0a20 2023 4653 4320 3d20 e280 9330 2e30  .  #FSC = ...0.0
+00015e70: 3120 2b20 312e 3435 202a 204e 4453 490d  1 + 1.45 * NDSI.
+00015e80: 0a20 2066 7363 203d 206e 6473 692e 6d75  .  fsc = ndsi.mu
+00015e90: 6c74 6970 6c79 2831 2e34 3529 2e73 7562  ltiply(1.45).sub
+00015ea0: 7472 6163 7428 302e 3031 290d 0a20 2023  tract(0.01)..  #
+00015eb0: 204d 6170 2e61 6464 4c61 7965 7228 6673   Map.addLayer(fs
+00015ec0: 632c 7b27 6d69 6e27 3a30 2c27 6d61 7827  c,{'min':0,'max'
+00015ed0: 3a31 2c27 7061 6c65 7474 6527 3a27 3038  :1,'palette':'08
+00015ee0: 302c 3030 3827 7d2c 2746 7261 6374 696f  0,008'},'Fractio
+00015ef0: 6e61 6c20 536e 6f77 2043 6f76 6572 2729  nal Snow Cover')
+00015f00: 0d0a 2020 736e 6f77 4d61 736b 203d 2028  ..  snowMask = (
+00015f10: 2873 6e6f 774f 7065 6e4c 616e 642e 4f72  (snowOpenLand.Or
+00015f20: 2873 6e6f 7746 6f72 6573 7429 292e 4e6f  (snowForest)).No
+00015f30: 7428 2929 2e66 6f63 616c 5f6d 696e 2864  t()).focal_min(d
+00015f40: 696c 6174 6550 6978 656c 7329 0d0a 2020  ilatePixels)..  
+00015f50: 7265 7475 726e 2069 6d67 2e75 7064 6174  return img.updat
+00015f60: 654d 6173 6b28 736e 6f77 4d61 736b 290d  eMask(snowMask).
+00015f70: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+00015f80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015f90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015fa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015fb0: 2323 2323 2323 2323 2323 0d0a 2323 2323  ##########..####
+00015fc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015fd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00015fe0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00015ff0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00016000: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00016010: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
+00016000: 2323 2323 230d 0a23 4d4f 4449 5320 7072  #####..#MODIS pr
+00016010: 6f63 6573 7369 6e67 0d0a 2323 2323 2323  ocessing..######
 00016020: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00016030: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00016040: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00016050: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00016060: 2323 2323 2323 2323 0d0a 234d 4f44 4953  ########..#MODIS
-00016070: 2070 726f 6365 7373 696e 670d 0a23 2323   processing..###
+00016060: 2323 230d 0a23 2323 2323 2323 2323 2323  ###..###########
+00016070: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00016080: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00016090: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000160a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000160b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000160c0: 2323 2323 2323 0d0a 2323 2323 2323 2323  ######..########
-000160d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000160e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000160f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00016100: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00016110: 230d 0a23 536f 6d65 2067 6c6f 6261 6c73  #..#Some globals
-00016120: 2074 6f20 6465 616c 2077 6974 6820 6d75   to deal with mu
-00016130: 6c74 692d 7370 6563 7472 616c 204d 4f44  lti-spectral MOD
-00016140: 4953 0d0a 2320 7754 656d 7053 656c 6563  IS..# wTempSelec
-00016150: 744f 7264 6572 203d 205b 322c 332c 302c  tOrder = [2,3,0,
-00016160: 312c 342c 362c 355d 2342 616e 6420 6f72  1,4,6,5]#Band or
-00016170: 6465 7220 746f 2073 656c 6563 7420 746f  der to select to
-00016180: 2062 6520 4c61 6e64 7361 7420 352d 6c69   be Landsat 5-li
-00016190: 6b65 2069 6620 7468 6572 6d61 6c20 6973  ke if thermal is
-000161a0: 2069 6e63 6c75 6465 640d 0a23 2077 5465   included..# wTe
-000161b0: 6d70 5374 644e 616d 6573 203d 205b 2762  mpStdNames = ['b
-000161c0: 6c75 6527 2c20 2767 7265 656e 272c 2027  lue', 'green', '
-000161d0: 7265 6427 2c20 276e 6972 272c 2027 7377  red', 'nir', 'sw
-000161e0: 6972 3127 2c27 7465 6d70 272c 2773 7769  ir1','temp','swi
-000161f0: 7232 275d 0d0a 0d0a 2320 776f 5465 6d70  r2']....# woTemp
-00016200: 5365 6c65 6374 4f72 6465 7220 3d20 5b32  SelectOrder = [2
-00016210: 2c33 2c30 2c31 2c34 2c35 5d23 4261 6e64  ,3,0,1,4,5]#Band
-00016220: 206f 7264 6572 2074 6f20 7365 6c65 6374   order to select
-00016230: 2074 6f20 6265 204c 616e 6473 6174 2035   to be Landsat 5
-00016240: 2d6c 696b 6520 6966 2074 6865 726d 616c  -like if thermal
-00016250: 2069 7320 6578 636c 7564 6564 0d0a 2320   is excluded..# 
-00016260: 776f 5465 6d70 5374 644e 616d 6573 203d  woTempStdNames =
-00016270: 205b 2762 6c75 6527 2c20 2767 7265 656e   ['blue', 'green
-00016280: 272c 2027 7265 6427 2c20 276e 6972 272c  ', 'red', 'nir',
-00016290: 2027 7377 6972 3127 2c27 7377 6972 3227   'swir1','swir2'
-000162a0: 5d0d 0a6d 6f64 6973 3235 3053 656c 6563  ]..modis250Selec
-000162b0: 7442 616e 6473 203d 205b 2773 7572 5f72  tBands = ['sur_r
-000162c0: 6566 6c5f 6230 3127 2c27 7375 725f 7265  efl_b01','sur_re
-000162d0: 666c 5f62 3032 275d 0d0a 6d6f 6469 7332  fl_b02']..modis2
-000162e0: 3530 4261 6e64 4e61 6d65 7320 3d20 5b27  50BandNames = ['
-000162f0: 7265 6427 2c27 6e69 7227 5d0d 0a0d 0a6d  red','nir']....m
-00016300: 6f64 6973 3530 3053 656c 6563 7442 616e  odis500SelectBan
-00016310: 6473 203d 205b 2773 7572 5f72 6566 6c5f  ds = ['sur_refl_
-00016320: 6230 3327 2c27 7375 725f 7265 666c 5f62  b03','sur_refl_b
-00016330: 3034 272c 2773 7572 5f72 6566 6c5f 6230  04','sur_refl_b0
-00016340: 3627 2c27 7375 725f 7265 666c 5f62 3037  6','sur_refl_b07
-00016350: 275d 0d0a 6d6f 6469 7335 3030 4261 6e64  ']..modis500Band
-00016360: 4e61 6d65 7320 3d20 5b27 626c 7565 272c  Names = ['blue',
-00016370: 2767 7265 656e 272c 2773 7769 7231 272c  'green','swir1',
-00016380: 2773 7769 7232 275d 0d0a 0d0a 636f 6d62  'swir2']....comb
-00016390: 696e 6564 4d6f 6469 7342 616e 644e 616d  inedModisBandNam
-000163a0: 6573 203d 205b 2772 6564 272c 276e 6972  es = ['red','nir
-000163b0: 272c 2762 6c75 6527 2c27 6772 6565 6e27  ','blue','green'
-000163c0: 2c27 7377 6972 3127 2c27 7377 6972 3227  ,'swir1','swir2'
-000163d0: 5d0d 0a0d 0a64 6169 6c79 5669 6577 416e  ]....dailyViewAn
-000163e0: 676c 6542 616e 644e 616d 6573 203d 205b  gleBandNames = [
-000163f0: 2753 656e 736f 725a 656e 6974 6827 2c27  'SensorZenith','
-00016400: 5365 6e73 6f72 417a 696d 7574 6827 2c27  SensorAzimuth','
-00016410: 536f 6c61 725a 656e 6974 6827 2c27 536f  SolarZenith','So
-00016420: 6c61 7241 7a69 6d75 7468 275d 0d0a 636f  larAzimuth']..co
-00016430: 6d70 6f73 6974 6556 6965 7741 6e67 6c65  mpositeViewAngle
-00016440: 4261 6e64 4e61 6d65 7320 3d20 5b27 536f  BandNames = ['So
-00016450: 6c61 725a 656e 6974 6827 2c20 2756 6965  larZenith', 'Vie
-00016460: 775a 656e 6974 6827 2c20 2752 656c 6174  wZenith', 'Relat
-00016470: 6976 6541 7a69 6d75 7468 275d 0d0a 2344  iveAzimuth']..#D
-00016480: 6963 7469 6f6e 6172 7920 6f66 204d 4f44  ictionary of MOD
-00016490: 4953 2063 6f6c 6c65 6374 696f 6e73 0d0a  IS collections..
-000164a0: 6d6f 6469 7343 4469 6374 203d 207b 5c0d  modisCDict = {\.
-000164b0: 0a20 2027 6569 6768 7444 6179 4e44 5649  .  'eightDayNDVI
-000164c0: 4127 203a 2027 4d4f 4449 532f 3036 312f  A' : 'MODIS/061/
-000164d0: 4d59 4431 3351 3127 2c5c 0d0a 2020 2765  MYD13Q1',\..  'e
-000164e0: 6967 6874 4461 794e 4456 4954 2720 3a20  ightDayNDVIT' : 
-000164f0: 274d 4f44 4953 2f30 3631 2f4d 4f44 3133  'MODIS/061/MOD13
-00016500: 5131 272c 5c0d 0a20 2027 6569 6768 7444  Q1',\..  'eightD
-00016510: 6179 5352 3235 3041 2720 3a20 274d 4f44  aySR250A' : 'MOD
-00016520: 4953 2f30 3631 2f4d 5944 3039 5131 272c  IS/061/MYD09Q1',
-00016530: 5c0d 0a20 2027 6569 6768 7444 6179 5352  \..  'eightDaySR
-00016540: 3235 3054 2720 3a20 274d 4f44 4953 2f30  250T' : 'MODIS/0
-00016550: 3631 2f4d 4f44 3039 5131 272c 5c0d 0a20  61/MOD09Q1',\.. 
-00016560: 2027 6569 6768 7444 6179 5352 3530 3041   'eightDaySR500A
-00016570: 2720 3a20 274d 4f44 4953 2f30 3631 2f4d  ' : 'MODIS/061/M
-00016580: 5944 3039 4131 272c 5c0d 0a20 2027 6569  YD09A1',\..  'ei
-00016590: 6768 7444 6179 5352 3530 3054 2720 3a20  ghtDaySR500T' : 
-000165a0: 274d 4f44 4953 2f30 3631 2f4d 4f44 3039  'MODIS/061/MOD09
-000165b0: 4131 272c 5c0d 0a20 2027 6569 6768 7444  A1',\..  'eightD
-000165c0: 6179 4c53 5431 3030 3041 2720 3a20 274d  ayLST1000A' : 'M
-000165d0: 4f44 4953 2f30 3631 2f4d 5944 3131 4132  ODIS/061/MYD11A2
-000165e0: 272c 5c0d 0a20 2027 6569 6768 7444 6179  ',\..  'eightDay
-000165f0: 4c53 5431 3030 3054 2720 3a20 274d 4f44  LST1000T' : 'MOD
-00016600: 4953 2f30 3631 2f4d 4f44 3131 4132 272c  IS/061/MOD11A2',
-00016610: 5c0d 0a20 2027 6461 696c 7953 5232 3530  \..  'dailySR250
-00016620: 4127 203a 2027 4d4f 4449 532f 3036 312f  A' : 'MODIS/061/
-00016630: 4d59 4430 3947 5127 2c5c 0d0a 2020 2764  MYD09GQ',\..  'd
-00016640: 6169 6c79 5352 3235 3054 2720 3a20 274d  ailySR250T' : 'M
-00016650: 4f44 4953 2f30 3631 2f4d 4f44 3039 4751  ODIS/061/MOD09GQ
-00016660: 272c 5c0d 0a20 2027 6461 696c 7953 5235  ',\..  'dailySR5
-00016670: 3030 4127 203a 2027 4d4f 4449 532f 3036  00A' : 'MODIS/06
-00016680: 312f 4d59 4430 3947 4127 2c5c 0d0a 2020  1/MYD09GA',\..  
-00016690: 2764 6169 6c79 5352 3530 3054 2720 3a20  'dailySR500T' : 
-000166a0: 274d 4f44 4953 2f30 3631 2f4d 4f44 3039  'MODIS/061/MOD09
-000166b0: 4741 272c 5c0d 0a20 2027 6461 696c 794c  GA',\..  'dailyL
-000166c0: 5354 3130 3030 4127 203a 2027 4d4f 4449  ST1000A' : 'MODI
-000166d0: 532f 3036 312f 4d59 4431 3141 3127 2c5c  S/061/MYD11A1',\
-000166e0: 0d0a 2020 2764 6169 6c79 4c53 5431 3030  ..  'dailyLST100
-000166f0: 3054 2720 3a20 274d 4f44 4953 2f30 3631  0T' : 'MODIS/061
-00016700: 2f4d 4f44 3131 4131 275c 0d0a 7d0d 0a6d  /MOD11A1'\..}..m
-00016710: 756c 744d 6f64 6973 4469 6374 203d 207b  ultModisDict = {
-00016720: 5c0d 0a20 2020 2027 7465 6d70 4e6f 416e  \..    'tempNoAn
-00016730: 676c 6544 6169 6c79 273a 205b 6565 2e49  gleDaily': [ee.I
-00016740: 6d61 6765 285b 302e 3030 3031 2c30 2e30  mage([0.0001,0.0
-00016750: 3030 312c 302e 3030 3031 2c30 2e30 3030  001,0.0001,0.000
-00016760: 312c 302e 3030 3031 2c30 2e30 3030 312c  1,0.0001,0.0001,
-00016770: 302e 3032 2c31 2c31 5d29 2c5c 0d0a 2020  0.02,1,1]),\..  
-00016780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016790: 2020 2020 2020 5b27 626c 7565 272c 2767        ['blue','g
-000167a0: 7265 656e 272c 2772 6564 272c 276e 6972  reen','red','nir
-000167b0: 272c 2773 7769 7231 272c 2774 656d 7027  ','swir1','temp'
-000167c0: 2c27 7377 6972 3227 2c27 456d 6973 5f33  ,'swir2','Emis_3
-000167d0: 3127 2c27 456d 6973 5f33 3227 5d5d 2c5c  1','Emis_32']],\
-000167e0: 0d0a 2020 2020 2774 656d 704e 6f41 6e67  ..    'tempNoAng
-000167f0: 6c65 436f 6d70 6f73 6974 6527 3a20 5b65  leComposite': [e
-00016800: 652e 496d 6167 6528 5b30 2e30 3030 312c  e.Image([0.0001,
-00016810: 302e 3030 3031 2c30 2e30 3030 312c 302e  0.0001,0.0001,0.
-00016820: 3030 3031 2c30 2e30 3030 312c 302e 3030  0001,0.0001,0.00
-00016830: 3031 2c30 2e30 322c 312c 315d 292c 5c0d  01,0.02,1,1]),\.
-00016840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016850: 2020 2020 2020 2020 205b 2762 6c75 6527           ['blue'
-00016860: 2c27 6772 6565 6e27 2c27 7265 6427 2c27  ,'green','red','
-00016870: 6e69 7227 2c27 7377 6972 3127 2c27 7465  nir','swir1','te
-00016880: 6d70 272c 2773 7769 7232 272c 2745 6d69  mp','swir2','Emi
-00016890: 735f 3331 272c 2745 6d69 735f 3332 275d  s_31','Emis_32']
-000168a0: 5d2c 5c0d 0a20 2020 2027 7465 6d70 416e  ],\..    'tempAn
-000168b0: 676c 6544 6169 6c79 273a 205b 6565 2e49  gleDaily': [ee.I
-000168c0: 6d61 6765 285b 302e 3030 3031 2c30 2e30  mage([0.0001,0.0
-000168d0: 3030 312c 302e 3030 3031 2c30 2e30 3030  001,0.0001,0.000
-000168e0: 312c 302e 3030 3031 2c30 2e30 3030 312c  1,0.0001,0.0001,
-000168f0: 312c 312c 312c 312c 302e 3032 2c31 2c31  1,1,1,1,0.02,1,1
-00016900: 5d29 2c5c 0d0a 2020 2020 2020 2020 2020  ]),\..          
-00016910: 2020 2020 2020 2020 2020 2020 5b27 626c              ['bl
-00016920: 7565 272c 2767 7265 656e 272c 2772 6564  ue','green','red
-00016930: 272c 276e 6972 272c 2773 7769 7231 272c  ','nir','swir1',
-00016940: 2774 656d 7027 2c27 7377 6972 3227 2c27  'temp','swir2','
-00016950: 5365 6e73 6f72 5a65 6e69 7468 272c 2753  SensorZenith','S
-00016960: 656e 736f 7241 7a69 6d75 7468 272c 2753  ensorAzimuth','S
-00016970: 6f6c 6172 5a65 6e69 7468 272c 2753 6f6c  olarZenith','Sol
-00016980: 6172 417a 696d 7574 6827 2c27 456d 6973  arAzimuth','Emis
-00016990: 5f33 3127 2c27 456d 6973 5f33 3227 5d5d  _31','Emis_32']]
-000169a0: 2c5c 0d0a 2020 2020 2774 656d 7041 6e67  ,\..    'tempAng
-000169b0: 6c65 436f 6d70 6f73 6974 6527 3a20 5b65  leComposite': [e
-000169c0: 652e 496d 6167 6528 5b30 2e30 3030 312c  e.Image([0.0001,
-000169d0: 302e 3030 3031 2c30 2e30 3030 312c 302e  0.0001,0.0001,0.
-000169e0: 3030 3031 2c30 2e30 3030 312c 302e 3030  0001,0.0001,0.00
-000169f0: 3031 2c31 2c31 2c31 2c30 2e30 322c 312c  01,1,1,1,0.02,1,
-00016a00: 315d 292c 5c0d 0a20 2020 2020 2020 2020  1]),\..         
-00016a10: 2020 2020 2020 2020 2020 2020 205b 2762               ['b
-00016a20: 6c75 6527 2c27 6772 6565 6e27 2c27 7265  lue','green','re
-00016a30: 6427 2c27 6e69 7227 2c27 7377 6972 3127  d','nir','swir1'
-00016a40: 2c27 7465 6d70 272c 2773 7769 7232 272c  ,'temp','swir2',
-00016a50: 2753 6f6c 6172 5a65 6e69 7468 272c 2027  'SolarZenith', '
-00016a60: 5669 6577 5a65 6e69 7468 272c 2027 5265  ViewZenith', 'Re
-00016a70: 6c61 7469 7665 417a 696d 7574 6827 2c27  lativeAzimuth','
-00016a80: 456d 6973 5f33 3127 2c27 456d 6973 5f33  Emis_31','Emis_3
-00016a90: 3227 5d5d 2c5c 0d0a 2020 2020 276e 6f54  2']],\..    'noT
-00016aa0: 656d 704e 6f41 6e67 6c65 4461 696c 7927  empNoAngleDaily'
-00016ab0: 3a20 5b65 652e 496d 6167 6528 5b30 2e30  : [ee.Image([0.0
-00016ac0: 3030 312c 302e 3030 3031 2c30 2e30 3030  001,0.0001,0.000
-00016ad0: 312c 302e 3030 3031 2c30 2e30 3030 312c  1,0.0001,0.0001,
-00016ae0: 302e 3030 3031 5d29 2c5c 0d0a 2020 2020  0.0001]),\..    
-00016af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b00: 2020 5b27 626c 7565 272c 2767 7265 656e    ['blue','green
-00016b10: 272c 2772 6564 272c 276e 6972 272c 2773  ','red','nir','s
-00016b20: 7769 7231 272c 2773 7769 7232 275d 5d2c  wir1','swir2']],
-00016b30: 5c0d 0a20 2020 2027 6e6f 5465 6d70 4e6f  \..    'noTempNo
-00016b40: 416e 676c 6543 6f6d 706f 7369 7465 273a  AngleComposite':
-00016b50: 205b 6565 2e49 6d61 6765 285b 302e 3030   [ee.Image([0.00
-00016b60: 3031 2c30 2e30 3030 312c 302e 3030 3031  01,0.0001,0.0001
-00016b70: 2c30 2e30 3030 312c 302e 3030 3031 2c30  ,0.0001,0.0001,0
-00016b80: 2e30 3030 315d 292c 5c0d 0a20 2020 2020  .0001]),\..     
-00016b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ba0: 205b 2762 6c75 6527 2c27 6772 6565 6e27   ['blue','green'
-00016bb0: 2c27 7265 6427 2c27 6e69 7227 2c27 7377  ,'red','nir','sw
-00016bc0: 6972 3127 2c27 7377 6972 3227 5d5d 2c5c  ir1','swir2']],\
-00016bd0: 0d0a 2020 2020 276e 6f54 656d 7041 6e67  ..    'noTempAng
-00016be0: 6c65 4461 696c 7927 3a20 5b65 652e 496d  leDaily': [ee.Im
-00016bf0: 6167 6528 5b30 2e30 3030 312c 302e 3030  age([0.0001,0.00
-00016c00: 3031 2c30 2e30 3030 312c 302e 3030 3031  01,0.0001,0.0001
-00016c10: 2c30 2e30 3030 312c 302e 3030 3031 2c31  ,0.0001,0.0001,1
-00016c20: 2c31 2c31 2c31 5d29 2c5c 0d0a 2020 2020  ,1,1,1]),\..    
-00016c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c40: 2020 5b27 626c 7565 272c 2767 7265 656e    ['blue','green
-00016c50: 272c 2772 6564 272c 276e 6972 272c 2773  ','red','nir','s
-00016c60: 7769 7231 272c 2773 7769 7232 272c 2753  wir1','swir2','S
-00016c70: 656e 736f 725a 656e 6974 6827 2c27 5365  ensorZenith','Se
-00016c80: 6e73 6f72 417a 696d 7574 6827 2c27 536f  nsorAzimuth','So
-00016c90: 6c61 725a 656e 6974 6827 2c27 536f 6c61  larZenith','Sola
-00016ca0: 7241 7a69 6d75 7468 275d 5d2c 5c0d 0a20  rAzimuth']],\.. 
-00016cb0: 2020 2027 6e6f 5465 6d70 416e 676c 6543     'noTempAngleC
-00016cc0: 6f6d 706f 7369 7465 273a 205b 6565 2e49  omposite': [ee.I
-00016cd0: 6d61 6765 285b 302e 3030 3031 2c30 2e30  mage([0.0001,0.0
-00016ce0: 3030 312c 302e 3030 3031 2c30 2e30 3030  001,0.0001,0.000
-00016cf0: 312c 302e 3030 3031 2c30 2e30 3030 312c  1,0.0001,0.0001,
-00016d00: 312c 312c 315d 292c 5c0d 0a20 2020 2020  1,1,1]),\..     
-00016d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d20: 205b 2762 6c75 6527 2c27 6772 6565 6e27   ['blue','green'
-00016d30: 2c27 7265 6427 2c27 6e69 7227 2c27 7377  ,'red','nir','sw
-00016d40: 6972 3127 2c27 7377 6972 3227 2c27 536f  ir1','swir2','So
-00016d50: 6c61 725a 656e 6974 6827 2c20 2756 6965  larZenith', 'Vie
-00016d60: 775a 656e 6974 6827 2c20 2752 656c 6174  wZenith', 'Relat
-00016d70: 6976 6541 7a69 6d75 7468 275d 5d5c 0d0a  iveAzimuth']]\..
-00016d80: 2020 7d0d 0a0d 0a23 2323 2323 2323 2323    }....#########
+000160a0: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
+000160b0: 2353 6f6d 6520 676c 6f62 616c 7320 746f  #Some globals to
+000160c0: 2064 6561 6c20 7769 7468 206d 756c 7469   deal with multi
+000160d0: 2d73 7065 6374 7261 6c20 4d4f 4449 530d  -spectral MODIS.
+000160e0: 0a23 2077 5465 6d70 5365 6c65 6374 4f72  .# wTempSelectOr
+000160f0: 6465 7220 3d20 5b32 2c33 2c30 2c31 2c34  der = [2,3,0,1,4
+00016100: 2c36 2c35 5d23 4261 6e64 206f 7264 6572  ,6,5]#Band order
+00016110: 2074 6f20 7365 6c65 6374 2074 6f20 6265   to select to be
+00016120: 204c 616e 6473 6174 2035 2d6c 696b 6520   Landsat 5-like 
+00016130: 6966 2074 6865 726d 616c 2069 7320 696e  if thermal is in
+00016140: 636c 7564 6564 0d0a 2320 7754 656d 7053  cluded..# wTempS
+00016150: 7464 4e61 6d65 7320 3d20 5b27 626c 7565  tdNames = ['blue
+00016160: 272c 2027 6772 6565 6e27 2c20 2772 6564  ', 'green', 'red
+00016170: 272c 2027 6e69 7227 2c20 2773 7769 7231  ', 'nir', 'swir1
+00016180: 272c 2774 656d 7027 2c27 7377 6972 3227  ','temp','swir2'
+00016190: 5d0d 0a0d 0a23 2077 6f54 656d 7053 656c  ]....# woTempSel
+000161a0: 6563 744f 7264 6572 203d 205b 322c 332c  ectOrder = [2,3,
+000161b0: 302c 312c 342c 355d 2342 616e 6420 6f72  0,1,4,5]#Band or
+000161c0: 6465 7220 746f 2073 656c 6563 7420 746f  der to select to
+000161d0: 2062 6520 4c61 6e64 7361 7420 352d 6c69   be Landsat 5-li
+000161e0: 6b65 2069 6620 7468 6572 6d61 6c20 6973  ke if thermal is
+000161f0: 2065 7863 6c75 6465 640d 0a23 2077 6f54   excluded..# woT
+00016200: 656d 7053 7464 4e61 6d65 7320 3d20 5b27  empStdNames = ['
+00016210: 626c 7565 272c 2027 6772 6565 6e27 2c20  blue', 'green', 
+00016220: 2772 6564 272c 2027 6e69 7227 2c20 2773  'red', 'nir', 's
+00016230: 7769 7231 272c 2773 7769 7232 275d 0d0a  wir1','swir2']..
+00016240: 6d6f 6469 7332 3530 5365 6c65 6374 4261  modis250SelectBa
+00016250: 6e64 7320 3d20 5b27 7375 725f 7265 666c  nds = ['sur_refl
+00016260: 5f62 3031 272c 2773 7572 5f72 6566 6c5f  _b01','sur_refl_
+00016270: 6230 3227 5d0d 0a6d 6f64 6973 3235 3042  b02']..modis250B
+00016280: 616e 644e 616d 6573 203d 205b 2772 6564  andNames = ['red
+00016290: 272c 276e 6972 275d 0d0a 0d0a 6d6f 6469  ','nir']....modi
+000162a0: 7335 3030 5365 6c65 6374 4261 6e64 7320  s500SelectBands 
+000162b0: 3d20 5b27 7375 725f 7265 666c 5f62 3033  = ['sur_refl_b03
+000162c0: 272c 2773 7572 5f72 6566 6c5f 6230 3427  ','sur_refl_b04'
+000162d0: 2c27 7375 725f 7265 666c 5f62 3036 272c  ,'sur_refl_b06',
+000162e0: 2773 7572 5f72 6566 6c5f 6230 3727 5d0d  'sur_refl_b07'].
+000162f0: 0a6d 6f64 6973 3530 3042 616e 644e 616d  .modis500BandNam
+00016300: 6573 203d 205b 2762 6c75 6527 2c27 6772  es = ['blue','gr
+00016310: 6565 6e27 2c27 7377 6972 3127 2c27 7377  een','swir1','sw
+00016320: 6972 3227 5d0d 0a0d 0a63 6f6d 6269 6e65  ir2']....combine
+00016330: 644d 6f64 6973 4261 6e64 4e61 6d65 7320  dModisBandNames 
+00016340: 3d20 5b27 7265 6427 2c27 6e69 7227 2c27  = ['red','nir','
+00016350: 626c 7565 272c 2767 7265 656e 272c 2773  blue','green','s
+00016360: 7769 7231 272c 2773 7769 7232 275d 0d0a  wir1','swir2']..
+00016370: 0d0a 6461 696c 7956 6965 7741 6e67 6c65  ..dailyViewAngle
+00016380: 4261 6e64 4e61 6d65 7320 3d20 5b27 5365  BandNames = ['Se
+00016390: 6e73 6f72 5a65 6e69 7468 272c 2753 656e  nsorZenith','Sen
+000163a0: 736f 7241 7a69 6d75 7468 272c 2753 6f6c  sorAzimuth','Sol
+000163b0: 6172 5a65 6e69 7468 272c 2753 6f6c 6172  arZenith','Solar
+000163c0: 417a 696d 7574 6827 5d0d 0a63 6f6d 706f  Azimuth']..compo
+000163d0: 7369 7465 5669 6577 416e 676c 6542 616e  siteViewAngleBan
+000163e0: 644e 616d 6573 203d 205b 2753 6f6c 6172  dNames = ['Solar
+000163f0: 5a65 6e69 7468 272c 2027 5669 6577 5a65  Zenith', 'ViewZe
+00016400: 6e69 7468 272c 2027 5265 6c61 7469 7665  nith', 'Relative
+00016410: 417a 696d 7574 6827 5d0d 0a23 4469 6374  Azimuth']..#Dict
+00016420: 696f 6e61 7279 206f 6620 4d4f 4449 5320  ionary of MODIS 
+00016430: 636f 6c6c 6563 7469 6f6e 730d 0a6d 6f64  collections..mod
+00016440: 6973 4344 6963 7420 3d20 7b5c 0d0a 2020  isCDict = {\..  
+00016450: 2765 6967 6874 4461 794e 4456 4941 2720  'eightDayNDVIA' 
+00016460: 3a20 274d 4f44 4953 2f30 3631 2f4d 5944  : 'MODIS/061/MYD
+00016470: 3133 5131 272c 5c0d 0a20 2027 6569 6768  13Q1',\..  'eigh
+00016480: 7444 6179 4e44 5649 5427 203a 2027 4d4f  tDayNDVIT' : 'MO
+00016490: 4449 532f 3036 312f 4d4f 4431 3351 3127  DIS/061/MOD13Q1'
+000164a0: 2c5c 0d0a 2020 2765 6967 6874 4461 7953  ,\..  'eightDayS
+000164b0: 5232 3530 4127 203a 2027 4d4f 4449 532f  R250A' : 'MODIS/
+000164c0: 3036 312f 4d59 4430 3951 3127 2c5c 0d0a  061/MYD09Q1',\..
+000164d0: 2020 2765 6967 6874 4461 7953 5232 3530    'eightDaySR250
+000164e0: 5427 203a 2027 4d4f 4449 532f 3036 312f  T' : 'MODIS/061/
+000164f0: 4d4f 4430 3951 3127 2c5c 0d0a 2020 2765  MOD09Q1',\..  'e
+00016500: 6967 6874 4461 7953 5235 3030 4127 203a  ightDaySR500A' :
+00016510: 2027 4d4f 4449 532f 3036 312f 4d59 4430   'MODIS/061/MYD0
+00016520: 3941 3127 2c5c 0d0a 2020 2765 6967 6874  9A1',\..  'eight
+00016530: 4461 7953 5235 3030 5427 203a 2027 4d4f  DaySR500T' : 'MO
+00016540: 4449 532f 3036 312f 4d4f 4430 3941 3127  DIS/061/MOD09A1'
+00016550: 2c5c 0d0a 2020 2765 6967 6874 4461 794c  ,\..  'eightDayL
+00016560: 5354 3130 3030 4127 203a 2027 4d4f 4449  ST1000A' : 'MODI
+00016570: 532f 3036 312f 4d59 4431 3141 3227 2c5c  S/061/MYD11A2',\
+00016580: 0d0a 2020 2765 6967 6874 4461 794c 5354  ..  'eightDayLST
+00016590: 3130 3030 5427 203a 2027 4d4f 4449 532f  1000T' : 'MODIS/
+000165a0: 3036 312f 4d4f 4431 3141 3227 2c5c 0d0a  061/MOD11A2',\..
+000165b0: 2020 2764 6169 6c79 5352 3235 3041 2720    'dailySR250A' 
+000165c0: 3a20 274d 4f44 4953 2f30 3631 2f4d 5944  : 'MODIS/061/MYD
+000165d0: 3039 4751 272c 5c0d 0a20 2027 6461 696c  09GQ',\..  'dail
+000165e0: 7953 5232 3530 5427 203a 2027 4d4f 4449  ySR250T' : 'MODI
+000165f0: 532f 3036 312f 4d4f 4430 3947 5127 2c5c  S/061/MOD09GQ',\
+00016600: 0d0a 2020 2764 6169 6c79 5352 3530 3041  ..  'dailySR500A
+00016610: 2720 3a20 274d 4f44 4953 2f30 3631 2f4d  ' : 'MODIS/061/M
+00016620: 5944 3039 4741 272c 5c0d 0a20 2027 6461  YD09GA',\..  'da
+00016630: 696c 7953 5235 3030 5427 203a 2027 4d4f  ilySR500T' : 'MO
+00016640: 4449 532f 3036 312f 4d4f 4430 3947 4127  DIS/061/MOD09GA'
+00016650: 2c5c 0d0a 2020 2764 6169 6c79 4c53 5431  ,\..  'dailyLST1
+00016660: 3030 3041 2720 3a20 274d 4f44 4953 2f30  000A' : 'MODIS/0
+00016670: 3631 2f4d 5944 3131 4131 272c 5c0d 0a20  61/MYD11A1',\.. 
+00016680: 2027 6461 696c 794c 5354 3130 3030 5427   'dailyLST1000T'
+00016690: 203a 2027 4d4f 4449 532f 3036 312f 4d4f   : 'MODIS/061/MO
+000166a0: 4431 3141 3127 5c0d 0a7d 0d0a 6d75 6c74  D11A1'\..}..mult
+000166b0: 4d6f 6469 7344 6963 7420 3d20 7b5c 0d0a  ModisDict = {\..
+000166c0: 2020 2020 2774 656d 704e 6f41 6e67 6c65      'tempNoAngle
+000166d0: 4461 696c 7927 3a20 5b65 652e 496d 6167  Daily': [ee.Imag
+000166e0: 6528 5b30 2e30 3030 312c 302e 3030 3031  e([0.0001,0.0001
+000166f0: 2c30 2e30 3030 312c 302e 3030 3031 2c30  ,0.0001,0.0001,0
+00016700: 2e30 3030 312c 302e 3030 3031 2c30 2e30  .0001,0.0001,0.0
+00016710: 322c 312c 315d 292c 5c0d 0a20 2020 2020  2,1,1]),\..     
+00016720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016730: 2020 205b 2762 6c75 6527 2c27 6772 6565     ['blue','gree
+00016740: 6e27 2c27 7265 6427 2c27 6e69 7227 2c27  n','red','nir','
+00016750: 7377 6972 3127 2c27 7465 6d70 272c 2773  swir1','temp','s
+00016760: 7769 7232 272c 2745 6d69 735f 3331 272c  wir2','Emis_31',
+00016770: 2745 6d69 735f 3332 275d 5d2c 5c0d 0a20  'Emis_32']],\.. 
+00016780: 2020 2027 7465 6d70 4e6f 416e 676c 6543     'tempNoAngleC
+00016790: 6f6d 706f 7369 7465 273a 205b 6565 2e49  omposite': [ee.I
+000167a0: 6d61 6765 285b 302e 3030 3031 2c30 2e30  mage([0.0001,0.0
+000167b0: 3030 312c 302e 3030 3031 2c30 2e30 3030  001,0.0001,0.000
+000167c0: 312c 302e 3030 3031 2c30 2e30 3030 312c  1,0.0001,0.0001,
+000167d0: 302e 3032 2c31 2c31 5d29 2c5c 0d0a 2020  0.02,1,1]),\..  
+000167e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000167f0: 2020 2020 2020 5b27 626c 7565 272c 2767        ['blue','g
+00016800: 7265 656e 272c 2772 6564 272c 276e 6972  reen','red','nir
+00016810: 272c 2773 7769 7231 272c 2774 656d 7027  ','swir1','temp'
+00016820: 2c27 7377 6972 3227 2c27 456d 6973 5f33  ,'swir2','Emis_3
+00016830: 3127 2c27 456d 6973 5f33 3227 5d5d 2c5c  1','Emis_32']],\
+00016840: 0d0a 2020 2020 2774 656d 7041 6e67 6c65  ..    'tempAngle
+00016850: 4461 696c 7927 3a20 5b65 652e 496d 6167  Daily': [ee.Imag
+00016860: 6528 5b30 2e30 3030 312c 302e 3030 3031  e([0.0001,0.0001
+00016870: 2c30 2e30 3030 312c 302e 3030 3031 2c30  ,0.0001,0.0001,0
+00016880: 2e30 3030 312c 302e 3030 3031 2c31 2c31  .0001,0.0001,1,1
+00016890: 2c31 2c31 2c30 2e30 322c 312c 315d 292c  ,1,1,0.02,1,1]),
+000168a0: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
+000168b0: 2020 2020 2020 2020 205b 2762 6c75 6527           ['blue'
+000168c0: 2c27 6772 6565 6e27 2c27 7265 6427 2c27  ,'green','red','
+000168d0: 6e69 7227 2c27 7377 6972 3127 2c27 7465  nir','swir1','te
+000168e0: 6d70 272c 2773 7769 7232 272c 2753 656e  mp','swir2','Sen
+000168f0: 736f 725a 656e 6974 6827 2c27 5365 6e73  sorZenith','Sens
+00016900: 6f72 417a 696d 7574 6827 2c27 536f 6c61  orAzimuth','Sola
+00016910: 725a 656e 6974 6827 2c27 536f 6c61 7241  rZenith','SolarA
+00016920: 7a69 6d75 7468 272c 2745 6d69 735f 3331  zimuth','Emis_31
+00016930: 272c 2745 6d69 735f 3332 275d 5d2c 5c0d  ','Emis_32']],\.
+00016940: 0a20 2020 2027 7465 6d70 416e 676c 6543  .    'tempAngleC
+00016950: 6f6d 706f 7369 7465 273a 205b 6565 2e49  omposite': [ee.I
+00016960: 6d61 6765 285b 302e 3030 3031 2c30 2e30  mage([0.0001,0.0
+00016970: 3030 312c 302e 3030 3031 2c30 2e30 3030  001,0.0001,0.000
+00016980: 312c 302e 3030 3031 2c30 2e30 3030 312c  1,0.0001,0.0001,
+00016990: 312c 312c 312c 302e 3032 2c31 2c31 5d29  1,1,1,0.02,1,1])
+000169a0: 2c5c 0d0a 2020 2020 2020 2020 2020 2020  ,\..            
+000169b0: 2020 2020 2020 2020 2020 5b27 626c 7565            ['blue
+000169c0: 272c 2767 7265 656e 272c 2772 6564 272c  ','green','red',
+000169d0: 276e 6972 272c 2773 7769 7231 272c 2774  'nir','swir1','t
+000169e0: 656d 7027 2c27 7377 6972 3227 2c27 536f  emp','swir2','So
+000169f0: 6c61 725a 656e 6974 6827 2c20 2756 6965  larZenith', 'Vie
+00016a00: 775a 656e 6974 6827 2c20 2752 656c 6174  wZenith', 'Relat
+00016a10: 6976 6541 7a69 6d75 7468 272c 2745 6d69  iveAzimuth','Emi
+00016a20: 735f 3331 272c 2745 6d69 735f 3332 275d  s_31','Emis_32']
+00016a30: 5d2c 5c0d 0a20 2020 2027 6e6f 5465 6d70  ],\..    'noTemp
+00016a40: 4e6f 416e 676c 6544 6169 6c79 273a 205b  NoAngleDaily': [
+00016a50: 6565 2e49 6d61 6765 285b 302e 3030 3031  ee.Image([0.0001
+00016a60: 2c30 2e30 3030 312c 302e 3030 3031 2c30  ,0.0001,0.0001,0
+00016a70: 2e30 3030 312c 302e 3030 3031 2c30 2e30  .0001,0.0001,0.0
+00016a80: 3030 315d 292c 5c0d 0a20 2020 2020 2020  001]),\..       
+00016a90: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00016aa0: 2762 6c75 6527 2c27 6772 6565 6e27 2c27  'blue','green','
+00016ab0: 7265 6427 2c27 6e69 7227 2c27 7377 6972  red','nir','swir
+00016ac0: 3127 2c27 7377 6972 3227 5d5d 2c5c 0d0a  1','swir2']],\..
+00016ad0: 2020 2020 276e 6f54 656d 704e 6f41 6e67      'noTempNoAng
+00016ae0: 6c65 436f 6d70 6f73 6974 6527 3a20 5b65  leComposite': [e
+00016af0: 652e 496d 6167 6528 5b30 2e30 3030 312c  e.Image([0.0001,
+00016b00: 302e 3030 3031 2c30 2e30 3030 312c 302e  0.0001,0.0001,0.
+00016b10: 3030 3031 2c30 2e30 3030 312c 302e 3030  0001,0.0001,0.00
+00016b20: 3031 5d29 2c5c 0d0a 2020 2020 2020 2020  01]),\..        
+00016b30: 2020 2020 2020 2020 2020 2020 2020 5b27                ['
+00016b40: 626c 7565 272c 2767 7265 656e 272c 2772  blue','green','r
+00016b50: 6564 272c 276e 6972 272c 2773 7769 7231  ed','nir','swir1
+00016b60: 272c 2773 7769 7232 275d 5d2c 5c0d 0a20  ','swir2']],\.. 
+00016b70: 2020 2027 6e6f 5465 6d70 416e 676c 6544     'noTempAngleD
+00016b80: 6169 6c79 273a 205b 6565 2e49 6d61 6765  aily': [ee.Image
+00016b90: 285b 302e 3030 3031 2c30 2e30 3030 312c  ([0.0001,0.0001,
+00016ba0: 302e 3030 3031 2c30 2e30 3030 312c 302e  0.0001,0.0001,0.
+00016bb0: 3030 3031 2c30 2e30 3030 312c 312c 312c  0001,0.0001,1,1,
+00016bc0: 312c 315d 292c 5c0d 0a20 2020 2020 2020  1,1]),\..       
+00016bd0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00016be0: 2762 6c75 6527 2c27 6772 6565 6e27 2c27  'blue','green','
+00016bf0: 7265 6427 2c27 6e69 7227 2c27 7377 6972  red','nir','swir
+00016c00: 3127 2c27 7377 6972 3227 2c27 5365 6e73  1','swir2','Sens
+00016c10: 6f72 5a65 6e69 7468 272c 2753 656e 736f  orZenith','Senso
+00016c20: 7241 7a69 6d75 7468 272c 2753 6f6c 6172  rAzimuth','Solar
+00016c30: 5a65 6e69 7468 272c 2753 6f6c 6172 417a  Zenith','SolarAz
+00016c40: 696d 7574 6827 5d5d 2c5c 0d0a 2020 2020  imuth']],\..    
+00016c50: 276e 6f54 656d 7041 6e67 6c65 436f 6d70  'noTempAngleComp
+00016c60: 6f73 6974 6527 3a20 5b65 652e 496d 6167  osite': [ee.Imag
+00016c70: 6528 5b30 2e30 3030 312c 302e 3030 3031  e([0.0001,0.0001
+00016c80: 2c30 2e30 3030 312c 302e 3030 3031 2c30  ,0.0001,0.0001,0
+00016c90: 2e30 3030 312c 302e 3030 3031 2c31 2c31  .0001,0.0001,1,1
+00016ca0: 2c31 5d29 2c5c 0d0a 2020 2020 2020 2020  ,1]),\..        
+00016cb0: 2020 2020 2020 2020 2020 2020 2020 5b27                ['
+00016cc0: 626c 7565 272c 2767 7265 656e 272c 2772  blue','green','r
+00016cd0: 6564 272c 276e 6972 272c 2773 7769 7231  ed','nir','swir1
+00016ce0: 272c 2773 7769 7232 272c 2753 6f6c 6172  ','swir2','Solar
+00016cf0: 5a65 6e69 7468 272c 2027 5669 6577 5a65  Zenith', 'ViewZe
+00016d00: 6e69 7468 272c 2027 5265 6c61 7469 7665  nith', 'Relative
+00016d10: 417a 696d 7574 6827 5d5d 5c0d 0a20 207d  Azimuth']]\..  }
+00016d20: 0d0a 0d0a 2323 2323 2323 2323 2323 2323  ....############
+00016d30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00016d40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00016d50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00016d60: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
+00016d70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00016d80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00016d90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00016da0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00016db0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00016dc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00016dd0: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
-00016de0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00016df0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00016e00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00016e10: 2323 2323 2323 2323 2323 230d 0a23 4865  ###########..#He
-00016e20: 6c70 6572 2066 756e 6374 696f 6e20 746f  lper function to
-00016e30: 206a 6f69 6e20 7477 6f20 636f 6c6c 6563   join two collec
-00016e40: 7469 6f6e 732d 2053 6f75 7263 653a 2063  tions- Source: c
-00016e50: 6f64 652e 6561 7274 6865 6e67 696e 652e  ode.earthengine.
-00016e60: 676f 6f67 6c65 2e63 6f6d 0d0a 6465 6620  google.com..def 
-00016e70: 6a6f 696e 436f 6c6c 6563 7469 6f6e 7328  joinCollections(
-00016e80: 6331 2c20 6332 2c20 6d61 736b 416e 794e  c1, c2, maskAnyN
-00016e90: 756c 6c56 616c 7565 7320 3d20 5472 7565  ullValues = True
-00016ea0: 2c20 6a6f 696e 5072 6f70 6572 7479 203d  , joinProperty =
-00016eb0: 2027 7379 7374 656d 3a74 696d 655f 7374   'system:time_st
-00016ec0: 6172 7427 2c6a 6f69 6e50 726f 7065 7274  art',joinPropert
-00016ed0: 7953 6563 6f6e 6461 7279 3d4e 6f6e 6529  ySecondary=None)
-00016ee0: 3a0d 0a20 200d 0a20 2069 6620 6a6f 696e  :..  ..  if join
-00016ef0: 5072 6f70 6572 7479 5365 636f 6e64 6172  PropertySecondar
-00016f00: 793d 3d4e 6f6e 653a 6a6f 696e 5072 6f70  y==None:joinProp
-00016f10: 6572 7479 5365 636f 6e64 6172 793d 6a6f  ertySecondary=jo
-00016f20: 696e 5072 6f70 6572 7479 0d0a 2020 0d0a  inProperty..  ..
-00016f30: 2020 6465 6620 4d65 7267 6542 616e 6473    def MergeBands
-00016f40: 2865 6c65 6d65 6e74 293a 0d0a 2020 2020  (element):..    
-00016f50: 2341 2066 756e 6374 696f 6e20 746f 206d  #A function to m
-00016f60: 6572 6765 2074 6865 2062 616e 6473 2074  erge the bands t
-00016f70: 6f67 6574 6865 722e 0d0a 2020 2020 2341  ogether...    #A
-00016f80: 6674 6572 2061 206a 6f69 6e2c 2072 6573  fter a join, res
-00016f90: 756c 7473 2061 7265 2069 6e20 2770 7269  ults are in 'pri
-00016fa0: 6d61 7279 2720 616e 6420 2773 6563 6f6e  mary' and 'secon
-00016fb0: 6461 7279 2720 7072 6f70 6572 7469 6573  dary' properties
-00016fc0: 2e0d 0a20 2020 2072 6574 7572 6e20 6565  ...    return ee
-00016fd0: 2e49 6d61 6765 2e63 6174 2865 6c65 6d65  .Image.cat(eleme
-00016fe0: 6e74 2e67 6574 2827 7072 696d 6172 7927  nt.get('primary'
-00016ff0: 292c 2065 6c65 6d65 6e74 2e67 6574 2827  ), element.get('
-00017000: 7365 636f 6e64 6172 7927 2929 0d0a 0d0a  secondary'))....
-00017010: 0d0a 2020 6a6f 696e 203d 2065 652e 4a6f  ..  join = ee.Jo
-00017020: 696e 2e69 6e6e 6572 2829 0d0a 2020 6a6f  in.inner()..  jo
-00017030: 696e 4669 6c74 6572 203d 2065 652e 4669  inFilter = ee.Fi
-00017040: 6c74 6572 2e65 7175 616c 7328 6a6f 696e  lter.equals(join
-00017050: 5072 6f70 6572 7479 2c20 4e6f 6e65 2c20  Property, None, 
-00017060: 6a6f 696e 5072 6f70 6572 7479 5365 636f  joinPropertySeco
-00017070: 6e64 6172 7929 0d0a 2020 6a6f 696e 6564  ndary)..  joined
-00017080: 203d 2065 652e 496d 6167 6543 6f6c 6c65   = ee.ImageColle
-00017090: 6374 696f 6e28 6a6f 696e 2e61 7070 6c79  ction(join.apply
-000170a0: 2863 312c 2063 322c 206a 6f69 6e46 696c  (c1, c2, joinFil
-000170b0: 7465 7229 290d 0a0d 0a20 206a 6f69 6e65  ter))....  joine
-000170c0: 6420 3d20 6565 2e49 6d61 6765 436f 6c6c  d = ee.ImageColl
-000170d0: 6563 7469 6f6e 286a 6f69 6e65 642e 6d61  ection(joined.ma
-000170e0: 7028 4d65 7267 6542 616e 6473 2929 0d0a  p(MergeBands))..
-000170f0: 2020 6966 206d 6173 6b41 6e79 4e75 6c6c    if maskAnyNull
-00017100: 5661 6c75 6573 3a0d 0a20 2020 2064 6566  Values:..    def
-00017110: 206e 756c 6c65 7228 696d 6729 3a0d 0a20   nuller(img):.. 
-00017120: 2020 2020 2072 6574 7572 6e20 696d 672e       return img.
-00017130: 6d61 736b 2869 6d67 2e6d 6173 6b28 292e  mask(img.mask().
-00017140: 416e 6428 696d 672e 7265 6475 6365 2865  And(img.reduce(e
-00017150: 652e 5265 6475 6365 722e 6d69 6e28 2929  e.Reducer.min())
-00017160: 2e6e 6571 2830 2929 290d 0a20 2020 206a  .neq(0)))..    j
-00017170: 6f69 6e65 6420 3d20 6a6f 696e 6564 2e6d  oined = joined.m
-00017180: 6170 286e 756c 6c65 7229 3b0d 0a0d 0a20  ap(nuller);.... 
-00017190: 2072 6574 7572 6e20 6a6f 696e 6564 3b0d   return joined;.
-000171a0: 0a0d 0a64 6566 2073 6d61 7274 4a6f 696e  ...def smartJoin
-000171b0: 2870 7269 6d61 7279 2c73 6563 6f6e 6461  (primary,seconda
-000171c0: 7279 2c68 6f75 7244 6966 6629 3a0d 0a20  ry,hourDiff):.. 
-000171d0: 206d 696c 6c69 7320 3d20 686f 7572 4469   millis = hourDi
-000171e0: 6666 202a 2036 3020 2a20 3630 202a 2031  ff * 60 * 60 * 1
-000171f0: 3030 300d 0a0d 0a20 2023 4372 6561 7465  000....  #Create
-00017200: 2061 2074 696d 6520 6669 6c74 6572 2074   a time filter t
-00017210: 6f20 6465 6669 6e65 2061 206d 6174 6368  o define a match
-00017220: 2061 7320 6f76 6572 6c61 7070 696e 6720   as overlapping 
-00017230: 7469 6d65 7374 616d 7073 2e0d 0a20 206d  timestamps...  m
-00017240: 6178 4469 6666 4669 6c74 6572 203d 2065  axDiffFilter = e
-00017250: 652e 4669 6c74 6572 2e6d 6178 4469 6666  e.Filter.maxDiff
-00017260: 6572 656e 6365 287b 5c0d 0a20 2020 2027  erence({\..    '
-00017270: 6469 6666 6572 656e 6365 273a 206d 696c  difference': mil
-00017280: 6c69 732c 5c0d 0a20 2020 2027 6c65 6674  lis,\..    'left
-00017290: 4669 656c 6427 3a20 2773 7973 7465 6d3a  Field': 'system:
-000172a0: 7469 6d65 5f73 7461 7274 272c 5c0d 0a20  time_start',\.. 
-000172b0: 2020 2027 7269 6768 7446 6965 6c64 273a     'rightField':
-000172c0: 2027 7379 7374 656d 3a74 696d 655f 7374   'system:time_st
-000172d0: 6172 7427 5c0d 0a20 207d 290d 0a20 2023  art'\..  })..  #
-000172e0: 4465 6669 6e65 2074 6865 206a 6f69 6e2e  Define the join.
-000172f0: 0d0a 2020 7361 7665 4265 7374 4a6f 696e  ..  saveBestJoin
-00017300: 203d 2065 652e 4a6f 696e 2e73 6176 6542   = ee.Join.saveB
-00017310: 6573 7428 7b5c 0d0a 2020 2020 276d 6174  est({\..    'mat
-00017320: 6368 4b65 7927 3a20 2762 6573 7449 6d61  chKey': 'bestIma
-00017330: 6765 272c 5c0d 0a20 2020 2027 6d65 6173  ge',\..    'meas
-00017340: 7572 654b 6579 273a 2027 7469 6d65 4469  ureKey': 'timeDi
-00017350: 6666 275c 0d0a 2020 7d29 0d0a 2020 6465  ff'\..  })..  de
-00017360: 6620 4d65 7267 6542 616e 6473 2865 6c65  f MergeBands(ele
-00017370: 6d65 6e74 293a 0d0a 2020 2020 2341 2066  ment):..    #A f
-00017380: 756e 6374 696f 6e20 746f 206d 6572 6765  unction to merge
-00017390: 2074 6865 2062 616e 6473 2074 6f67 6574   the bands toget
-000173a0: 6865 722e 0d0a 2020 2020 2341 6674 6572  her...    #After
-000173b0: 2061 206a 6f69 6e2c 2072 6573 756c 7473   a join, results
-000173c0: 2061 7265 2069 6e20 2770 7269 6d61 7279   are in 'primary
-000173d0: 2720 616e 6420 2773 6563 6f6e 6461 7279  ' and 'secondary
-000173e0: 2720 7072 6f70 6572 7469 6573 2e0d 0a20  ' properties... 
-000173f0: 2020 2072 6574 7572 6e20 6565 2e49 6d61     return ee.Ima
-00017400: 6765 2e63 6174 2865 6c65 6d65 6e74 2c20  ge.cat(element, 
-00017410: 656c 656d 656e 742e 6765 7428 2762 6573  element.get('bes
-00017420: 7449 6d61 6765 2729 290d 0a0d 0a20 2023  tImage'))....  #
-00017430: 4170 706c 7920 7468 6520 6a6f 696e 2e0d  Apply the join..
-00017440: 0a20 206a 6f69 6e65 6420 3d20 7361 7665  .  joined = save
-00017450: 4265 7374 4a6f 696e 2e61 7070 6c79 2870  BestJoin.apply(p
-00017460: 7269 6d61 7279 2c20 7365 636f 6e64 6172  rimary, secondar
-00017470: 792c 206d 6178 4469 6666 4669 6c74 6572  y, maxDiffFilter
-00017480: 290d 0a20 206a 6f69 6e65 6420 3d20 6a6f  )..  joined = jo
-00017490: 696e 6564 2e6d 6170 284d 6572 6765 4261  ined.map(MergeBa
-000174a0: 6e64 7329 0d0a 2020 7265 7475 726e 206a  nds)..  return j
-000174b0: 6f69 6e65 640d 0a23 2323 2323 2323 2323  oined..#########
-000174c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000174d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000174e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000174f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00017500: 0d0a 234a 6f69 6e20 636f 6c6c 6563 7469  ..#Join collecti
-00017510: 6f6e 7320 6279 2073 7061 6365 2028 696e  ons by space (in
-00017520: 7465 7273 6563 7469 6f6e 2920 616e 6420  tersection) and 
-00017530: 7469 6d65 2028 7370 6563 6966 6965 6420  time (specified 
-00017540: 6279 2075 7365 7229 0d0a 6465 6620 7370  by user)..def sp
-00017550: 6174 696f 5465 6d70 6f72 616c 4a6f 696e  atioTemporalJoin
-00017560: 2870 7269 6d61 7279 2c20 7365 636f 6e64  (primary, second
-00017570: 6172 792c 2068 6f75 7244 6966 6620 3d20  ary, hourDiff = 
-00017580: 3234 2c20 6f75 744b 6579 203d 2027 7365  24, outKey = 'se
-00017590: 636f 6e64 6172 7927 293a 0d0a 2020 7469  condary'):..  ti
-000175a0: 6d65 203d 2068 6f75 7244 6966 662a 2036  me = hourDiff* 6
-000175b0: 3020 2a20 3630 202a 2031 3030 300d 0a0d  0 * 60 * 1000...
-000175c0: 0a20 206f 7574 426e 7320 3d20 6565 2e49  .  outBns = ee.I
-000175d0: 6d61 6765 2873 6563 6f6e 6461 7279 2e66  mage(secondary.f
-000175e0: 6972 7374 2829 292e 6261 6e64 4e61 6d65  irst()).bandName
-000175f0: 7328 292e 6d61 7028 6c61 6d62 6461 2062  s().map(lambda b
-00017600: 6e3a 2065 652e 5374 7269 6e67 2862 6e29  n: ee.String(bn)
-00017610: 2e63 6174 2827 5f27 292e 6361 7428 6f75  .cat('_').cat(ou
-00017620: 744b 6579 2929 0d0a 2020 2344 6566 696e  tKey))..  #Defin
-00017630: 6520 6120 7370 6174 6961 6c20 6669 6c74  e a spatial filt
-00017640: 6572 2061 7320 6765 6f6d 6574 7269 6573  er as geometries
-00017650: 2074 6861 7420 696e 7465 7273 6563 742e   that intersect.
-00017660: 0d0a 2020 7370 6174 696f 5465 6d70 6f72  ..  spatioTempor
-00017670: 616c 4669 6c74 6572 203d 2065 652e 4669  alFilter = ee.Fi
-00017680: 6c74 6572 2e41 6e64 285c 0d0a 2020 2020  lter.And(\..    
-00017690: 6565 2e46 696c 7465 722e 6d61 7844 6966  ee.Filter.maxDif
-000176a0: 6665 7265 6e63 6528 7b5c 0d0a 2020 2020  ference({\..    
-000176b0: 2020 2764 6966 6665 7265 6e63 6527 3a20    'difference': 
-000176c0: 7469 6d65 2c5c 0d0a 2020 2020 2020 276c  time,\..      'l
-000176d0: 6566 7446 6965 6c64 273a 2027 7379 7374  eftField': 'syst
-000176e0: 656d 3a74 696d 655f 7374 6172 7427 2c5c  em:time_start',\
-000176f0: 0d0a 2020 2020 2020 2772 6967 6874 4669  ..      'rightFi
-00017700: 656c 6427 3a20 2773 7973 7465 6d3a 7469  eld': 'system:ti
-00017710: 6d65 5f73 7461 7274 275c 0d0a 2020 2020  me_start'\..    
-00017720: 7d29 2c5c 0d0a 2020 2020 6565 2e46 696c  }),\..    ee.Fil
-00017730: 7465 722e 696e 7465 7273 6563 7473 287b  ter.intersects({
-00017740: 5c0d 0a20 2020 2027 6c65 6674 4669 656c  \..    'leftFiel
-00017750: 6427 3a20 272e 6765 6f27 2c5c 0d0a 2020  d': '.geo',\..  
-00017760: 2020 2772 6967 6874 4669 656c 6427 3a20    'rightField': 
-00017770: 272e 6765 6f27 2c5c 0d0a 2020 2020 276d  '.geo',\..    'm
-00017780: 6178 4572 726f 7227 3a20 3130 5c0d 0a20  axError': 10\.. 
-00017790: 207d 295c 0d0a 2020 290d 0a20 2023 4465   })\..  )..  #De
-000177a0: 6669 6e65 2061 2073 6176 6520 616c 6c20  fine a save all 
-000177b0: 6a6f 696e 2e0d 0a20 2073 6176 6542 6573  join...  saveBes
-000177c0: 744a 6f69 6e20 3d20 6565 2e4a 6f69 6e2e  tJoin = ee.Join.
-000177d0: 7361 7665 4265 7374 287b 5c0d 0a20 2020  saveBest({\..   
-000177e0: 2027 6d61 7463 684b 6579 273a 206f 7574   'matchKey': out
-000177f0: 4b65 792c 5c0d 0a20 2020 2027 6d65 6173  Key,\..    'meas
-00017800: 7572 654b 6579 273a 2027 7469 6d65 4469  ureKey': 'timeDi
-00017810: 6666 275c 0d0a 2020 7d29 0d0a 0d0a 2020  ff'\..  })....  
-00017820: 2341 7070 6c79 2074 6865 206a 6f69 6e2e  #Apply the join.
-00017830: 0d0a 2020 6a6f 696e 6564 203d 2073 6176  ..  joined = sav
-00017840: 6542 6573 744a 6f69 6e2e 6170 706c 7928  eBestJoin.apply(
-00017850: 7072 696d 6172 792c 2073 6563 6f6e 6461  primary, seconda
-00017860: 7279 2c20 7370 6174 696f 5465 6d70 6f72  ry, spatioTempor
-00017870: 616c 4669 6c74 6572 290d 0a20 2064 6566  alFilter)..  def
-00017880: 204d 6572 6765 4261 6e64 7328 656c 656d   MergeBands(elem
-00017890: 656e 7429 3a0d 0a20 2020 2023 4120 6675  ent):..    #A fu
-000178a0: 6e63 7469 6f6e 2074 6f20 6d65 7267 6520  nction to merge 
-000178b0: 7468 6520 6261 6e64 7320 746f 6765 7468  the bands togeth
-000178c0: 6572 2e0d 0a20 2020 2023 4166 7465 7220  er...    #After 
-000178d0: 6120 6a6f 696e 2c20 7265 7375 6c74 7320  a join, results 
-000178e0: 6172 6520 696e 2027 7072 696d 6172 7927  are in 'primary'
-000178f0: 2061 6e64 2027 7365 636f 6e64 6172 7927   and 'secondary'
-00017900: 2070 726f 7065 7274 6965 732e 0d0a 2020   properties...  
-00017910: 2020 7265 7475 726e 2065 652e 496d 6167    return ee.Imag
-00017920: 652e 6361 7428 656c 656d 656e 742c 2065  e.cat(element, e
-00017930: 652e 496d 6167 6528 656c 656d 656e 742e  e.Image(element.
-00017940: 6765 7428 6f75 744b 6579 2929 2e72 656e  get(outKey)).ren
-00017950: 616d 6528 6f75 7442 6e73 2929 0d0a 0d0a  ame(outBns))....
-00017960: 2020 6a6f 696e 6564 203d 206a 6f69 6e65    joined = joine
-00017970: 642e 6d61 7028 4d65 7267 6542 616e 6473  d.map(MergeBands
-00017980: 290d 0a20 2072 6574 7572 6e20 6a6f 696e  )..  return join
-00017990: 6564 0d0a 0d0a 2320 5369 6d70 6c65 2069  ed....# Simple i
-000179a0: 6e6e 6572 206a 6f69 6e20 6675 6e63 7469  nner join functi
-000179b0: 6f6e 2066 6f72 2066 6561 7475 7265 436f  on for featureCo
-000179c0: 6c6c 6563 7469 6f6e 730d 0a23 204d 6174  llections..# Mat
-000179d0: 6368 6573 2066 6561 7475 7265 7320 6261  ches features ba
-000179e0: 7365 6420 6f6e 2061 6e20 6578 6163 7420  sed on an exact 
-000179f0: 6d61 7463 6820 6f66 2074 6865 2066 6965  match of the fie
-00017a00: 6c64 4e61 6d65 2070 6172 616d 6574 6572  ldName parameter
-00017a10: 0d0a 2320 416e 206f 7074 696f 6e61 6c20  ..# An optional 
-00017a20: 6469 6666 6572 656e 7420 6669 656c 6420  different field 
-00017a30: 6e61 6d65 2063 616e 2062 6520 7072 6f76  name can be prov
-00017a40: 6964 6564 2066 6f72 2074 6865 2073 6563  ided for the sec
-00017a50: 6f6e 6420 6665 6174 7572 6543 6f6c 6c65  ond featureColle
-00017a60: 6374 696f 6e0d 0a23 2052 6574 6169 6e73  ction..# Retains
-00017a70: 2074 6865 2067 656f 6d65 7472 7920 6f66   the geometry of
-00017a80: 2074 6865 2070 7269 6d61 7279 2c20 6275   the primary, bu
-00017a90: 7420 636f 7069 6573 2074 6865 2070 726f  t copies the pro
-00017aa0: 7065 7274 6965 7320 6f66 2074 6865 2073  perties of the s
-00017ab0: 6563 6f6e 6461 7279 2063 6f6c 6c65 6374  econdary collect
-00017ac0: 696f 6e0d 0a64 6566 206a 6f69 6e46 6561  ion..def joinFea
-00017ad0: 7475 7265 436f 6c6c 6563 7469 6f6e 7328  tureCollections(
-00017ae0: 7072 696d 6172 792c 7365 636f 6e64 6172  primary,secondar
-00017af0: 792c 6669 656c 644e 616d 652c 6669 656c  y,fieldName,fiel
-00017b00: 644e 616d 6553 6563 6f6e 6461 7279 3d4e  dNameSecondary=N
-00017b10: 6f6e 6529 3a0d 0a20 2069 6620 6669 656c  one):..  if fiel
-00017b20: 644e 616d 6553 6563 6f6e 6461 7279 3d3d  dNameSecondary==
-00017b30: 4e6f 6e65 3a66 6965 6c64 4e61 6d65 5365  None:fieldNameSe
-00017b40: 636f 6e64 6172 793d 6669 656c 644e 616d  condary=fieldNam
-00017b50: 650d 0a20 2023 2055 7365 2061 6e20 6571  e..  # Use an eq
-00017b60: 7561 6c73 2066 696c 7465 7220 746f 2073  uals filter to s
-00017b70: 7065 6369 6679 2068 6f77 2074 6865 2063  pecify how the c
-00017b80: 6f6c 6c65 6374 696f 6e73 206d 6174 6368  ollections match
-00017b90: 2e0d 0a20 2066 203d 2065 652e 4669 6c74  ...  f = ee.Filt
-00017ba0: 6572 2e65 7175 616c 7328 6669 656c 644e  er.equals(fieldN
-00017bb0: 616d 652c 4e6f 6e65 2c66 6965 6c64 4e61  ame,None,fieldNa
-00017bc0: 6d65 5365 636f 6e64 6172 7929 0d0a 0d0a  meSecondary)....
-00017bd0: 0d0a 2020 2320 4465 6669 6e65 2074 6865  ..  # Define the
-00017be0: 206a 6f69 6e2e 0d0a 2020 696e 6e65 724a   join...  innerJ
-00017bf0: 6f69 6e20 3d20 6565 2e4a 6f69 6e2e 696e  oin = ee.Join.in
-00017c00: 6e65 7228 2770 7269 6d61 7279 272c 2027  ner('primary', '
-00017c10: 7365 636f 6e64 6172 7927 290d 0a0d 0a20  secondary').... 
-00017c20: 2023 2041 7070 6c79 2074 6865 206a 6f69   # Apply the joi
-00017c30: 6e2e 0d0a 2020 6a6f 696e 6564 203d 2069  n...  joined = i
-00017c40: 6e6e 6572 4a6f 696e 2e61 7070 6c79 2870  nnerJoin.apply(p
-00017c50: 7269 6d61 7279 2c20 7365 636f 6e64 6172  rimary, secondar
-00017c60: 792c 2066 290d 0a20 206a 6f69 6e65 6420  y, f)..  joined 
-00017c70: 3d20 6a6f 696e 6564 2e6d 6170 286c 616d  = joined.map(lam
-00017c80: 6264 6120 663a 2065 652e 4665 6174 7572  bda f: ee.Featur
-00017c90: 6528 662e 6765 7428 2770 7269 6d61 7279  e(f.get('primary
-00017ca0: 2729 292e 636f 7079 5072 6f70 6572 7469  ')).copyProperti
-00017cb0: 6573 2865 652e 4665 6174 7572 6528 662e  es(ee.Feature(f.
-00017cc0: 6765 7428 2773 6563 6f6e 6461 7279 2729  get('secondary')
-00017cd0: 2929 290d 0a0d 0a20 2072 6574 7572 6e20  )))....  return 
-00017ce0: 6a6f 696e 6564 0d0a 2323 2323 2323 2323  joined..########
+00016db0: 2323 2323 2323 2323 0d0a 2348 656c 7065  ########..#Helpe
+00016dc0: 7220 6675 6e63 7469 6f6e 2074 6f20 6a6f  r function to jo
+00016dd0: 696e 2074 776f 2063 6f6c 6c65 6374 696f  in two collectio
+00016de0: 6e73 2d20 536f 7572 6365 3a20 636f 6465  ns- Source: code
+00016df0: 2e65 6172 7468 656e 6769 6e65 2e67 6f6f  .earthengine.goo
+00016e00: 676c 652e 636f 6d0d 0a64 6566 206a 6f69  gle.com..def joi
+00016e10: 6e43 6f6c 6c65 6374 696f 6e73 2863 312c  nCollections(c1,
+00016e20: 2063 322c 206d 6173 6b41 6e79 4e75 6c6c   c2, maskAnyNull
+00016e30: 5661 6c75 6573 203d 2054 7275 652c 206a  Values = True, j
+00016e40: 6f69 6e50 726f 7065 7274 7920 3d20 2773  oinProperty = 's
+00016e50: 7973 7465 6d3a 7469 6d65 5f73 7461 7274  ystem:time_start
+00016e60: 272c 6a6f 696e 5072 6f70 6572 7479 5365  ',joinPropertySe
+00016e70: 636f 6e64 6172 793d 4e6f 6e65 293a 0d0a  condary=None):..
+00016e80: 2020 0d0a 2020 6966 206a 6f69 6e50 726f    ..  if joinPro
+00016e90: 7065 7274 7953 6563 6f6e 6461 7279 3d3d  pertySecondary==
+00016ea0: 4e6f 6e65 3a6a 6f69 6e50 726f 7065 7274  None:joinPropert
+00016eb0: 7953 6563 6f6e 6461 7279 3d6a 6f69 6e50  ySecondary=joinP
+00016ec0: 726f 7065 7274 790d 0a20 200d 0a20 2064  roperty..  ..  d
+00016ed0: 6566 204d 6572 6765 4261 6e64 7328 656c  ef MergeBands(el
+00016ee0: 656d 656e 7429 3a0d 0a20 2020 2023 4120  ement):..    #A 
+00016ef0: 6675 6e63 7469 6f6e 2074 6f20 6d65 7267  function to merg
+00016f00: 6520 7468 6520 6261 6e64 7320 746f 6765  e the bands toge
+00016f10: 7468 6572 2e0d 0a20 2020 2023 4166 7465  ther...    #Afte
+00016f20: 7220 6120 6a6f 696e 2c20 7265 7375 6c74  r a join, result
+00016f30: 7320 6172 6520 696e 2027 7072 696d 6172  s are in 'primar
+00016f40: 7927 2061 6e64 2027 7365 636f 6e64 6172  y' and 'secondar
+00016f50: 7927 2070 726f 7065 7274 6965 732e 0d0a  y' properties...
+00016f60: 2020 2020 7265 7475 726e 2065 652e 496d      return ee.Im
+00016f70: 6167 652e 6361 7428 656c 656d 656e 742e  age.cat(element.
+00016f80: 6765 7428 2770 7269 6d61 7279 2729 2c20  get('primary'), 
+00016f90: 656c 656d 656e 742e 6765 7428 2773 6563  element.get('sec
+00016fa0: 6f6e 6461 7279 2729 290d 0a0d 0a0d 0a20  ondary'))...... 
+00016fb0: 206a 6f69 6e20 3d20 6565 2e4a 6f69 6e2e   join = ee.Join.
+00016fc0: 696e 6e65 7228 290d 0a20 206a 6f69 6e46  inner()..  joinF
+00016fd0: 696c 7465 7220 3d20 6565 2e46 696c 7465  ilter = ee.Filte
+00016fe0: 722e 6571 7561 6c73 286a 6f69 6e50 726f  r.equals(joinPro
+00016ff0: 7065 7274 792c 204e 6f6e 652c 206a 6f69  perty, None, joi
+00017000: 6e50 726f 7065 7274 7953 6563 6f6e 6461  nPropertySeconda
+00017010: 7279 290d 0a20 206a 6f69 6e65 6420 3d20  ry)..  joined = 
+00017020: 6565 2e49 6d61 6765 436f 6c6c 6563 7469  ee.ImageCollecti
+00017030: 6f6e 286a 6f69 6e2e 6170 706c 7928 6331  on(join.apply(c1
+00017040: 2c20 6332 2c20 6a6f 696e 4669 6c74 6572  , c2, joinFilter
+00017050: 2929 0d0a 0d0a 2020 6a6f 696e 6564 203d  ))....  joined =
+00017060: 2065 652e 496d 6167 6543 6f6c 6c65 6374   ee.ImageCollect
+00017070: 696f 6e28 6a6f 696e 6564 2e6d 6170 284d  ion(joined.map(M
+00017080: 6572 6765 4261 6e64 7329 290d 0a20 2069  ergeBands))..  i
+00017090: 6620 6d61 736b 416e 794e 756c 6c56 616c  f maskAnyNullVal
+000170a0: 7565 733a 0d0a 2020 2020 6465 6620 6e75  ues:..    def nu
+000170b0: 6c6c 6572 2869 6d67 293a 0d0a 2020 2020  ller(img):..    
+000170c0: 2020 7265 7475 726e 2069 6d67 2e6d 6173    return img.mas
+000170d0: 6b28 696d 672e 6d61 736b 2829 2e41 6e64  k(img.mask().And
+000170e0: 2869 6d67 2e72 6564 7563 6528 6565 2e52  (img.reduce(ee.R
+000170f0: 6564 7563 6572 2e6d 696e 2829 292e 6e65  educer.min()).ne
+00017100: 7128 3029 2929 0d0a 2020 2020 6a6f 696e  q(0)))..    join
+00017110: 6564 203d 206a 6f69 6e65 642e 6d61 7028  ed = joined.map(
+00017120: 6e75 6c6c 6572 293b 0d0a 0d0a 2020 7265  nuller);....  re
+00017130: 7475 726e 206a 6f69 6e65 643b 0d0a 0d0a  turn joined;....
+00017140: 6465 6620 736d 6172 744a 6f69 6e28 7072  def smartJoin(pr
+00017150: 696d 6172 792c 7365 636f 6e64 6172 792c  imary,secondary,
+00017160: 686f 7572 4469 6666 293a 0d0a 2020 6d69  hourDiff):..  mi
+00017170: 6c6c 6973 203d 2068 6f75 7244 6966 6620  llis = hourDiff 
+00017180: 2a20 3630 202a 2036 3020 2a20 3130 3030  * 60 * 60 * 1000
+00017190: 0d0a 0d0a 2020 2343 7265 6174 6520 6120  ....  #Create a 
+000171a0: 7469 6d65 2066 696c 7465 7220 746f 2064  time filter to d
+000171b0: 6566 696e 6520 6120 6d61 7463 6820 6173  efine a match as
+000171c0: 206f 7665 726c 6170 7069 6e67 2074 696d   overlapping tim
+000171d0: 6573 7461 6d70 732e 0d0a 2020 6d61 7844  estamps...  maxD
+000171e0: 6966 6646 696c 7465 7220 3d20 6565 2e46  iffFilter = ee.F
+000171f0: 696c 7465 722e 6d61 7844 6966 6665 7265  ilter.maxDiffere
+00017200: 6e63 6528 7b5c 0d0a 2020 2020 2764 6966  nce({\..    'dif
+00017210: 6665 7265 6e63 6527 3a20 6d69 6c6c 6973  ference': millis
+00017220: 2c5c 0d0a 2020 2020 276c 6566 7446 6965  ,\..    'leftFie
+00017230: 6c64 273a 2027 7379 7374 656d 3a74 696d  ld': 'system:tim
+00017240: 655f 7374 6172 7427 2c5c 0d0a 2020 2020  e_start',\..    
+00017250: 2772 6967 6874 4669 656c 6427 3a20 2773  'rightField': 's
+00017260: 7973 7465 6d3a 7469 6d65 5f73 7461 7274  ystem:time_start
+00017270: 275c 0d0a 2020 7d29 0d0a 2020 2344 6566  '\..  })..  #Def
+00017280: 696e 6520 7468 6520 6a6f 696e 2e0d 0a20  ine the join... 
+00017290: 2073 6176 6542 6573 744a 6f69 6e20 3d20   saveBestJoin = 
+000172a0: 6565 2e4a 6f69 6e2e 7361 7665 4265 7374  ee.Join.saveBest
+000172b0: 287b 5c0d 0a20 2020 2027 6d61 7463 684b  ({\..    'matchK
+000172c0: 6579 273a 2027 6265 7374 496d 6167 6527  ey': 'bestImage'
+000172d0: 2c5c 0d0a 2020 2020 276d 6561 7375 7265  ,\..    'measure
+000172e0: 4b65 7927 3a20 2774 696d 6544 6966 6627  Key': 'timeDiff'
+000172f0: 5c0d 0a20 207d 290d 0a20 2064 6566 204d  \..  })..  def M
+00017300: 6572 6765 4261 6e64 7328 656c 656d 656e  ergeBands(elemen
+00017310: 7429 3a0d 0a20 2020 2023 4120 6675 6e63  t):..    #A func
+00017320: 7469 6f6e 2074 6f20 6d65 7267 6520 7468  tion to merge th
+00017330: 6520 6261 6e64 7320 746f 6765 7468 6572  e bands together
+00017340: 2e0d 0a20 2020 2023 4166 7465 7220 6120  ...    #After a 
+00017350: 6a6f 696e 2c20 7265 7375 6c74 7320 6172  join, results ar
+00017360: 6520 696e 2027 7072 696d 6172 7927 2061  e in 'primary' a
+00017370: 6e64 2027 7365 636f 6e64 6172 7927 2070  nd 'secondary' p
+00017380: 726f 7065 7274 6965 732e 0d0a 2020 2020  roperties...    
+00017390: 7265 7475 726e 2065 652e 496d 6167 652e  return ee.Image.
+000173a0: 6361 7428 656c 656d 656e 742c 2065 6c65  cat(element, ele
+000173b0: 6d65 6e74 2e67 6574 2827 6265 7374 496d  ment.get('bestIm
+000173c0: 6167 6527 2929 0d0a 0d0a 2020 2341 7070  age'))....  #App
+000173d0: 6c79 2074 6865 206a 6f69 6e2e 0d0a 2020  ly the join...  
+000173e0: 6a6f 696e 6564 203d 2073 6176 6542 6573  joined = saveBes
+000173f0: 744a 6f69 6e2e 6170 706c 7928 7072 696d  tJoin.apply(prim
+00017400: 6172 792c 2073 6563 6f6e 6461 7279 2c20  ary, secondary, 
+00017410: 6d61 7844 6966 6646 696c 7465 7229 0d0a  maxDiffFilter)..
+00017420: 2020 6a6f 696e 6564 203d 206a 6f69 6e65    joined = joine
+00017430: 642e 6d61 7028 4d65 7267 6542 616e 6473  d.map(MergeBands
+00017440: 290d 0a20 2072 6574 7572 6e20 6a6f 696e  )..  return join
+00017450: 6564 0d0a 2323 2323 2323 2323 2323 2323  ed..############
+00017460: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00017470: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00017480: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00017490: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
+000174a0: 4a6f 696e 2063 6f6c 6c65 6374 696f 6e73  Join collections
+000174b0: 2062 7920 7370 6163 6520 2869 6e74 6572   by space (inter
+000174c0: 7365 6374 696f 6e29 2061 6e64 2074 696d  section) and tim
+000174d0: 6520 2873 7065 6369 6669 6564 2062 7920  e (specified by 
+000174e0: 7573 6572 290d 0a64 6566 2073 7061 7469  user)..def spati
+000174f0: 6f54 656d 706f 7261 6c4a 6f69 6e28 7072  oTemporalJoin(pr
+00017500: 696d 6172 792c 2073 6563 6f6e 6461 7279  imary, secondary
+00017510: 2c20 686f 7572 4469 6666 203d 2032 342c  , hourDiff = 24,
+00017520: 206f 7574 4b65 7920 3d20 2773 6563 6f6e   outKey = 'secon
+00017530: 6461 7279 2729 3a0d 0a20 2074 696d 6520  dary'):..  time 
+00017540: 3d20 686f 7572 4469 6666 2a20 3630 202a  = hourDiff* 60 *
+00017550: 2036 3020 2a20 3130 3030 0d0a 0d0a 2020   60 * 1000....  
+00017560: 6f75 7442 6e73 203d 2065 652e 496d 6167  outBns = ee.Imag
+00017570: 6528 7365 636f 6e64 6172 792e 6669 7273  e(secondary.firs
+00017580: 7428 2929 2e62 616e 644e 616d 6573 2829  t()).bandNames()
+00017590: 2e6d 6170 286c 616d 6264 6120 626e 3a20  .map(lambda bn: 
+000175a0: 6565 2e53 7472 696e 6728 626e 292e 6361  ee.String(bn).ca
+000175b0: 7428 275f 2729 2e63 6174 286f 7574 4b65  t('_').cat(outKe
+000175c0: 7929 290d 0a20 2023 4465 6669 6e65 2061  y))..  #Define a
+000175d0: 2073 7061 7469 616c 2066 696c 7465 7220   spatial filter 
+000175e0: 6173 2067 656f 6d65 7472 6965 7320 7468  as geometries th
+000175f0: 6174 2069 6e74 6572 7365 6374 2e0d 0a20  at intersect... 
+00017600: 2073 7061 7469 6f54 656d 706f 7261 6c46   spatioTemporalF
+00017610: 696c 7465 7220 3d20 6565 2e46 696c 7465  ilter = ee.Filte
+00017620: 722e 416e 6428 5c0d 0a20 2020 2065 652e  r.And(\..    ee.
+00017630: 4669 6c74 6572 2e6d 6178 4469 6666 6572  Filter.maxDiffer
+00017640: 656e 6365 287b 5c0d 0a20 2020 2020 2027  ence({\..      '
+00017650: 6469 6666 6572 656e 6365 273a 2074 696d  difference': tim
+00017660: 652c 5c0d 0a20 2020 2020 2027 6c65 6674  e,\..      'left
+00017670: 4669 656c 6427 3a20 2773 7973 7465 6d3a  Field': 'system:
+00017680: 7469 6d65 5f73 7461 7274 272c 5c0d 0a20  time_start',\.. 
+00017690: 2020 2020 2027 7269 6768 7446 6965 6c64       'rightField
+000176a0: 273a 2027 7379 7374 656d 3a74 696d 655f  ': 'system:time_
+000176b0: 7374 6172 7427 5c0d 0a20 2020 207d 292c  start'\..    }),
+000176c0: 5c0d 0a20 2020 2065 652e 4669 6c74 6572  \..    ee.Filter
+000176d0: 2e69 6e74 6572 7365 6374 7328 7b5c 0d0a  .intersects({\..
+000176e0: 2020 2020 276c 6566 7446 6965 6c64 273a      'leftField':
+000176f0: 2027 2e67 656f 272c 5c0d 0a20 2020 2027   '.geo',\..    '
+00017700: 7269 6768 7446 6965 6c64 273a 2027 2e67  rightField': '.g
+00017710: 656f 272c 5c0d 0a20 2020 2027 6d61 7845  eo',\..    'maxE
+00017720: 7272 6f72 273a 2031 305c 0d0a 2020 7d29  rror': 10\..  })
+00017730: 5c0d 0a20 2029 0d0a 2020 2344 6566 696e  \..  )..  #Defin
+00017740: 6520 6120 7361 7665 2061 6c6c 206a 6f69  e a save all joi
+00017750: 6e2e 0d0a 2020 7361 7665 4265 7374 4a6f  n...  saveBestJo
+00017760: 696e 203d 2065 652e 4a6f 696e 2e73 6176  in = ee.Join.sav
+00017770: 6542 6573 7428 7b5c 0d0a 2020 2020 276d  eBest({\..    'm
+00017780: 6174 6368 4b65 7927 3a20 6f75 744b 6579  atchKey': outKey
+00017790: 2c5c 0d0a 2020 2020 276d 6561 7375 7265  ,\..    'measure
+000177a0: 4b65 7927 3a20 2774 696d 6544 6966 6627  Key': 'timeDiff'
+000177b0: 5c0d 0a20 207d 290d 0a0d 0a20 2023 4170  \..  })....  #Ap
+000177c0: 706c 7920 7468 6520 6a6f 696e 2e0d 0a20  ply the join... 
+000177d0: 206a 6f69 6e65 6420 3d20 7361 7665 4265   joined = saveBe
+000177e0: 7374 4a6f 696e 2e61 7070 6c79 2870 7269  stJoin.apply(pri
+000177f0: 6d61 7279 2c20 7365 636f 6e64 6172 792c  mary, secondary,
+00017800: 2073 7061 7469 6f54 656d 706f 7261 6c46   spatioTemporalF
+00017810: 696c 7465 7229 0d0a 2020 6465 6620 4d65  ilter)..  def Me
+00017820: 7267 6542 616e 6473 2865 6c65 6d65 6e74  rgeBands(element
+00017830: 293a 0d0a 2020 2020 2341 2066 756e 6374  ):..    #A funct
+00017840: 696f 6e20 746f 206d 6572 6765 2074 6865  ion to merge the
+00017850: 2062 616e 6473 2074 6f67 6574 6865 722e   bands together.
+00017860: 0d0a 2020 2020 2341 6674 6572 2061 206a  ..    #After a j
+00017870: 6f69 6e2c 2072 6573 756c 7473 2061 7265  oin, results are
+00017880: 2069 6e20 2770 7269 6d61 7279 2720 616e   in 'primary' an
+00017890: 6420 2773 6563 6f6e 6461 7279 2720 7072  d 'secondary' pr
+000178a0: 6f70 6572 7469 6573 2e0d 0a20 2020 2072  operties...    r
+000178b0: 6574 7572 6e20 6565 2e49 6d61 6765 2e63  eturn ee.Image.c
+000178c0: 6174 2865 6c65 6d65 6e74 2c20 6565 2e49  at(element, ee.I
+000178d0: 6d61 6765 2865 6c65 6d65 6e74 2e67 6574  mage(element.get
+000178e0: 286f 7574 4b65 7929 292e 7265 6e61 6d65  (outKey)).rename
+000178f0: 286f 7574 426e 7329 290d 0a0d 0a20 206a  (outBns))....  j
+00017900: 6f69 6e65 6420 3d20 6a6f 696e 6564 2e6d  oined = joined.m
+00017910: 6170 284d 6572 6765 4261 6e64 7329 0d0a  ap(MergeBands)..
+00017920: 2020 7265 7475 726e 206a 6f69 6e65 640d    return joined.
+00017930: 0a0d 0a23 2053 696d 706c 6520 696e 6e65  ...# Simple inne
+00017940: 7220 6a6f 696e 2066 756e 6374 696f 6e20  r join function 
+00017950: 666f 7220 6665 6174 7572 6543 6f6c 6c65  for featureColle
+00017960: 6374 696f 6e73 0d0a 2320 4d61 7463 6865  ctions..# Matche
+00017970: 7320 6665 6174 7572 6573 2062 6173 6564  s features based
+00017980: 206f 6e20 616e 2065 7861 6374 206d 6174   on an exact mat
+00017990: 6368 206f 6620 7468 6520 6669 656c 644e  ch of the fieldN
+000179a0: 616d 6520 7061 7261 6d65 7465 720d 0a23  ame parameter..#
+000179b0: 2041 6e20 6f70 7469 6f6e 616c 2064 6966   An optional dif
+000179c0: 6665 7265 6e74 2066 6965 6c64 206e 616d  ferent field nam
+000179d0: 6520 6361 6e20 6265 2070 726f 7669 6465  e can be provide
+000179e0: 6420 666f 7220 7468 6520 7365 636f 6e64  d for the second
+000179f0: 2066 6561 7475 7265 436f 6c6c 6563 7469   featureCollecti
+00017a00: 6f6e 0d0a 2320 5265 7461 696e 7320 7468  on..# Retains th
+00017a10: 6520 6765 6f6d 6574 7279 206f 6620 7468  e geometry of th
+00017a20: 6520 7072 696d 6172 792c 2062 7574 2063  e primary, but c
+00017a30: 6f70 6965 7320 7468 6520 7072 6f70 6572  opies the proper
+00017a40: 7469 6573 206f 6620 7468 6520 7365 636f  ties of the seco
+00017a50: 6e64 6172 7920 636f 6c6c 6563 7469 6f6e  ndary collection
+00017a60: 0d0a 6465 6620 6a6f 696e 4665 6174 7572  ..def joinFeatur
+00017a70: 6543 6f6c 6c65 6374 696f 6e73 2870 7269  eCollections(pri
+00017a80: 6d61 7279 2c73 6563 6f6e 6461 7279 2c66  mary,secondary,f
+00017a90: 6965 6c64 4e61 6d65 2c66 6965 6c64 4e61  ieldName,fieldNa
+00017aa0: 6d65 5365 636f 6e64 6172 793d 4e6f 6e65  meSecondary=None
+00017ab0: 293a 0d0a 2020 6966 2066 6965 6c64 4e61  ):..  if fieldNa
+00017ac0: 6d65 5365 636f 6e64 6172 793d 3d4e 6f6e  meSecondary==Non
+00017ad0: 653a 6669 656c 644e 616d 6553 6563 6f6e  e:fieldNameSecon
+00017ae0: 6461 7279 3d66 6965 6c64 4e61 6d65 0d0a  dary=fieldName..
+00017af0: 2020 2320 5573 6520 616e 2065 7175 616c    # Use an equal
+00017b00: 7320 6669 6c74 6572 2074 6f20 7370 6563  s filter to spec
+00017b10: 6966 7920 686f 7720 7468 6520 636f 6c6c  ify how the coll
+00017b20: 6563 7469 6f6e 7320 6d61 7463 682e 0d0a  ections match...
+00017b30: 2020 6620 3d20 6565 2e46 696c 7465 722e    f = ee.Filter.
+00017b40: 6571 7561 6c73 2866 6965 6c64 4e61 6d65  equals(fieldName
+00017b50: 2c4e 6f6e 652c 6669 656c 644e 616d 6553  ,None,fieldNameS
+00017b60: 6563 6f6e 6461 7279 290d 0a0d 0a0d 0a20  econdary)...... 
+00017b70: 2023 2044 6566 696e 6520 7468 6520 6a6f   # Define the jo
+00017b80: 696e 2e0d 0a20 2069 6e6e 6572 4a6f 696e  in...  innerJoin
+00017b90: 203d 2065 652e 4a6f 696e 2e69 6e6e 6572   = ee.Join.inner
+00017ba0: 2827 7072 696d 6172 7927 2c20 2773 6563  ('primary', 'sec
+00017bb0: 6f6e 6461 7279 2729 0d0a 0d0a 2020 2320  ondary')....  # 
+00017bc0: 4170 706c 7920 7468 6520 6a6f 696e 2e0d  Apply the join..
+00017bd0: 0a20 206a 6f69 6e65 6420 3d20 696e 6e65  .  joined = inne
+00017be0: 724a 6f69 6e2e 6170 706c 7928 7072 696d  rJoin.apply(prim
+00017bf0: 6172 792c 2073 6563 6f6e 6461 7279 2c20  ary, secondary, 
+00017c00: 6629 0d0a 2020 6a6f 696e 6564 203d 206a  f)..  joined = j
+00017c10: 6f69 6e65 642e 6d61 7028 6c61 6d62 6461  oined.map(lambda
+00017c20: 2066 3a20 6565 2e46 6561 7475 7265 2866   f: ee.Feature(f
+00017c30: 2e67 6574 2827 7072 696d 6172 7927 2929  .get('primary'))
+00017c40: 2e63 6f70 7950 726f 7065 7274 6965 7328  .copyProperties(
+00017c50: 6565 2e46 6561 7475 7265 2866 2e67 6574  ee.Feature(f.get
+00017c60: 2827 7365 636f 6e64 6172 7927 2929 2929  ('secondary'))))
+00017c70: 0d0a 0d0a 2020 7265 7475 726e 206a 6f69  ....  return joi
+00017c80: 6e65 640d 0a23 2323 2323 2323 2323 2323  ned..###########
+00017c90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00017ca0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00017cb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00017cc0: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
+00017cd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00017ce0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00017cf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00017d00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00017d10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00017d20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00017d30: 230d 0a23 2323 2323 2323 2323 2323 2323  #..#############
-00017d40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00017d50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00017d60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00017d70: 2323 2323 2323 2323 2323 2323 0d0a 234d  ############..#M
-00017d80: 6574 686f 6420 666f 7220 7265 6d6f 7669  ethod for removi
-00017d90: 6e67 2073 7069 6b65 7320 696e 2074 696d  ng spikes in tim
-00017da0: 6520 7365 7269 6573 0d0a 6465 6620 6465  e series..def de
-00017db0: 7370 696b 6543 6f6c 6c65 6374 696f 6e28  spikeCollection(
-00017dc0: 632c 2061 6273 6f6c 7574 6553 7069 6b65  c, absoluteSpike
-00017dd0: 2c20 6261 6e64 4e6f 293a 0d0a 2020 6320  , bandNo):..  c 
-00017de0: 3d20 632e 746f 4c69 7374 2831 3030 3030  = c.toList(10000
-00017df0: 2c30 290d 0a0d 0a20 2023 4765 7420 626f  ,0)....  #Get bo
-00017e00: 6f6b 2065 6e64 7320 666f 7220 6164 6469  ok ends for addi
-00017e10: 6e67 2062 6163 6b20 6174 2074 6865 2065  ng back at the e
-00017e20: 6e64 0d0a 2020 6669 7273 7420 3d20 632e  nd..  first = c.
-00017e30: 736c 6963 6528 302c 3129 0d0a 2020 6c61  slice(0,1)..  la
-00017e40: 7374 203d 2063 2e73 6c69 6365 282d 312c  st = c.slice(-1,
-00017e50: 4e6f 6e65 290d 0a0d 0a20 2023 536c 6963  None)....  #Slic
-00017e60: 6520 7468 6520 6c65 6674 2c20 6365 6e74  e the left, cent
-00017e70: 6572 2c20 616e 6420 7269 6768 7420 666f  er, and right fo
-00017e80: 7220 7468 6520 6d6f 7669 6e67 2077 696e  r the moving win
-00017e90: 646f 770d 0a20 206c 6566 7420 3d20 632e  dow..  left = c.
-00017ea0: 736c 6963 6528 302c 2d32 290d 0a20 2063  slice(0,-2)..  c
-00017eb0: 656e 7465 7220 3d20 632e 736c 6963 6528  enter = c.slice(
-00017ec0: 312c 2d31 290d 0a20 2072 6967 6874 203d  1,-1)..  right =
-00017ed0: 2063 2e73 6c69 6365 2832 2c4e 6f6e 6529   c.slice(2,None)
-00017ee0: 0d0a 0d0a 2020 2346 696e 6420 686f 7720  ....  #Find how 
-00017ef0: 6d61 6e79 2069 6d61 6765 7320 7468 6572  many images ther
-00017f00: 6520 6172 6520 746f 2063 6f6d 7061 7265  e are to compare
-00017f10: 0d0a 2020 7365 7120 3d20 6565 2e4c 6973  ..  seq = ee.Lis
-00017f20: 742e 7365 7175 656e 6365 2830 2c6c 6566  t.sequence(0,lef
-00017f30: 742e 6c65 6e67 7468 2829 2e73 7562 7472  t.length().subtr
-00017f40: 6163 7428 3129 290d 0a0d 0a20 2023 436f  act(1))....  #Co
-00017f50: 6d70 6172 6520 7468 6520 6365 6e74 6572  mpare the center
-00017f60: 2074 6f20 7468 6520 6c65 6674 2061 6e64   to the left and
-00017f70: 2072 6967 6874 2069 6d61 6765 730d 0a20   right images.. 
-00017f80: 2064 6566 2063 6f6d 7061 7265 2869 293a   def compare(i):
-00017f90: 0d0a 2020 2020 6c74 203d 2065 652e 496d  ..    lt = ee.Im
-00017fa0: 6167 6528 6c65 6674 2e67 6574 2869 2929  age(left.get(i))
-00017fb0: 0d0a 2020 2020 7274 203d 2065 652e 496d  ..    rt = ee.Im
-00017fc0: 6167 6528 7269 6768 742e 6765 7428 6929  age(right.get(i)
-00017fd0: 290d 0a0d 0a20 2020 2063 7420 3d20 6565  )....    ct = ee
-00017fe0: 2e49 6d61 6765 2863 656e 7465 722e 6765  .Image(center.ge
-00017ff0: 7428 6929 293b 0d0a 2020 2020 7469 6d65  t(i));..    time
-00018000: 5f73 7461 7274 203d 2063 742e 6765 7428  _start = ct.get(
-00018010: 2773 7973 7465 6d3a 7469 6d65 5f73 7461  'system:time_sta
-00018020: 7274 2729 0d0a 2020 2020 7469 6d65 5f65  rt')..    time_e
-00018030: 6e64 203d 2063 742e 6765 7428 2773 7973  nd = ct.get('sys
-00018040: 7465 6d3a 7469 6d65 5f65 6e64 2729 0d0a  tem:time_end')..
-00018050: 2020 2020 7369 203d 2063 742e 6765 7428      si = ct.get(
-00018060: 2773 7973 7465 6d3a 696e 6465 7827 290d  'system:index').
-00018070: 0a0d 0a0d 0a0d 0a20 2020 2064 6966 6631  .......    diff1
-00018080: 203d 2063 742e 7365 6c65 6374 285b 6261   = ct.select([ba
-00018090: 6e64 4e6f 5d29 2e61 6464 2831 292e 7375  ndNo]).add(1).su
-000180a0: 6274 7261 6374 286c 742e 7365 6c65 6374  btract(lt.select
-000180b0: 285b 6261 6e64 4e6f 5d29 2e61 6464 2831  ([bandNo]).add(1
-000180c0: 2929 0d0a 2020 2020 6469 6666 3220 3d20  ))..    diff2 = 
-000180d0: 6374 2e73 656c 6563 7428 5b62 616e 644e  ct.select([bandN
-000180e0: 6f5d 292e 6164 6428 3129 2e73 7562 7472  o]).add(1).subtr
-000180f0: 6163 7428 7274 2e73 656c 6563 7428 5b62  act(rt.select([b
-00018100: 616e 644e 6f5d 292e 6164 6428 3129 290d  andNo]).add(1)).
-00018110: 0a0d 0a20 2020 2068 6967 6853 7069 6b65  ...    highSpike
-00018120: 203d 2064 6966 6631 2e67 7428 6162 736f   = diff1.gt(abso
-00018130: 6c75 7465 5370 696b 6529 2e41 6e64 2864  luteSpike).And(d
-00018140: 6966 6632 2e67 7428 6162 736f 6c75 7465  iff2.gt(absolute
-00018150: 5370 696b 6529 290d 0a20 2020 206c 6f77  Spike))..    low
-00018160: 5370 696b 6520 3d20 6469 6666 312e 6c74  Spike = diff1.lt
-00018170: 282d 2061 6273 6f6c 7574 6553 7069 6b65  (- absoluteSpike
-00018180: 292e 416e 6428 6469 6666 322e 6c74 282d  ).And(diff2.lt(-
-00018190: 2061 6273 6f6c 7574 6553 7069 6b65 2929   absoluteSpike))
-000181a0: 0d0a 2020 2020 4269 6e61 7279 5370 696b  ..    BinarySpik
-000181b0: 6520 3d20 6869 6768 5370 696b 652e 4f72  e = highSpike.Or
-000181c0: 286c 6f77 5370 696b 6529 0d0a 0d0a 2020  (lowSpike)....  
-000181d0: 2020 6f72 6967 696e 616c 4d61 736b 203d    originalMask =
-000181e0: 2063 742e 6d61 736b 2829 0d0a 2020 2020   ct.mask()..    
-000181f0: 6374 203d 2063 742e 6d61 736b 2842 696e  ct = ct.mask(Bin
-00018200: 6172 7953 7069 6b65 2e65 7128 3029 290d  arySpike.eq(0)).
-00018210: 0a0d 0a20 2020 2064 6f4e 6f74 4d61 736b  ...    doNotMask
-00018220: 203d 206c 742e 6d61 736b 2829 2e4e 6f74   = lt.mask().Not
-00018230: 2829 2e4f 7228 7274 2e6d 6173 6b28 292e  ().Or(rt.mask().
-00018240: 4e6f 7428 2929 0d0a 2020 2020 6c72 4d65  Not())..    lrMe
-00018250: 616e 203d 206c 742e 6164 6428 7274 290d  an = lt.add(rt).
-00018260: 0a20 2020 206c 724d 6561 6e20 3d20 6c72  .    lrMean = lr
-00018270: 4d65 616e 2e64 6976 6964 6528 3229 0d0a  Mean.divide(2)..
-00018280: 2020 2020 236f 7574 203d 2063 742e 6d61      #out = ct.ma
-00018290: 736b 2864 6f4e 6f74 4d61 736b 2e4e 6f74  sk(doNotMask.Not
-000182a0: 2829 2e41 6e64 2863 742e 6d61 736b 2829  ().And(ct.mask()
-000182b0: 2929 0d0a 2020 2020 6f75 7420 3d20 6374  ))..    out = ct
-000182c0: 2e77 6865 7265 2842 696e 6172 7953 7069  .where(BinarySpi
-000182d0: 6b65 2e65 7128 3129 2e41 6e64 2864 6f4e  ke.eq(1).And(doN
-000182e0: 6f74 4d61 736b 2e4e 6f74 2829 292c 6c72  otMask.Not()),lr
-000182f0: 4d65 616e 290d 0a20 2020 2072 6574 7572  Mean)..    retur
-00018300: 6e20 6f75 742e 7365 7428 2773 7973 7465  n out.set('syste
-00018310: 6d3a 696e 6465 7827 2c73 6929 2e73 6574  m:index',si).set
-00018320: 2827 7379 7374 656d 3a74 696d 655f 7374  ('system:time_st
-00018330: 6172 7427 2c20 7469 6d65 5f73 7461 7274  art', time_start
-00018340: 292e 7365 7428 2773 7973 7465 6d3a 7469  ).set('system:ti
-00018350: 6d65 5f65 6e64 272c 2074 696d 655f 656e  me_end', time_en
-00018360: 6429 0d0a 0d0a 0d0a 2020 6f75 7443 6f6c  d)......  outCol
-00018370: 6c65 6374 696f 6e20 3d20 7365 712e 6d61  lection = seq.ma
-00018380: 7028 636f 6d70 6172 6529 0d0a 0d0a 2020  p(compare)....  
-00018390: 2341 6464 2074 6865 2062 6f6f 6b65 6e64  #Add the bookend
-000183a0: 7320 6261 636b 206f 6e0d 0a20 206f 7574  s back on..  out
-000183b0: 436f 6c6c 6563 7469 6f6e 203d 2020 6565  Collection =  ee
-000183c0: 2e4c 6973 7428 5b66 6972 7374 2c6f 7574  .List([first,out
-000183d0: 436f 6c6c 6563 7469 6f6e 2c6c 6173 745d  Collection,last]
-000183e0: 292e 666c 6174 7465 6e28 290d 0a20 2072  ).flatten()..  r
-000183f0: 6574 7572 6e20 6565 2e49 6d61 6765 436f  eturn ee.ImageCo
-00018400: 6c6c 6563 7469 6f6e 2e66 726f 6d49 6d61  llection.fromIma
-00018410: 6765 7328 6f75 7443 6f6c 6c65 6374 696f  ges(outCollectio
-00018420: 6e29 0d0a 0d0a 2323 2323 2323 2323 2323  n)....##########
+00017d10: 2323 2323 2323 2323 230d 0a23 4d65 7468  #########..#Meth
+00017d20: 6f64 2066 6f72 2072 656d 6f76 696e 6720  od for removing 
+00017d30: 7370 696b 6573 2069 6e20 7469 6d65 2073  spikes in time s
+00017d40: 6572 6965 730d 0a64 6566 2064 6573 7069  eries..def despi
+00017d50: 6b65 436f 6c6c 6563 7469 6f6e 2863 2c20  keCollection(c, 
+00017d60: 6162 736f 6c75 7465 5370 696b 652c 2062  absoluteSpike, b
+00017d70: 616e 644e 6f29 3a0d 0a20 2063 203d 2063  andNo):..  c = c
+00017d80: 2e74 6f4c 6973 7428 3130 3030 302c 3029  .toList(10000,0)
+00017d90: 0d0a 0d0a 2020 2347 6574 2062 6f6f 6b20  ....  #Get book 
+00017da0: 656e 6473 2066 6f72 2061 6464 696e 6720  ends for adding 
+00017db0: 6261 636b 2061 7420 7468 6520 656e 640d  back at the end.
+00017dc0: 0a20 2066 6972 7374 203d 2063 2e73 6c69  .  first = c.sli
+00017dd0: 6365 2830 2c31 290d 0a20 206c 6173 7420  ce(0,1)..  last 
+00017de0: 3d20 632e 736c 6963 6528 2d31 2c4e 6f6e  = c.slice(-1,Non
+00017df0: 6529 0d0a 0d0a 2020 2353 6c69 6365 2074  e)....  #Slice t
+00017e00: 6865 206c 6566 742c 2063 656e 7465 722c  he left, center,
+00017e10: 2061 6e64 2072 6967 6874 2066 6f72 2074   and right for t
+00017e20: 6865 206d 6f76 696e 6720 7769 6e64 6f77  he moving window
+00017e30: 0d0a 2020 6c65 6674 203d 2063 2e73 6c69  ..  left = c.sli
+00017e40: 6365 2830 2c2d 3229 0d0a 2020 6365 6e74  ce(0,-2)..  cent
+00017e50: 6572 203d 2063 2e73 6c69 6365 2831 2c2d  er = c.slice(1,-
+00017e60: 3129 0d0a 2020 7269 6768 7420 3d20 632e  1)..  right = c.
+00017e70: 736c 6963 6528 322c 4e6f 6e65 290d 0a0d  slice(2,None)...
+00017e80: 0a20 2023 4669 6e64 2068 6f77 206d 616e  .  #Find how man
+00017e90: 7920 696d 6167 6573 2074 6865 7265 2061  y images there a
+00017ea0: 7265 2074 6f20 636f 6d70 6172 650d 0a20  re to compare.. 
+00017eb0: 2073 6571 203d 2065 652e 4c69 7374 2e73   seq = ee.List.s
+00017ec0: 6571 7565 6e63 6528 302c 6c65 6674 2e6c  equence(0,left.l
+00017ed0: 656e 6774 6828 292e 7375 6274 7261 6374  ength().subtract
+00017ee0: 2831 2929 0d0a 0d0a 2020 2343 6f6d 7061  (1))....  #Compa
+00017ef0: 7265 2074 6865 2063 656e 7465 7220 746f  re the center to
+00017f00: 2074 6865 206c 6566 7420 616e 6420 7269   the left and ri
+00017f10: 6768 7420 696d 6167 6573 0d0a 2020 6465  ght images..  de
+00017f20: 6620 636f 6d70 6172 6528 6929 3a0d 0a20  f compare(i):.. 
+00017f30: 2020 206c 7420 3d20 6565 2e49 6d61 6765     lt = ee.Image
+00017f40: 286c 6566 742e 6765 7428 6929 290d 0a20  (left.get(i)).. 
+00017f50: 2020 2072 7420 3d20 6565 2e49 6d61 6765     rt = ee.Image
+00017f60: 2872 6967 6874 2e67 6574 2869 2929 0d0a  (right.get(i))..
+00017f70: 0d0a 2020 2020 6374 203d 2065 652e 496d  ..    ct = ee.Im
+00017f80: 6167 6528 6365 6e74 6572 2e67 6574 2869  age(center.get(i
+00017f90: 2929 3b0d 0a20 2020 2074 696d 655f 7374  ));..    time_st
+00017fa0: 6172 7420 3d20 6374 2e67 6574 2827 7379  art = ct.get('sy
+00017fb0: 7374 656d 3a74 696d 655f 7374 6172 7427  stem:time_start'
+00017fc0: 290d 0a20 2020 2074 696d 655f 656e 6420  )..    time_end 
+00017fd0: 3d20 6374 2e67 6574 2827 7379 7374 656d  = ct.get('system
+00017fe0: 3a74 696d 655f 656e 6427 290d 0a20 2020  :time_end')..   
+00017ff0: 2073 6920 3d20 6374 2e67 6574 2827 7379   si = ct.get('sy
+00018000: 7374 656d 3a69 6e64 6578 2729 0d0a 0d0a  stem:index')....
+00018010: 0d0a 0d0a 2020 2020 6469 6666 3120 3d20  ....    diff1 = 
+00018020: 6374 2e73 656c 6563 7428 5b62 616e 644e  ct.select([bandN
+00018030: 6f5d 292e 6164 6428 3129 2e73 7562 7472  o]).add(1).subtr
+00018040: 6163 7428 6c74 2e73 656c 6563 7428 5b62  act(lt.select([b
+00018050: 616e 644e 6f5d 292e 6164 6428 3129 290d  andNo]).add(1)).
+00018060: 0a20 2020 2064 6966 6632 203d 2063 742e  .    diff2 = ct.
+00018070: 7365 6c65 6374 285b 6261 6e64 4e6f 5d29  select([bandNo])
+00018080: 2e61 6464 2831 292e 7375 6274 7261 6374  .add(1).subtract
+00018090: 2872 742e 7365 6c65 6374 285b 6261 6e64  (rt.select([band
+000180a0: 4e6f 5d29 2e61 6464 2831 2929 0d0a 0d0a  No]).add(1))....
+000180b0: 2020 2020 6869 6768 5370 696b 6520 3d20      highSpike = 
+000180c0: 6469 6666 312e 6774 2861 6273 6f6c 7574  diff1.gt(absolut
+000180d0: 6553 7069 6b65 292e 416e 6428 6469 6666  eSpike).And(diff
+000180e0: 322e 6774 2861 6273 6f6c 7574 6553 7069  2.gt(absoluteSpi
+000180f0: 6b65 2929 0d0a 2020 2020 6c6f 7753 7069  ke))..    lowSpi
+00018100: 6b65 203d 2064 6966 6631 2e6c 7428 2d20  ke = diff1.lt(- 
+00018110: 6162 736f 6c75 7465 5370 696b 6529 2e41  absoluteSpike).A
+00018120: 6e64 2864 6966 6632 2e6c 7428 2d20 6162  nd(diff2.lt(- ab
+00018130: 736f 6c75 7465 5370 696b 6529 290d 0a20  soluteSpike)).. 
+00018140: 2020 2042 696e 6172 7953 7069 6b65 203d     BinarySpike =
+00018150: 2068 6967 6853 7069 6b65 2e4f 7228 6c6f   highSpike.Or(lo
+00018160: 7753 7069 6b65 290d 0a0d 0a20 2020 206f  wSpike)....    o
+00018170: 7269 6769 6e61 6c4d 6173 6b20 3d20 6374  riginalMask = ct
+00018180: 2e6d 6173 6b28 290d 0a20 2020 2063 7420  .mask()..    ct 
+00018190: 3d20 6374 2e6d 6173 6b28 4269 6e61 7279  = ct.mask(Binary
+000181a0: 5370 696b 652e 6571 2830 2929 0d0a 0d0a  Spike.eq(0))....
+000181b0: 2020 2020 646f 4e6f 744d 6173 6b20 3d20      doNotMask = 
+000181c0: 6c74 2e6d 6173 6b28 292e 4e6f 7428 292e  lt.mask().Not().
+000181d0: 4f72 2872 742e 6d61 736b 2829 2e4e 6f74  Or(rt.mask().Not
+000181e0: 2829 290d 0a20 2020 206c 724d 6561 6e20  ())..    lrMean 
+000181f0: 3d20 6c74 2e61 6464 2872 7429 0d0a 2020  = lt.add(rt)..  
+00018200: 2020 6c72 4d65 616e 203d 206c 724d 6561    lrMean = lrMea
+00018210: 6e2e 6469 7669 6465 2832 290d 0a20 2020  n.divide(2)..   
+00018220: 2023 6f75 7420 3d20 6374 2e6d 6173 6b28   #out = ct.mask(
+00018230: 646f 4e6f 744d 6173 6b2e 4e6f 7428 292e  doNotMask.Not().
+00018240: 416e 6428 6374 2e6d 6173 6b28 2929 290d  And(ct.mask())).
+00018250: 0a20 2020 206f 7574 203d 2063 742e 7768  .    out = ct.wh
+00018260: 6572 6528 4269 6e61 7279 5370 696b 652e  ere(BinarySpike.
+00018270: 6571 2831 292e 416e 6428 646f 4e6f 744d  eq(1).And(doNotM
+00018280: 6173 6b2e 4e6f 7428 2929 2c6c 724d 6561  ask.Not()),lrMea
+00018290: 6e29 0d0a 2020 2020 7265 7475 726e 206f  n)..    return o
+000182a0: 7574 2e73 6574 2827 7379 7374 656d 3a69  ut.set('system:i
+000182b0: 6e64 6578 272c 7369 292e 7365 7428 2773  ndex',si).set('s
+000182c0: 7973 7465 6d3a 7469 6d65 5f73 7461 7274  ystem:time_start
+000182d0: 272c 2074 696d 655f 7374 6172 7429 2e73  ', time_start).s
+000182e0: 6574 2827 7379 7374 656d 3a74 696d 655f  et('system:time_
+000182f0: 656e 6427 2c20 7469 6d65 5f65 6e64 290d  end', time_end).
+00018300: 0a0d 0a0d 0a20 206f 7574 436f 6c6c 6563  .....  outCollec
+00018310: 7469 6f6e 203d 2073 6571 2e6d 6170 2863  tion = seq.map(c
+00018320: 6f6d 7061 7265 290d 0a0d 0a20 2023 4164  ompare)....  #Ad
+00018330: 6420 7468 6520 626f 6f6b 656e 6473 2062  d the bookends b
+00018340: 6163 6b20 6f6e 0d0a 2020 6f75 7443 6f6c  ack on..  outCol
+00018350: 6c65 6374 696f 6e20 3d20 2065 652e 4c69  lection =  ee.Li
+00018360: 7374 285b 6669 7273 742c 6f75 7443 6f6c  st([first,outCol
+00018370: 6c65 6374 696f 6e2c 6c61 7374 5d29 2e66  lection,last]).f
+00018380: 6c61 7474 656e 2829 0d0a 2020 7265 7475  latten()..  retu
+00018390: 726e 2065 652e 496d 6167 6543 6f6c 6c65  rn ee.ImageColle
+000183a0: 6374 696f 6e2e 6672 6f6d 496d 6167 6573  ction.fromImages
+000183b0: 286f 7574 436f 6c6c 6563 7469 6f6e 290d  (outCollection).
+000183c0: 0a0d 0a23 2323 2323 2323 2323 2323 2323  ...#############
+000183d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000183e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000183f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00018400: 2323 2323 2323 2323 2323 2323 0d0a 2323  ############..##
+00018410: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00018420: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00018430: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00018440: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00018450: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00018460: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
-00018470: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
-00018480: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00018490: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000184a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000184b0: 2323 2323 2323 2323 2323 0d0a 2346 756e  ##########..#Fun
-000184c0: 6374 696f 6e20 746f 2067 6574 204d 4f44  ction to get MOD
-000184d0: 4953 2064 6174 6120 6672 6f6d 2076 6172  IS data from var
-000184e0: 696f 7573 2063 6f6c 6c65 6374 696f 6e73  ious collections
-000184f0: 0d0a 2357 696c 6c20 7075 6c6c 2066 726f  ..#Will pull fro
-00018500: 6d20 6461 696c 7920 6f72 2038 2d64 6179  m daily or 8-day
-00018510: 2063 6f6d 706f 7369 7465 2063 6f6c 6c65   composite colle
-00018520: 6374 696f 6e73 2062 6173 6564 206f 6e20  ctions based on 
-00018530: 7468 6520 626f 6f6c 6561 6e20 7661 7269  the boolean vari
-00018540: 6162 6c65 2022 6461 696c 7922 0d0a 6465  able "daily"..de
-00018550: 6620 6765 744d 6f64 6973 4461 7461 2873  f getModisData(s
-00018560: 7461 7274 5965 6172 2c65 6e64 5965 6172  tartYear,endYear
-00018570: 2c73 7461 7274 4a75 6c69 616e 2c65 6e64  ,startJulian,end
-00018580: 4a75 6c69 616e 2c64 6169 6c79 203d 2046  Julian,daily = F
-00018590: 616c 7365 2c6d 6173 6b57 5141 203d 2046  alse,maskWQA = F
-000185a0: 616c 7365 2c7a 656e 6974 6854 6872 6573  alse,zenithThres
-000185b0: 6820 3d20 3930 2c75 7365 5465 6d70 496e  h = 90,useTempIn
-000185c0: 436c 6f75 644d 6173 6b20 3d20 5472 7565  CloudMask = True
-000185d0: 2c61 6464 4c6f 6f6b 416e 676c 6542 616e  ,addLookAngleBan
-000185e0: 6473 203d 2046 616c 7365 2c72 6573 616d  ds = False,resam
-000185f0: 706c 654d 6574 686f 6420 3d20 276e 6561  pleMethod = 'nea
-00018600: 7227 293a 0d0a 0d0a 2020 2346 696e 6420  r'):....  #Find 
-00018610: 7768 6963 6820 636f 6c6c 6563 7469 6f6e  which collection
-00018620: 7320 746f 2070 756c 6c20 6672 6f6d 2062  s to pull from b
-00018630: 6173 6564 206f 6e20 6461 696c 7920 6f72  ased on daily or
-00018640: 2038 2d64 6179 0d0a 2020 6966 2064 6169   8-day..  if dai
-00018650: 6c79 203d 3d20 4661 6c73 653a 0d0a 2020  ly == False:..  
-00018660: 2020 6132 3530 4320 3d20 6d6f 6469 7343    a250C = modisC
-00018670: 4469 6374 5b27 6569 6768 7444 6179 5352  Dict['eightDaySR
-00018680: 3235 3041 275d 0d0a 2020 2020 7432 3530  250A']..    t250
-00018690: 4320 3d20 6d6f 6469 7343 4469 6374 5b27  C = modisCDict['
-000186a0: 6569 6768 7444 6179 5352 3235 3054 275d  eightDaySR250T']
-000186b0: 0d0a 2020 2020 6135 3030 4320 3d20 6d6f  ..    a500C = mo
-000186c0: 6469 7343 4469 6374 5b27 6569 6768 7444  disCDict['eightD
-000186d0: 6179 5352 3530 3041 275d 0d0a 2020 2020  aySR500A']..    
-000186e0: 7435 3030 4320 3d20 6d6f 6469 7343 4469  t500C = modisCDi
-000186f0: 6374 5b27 6569 6768 7444 6179 5352 3530  ct['eightDaySR50
-00018700: 3054 275d 0d0a 2020 2020 6131 3030 3043  0T']..    a1000C
-00018710: 203d 206d 6f64 6973 4344 6963 745b 2765   = modisCDict['e
-00018720: 6967 6874 4461 794c 5354 3130 3030 4127  ightDayLST1000A'
-00018730: 5d0d 0a20 2020 2074 3130 3030 4320 3d20  ]..    t1000C = 
-00018740: 6d6f 6469 7343 4469 6374 5b27 6569 6768  modisCDict['eigh
-00018750: 7444 6179 4c53 5431 3030 3054 275d 0d0a  tDayLST1000T']..
-00018760: 2020 2020 7669 6577 416e 676c 6542 616e      viewAngleBan
-00018770: 644e 616d 6573 203d 2063 6f6d 706f 7369  dNames = composi
-00018780: 7465 5669 6577 416e 676c 6542 616e 644e  teViewAngleBandN
-00018790: 616d 6573 3b0d 0a20 2065 6c73 653a 0d0a  ames;..  else:..
-000187a0: 2020 2020 6132 3530 4320 3d20 6d6f 6469      a250C = modi
-000187b0: 7343 4469 6374 5b27 6461 696c 7953 5232  sCDict['dailySR2
-000187c0: 3530 4127 5d0d 0a20 2020 2074 3235 3043  50A']..    t250C
-000187d0: 203d 206d 6f64 6973 4344 6963 745b 2764   = modisCDict['d
-000187e0: 6169 6c79 5352 3235 3054 275d 0d0a 2020  ailySR250T']..  
-000187f0: 2020 6135 3030 4320 3d20 6d6f 6469 7343    a500C = modisC
-00018800: 4469 6374 5b27 6461 696c 7953 5235 3030  Dict['dailySR500
-00018810: 4127 5d0d 0a20 2020 2074 3530 3043 203d  A']..    t500C =
-00018820: 206d 6f64 6973 4344 6963 745b 2764 6169   modisCDict['dai
-00018830: 6c79 5352 3530 3054 275d 0d0a 2020 2020  lySR500T']..    
-00018840: 6131 3030 3043 203d 206d 6f64 6973 4344  a1000C = modisCD
-00018850: 6963 745b 2764 6169 6c79 4c53 5431 3030  ict['dailyLST100
-00018860: 3041 275d 0d0a 2020 2020 7431 3030 3043  0A']..    t1000C
-00018870: 203d 206d 6f64 6973 4344 6963 745b 2764   = modisCDict['d
-00018880: 6169 6c79 4c53 5431 3030 3054 275d 0d0a  ailyLST1000T']..
-00018890: 2020 2020 7669 6577 416e 676c 6542 616e      viewAngleBan
-000188a0: 644e 616d 6573 203d 2064 6169 6c79 5669  dNames = dailyVi
-000188b0: 6577 416e 676c 6542 616e 644e 616d 6573  ewAngleBandNames
-000188c0: 3b0d 0a0d 0a20 2023 5075 6c6c 2069 6d61  ;....  #Pull ima
-000188d0: 6765 7320 6672 6f6d 2065 6163 6820 6f66  ges from each of
-000188e0: 2074 6865 2063 6f6c 6c65 6374 696f 6e73   the collections
-000188f0: 0d0a 2020 6132 3530 203d 2065 652e 496d  ..  a250 = ee.Im
-00018900: 6167 6543 6f6c 6c65 6374 696f 6e28 6132  ageCollection(a2
-00018910: 3530 4329 5c0d 0a20 2020 202e 6669 6c74  50C)\..    .filt
-00018920: 6572 2865 652e 4669 6c74 6572 2e63 616c  er(ee.Filter.cal
-00018930: 656e 6461 7252 616e 6765 2873 7461 7274  endarRange(start
-00018940: 5965 6172 2c65 6e64 5965 6172 2c27 7965  Year,endYear,'ye
-00018950: 6172 2729 295c 0d0a 2020 2020 2e66 696c  ar'))\..    .fil
-00018960: 7465 7228 6565 2e46 696c 7465 722e 6361  ter(ee.Filter.ca
-00018970: 6c65 6e64 6172 5261 6e67 6528 7374 6172  lendarRange(star
-00018980: 744a 756c 6961 6e2c 656e 644a 756c 6961  tJulian,endJulia
-00018990: 6e29 295c 0d0a 2020 2020 2e73 656c 6563  n))\..    .selec
-000189a0: 7428 6d6f 6469 7332 3530 5365 6c65 6374  t(modis250Select
-000189b0: 4261 6e64 732c 6d6f 6469 7332 3530 4261  Bands,modis250Ba
-000189c0: 6e64 4e61 6d65 7329 0d0a 0d0a 0d0a 2020  ndNames)......  
-000189d0: 7432 3530 203d 2065 652e 496d 6167 6543  t250 = ee.ImageC
-000189e0: 6f6c 6c65 6374 696f 6e28 7432 3530 4329  ollection(t250C)
-000189f0: 5c0d 0a20 202e 6669 6c74 6572 2865 652e  \..  .filter(ee.
-00018a00: 4669 6c74 6572 2e63 616c 656e 6461 7252  Filter.calendarR
-00018a10: 616e 6765 2873 7461 7274 5965 6172 2c65  ange(startYear,e
-00018a20: 6e64 5965 6172 2c27 7965 6172 2729 295c  ndYear,'year'))\
-00018a30: 0d0a 2020 2e66 696c 7465 7228 6565 2e46  ..  .filter(ee.F
-00018a40: 696c 7465 722e 6361 6c65 6e64 6172 5261  ilter.calendarRa
-00018a50: 6e67 6528 7374 6172 744a 756c 6961 6e2c  nge(startJulian,
-00018a60: 656e 644a 756c 6961 6e29 295c 0d0a 2020  endJulian))\..  
-00018a70: 2e73 656c 6563 7428 6d6f 6469 7332 3530  .select(modis250
-00018a80: 5365 6c65 6374 4261 6e64 732c 6d6f 6469  SelectBands,modi
-00018a90: 7332 3530 4261 6e64 4e61 6d65 7329 0d0a  s250BandNames)..
-00018aa0: 0d0a 0d0a 2020 6465 6620 6765 7435 3030  ....  def get500
-00018ab0: 2863 293a 0d0a 2020 2020 696d 6167 6573  (c):..    images
-00018ac0: 203d 2065 652e 496d 6167 6543 6f6c 6c65   = ee.ImageColle
-00018ad0: 6374 696f 6e28 6329 5c0d 0a20 2020 2020  ction(c)\..     
-00018ae0: 2020 2020 202e 6669 6c74 6572 2865 652e       .filter(ee.
-00018af0: 4669 6c74 6572 2e63 616c 656e 6461 7252  Filter.calendarR
-00018b00: 616e 6765 2873 7461 7274 5965 6172 2c65  ange(startYear,e
-00018b10: 6e64 5965 6172 2c27 7965 6172 2729 295c  ndYear,'year'))\
-00018b20: 0d0a 2020 2020 2020 2020 2020 2e66 696c  ..          .fil
-00018b30: 7465 7228 6565 2e46 696c 7465 722e 6361  ter(ee.Filter.ca
-00018b40: 6c65 6e64 6172 5261 6e67 6528 7374 6172  lendarRange(star
-00018b50: 744a 756c 6961 6e2c 656e 644a 756c 6961  tJulian,endJulia
-00018b60: 6e29 290d 0a20 2020 2064 6566 2061 7070  n))..    def app
-00018b70: 6c79 5a65 6e69 7468 2869 6d67 293a 0d0a  lyZenith(img):..
-00018b80: 2020 2020 2020 696d 6720 3d20 696d 672e        img = img.
-00018b90: 6d61 736b 2869 6d67 2e6d 6173 6b28 292e  mask(img.mask().
-00018ba0: 416e 6428 696d 672e 7365 6c65 6374 285b  And(img.select([
-00018bb0: 2753 656e 736f 725a 656e 6974 6827 5d29  'SensorZenith'])
-00018bc0: 2e6c 7428 7a65 6e69 7468 5468 7265 7368  .lt(zenithThresh
-00018bd0: 2a31 3030 2929 290d 0a20 2020 2020 2069  *100)))..      i
-00018be0: 6620 6d61 736b 5751 413a 696d 6720 3d20  f maskWQA:img = 
-00018bf0: 6d61 736b 436c 6f75 6473 5751 4128 696d  maskCloudsWQA(im
-00018c00: 6729 0d0a 2020 2020 2020 7265 7475 726e  g)..      return
-00018c10: 2069 6d67 0d0a 2020 2020 234d 6173 6b20   img..    #Mask 
-00018c20: 7069 7865 6c73 2061 626f 7665 2061 2063  pixels above a c
-00018c30: 6572 7461 696e 207a 656e 6974 680d 0a20  ertain zenith.. 
-00018c40: 2020 2069 6620 6461 696c 793a 0d0a 2020     if daily:..  
-00018c50: 2020 2020 6966 206d 6173 6b57 5141 3a70      if maskWQA:p
-00018c60: 7269 6e74 2827 4d61 736b 696e 6720 7769  rint('Masking wi
-00018c70: 7468 2051 4120 6261 6e64 3a27 2c63 290d  th QA band:',c).
-00018c80: 0a20 2020 2020 2069 6d61 6765 7320 3d20  .      images = 
-00018c90: 696d 6167 6573 2e6d 6170 2861 7070 6c79  images.map(apply
-00018ca0: 5a65 6e69 7468 290d 0a0d 0a20 2020 2069  Zenith)....    i
-00018cb0: 6620 6164 644c 6f6f 6b41 6e67 6c65 4261  f addLookAngleBa
-00018cc0: 6e64 733a 0d0a 2020 2020 2020 696d 6167  nds:..      imag
-00018cd0: 6573 203d 2069 6d61 6765 732e 7365 6c65  es = images.sele
-00018ce0: 6374 2865 652e 4c69 7374 286d 6f64 6973  ct(ee.List(modis
-00018cf0: 3530 3053 656c 6563 7442 616e 6473 292e  500SelectBands).
-00018d00: 6361 7428 7669 6577 416e 676c 6542 616e  cat(viewAngleBan
-00018d10: 644e 616d 6573 292c 6565 2e4c 6973 7428  dNames),ee.List(
-00018d20: 6d6f 6469 7335 3030 4261 6e64 4e61 6d65  modis500BandName
-00018d30: 7329 2e63 6174 2876 6965 7741 6e67 6c65  s).cat(viewAngle
-00018d40: 4261 6e64 4e61 6d65 7329 293b 0d0a 2020  BandNames));..  
-00018d50: 2020 656c 7365 3a0d 0a20 2020 2020 2069    else:..      i
-00018d60: 6d61 6765 7320 3d20 696d 6167 6573 2e73  mages = images.s
-00018d70: 656c 6563 7428 6d6f 6469 7335 3030 5365  elect(modis500Se
-00018d80: 6c65 6374 4261 6e64 732c 6d6f 6469 7335  lectBands,modis5
-00018d90: 3030 4261 6e64 4e61 6d65 7329 0d0a 0d0a  00BandNames)....
-00018da0: 2020 2020 7265 7475 726e 2069 6d61 6765      return image
-00018db0: 730d 0a0d 0a0d 0a20 2061 3530 3020 3d20  s......  a500 = 
-00018dc0: 6765 7435 3030 2861 3530 3043 290d 0a20  get500(a500C).. 
-00018dd0: 2074 3530 3020 3d20 6765 7435 3030 2874   t500 = get500(t
-00018de0: 3530 3043 290d 0a0d 0a0d 0a20 2023 4966  500C)......  #If
-00018df0: 2074 6865 726d 616c 2063 6f6c 6c65 6374   thermal collect
-00018e00: 696f 6e20 6973 2077 616e 7465 642c 2070  ion is wanted, p
-00018e10: 756c 6c20 6974 2061 7320 7765 6c6c 0d0a  ull it as well..
-00018e20: 2020 6966 2075 7365 5465 6d70 496e 436c    if useTempInCl
-00018e30: 6f75 644d 6173 6b3a 0d0a 2020 2020 7431  oudMask:..    t1
-00018e40: 3030 3020 3d20 6565 2e49 6d61 6765 436f  000 = ee.ImageCo
-00018e50: 6c6c 6563 7469 6f6e 2874 3130 3030 4329  llection(t1000C)
-00018e60: 5c0d 0a20 2020 2020 2020 2020 2020 202e  \..            .
-00018e70: 6669 6c74 6572 2865 652e 4669 6c74 6572  filter(ee.Filter
-00018e80: 2e63 616c 656e 6461 7252 616e 6765 2873  .calendarRange(s
-00018e90: 7461 7274 5965 6172 2c65 6e64 5965 6172  tartYear,endYear
-00018ea0: 2c27 7965 6172 2729 295c 0d0a 2020 2020  ,'year'))\..    
-00018eb0: 2020 2020 2020 2020 2e66 696c 7465 7228          .filter(
-00018ec0: 6565 2e46 696c 7465 722e 6361 6c65 6e64  ee.Filter.calend
-00018ed0: 6172 5261 6e67 6528 7374 6172 744a 756c  arRange(startJul
-00018ee0: 6961 6e2c 656e 644a 756c 6961 6e29 295c  ian,endJulian))\
-00018ef0: 0d0a 2020 2020 2020 2020 2020 2020 2e73  ..            .s
-00018f00: 656c 6563 7428 5b30 2c38 2c39 5d2c 5b27  elect([0,8,9],['
-00018f10: 7465 6d70 272c 2745 6d69 735f 3331 272c  temp','Emis_31',
-00018f20: 2745 6d69 735f 3332 275d 293b 0d0a 0d0a  'Emis_32']);....
-00018f30: 2020 2020 6131 3030 3020 3d20 6565 2e49      a1000 = ee.I
-00018f40: 6d61 6765 436f 6c6c 6563 7469 6f6e 2861  mageCollection(a
-00018f50: 3130 3030 4329 5c0d 0a20 2020 2020 2020  1000C)\..       
-00018f60: 2020 2020 202e 6669 6c74 6572 2865 652e       .filter(ee.
-00018f70: 4669 6c74 6572 2e63 616c 656e 6461 7252  Filter.calendarR
-00018f80: 616e 6765 2873 7461 7274 5965 6172 2c65  ange(startYear,e
-00018f90: 6e64 5965 6172 2c27 7965 6172 2729 295c  ndYear,'year'))\
-00018fa0: 0d0a 2020 2020 2020 2020 2020 2020 2e66  ..            .f
-00018fb0: 696c 7465 7228 6565 2e46 696c 7465 722e  ilter(ee.Filter.
-00018fc0: 6361 6c65 6e64 6172 5261 6e67 6528 7374  calendarRange(st
-00018fd0: 6172 744a 756c 6961 6e2c 656e 644a 756c  artJulian,endJul
-00018fe0: 6961 6e29 295c 0d0a 2020 2020 2020 2020  ian))\..        
-00018ff0: 2020 2020 2e73 656c 6563 7428 5b30 2c38      .select([0,8
-00019000: 2c39 5d2c 5b27 7465 6d70 272c 2745 6d69  ,9],['temp','Emi
-00019010: 735f 3331 272c 2745 6d69 735f 3332 275d  s_31','Emis_32']
-00019020: 293b 0d0a 0d0a 0d0a 2020 234e 6f77 2061  );......  #Now a
-00019030: 6c6c 2063 6f6c 6c65 6374 696f 6e73 2061  ll collections a
-00019040: 7265 2070 756c 6c65 642c 2073 7461 7274  re pulled, start
-00019050: 206a 6f69 6e69 6e67 2074 6865 6d0d 0a20   joining them.. 
-00019060: 2023 4669 7273 7420 6a6f 696e 2074 6865   #First join the
-00019070: 2032 3530 2061 6e64 2035 3030 206d 2041   250 and 500 m A
-00019080: 7175 610d 0a20 2061 203d 206a 6f69 6e43  qua..  a = joinC
-00019090: 6f6c 6c65 6374 696f 6e73 2861 3235 302c  ollections(a250,
-000190a0: 6135 3030 2c46 616c 7365 290d 0a0d 0a20  a500,False).... 
-000190b0: 2023 5468 656e 2054 6572 7261 0d0a 2020   #Then Terra..  
-000190c0: 7420 3d20 6a6f 696e 436f 6c6c 6563 7469  t = joinCollecti
-000190d0: 6f6e 7328 7432 3530 2c74 3530 302c 4661  ons(t250,t500,Fa
-000190e0: 6c73 6529 0d0a 0d0a 2020 2349 6620 7465  lse)....  #If te
-000190f0: 6d70 2077 6173 2070 756c 6c65 642c 206a  mp was pulled, j
-00019100: 6f69 6e20 7468 6174 2069 6e20 6173 2077  oin that in as w
-00019110: 656c 6c0d 0a20 2023 416c 736f 2073 656c  ell..  #Also sel
-00019120: 6563 7420 7468 6520 6261 6e64 7320 696e  ect the bands in
-00019130: 2061 6e20 4c35 2d6c 696b 6520 6f72 6465   an L5-like orde
-00019140: 7220 616e 6420 6769 7665 2064 6573 6372  r and give descr
-00019150: 6970 7469 7665 206e 616d 6573 0d0a 2020  iptive names..  
-00019160: 6966 2075 7365 5465 6d70 496e 436c 6f75  if useTempInClou
-00019170: 644d 6173 6b3a 0d0a 2020 2020 6120 3d20  dMask:..    a = 
-00019180: 6a6f 696e 436f 6c6c 6563 7469 6f6e 7328  joinCollections(
-00019190: 612c 6131 3030 302c 4661 6c73 6529 0d0a  a,a1000,False)..
-000191a0: 2020 2020 7420 3d20 6a6f 696e 436f 6c6c      t = joinColl
-000191b0: 6563 7469 6f6e 7328 742c 7431 3030 302c  ections(t,t1000,
-000191c0: 4661 6c73 6529 0d0a 0d0a 0d0a 2020 2320  False)......  # 
-000191d0: 2020 7453 656c 6563 744f 7264 6572 203d    tSelectOrder =
-000191e0: 2077 5465 6d70 5365 6c65 6374 4f72 6465   wTempSelectOrde
-000191f0: 720d 0a20 2023 2020 2074 5374 644e 616d  r..  #   tStdNam
-00019200: 6573 203d 2077 5465 6d70 5374 644e 616d  es = wTempStdNam
-00019210: 6573 0d0a 0d0a 2020 2320 2349 6620 6e6f  es....  # #If no
-00019220: 2074 6865 726d 616c 2077 6173 2070 756c   thermal was pul
-00019230: 6c65 642c 206c 6561 7665 2074 6861 7420  led, leave that 
-00019240: 6f75 740d 0a20 2023 2065 6c73 653a 0d0a  out..  # else:..
-00019250: 2020 2320 2020 7453 656c 6563 744f 7264    #   tSelectOrd
-00019260: 6572 203d 2077 6f54 656d 7053 656c 6563  er = woTempSelec
-00019270: 744f 7264 6572 0d0a 2020 2320 2020 7453  tOrder..  #   tS
-00019280: 7464 4e61 6d65 7320 3d20 776f 5465 6d70  tdNames = woTemp
-00019290: 5374 644e 616d 6573 0d0a 0d0a 2020 6120  StdNames....  a 
-000192a0: 3d20 612e 6d61 7028 6c61 6d62 6461 2069  = a.map(lambda i
-000192b0: 6d67 3a69 6d67 2e73 6574 287b 2770 6c61  mg:img.set({'pla
-000192c0: 7466 6f72 6d27 3a27 6171 7561 277d 2929  tform':'aqua'}))
-000192d0: 3b0d 0a20 2074 203d 2074 2e6d 6170 286c  ;..  t = t.map(l
-000192e0: 616d 6264 6120 696d 673a 696d 672e 7365  ambda img:img.se
-000192f0: 7428 7b27 706c 6174 666f 726d 273a 2774  t({'platform':'t
-00019300: 6572 7261 277d 2929 3b0d 0a0d 0a0d 0a20  erra'}));...... 
-00019310: 2069 6628 6461 696c 7929 3a64 6169 6c79   if(daily):daily
-00019320: 5069 6563 6520 3d20 2744 6169 6c79 270d  Piece = 'Daily'.
-00019330: 0a20 2065 6c73 653a 6461 696c 7950 6965  .  else:dailyPie
-00019340: 6365 203d 2027 436f 6d70 6f73 6974 6527  ce = 'Composite'
-00019350: 0d0a 0d0a 2020 6966 2875 7365 5465 6d70  ....  if(useTemp
-00019360: 496e 436c 6f75 644d 6173 6b29 3a74 656d  InCloudMask):tem
-00019370: 7050 6965 6365 203d 2027 7465 6d70 270d  pPiece = 'temp'.
-00019380: 0a20 2065 6c73 653a 7465 6d70 5069 6563  .  else:tempPiec
-00019390: 6520 3d20 276e 6f54 656d 7027 0d0a 2020  e = 'noTemp'..  
-000193a0: 6966 2061 6464 4c6f 6f6b 416e 676c 6542  if addLookAngleB
-000193b0: 616e 6473 3a61 6e67 6c65 5069 6563 6520  ands:anglePiece 
-000193c0: 3d20 2741 6e67 6c65 270d 0a20 2065 6c73  = 'Angle'..  els
-000193d0: 653a 616e 676c 6550 6965 6365 203d 2027  e:anglePiece = '
-000193e0: 4e6f 416e 676c 6527 0d0a 2020 6d75 6c74  NoAngle'..  mult
-000193f0: 4b65 7920 3d20 7465 6d70 5069 6563 652b  Key = tempPiece+
-00019400: 616e 676c 6550 6965 6365 2b64 6169 6c79  anglePiece+daily
-00019410: 5069 6563 650d 0a0d 0a20 206d 756c 7420  Piece....  mult 
-00019420: 3d20 6d75 6c74 4d6f 6469 7344 6963 745b  = multModisDict[
-00019430: 6d75 6c74 4b65 795d 0d0a 2020 6d75 6c74  multKey]..  mult
-00019440: 496d 6167 6520 3d20 6d75 6c74 5b30 5d0d  Image = mult[0].
-00019450: 0a20 206d 756c 744e 616d 6573 203d 206d  .  multNames = m
-00019460: 756c 745b 315d 0d0a 0d0a 2020 234a 6f69  ult[1]....  #Joi
-00019470: 6e20 5465 7272 6120 616e 6420 4171 7561  n Terra and Aqua
-00019480: 0d0a 2020 6a6f 696e 6564 203d 2065 652e  ..  joined = ee.
-00019490: 496d 6167 6543 6f6c 6c65 6374 696f 6e28  ImageCollection(
-000194a0: 612e 6d65 7267 6528 7429 2923 2e73 656c  a.merge(t))#.sel
-000194b0: 6563 7428 7453 656c 6563 744f 7264 6572  ect(tSelectOrder
-000194c0: 2c74 5374 644e 616d 6573 290d 0a0d 0a20  ,tStdNames).... 
-000194d0: 2064 6566 206d 756c 7469 706c 7949 6d67   def multiplyImg
-000194e0: 2869 6d67 293a 0d0a 2020 2020 7265 7475  (img):..    retu
-000194f0: 726e 2069 6d67 2e6d 756c 7469 706c 7928  rn img.multiply(
-00019500: 6d75 6c74 496d 6167 6529 2e66 6c6f 6174  multImage).float
-00019510: 2829 2e73 656c 6563 7428 6d75 6c74 4e61  ().select(multNa
-00019520: 6d65 7329 5c0d 0a20 2020 2020 2020 202e  mes)\..        .
-00019530: 636f 7079 5072 6f70 6572 7469 6573 2869  copyProperties(i
-00019540: 6d67 2c5b 2773 7973 7465 6d3a 7469 6d65  mg,['system:time
-00019550: 5f73 7461 7274 272c 2773 7973 7465 6d3a  _start','system:
-00019560: 7469 6d65 5f65 6e64 272c 2773 7973 7465  time_end','syste
-00019570: 6d3a 696e 6465 7827 5d29 5c0d 0a20 2020  m:index'])\..   
-00019580: 2020 2020 202e 636f 7079 5072 6f70 6572       .copyProper
-00019590: 7469 6573 2869 6d67 290d 0a20 2064 6566  ties(img)..  def
-000195a0: 2073 6574 5265 7361 6d70 6c65 2869 6d67   setResample(img
-000195b0: 293a 0d0a 2020 2020 7265 7475 726e 2069  ):..    return i
-000195c0: 6d67 2e72 6573 616d 706c 6528 7265 7361  mg.resample(resa
-000195d0: 6d70 6c65 4d65 7468 6f64 290d 0a0d 0a20  mpleMethod).... 
-000195e0: 206a 6f69 6e65 6420 3d20 6a6f 696e 6564   joined = joined
-000195f0: 2e6d 6170 286d 756c 7469 706c 7949 6d67  .map(multiplyImg
-00019600: 290d 0a20 2069 6620 2072 6573 616d 706c  )..  if  resampl
-00019610: 654d 6574 686f 6420 696e 205b 2762 696c  eMethod in ['bil
-00019620: 696e 6561 7227 2c27 6269 6375 6269 6327  inear','bicubic'
-00019630: 5d3a 0d0a 2020 2020 7072 696e 7428 2753  ]:..    print('S
-00019640: 6574 7469 6e67 2072 6573 616d 706c 6520  etting resample 
-00019650: 6d65 7468 6f64 2074 6f20 272c 7265 7361  method to ',resa
-00019660: 6d70 6c65 4d65 7468 6f64 290d 0a20 2020  mpleMethod)..   
-00019670: 206a 6f69 6e65 6420 3d20 6a6f 696e 6564   joined = joined
-00019680: 2e6d 6170 2873 6574 5265 7361 6d70 6c65  .map(setResample
-00019690: 290d 0a20 2072 6574 7572 6e20 6a6f 696e  )..  return join
-000196a0: 6564 0d0a 0d0a 0d0a 2346 756e 6374 696f  ed......#Functio
-000196b0: 6e20 746f 2067 6574 2063 6c6f 7564 2c20  n to get cloud, 
-000196c0: 636c 6f75 6420 7368 6164 6f77 2062 7573  cloud shadow bus
-000196d0: 7465 6420 6d6f 6469 7320 696d 6167 6573  ted modis images
-000196e0: 0d0a 2354 616b 6573 2063 6172 6520 6f66  ..#Takes care of
-000196f0: 206d 6174 6368 696e 6720 6469 6666 6572   matching differ
-00019700: 656e 7420 6d6f 6469 7320 636f 6c6c 6563  ent modis collec
-00019710: 7469 6f6e 7320 6173 2077 656c 6c0d 0a64  tions as well..d
-00019720: 6566 2067 6574 5072 6f63 6573 7365 644d  ef getProcessedM
-00019730: 6f64 6973 2873 7461 7274 5965 6172 2c0d  odis(startYear,.
-00019740: 0a20 2020 2020 2020 2020 2020 2065 6e64  .            end
-00019750: 5965 6172 2c0d 0a20 2020 2020 2020 2020  Year,..         
-00019760: 2020 2073 7461 7274 4a75 6c69 616e 2c0d     startJulian,.
-00019770: 0a20 2020 2020 2020 2020 2020 2065 6e64  .            end
-00019780: 4a75 6c69 616e 2c0d 0a20 2020 2020 2020  Julian,..       
-00019790: 2020 2020 207a 656e 6974 6854 6872 6573       zenithThres
-000197a0: 6820 3d20 3930 2c0d 0a20 2020 2020 2020  h = 90,..       
-000197b0: 2020 2020 2061 6464 4c6f 6f6b 416e 676c       addLookAngl
-000197c0: 6542 616e 6473 203d 2054 7275 652c 0d0a  eBands = True,..
-000197d0: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-000197e0: 7943 6c6f 7564 5363 6f72 6520 3d20 5472  yCloudScore = Tr
-000197f0: 7565 2c0d 0a20 2020 2020 2020 2020 2020  ue,..           
-00019800: 2061 7070 6c79 5444 4f4d 203d 2054 7275   applyTDOM = Tru
-00019810: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-00019820: 7573 6554 656d 7049 6e43 6c6f 7564 4d61  useTempInCloudMa
-00019830: 736b 203d 2054 7275 652c 0d0a 2020 2020  sk = True,..    
-00019840: 2020 2020 2020 2020 636c 6f75 6453 636f          cloudSco
-00019850: 7265 5468 7265 7368 203d 2032 302c 0d0a  reThresh = 20,..
-00019860: 2020 2020 2020 2020 2020 2020 7065 7266              perf
-00019870: 6f72 6d43 6c6f 7564 5363 6f72 654f 6666  ormCloudScoreOff
-00019880: 7365 7420 3d20 5472 7565 2c0d 0a20 2020  set = True,..   
-00019890: 2020 2020 2020 2020 2063 6c6f 7564 5363           cloudSc
-000198a0: 6f72 6550 6374 6c20 3d20 3130 2c0d 0a20  orePctl = 10,.. 
-000198b0: 2020 2020 2020 2020 2020 207a 5363 6f72             zScor
-000198c0: 6554 6872 6573 6820 3d20 2d31 2c0d 0a20  eThresh = -1,.. 
-000198d0: 2020 2020 2020 2020 2020 2073 6861 646f             shado
-000198e0: 7753 756d 5468 7265 7368 203d 2030 2e33  wSumThresh = 0.3
-000198f0: 352c 0d0a 2020 2020 2020 2020 2020 2020  5,..            
-00019900: 636f 6e74 7261 6374 5069 7865 6c73 203d  contractPixels =
-00019910: 2030 2c0d 0a20 2020 2020 2020 2020 2020   0,..           
-00019920: 2064 696c 6174 6550 6978 656c 7320 3d20   dilatePixels = 
-00019930: 322e 352c 0d0a 2020 2020 2020 2020 2020  2.5,..          
-00019940: 2020 7368 6164 6f77 5375 6d42 616e 6473    shadowSumBands
-00019950: 203d 205b 276e 6972 272c 2773 7769 7232   = ['nir','swir2
-00019960: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
-00019970: 2072 6573 616d 706c 654d 6574 686f 6420   resampleMethod 
-00019980: 3d20 2762 6963 7562 6963 272c 0d0a 2020  = 'bicubic',..  
-00019990: 2020 2020 2020 2020 2020 7072 6543 6f6d            preCom
-000199a0: 7075 7465 6443 6c6f 7564 5363 6f72 654f  putedCloudScoreO
-000199b0: 6666 7365 7420 3d20 4e6f 6e65 2c0d 0a20  ffset = None,.. 
-000199c0: 2020 2020 2020 2020 2020 2070 7265 436f             preCo
-000199d0: 6d70 7574 6564 5444 4f4d 4952 4d65 616e  mputedTDOMIRMean
-000199e0: 203d 204e 6f6e 652c 0d0a 2020 2020 2020   = None,..      
-000199f0: 2020 2020 2020 7072 6543 6f6d 7075 7465        preCompute
-00019a00: 6454 444f 4d49 5253 7464 4465 7620 3d20  dTDOMIRStdDev = 
-00019a10: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
-00019a20: 2020 2061 6464 546f 4d61 7020 3d20 4661     addToMap = Fa
-00019a30: 6c73 652c 0d0a 2020 2020 2020 2020 2020  lse,..          
-00019a40: 2020 6372 7320 3d20 2745 5053 473a 3433    crs = 'EPSG:43
-00019a50: 3236 272c 0d0a 2020 2020 2020 2020 2020  26',..          
-00019a60: 2020 7363 616c 6520 3d20 3235 302c 0d0a    scale = 250,..
-00019a70: 2020 2020 2020 2020 2020 2020 7472 616e              tran
-00019a80: 7366 6f72 6d20 3d20 4e6f 6e65 293a 0d0a  sform = None):..
-00019a90: 0d0a 2020 6172 6773 203d 2066 6f72 6d61  ..  args = forma
-00019aa0: 7441 7267 7328 6c6f 6361 6c73 2829 290d  tArgs(locals()).
-00019ab0: 0a20 2069 6620 2761 7267 7327 2069 6e20  .  if 'args' in 
-00019ac0: 6172 6773 2e6b 6579 7328 293a 0d0a 2020  args.keys():..  
-00019ad0: 2020 6465 6c20 6172 6773 5b27 6172 6773    del args['args
-00019ae0: 275d 0d0a 0d0a 2020 2347 6574 206a 6f69  ']....  #Get joi
-00019af0: 6e65 6420 6d6f 6469 7320 636f 6c6c 6563  ned modis collec
-00019b00: 7469 6f6e 0d0a 2020 6d6f 6469 7349 6d61  tion..  modisIma
-00019b10: 6765 7320 3d20 6765 744d 6f64 6973 4461  ges = getModisDa
-00019b20: 7461 2873 7461 7274 5965 6172 2c65 6e64  ta(startYear,end
-00019b30: 5965 6172 2c73 7461 7274 4a75 6c69 616e  Year,startJulian
-00019b40: 2c65 6e64 4a75 6c69 616e 2c0d 0a20 2020  ,endJulian,..   
-00019b50: 2064 6169 6c79 203d 2054 7275 652c 0d0a   daily = True,..
-00019b60: 2020 2020 6d61 736b 5751 4120 3d20 4661      maskWQA = Fa
-00019b70: 6c73 652c 0d0a 2020 2020 7a65 6e69 7468  lse,..    zenith
-00019b80: 5468 7265 7368 203d 207a 656e 6974 6854  Thresh = zenithT
-00019b90: 6872 6573 682c 0d0a 2020 2020 7573 6554  hresh,..    useT
-00019ba0: 656d 7049 6e43 6c6f 7564 4d61 736b 203d  empInCloudMask =
-00019bb0: 2075 7365 5465 6d70 496e 436c 6f75 644d   useTempInCloudM
-00019bc0: 6173 6b2c 0d0a 2020 2020 6164 644c 6f6f  ask,..    addLoo
-00019bd0: 6b41 6e67 6c65 4261 6e64 7320 3d20 6164  kAngleBands = ad
-00019be0: 644c 6f6f 6b41 6e67 6c65 4261 6e64 732c  dLookAngleBands,
-00019bf0: 0d0a 2020 2020 7265 7361 6d70 6c65 4d65  ..    resampleMe
-00019c00: 7468 6f64 203d 2020 7265 7361 6d70 6c65  thod =  resample
-00019c10: 4d65 7468 6f64 290d 0a0d 0a20 2069 6620  Method)....  if 
-00019c20: 6164 6454 6f4d 6170 3a0d 0a20 2020 204d  addToMap:..    M
-00019c30: 6170 2e61 6464 4c61 7965 7228 6d6f 6469  ap.addLayer(modi
-00019c40: 7349 6d61 6765 732e 6d65 6469 616e 2829  sImages.median()
-00019c50: 2e72 6570 726f 6a65 6374 2863 7273 2c74  .reproject(crs,t
-00019c60: 7261 6e73 666f 726d 2c73 6361 6c65 292c  ransform,scale),
-00019c70: 7669 7a50 6172 616d 7346 616c 7365 2c27  vizParamsFalse,'
-00019c80: 5261 7720 4d65 6469 616e 2729 0d0a 0d0a  Raw Median')....
-00019c90: 0d0a 2020 6966 2061 7070 6c79 436c 6f75  ..  if applyClou
-00019ca0: 6453 636f 7265 3a0d 0a20 2020 2070 7269  dScore:..    pri
-00019cb0: 6e74 2827 4170 706c 7969 6e67 2063 6c6f  nt('Applying clo
-00019cc0: 7564 5363 6f72 6527 290d 0a20 2020 206d  udScore')..    m
-00019cd0: 6f64 6973 496d 6167 6573 203d 2061 7070  odisImages = app
-00019ce0: 6c79 436c 6f75 6453 636f 7265 416c 676f  lyCloudScoreAlgo
-00019cf0: 7269 7468 6d28 6d6f 6469 7349 6d61 6765  rithm(modisImage
-00019d00: 732c 6d6f 6469 7343 6c6f 7564 5363 6f72  s,modisCloudScor
-00019d10: 652c 636c 6f75 6453 636f 7265 5468 7265  e,cloudScoreThre
-00019d20: 7368 2c63 6c6f 7564 5363 6f72 6550 6374  sh,cloudScorePct
-00019d30: 6c2c 636f 6e74 7261 6374 5069 7865 6c73  l,contractPixels
-00019d40: 2c64 696c 6174 6550 6978 656c 732c 7065  ,dilatePixels,pe
-00019d50: 7266 6f72 6d43 6c6f 7564 5363 6f72 654f  rformCloudScoreO
-00019d60: 6666 7365 742c 7072 6543 6f6d 7075 7465  ffset,preCompute
-00019d70: 6443 6c6f 7564 5363 6f72 654f 6666 7365  dCloudScoreOffse
-00019d80: 7429 0d0a 0d0a 2020 2020 6966 2061 6464  t)....    if add
-00019d90: 546f 4d61 703a 0d0a 2020 2020 2020 4d61  ToMap:..      Ma
-00019da0: 702e 6164 644c 6179 6572 286d 6f64 6973  p.addLayer(modis
-00019db0: 496d 6167 6573 2e6d 6564 6961 6e28 292e  Images.median().
-00019dc0: 7265 7072 6f6a 6563 7428 6372 732c 7472  reproject(crs,tr
-00019dd0: 616e 7366 6f72 6d2c 7363 616c 6529 2c76  ansform,scale),v
-00019de0: 697a 5061 7261 6d73 4661 6c73 652c 2743  izParamsFalse,'C
-00019df0: 6c6f 7564 204d 6173 6b65 6420 4d65 6469  loud Masked Medi
-00019e00: 616e 272c 4661 6c73 6529 0d0a 2020 2020  an',False)..    
-00019e10: 2020 4d61 702e 6164 644c 6179 6572 286d    Map.addLayer(m
-00019e20: 6f64 6973 496d 6167 6573 2e6d 696e 2829  odisImages.min()
-00019e30: 2e72 6570 726f 6a65 6374 2863 7273 2c74  .reproject(crs,t
-00019e40: 7261 6e73 666f 726d 2c73 6361 6c65 292c  ransform,scale),
-00019e50: 7669 7a50 6172 616d 7346 616c 7365 2c27  vizParamsFalse,'
-00019e60: 436c 6f75 6420 4d61 736b 6564 204d 696e  Cloud Masked Min
-00019e70: 272c 4661 6c73 6529 0d0a 0d0a 2020 6966  ',False)....  if
-00019e80: 2061 7070 6c79 5444 4f4d 3a0d 0a20 2020   applyTDOM:..   
-00019e90: 2070 7269 6e74 2827 4170 706c 7969 6e67   print('Applying
-00019ea0: 2054 444f 4d27 290d 0a20 2020 2023 4669   TDOM')..    #Fi
-00019eb0: 6e64 2061 6e64 206d 6173 6b20 6f75 7420  nd and mask out 
-00019ec0: 6461 726b 206f 7574 6c69 6572 730d 0a20  dark outliers.. 
-00019ed0: 2020 206d 6f64 6973 496d 6167 6573 203d     modisImages =
-00019ee0: 2073 696d 706c 6554 444f 4d32 286d 6f64   simpleTDOM2(mod
-00019ef0: 6973 496d 6167 6573 2c7a 5363 6f72 6554  isImages,zScoreT
-00019f00: 6872 6573 682c 7368 6164 6f77 5375 6d54  hresh,shadowSumT
-00019f10: 6872 6573 682c 636f 6e74 7261 6374 5069  hresh,contractPi
-00019f20: 7865 6c73 2c64 696c 6174 6550 6978 656c  xels,dilatePixel
-00019f30: 732c 7368 6164 6f77 5375 6d42 616e 6473  s,shadowSumBands
-00019f40: 2c70 7265 436f 6d70 7574 6564 5444 4f4d  ,preComputedTDOM
-00019f50: 4952 4d65 616e 2c70 7265 436f 6d70 7574  IRMean,preComput
-00019f60: 6564 5444 4f4d 4952 5374 6444 6576 290d  edTDOMIRStdDev).
-00019f70: 0a0d 0a20 2020 2069 6620 6164 6454 6f4d  ...    if addToM
-00019f80: 6170 3a0d 0a20 2020 2020 204d 6170 2e61  ap:..      Map.a
-00019f90: 6464 4c61 7965 7228 6d6f 6469 7349 6d61  ddLayer(modisIma
-00019fa0: 6765 732e 6d65 6469 616e 2829 2e72 6570  ges.median().rep
-00019fb0: 726f 6a65 6374 2863 7273 2c74 7261 6e73  roject(crs,trans
-00019fc0: 666f 726d 2c73 6361 6c65 292c 7669 7a50  form,scale),vizP
-00019fd0: 6172 616d 7346 616c 7365 2c27 436c 6f75  aramsFalse,'Clou
-00019fe0: 642f 436c 6f75 6420 5368 6164 6f77 204d  d/Cloud Shadow M
-00019ff0: 6173 6b65 6420 4d65 6469 616e 272c 4661  asked Median',Fa
-0001a000: 6c73 6529 0d0a 2020 2020 2020 4d61 702e  lse)..      Map.
-0001a010: 6164 644c 6179 6572 286d 6f64 6973 496d  addLayer(modisIm
-0001a020: 6167 6573 2e6d 696e 2829 2e72 6570 726f  ages.min().repro
-0001a030: 6a65 6374 2863 7273 2c74 7261 6e73 666f  ject(crs,transfo
-0001a040: 726d 2c73 6361 6c65 292c 7669 7a50 6172  rm,scale),vizPar
-0001a050: 616d 7346 616c 7365 2c27 436c 6f75 642f  amsFalse,'Cloud/
-0001a060: 436c 6f75 6420 5368 6164 6f77 204d 6173  Cloud Shadow Mas
-0001a070: 6b65 6420 4d69 6e27 2c46 616c 7365 290d  ked Min',False).
-0001a080: 0a0d 0a20 206d 6f64 6973 496d 6167 6573  ...  modisImages
-0001a090: 203d 206d 6f64 6973 496d 6167 6573 2e6d   = modisImages.m
-0001a0a0: 6170 2873 696d 706c 6541 6464 496e 6469  ap(simpleAddIndi
-0001a0b0: 6365 7329 0d0a 2020 6d6f 6469 7349 6d61  ces)..  modisIma
-0001a0c0: 6765 7320 3d20 6d6f 6469 7349 6d61 6765  ges = modisImage
-0001a0d0: 732e 6d61 7028 6c61 6d62 6461 2069 6d67  s.map(lambda img
-0001a0e0: 3a20 696d 672e 666c 6f61 7428 2929 0d0a  : img.float())..
-0001a0f0: 2020 7265 7475 726e 206d 6f64 6973 496d    return modisIm
-0001a100: 6167 6573 2e73 6574 2861 7267 7329 0d0a  ages.set(args)..
-0001a110: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a120: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a130: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a140: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a150: 2323 2323 2323 2323 230d 0a23 4675 6e63  #########..#Func
-0001a160: 7469 6f6e 2074 6f20 7461 6b65 2069 6d61  tion to take ima
-0001a170: 6765 7320 616e 6420 6372 6561 7465 2061  ges and create a
-0001a180: 206d 6564 6961 6e20 636f 6d70 6f73 6974   median composit
-0001a190: 6520 6576 6572 7920 6e20 6461 7973 0d0a  e every n days..
-0001a1a0: 6465 6620 6e44 6179 436f 6d70 6f73 6974  def nDayComposit
-0001a1b0: 6573 2869 6d61 6765 732c 7374 6172 7459  es(images,startY
-0001a1c0: 6561 722c 656e 6459 6561 722c 7374 6172  ear,endYear,star
-0001a1d0: 744a 756c 6961 6e2c 656e 644a 756c 6961  tJulian,endJulia
-0001a1e0: 6e2c 636f 6d70 6f73 6974 6550 6572 696f  n,compositePerio
-0001a1f0: 6429 3a0d 0a0d 0a20 2023 6372 6561 7465  d):....  #create
-0001a200: 2064 756d 6d79 2069 6d61 6765 2066 6f72   dummy image for
-0001a210: 2077 6974 6820 6e6f 2076 616c 7565 730d   with no values.
-0001a220: 0a20 2064 756d 6d79 496d 6167 6520 3d20  .  dummyImage = 
-0001a230: 6565 2e49 6d61 6765 2869 6d61 6765 732e  ee.Image(images.
-0001a240: 6669 7273 7428 2929 0d0a 0d0a 2020 2363  first())....  #c
-0001a250: 6f6e 7665 7274 2074 6f20 636f 6d70 6f73  onvert to compos
-0001a260: 6974 6573 2061 7320 6465 6669 6e65 6420  ites as defined 
-0001a270: 6162 6f76 650d 0a20 2064 6566 2067 6574  above..  def get
-0001a280: 5972 496d 6167 6573 2879 7229 3a0d 0a20  YrImages(yr):.. 
-0001a290: 2020 2023 7461 6b65 2074 6865 2079 6561     #take the yea
-0001a2a0: 7220 6f66 2074 6865 2069 6d61 6765 0d0a  r of the image..
-0001a2b0: 2020 2020 7972 203d 2065 652e 4e75 6d62      yr = ee.Numb
-0001a2c0: 6572 2879 7229 2e69 6e74 3136 2829 0d0a  er(yr).int16()..
-0001a2d0: 2020 2020 2366 696c 7465 7220 6f75 7420      #filter out 
-0001a2e0: 696d 6167 6573 2066 6f72 2074 6865 2079  images for the y
-0001a2f0: 6561 720d 0a20 2020 2079 7249 6d61 6765  ear..    yrImage
-0001a300: 7320 3d20 696d 6167 6573 2e66 696c 7465  s = images.filte
-0001a310: 7228 6565 2e46 696c 7465 722e 6361 6c65  r(ee.Filter.cale
-0001a320: 6e64 6172 5261 6e67 6528 7972 2c79 722c  ndarRange(yr,yr,
-0001a330: 2779 6561 7227 2929 0d0a 0d0a 2020 2020  'year'))....    
-0001a340: 2375 7365 2064 756d 6d79 2069 6d61 6765  #use dummy image
-0001a350: 2074 6f20 6669 6c6c 2069 6e20 6761 7073   to fill in gaps
-0001a360: 2066 6f72 2047 4545 2070 726f 6365 7373   for GEE process
-0001a370: 696e 670d 0a20 2020 2079 7249 6d61 6765  ing..    yrImage
-0001a380: 7320 3d20 6669 6c6c 456d 7074 7943 6f6c  s = fillEmptyCol
-0001a390: 6c65 6374 696f 6e73 2879 7249 6d61 6765  lections(yrImage
-0001a3a0: 732c 6475 6d6d 7949 6d61 6765 290d 0a20  s,dummyImage).. 
-0001a3b0: 2020 2072 6574 7572 6e20 7972 496d 6167     return yrImag
-0001a3c0: 6573 0d0a 0d0a 2020 2347 6574 2069 6d61  es....  #Get ima
-0001a3d0: 6765 7320 666f 7220 6120 7370 6563 6966  ges for a specif
-0001a3e0: 6965 6420 7374 6172 7420 6461 790d 0a20  ied start day.. 
-0001a3f0: 2064 6566 2067 6574 4a64 496d 6167 6573   def getJdImages
-0001a400: 2879 722c 7972 496d 6167 6573 2c73 7461  (yr,yrImages,sta
-0001a410: 7274 293a 0d0a 2020 2020 7972 203d 2065  rt):..    yr = e
-0001a420: 652e 4e75 6d62 6572 2879 7229 2e69 6e74  e.Number(yr).int
-0001a430: 3136 2829 0d0a 2020 2020 7374 6172 7420  16()..    start 
-0001a440: 3d20 6565 2e4e 756d 6265 7228 7374 6172  = ee.Number(star
-0001a450: 7429 2e69 6e74 3136 2829 0d0a 2020 2020  t).int16()..    
-0001a460: 6461 7465 203d 2065 652e 4461 7465 2e66  date = ee.Date.f
-0001a470: 726f 6d59 4d44 2879 722c 312c 3129 2e61  romYMD(yr,1,1).a
-0001a480: 6476 616e 6365 2873 7461 7274 2e73 7562  dvance(start.sub
-0001a490: 7472 6163 7428 3129 2c27 6461 7927 290d  tract(1),'day').
-0001a4a0: 0a20 2020 2069 6e64 6578 203d 2064 6174  .    index = dat
-0001a4b0: 652e 666f 726d 6174 2827 7979 7979 2d4d  e.format('yyyy-M
-0001a4c0: 4d2d 6464 2729 0d0a 2020 2020 656e 6420  M-dd')..    end 
-0001a4d0: 3d20 7374 6172 742e 6164 6428 636f 6d70  = start.add(comp
-0001a4e0: 6f73 6974 6550 6572 696f 642d 3129 2e69  ositePeriod-1).i
-0001a4f0: 6e74 3136 2829 0d0a 2020 2020 6a64 496d  nt16()..    jdIm
-0001a500: 6167 6573 203d 2079 7249 6d61 6765 732e  ages = yrImages.
-0001a510: 6669 6c74 6572 2865 652e 4669 6c74 6572  filter(ee.Filter
-0001a520: 2e63 616c 656e 6461 7252 616e 6765 2873  .calendarRange(s
-0001a530: 7461 7274 2c65 6e64 2929 0d0a 2020 2020  tart,end))..    
-0001a540: 6a64 496d 6167 6573 203d 2066 696c 6c45  jdImages = fillE
-0001a550: 6d70 7479 436f 6c6c 6563 7469 6f6e 7328  mptyCollections(
-0001a560: 6a64 496d 6167 6573 2c64 756d 6d79 496d  jdImages,dummyIm
-0001a570: 6167 6529 0d0a 2020 2020 636f 6d70 6f73  age)..    compos
-0001a580: 6974 6520 3d20 6a64 496d 6167 6573 2e6d  ite = jdImages.m
-0001a590: 6564 6961 6e28 290d 0a20 2020 2072 6574  edian()..    ret
-0001a5a0: 7572 6e20 636f 6d70 6f73 6974 652e 7365  urn composite.se
-0001a5b0: 7428 7b27 7379 7374 656d 3a69 6e64 6578  t({'system:index
-0001a5c0: 273a 696e 6465 782c 2773 7973 7465 6d3a  ':index,'system:
-0001a5d0: 7469 6d65 5f73 7461 7274 273a 6461 7465  time_start':date
-0001a5e0: 2e6d 696c 6c69 7328 297d 290d 0a0d 0a20  .millis()}).... 
-0001a5f0: 2023 5365 7420 7570 2077 7261 7070 6572   #Set up wrapper
-0001a600: 730d 0a20 2064 6566 206a 6457 7261 7070  s..  def jdWrapp
-0001a610: 6572 2879 722c 7972 496d 6167 6573 293a  er(yr,yrImages):
-0001a620: 0d0a 2020 2020 7265 7475 726e 2065 652e  ..    return ee.
-0001a630: 4665 6174 7572 6543 6f6c 6c65 6374 696f  FeatureCollectio
-0001a640: 6e28 6565 2e4c 6973 742e 7365 7175 656e  n(ee.List.sequen
-0001a650: 6365 2873 7461 7274 4a75 6c69 616e 2c65  ce(startJulian,e
-0001a660: 6e64 4a75 6c69 616e 2c63 6f6d 706f 7369  ndJulian,composi
-0001a670: 7465 5065 7269 6f64 292e 6d61 7028 6c61  tePeriod).map(la
-0001a680: 6d62 6461 2073 7461 7274 3a20 6765 744a  mbda start: getJ
-0001a690: 6449 6d61 6765 7328 7972 2c79 7249 6d61  dImages(yr,yrIma
-0001a6a0: 6765 732c 7374 6172 7429 2929 0d0a 2020  ges,start)))..  
-0001a6b0: 6465 6620 7972 5772 6170 7065 7228 7972  def yrWrapper(yr
-0001a6c0: 293a 0d0a 2020 2020 7972 496d 6167 6573  ):..    yrImages
-0001a6d0: 203d 2067 6574 5972 496d 6167 6573 2879   = getYrImages(y
-0001a6e0: 7229 0d0a 2020 2020 7265 7475 726e 206a  r)..    return j
-0001a6f0: 6457 7261 7070 6572 2879 722c 7972 496d  dWrapper(yr,yrIm
-0001a700: 6167 6573 290d 0a0d 0a20 2063 6f6d 706f  ages)....  compo
-0001a710: 7369 7465 7320 3d20 6565 2e46 6561 7475  sites = ee.Featu
-0001a720: 7265 436f 6c6c 6563 7469 6f6e 2865 652e  reCollection(ee.
-0001a730: 4c69 7374 2e73 6571 7565 6e63 6528 7374  List.sequence(st
-0001a740: 6172 7459 6561 722c 656e 6459 6561 7229  artYear,endYear)
-0001a750: 2e6d 6170 286c 616d 6264 6120 7972 3a79  .map(lambda yr:y
-0001a760: 7257 7261 7070 6572 2879 7229 2929 0d0a  rWrapper(yr)))..
-0001a770: 2020 2372 6574 7572 6e20 7468 6520 636f    #return the co
-0001a780: 6d70 6f73 6974 6573 2061 7320 616e 2069  mposites as an i
-0001a790: 6d61 6765 2063 6f6c 6c65 6374 696f 6e0d  mage collection.
-0001a7a0: 0a20 2063 6f6d 706f 7369 7465 7320 3d20  .  composites = 
-0001a7b0: 6565 2e49 6d61 6765 436f 6c6c 6563 7469  ee.ImageCollecti
-0001a7c0: 6f6e 2863 6f6d 706f 7369 7465 732e 666c  on(composites.fl
-0001a7d0: 6174 7465 6e28 2929 3b0d 0a0d 0a20 2072  atten());....  r
-0001a7e0: 6574 7572 6e20 636f 6d70 6f73 6974 6573  eturn composites
-0001a7f0: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
+00018450: 2323 2323 2323 230d 0a23 4675 6e63 7469  #######..#Functi
+00018460: 6f6e 2074 6f20 6765 7420 4d4f 4449 5320  on to get MODIS 
+00018470: 6461 7461 2066 726f 6d20 7661 7269 6f75  data from variou
+00018480: 7320 636f 6c6c 6563 7469 6f6e 730d 0a23  s collections..#
+00018490: 5769 6c6c 2070 756c 6c20 6672 6f6d 2064  Will pull from d
+000184a0: 6169 6c79 206f 7220 382d 6461 7920 636f  aily or 8-day co
+000184b0: 6d70 6f73 6974 6520 636f 6c6c 6563 7469  mposite collecti
+000184c0: 6f6e 7320 6261 7365 6420 6f6e 2074 6865  ons based on the
+000184d0: 2062 6f6f 6c65 616e 2076 6172 6961 626c   boolean variabl
+000184e0: 6520 2264 6169 6c79 220d 0a64 6566 2067  e "daily"..def g
+000184f0: 6574 4d6f 6469 7344 6174 6128 7374 6172  etModisData(star
+00018500: 7459 6561 722c 656e 6459 6561 722c 7374  tYear,endYear,st
+00018510: 6172 744a 756c 6961 6e2c 656e 644a 756c  artJulian,endJul
+00018520: 6961 6e2c 6461 696c 7920 3d20 4661 6c73  ian,daily = Fals
+00018530: 652c 6d61 736b 5751 4120 3d20 4661 6c73  e,maskWQA = Fals
+00018540: 652c 7a65 6e69 7468 5468 7265 7368 203d  e,zenithThresh =
+00018550: 2039 302c 7573 6554 656d 7049 6e43 6c6f   90,useTempInClo
+00018560: 7564 4d61 736b 203d 2054 7275 652c 6164  udMask = True,ad
+00018570: 644c 6f6f 6b41 6e67 6c65 4261 6e64 7320  dLookAngleBands 
+00018580: 3d20 4661 6c73 652c 7265 7361 6d70 6c65  = False,resample
+00018590: 4d65 7468 6f64 203d 2027 6e65 6172 2729  Method = 'near')
+000185a0: 3a0d 0a0d 0a20 2023 4669 6e64 2077 6869  :....  #Find whi
+000185b0: 6368 2063 6f6c 6c65 6374 696f 6e73 2074  ch collections t
+000185c0: 6f20 7075 6c6c 2066 726f 6d20 6261 7365  o pull from base
+000185d0: 6420 6f6e 2064 6169 6c79 206f 7220 382d  d on daily or 8-
+000185e0: 6461 790d 0a20 2069 6620 6461 696c 7920  day..  if daily 
+000185f0: 3d3d 2046 616c 7365 3a0d 0a20 2020 2061  == False:..    a
+00018600: 3235 3043 203d 206d 6f64 6973 4344 6963  250C = modisCDic
+00018610: 745b 2765 6967 6874 4461 7953 5232 3530  t['eightDaySR250
+00018620: 4127 5d0d 0a20 2020 2074 3235 3043 203d  A']..    t250C =
+00018630: 206d 6f64 6973 4344 6963 745b 2765 6967   modisCDict['eig
+00018640: 6874 4461 7953 5232 3530 5427 5d0d 0a20  htDaySR250T'].. 
+00018650: 2020 2061 3530 3043 203d 206d 6f64 6973     a500C = modis
+00018660: 4344 6963 745b 2765 6967 6874 4461 7953  CDict['eightDayS
+00018670: 5235 3030 4127 5d0d 0a20 2020 2074 3530  R500A']..    t50
+00018680: 3043 203d 206d 6f64 6973 4344 6963 745b  0C = modisCDict[
+00018690: 2765 6967 6874 4461 7953 5235 3030 5427  'eightDaySR500T'
+000186a0: 5d0d 0a20 2020 2061 3130 3030 4320 3d20  ]..    a1000C = 
+000186b0: 6d6f 6469 7343 4469 6374 5b27 6569 6768  modisCDict['eigh
+000186c0: 7444 6179 4c53 5431 3030 3041 275d 0d0a  tDayLST1000A']..
+000186d0: 2020 2020 7431 3030 3043 203d 206d 6f64      t1000C = mod
+000186e0: 6973 4344 6963 745b 2765 6967 6874 4461  isCDict['eightDa
+000186f0: 794c 5354 3130 3030 5427 5d0d 0a20 2020  yLST1000T']..   
+00018700: 2076 6965 7741 6e67 6c65 4261 6e64 4e61   viewAngleBandNa
+00018710: 6d65 7320 3d20 636f 6d70 6f73 6974 6556  mes = compositeV
+00018720: 6965 7741 6e67 6c65 4261 6e64 4e61 6d65  iewAngleBandName
+00018730: 733b 0d0a 2020 656c 7365 3a0d 0a20 2020  s;..  else:..   
+00018740: 2061 3235 3043 203d 206d 6f64 6973 4344   a250C = modisCD
+00018750: 6963 745b 2764 6169 6c79 5352 3235 3041  ict['dailySR250A
+00018760: 275d 0d0a 2020 2020 7432 3530 4320 3d20  ']..    t250C = 
+00018770: 6d6f 6469 7343 4469 6374 5b27 6461 696c  modisCDict['dail
+00018780: 7953 5232 3530 5427 5d0d 0a20 2020 2061  ySR250T']..    a
+00018790: 3530 3043 203d 206d 6f64 6973 4344 6963  500C = modisCDic
+000187a0: 745b 2764 6169 6c79 5352 3530 3041 275d  t['dailySR500A']
+000187b0: 0d0a 2020 2020 7435 3030 4320 3d20 6d6f  ..    t500C = mo
+000187c0: 6469 7343 4469 6374 5b27 6461 696c 7953  disCDict['dailyS
+000187d0: 5235 3030 5427 5d0d 0a20 2020 2061 3130  R500T']..    a10
+000187e0: 3030 4320 3d20 6d6f 6469 7343 4469 6374  00C = modisCDict
+000187f0: 5b27 6461 696c 794c 5354 3130 3030 4127  ['dailyLST1000A'
+00018800: 5d0d 0a20 2020 2074 3130 3030 4320 3d20  ]..    t1000C = 
+00018810: 6d6f 6469 7343 4469 6374 5b27 6461 696c  modisCDict['dail
+00018820: 794c 5354 3130 3030 5427 5d0d 0a20 2020  yLST1000T']..   
+00018830: 2076 6965 7741 6e67 6c65 4261 6e64 4e61   viewAngleBandNa
+00018840: 6d65 7320 3d20 6461 696c 7956 6965 7741  mes = dailyViewA
+00018850: 6e67 6c65 4261 6e64 4e61 6d65 733b 0d0a  ngleBandNames;..
+00018860: 0d0a 2020 2350 756c 6c20 696d 6167 6573  ..  #Pull images
+00018870: 2066 726f 6d20 6561 6368 206f 6620 7468   from each of th
+00018880: 6520 636f 6c6c 6563 7469 6f6e 730d 0a20  e collections.. 
+00018890: 2061 3235 3020 3d20 6565 2e49 6d61 6765   a250 = ee.Image
+000188a0: 436f 6c6c 6563 7469 6f6e 2861 3235 3043  Collection(a250C
+000188b0: 295c 0d0a 2020 2020 2e66 696c 7465 7228  )\..    .filter(
+000188c0: 6565 2e46 696c 7465 722e 6361 6c65 6e64  ee.Filter.calend
+000188d0: 6172 5261 6e67 6528 7374 6172 7459 6561  arRange(startYea
+000188e0: 722c 656e 6459 6561 722c 2779 6561 7227  r,endYear,'year'
+000188f0: 2929 5c0d 0a20 2020 202e 6669 6c74 6572  ))\..    .filter
+00018900: 2865 652e 4669 6c74 6572 2e63 616c 656e  (ee.Filter.calen
+00018910: 6461 7252 616e 6765 2873 7461 7274 4a75  darRange(startJu
+00018920: 6c69 616e 2c65 6e64 4a75 6c69 616e 2929  lian,endJulian))
+00018930: 5c0d 0a20 2020 202e 7365 6c65 6374 286d  \..    .select(m
+00018940: 6f64 6973 3235 3053 656c 6563 7442 616e  odis250SelectBan
+00018950: 6473 2c6d 6f64 6973 3235 3042 616e 644e  ds,modis250BandN
+00018960: 616d 6573 290d 0a0d 0a0d 0a20 2074 3235  ames)......  t25
+00018970: 3020 3d20 6565 2e49 6d61 6765 436f 6c6c  0 = ee.ImageColl
+00018980: 6563 7469 6f6e 2874 3235 3043 295c 0d0a  ection(t250C)\..
+00018990: 2020 2e66 696c 7465 7228 6565 2e46 696c    .filter(ee.Fil
+000189a0: 7465 722e 6361 6c65 6e64 6172 5261 6e67  ter.calendarRang
+000189b0: 6528 7374 6172 7459 6561 722c 656e 6459  e(startYear,endY
+000189c0: 6561 722c 2779 6561 7227 2929 5c0d 0a20  ear,'year'))\.. 
+000189d0: 202e 6669 6c74 6572 2865 652e 4669 6c74   .filter(ee.Filt
+000189e0: 6572 2e63 616c 656e 6461 7252 616e 6765  er.calendarRange
+000189f0: 2873 7461 7274 4a75 6c69 616e 2c65 6e64  (startJulian,end
+00018a00: 4a75 6c69 616e 2929 5c0d 0a20 202e 7365  Julian))\..  .se
+00018a10: 6c65 6374 286d 6f64 6973 3235 3053 656c  lect(modis250Sel
+00018a20: 6563 7442 616e 6473 2c6d 6f64 6973 3235  ectBands,modis25
+00018a30: 3042 616e 644e 616d 6573 290d 0a0d 0a0d  0BandNames).....
+00018a40: 0a20 2064 6566 2067 6574 3530 3028 6329  .  def get500(c)
+00018a50: 3a0d 0a20 2020 2069 6d61 6765 7320 3d20  :..    images = 
+00018a60: 6565 2e49 6d61 6765 436f 6c6c 6563 7469  ee.ImageCollecti
+00018a70: 6f6e 2863 295c 0d0a 2020 2020 2020 2020  on(c)\..        
+00018a80: 2020 2e66 696c 7465 7228 6565 2e46 696c    .filter(ee.Fil
+00018a90: 7465 722e 6361 6c65 6e64 6172 5261 6e67  ter.calendarRang
+00018aa0: 6528 7374 6172 7459 6561 722c 656e 6459  e(startYear,endY
+00018ab0: 6561 722c 2779 6561 7227 2929 5c0d 0a20  ear,'year'))\.. 
+00018ac0: 2020 2020 2020 2020 202e 6669 6c74 6572           .filter
+00018ad0: 2865 652e 4669 6c74 6572 2e63 616c 656e  (ee.Filter.calen
+00018ae0: 6461 7252 616e 6765 2873 7461 7274 4a75  darRange(startJu
+00018af0: 6c69 616e 2c65 6e64 4a75 6c69 616e 2929  lian,endJulian))
+00018b00: 0d0a 2020 2020 6465 6620 6170 706c 795a  ..    def applyZ
+00018b10: 656e 6974 6828 696d 6729 3a0d 0a20 2020  enith(img):..   
+00018b20: 2020 2069 6d67 203d 2069 6d67 2e6d 6173     img = img.mas
+00018b30: 6b28 696d 672e 6d61 736b 2829 2e41 6e64  k(img.mask().And
+00018b40: 2869 6d67 2e73 656c 6563 7428 5b27 5365  (img.select(['Se
+00018b50: 6e73 6f72 5a65 6e69 7468 275d 292e 6c74  nsorZenith']).lt
+00018b60: 287a 656e 6974 6854 6872 6573 682a 3130  (zenithThresh*10
+00018b70: 3029 2929 0d0a 2020 2020 2020 6966 206d  0)))..      if m
+00018b80: 6173 6b57 5141 3a69 6d67 203d 206d 6173  askWQA:img = mas
+00018b90: 6b43 6c6f 7564 7357 5141 2869 6d67 290d  kCloudsWQA(img).
+00018ba0: 0a20 2020 2020 2072 6574 7572 6e20 696d  .      return im
+00018bb0: 670d 0a20 2020 2023 4d61 736b 2070 6978  g..    #Mask pix
+00018bc0: 656c 7320 6162 6f76 6520 6120 6365 7274  els above a cert
+00018bd0: 6169 6e20 7a65 6e69 7468 0d0a 2020 2020  ain zenith..    
+00018be0: 6966 2064 6169 6c79 3a0d 0a20 2020 2020  if daily:..     
+00018bf0: 2069 6620 6d61 736b 5751 413a 7072 696e   if maskWQA:prin
+00018c00: 7428 274d 6173 6b69 6e67 2077 6974 6820  t('Masking with 
+00018c10: 5141 2062 616e 643a 272c 6329 0d0a 2020  QA band:',c)..  
+00018c20: 2020 2020 696d 6167 6573 203d 2069 6d61      images = ima
+00018c30: 6765 732e 6d61 7028 6170 706c 795a 656e  ges.map(applyZen
+00018c40: 6974 6829 0d0a 0d0a 2020 2020 6966 2061  ith)....    if a
+00018c50: 6464 4c6f 6f6b 416e 676c 6542 616e 6473  ddLookAngleBands
+00018c60: 3a0d 0a20 2020 2020 2069 6d61 6765 7320  :..      images 
+00018c70: 3d20 696d 6167 6573 2e73 656c 6563 7428  = images.select(
+00018c80: 6565 2e4c 6973 7428 6d6f 6469 7335 3030  ee.List(modis500
+00018c90: 5365 6c65 6374 4261 6e64 7329 2e63 6174  SelectBands).cat
+00018ca0: 2876 6965 7741 6e67 6c65 4261 6e64 4e61  (viewAngleBandNa
+00018cb0: 6d65 7329 2c65 652e 4c69 7374 286d 6f64  mes),ee.List(mod
+00018cc0: 6973 3530 3042 616e 644e 616d 6573 292e  is500BandNames).
+00018cd0: 6361 7428 7669 6577 416e 676c 6542 616e  cat(viewAngleBan
+00018ce0: 644e 616d 6573 2929 3b0d 0a20 2020 2065  dNames));..    e
+00018cf0: 6c73 653a 0d0a 2020 2020 2020 696d 6167  lse:..      imag
+00018d00: 6573 203d 2069 6d61 6765 732e 7365 6c65  es = images.sele
+00018d10: 6374 286d 6f64 6973 3530 3053 656c 6563  ct(modis500Selec
+00018d20: 7442 616e 6473 2c6d 6f64 6973 3530 3042  tBands,modis500B
+00018d30: 616e 644e 616d 6573 290d 0a0d 0a20 2020  andNames)....   
+00018d40: 2072 6574 7572 6e20 696d 6167 6573 0d0a   return images..
+00018d50: 0d0a 0d0a 2020 6135 3030 203d 2067 6574  ....  a500 = get
+00018d60: 3530 3028 6135 3030 4329 0d0a 2020 7435  500(a500C)..  t5
+00018d70: 3030 203d 2067 6574 3530 3028 7435 3030  00 = get500(t500
+00018d80: 4329 0d0a 0d0a 0d0a 2020 2349 6620 7468  C)......  #If th
+00018d90: 6572 6d61 6c20 636f 6c6c 6563 7469 6f6e  ermal collection
+00018da0: 2069 7320 7761 6e74 6564 2c20 7075 6c6c   is wanted, pull
+00018db0: 2069 7420 6173 2077 656c 6c0d 0a20 2069   it as well..  i
+00018dc0: 6620 7573 6554 656d 7049 6e43 6c6f 7564  f useTempInCloud
+00018dd0: 4d61 736b 3a0d 0a20 2020 2074 3130 3030  Mask:..    t1000
+00018de0: 203d 2065 652e 496d 6167 6543 6f6c 6c65   = ee.ImageColle
+00018df0: 6374 696f 6e28 7431 3030 3043 295c 0d0a  ction(t1000C)\..
+00018e00: 2020 2020 2020 2020 2020 2020 2e66 696c              .fil
+00018e10: 7465 7228 6565 2e46 696c 7465 722e 6361  ter(ee.Filter.ca
+00018e20: 6c65 6e64 6172 5261 6e67 6528 7374 6172  lendarRange(star
+00018e30: 7459 6561 722c 656e 6459 6561 722c 2779  tYear,endYear,'y
+00018e40: 6561 7227 2929 5c0d 0a20 2020 2020 2020  ear'))\..       
+00018e50: 2020 2020 202e 6669 6c74 6572 2865 652e       .filter(ee.
+00018e60: 4669 6c74 6572 2e63 616c 656e 6461 7252  Filter.calendarR
+00018e70: 616e 6765 2873 7461 7274 4a75 6c69 616e  ange(startJulian
+00018e80: 2c65 6e64 4a75 6c69 616e 2929 5c0d 0a20  ,endJulian))\.. 
+00018e90: 2020 2020 2020 2020 2020 202e 7365 6c65             .sele
+00018ea0: 6374 285b 302c 382c 395d 2c5b 2774 656d  ct([0,8,9],['tem
+00018eb0: 7027 2c27 456d 6973 5f33 3127 2c27 456d  p','Emis_31','Em
+00018ec0: 6973 5f33 3227 5d29 3b0d 0a0d 0a20 2020  is_32']);....   
+00018ed0: 2061 3130 3030 203d 2065 652e 496d 6167   a1000 = ee.Imag
+00018ee0: 6543 6f6c 6c65 6374 696f 6e28 6131 3030  eCollection(a100
+00018ef0: 3043 295c 0d0a 2020 2020 2020 2020 2020  0C)\..          
+00018f00: 2020 2e66 696c 7465 7228 6565 2e46 696c    .filter(ee.Fil
+00018f10: 7465 722e 6361 6c65 6e64 6172 5261 6e67  ter.calendarRang
+00018f20: 6528 7374 6172 7459 6561 722c 656e 6459  e(startYear,endY
+00018f30: 6561 722c 2779 6561 7227 2929 5c0d 0a20  ear,'year'))\.. 
+00018f40: 2020 2020 2020 2020 2020 202e 6669 6c74             .filt
+00018f50: 6572 2865 652e 4669 6c74 6572 2e63 616c  er(ee.Filter.cal
+00018f60: 656e 6461 7252 616e 6765 2873 7461 7274  endarRange(start
+00018f70: 4a75 6c69 616e 2c65 6e64 4a75 6c69 616e  Julian,endJulian
+00018f80: 2929 5c0d 0a20 2020 2020 2020 2020 2020  ))\..           
+00018f90: 202e 7365 6c65 6374 285b 302c 382c 395d   .select([0,8,9]
+00018fa0: 2c5b 2774 656d 7027 2c27 456d 6973 5f33  ,['temp','Emis_3
+00018fb0: 3127 2c27 456d 6973 5f33 3227 5d29 3b0d  1','Emis_32']);.
+00018fc0: 0a0d 0a0d 0a20 2023 4e6f 7720 616c 6c20  .....  #Now all 
+00018fd0: 636f 6c6c 6563 7469 6f6e 7320 6172 6520  collections are 
+00018fe0: 7075 6c6c 6564 2c20 7374 6172 7420 6a6f  pulled, start jo
+00018ff0: 696e 696e 6720 7468 656d 0d0a 2020 2346  ining them..  #F
+00019000: 6972 7374 206a 6f69 6e20 7468 6520 3235  irst join the 25
+00019010: 3020 616e 6420 3530 3020 6d20 4171 7561  0 and 500 m Aqua
+00019020: 0d0a 2020 6120 3d20 6a6f 696e 436f 6c6c  ..  a = joinColl
+00019030: 6563 7469 6f6e 7328 6132 3530 2c61 3530  ections(a250,a50
+00019040: 302c 4661 6c73 6529 0d0a 0d0a 2020 2354  0,False)....  #T
+00019050: 6865 6e20 5465 7272 610d 0a20 2074 203d  hen Terra..  t =
+00019060: 206a 6f69 6e43 6f6c 6c65 6374 696f 6e73   joinCollections
+00019070: 2874 3235 302c 7435 3030 2c46 616c 7365  (t250,t500,False
+00019080: 290d 0a0d 0a20 2023 4966 2074 656d 7020  )....  #If temp 
+00019090: 7761 7320 7075 6c6c 6564 2c20 6a6f 696e  was pulled, join
+000190a0: 2074 6861 7420 696e 2061 7320 7765 6c6c   that in as well
+000190b0: 0d0a 2020 2341 6c73 6f20 7365 6c65 6374  ..  #Also select
+000190c0: 2074 6865 2062 616e 6473 2069 6e20 616e   the bands in an
+000190d0: 204c 352d 6c69 6b65 206f 7264 6572 2061   L5-like order a
+000190e0: 6e64 2067 6976 6520 6465 7363 7269 7074  nd give descript
+000190f0: 6976 6520 6e61 6d65 730d 0a20 2069 6620  ive names..  if 
+00019100: 7573 6554 656d 7049 6e43 6c6f 7564 4d61  useTempInCloudMa
+00019110: 736b 3a0d 0a20 2020 2061 203d 206a 6f69  sk:..    a = joi
+00019120: 6e43 6f6c 6c65 6374 696f 6e73 2861 2c61  nCollections(a,a
+00019130: 3130 3030 2c46 616c 7365 290d 0a20 2020  1000,False)..   
+00019140: 2074 203d 206a 6f69 6e43 6f6c 6c65 6374   t = joinCollect
+00019150: 696f 6e73 2874 2c74 3130 3030 2c46 616c  ions(t,t1000,Fal
+00019160: 7365 290d 0a0d 0a0d 0a20 2023 2020 2074  se)......  #   t
+00019170: 5365 6c65 6374 4f72 6465 7220 3d20 7754  SelectOrder = wT
+00019180: 656d 7053 656c 6563 744f 7264 6572 0d0a  empSelectOrder..
+00019190: 2020 2320 2020 7453 7464 4e61 6d65 7320    #   tStdNames 
+000191a0: 3d20 7754 656d 7053 7464 4e61 6d65 730d  = wTempStdNames.
+000191b0: 0a0d 0a20 2023 2023 4966 206e 6f20 7468  ...  # #If no th
+000191c0: 6572 6d61 6c20 7761 7320 7075 6c6c 6564  ermal was pulled
+000191d0: 2c20 6c65 6176 6520 7468 6174 206f 7574  , leave that out
+000191e0: 0d0a 2020 2320 656c 7365 3a0d 0a20 2023  ..  # else:..  #
+000191f0: 2020 2074 5365 6c65 6374 4f72 6465 7220     tSelectOrder 
+00019200: 3d20 776f 5465 6d70 5365 6c65 6374 4f72  = woTempSelectOr
+00019210: 6465 720d 0a20 2023 2020 2074 5374 644e  der..  #   tStdN
+00019220: 616d 6573 203d 2077 6f54 656d 7053 7464  ames = woTempStd
+00019230: 4e61 6d65 730d 0a0d 0a20 2061 203d 2061  Names....  a = a
+00019240: 2e6d 6170 286c 616d 6264 6120 696d 673a  .map(lambda img:
+00019250: 696d 672e 7365 7428 7b27 706c 6174 666f  img.set({'platfo
+00019260: 726d 273a 2761 7175 6127 7d29 293b 0d0a  rm':'aqua'}));..
+00019270: 2020 7420 3d20 742e 6d61 7028 6c61 6d62    t = t.map(lamb
+00019280: 6461 2069 6d67 3a69 6d67 2e73 6574 287b  da img:img.set({
+00019290: 2770 6c61 7466 6f72 6d27 3a27 7465 7272  'platform':'terr
+000192a0: 6127 7d29 293b 0d0a 0d0a 0d0a 2020 6966  a'}));......  if
+000192b0: 2864 6169 6c79 293a 6461 696c 7950 6965  (daily):dailyPie
+000192c0: 6365 203d 2027 4461 696c 7927 0d0a 2020  ce = 'Daily'..  
+000192d0: 656c 7365 3a64 6169 6c79 5069 6563 6520  else:dailyPiece 
+000192e0: 3d20 2743 6f6d 706f 7369 7465 270d 0a0d  = 'Composite'...
+000192f0: 0a20 2069 6628 7573 6554 656d 7049 6e43  .  if(useTempInC
+00019300: 6c6f 7564 4d61 736b 293a 7465 6d70 5069  loudMask):tempPi
+00019310: 6563 6520 3d20 2774 656d 7027 0d0a 2020  ece = 'temp'..  
+00019320: 656c 7365 3a74 656d 7050 6965 6365 203d  else:tempPiece =
+00019330: 2027 6e6f 5465 6d70 270d 0a20 2069 6620   'noTemp'..  if 
+00019340: 6164 644c 6f6f 6b41 6e67 6c65 4261 6e64  addLookAngleBand
+00019350: 733a 616e 676c 6550 6965 6365 203d 2027  s:anglePiece = '
+00019360: 416e 676c 6527 0d0a 2020 656c 7365 3a61  Angle'..  else:a
+00019370: 6e67 6c65 5069 6563 6520 3d20 274e 6f41  nglePiece = 'NoA
+00019380: 6e67 6c65 270d 0a20 206d 756c 744b 6579  ngle'..  multKey
+00019390: 203d 2074 656d 7050 6965 6365 2b61 6e67   = tempPiece+ang
+000193a0: 6c65 5069 6563 652b 6461 696c 7950 6965  lePiece+dailyPie
+000193b0: 6365 0d0a 0d0a 2020 6d75 6c74 203d 206d  ce....  mult = m
+000193c0: 756c 744d 6f64 6973 4469 6374 5b6d 756c  ultModisDict[mul
+000193d0: 744b 6579 5d0d 0a20 206d 756c 7449 6d61  tKey]..  multIma
+000193e0: 6765 203d 206d 756c 745b 305d 0d0a 2020  ge = mult[0]..  
+000193f0: 6d75 6c74 4e61 6d65 7320 3d20 6d75 6c74  multNames = mult
+00019400: 5b31 5d0d 0a0d 0a20 2023 4a6f 696e 2054  [1]....  #Join T
+00019410: 6572 7261 2061 6e64 2041 7175 610d 0a20  erra and Aqua.. 
+00019420: 206a 6f69 6e65 6420 3d20 6565 2e49 6d61   joined = ee.Ima
+00019430: 6765 436f 6c6c 6563 7469 6f6e 2861 2e6d  geCollection(a.m
+00019440: 6572 6765 2874 2929 232e 7365 6c65 6374  erge(t))#.select
+00019450: 2874 5365 6c65 6374 4f72 6465 722c 7453  (tSelectOrder,tS
+00019460: 7464 4e61 6d65 7329 0d0a 0d0a 2020 6465  tdNames)....  de
+00019470: 6620 6d75 6c74 6970 6c79 496d 6728 696d  f multiplyImg(im
+00019480: 6729 3a0d 0a20 2020 2072 6574 7572 6e20  g):..    return 
+00019490: 696d 672e 6d75 6c74 6970 6c79 286d 756c  img.multiply(mul
+000194a0: 7449 6d61 6765 292e 666c 6f61 7428 292e  tImage).float().
+000194b0: 7365 6c65 6374 286d 756c 744e 616d 6573  select(multNames
+000194c0: 295c 0d0a 2020 2020 2020 2020 2e63 6f70  )\..        .cop
+000194d0: 7950 726f 7065 7274 6965 7328 696d 672c  yProperties(img,
+000194e0: 5b27 7379 7374 656d 3a74 696d 655f 7374  ['system:time_st
+000194f0: 6172 7427 2c27 7379 7374 656d 3a74 696d  art','system:tim
+00019500: 655f 656e 6427 2c27 7379 7374 656d 3a69  e_end','system:i
+00019510: 6e64 6578 275d 295c 0d0a 2020 2020 2020  ndex'])\..      
+00019520: 2020 2e63 6f70 7950 726f 7065 7274 6965    .copyPropertie
+00019530: 7328 696d 6729 0d0a 2020 6465 6620 7365  s(img)..  def se
+00019540: 7452 6573 616d 706c 6528 696d 6729 3a0d  tResample(img):.
+00019550: 0a20 2020 2072 6574 7572 6e20 696d 672e  .    return img.
+00019560: 7265 7361 6d70 6c65 2872 6573 616d 706c  resample(resampl
+00019570: 654d 6574 686f 6429 0d0a 0d0a 2020 6a6f  eMethod)....  jo
+00019580: 696e 6564 203d 206a 6f69 6e65 642e 6d61  ined = joined.ma
+00019590: 7028 6d75 6c74 6970 6c79 496d 6729 0d0a  p(multiplyImg)..
+000195a0: 2020 6966 2020 7265 7361 6d70 6c65 4d65    if  resampleMe
+000195b0: 7468 6f64 2069 6e20 5b27 6269 6c69 6e65  thod in ['biline
+000195c0: 6172 272c 2762 6963 7562 6963 275d 3a0d  ar','bicubic']:.
+000195d0: 0a20 2020 2070 7269 6e74 2827 5365 7474  .    print('Sett
+000195e0: 696e 6720 7265 7361 6d70 6c65 206d 6574  ing resample met
+000195f0: 686f 6420 746f 2027 2c72 6573 616d 706c  hod to ',resampl
+00019600: 654d 6574 686f 6429 0d0a 2020 2020 6a6f  eMethod)..    jo
+00019610: 696e 6564 203d 206a 6f69 6e65 642e 6d61  ined = joined.ma
+00019620: 7028 7365 7452 6573 616d 706c 6529 0d0a  p(setResample)..
+00019630: 2020 7265 7475 726e 206a 6f69 6e65 640d    return joined.
+00019640: 0a0d 0a0d 0a23 4675 6e63 7469 6f6e 2074  .....#Function t
+00019650: 6f20 6765 7420 636c 6f75 642c 2063 6c6f  o get cloud, clo
+00019660: 7564 2073 6861 646f 7720 6275 7374 6564  ud shadow busted
+00019670: 206d 6f64 6973 2069 6d61 6765 730d 0a23   modis images..#
+00019680: 5461 6b65 7320 6361 7265 206f 6620 6d61  Takes care of ma
+00019690: 7463 6869 6e67 2064 6966 6665 7265 6e74  tching different
+000196a0: 206d 6f64 6973 2063 6f6c 6c65 6374 696f   modis collectio
+000196b0: 6e73 2061 7320 7765 6c6c 0d0a 6465 6620  ns as well..def 
+000196c0: 6765 7450 726f 6365 7373 6564 4d6f 6469  getProcessedModi
+000196d0: 7328 7374 6172 7459 6561 722c 0d0a 2020  s(startYear,..  
+000196e0: 2020 2020 2020 2020 2020 656e 6459 6561            endYea
+000196f0: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
+00019700: 7374 6172 744a 756c 6961 6e2c 0d0a 2020  startJulian,..  
+00019710: 2020 2020 2020 2020 2020 656e 644a 756c            endJul
+00019720: 6961 6e2c 0d0a 2020 2020 2020 2020 2020  ian,..          
+00019730: 2020 7a65 6e69 7468 5468 7265 7368 203d    zenithThresh =
+00019740: 2039 302c 0d0a 2020 2020 2020 2020 2020   90,..          
+00019750: 2020 6164 644c 6f6f 6b41 6e67 6c65 4261    addLookAngleBa
+00019760: 6e64 7320 3d20 5472 7565 2c0d 0a20 2020  nds = True,..   
+00019770: 2020 2020 2020 2020 2061 7070 6c79 436c           applyCl
+00019780: 6f75 6453 636f 7265 203d 2054 7275 652c  oudScore = True,
+00019790: 0d0a 2020 2020 2020 2020 2020 2020 6170  ..            ap
+000197a0: 706c 7954 444f 4d20 3d20 5472 7565 2c0d  plyTDOM = True,.
+000197b0: 0a20 2020 2020 2020 2020 2020 2075 7365  .            use
+000197c0: 5465 6d70 496e 436c 6f75 644d 6173 6b20  TempInCloudMask 
+000197d0: 3d20 5472 7565 2c0d 0a20 2020 2020 2020  = True,..       
+000197e0: 2020 2020 2063 6c6f 7564 5363 6f72 6554       cloudScoreT
+000197f0: 6872 6573 6820 3d20 3230 2c0d 0a20 2020  hresh = 20,..   
+00019800: 2020 2020 2020 2020 2070 6572 666f 726d           perform
+00019810: 436c 6f75 6453 636f 7265 4f66 6673 6574  CloudScoreOffset
+00019820: 203d 2054 7275 652c 0d0a 2020 2020 2020   = True,..      
+00019830: 2020 2020 2020 636c 6f75 6453 636f 7265        cloudScore
+00019840: 5063 746c 203d 2031 302c 0d0a 2020 2020  Pctl = 10,..    
+00019850: 2020 2020 2020 2020 7a53 636f 7265 5468          zScoreTh
+00019860: 7265 7368 203d 202d 312c 0d0a 2020 2020  resh = -1,..    
+00019870: 2020 2020 2020 2020 7368 6164 6f77 5375          shadowSu
+00019880: 6d54 6872 6573 6820 3d20 302e 3335 2c0d  mThresh = 0.35,.
+00019890: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+000198a0: 7472 6163 7450 6978 656c 7320 3d20 302c  tractPixels = 0,
+000198b0: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
+000198c0: 6c61 7465 5069 7865 6c73 203d 2032 2e35  latePixels = 2.5
+000198d0: 2c0d 0a20 2020 2020 2020 2020 2020 2073  ,..            s
+000198e0: 6861 646f 7753 756d 4261 6e64 7320 3d20  hadowSumBands = 
+000198f0: 5b27 6e69 7227 2c27 7377 6972 3227 5d2c  ['nir','swir2'],
+00019900: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00019910: 7361 6d70 6c65 4d65 7468 6f64 203d 2027  sampleMethod = '
+00019920: 6269 6375 6269 6327 2c0d 0a20 2020 2020  bicubic',..     
+00019930: 2020 2020 2020 2070 7265 436f 6d70 7574         preComput
+00019940: 6564 436c 6f75 6453 636f 7265 4f66 6673  edCloudScoreOffs
+00019950: 6574 203d 204e 6f6e 652c 0d0a 2020 2020  et = None,..    
+00019960: 2020 2020 2020 2020 7072 6543 6f6d 7075          preCompu
+00019970: 7465 6454 444f 4d49 524d 6561 6e20 3d20  tedTDOMIRMean = 
+00019980: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
+00019990: 2020 2070 7265 436f 6d70 7574 6564 5444     preComputedTD
+000199a0: 4f4d 4952 5374 6444 6576 203d 204e 6f6e  OMIRStdDev = Non
+000199b0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+000199c0: 6164 6454 6f4d 6170 203d 2046 616c 7365  addToMap = False
+000199d0: 2c0d 0a20 2020 2020 2020 2020 2020 2063  ,..            c
+000199e0: 7273 203d 2027 4550 5347 3a34 3332 3627  rs = 'EPSG:4326'
+000199f0: 2c0d 0a20 2020 2020 2020 2020 2020 2073  ,..            s
+00019a00: 6361 6c65 203d 2032 3530 2c0d 0a20 2020  cale = 250,..   
+00019a10: 2020 2020 2020 2020 2074 7261 6e73 666f           transfo
+00019a20: 726d 203d 204e 6f6e 6529 3a0d 0a0d 0a20  rm = None):.... 
+00019a30: 2061 7267 7320 3d20 666f 726d 6174 4172   args = formatAr
+00019a40: 6773 286c 6f63 616c 7328 2929 0d0a 2020  gs(locals())..  
+00019a50: 6966 2027 6172 6773 2720 696e 2061 7267  if 'args' in arg
+00019a60: 732e 6b65 7973 2829 3a0d 0a20 2020 2064  s.keys():..    d
+00019a70: 656c 2061 7267 735b 2761 7267 7327 5d0d  el args['args'].
+00019a80: 0a0d 0a20 2023 4765 7420 6a6f 696e 6564  ...  #Get joined
+00019a90: 206d 6f64 6973 2063 6f6c 6c65 6374 696f   modis collectio
+00019aa0: 6e0d 0a20 206d 6f64 6973 496d 6167 6573  n..  modisImages
+00019ab0: 203d 2067 6574 4d6f 6469 7344 6174 6128   = getModisData(
+00019ac0: 7374 6172 7459 6561 722c 656e 6459 6561  startYear,endYea
+00019ad0: 722c 7374 6172 744a 756c 6961 6e2c 656e  r,startJulian,en
+00019ae0: 644a 756c 6961 6e2c 0d0a 2020 2020 6461  dJulian,..    da
+00019af0: 696c 7920 3d20 5472 7565 2c0d 0a20 2020  ily = True,..   
+00019b00: 206d 6173 6b57 5141 203d 2046 616c 7365   maskWQA = False
+00019b10: 2c0d 0a20 2020 207a 656e 6974 6854 6872  ,..    zenithThr
+00019b20: 6573 6820 3d20 7a65 6e69 7468 5468 7265  esh = zenithThre
+00019b30: 7368 2c0d 0a20 2020 2075 7365 5465 6d70  sh,..    useTemp
+00019b40: 496e 436c 6f75 644d 6173 6b20 3d20 7573  InCloudMask = us
+00019b50: 6554 656d 7049 6e43 6c6f 7564 4d61 736b  eTempInCloudMask
+00019b60: 2c0d 0a20 2020 2061 6464 4c6f 6f6b 416e  ,..    addLookAn
+00019b70: 676c 6542 616e 6473 203d 2061 6464 4c6f  gleBands = addLo
+00019b80: 6f6b 416e 676c 6542 616e 6473 2c0d 0a20  okAngleBands,.. 
+00019b90: 2020 2072 6573 616d 706c 654d 6574 686f     resampleMetho
+00019ba0: 6420 3d20 2072 6573 616d 706c 654d 6574  d =  resampleMet
+00019bb0: 686f 6429 0d0a 0d0a 2020 6966 2061 6464  hod)....  if add
+00019bc0: 546f 4d61 703a 0d0a 2020 2020 4d61 702e  ToMap:..    Map.
+00019bd0: 6164 644c 6179 6572 286d 6f64 6973 496d  addLayer(modisIm
+00019be0: 6167 6573 2e6d 6564 6961 6e28 292e 7265  ages.median().re
+00019bf0: 7072 6f6a 6563 7428 6372 732c 7472 616e  project(crs,tran
+00019c00: 7366 6f72 6d2c 7363 616c 6529 2c76 697a  sform,scale),viz
+00019c10: 5061 7261 6d73 4661 6c73 652c 2752 6177  ParamsFalse,'Raw
+00019c20: 204d 6564 6961 6e27 290d 0a0d 0a0d 0a20   Median')...... 
+00019c30: 2069 6620 6170 706c 7943 6c6f 7564 5363   if applyCloudSc
+00019c40: 6f72 653a 0d0a 2020 2020 7072 696e 7428  ore:..    print(
+00019c50: 2741 7070 6c79 696e 6720 636c 6f75 6453  'Applying cloudS
+00019c60: 636f 7265 2729 0d0a 2020 2020 6d6f 6469  core')..    modi
+00019c70: 7349 6d61 6765 7320 3d20 6170 706c 7943  sImages = applyC
+00019c80: 6c6f 7564 5363 6f72 6541 6c67 6f72 6974  loudScoreAlgorit
+00019c90: 686d 286d 6f64 6973 496d 6167 6573 2c6d  hm(modisImages,m
+00019ca0: 6f64 6973 436c 6f75 6453 636f 7265 2c63  odisCloudScore,c
+00019cb0: 6c6f 7564 5363 6f72 6554 6872 6573 682c  loudScoreThresh,
+00019cc0: 636c 6f75 6453 636f 7265 5063 746c 2c63  cloudScorePctl,c
+00019cd0: 6f6e 7472 6163 7450 6978 656c 732c 6469  ontractPixels,di
+00019ce0: 6c61 7465 5069 7865 6c73 2c70 6572 666f  latePixels,perfo
+00019cf0: 726d 436c 6f75 6453 636f 7265 4f66 6673  rmCloudScoreOffs
+00019d00: 6574 2c70 7265 436f 6d70 7574 6564 436c  et,preComputedCl
+00019d10: 6f75 6453 636f 7265 4f66 6673 6574 290d  oudScoreOffset).
+00019d20: 0a0d 0a20 2020 2069 6620 6164 6454 6f4d  ...    if addToM
+00019d30: 6170 3a0d 0a20 2020 2020 204d 6170 2e61  ap:..      Map.a
+00019d40: 6464 4c61 7965 7228 6d6f 6469 7349 6d61  ddLayer(modisIma
+00019d50: 6765 732e 6d65 6469 616e 2829 2e72 6570  ges.median().rep
+00019d60: 726f 6a65 6374 2863 7273 2c74 7261 6e73  roject(crs,trans
+00019d70: 666f 726d 2c73 6361 6c65 292c 7669 7a50  form,scale),vizP
+00019d80: 6172 616d 7346 616c 7365 2c27 436c 6f75  aramsFalse,'Clou
+00019d90: 6420 4d61 736b 6564 204d 6564 6961 6e27  d Masked Median'
+00019da0: 2c46 616c 7365 290d 0a20 2020 2020 204d  ,False)..      M
+00019db0: 6170 2e61 6464 4c61 7965 7228 6d6f 6469  ap.addLayer(modi
+00019dc0: 7349 6d61 6765 732e 6d69 6e28 292e 7265  sImages.min().re
+00019dd0: 7072 6f6a 6563 7428 6372 732c 7472 616e  project(crs,tran
+00019de0: 7366 6f72 6d2c 7363 616c 6529 2c76 697a  sform,scale),viz
+00019df0: 5061 7261 6d73 4661 6c73 652c 2743 6c6f  ParamsFalse,'Clo
+00019e00: 7564 204d 6173 6b65 6420 4d69 6e27 2c46  ud Masked Min',F
+00019e10: 616c 7365 290d 0a0d 0a20 2069 6620 6170  alse)....  if ap
+00019e20: 706c 7954 444f 4d3a 0d0a 2020 2020 7072  plyTDOM:..    pr
+00019e30: 696e 7428 2741 7070 6c79 696e 6720 5444  int('Applying TD
+00019e40: 4f4d 2729 0d0a 2020 2020 2346 696e 6420  OM')..    #Find 
+00019e50: 616e 6420 6d61 736b 206f 7574 2064 6172  and mask out dar
+00019e60: 6b20 6f75 746c 6965 7273 0d0a 2020 2020  k outliers..    
+00019e70: 6d6f 6469 7349 6d61 6765 7320 3d20 7369  modisImages = si
+00019e80: 6d70 6c65 5444 4f4d 3228 6d6f 6469 7349  mpleTDOM2(modisI
+00019e90: 6d61 6765 732c 7a53 636f 7265 5468 7265  mages,zScoreThre
+00019ea0: 7368 2c73 6861 646f 7753 756d 5468 7265  sh,shadowSumThre
+00019eb0: 7368 2c63 6f6e 7472 6163 7450 6978 656c  sh,contractPixel
+00019ec0: 732c 6469 6c61 7465 5069 7865 6c73 2c73  s,dilatePixels,s
+00019ed0: 6861 646f 7753 756d 4261 6e64 732c 7072  hadowSumBands,pr
+00019ee0: 6543 6f6d 7075 7465 6454 444f 4d49 524d  eComputedTDOMIRM
+00019ef0: 6561 6e2c 7072 6543 6f6d 7075 7465 6454  ean,preComputedT
+00019f00: 444f 4d49 5253 7464 4465 7629 0d0a 0d0a  DOMIRStdDev)....
+00019f10: 2020 2020 6966 2061 6464 546f 4d61 703a      if addToMap:
+00019f20: 0d0a 2020 2020 2020 4d61 702e 6164 644c  ..      Map.addL
+00019f30: 6179 6572 286d 6f64 6973 496d 6167 6573  ayer(modisImages
+00019f40: 2e6d 6564 6961 6e28 292e 7265 7072 6f6a  .median().reproj
+00019f50: 6563 7428 6372 732c 7472 616e 7366 6f72  ect(crs,transfor
+00019f60: 6d2c 7363 616c 6529 2c76 697a 5061 7261  m,scale),vizPara
+00019f70: 6d73 4661 6c73 652c 2743 6c6f 7564 2f43  msFalse,'Cloud/C
+00019f80: 6c6f 7564 2053 6861 646f 7720 4d61 736b  loud Shadow Mask
+00019f90: 6564 204d 6564 6961 6e27 2c46 616c 7365  ed Median',False
+00019fa0: 290d 0a20 2020 2020 204d 6170 2e61 6464  )..      Map.add
+00019fb0: 4c61 7965 7228 6d6f 6469 7349 6d61 6765  Layer(modisImage
+00019fc0: 732e 6d69 6e28 292e 7265 7072 6f6a 6563  s.min().reprojec
+00019fd0: 7428 6372 732c 7472 616e 7366 6f72 6d2c  t(crs,transform,
+00019fe0: 7363 616c 6529 2c76 697a 5061 7261 6d73  scale),vizParams
+00019ff0: 4661 6c73 652c 2743 6c6f 7564 2f43 6c6f  False,'Cloud/Clo
+0001a000: 7564 2053 6861 646f 7720 4d61 736b 6564  ud Shadow Masked
+0001a010: 204d 696e 272c 4661 6c73 6529 0d0a 0d0a   Min',False)....
+0001a020: 2020 6d6f 6469 7349 6d61 6765 7320 3d20    modisImages = 
+0001a030: 6d6f 6469 7349 6d61 6765 732e 6d61 7028  modisImages.map(
+0001a040: 7369 6d70 6c65 4164 6449 6e64 6963 6573  simpleAddIndices
+0001a050: 290d 0a20 206d 6f64 6973 496d 6167 6573  )..  modisImages
+0001a060: 203d 206d 6f64 6973 496d 6167 6573 2e6d   = modisImages.m
+0001a070: 6170 286c 616d 6264 6120 696d 673a 2069  ap(lambda img: i
+0001a080: 6d67 2e66 6c6f 6174 2829 290d 0a20 2072  mg.float())..  r
+0001a090: 6574 7572 6e20 6d6f 6469 7349 6d61 6765  eturn modisImage
+0001a0a0: 732e 7365 7428 6172 6773 290d 0a23 2323  s.set(args)..###
+0001a0b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001a0c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001a0d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001a0e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001a0f0: 2323 2323 2323 0d0a 2346 756e 6374 696f  ######..#Functio
+0001a100: 6e20 746f 2074 616b 6520 696d 6167 6573  n to take images
+0001a110: 2061 6e64 2063 7265 6174 6520 6120 6d65   and create a me
+0001a120: 6469 616e 2063 6f6d 706f 7369 7465 2065  dian composite e
+0001a130: 7665 7279 206e 2064 6179 730d 0a64 6566  very n days..def
+0001a140: 206e 4461 7943 6f6d 706f 7369 7465 7328   nDayComposites(
+0001a150: 696d 6167 6573 2c73 7461 7274 5965 6172  images,startYear
+0001a160: 2c65 6e64 5965 6172 2c73 7461 7274 4a75  ,endYear,startJu
+0001a170: 6c69 616e 2c65 6e64 4a75 6c69 616e 2c63  lian,endJulian,c
+0001a180: 6f6d 706f 7369 7465 5065 7269 6f64 293a  ompositePeriod):
+0001a190: 0d0a 0d0a 2020 2363 7265 6174 6520 6475  ....  #create du
+0001a1a0: 6d6d 7920 696d 6167 6520 666f 7220 7769  mmy image for wi
+0001a1b0: 7468 206e 6f20 7661 6c75 6573 0d0a 2020  th no values..  
+0001a1c0: 6475 6d6d 7949 6d61 6765 203d 2065 652e  dummyImage = ee.
+0001a1d0: 496d 6167 6528 696d 6167 6573 2e66 6972  Image(images.fir
+0001a1e0: 7374 2829 290d 0a0d 0a20 2023 636f 6e76  st())....  #conv
+0001a1f0: 6572 7420 746f 2063 6f6d 706f 7369 7465  ert to composite
+0001a200: 7320 6173 2064 6566 696e 6564 2061 626f  s as defined abo
+0001a210: 7665 0d0a 2020 6465 6620 6765 7459 7249  ve..  def getYrI
+0001a220: 6d61 6765 7328 7972 293a 0d0a 2020 2020  mages(yr):..    
+0001a230: 2374 616b 6520 7468 6520 7965 6172 206f  #take the year o
+0001a240: 6620 7468 6520 696d 6167 650d 0a20 2020  f the image..   
+0001a250: 2079 7220 3d20 6565 2e4e 756d 6265 7228   yr = ee.Number(
+0001a260: 7972 292e 696e 7431 3628 290d 0a20 2020  yr).int16()..   
+0001a270: 2023 6669 6c74 6572 206f 7574 2069 6d61   #filter out ima
+0001a280: 6765 7320 666f 7220 7468 6520 7965 6172  ges for the year
+0001a290: 0d0a 2020 2020 7972 496d 6167 6573 203d  ..    yrImages =
+0001a2a0: 2069 6d61 6765 732e 6669 6c74 6572 2865   images.filter(e
+0001a2b0: 652e 4669 6c74 6572 2e63 616c 656e 6461  e.Filter.calenda
+0001a2c0: 7252 616e 6765 2879 722c 7972 2c27 7965  rRange(yr,yr,'ye
+0001a2d0: 6172 2729 290d 0a0d 0a20 2020 2023 7573  ar'))....    #us
+0001a2e0: 6520 6475 6d6d 7920 696d 6167 6520 746f  e dummy image to
+0001a2f0: 2066 696c 6c20 696e 2067 6170 7320 666f   fill in gaps fo
+0001a300: 7220 4745 4520 7072 6f63 6573 7369 6e67  r GEE processing
+0001a310: 0d0a 2020 2020 7972 496d 6167 6573 203d  ..    yrImages =
+0001a320: 2066 696c 6c45 6d70 7479 436f 6c6c 6563   fillEmptyCollec
+0001a330: 7469 6f6e 7328 7972 496d 6167 6573 2c64  tions(yrImages,d
+0001a340: 756d 6d79 496d 6167 6529 0d0a 2020 2020  ummyImage)..    
+0001a350: 7265 7475 726e 2079 7249 6d61 6765 730d  return yrImages.
+0001a360: 0a0d 0a20 2023 4765 7420 696d 6167 6573  ...  #Get images
+0001a370: 2066 6f72 2061 2073 7065 6369 6669 6564   for a specified
+0001a380: 2073 7461 7274 2064 6179 0d0a 2020 6465   start day..  de
+0001a390: 6620 6765 744a 6449 6d61 6765 7328 7972  f getJdImages(yr
+0001a3a0: 2c79 7249 6d61 6765 732c 7374 6172 7429  ,yrImages,start)
+0001a3b0: 3a0d 0a20 2020 2079 7220 3d20 6565 2e4e  :..    yr = ee.N
+0001a3c0: 756d 6265 7228 7972 292e 696e 7431 3628  umber(yr).int16(
+0001a3d0: 290d 0a20 2020 2073 7461 7274 203d 2065  )..    start = e
+0001a3e0: 652e 4e75 6d62 6572 2873 7461 7274 292e  e.Number(start).
+0001a3f0: 696e 7431 3628 290d 0a20 2020 2064 6174  int16()..    dat
+0001a400: 6520 3d20 6565 2e44 6174 652e 6672 6f6d  e = ee.Date.from
+0001a410: 594d 4428 7972 2c31 2c31 292e 6164 7661  YMD(yr,1,1).adva
+0001a420: 6e63 6528 7374 6172 742e 7375 6274 7261  nce(start.subtra
+0001a430: 6374 2831 292c 2764 6179 2729 0d0a 2020  ct(1),'day')..  
+0001a440: 2020 696e 6465 7820 3d20 6461 7465 2e66    index = date.f
+0001a450: 6f72 6d61 7428 2779 7979 792d 4d4d 2d64  ormat('yyyy-MM-d
+0001a460: 6427 290d 0a20 2020 2065 6e64 203d 2073  d')..    end = s
+0001a470: 7461 7274 2e61 6464 2863 6f6d 706f 7369  tart.add(composi
+0001a480: 7465 5065 7269 6f64 2d31 292e 696e 7431  tePeriod-1).int1
+0001a490: 3628 290d 0a20 2020 206a 6449 6d61 6765  6()..    jdImage
+0001a4a0: 7320 3d20 7972 496d 6167 6573 2e66 696c  s = yrImages.fil
+0001a4b0: 7465 7228 6565 2e46 696c 7465 722e 6361  ter(ee.Filter.ca
+0001a4c0: 6c65 6e64 6172 5261 6e67 6528 7374 6172  lendarRange(star
+0001a4d0: 742c 656e 6429 290d 0a20 2020 206a 6449  t,end))..    jdI
+0001a4e0: 6d61 6765 7320 3d20 6669 6c6c 456d 7074  mages = fillEmpt
+0001a4f0: 7943 6f6c 6c65 6374 696f 6e73 286a 6449  yCollections(jdI
+0001a500: 6d61 6765 732c 6475 6d6d 7949 6d61 6765  mages,dummyImage
+0001a510: 290d 0a20 2020 2063 6f6d 706f 7369 7465  )..    composite
+0001a520: 203d 206a 6449 6d61 6765 732e 6d65 6469   = jdImages.medi
+0001a530: 616e 2829 0d0a 2020 2020 7265 7475 726e  an()..    return
+0001a540: 2063 6f6d 706f 7369 7465 2e73 6574 287b   composite.set({
+0001a550: 2773 7973 7465 6d3a 696e 6465 7827 3a69  'system:index':i
+0001a560: 6e64 6578 2c27 7379 7374 656d 3a74 696d  ndex,'system:tim
+0001a570: 655f 7374 6172 7427 3a64 6174 652e 6d69  e_start':date.mi
+0001a580: 6c6c 6973 2829 7d29 0d0a 0d0a 2020 2353  llis()})....  #S
+0001a590: 6574 2075 7020 7772 6170 7065 7273 0d0a  et up wrappers..
+0001a5a0: 2020 6465 6620 6a64 5772 6170 7065 7228    def jdWrapper(
+0001a5b0: 7972 2c79 7249 6d61 6765 7329 3a0d 0a20  yr,yrImages):.. 
+0001a5c0: 2020 2072 6574 7572 6e20 6565 2e46 6561     return ee.Fea
+0001a5d0: 7475 7265 436f 6c6c 6563 7469 6f6e 2865  tureCollection(e
+0001a5e0: 652e 4c69 7374 2e73 6571 7565 6e63 6528  e.List.sequence(
+0001a5f0: 7374 6172 744a 756c 6961 6e2c 656e 644a  startJulian,endJ
+0001a600: 756c 6961 6e2c 636f 6d70 6f73 6974 6550  ulian,compositeP
+0001a610: 6572 696f 6429 2e6d 6170 286c 616d 6264  eriod).map(lambd
+0001a620: 6120 7374 6172 743a 2067 6574 4a64 496d  a start: getJdIm
+0001a630: 6167 6573 2879 722c 7972 496d 6167 6573  ages(yr,yrImages
+0001a640: 2c73 7461 7274 2929 290d 0a20 2064 6566  ,start)))..  def
+0001a650: 2079 7257 7261 7070 6572 2879 7229 3a0d   yrWrapper(yr):.
+0001a660: 0a20 2020 2079 7249 6d61 6765 7320 3d20  .    yrImages = 
+0001a670: 6765 7459 7249 6d61 6765 7328 7972 290d  getYrImages(yr).
+0001a680: 0a20 2020 2072 6574 7572 6e20 6a64 5772  .    return jdWr
+0001a690: 6170 7065 7228 7972 2c79 7249 6d61 6765  apper(yr,yrImage
+0001a6a0: 7329 0d0a 0d0a 2020 636f 6d70 6f73 6974  s)....  composit
+0001a6b0: 6573 203d 2065 652e 4665 6174 7572 6543  es = ee.FeatureC
+0001a6c0: 6f6c 6c65 6374 696f 6e28 6565 2e4c 6973  ollection(ee.Lis
+0001a6d0: 742e 7365 7175 656e 6365 2873 7461 7274  t.sequence(start
+0001a6e0: 5965 6172 2c65 6e64 5965 6172 292e 6d61  Year,endYear).ma
+0001a6f0: 7028 6c61 6d62 6461 2079 723a 7972 5772  p(lambda yr:yrWr
+0001a700: 6170 7065 7228 7972 2929 290d 0a20 2023  apper(yr)))..  #
+0001a710: 7265 7475 726e 2074 6865 2063 6f6d 706f  return the compo
+0001a720: 7369 7465 7320 6173 2061 6e20 696d 6167  sites as an imag
+0001a730: 6520 636f 6c6c 6563 7469 6f6e 0d0a 2020  e collection..  
+0001a740: 636f 6d70 6f73 6974 6573 203d 2065 652e  composites = ee.
+0001a750: 496d 6167 6543 6f6c 6c65 6374 696f 6e28  ImageCollection(
+0001a760: 636f 6d70 6f73 6974 6573 2e66 6c61 7474  composites.flatt
+0001a770: 656e 2829 293b 0d0a 0d0a 2020 7265 7475  en());....  retu
+0001a780: 726e 2063 6f6d 706f 7369 7465 730d 0a23  rn composites..#
+0001a790: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001a7a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001a7b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001a7c0: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
+0001a7d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001a7e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001a7f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a800: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a810: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a820: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a830: 230d 0a23 2323 2323 2323 2323 2323 2323  #..#############
-0001a840: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a850: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a860: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a870: 2323 2323 2323 2323 2323 2323 0d0a 6465  ############..de
-0001a880: 6620 6578 706f 7274 436f 6c6c 6563 7469  f exportCollecti
-0001a890: 6f6e 2865 7870 6f72 7450 6174 6852 6f6f  on(exportPathRoo
-0001a8a0: 742c 6f75 7470 7574 4e61 6d65 2c73 7475  t,outputName,stu
-0001a8b0: 6479 4172 6561 2c20 6372 732c 7472 616e  dyArea, crs,tran
-0001a8c0: 7366 6f72 6d2c 7363 616c 652c 636f 6c6c  sform,scale,coll
-0001a8d0: 6563 7469 6f6e 2c73 7461 7274 5965 6172  ection,startYear
-0001a8e0: 2c65 6e64 5965 6172 2c73 7461 7274 4a75  ,endYear,startJu
-0001a8f0: 6c69 616e 2c65 6e64 4a75 6c69 616e 2c63  lian,endJulian,c
-0001a900: 6f6d 706f 7369 7469 6e67 5265 6475 6365  ompositingReduce
-0001a910: 722c 7469 6d65 6275 6666 6572 2c65 7870  r,timebuffer,exp
-0001a920: 6f72 7442 616e 6473 293a 0d0a 0d0a 2020  ortBands):....  
-0001a930: 2354 616b 6520 6361 7265 206f 6620 6461  #Take care of da
-0001a940: 7465 2077 7261 7070 696e 670d 0a20 2064  te wrapping..  d
-0001a950: 6174 6557 7261 7070 696e 6720 3d20 7772  ateWrapping = wr
-0001a960: 6170 4461 7465 7328 7374 6172 744a 756c  apDates(startJul
-0001a970: 6961 6e2c 656e 644a 756c 6961 6e29 0d0a  ian,endJulian)..
-0001a980: 2020 7772 6170 4f66 6673 6574 203d 2064    wrapOffset = d
-0001a990: 6174 6557 7261 7070 696e 675b 305d 0d0a  ateWrapping[0]..
-0001a9a0: 2020 7965 6172 5769 7468 4d61 6a6f 7269    yearWithMajori
-0001a9b0: 7479 203d 2064 6174 6557 7261 7070 696e  ty = dateWrappin
-0001a9c0: 675b 315d 0d0a 0d0a 2020 2343 6c65 616e  g[1]....  #Clean
-0001a9d0: 2075 7020 6f75 7470 7574 206e 616d 650d   up output name.
-0001a9e0: 0a20 206f 7574 7075 744e 616d 6520 3d20  .  outputName = 
-0001a9f0: 6f75 7470 7574 4e61 6d65 2e72 6570 6c61  outputName.repla
-0001aa00: 6365 2827 2f5c 732b 2f67 272c 272d 2729  ce('/\s+/g','-')
-0001aa10: 0d0a 2020 6f75 7470 7574 4e61 6d65 203d  ..  outputName =
-0001aa20: 206f 7574 7075 744e 616d 652e 7265 706c   outputName.repl
-0001aa30: 6163 6528 272f 5c2f 2f67 272c 272d 2729  ace('/\//g','-')
-0001aa40: 0d0a 0d0a 2020 2353 656c 6563 7420 6261  ....  #Select ba
-0001aa50: 6e64 7320 666f 7220 6578 706f 7274 0d0a  nds for export..
-0001aa60: 2020 636f 6c6c 6563 7469 6f6e 203d 2063    collection = c
-0001aa70: 6f6c 6c65 6374 696f 6e2e 7365 6c65 6374  ollection.select
-0001aa80: 2865 7870 6f72 7442 616e 6473 290d 0a0d  (exportBands)...
-0001aa90: 0a20 2023 4974 6572 6174 6520 6163 726f  .  #Iterate acro
-0001aaa0: 7373 2065 6163 6820 7965 6172 2061 6e64  ss each year and
-0001aab0: 2065 7870 6f72 7420 696d 6167 650d 0a20   export image.. 
-0001aac0: 2066 6f72 2079 6561 7220 696e 2065 652e   for year in ee.
-0001aad0: 4c69 7374 2e73 6571 7565 6e63 6528 7374  List.sequence(st
-0001aae0: 6172 7459 6561 722b 7469 6d65 6275 6666  artYear+timebuff
-0001aaf0: 6572 2c65 6e64 5965 6172 2d74 696d 6562  er,endYear-timeb
-0001ab00: 7566 6665 7229 2e67 6574 496e 666f 2829  uffer).getInfo()
-0001ab10: 3a0d 0a20 2020 2070 7269 6e74 2827 4578  :..    print('Ex
-0001ab20: 706f 7274 696e 673a 272c 7965 6172 290d  porting:',year).
-0001ab30: 0a20 2020 2023 5365 7420 7570 2064 6174  .    #Set up dat
-0001ab40: 6573 0d0a 2020 2020 7374 6172 7459 6561  es..    startYea
-0001ab50: 7254 203d 2079 6561 722d 7469 6d65 6275  rT = year-timebu
-0001ab60: 6666 6572 0d0a 2020 2020 656e 6459 6561  ffer..    endYea
-0001ab70: 7254 203d 2079 6561 722b 7469 6d65 6275  rT = year+timebu
-0001ab80: 6666 6572 2b79 6561 7257 6974 684d 616a  ffer+yearWithMaj
-0001ab90: 6f72 6974 790d 0a0d 0a20 2020 2023 4765  ority....    #Ge
-0001aba0: 7420 7965 6172 6c79 2063 6f6d 706f 7369  t yearly composi
-0001abb0: 7465 0d0a 2020 2020 636f 6d70 6f73 6974  te..    composit
-0001abc0: 6520 3d20 636f 6c6c 6563 7469 6f6e 2e66  e = collection.f
-0001abd0: 696c 7465 7228 6565 2e46 696c 7465 722e  ilter(ee.Filter.
-0001abe0: 6361 6c65 6e64 6172 5261 6e67 6528 7965  calendarRange(ye
-0001abf0: 6172 2b79 6561 7257 6974 684d 616a 6f72  ar+yearWithMajor
-0001ac00: 6974 792c 7965 6172 2b79 6561 7257 6974  ity,year+yearWit
-0001ac10: 684d 616a 6f72 6974 792c 2779 6561 7227  hMajority,'year'
-0001ac20: 2929 0d0a 2020 2020 636f 6d70 6f73 6974  ))..    composit
-0001ac30: 6520 3d20 6565 2e49 6d61 6765 2863 6f6d  e = ee.Image(com
-0001ac40: 706f 7369 7465 2e66 6972 7374 2829 292e  posite.first()).
-0001ac50: 636c 6970 2873 7475 6479 4172 6561 290d  clip(studyArea).
-0001ac60: 0a0d 0a20 2020 2023 4164 6420 6d65 7461  ...    #Add meta
-0001ac70: 6461 7461 2c20 6361 7374 2074 6f20 696e  data, cast to in
-0001ac80: 7465 6765 722c 2061 6e64 2065 7870 6f72  teger, and expor
-0001ac90: 7420 636f 6d70 6f73 6974 650d 0a20 2020  t composite..   
-0001aca0: 2063 6f6d 706f 7369 7465 203d 2063 6f6d   composite = com
-0001acb0: 706f 7369 7465 2e73 6574 287b 5c0d 0a20  posite.set({\.. 
-0001acc0: 2020 2020 2027 7379 7374 656d 3a74 696d       'system:tim
-0001acd0: 655f 7374 6172 7427 3a20 6565 2e44 6174  e_start': ee.Dat
-0001ace0: 652e 6672 6f6d 594d 4428 7965 6172 2b79  e.fromYMD(year+y
-0001acf0: 6561 7257 6974 684d 616a 6f72 6974 792c  earWithMajority,
-0001ad00: 362c 3129 2e6d 696c 6c69 7328 292c 5c0d  6,1).millis(),\.
-0001ad10: 0a20 2020 2020 2027 7965 6172 4275 6666  .      'yearBuff
-0001ad20: 6572 273a 7469 6d65 6275 6666 6572 5c0d  er':timebuffer\.
-0001ad30: 0a20 2020 207d 290d 0a0d 0a20 2020 2023  .    })....    #
-0001ad40: 4578 706f 7274 2074 6865 2063 6f6d 706f  Export the compo
-0001ad50: 7369 7465 0d0a 2020 2020 2353 6574 2075  site..    #Set u
-0001ad60: 7020 6578 706f 7274 206e 616d 6520 616e  p export name an
-0001ad70: 6420 7061 7468 0d0a 2020 2020 6578 706f  d path..    expo
-0001ad80: 7274 4e61 6d65 203d 206f 7574 7075 744e  rtName = outputN
-0001ad90: 616d 6520 202b 275f 2720 202b 2073 7472  ame  +'_'  + str
-0001ada0: 2869 6e74 2873 7461 7274 5965 6172 5429  (int(startYearT)
-0001adb0: 2920 2b20 275f 2720 2b20 7374 7228 696e  ) + '_' + str(in
-0001adc0: 7428 656e 6459 6561 7254 2929 2b27 5f27  t(endYearT))+'_'
-0001add0: 202b 2073 7472 2869 6e74 2873 7461 7274   + str(int(start
-0001ade0: 4a75 6c69 616e 2929 202b 2027 5f27 202b  Julian)) + '_' +
-0001adf0: 2073 7472 2869 6e74 2865 6e64 4a75 6c69   str(int(endJuli
-0001ae00: 616e 2929 0d0a 0d0a 2020 2020 6578 706f  an))....    expo
-0001ae10: 7274 5061 7468 203d 2065 7870 6f72 7450  rtPath = exportP
-0001ae20: 6174 6852 6f6f 7420 2b20 272f 2720 2b20  athRoot + '/' + 
-0001ae30: 6578 706f 7274 4e61 6d65 0d0a 0d0a 2020  exportName....  
-0001ae40: 2020 6578 706f 7274 546f 4173 7365 7457    exportToAssetW
-0001ae50: 7261 7070 6572 2863 6f6d 706f 7369 7465  rapper(composite
-0001ae60: 2c65 7870 6f72 744e 616d 652c 6578 706f  ,exportName,expo
-0001ae70: 7274 5061 7468 2c27 6d65 616e 272c 7374  rtPath,'mean',st
-0001ae80: 7564 7941 7265 612c 7363 616c 652c 6372  udyArea,scale,cr
-0001ae90: 732c 7472 616e 7366 6f72 6d29 3b0d 0a0d  s,transform);...
-0001aea0: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+0001a810: 2323 2323 2323 2323 230d 0a64 6566 2065  #########..def e
+0001a820: 7870 6f72 7443 6f6c 6c65 6374 696f 6e28  xportCollection(
+0001a830: 6578 706f 7274 5061 7468 526f 6f74 2c6f  exportPathRoot,o
+0001a840: 7574 7075 744e 616d 652c 7374 7564 7941  utputName,studyA
+0001a850: 7265 612c 2063 7273 2c74 7261 6e73 666f  rea, crs,transfo
+0001a860: 726d 2c73 6361 6c65 2c63 6f6c 6c65 6374  rm,scale,collect
+0001a870: 696f 6e2c 7374 6172 7459 6561 722c 656e  ion,startYear,en
+0001a880: 6459 6561 722c 7374 6172 744a 756c 6961  dYear,startJulia
+0001a890: 6e2c 656e 644a 756c 6961 6e2c 636f 6d70  n,endJulian,comp
+0001a8a0: 6f73 6974 696e 6752 6564 7563 6572 2c74  ositingReducer,t
+0001a8b0: 696d 6562 7566 6665 722c 6578 706f 7274  imebuffer,export
+0001a8c0: 4261 6e64 7329 3a0d 0a0d 0a20 2023 5461  Bands):....  #Ta
+0001a8d0: 6b65 2063 6172 6520 6f66 2064 6174 6520  ke care of date 
+0001a8e0: 7772 6170 7069 6e67 0d0a 2020 6461 7465  wrapping..  date
+0001a8f0: 5772 6170 7069 6e67 203d 2077 7261 7044  Wrapping = wrapD
+0001a900: 6174 6573 2873 7461 7274 4a75 6c69 616e  ates(startJulian
+0001a910: 2c65 6e64 4a75 6c69 616e 290d 0a20 2077  ,endJulian)..  w
+0001a920: 7261 704f 6666 7365 7420 3d20 6461 7465  rapOffset = date
+0001a930: 5772 6170 7069 6e67 5b30 5d0d 0a20 2079  Wrapping[0]..  y
+0001a940: 6561 7257 6974 684d 616a 6f72 6974 7920  earWithMajority 
+0001a950: 3d20 6461 7465 5772 6170 7069 6e67 5b31  = dateWrapping[1
+0001a960: 5d0d 0a0d 0a20 2023 436c 6561 6e20 7570  ]....  #Clean up
+0001a970: 206f 7574 7075 7420 6e61 6d65 0d0a 2020   output name..  
+0001a980: 6f75 7470 7574 4e61 6d65 203d 206f 7574  outputName = out
+0001a990: 7075 744e 616d 652e 7265 706c 6163 6528  putName.replace(
+0001a9a0: 272f 5c73 2b2f 6727 2c27 2d27 290d 0a20  '/\s+/g','-').. 
+0001a9b0: 206f 7574 7075 744e 616d 6520 3d20 6f75   outputName = ou
+0001a9c0: 7470 7574 4e61 6d65 2e72 6570 6c61 6365  tputName.replace
+0001a9d0: 2827 2f5c 2f2f 6727 2c27 2d27 290d 0a0d  ('/\//g','-')...
+0001a9e0: 0a20 2023 5365 6c65 6374 2062 616e 6473  .  #Select bands
+0001a9f0: 2066 6f72 2065 7870 6f72 740d 0a20 2063   for export..  c
+0001aa00: 6f6c 6c65 6374 696f 6e20 3d20 636f 6c6c  ollection = coll
+0001aa10: 6563 7469 6f6e 2e73 656c 6563 7428 6578  ection.select(ex
+0001aa20: 706f 7274 4261 6e64 7329 0d0a 0d0a 2020  portBands)....  
+0001aa30: 2349 7465 7261 7465 2061 6372 6f73 7320  #Iterate across 
+0001aa40: 6561 6368 2079 6561 7220 616e 6420 6578  each year and ex
+0001aa50: 706f 7274 2069 6d61 6765 0d0a 2020 666f  port image..  fo
+0001aa60: 7220 7965 6172 2069 6e20 6565 2e4c 6973  r year in ee.Lis
+0001aa70: 742e 7365 7175 656e 6365 2873 7461 7274  t.sequence(start
+0001aa80: 5965 6172 2b74 696d 6562 7566 6665 722c  Year+timebuffer,
+0001aa90: 656e 6459 6561 722d 7469 6d65 6275 6666  endYear-timebuff
+0001aaa0: 6572 292e 6765 7449 6e66 6f28 293a 0d0a  er).getInfo():..
+0001aab0: 2020 2020 7072 696e 7428 2745 7870 6f72      print('Expor
+0001aac0: 7469 6e67 3a27 2c79 6561 7229 0d0a 2020  ting:',year)..  
+0001aad0: 2020 2353 6574 2075 7020 6461 7465 730d    #Set up dates.
+0001aae0: 0a20 2020 2073 7461 7274 5965 6172 5420  .    startYearT 
+0001aaf0: 3d20 7965 6172 2d74 696d 6562 7566 6665  = year-timebuffe
+0001ab00: 720d 0a20 2020 2065 6e64 5965 6172 5420  r..    endYearT 
+0001ab10: 3d20 7965 6172 2b74 696d 6562 7566 6665  = year+timebuffe
+0001ab20: 722b 7965 6172 5769 7468 4d61 6a6f 7269  r+yearWithMajori
+0001ab30: 7479 0d0a 0d0a 2020 2020 2347 6574 2079  ty....    #Get y
+0001ab40: 6561 726c 7920 636f 6d70 6f73 6974 650d  early composite.
+0001ab50: 0a20 2020 2063 6f6d 706f 7369 7465 203d  .    composite =
+0001ab60: 2063 6f6c 6c65 6374 696f 6e2e 6669 6c74   collection.filt
+0001ab70: 6572 2865 652e 4669 6c74 6572 2e63 616c  er(ee.Filter.cal
+0001ab80: 656e 6461 7252 616e 6765 2879 6561 722b  endarRange(year+
+0001ab90: 7965 6172 5769 7468 4d61 6a6f 7269 7479  yearWithMajority
+0001aba0: 2c79 6561 722b 7965 6172 5769 7468 4d61  ,year+yearWithMa
+0001abb0: 6a6f 7269 7479 2c27 7965 6172 2729 290d  jority,'year')).
+0001abc0: 0a20 2020 2063 6f6d 706f 7369 7465 203d  .    composite =
+0001abd0: 2065 652e 496d 6167 6528 636f 6d70 6f73   ee.Image(compos
+0001abe0: 6974 652e 6669 7273 7428 2929 2e63 6c69  ite.first()).cli
+0001abf0: 7028 7374 7564 7941 7265 6129 0d0a 0d0a  p(studyArea)....
+0001ac00: 2020 2020 2341 6464 206d 6574 6164 6174      #Add metadat
+0001ac10: 612c 2063 6173 7420 746f 2069 6e74 6567  a, cast to integ
+0001ac20: 6572 2c20 616e 6420 6578 706f 7274 2063  er, and export c
+0001ac30: 6f6d 706f 7369 7465 0d0a 2020 2020 636f  omposite..    co
+0001ac40: 6d70 6f73 6974 6520 3d20 636f 6d70 6f73  mposite = compos
+0001ac50: 6974 652e 7365 7428 7b5c 0d0a 2020 2020  ite.set({\..    
+0001ac60: 2020 2773 7973 7465 6d3a 7469 6d65 5f73    'system:time_s
+0001ac70: 7461 7274 273a 2065 652e 4461 7465 2e66  tart': ee.Date.f
+0001ac80: 726f 6d59 4d44 2879 6561 722b 7965 6172  romYMD(year+year
+0001ac90: 5769 7468 4d61 6a6f 7269 7479 2c36 2c31  WithMajority,6,1
+0001aca0: 292e 6d69 6c6c 6973 2829 2c5c 0d0a 2020  ).millis(),\..  
+0001acb0: 2020 2020 2779 6561 7242 7566 6665 7227      'yearBuffer'
+0001acc0: 3a74 696d 6562 7566 6665 725c 0d0a 2020  :timebuffer\..  
+0001acd0: 2020 7d29 0d0a 0d0a 2020 2020 2345 7870    })....    #Exp
+0001ace0: 6f72 7420 7468 6520 636f 6d70 6f73 6974  ort the composit
+0001acf0: 650d 0a20 2020 2023 5365 7420 7570 2065  e..    #Set up e
+0001ad00: 7870 6f72 7420 6e61 6d65 2061 6e64 2070  xport name and p
+0001ad10: 6174 680d 0a20 2020 2065 7870 6f72 744e  ath..    exportN
+0001ad20: 616d 6520 3d20 6f75 7470 7574 4e61 6d65  ame = outputName
+0001ad30: 2020 2b27 5f27 2020 2b20 7374 7228 696e    +'_'  + str(in
+0001ad40: 7428 7374 6172 7459 6561 7254 2929 202b  t(startYearT)) +
+0001ad50: 2027 5f27 202b 2073 7472 2869 6e74 2865   '_' + str(int(e
+0001ad60: 6e64 5965 6172 5429 292b 275f 2720 2b20  ndYearT))+'_' + 
+0001ad70: 7374 7228 696e 7428 7374 6172 744a 756c  str(int(startJul
+0001ad80: 6961 6e29 2920 2b20 275f 2720 2b20 7374  ian)) + '_' + st
+0001ad90: 7228 696e 7428 656e 644a 756c 6961 6e29  r(int(endJulian)
+0001ada0: 290d 0a0d 0a20 2020 2065 7870 6f72 7450  )....    exportP
+0001adb0: 6174 6820 3d20 6578 706f 7274 5061 7468  ath = exportPath
+0001adc0: 526f 6f74 202b 2027 2f27 202b 2065 7870  Root + '/' + exp
+0001add0: 6f72 744e 616d 650d 0a0d 0a20 2020 2065  ortName....    e
+0001ade0: 7870 6f72 7454 6f41 7373 6574 5772 6170  xportToAssetWrap
+0001adf0: 7065 7228 636f 6d70 6f73 6974 652c 6578  per(composite,ex
+0001ae00: 706f 7274 4e61 6d65 2c65 7870 6f72 7450  portName,exportP
+0001ae10: 6174 682c 276d 6561 6e27 2c73 7475 6479  ath,'mean',study
+0001ae20: 4172 6561 2c73 6361 6c65 2c63 7273 2c74  Area,scale,crs,t
+0001ae30: 7261 6e73 666f 726d 293b 0d0a 0d0a 2323  ransform);....##
+0001ae40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ae50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ae60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ae70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ae80: 2323 2323 2323 230d 0a23 2323 2323 2323  #######..#######
+0001ae90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001aea0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001aeb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001aec0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001aed0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001aee0: 2323 2323 2323 2323 2323 0d0a 2323 2323  ##########..####
-0001aef0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001af00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001af10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001af20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001af30: 2323 2323 230d 0a23 4675 6e63 7469 6f6e  #####..#Function
-0001af40: 2074 6f20 6578 706f 7274 2063 6f6d 706f   to export compo
-0001af50: 7369 7465 2063 6f6c 6c65 6374 696f 6e0d  site collection.
-0001af60: 0a64 6566 2065 7870 6f72 7443 6f6d 706f  .def exportCompo
-0001af70: 7369 7465 436f 6c6c 6563 7469 6f6e 280d  siteCollection(.
-0001af80: 0a20 2063 6f6c 6c65 6374 696f 6e2c 0d0a  .  collection,..
-0001af90: 2020 6578 706f 7274 5061 7468 526f 6f74    exportPathRoot
-0001afa0: 2c0d 0a20 206f 7574 7075 744e 616d 652c  ,..  outputName,
-0001afb0: 0d0a 2020 6f72 6967 696e 2c0d 0a20 2073  ..  origin,..  s
-0001afc0: 7475 6479 4172 6561 2c0d 0a20 2063 7273  tudyArea,..  crs
-0001afd0: 2c0d 0a20 2074 7261 6e73 666f 726d 2c0d  ,..  transform,.
-0001afe0: 0a20 2073 6361 6c65 2c0d 0a20 2073 7461  .  scale,..  sta
-0001aff0: 7274 5965 6172 2c0d 0a20 2065 6e64 5965  rtYear,..  endYe
-0001b000: 6172 2c0d 0a20 2073 7461 7274 4a75 6c69  ar,..  startJuli
-0001b010: 616e 2c0d 0a20 2065 6e64 4a75 6c69 616e  an,..  endJulian
-0001b020: 2c0d 0a20 2063 6f6d 706f 7369 7469 6e67  ,..  compositing
-0001b030: 4d65 7468 6f64 2c0d 0a20 2074 696d 6562  Method,..  timeb
-0001b040: 7566 6665 722c 0d0a 2020 746f 614f 7253  uffer,..  toaOrS
-0001b050: 522c 0d0a 2020 6e6f 6e44 6976 6964 6542  R,..  nonDivideB
-0001b060: 616e 6473 2c0d 0a20 2065 7870 6f72 7442  ands,..  exportB
-0001b070: 616e 6473 2c0d 0a20 2061 6464 6974 696f  ands,..  additio
-0001b080: 6e61 6c50 726f 7065 7274 7944 6963 7420  nalPropertyDict 
-0001b090: 3d20 4e6f 6e65 293a 0d0a 0d0a 2020 6172  = None):....  ar
-0001b0a0: 6773 203d 2066 6f72 6d61 7441 7267 7328  gs = formatArgs(
-0001b0b0: 6c6f 6361 6c73 2829 290d 0a0d 0a20 2070  locals())....  p
-0001b0c0: 7972 616d 6964 696e 6750 6f6c 6963 7920  yramidingPolicy 
-0001b0d0: 3d20 276d 6561 6e27 0d0a 2020 6461 7465  = 'mean'..  date
-0001b0e0: 5772 6170 7069 6e67 203d 2077 7261 7044  Wrapping = wrapD
-0001b0f0: 6174 6573 2873 7461 7274 4a75 6c69 616e  ates(startJulian
-0001b100: 2c20 656e 644a 756c 6961 6e29 0d0a 2020  , endJulian)..  
-0001b110: 7772 6170 4f66 6673 6574 203d 2064 6174  wrapOffset = dat
-0001b120: 6557 7261 7070 696e 675b 305d 0d0a 2020  eWrapping[0]..  
-0001b130: 7965 6172 5769 7468 4d61 6a6f 7269 7479  yearWithMajority
-0001b140: 203d 2064 6174 6557 7261 7070 696e 675b   = dateWrapping[
-0001b150: 315d 0d0a 0d0a 2020 2343 6c65 616e 2075  1]....  #Clean u
-0001b160: 7020 6f75 7470 7574 206e 616d 650d 0a20  p output name.. 
-0001b170: 206f 7574 7075 744e 616d 6520 3d20 6f75   outputName = ou
-0001b180: 7470 7574 4e61 6d65 2e72 6570 6c61 6365  tputName.replace
-0001b190: 2827 2f5c 732b 2f67 272c 272d 2729 0d0a  ('/\s+/g','-')..
-0001b1a0: 2020 6f75 7470 7574 4e61 6d65 203d 206f    outputName = o
-0001b1b0: 7574 7075 744e 616d 652e 7265 706c 6163  utputName.replac
-0001b1c0: 6528 272f 5c2f 2f67 272c 272d 2729 0d0a  e('/\//g','-')..
-0001b1d0: 0d0a 2020 636f 6c6c 6563 7469 6f6e 203d  ..  collection =
-0001b1e0: 2063 6f6c 6c65 6374 696f 6e2e 7365 6c65   collection.sele
-0001b1f0: 6374 2865 7870 6f72 7442 616e 6473 290d  ct(exportBands).
-0001b200: 0a20 2066 6f72 2079 6561 7220 696e 2065  .  for year in e
-0001b210: 652e 4c69 7374 2e73 6571 7565 6e63 6528  e.List.sequence(
-0001b220: 7374 6172 7459 6561 722b 7469 6d65 6275  startYear+timebu
-0001b230: 6666 6572 2c65 6e64 5965 6172 2d74 696d  ffer,endYear-tim
-0001b240: 6562 7566 6665 7229 2e67 6574 496e 666f  ebuffer).getInfo
-0001b250: 2829 3a0d 0a20 2020 2023 5365 7420 7570  ():..    #Set up
-0001b260: 2064 6174 6573 0d0a 2020 2020 7374 6172   dates..    star
-0001b270: 7459 6561 7254 203d 2079 6561 722d 7469  tYearT = year-ti
-0001b280: 6d65 6275 6666 6572 0d0a 2020 2020 656e  mebuffer..    en
-0001b290: 6459 6561 7254 203d 2079 6561 722b 7469  dYearT = year+ti
-0001b2a0: 6d65 6275 6666 6572 2b79 6561 7257 6974  mebuffer+yearWit
-0001b2b0: 684d 616a 6f72 6974 790d 0a0d 0a20 2020  hMajority....   
-0001b2c0: 2023 4765 7420 7965 6172 6c79 2063 6f6d   #Get yearly com
-0001b2d0: 706f 7369 7465 0d0a 2020 2020 636f 6d70  posite..    comp
-0001b2e0: 6f73 6974 6520 3d20 636f 6c6c 6563 7469  osite = collecti
-0001b2f0: 6f6e 2e66 696c 7465 7228 6565 2e46 696c  on.filter(ee.Fil
-0001b300: 7465 722e 6361 6c65 6e64 6172 5261 6e67  ter.calendarRang
-0001b310: 6528 7965 6172 2b79 6561 7257 6974 684d  e(year+yearWithM
-0001b320: 616a 6f72 6974 792c 2079 6561 722b 7965  ajority, year+ye
-0001b330: 6172 5769 7468 4d61 6a6f 7269 7479 2c20  arWithMajority, 
-0001b340: 2779 6561 7227 2929 0d0a 2020 2020 636f  'year'))..    co
-0001b350: 6d70 6f73 6974 6520 3d20 6565 2e49 6d61  mposite = ee.Ima
-0001b360: 6765 2863 6f6d 706f 7369 7465 2e66 6972  ge(composite.fir
-0001b370: 7374 2829 290d 0a0d 0a20 2020 2023 5265  st())....    #Re
-0001b380: 666f 726d 6174 2064 6174 6120 666f 7220  format data for 
-0001b390: 6578 706f 7274 0d0a 2020 2020 636f 6d70  export..    comp
-0001b3a0: 6f73 6974 6542 616e 6473 203d 2063 6f6d  ositeBands = com
-0001b3b0: 706f 7369 7465 2e62 616e 644e 616d 6573  posite.bandNames
-0001b3c0: 2829 0d0a 2020 2020 6966 206e 6f6e 4469  ()..    if nonDi
-0001b3d0: 7669 6465 4261 6e64 7320 213d 204e 6f6e  videBands != Non
-0001b3e0: 653a 0d0a 2020 2020 2020 636f 6d70 6f73  e:..      compos
-0001b3f0: 6974 6531 306b 203d 2063 6f6d 706f 7369  ite10k = composi
-0001b400: 7465 2e73 656c 6563 7428 636f 6d70 6f73  te.select(compos
-0001b410: 6974 6542 616e 6473 2e72 656d 6f76 6541  iteBands.removeA
-0001b420: 6c6c 286e 6f6e 4469 7669 6465 4261 6e64  ll(nonDivideBand
-0001b430: 7329 292e 6d75 6c74 6970 6c79 2831 3030  s)).multiply(100
-0001b440: 3030 290d 0a20 2020 2020 2063 6f6d 706f  00)..      compo
-0001b450: 7369 7465 203d 2063 6f6d 706f 7369 7465  site = composite
-0001b460: 3130 6b2e 6164 6442 616e 6473 2863 6f6d  10k.addBands(com
-0001b470: 706f 7369 7465 2e73 656c 6563 7428 6e6f  posite.select(no
-0001b480: 6e44 6976 6964 6542 616e 6473 2929 2e73  nDivideBands)).s
-0001b490: 656c 6563 7428 636f 6d70 6f73 6974 6542  elect(compositeB
-0001b4a0: 616e 6473 292e 696e 7431 3628 290d 0a0d  ands).int16()...
-0001b4b0: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
-0001b4c0: 2020 636f 6d70 6f73 6974 6520 3d20 636f    composite = co
-0001b4d0: 6d70 6f73 6974 652e 6d75 6c74 6970 6c79  mposite.multiply
-0001b4e0: 2831 3030 3030 292e 696e 7431 3628 290d  (10000).int16().
-0001b4f0: 0a0d 0a20 2020 2073 7461 7274 5965 6172  ...    startYear
-0001b500: 436f 6d70 6f73 6974 6520 3d20 7374 6172  Composite = star
-0001b510: 7459 6561 7254 0d0a 2020 2020 656e 6459  tYearT..    endY
-0001b520: 6561 7243 6f6d 706f 7369 7465 203d 2065  earComposite = e
-0001b530: 6e64 5965 6172 540d 0a20 2020 2073 7973  ndYearT..    sys
-0001b540: 7465 6d54 696d 6553 7461 7274 5965 6172  temTimeStartYear
-0001b550: 203d 2079 6561 722b 7965 6172 5769 7468   = year+yearWith
-0001b560: 4d61 6a6f 7269 7479 0d0a 2020 2020 7965  Majority..    ye
-0001b570: 6172 4f72 6967 696e 616c 203d 2079 6561  arOriginal = yea
-0001b580: 720d 0a20 2020 2079 6561 7255 7365 6420  r..    yearUsed 
-0001b590: 3d20 7379 7374 656d 5469 6d65 5374 6172  = systemTimeStar
-0001b5a0: 7459 6561 720d 0a20 2020 2023 2061 7267  tYear..    # arg
-0001b5b0: 735b 2773 7973 7465 6d3a 7469 6d65 5f73  s['system:time_s
-0001b5c0: 7461 7274 275d 203d 2065 652e 4461 7465  tart'] = ee.Date
-0001b5d0: 2e66 726f 6d59 4d44 2873 7973 7465 6d54  .fromYMD(systemT
-0001b5e0: 696d 6553 7461 7274 5965 6172 2c20 362c  imeStartYear, 6,
-0001b5f0: 2031 292e 6d69 6c6c 6973 2829 0d0a 0d0a   1).millis()....
-0001b600: 2020 2020 636f 6d70 6f73 6974 6520 3d20      composite = 
-0001b610: 636f 6d70 6f73 6974 652e 7365 7428 666f  composite.set(fo
-0001b620: 726d 6174 4172 6773 2861 7267 7329 290d  rmatArgs(args)).
-0001b630: 0a0d 0a20 2020 2063 6f6d 706f 7369 7465  ...    composite
-0001b640: 203d 2063 6f6d 706f 7369 7465 2e73 6574   = composite.set
-0001b650: 2827 7379 7374 656d 3a74 696d 655f 7374  ('system:time_st
-0001b660: 6172 7427 2c65 652e 4461 7465 2e66 726f  art',ee.Date.fro
-0001b670: 6d59 4d44 2873 7973 7465 6d54 696d 6553  mYMD(systemTimeS
-0001b680: 7461 7274 5965 6172 2c20 362c 2031 292e  tartYear, 6, 1).
-0001b690: 6d69 6c6c 6973 2829 290d 0a0d 0a20 2020  millis())....   
-0001b6a0: 2069 6620 6164 6469 7469 6f6e 616c 5072   if additionalPr
-0001b6b0: 6f70 6572 7479 4469 6374 2021 3d20 4e6f  opertyDict != No
-0001b6c0: 6e65 3a0d 0a20 2020 2020 2069 6620 2761  ne:..      if 'a
-0001b6d0: 7267 7327 2069 6e20 6164 6469 7469 6f6e  rgs' in addition
-0001b6e0: 616c 5072 6f70 6572 7479 4469 6374 2e6b  alPropertyDict.k
-0001b6f0: 6579 7328 293a 0d0a 2020 2020 2020 2020  eys():..        
-0001b700: 6465 6c20 6164 6469 7469 6f6e 616c 5072  del additionalPr
-0001b710: 6f70 6572 7479 4469 6374 5b27 6172 6773  opertyDict['args
-0001b720: 275d 0d0a 2020 2020 2020 636f 6d70 6f73  ']..      compos
-0001b730: 6974 6520 3d20 636f 6d70 6f73 6974 652e  ite = composite.
-0001b740: 7365 7428 666f 726d 6174 4172 6773 2861  set(formatArgs(a
-0001b750: 6464 6974 696f 6e61 6c50 726f 7065 7274  dditionalPropert
-0001b760: 7944 6963 7429 290d 0a0d 0a20 2020 2023  yDict))....    #
-0001b770: 4578 706f 7274 2074 6865 2063 6f6d 706f  Export the compo
-0001b780: 7369 7465 0d0a 2020 2020 2353 6574 2075  site..    #Set u
-0001b790: 7020 6578 706f 7274 206e 616d 6520 616e  p export name an
-0001b7a0: 6420 7061 7468 0d0a 2020 2020 6578 706f  d path..    expo
-0001b7b0: 7274 4e61 6d65 203d 206f 7574 7075 744e  rtName = outputN
-0001b7c0: 616d 6520 202b 2027 5f27 202b 2074 6f61  ame  + '_' + toa
-0001b7d0: 4f72 5352 202b 2027 5f27 202b 2063 6f6d  OrSR + '_' + com
-0001b7e0: 706f 7369 7469 6e67 4d65 7468 6f64 202b  positingMethod +
-0001b7f0: 2027 5f27 2020 2b20 7374 7228 696e 7428   '_'  + str(int(
-0001b800: 7374 6172 7459 6561 7254 2929 202b 2027  startYearT)) + '
-0001b810: 5f27 202b 2073 7472 2869 6e74 2865 6e64  _' + str(int(end
-0001b820: 5965 6172 5429 292b 275f 2720 2b20 7374  YearT))+'_' + st
-0001b830: 7228 696e 7428 7374 6172 744a 756c 6961  r(int(startJulia
-0001b840: 6e29 2920 2b20 275f 2720 2b20 7374 7228  n)) + '_' + str(
-0001b850: 696e 7428 656e 644a 756c 6961 6e29 290d  int(endJulian)).
-0001b860: 0a20 2020 2065 7870 6f72 7450 6174 6820  .    exportPath 
-0001b870: 3d20 6578 706f 7274 5061 7468 526f 6f74  = exportPathRoot
-0001b880: 2b27 2f27 2b65 7870 6f72 744e 616d 650d  +'/'+exportName.
-0001b890: 0a0d 0a0d 0a20 2020 2065 7870 6f72 7454  .....    exportT
-0001b8a0: 6f41 7373 6574 5772 6170 7065 7228 5c0d  oAssetWrapper(\.
-0001b8b0: 0a20 2020 2020 2069 6d61 6765 466f 7245  .      imageForE
-0001b8c0: 7870 6f72 7420 3d20 636f 6d70 6f73 6974  xport = composit
-0001b8d0: 652c 0d0a 2020 2020 2020 6173 7365 744e  e,..      assetN
-0001b8e0: 616d 6520 3d20 6578 706f 7274 4e61 6d65  ame = exportName
-0001b8f0: 2c0d 0a20 2020 2020 2061 7373 6574 5061  ,..      assetPa
-0001b900: 7468 203d 2065 7870 6f72 7450 6174 682c  th = exportPath,
-0001b910: 0d0a 2020 2020 2020 7079 7261 6d69 6469  ..      pyramidi
-0001b920: 6e67 506f 6c69 6379 4f62 6a65 6374 203d  ngPolicyObject =
-0001b930: 2070 7972 616d 6964 696e 6750 6f6c 6963   pyramidingPolic
-0001b940: 792c 0d0a 2020 2020 2020 726f 693d 2073  y,..      roi= s
-0001b950: 7475 6479 4172 6561 2c0d 0a20 2020 2020  tudyArea,..     
-0001b960: 2073 6361 6c65 3d20 7363 616c 652c 0d0a   scale= scale,..
-0001b970: 2020 2020 2020 6372 7320 3d20 6372 732c        crs = crs,
-0001b980: 0d0a 2020 2020 2020 7472 616e 7366 6f72  ..      transfor
-0001b990: 6d20 3d20 7472 616e 7366 6f72 6d29 0d0a  m = transform)..
-0001b9a0: 0d0a 0d0a 2323 2323 2323 2323 2323 2323  ....############
+0001aed0: 2323 0d0a 2346 756e 6374 696f 6e20 746f  ##..#Function to
+0001aee0: 2065 7870 6f72 7420 636f 6d70 6f73 6974   export composit
+0001aef0: 6520 636f 6c6c 6563 7469 6f6e 0d0a 6465  e collection..de
+0001af00: 6620 6578 706f 7274 436f 6d70 6f73 6974  f exportComposit
+0001af10: 6543 6f6c 6c65 6374 696f 6e28 0d0a 2020  eCollection(..  
+0001af20: 636f 6c6c 6563 7469 6f6e 2c0d 0a20 2065  collection,..  e
+0001af30: 7870 6f72 7450 6174 6852 6f6f 742c 0d0a  xportPathRoot,..
+0001af40: 2020 6f75 7470 7574 4e61 6d65 2c0d 0a20    outputName,.. 
+0001af50: 206f 7269 6769 6e2c 0d0a 2020 7374 7564   origin,..  stud
+0001af60: 7941 7265 612c 0d0a 2020 6372 732c 0d0a  yArea,..  crs,..
+0001af70: 2020 7472 616e 7366 6f72 6d2c 0d0a 2020    transform,..  
+0001af80: 7363 616c 652c 0d0a 2020 7374 6172 7459  scale,..  startY
+0001af90: 6561 722c 0d0a 2020 656e 6459 6561 722c  ear,..  endYear,
+0001afa0: 0d0a 2020 7374 6172 744a 756c 6961 6e2c  ..  startJulian,
+0001afb0: 0d0a 2020 656e 644a 756c 6961 6e2c 0d0a  ..  endJulian,..
+0001afc0: 2020 636f 6d70 6f73 6974 696e 674d 6574    compositingMet
+0001afd0: 686f 642c 0d0a 2020 7469 6d65 6275 6666  hod,..  timebuff
+0001afe0: 6572 2c0d 0a20 2074 6f61 4f72 5352 2c0d  er,..  toaOrSR,.
+0001aff0: 0a20 206e 6f6e 4469 7669 6465 4261 6e64  .  nonDivideBand
+0001b000: 732c 0d0a 2020 6578 706f 7274 4261 6e64  s,..  exportBand
+0001b010: 732c 0d0a 2020 6164 6469 7469 6f6e 616c  s,..  additional
+0001b020: 5072 6f70 6572 7479 4469 6374 203d 204e  PropertyDict = N
+0001b030: 6f6e 6529 3a0d 0a0d 0a20 2061 7267 7320  one):....  args 
+0001b040: 3d20 666f 726d 6174 4172 6773 286c 6f63  = formatArgs(loc
+0001b050: 616c 7328 2929 0d0a 0d0a 2020 7079 7261  als())....  pyra
+0001b060: 6d69 6469 6e67 506f 6c69 6379 203d 2027  midingPolicy = '
+0001b070: 6d65 616e 270d 0a20 2064 6174 6557 7261  mean'..  dateWra
+0001b080: 7070 696e 6720 3d20 7772 6170 4461 7465  pping = wrapDate
+0001b090: 7328 7374 6172 744a 756c 6961 6e2c 2065  s(startJulian, e
+0001b0a0: 6e64 4a75 6c69 616e 290d 0a20 2077 7261  ndJulian)..  wra
+0001b0b0: 704f 6666 7365 7420 3d20 6461 7465 5772  pOffset = dateWr
+0001b0c0: 6170 7069 6e67 5b30 5d0d 0a20 2079 6561  apping[0]..  yea
+0001b0d0: 7257 6974 684d 616a 6f72 6974 7920 3d20  rWithMajority = 
+0001b0e0: 6461 7465 5772 6170 7069 6e67 5b31 5d0d  dateWrapping[1].
+0001b0f0: 0a0d 0a20 2023 436c 6561 6e20 7570 206f  ...  #Clean up o
+0001b100: 7574 7075 7420 6e61 6d65 0d0a 2020 6f75  utput name..  ou
+0001b110: 7470 7574 4e61 6d65 203d 206f 7574 7075  tputName = outpu
+0001b120: 744e 616d 652e 7265 706c 6163 6528 272f  tName.replace('/
+0001b130: 5c73 2b2f 6727 2c27 2d27 290d 0a20 206f  \s+/g','-')..  o
+0001b140: 7574 7075 744e 616d 6520 3d20 6f75 7470  utputName = outp
+0001b150: 7574 4e61 6d65 2e72 6570 6c61 6365 2827  utName.replace('
+0001b160: 2f5c 2f2f 6727 2c27 2d27 290d 0a0d 0a20  /\//g','-').... 
+0001b170: 2063 6f6c 6c65 6374 696f 6e20 3d20 636f   collection = co
+0001b180: 6c6c 6563 7469 6f6e 2e73 656c 6563 7428  llection.select(
+0001b190: 6578 706f 7274 4261 6e64 7329 0d0a 2020  exportBands)..  
+0001b1a0: 666f 7220 7965 6172 2069 6e20 6565 2e4c  for year in ee.L
+0001b1b0: 6973 742e 7365 7175 656e 6365 2873 7461  ist.sequence(sta
+0001b1c0: 7274 5965 6172 2b74 696d 6562 7566 6665  rtYear+timebuffe
+0001b1d0: 722c 656e 6459 6561 722d 7469 6d65 6275  r,endYear-timebu
+0001b1e0: 6666 6572 292e 6765 7449 6e66 6f28 293a  ffer).getInfo():
+0001b1f0: 0d0a 2020 2020 2353 6574 2075 7020 6461  ..    #Set up da
+0001b200: 7465 730d 0a20 2020 2073 7461 7274 5965  tes..    startYe
+0001b210: 6172 5420 3d20 7965 6172 2d74 696d 6562  arT = year-timeb
+0001b220: 7566 6665 720d 0a20 2020 2065 6e64 5965  uffer..    endYe
+0001b230: 6172 5420 3d20 7965 6172 2b74 696d 6562  arT = year+timeb
+0001b240: 7566 6665 722b 7965 6172 5769 7468 4d61  uffer+yearWithMa
+0001b250: 6a6f 7269 7479 0d0a 0d0a 2020 2020 2347  jority....    #G
+0001b260: 6574 2079 6561 726c 7920 636f 6d70 6f73  et yearly compos
+0001b270: 6974 650d 0a20 2020 2063 6f6d 706f 7369  ite..    composi
+0001b280: 7465 203d 2063 6f6c 6c65 6374 696f 6e2e  te = collection.
+0001b290: 6669 6c74 6572 2865 652e 4669 6c74 6572  filter(ee.Filter
+0001b2a0: 2e63 616c 656e 6461 7252 616e 6765 2879  .calendarRange(y
+0001b2b0: 6561 722b 7965 6172 5769 7468 4d61 6a6f  ear+yearWithMajo
+0001b2c0: 7269 7479 2c20 7965 6172 2b79 6561 7257  rity, year+yearW
+0001b2d0: 6974 684d 616a 6f72 6974 792c 2027 7965  ithMajority, 'ye
+0001b2e0: 6172 2729 290d 0a20 2020 2063 6f6d 706f  ar'))..    compo
+0001b2f0: 7369 7465 203d 2065 652e 496d 6167 6528  site = ee.Image(
+0001b300: 636f 6d70 6f73 6974 652e 6669 7273 7428  composite.first(
+0001b310: 2929 0d0a 0d0a 2020 2020 2352 6566 6f72  ))....    #Refor
+0001b320: 6d61 7420 6461 7461 2066 6f72 2065 7870  mat data for exp
+0001b330: 6f72 740d 0a20 2020 2063 6f6d 706f 7369  ort..    composi
+0001b340: 7465 4261 6e64 7320 3d20 636f 6d70 6f73  teBands = compos
+0001b350: 6974 652e 6261 6e64 4e61 6d65 7328 290d  ite.bandNames().
+0001b360: 0a20 2020 2069 6620 6e6f 6e44 6976 6964  .    if nonDivid
+0001b370: 6542 616e 6473 2021 3d20 4e6f 6e65 3a0d  eBands != None:.
+0001b380: 0a20 2020 2020 2063 6f6d 706f 7369 7465  .      composite
+0001b390: 3130 6b20 3d20 636f 6d70 6f73 6974 652e  10k = composite.
+0001b3a0: 7365 6c65 6374 2863 6f6d 706f 7369 7465  select(composite
+0001b3b0: 4261 6e64 732e 7265 6d6f 7665 416c 6c28  Bands.removeAll(
+0001b3c0: 6e6f 6e44 6976 6964 6542 616e 6473 2929  nonDivideBands))
+0001b3d0: 2e6d 756c 7469 706c 7928 3130 3030 3029  .multiply(10000)
+0001b3e0: 0d0a 2020 2020 2020 636f 6d70 6f73 6974  ..      composit
+0001b3f0: 6520 3d20 636f 6d70 6f73 6974 6531 306b  e = composite10k
+0001b400: 2e61 6464 4261 6e64 7328 636f 6d70 6f73  .addBands(compos
+0001b410: 6974 652e 7365 6c65 6374 286e 6f6e 4469  ite.select(nonDi
+0001b420: 7669 6465 4261 6e64 7329 292e 7365 6c65  videBands)).sele
+0001b430: 6374 2863 6f6d 706f 7369 7465 4261 6e64  ct(compositeBand
+0001b440: 7329 2e69 6e74 3136 2829 0d0a 0d0a 2020  s).int16()....  
+0001b450: 2020 656c 7365 3a0d 0a20 2020 2020 2063    else:..      c
+0001b460: 6f6d 706f 7369 7465 203d 2063 6f6d 706f  omposite = compo
+0001b470: 7369 7465 2e6d 756c 7469 706c 7928 3130  site.multiply(10
+0001b480: 3030 3029 2e69 6e74 3136 2829 0d0a 0d0a  000).int16()....
+0001b490: 2020 2020 7374 6172 7459 6561 7243 6f6d      startYearCom
+0001b4a0: 706f 7369 7465 203d 2073 7461 7274 5965  posite = startYe
+0001b4b0: 6172 540d 0a20 2020 2065 6e64 5965 6172  arT..    endYear
+0001b4c0: 436f 6d70 6f73 6974 6520 3d20 656e 6459  Composite = endY
+0001b4d0: 6561 7254 0d0a 2020 2020 7379 7374 656d  earT..    system
+0001b4e0: 5469 6d65 5374 6172 7459 6561 7220 3d20  TimeStartYear = 
+0001b4f0: 7965 6172 2b79 6561 7257 6974 684d 616a  year+yearWithMaj
+0001b500: 6f72 6974 790d 0a20 2020 2079 6561 724f  ority..    yearO
+0001b510: 7269 6769 6e61 6c20 3d20 7965 6172 0d0a  riginal = year..
+0001b520: 2020 2020 7965 6172 5573 6564 203d 2073      yearUsed = s
+0001b530: 7973 7465 6d54 696d 6553 7461 7274 5965  ystemTimeStartYe
+0001b540: 6172 0d0a 2020 2020 2320 6172 6773 5b27  ar..    # args['
+0001b550: 7379 7374 656d 3a74 696d 655f 7374 6172  system:time_star
+0001b560: 7427 5d20 3d20 6565 2e44 6174 652e 6672  t'] = ee.Date.fr
+0001b570: 6f6d 594d 4428 7379 7374 656d 5469 6d65  omYMD(systemTime
+0001b580: 5374 6172 7459 6561 722c 2036 2c20 3129  StartYear, 6, 1)
+0001b590: 2e6d 696c 6c69 7328 290d 0a0d 0a20 2020  .millis()....   
+0001b5a0: 2063 6f6d 706f 7369 7465 203d 2063 6f6d   composite = com
+0001b5b0: 706f 7369 7465 2e73 6574 2866 6f72 6d61  posite.set(forma
+0001b5c0: 7441 7267 7328 6172 6773 2929 0d0a 0d0a  tArgs(args))....
+0001b5d0: 2020 2020 636f 6d70 6f73 6974 6520 3d20      composite = 
+0001b5e0: 636f 6d70 6f73 6974 652e 7365 7428 2773  composite.set('s
+0001b5f0: 7973 7465 6d3a 7469 6d65 5f73 7461 7274  ystem:time_start
+0001b600: 272c 6565 2e44 6174 652e 6672 6f6d 594d  ',ee.Date.fromYM
+0001b610: 4428 7379 7374 656d 5469 6d65 5374 6172  D(systemTimeStar
+0001b620: 7459 6561 722c 2036 2c20 3129 2e6d 696c  tYear, 6, 1).mil
+0001b630: 6c69 7328 2929 0d0a 0d0a 2020 2020 6966  lis())....    if
+0001b640: 2061 6464 6974 696f 6e61 6c50 726f 7065   additionalPrope
+0001b650: 7274 7944 6963 7420 213d 204e 6f6e 653a  rtyDict != None:
+0001b660: 0d0a 2020 2020 2020 6966 2027 6172 6773  ..      if 'args
+0001b670: 2720 696e 2061 6464 6974 696f 6e61 6c50  ' in additionalP
+0001b680: 726f 7065 7274 7944 6963 742e 6b65 7973  ropertyDict.keys
+0001b690: 2829 3a0d 0a20 2020 2020 2020 2064 656c  ():..        del
+0001b6a0: 2061 6464 6974 696f 6e61 6c50 726f 7065   additionalPrope
+0001b6b0: 7274 7944 6963 745b 2761 7267 7327 5d0d  rtyDict['args'].
+0001b6c0: 0a20 2020 2020 2063 6f6d 706f 7369 7465  .      composite
+0001b6d0: 203d 2063 6f6d 706f 7369 7465 2e73 6574   = composite.set
+0001b6e0: 2866 6f72 6d61 7441 7267 7328 6164 6469  (formatArgs(addi
+0001b6f0: 7469 6f6e 616c 5072 6f70 6572 7479 4469  tionalPropertyDi
+0001b700: 6374 2929 0d0a 0d0a 2020 2020 2345 7870  ct))....    #Exp
+0001b710: 6f72 7420 7468 6520 636f 6d70 6f73 6974  ort the composit
+0001b720: 650d 0a20 2020 2023 5365 7420 7570 2065  e..    #Set up e
+0001b730: 7870 6f72 7420 6e61 6d65 2061 6e64 2070  xport name and p
+0001b740: 6174 680d 0a20 2020 2065 7870 6f72 744e  ath..    exportN
+0001b750: 616d 6520 3d20 6f75 7470 7574 4e61 6d65  ame = outputName
+0001b760: 2020 2b20 275f 2720 2b20 746f 614f 7253    + '_' + toaOrS
+0001b770: 5220 2b20 275f 2720 2b20 636f 6d70 6f73  R + '_' + compos
+0001b780: 6974 696e 674d 6574 686f 6420 2b20 275f  itingMethod + '_
+0001b790: 2720 202b 2073 7472 2869 6e74 2873 7461  '  + str(int(sta
+0001b7a0: 7274 5965 6172 5429 2920 2b20 275f 2720  rtYearT)) + '_' 
+0001b7b0: 2b20 7374 7228 696e 7428 656e 6459 6561  + str(int(endYea
+0001b7c0: 7254 2929 2b27 5f27 202b 2073 7472 2869  rT))+'_' + str(i
+0001b7d0: 6e74 2873 7461 7274 4a75 6c69 616e 2929  nt(startJulian))
+0001b7e0: 202b 2027 5f27 202b 2073 7472 2869 6e74   + '_' + str(int
+0001b7f0: 2865 6e64 4a75 6c69 616e 2929 0d0a 2020  (endJulian))..  
+0001b800: 2020 6578 706f 7274 5061 7468 203d 2065    exportPath = e
+0001b810: 7870 6f72 7450 6174 6852 6f6f 742b 272f  xportPathRoot+'/
+0001b820: 272b 6578 706f 7274 4e61 6d65 0d0a 0d0a  '+exportName....
+0001b830: 0d0a 2020 2020 6578 706f 7274 546f 4173  ..    exportToAs
+0001b840: 7365 7457 7261 7070 6572 285c 0d0a 2020  setWrapper(\..  
+0001b850: 2020 2020 696d 6167 6546 6f72 4578 706f      imageForExpo
+0001b860: 7274 203d 2063 6f6d 706f 7369 7465 2c0d  rt = composite,.
+0001b870: 0a20 2020 2020 2061 7373 6574 4e61 6d65  .      assetName
+0001b880: 203d 2065 7870 6f72 744e 616d 652c 0d0a   = exportName,..
+0001b890: 2020 2020 2020 6173 7365 7450 6174 6820        assetPath 
+0001b8a0: 3d20 6578 706f 7274 5061 7468 2c0d 0a20  = exportPath,.. 
+0001b8b0: 2020 2020 2070 7972 616d 6964 696e 6750       pyramidingP
+0001b8c0: 6f6c 6963 794f 626a 6563 7420 3d20 7079  olicyObject = py
+0001b8d0: 7261 6d69 6469 6e67 506f 6c69 6379 2c0d  ramidingPolicy,.
+0001b8e0: 0a20 2020 2020 2072 6f69 3d20 7374 7564  .      roi= stud
+0001b8f0: 7941 7265 612c 0d0a 2020 2020 2020 7363  yArea,..      sc
+0001b900: 616c 653d 2073 6361 6c65 2c0d 0a20 2020  ale= scale,..   
+0001b910: 2020 2063 7273 203d 2063 7273 2c0d 0a20     crs = crs,.. 
+0001b920: 2020 2020 2074 7261 6e73 666f 726d 203d       transform =
+0001b930: 2074 7261 6e73 666f 726d 290d 0a0d 0a0d   transform).....
+0001b940: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+0001b950: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001b960: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001b970: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001b980: 2323 2323 2323 2323 2323 0d0a 2323 2323  ##########..####
+0001b990: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001b9a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b9b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b9c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001b9d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001b9e0: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
-0001b9f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001ba00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001ba10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001ba20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001ba30: 2323 2323 2323 2323 0d0a 2357 7261 7070  ########..#Wrapp
-0001ba40: 6572 2066 756e 6374 696f 6e20 666f 7220  er function for 
-0001ba50: 6765 7474 696e 6720 4c61 6e64 7361 7420  getting Landsat 
-0001ba60: 696d 6167 6572 790d 0a64 6566 2067 6574  imagery..def get
-0001ba70: 4c61 6e64 7361 7457 7261 7070 6572 280d  LandsatWrapper(.
-0001ba80: 0a20 2073 7475 6479 4172 6561 2c0d 0a20  .  studyArea,.. 
-0001ba90: 2073 7461 7274 5965 6172 2c0d 0a20 2065   startYear,..  e
-0001baa0: 6e64 5965 6172 2c0d 0a20 2073 7461 7274  ndYear,..  start
-0001bab0: 4a75 6c69 616e 2c0d 0a20 2065 6e64 4a75  Julian,..  endJu
-0001bac0: 6c69 616e 2c0d 0a20 2074 696d 6562 7566  lian,..  timebuf
-0001bad0: 6665 7220 3d20 302c 0d0a 2020 7765 6967  fer = 0,..  weig
-0001bae0: 6874 7320 3d20 5b31 5d2c 0d0a 2020 636f  hts = [1],..  co
-0001baf0: 6d70 6f73 6974 696e 674d 6574 686f 6420  mpositingMethod 
-0001bb00: 3d20 276d 6564 6f69 6427 2c0d 0a20 2074  = 'medoid',..  t
-0001bb10: 6f61 4f72 5352 203d 2027 5352 272c 0d0a  oaOrSR = 'SR',..
-0001bb20: 2020 696e 636c 7564 6553 4c43 4f66 664c    includeSLCOffL
-0001bb30: 3720 3d20 4661 6c73 652c 0d0a 2020 6465  7 = False,..  de
-0001bb40: 6672 696e 6765 4c35 203d 2046 616c 7365  fringeL5 = False
-0001bb50: 2c0d 0a20 2061 7070 6c79 436c 6f75 6453  ,..  applyCloudS
-0001bb60: 636f 7265 203d 2046 616c 7365 2c0d 0a20  core = False,.. 
-0001bb70: 2061 7070 6c79 466d 6173 6b43 6c6f 7564   applyFmaskCloud
-0001bb80: 4d61 736b 203d 2054 7275 652c 0d0a 2020  Mask = True,..  
-0001bb90: 6170 706c 7954 444f 4d20 3d20 4661 6c73  applyTDOM = Fals
-0001bba0: 652c 0d0a 2020 6170 706c 7946 6d61 736b  e,..  applyFmask
-0001bbb0: 436c 6f75 6453 6861 646f 774d 6173 6b20  CloudShadowMask 
-0001bbc0: 3d20 5472 7565 2c0d 0a20 2061 7070 6c79  = True,..  apply
-0001bbd0: 466d 6173 6b53 6e6f 774d 6173 6b20 3d20  FmaskSnowMask = 
-0001bbe0: 4661 6c73 652c 0d0a 2020 636c 6f75 6453  False,..  cloudS
-0001bbf0: 636f 7265 5468 7265 7368 203d 2031 302c  coreThresh = 10,
-0001bc00: 0d0a 2020 7065 7266 6f72 6d43 6c6f 7564  ..  performCloud
-0001bc10: 5363 6f72 654f 6666 7365 7420 3d20 5472  ScoreOffset = Tr
-0001bc20: 7565 2c0d 0a20 2063 6c6f 7564 5363 6f72  ue,..  cloudScor
-0001bc30: 6550 6374 6c20 3d20 3130 2c0d 0a20 207a  ePctl = 10,..  z
-0001bc40: 5363 6f72 6554 6872 6573 6820 3d20 2d31  ScoreThresh = -1
-0001bc50: 2c0d 0a20 2073 6861 646f 7753 756d 5468  ,..  shadowSumTh
-0001bc60: 7265 7368 203d 2030 2e33 352c 0d0a 2020  resh = 0.35,..  
-0001bc70: 636f 6e74 7261 6374 5069 7865 6c73 203d  contractPixels =
-0001bc80: 2031 2e35 2c0d 0a20 2064 696c 6174 6550   1.5,..  dilateP
-0001bc90: 6978 656c 7320 3d20 332e 352c 0d0a 2020  ixels = 3.5,..  
-0001bca0: 636f 7272 6563 7449 6c6c 756d 696e 6174  correctIlluminat
-0001bcb0: 696f 6e20 3d20 4661 6c73 652c 0d0a 2020  ion = False,..  
-0001bcc0: 636f 7272 6563 7453 6361 6c65 203d 2032  correctScale = 2
-0001bcd0: 3530 2c0d 0a20 2065 7870 6f72 7443 6f6d  50,..  exportCom
-0001bce0: 706f 7369 7465 7320 3d20 4661 6c73 652c  posites = False,
-0001bcf0: 0d0a 2020 6f75 7470 7574 4e61 6d65 203d  ..  outputName =
-0001bd00: 2027 4c61 6e64 7361 742d 436f 6d70 6f73   'Landsat-Compos
-0001bd10: 6974 6527 2c0d 0a20 2065 7870 6f72 7450  ite',..  exportP
-0001bd20: 6174 6852 6f6f 7420 3d20 2775 7365 7273  athRoot = 'users
-0001bd30: 2f69 616e 686f 7573 6d61 6e2f 7465 7374  /ianhousman/test
-0001bd40: 272c 0d0a 2020 6372 7320 3d20 2745 5053  ',..  crs = 'EPS
-0001bd50: 473a 3530 3730 272c 0d0a 2020 7472 616e  G:5070',..  tran
-0001bd60: 7366 6f72 6d20 3d20 5b33 302c 302c 2d32  sform = [30,0,-2
-0001bd70: 3336 3139 3135 2e30 2c30 2c2d 3330 2c33  361915.0,0,-30,3
-0001bd80: 3137 3737 3335 2e30 5d2c 0d0a 2020 7363  177735.0],..  sc
-0001bd90: 616c 6520 3d20 4e6f 6e65 2c0d 0a20 2072  ale = None,..  r
-0001bda0: 6573 616d 706c 654d 6574 686f 6420 3d20  esampleMethod = 
-0001bdb0: 276e 6561 7227 2c0d 0a20 2070 7265 436f  'near',..  preCo
-0001bdc0: 6d70 7574 6564 436c 6f75 6453 636f 7265  mputedCloudScore
-0001bdd0: 4f66 6673 6574 203d 204e 6f6e 652c 0d0a  Offset = None,..
-0001bde0: 2020 7072 6543 6f6d 7075 7465 6454 444f    preComputedTDO
-0001bdf0: 4d49 524d 6561 6e20 3d20 4e6f 6e65 2c0d  MIRMean = None,.
-0001be00: 0a20 2070 7265 436f 6d70 7574 6564 5444  .  preComputedTD
-0001be10: 4f4d 4952 5374 6444 6576 203d 204e 6f6e  OMIRStdDev = Non
-0001be20: 652c 0d0a 2020 636f 6d70 6f73 6974 696e  e,..  compositin
-0001be30: 6752 6564 7563 6572 203d 204e 6f6e 652c  gReducer = None,
-0001be40: 0d0a 2020 6861 726d 6f6e 697a 654f 4c49  ..  harmonizeOLI
-0001be50: 203d 2046 616c 7365 2c0d 0a20 206c 616e   = False,..  lan
-0001be60: 6473 6174 436f 6c6c 6563 7469 6f6e 5665  dsatCollectionVe
-0001be70: 7273 696f 6e20 3d20 2743 3227 293a 0d0a  rsion = 'C2'):..
-0001be80: 0d0a 2020 746f 614f 7253 5220 3d20 746f  ..  toaOrSR = to
-0001be90: 614f 7253 522e 7570 7065 7228 290d 0a20  aOrSR.upper().. 
-0001bea0: 206f 7269 6769 6e20 3d20 274c 616e 6473   origin = 'Lands
-0001beb0: 6174 270d 0a20 2061 7267 7320 3d20 666f  at'..  args = fo
-0001bec0: 726d 6174 4172 6773 286c 6f63 616c 7328  rmatArgs(locals(
-0001bed0: 2929 0d0a 2020 6966 2027 6172 6773 2720  ))..  if 'args' 
-0001bee0: 696e 2061 7267 732e 6b65 7973 2829 3a0d  in args.keys():.
-0001bef0: 0a20 2020 2064 656c 2061 7267 735b 2761  .    del args['a
-0001bf00: 7267 7327 5d0d 0a0d 0a20 2023 5072 6570  rgs']....  #Prep
-0001bf10: 6172 6520 6461 7465 730d 0a20 2077 7261  are dates..  wra
-0001bf20: 704f 6666 7365 7420 3d20 300d 0a20 2069  pOffset = 0..  i
-0001bf30: 6620 7374 6172 744a 756c 6961 6e20 3e20  f startJulian > 
-0001bf40: 656e 644a 756c 6961 6e3a 0d0a 2020 2020  endJulian:..    
-0001bf50: 7772 6170 4f66 6673 6574 203d 2033 3635  wrapOffset = 365
-0001bf60: 0d0a 2020 7374 6172 7444 6174 6520 3d20  ..  startDate = 
-0001bf70: 6565 2e44 6174 652e 6672 6f6d 594d 4428  ee.Date.fromYMD(
-0001bf80: 7374 6172 7459 6561 722c 312c 3129 2e61  startYear,1,1).a
-0001bf90: 6476 616e 6365 2873 7461 7274 4a75 6c69  dvance(startJuli
-0001bfa0: 616e 2d31 2c27 6461 7927 290d 0a20 2065  an-1,'day')..  e
-0001bfb0: 6e64 4461 7465 203d 2065 652e 4461 7465  ndDate = ee.Date
-0001bfc0: 2e66 726f 6d59 4d44 2865 6e64 5965 6172  .fromYMD(endYear
-0001bfd0: 2c31 2c31 292e 6164 7661 6e63 6528 656e  ,1,1).advance(en
-0001bfe0: 644a 756c 6961 6e2d 312b 7772 6170 4f66  dJulian-1+wrapOf
-0001bff0: 6673 6574 2c27 6461 7927 290d 0a0d 0a20  fset,'day').... 
-0001c000: 2023 2047 6574 204c 616e 6473 6174 2069   # Get Landsat i
-0001c010: 6d61 6765 2063 6f6c 6c65 6374 696f 6e20  mage collection 
-0001c020: 616e 6420 6170 706c 7920 636c 6f75 6420  and apply cloud 
-0001c030: 6d61 736b 696e 670d 0a20 206c 7320 3d20  masking..  ls = 
-0001c040: 6765 7450 726f 6365 7373 6564 4c61 6e64  getProcessedLand
-0001c050: 7361 7453 6365 6e65 7328 0d0a 2020 2020  satScenes(..    
-0001c060: 7374 7564 7941 7265 6120 3d20 7374 7564  studyArea = stud
-0001c070: 7941 7265 612c 0d0a 2020 2020 7374 6172  yArea,..    star
-0001c080: 7459 6561 7220 3d20 7374 6172 7459 6561  tYear = startYea
-0001c090: 722c 0d0a 2020 2020 656e 6459 6561 7220  r,..    endYear 
-0001c0a0: 3d20 656e 6459 6561 722c 0d0a 2020 2020  = endYear,..    
-0001c0b0: 7374 6172 744a 756c 6961 6e20 3d20 7374  startJulian = st
-0001c0c0: 6172 744a 756c 6961 6e2c 0d0a 2020 2020  artJulian,..    
-0001c0d0: 656e 644a 756c 6961 6e20 3d20 656e 644a  endJulian = endJ
-0001c0e0: 756c 6961 6e2c 0d0a 2020 2020 746f 614f  ulian,..    toaO
-0001c0f0: 7253 5220 3d20 746f 614f 7253 522c 0d0a  rSR = toaOrSR,..
-0001c100: 2020 2020 696e 636c 7564 6553 4c43 4f66      includeSLCOf
-0001c110: 664c 3720 3d20 696e 636c 7564 6553 4c43  fL7 = includeSLC
-0001c120: 4f66 664c 372c 0d0a 2020 2020 6465 6672  OffL7,..    defr
-0001c130: 696e 6765 4c35 203d 2064 6566 7269 6e67  ingeL5 = defring
-0001c140: 654c 352c 0d0a 2020 2020 6170 706c 7943  eL5,..    applyC
-0001c150: 6c6f 7564 5363 6f72 6520 3d20 6170 706c  loudScore = appl
-0001c160: 7943 6c6f 7564 5363 6f72 652c 0d0a 2020  yCloudScore,..  
-0001c170: 2020 6170 706c 7946 6d61 736b 436c 6f75    applyFmaskClou
-0001c180: 644d 6173 6b20 3d20 6170 706c 7946 6d61  dMask = applyFma
-0001c190: 736b 436c 6f75 644d 6173 6b2c 0d0a 2020  skCloudMask,..  
-0001c1a0: 2020 6170 706c 7954 444f 4d20 3d20 6170    applyTDOM = ap
-0001c1b0: 706c 7954 444f 4d2c 0d0a 2020 2020 6170  plyTDOM,..    ap
-0001c1c0: 706c 7946 6d61 736b 436c 6f75 6453 6861  plyFmaskCloudSha
-0001c1d0: 646f 774d 6173 6b20 3d20 6170 706c 7946  dowMask = applyF
-0001c1e0: 6d61 736b 436c 6f75 6453 6861 646f 774d  maskCloudShadowM
-0001c1f0: 6173 6b2c 0d0a 2020 2020 6170 706c 7946  ask,..    applyF
-0001c200: 6d61 736b 536e 6f77 4d61 736b 203d 2061  maskSnowMask = a
-0001c210: 7070 6c79 466d 6173 6b53 6e6f 774d 6173  pplyFmaskSnowMas
-0001c220: 6b2c 0d0a 2020 2020 636c 6f75 6453 636f  k,..    cloudSco
-0001c230: 7265 5468 7265 7368 203d 2063 6c6f 7564  reThresh = cloud
-0001c240: 5363 6f72 6554 6872 6573 682c 0d0a 2020  ScoreThresh,..  
-0001c250: 2020 7065 7266 6f72 6d43 6c6f 7564 5363    performCloudSc
-0001c260: 6f72 654f 6666 7365 7420 3d20 7065 7266  oreOffset = perf
-0001c270: 6f72 6d43 6c6f 7564 5363 6f72 654f 6666  ormCloudScoreOff
-0001c280: 7365 742c 0d0a 2020 2020 636c 6f75 6453  set,..    cloudS
-0001c290: 636f 7265 5063 746c 203d 2063 6c6f 7564  corePctl = cloud
-0001c2a0: 5363 6f72 6550 6374 6c2c 0d0a 2020 2020  ScorePctl,..    
-0001c2b0: 7a53 636f 7265 5468 7265 7368 203d 207a  zScoreThresh = z
-0001c2c0: 5363 6f72 6554 6872 6573 682c 0d0a 2020  ScoreThresh,..  
-0001c2d0: 2020 7368 6164 6f77 5375 6d54 6872 6573    shadowSumThres
-0001c2e0: 6820 3d20 7368 6164 6f77 5375 6d54 6872  h = shadowSumThr
-0001c2f0: 6573 682c 0d0a 2020 2020 636f 6e74 7261  esh,..    contra
-0001c300: 6374 5069 7865 6c73 203d 2063 6f6e 7472  ctPixels = contr
-0001c310: 6163 7450 6978 656c 732c 0d0a 2020 2020  actPixels,..    
-0001c320: 6469 6c61 7465 5069 7865 6c73 203d 2064  dilatePixels = d
-0001c330: 696c 6174 6550 6978 656c 732c 0d0a 2020  ilatePixels,..  
-0001c340: 2020 7265 7361 6d70 6c65 4d65 7468 6f64    resampleMethod
-0001c350: 203d 2072 6573 616d 706c 654d 6574 686f   = resampleMetho
-0001c360: 642c 0d0a 2020 2020 6861 726d 6f6e 697a  d,..    harmoniz
-0001c370: 654f 4c49 203d 2068 6172 6d6f 6e69 7a65  eOLI = harmonize
-0001c380: 4f4c 492c 0d0a 2020 2020 7072 6543 6f6d  OLI,..    preCom
-0001c390: 7075 7465 6443 6c6f 7564 5363 6f72 654f  putedCloudScoreO
-0001c3a0: 6666 7365 7420 3d20 7072 6543 6f6d 7075  ffset = preCompu
-0001c3b0: 7465 6443 6c6f 7564 5363 6f72 654f 6666  tedCloudScoreOff
-0001c3c0: 7365 742c 0d0a 2020 2020 7072 6543 6f6d  set,..    preCom
-0001c3d0: 7075 7465 6454 444f 4d49 524d 6561 6e20  putedTDOMIRMean 
-0001c3e0: 3d20 7072 6543 6f6d 7075 7465 6454 444f  = preComputedTDO
-0001c3f0: 4d49 524d 6561 6e2c 0d0a 2020 2020 7072  MIRMean,..    pr
-0001c400: 6543 6f6d 7075 7465 6454 444f 4d49 5253  eComputedTDOMIRS
-0001c410: 7464 4465 7620 3d20 7072 6543 6f6d 7075  tdDev = preCompu
-0001c420: 7465 6454 444f 4d49 5253 7464 4465 762c  tedTDOMIRStdDev,
-0001c430: 0d0a 2020 2020 6c61 6e64 7361 7443 6f6c  ..    landsatCol
-0001c440: 6c65 6374 696f 6e56 6572 7369 6f6e 203d  lectionVersion =
-0001c450: 206c 616e 6473 6174 436f 6c6c 6563 7469   landsatCollecti
-0001c460: 6f6e 5665 7273 696f 6e29 0d0a 0d0a 2020  onVersion)....  
-0001c470: 2341 6464 207a 656e 6974 6820 616e 6420  #Add zenith and 
-0001c480: 617a 696d 7574 680d 0a20 2069 6620 636f  azimuth..  if co
-0001c490: 7272 6563 7449 6c6c 756d 696e 6174 696f  rrectIlluminatio
-0001c4a0: 6e3a 0d0a 2020 2020 7072 696e 7428 2741  n:..    print('A
-0001c4b0: 6464 696e 6720 7a65 6e69 7468 2061 6e64  dding zenith and
-0001c4c0: 2061 7a69 6d75 7468 2066 6f72 2074 6572   azimuth for ter
-0001c4d0: 7261 696e 2063 6f72 7265 6374 696f 6e27  rain correction'
-0001c4e0: 290d 0a20 2020 206c 7320 3d20 6c73 2e6d  )..    ls = ls.m
-0001c4f0: 6170 286c 616d 6264 6120 696d 673a 2061  ap(lambda img: a
-0001c500: 6464 5a65 6e69 7468 417a 696d 7574 6828  ddZenithAzimuth(
-0001c510: 696d 672c 2074 6f61 4f72 5352 2929 0d0a  img, toaOrSR))..
-0001c520: 0d0a 2020 2343 7265 6174 6520 636f 6d70  ..  #Create comp
-0001c530: 6f73 6974 6520 7469 6d65 2073 6572 6965  osite time serie
-0001c540: 730d 0a20 2074 7320 3d20 636f 6d70 6f73  s..  ts = compos
-0001c550: 6974 6554 696d 6553 6572 6965 7328 5c0d  iteTimeSeries(\.
-0001c560: 0a20 2020 206c 7320 3d20 6c73 2c0d 0a20  .    ls = ls,.. 
-0001c570: 2020 2073 7461 7274 5965 6172 203d 2073     startYear = s
-0001c580: 7461 7274 5965 6172 2c0d 0a20 2020 2065  tartYear,..    e
-0001c590: 6e64 5965 6172 203d 2065 6e64 5965 6172  ndYear = endYear
-0001c5a0: 2c0d 0a20 2020 2073 7461 7274 4a75 6c69  ,..    startJuli
-0001c5b0: 616e 203d 2073 7461 7274 4a75 6c69 616e  an = startJulian
-0001c5c0: 2c0d 0a20 2020 2065 6e64 4a75 6c69 616e  ,..    endJulian
-0001c5d0: 203d 2065 6e64 4a75 6c69 616e 2c0d 0a20   = endJulian,.. 
-0001c5e0: 2020 2074 696d 6562 7566 6665 7220 3d20     timebuffer = 
-0001c5f0: 7469 6d65 6275 6666 6572 2c0d 0a20 2020  timebuffer,..   
-0001c600: 2077 6569 6768 7473 203d 2077 6569 6768   weights = weigh
-0001c610: 7473 2c0d 0a20 2020 2063 6f6d 706f 7369  ts,..    composi
-0001c620: 7469 6e67 4d65 7468 6f64 203d 2063 6f6d  tingMethod = com
-0001c630: 706f 7369 7469 6e67 4d65 7468 6f64 2c0d  positingMethod,.
-0001c640: 0a20 2020 2063 6f6d 706f 7369 7469 6e67  .    compositing
-0001c650: 5265 6475 6365 7220 3d20 636f 6d70 6f73  Reducer = compos
-0001c660: 6974 696e 6752 6564 7563 6572 290d 0a0d  itingReducer)...
-0001c670: 0a20 2023 2043 6f72 7265 6374 2069 6c6c  .  # Correct ill
-0001c680: 756d 696e 6174 696f 6e0d 0a20 2069 6620  umination..  if 
-0001c690: 636f 7272 6563 7449 6c6c 756d 696e 6174  correctIlluminat
-0001c6a0: 696f 6e3a 0d0a 2020 2020 7072 696e 7428  ion:..    print(
-0001c6b0: 2743 6f72 7265 6374 696e 6720 696c 6c75  'Correcting illu
-0001c6c0: 6d69 6e61 7469 6f6e 2729 3b0d 0a20 2020  mination');..   
-0001c6d0: 2074 7320 3d20 7473 2e6d 6170 2869 6c6c   ts = ts.map(ill
-0001c6e0: 756d 696e 6174 696f 6e43 6f6e 6469 7469  uminationConditi
-0001c6f0: 6f6e 292e 6d61 7028 6c61 6d62 6461 2069  on).map(lambda i
-0001c700: 6d67 3a20 696c 6c75 6d69 6e61 7469 6f6e  mg: illumination
-0001c710: 436f 7272 6563 7469 6f6e 2869 6d67 2c20  Correction(img, 
-0001c720: 636f 7272 6563 7453 6361 6c65 2c20 7374  correctScale, st
-0001c730: 7564 7941 7265 6129 290d 0a0d 0a20 2023  udyArea))....  #
-0001c740: 4578 706f 7274 2063 6f6d 706f 7369 7465  Export composite
-0001c750: 730d 0a20 2069 6620 6578 706f 7274 436f  s..  if exportCo
-0001c760: 6d70 6f73 6974 6573 3a0d 0a20 2020 2069  mposites:..    i
-0001c770: 6620 636f 6d70 6f73 6974 696e 674d 6574  f compositingMet
-0001c780: 686f 6420 3d3d 2027 6d65 646f 6964 273a  hod == 'medoid':
-0001c790: 0d0a 2020 2020 2020 6578 706f 7274 4261  ..      exportBa
-0001c7a0: 6e64 7320 3d20 5b27 626c 7565 272c 2027  nds = ['blue', '
-0001c7b0: 6772 6565 6e27 2c20 2772 6564 272c 2027  green', 'red', '
-0001c7c0: 6e69 7227 2c20 2773 7769 7231 272c 2027  nir', 'swir1', '
-0001c7d0: 7377 6972 3227 2c20 2774 656d 7027 2c20  swir2', 'temp', 
-0001c7e0: 2763 6f6d 706f 7369 7465 4f62 7343 6f75  'compositeObsCou
-0001c7f0: 6e74 272c 2027 7365 6e73 6f72 272c 2027  nt', 'sensor', '
-0001c800: 7965 6172 272c 2027 6a75 6c69 616e 4461  year', 'julianDa
-0001c810: 7927 5d0d 0a20 2020 2020 206e 6f6e 4469  y']..      nonDi
-0001c820: 7669 6465 4261 6e64 7320 3d20 5b27 7465  videBands = ['te
-0001c830: 6d70 272c 2027 636f 6d70 6f73 6974 654f  mp', 'compositeO
-0001c840: 6273 436f 756e 7427 2c20 2773 656e 736f  bsCount', 'senso
-0001c850: 7227 2c20 2779 6561 7227 2c20 276a 756c  r', 'year', 'jul
-0001c860: 6961 6e44 6179 275d 0d0a 2020 2020 656c  ianDay']..    el
-0001c870: 7365 3a0d 0a20 2020 2020 2065 7870 6f72  se:..      expor
-0001c880: 7442 616e 6473 203d 205b 2762 6c75 6527  tBands = ['blue'
-0001c890: 2c20 2767 7265 656e 272c 2027 7265 6427  , 'green', 'red'
-0001c8a0: 2c20 276e 6972 272c 2027 7377 6972 3127  , 'nir', 'swir1'
-0001c8b0: 2c20 2773 7769 7232 272c 2027 7465 6d70  , 'swir2', 'temp
-0001c8c0: 272c 2027 636f 6d70 6f73 6974 654f 6273  ', 'compositeObs
-0001c8d0: 436f 756e 7427 5d0d 0a20 2020 2020 206e  Count']..      n
-0001c8e0: 6f6e 4469 7669 6465 4261 6e64 7320 3d20  onDivideBands = 
-0001c8f0: 5b27 7465 6d70 272c 2027 636f 6d70 6f73  ['temp', 'compos
-0001c900: 6974 654f 6273 436f 756e 7427 5d0d 0a0d  iteObsCount']...
-0001c910: 0a20 2020 2065 7870 6f72 7443 6f6d 706f  .    exportCompo
-0001c920: 7369 7465 436f 6c6c 6563 7469 6f6e 285c  siteCollection(\
-0001c930: 0d0a 2020 2020 2020 636f 6c6c 6563 7469  ..      collecti
-0001c940: 6f6e 203d 2074 732c 0d0a 2020 2020 2020  on = ts,..      
-0001c950: 6578 706f 7274 5061 7468 526f 6f74 203d  exportPathRoot =
-0001c960: 2065 7870 6f72 7450 6174 6852 6f6f 742c   exportPathRoot,
-0001c970: 0d0a 2020 2020 2020 6f75 7470 7574 4e61  ..      outputNa
-0001c980: 6d65 203d 206f 7574 7075 744e 616d 652c  me = outputName,
-0001c990: 0d0a 2020 2020 2020 6f72 6967 696e 203d  ..      origin =
-0001c9a0: 206f 7269 6769 6e2c 0d0a 2020 2020 2020   origin,..      
-0001c9b0: 7374 7564 7941 7265 6120 3d20 7374 7564  studyArea = stud
-0001c9c0: 7941 7265 612c 0d0a 2020 2020 2020 6372  yArea,..      cr
-0001c9d0: 7320 3d20 6372 732c 0d0a 2020 2020 2020  s = crs,..      
-0001c9e0: 7472 616e 7366 6f72 6d20 3d20 7472 616e  transform = tran
-0001c9f0: 7366 6f72 6d2c 0d0a 2020 2020 2020 7363  sform,..      sc
-0001ca00: 616c 6520 3d20 7363 616c 652c 0d0a 2020  ale = scale,..  
-0001ca10: 2020 2020 7374 6172 7459 6561 7220 3d20      startYear = 
-0001ca20: 7374 6172 7459 6561 722c 0d0a 2020 2020  startYear,..    
-0001ca30: 2020 656e 6459 6561 7220 3d20 656e 6459    endYear = endY
-0001ca40: 6561 722c 0d0a 2020 2020 2020 7374 6172  ear,..      star
-0001ca50: 744a 756c 6961 6e20 3d20 7374 6172 744a  tJulian = startJ
-0001ca60: 756c 6961 6e2c 0d0a 2020 2020 2020 656e  ulian,..      en
-0001ca70: 644a 756c 6961 6e20 3d20 656e 644a 756c  dJulian = endJul
-0001ca80: 6961 6e2c 0d0a 2020 2020 2020 636f 6d70  ian,..      comp
-0001ca90: 6f73 6974 696e 674d 6574 686f 6420 3d20  ositingMethod = 
-0001caa0: 636f 6d70 6f73 6974 696e 674d 6574 686f  compositingMetho
-0001cab0: 642c 0d0a 2020 2020 2020 7469 6d65 6275  d,..      timebu
-0001cac0: 6666 6572 203d 2074 696d 6562 7566 6665  ffer = timebuffe
-0001cad0: 722c 0d0a 2020 2020 2020 746f 614f 7253  r,..      toaOrS
-0001cae0: 5220 3d20 746f 614f 7253 522c 0d0a 2020  R = toaOrSR,..  
-0001caf0: 2020 2020 6e6f 6e44 6976 6964 6542 616e      nonDivideBan
-0001cb00: 6473 203d 206e 6f6e 4469 7669 6465 4261  ds = nonDivideBa
-0001cb10: 6e64 732c 0d0a 2020 2020 2020 6578 706f  nds,..      expo
-0001cb20: 7274 4261 6e64 7320 3d20 6578 706f 7274  rtBands = export
-0001cb30: 4261 6e64 732c 0d0a 2020 2020 2020 2320  Bands,..      # 
-0001cb40: 7765 6967 6874 7320 3d20 7765 6967 6874  weights = weight
-0001cb50: 732c 0d0a 2020 2020 2020 2320 6465 6672  s,..      # defr
-0001cb60: 696e 6765 4c35 203d 2046 616c 7365 2c0d  ingeL5 = False,.
-0001cb70: 0a20 2020 2020 2023 2069 6e63 6c75 6465  .      # include
-0001cb80: 534c 434f 6666 4c37 203d 2069 6e63 6c75  SLCOffL7 = inclu
-0001cb90: 6465 534c 434f 6666 4c37 2c0d 0a20 2020  deSLCOffL7,..   
-0001cba0: 2020 2023 2063 6f6e 7665 7274 546f 4461     # convertToDa
-0001cbb0: 696c 794d 6f73 6169 6373 203d 2027 4e41  ilyMosaics = 'NA
-0001cbc0: 272c 0d0a 2020 2020 2020 2320 6170 706c  ',..      # appl
-0001cbd0: 7951 4142 616e 6420 3d20 4661 6c73 652c  yQABand = False,
-0001cbe0: 0d0a 2020 2020 2020 2320 6170 706c 7943  ..      # applyC
-0001cbf0: 6c6f 7564 5363 6f72 6520 3d20 6170 706c  loudScore = appl
-0001cc00: 7943 6c6f 7564 5363 6f72 652c 0d0a 2020  yCloudScore,..  
-0001cc10: 2020 2020 2320 6170 706c 7946 6d61 736b      # applyFmask
-0001cc20: 436c 6f75 644d 6173 6b20 3d20 6170 706c  CloudMask = appl
-0001cc30: 7946 6d61 736b 436c 6f75 644d 6173 6b2c  yFmaskCloudMask,
-0001cc40: 0d0a 2020 2020 2020 2320 6170 706c 7943  ..      # applyC
-0001cc50: 6c6f 7564 5072 6f62 6162 696c 6974 7920  loudProbability 
-0001cc60: 3d20 274e 4127 2c0d 0a20 2020 2020 2023  = 'NA',..      #
-0001cc70: 2061 7070 6c79 5444 4f4d 203d 2061 7070   applyTDOM = app
-0001cc80: 6c79 5444 4f4d 2c0d 0a20 2020 2020 2023  lyTDOM,..      #
-0001cc90: 2061 7070 6c79 466d 6173 6b43 6c6f 7564   applyFmaskCloud
-0001cca0: 5368 6164 6f77 4d61 736b 203d 2061 7070  ShadowMask = app
-0001ccb0: 6c79 466d 6173 6b43 6c6f 7564 5368 6164  lyFmaskCloudShad
-0001ccc0: 6f77 4d61 736b 2c0d 0a20 2020 2020 2023  owMask,..      #
-0001ccd0: 2061 7070 6c79 466d 6173 6b53 6e6f 774d   applyFmaskSnowM
-0001cce0: 6173 6b20 3d20 6170 706c 7946 6d61 736b  ask = applyFmask
-0001ccf0: 536e 6f77 4d61 736b 2c0d 0a20 2020 2020  SnowMask,..     
-0001cd00: 2023 2061 7070 6c79 5368 6164 6f77 5368   # applyShadowSh
-0001cd10: 6966 7420 3d20 274e 4127 2c0d 0a20 2020  ift = 'NA',..   
-0001cd20: 2020 2023 2063 6c6f 7564 4865 6967 6874     # cloudHeight
-0001cd30: 7320 3d20 636c 6f75 6448 6569 6768 7473  s = cloudHeights
-0001cd40: 2c0d 0a20 2020 2020 2023 2063 6c6f 7564  ,..      # cloud
-0001cd50: 5363 6f72 6554 6872 6573 6820 3d20 636c  ScoreThresh = cl
-0001cd60: 6f75 6453 636f 7265 5468 7265 7368 2c0d  oudScoreThresh,.
-0001cd70: 0a20 2020 2020 2023 2070 6572 666f 726d  .      # perform
-0001cd80: 436c 6f75 6453 636f 7265 4f66 6673 6574  CloudScoreOffset
-0001cd90: 203d 2070 6572 666f 726d 436c 6f75 6453   = performCloudS
-0001cda0: 636f 7265 4f66 6673 6574 2c0d 0a20 2020  coreOffset,..   
-0001cdb0: 2020 2023 2063 6c6f 7564 5363 6f72 6550     # cloudScoreP
-0001cdc0: 6374 6c20 3d20 636c 6f75 6453 636f 7265  ctl = cloudScore
-0001cdd0: 5063 746c 2c0d 0a20 2020 2020 2023 207a  Pctl,..      # z
-0001cde0: 5363 6f72 6554 6872 6573 6820 3d20 7a53  ScoreThresh = zS
-0001cdf0: 636f 7265 5468 7265 7368 2c0d 0a20 2020  coreThresh,..   
-0001ce00: 2020 2023 2073 6861 646f 7753 756d 5468     # shadowSumTh
-0001ce10: 7265 7368 203d 2073 6861 646f 7753 756d  resh = shadowSum
-0001ce20: 5468 7265 7368 2c0d 0a20 2020 2020 2023  Thresh,..      #
-0001ce30: 2063 6f6e 7472 6163 7450 6978 656c 7320   contractPixels 
-0001ce40: 3d20 636f 6e74 7261 6374 5069 7865 6c73  = contractPixels
-0001ce50: 2c0d 0a20 2020 2020 2023 2064 696c 6174  ,..      # dilat
-0001ce60: 6550 6978 656c 7320 3d20 6469 6c61 7465  ePixels = dilate
-0001ce70: 5069 7865 6c73 2c0d 0a20 2020 2020 2023  Pixels,..      #
-0001ce80: 2063 6f72 7265 6374 496c 6c75 6d69 6e61   correctIllumina
-0001ce90: 7469 6f6e 203d 2063 6f72 7265 6374 496c  tion = correctIl
-0001cea0: 6c75 6d69 6e61 7469 6f6e 2c0d 0a20 2020  lumination,..   
-0001ceb0: 2020 2023 2063 6f72 7265 6374 5363 616c     # correctScal
-0001cec0: 6520 3d20 636f 7272 6563 7453 6361 6c65  e = correctScale
-0001ced0: 2c0d 0a20 2020 2020 2023 206e 6f6e 4469  ,..      # nonDi
-0001cee0: 7669 6465 4261 6e64 7320 3d20 6e6f 6e44  videBands = nonD
-0001cef0: 6976 6964 6542 616e 6473 2c0d 0a20 2020  ivideBands,..   
-0001cf00: 2020 2023 2065 7870 6f72 7442 616e 6473     # exportBands
-0001cf10: 203d 2065 7870 6f72 7442 616e 6473 2c0d   = exportBands,.
-0001cf20: 0a20 2020 2020 2023 2072 6573 616d 706c  .      # resampl
-0001cf30: 654d 6574 686f 6420 3d20 7265 7361 6d70  eMethod = resamp
-0001cf40: 6c65 4d65 7468 6f64 2c0d 0a20 2020 2020  leMethod,..     
-0001cf50: 2023 2072 756e 4368 6173 7461 696e 4861   # runChastainHa
-0001cf60: 726d 6f6e 697a 6174 696f 6e20 3d20 274e  rmonization = 'N
-0001cf70: 4127 2c0d 0a20 2020 2020 2061 6464 6974  A',..      addit
-0001cf80: 696f 6e61 6c50 726f 7065 7274 7944 6963  ionalPropertyDic
-0001cf90: 7420 3d20 6172 6773 290d 0a0d 0a20 2061  t = args)....  a
-0001cfa0: 7267 735b 2770 726f 6365 7373 6564 5363  rgs['processedSc
-0001cfb0: 656e 6573 275d 203d 206c 730d 0a20 2061  enes'] = ls..  a
-0001cfc0: 7267 735b 2770 726f 6365 7373 6564 436f  rgs['processedCo
-0001cfd0: 6d70 6f73 6974 6573 275d 203d 2074 730d  mposites'] = ts.
-0001cfe0: 0a0d 0a20 2072 6574 7572 6e20 6172 6773  ...  return args
-0001cff0: 0d0a 0d0a 2323 2323 2323 2323 2323 2323  ....############
+0001b9d0: 2323 2323 230d 0a23 5772 6170 7065 7220  #####..#Wrapper 
+0001b9e0: 6675 6e63 7469 6f6e 2066 6f72 2067 6574  function for get
+0001b9f0: 7469 6e67 204c 616e 6473 6174 2069 6d61  ting Landsat ima
+0001ba00: 6765 7279 0d0a 6465 6620 6765 744c 616e  gery..def getLan
+0001ba10: 6473 6174 5772 6170 7065 7228 0d0a 2020  dsatWrapper(..  
+0001ba20: 7374 7564 7941 7265 612c 0d0a 2020 7374  studyArea,..  st
+0001ba30: 6172 7459 6561 722c 0d0a 2020 656e 6459  artYear,..  endY
+0001ba40: 6561 722c 0d0a 2020 7374 6172 744a 756c  ear,..  startJul
+0001ba50: 6961 6e2c 0d0a 2020 656e 644a 756c 6961  ian,..  endJulia
+0001ba60: 6e2c 0d0a 2020 7469 6d65 6275 6666 6572  n,..  timebuffer
+0001ba70: 203d 2030 2c0d 0a20 2077 6569 6768 7473   = 0,..  weights
+0001ba80: 203d 205b 315d 2c0d 0a20 2063 6f6d 706f   = [1],..  compo
+0001ba90: 7369 7469 6e67 4d65 7468 6f64 203d 2027  sitingMethod = '
+0001baa0: 6d65 646f 6964 272c 0d0a 2020 746f 614f  medoid',..  toaO
+0001bab0: 7253 5220 3d20 2753 5227 2c0d 0a20 2069  rSR = 'SR',..  i
+0001bac0: 6e63 6c75 6465 534c 434f 6666 4c37 203d  ncludeSLCOffL7 =
+0001bad0: 2046 616c 7365 2c0d 0a20 2064 6566 7269   False,..  defri
+0001bae0: 6e67 654c 3520 3d20 4661 6c73 652c 0d0a  ngeL5 = False,..
+0001baf0: 2020 6170 706c 7943 6c6f 7564 5363 6f72    applyCloudScor
+0001bb00: 6520 3d20 4661 6c73 652c 0d0a 2020 6170  e = False,..  ap
+0001bb10: 706c 7946 6d61 736b 436c 6f75 644d 6173  plyFmaskCloudMas
+0001bb20: 6b20 3d20 5472 7565 2c0d 0a20 2061 7070  k = True,..  app
+0001bb30: 6c79 5444 4f4d 203d 2046 616c 7365 2c0d  lyTDOM = False,.
+0001bb40: 0a20 2061 7070 6c79 466d 6173 6b43 6c6f  .  applyFmaskClo
+0001bb50: 7564 5368 6164 6f77 4d61 736b 203d 2054  udShadowMask = T
+0001bb60: 7275 652c 0d0a 2020 6170 706c 7946 6d61  rue,..  applyFma
+0001bb70: 736b 536e 6f77 4d61 736b 203d 2046 616c  skSnowMask = Fal
+0001bb80: 7365 2c0d 0a20 2063 6c6f 7564 5363 6f72  se,..  cloudScor
+0001bb90: 6554 6872 6573 6820 3d20 3130 2c0d 0a20  eThresh = 10,.. 
+0001bba0: 2070 6572 666f 726d 436c 6f75 6453 636f   performCloudSco
+0001bbb0: 7265 4f66 6673 6574 203d 2054 7275 652c  reOffset = True,
+0001bbc0: 0d0a 2020 636c 6f75 6453 636f 7265 5063  ..  cloudScorePc
+0001bbd0: 746c 203d 2031 302c 0d0a 2020 7a53 636f  tl = 10,..  zSco
+0001bbe0: 7265 5468 7265 7368 203d 202d 312c 0d0a  reThresh = -1,..
+0001bbf0: 2020 7368 6164 6f77 5375 6d54 6872 6573    shadowSumThres
+0001bc00: 6820 3d20 302e 3335 2c0d 0a20 2063 6f6e  h = 0.35,..  con
+0001bc10: 7472 6163 7450 6978 656c 7320 3d20 312e  tractPixels = 1.
+0001bc20: 352c 0d0a 2020 6469 6c61 7465 5069 7865  5,..  dilatePixe
+0001bc30: 6c73 203d 2033 2e35 2c0d 0a20 2063 6f72  ls = 3.5,..  cor
+0001bc40: 7265 6374 496c 6c75 6d69 6e61 7469 6f6e  rectIllumination
+0001bc50: 203d 2046 616c 7365 2c0d 0a20 2063 6f72   = False,..  cor
+0001bc60: 7265 6374 5363 616c 6520 3d20 3235 302c  rectScale = 250,
+0001bc70: 0d0a 2020 6578 706f 7274 436f 6d70 6f73  ..  exportCompos
+0001bc80: 6974 6573 203d 2046 616c 7365 2c0d 0a20  ites = False,.. 
+0001bc90: 206f 7574 7075 744e 616d 6520 3d20 274c   outputName = 'L
+0001bca0: 616e 6473 6174 2d43 6f6d 706f 7369 7465  andsat-Composite
+0001bcb0: 272c 0d0a 2020 6578 706f 7274 5061 7468  ',..  exportPath
+0001bcc0: 526f 6f74 203d 2027 7573 6572 732f 6961  Root = 'users/ia
+0001bcd0: 6e68 6f75 736d 616e 2f74 6573 7427 2c0d  nhousman/test',.
+0001bce0: 0a20 2063 7273 203d 2027 4550 5347 3a35  .  crs = 'EPSG:5
+0001bcf0: 3037 3027 2c0d 0a20 2074 7261 6e73 666f  070',..  transfo
+0001bd00: 726d 203d 205b 3330 2c30 2c2d 3233 3631  rm = [30,0,-2361
+0001bd10: 3931 352e 302c 302c 2d33 302c 3331 3737  915.0,0,-30,3177
+0001bd20: 3733 352e 305d 2c0d 0a20 2073 6361 6c65  735.0],..  scale
+0001bd30: 203d 204e 6f6e 652c 0d0a 2020 7265 7361   = None,..  resa
+0001bd40: 6d70 6c65 4d65 7468 6f64 203d 2027 6e65  mpleMethod = 'ne
+0001bd50: 6172 272c 0d0a 2020 7072 6543 6f6d 7075  ar',..  preCompu
+0001bd60: 7465 6443 6c6f 7564 5363 6f72 654f 6666  tedCloudScoreOff
+0001bd70: 7365 7420 3d20 4e6f 6e65 2c0d 0a20 2070  set = None,..  p
+0001bd80: 7265 436f 6d70 7574 6564 5444 4f4d 4952  reComputedTDOMIR
+0001bd90: 4d65 616e 203d 204e 6f6e 652c 0d0a 2020  Mean = None,..  
+0001bda0: 7072 6543 6f6d 7075 7465 6454 444f 4d49  preComputedTDOMI
+0001bdb0: 5253 7464 4465 7620 3d20 4e6f 6e65 2c0d  RStdDev = None,.
+0001bdc0: 0a20 2063 6f6d 706f 7369 7469 6e67 5265  .  compositingRe
+0001bdd0: 6475 6365 7220 3d20 4e6f 6e65 2c0d 0a20  ducer = None,.. 
+0001bde0: 2068 6172 6d6f 6e69 7a65 4f4c 4920 3d20   harmonizeOLI = 
+0001bdf0: 4661 6c73 652c 0d0a 2020 6c61 6e64 7361  False,..  landsa
+0001be00: 7443 6f6c 6c65 6374 696f 6e56 6572 7369  tCollectionVersi
+0001be10: 6f6e 203d 2027 4332 2729 3a0d 0a0d 0a20  on = 'C2'):.... 
+0001be20: 2074 6f61 4f72 5352 203d 2074 6f61 4f72   toaOrSR = toaOr
+0001be30: 5352 2e75 7070 6572 2829 0d0a 2020 6f72  SR.upper()..  or
+0001be40: 6967 696e 203d 2027 4c61 6e64 7361 7427  igin = 'Landsat'
+0001be50: 0d0a 2020 6172 6773 203d 2066 6f72 6d61  ..  args = forma
+0001be60: 7441 7267 7328 6c6f 6361 6c73 2829 290d  tArgs(locals()).
+0001be70: 0a20 2069 6620 2761 7267 7327 2069 6e20  .  if 'args' in 
+0001be80: 6172 6773 2e6b 6579 7328 293a 0d0a 2020  args.keys():..  
+0001be90: 2020 6465 6c20 6172 6773 5b27 6172 6773    del args['args
+0001bea0: 275d 0d0a 0d0a 2020 2350 7265 7061 7265  ']....  #Prepare
+0001beb0: 2064 6174 6573 0d0a 2020 7772 6170 4f66   dates..  wrapOf
+0001bec0: 6673 6574 203d 2030 0d0a 2020 6966 2073  fset = 0..  if s
+0001bed0: 7461 7274 4a75 6c69 616e 203e 2065 6e64  tartJulian > end
+0001bee0: 4a75 6c69 616e 3a0d 0a20 2020 2077 7261  Julian:..    wra
+0001bef0: 704f 6666 7365 7420 3d20 3336 350d 0a20  pOffset = 365.. 
+0001bf00: 2073 7461 7274 4461 7465 203d 2065 652e   startDate = ee.
+0001bf10: 4461 7465 2e66 726f 6d59 4d44 2873 7461  Date.fromYMD(sta
+0001bf20: 7274 5965 6172 2c31 2c31 292e 6164 7661  rtYear,1,1).adva
+0001bf30: 6e63 6528 7374 6172 744a 756c 6961 6e2d  nce(startJulian-
+0001bf40: 312c 2764 6179 2729 0d0a 2020 656e 6444  1,'day')..  endD
+0001bf50: 6174 6520 3d20 6565 2e44 6174 652e 6672  ate = ee.Date.fr
+0001bf60: 6f6d 594d 4428 656e 6459 6561 722c 312c  omYMD(endYear,1,
+0001bf70: 3129 2e61 6476 616e 6365 2865 6e64 4a75  1).advance(endJu
+0001bf80: 6c69 616e 2d31 2b77 7261 704f 6666 7365  lian-1+wrapOffse
+0001bf90: 742c 2764 6179 2729 0d0a 0d0a 2020 2320  t,'day')....  # 
+0001bfa0: 4765 7420 4c61 6e64 7361 7420 696d 6167  Get Landsat imag
+0001bfb0: 6520 636f 6c6c 6563 7469 6f6e 2061 6e64  e collection and
+0001bfc0: 2061 7070 6c79 2063 6c6f 7564 206d 6173   apply cloud mas
+0001bfd0: 6b69 6e67 0d0a 2020 6c73 203d 2067 6574  king..  ls = get
+0001bfe0: 5072 6f63 6573 7365 644c 616e 6473 6174  ProcessedLandsat
+0001bff0: 5363 656e 6573 280d 0a20 2020 2073 7475  Scenes(..    stu
+0001c000: 6479 4172 6561 203d 2073 7475 6479 4172  dyArea = studyAr
+0001c010: 6561 2c0d 0a20 2020 2073 7461 7274 5965  ea,..    startYe
+0001c020: 6172 203d 2073 7461 7274 5965 6172 2c0d  ar = startYear,.
+0001c030: 0a20 2020 2065 6e64 5965 6172 203d 2065  .    endYear = e
+0001c040: 6e64 5965 6172 2c0d 0a20 2020 2073 7461  ndYear,..    sta
+0001c050: 7274 4a75 6c69 616e 203d 2073 7461 7274  rtJulian = start
+0001c060: 4a75 6c69 616e 2c0d 0a20 2020 2065 6e64  Julian,..    end
+0001c070: 4a75 6c69 616e 203d 2065 6e64 4a75 6c69  Julian = endJuli
+0001c080: 616e 2c0d 0a20 2020 2074 6f61 4f72 5352  an,..    toaOrSR
+0001c090: 203d 2074 6f61 4f72 5352 2c0d 0a20 2020   = toaOrSR,..   
+0001c0a0: 2069 6e63 6c75 6465 534c 434f 6666 4c37   includeSLCOffL7
+0001c0b0: 203d 2069 6e63 6c75 6465 534c 434f 6666   = includeSLCOff
+0001c0c0: 4c37 2c0d 0a20 2020 2064 6566 7269 6e67  L7,..    defring
+0001c0d0: 654c 3520 3d20 6465 6672 696e 6765 4c35  eL5 = defringeL5
+0001c0e0: 2c0d 0a20 2020 2061 7070 6c79 436c 6f75  ,..    applyClou
+0001c0f0: 6453 636f 7265 203d 2061 7070 6c79 436c  dScore = applyCl
+0001c100: 6f75 6453 636f 7265 2c0d 0a20 2020 2061  oudScore,..    a
+0001c110: 7070 6c79 466d 6173 6b43 6c6f 7564 4d61  pplyFmaskCloudMa
+0001c120: 736b 203d 2061 7070 6c79 466d 6173 6b43  sk = applyFmaskC
+0001c130: 6c6f 7564 4d61 736b 2c0d 0a20 2020 2061  loudMask,..    a
+0001c140: 7070 6c79 5444 4f4d 203d 2061 7070 6c79  pplyTDOM = apply
+0001c150: 5444 4f4d 2c0d 0a20 2020 2061 7070 6c79  TDOM,..    apply
+0001c160: 466d 6173 6b43 6c6f 7564 5368 6164 6f77  FmaskCloudShadow
+0001c170: 4d61 736b 203d 2061 7070 6c79 466d 6173  Mask = applyFmas
+0001c180: 6b43 6c6f 7564 5368 6164 6f77 4d61 736b  kCloudShadowMask
+0001c190: 2c0d 0a20 2020 2061 7070 6c79 466d 6173  ,..    applyFmas
+0001c1a0: 6b53 6e6f 774d 6173 6b20 3d20 6170 706c  kSnowMask = appl
+0001c1b0: 7946 6d61 736b 536e 6f77 4d61 736b 2c0d  yFmaskSnowMask,.
+0001c1c0: 0a20 2020 2063 6c6f 7564 5363 6f72 6554  .    cloudScoreT
+0001c1d0: 6872 6573 6820 3d20 636c 6f75 6453 636f  hresh = cloudSco
+0001c1e0: 7265 5468 7265 7368 2c0d 0a20 2020 2070  reThresh,..    p
+0001c1f0: 6572 666f 726d 436c 6f75 6453 636f 7265  erformCloudScore
+0001c200: 4f66 6673 6574 203d 2070 6572 666f 726d  Offset = perform
+0001c210: 436c 6f75 6453 636f 7265 4f66 6673 6574  CloudScoreOffset
+0001c220: 2c0d 0a20 2020 2063 6c6f 7564 5363 6f72  ,..    cloudScor
+0001c230: 6550 6374 6c20 3d20 636c 6f75 6453 636f  ePctl = cloudSco
+0001c240: 7265 5063 746c 2c0d 0a20 2020 207a 5363  rePctl,..    zSc
+0001c250: 6f72 6554 6872 6573 6820 3d20 7a53 636f  oreThresh = zSco
+0001c260: 7265 5468 7265 7368 2c0d 0a20 2020 2073  reThresh,..    s
+0001c270: 6861 646f 7753 756d 5468 7265 7368 203d  hadowSumThresh =
+0001c280: 2073 6861 646f 7753 756d 5468 7265 7368   shadowSumThresh
+0001c290: 2c0d 0a20 2020 2063 6f6e 7472 6163 7450  ,..    contractP
+0001c2a0: 6978 656c 7320 3d20 636f 6e74 7261 6374  ixels = contract
+0001c2b0: 5069 7865 6c73 2c0d 0a20 2020 2064 696c  Pixels,..    dil
+0001c2c0: 6174 6550 6978 656c 7320 3d20 6469 6c61  atePixels = dila
+0001c2d0: 7465 5069 7865 6c73 2c0d 0a20 2020 2072  tePixels,..    r
+0001c2e0: 6573 616d 706c 654d 6574 686f 6420 3d20  esampleMethod = 
+0001c2f0: 7265 7361 6d70 6c65 4d65 7468 6f64 2c0d  resampleMethod,.
+0001c300: 0a20 2020 2068 6172 6d6f 6e69 7a65 4f4c  .    harmonizeOL
+0001c310: 4920 3d20 6861 726d 6f6e 697a 654f 4c49  I = harmonizeOLI
+0001c320: 2c0d 0a20 2020 2070 7265 436f 6d70 7574  ,..    preComput
+0001c330: 6564 436c 6f75 6453 636f 7265 4f66 6673  edCloudScoreOffs
+0001c340: 6574 203d 2070 7265 436f 6d70 7574 6564  et = preComputed
+0001c350: 436c 6f75 6453 636f 7265 4f66 6673 6574  CloudScoreOffset
+0001c360: 2c0d 0a20 2020 2070 7265 436f 6d70 7574  ,..    preComput
+0001c370: 6564 5444 4f4d 4952 4d65 616e 203d 2070  edTDOMIRMean = p
+0001c380: 7265 436f 6d70 7574 6564 5444 4f4d 4952  reComputedTDOMIR
+0001c390: 4d65 616e 2c0d 0a20 2020 2070 7265 436f  Mean,..    preCo
+0001c3a0: 6d70 7574 6564 5444 4f4d 4952 5374 6444  mputedTDOMIRStdD
+0001c3b0: 6576 203d 2070 7265 436f 6d70 7574 6564  ev = preComputed
+0001c3c0: 5444 4f4d 4952 5374 6444 6576 2c0d 0a20  TDOMIRStdDev,.. 
+0001c3d0: 2020 206c 616e 6473 6174 436f 6c6c 6563     landsatCollec
+0001c3e0: 7469 6f6e 5665 7273 696f 6e20 3d20 6c61  tionVersion = la
+0001c3f0: 6e64 7361 7443 6f6c 6c65 6374 696f 6e56  ndsatCollectionV
+0001c400: 6572 7369 6f6e 290d 0a0d 0a20 2023 4164  ersion)....  #Ad
+0001c410: 6420 7a65 6e69 7468 2061 6e64 2061 7a69  d zenith and azi
+0001c420: 6d75 7468 0d0a 2020 6966 2063 6f72 7265  muth..  if corre
+0001c430: 6374 496c 6c75 6d69 6e61 7469 6f6e 3a0d  ctIllumination:.
+0001c440: 0a20 2020 2070 7269 6e74 2827 4164 6469  .    print('Addi
+0001c450: 6e67 207a 656e 6974 6820 616e 6420 617a  ng zenith and az
+0001c460: 696d 7574 6820 666f 7220 7465 7272 6169  imuth for terrai
+0001c470: 6e20 636f 7272 6563 7469 6f6e 2729 0d0a  n correction')..
+0001c480: 2020 2020 6c73 203d 206c 732e 6d61 7028      ls = ls.map(
+0001c490: 6c61 6d62 6461 2069 6d67 3a20 6164 645a  lambda img: addZ
+0001c4a0: 656e 6974 6841 7a69 6d75 7468 2869 6d67  enithAzimuth(img
+0001c4b0: 2c20 746f 614f 7253 5229 290d 0a0d 0a20  , toaOrSR)).... 
+0001c4c0: 2023 4372 6561 7465 2063 6f6d 706f 7369   #Create composi
+0001c4d0: 7465 2074 696d 6520 7365 7269 6573 0d0a  te time series..
+0001c4e0: 2020 7473 203d 2063 6f6d 706f 7369 7465    ts = composite
+0001c4f0: 5469 6d65 5365 7269 6573 285c 0d0a 2020  TimeSeries(\..  
+0001c500: 2020 6c73 203d 206c 732c 0d0a 2020 2020    ls = ls,..    
+0001c510: 7374 6172 7459 6561 7220 3d20 7374 6172  startYear = star
+0001c520: 7459 6561 722c 0d0a 2020 2020 656e 6459  tYear,..    endY
+0001c530: 6561 7220 3d20 656e 6459 6561 722c 0d0a  ear = endYear,..
+0001c540: 2020 2020 7374 6172 744a 756c 6961 6e20      startJulian 
+0001c550: 3d20 7374 6172 744a 756c 6961 6e2c 0d0a  = startJulian,..
+0001c560: 2020 2020 656e 644a 756c 6961 6e20 3d20      endJulian = 
+0001c570: 656e 644a 756c 6961 6e2c 0d0a 2020 2020  endJulian,..    
+0001c580: 7469 6d65 6275 6666 6572 203d 2074 696d  timebuffer = tim
+0001c590: 6562 7566 6665 722c 0d0a 2020 2020 7765  ebuffer,..    we
+0001c5a0: 6967 6874 7320 3d20 7765 6967 6874 732c  ights = weights,
+0001c5b0: 0d0a 2020 2020 636f 6d70 6f73 6974 696e  ..    compositin
+0001c5c0: 674d 6574 686f 6420 3d20 636f 6d70 6f73  gMethod = compos
+0001c5d0: 6974 696e 674d 6574 686f 642c 0d0a 2020  itingMethod,..  
+0001c5e0: 2020 636f 6d70 6f73 6974 696e 6752 6564    compositingRed
+0001c5f0: 7563 6572 203d 2063 6f6d 706f 7369 7469  ucer = compositi
+0001c600: 6e67 5265 6475 6365 7229 0d0a 0d0a 2020  ngReducer)....  
+0001c610: 2320 436f 7272 6563 7420 696c 6c75 6d69  # Correct illumi
+0001c620: 6e61 7469 6f6e 0d0a 2020 6966 2063 6f72  nation..  if cor
+0001c630: 7265 6374 496c 6c75 6d69 6e61 7469 6f6e  rectIllumination
+0001c640: 3a0d 0a20 2020 2070 7269 6e74 2827 436f  :..    print('Co
+0001c650: 7272 6563 7469 6e67 2069 6c6c 756d 696e  rrecting illumin
+0001c660: 6174 696f 6e27 293b 0d0a 2020 2020 7473  ation');..    ts
+0001c670: 203d 2074 732e 6d61 7028 696c 6c75 6d69   = ts.map(illumi
+0001c680: 6e61 7469 6f6e 436f 6e64 6974 696f 6e29  nationCondition)
+0001c690: 2e6d 6170 286c 616d 6264 6120 696d 673a  .map(lambda img:
+0001c6a0: 2069 6c6c 756d 696e 6174 696f 6e43 6f72   illuminationCor
+0001c6b0: 7265 6374 696f 6e28 696d 672c 2063 6f72  rection(img, cor
+0001c6c0: 7265 6374 5363 616c 652c 2073 7475 6479  rectScale, study
+0001c6d0: 4172 6561 2929 0d0a 0d0a 2020 2345 7870  Area))....  #Exp
+0001c6e0: 6f72 7420 636f 6d70 6f73 6974 6573 0d0a  ort composites..
+0001c6f0: 2020 6966 2065 7870 6f72 7443 6f6d 706f    if exportCompo
+0001c700: 7369 7465 733a 0d0a 2020 2020 6966 2063  sites:..    if c
+0001c710: 6f6d 706f 7369 7469 6e67 4d65 7468 6f64  ompositingMethod
+0001c720: 203d 3d20 276d 6564 6f69 6427 3a0d 0a20   == 'medoid':.. 
+0001c730: 2020 2020 2065 7870 6f72 7442 616e 6473       exportBands
+0001c740: 203d 205b 2762 6c75 6527 2c20 2767 7265   = ['blue', 'gre
+0001c750: 656e 272c 2027 7265 6427 2c20 276e 6972  en', 'red', 'nir
+0001c760: 272c 2027 7377 6972 3127 2c20 2773 7769  ', 'swir1', 'swi
+0001c770: 7232 272c 2027 7465 6d70 272c 2027 636f  r2', 'temp', 'co
+0001c780: 6d70 6f73 6974 654f 6273 436f 756e 7427  mpositeObsCount'
+0001c790: 2c20 2773 656e 736f 7227 2c20 2779 6561  , 'sensor', 'yea
+0001c7a0: 7227 2c20 276a 756c 6961 6e44 6179 275d  r', 'julianDay']
+0001c7b0: 0d0a 2020 2020 2020 6e6f 6e44 6976 6964  ..      nonDivid
+0001c7c0: 6542 616e 6473 203d 205b 2774 656d 7027  eBands = ['temp'
+0001c7d0: 2c20 2763 6f6d 706f 7369 7465 4f62 7343  , 'compositeObsC
+0001c7e0: 6f75 6e74 272c 2027 7365 6e73 6f72 272c  ount', 'sensor',
+0001c7f0: 2027 7965 6172 272c 2027 6a75 6c69 616e   'year', 'julian
+0001c800: 4461 7927 5d0d 0a20 2020 2065 6c73 653a  Day']..    else:
+0001c810: 0d0a 2020 2020 2020 6578 706f 7274 4261  ..      exportBa
+0001c820: 6e64 7320 3d20 5b27 626c 7565 272c 2027  nds = ['blue', '
+0001c830: 6772 6565 6e27 2c20 2772 6564 272c 2027  green', 'red', '
+0001c840: 6e69 7227 2c20 2773 7769 7231 272c 2027  nir', 'swir1', '
+0001c850: 7377 6972 3227 2c20 2774 656d 7027 2c20  swir2', 'temp', 
+0001c860: 2763 6f6d 706f 7369 7465 4f62 7343 6f75  'compositeObsCou
+0001c870: 6e74 275d 0d0a 2020 2020 2020 6e6f 6e44  nt']..      nonD
+0001c880: 6976 6964 6542 616e 6473 203d 205b 2774  ivideBands = ['t
+0001c890: 656d 7027 2c20 2763 6f6d 706f 7369 7465  emp', 'composite
+0001c8a0: 4f62 7343 6f75 6e74 275d 0d0a 0d0a 2020  ObsCount']....  
+0001c8b0: 2020 6578 706f 7274 436f 6d70 6f73 6974    exportComposit
+0001c8c0: 6543 6f6c 6c65 6374 696f 6e28 5c0d 0a20  eCollection(\.. 
+0001c8d0: 2020 2020 2063 6f6c 6c65 6374 696f 6e20       collection 
+0001c8e0: 3d20 7473 2c0d 0a20 2020 2020 2065 7870  = ts,..      exp
+0001c8f0: 6f72 7450 6174 6852 6f6f 7420 3d20 6578  ortPathRoot = ex
+0001c900: 706f 7274 5061 7468 526f 6f74 2c0d 0a20  portPathRoot,.. 
+0001c910: 2020 2020 206f 7574 7075 744e 616d 6520       outputName 
+0001c920: 3d20 6f75 7470 7574 4e61 6d65 2c0d 0a20  = outputName,.. 
+0001c930: 2020 2020 206f 7269 6769 6e20 3d20 6f72       origin = or
+0001c940: 6967 696e 2c0d 0a20 2020 2020 2073 7475  igin,..      stu
+0001c950: 6479 4172 6561 203d 2073 7475 6479 4172  dyArea = studyAr
+0001c960: 6561 2c0d 0a20 2020 2020 2063 7273 203d  ea,..      crs =
+0001c970: 2063 7273 2c0d 0a20 2020 2020 2074 7261   crs,..      tra
+0001c980: 6e73 666f 726d 203d 2074 7261 6e73 666f  nsform = transfo
+0001c990: 726d 2c0d 0a20 2020 2020 2073 6361 6c65  rm,..      scale
+0001c9a0: 203d 2073 6361 6c65 2c0d 0a20 2020 2020   = scale,..     
+0001c9b0: 2073 7461 7274 5965 6172 203d 2073 7461   startYear = sta
+0001c9c0: 7274 5965 6172 2c0d 0a20 2020 2020 2065  rtYear,..      e
+0001c9d0: 6e64 5965 6172 203d 2065 6e64 5965 6172  ndYear = endYear
+0001c9e0: 2c0d 0a20 2020 2020 2073 7461 7274 4a75  ,..      startJu
+0001c9f0: 6c69 616e 203d 2073 7461 7274 4a75 6c69  lian = startJuli
+0001ca00: 616e 2c0d 0a20 2020 2020 2065 6e64 4a75  an,..      endJu
+0001ca10: 6c69 616e 203d 2065 6e64 4a75 6c69 616e  lian = endJulian
+0001ca20: 2c0d 0a20 2020 2020 2063 6f6d 706f 7369  ,..      composi
+0001ca30: 7469 6e67 4d65 7468 6f64 203d 2063 6f6d  tingMethod = com
+0001ca40: 706f 7369 7469 6e67 4d65 7468 6f64 2c0d  positingMethod,.
+0001ca50: 0a20 2020 2020 2074 696d 6562 7566 6665  .      timebuffe
+0001ca60: 7220 3d20 7469 6d65 6275 6666 6572 2c0d  r = timebuffer,.
+0001ca70: 0a20 2020 2020 2074 6f61 4f72 5352 203d  .      toaOrSR =
+0001ca80: 2074 6f61 4f72 5352 2c0d 0a20 2020 2020   toaOrSR,..     
+0001ca90: 206e 6f6e 4469 7669 6465 4261 6e64 7320   nonDivideBands 
+0001caa0: 3d20 6e6f 6e44 6976 6964 6542 616e 6473  = nonDivideBands
+0001cab0: 2c0d 0a20 2020 2020 2065 7870 6f72 7442  ,..      exportB
+0001cac0: 616e 6473 203d 2065 7870 6f72 7442 616e  ands = exportBan
+0001cad0: 6473 2c0d 0a20 2020 2020 2023 2077 6569  ds,..      # wei
+0001cae0: 6768 7473 203d 2077 6569 6768 7473 2c0d  ghts = weights,.
+0001caf0: 0a20 2020 2020 2023 2064 6566 7269 6e67  .      # defring
+0001cb00: 654c 3520 3d20 4661 6c73 652c 0d0a 2020  eL5 = False,..  
+0001cb10: 2020 2020 2320 696e 636c 7564 6553 4c43      # includeSLC
+0001cb20: 4f66 664c 3720 3d20 696e 636c 7564 6553  OffL7 = includeS
+0001cb30: 4c43 4f66 664c 372c 0d0a 2020 2020 2020  LCOffL7,..      
+0001cb40: 2320 636f 6e76 6572 7454 6f44 6169 6c79  # convertToDaily
+0001cb50: 4d6f 7361 6963 7320 3d20 274e 4127 2c0d  Mosaics = 'NA',.
+0001cb60: 0a20 2020 2020 2023 2061 7070 6c79 5141  .      # applyQA
+0001cb70: 4261 6e64 203d 2046 616c 7365 2c0d 0a20  Band = False,.. 
+0001cb80: 2020 2020 2023 2061 7070 6c79 436c 6f75       # applyClou
+0001cb90: 6453 636f 7265 203d 2061 7070 6c79 436c  dScore = applyCl
+0001cba0: 6f75 6453 636f 7265 2c0d 0a20 2020 2020  oudScore,..     
+0001cbb0: 2023 2061 7070 6c79 466d 6173 6b43 6c6f   # applyFmaskClo
+0001cbc0: 7564 4d61 736b 203d 2061 7070 6c79 466d  udMask = applyFm
+0001cbd0: 6173 6b43 6c6f 7564 4d61 736b 2c0d 0a20  askCloudMask,.. 
+0001cbe0: 2020 2020 2023 2061 7070 6c79 436c 6f75       # applyClou
+0001cbf0: 6450 726f 6261 6269 6c69 7479 203d 2027  dProbability = '
+0001cc00: 4e41 272c 0d0a 2020 2020 2020 2320 6170  NA',..      # ap
+0001cc10: 706c 7954 444f 4d20 3d20 6170 706c 7954  plyTDOM = applyT
+0001cc20: 444f 4d2c 0d0a 2020 2020 2020 2320 6170  DOM,..      # ap
+0001cc30: 706c 7946 6d61 736b 436c 6f75 6453 6861  plyFmaskCloudSha
+0001cc40: 646f 774d 6173 6b20 3d20 6170 706c 7946  dowMask = applyF
+0001cc50: 6d61 736b 436c 6f75 6453 6861 646f 774d  maskCloudShadowM
+0001cc60: 6173 6b2c 0d0a 2020 2020 2020 2320 6170  ask,..      # ap
+0001cc70: 706c 7946 6d61 736b 536e 6f77 4d61 736b  plyFmaskSnowMask
+0001cc80: 203d 2061 7070 6c79 466d 6173 6b53 6e6f   = applyFmaskSno
+0001cc90: 774d 6173 6b2c 0d0a 2020 2020 2020 2320  wMask,..      # 
+0001cca0: 6170 706c 7953 6861 646f 7753 6869 6674  applyShadowShift
+0001ccb0: 203d 2027 4e41 272c 0d0a 2020 2020 2020   = 'NA',..      
+0001ccc0: 2320 636c 6f75 6448 6569 6768 7473 203d  # cloudHeights =
+0001ccd0: 2063 6c6f 7564 4865 6967 6874 732c 0d0a   cloudHeights,..
+0001cce0: 2020 2020 2020 2320 636c 6f75 6453 636f        # cloudSco
+0001ccf0: 7265 5468 7265 7368 203d 2063 6c6f 7564  reThresh = cloud
+0001cd00: 5363 6f72 6554 6872 6573 682c 0d0a 2020  ScoreThresh,..  
+0001cd10: 2020 2020 2320 7065 7266 6f72 6d43 6c6f      # performClo
+0001cd20: 7564 5363 6f72 654f 6666 7365 7420 3d20  udScoreOffset = 
+0001cd30: 7065 7266 6f72 6d43 6c6f 7564 5363 6f72  performCloudScor
+0001cd40: 654f 6666 7365 742c 0d0a 2020 2020 2020  eOffset,..      
+0001cd50: 2320 636c 6f75 6453 636f 7265 5063 746c  # cloudScorePctl
+0001cd60: 203d 2063 6c6f 7564 5363 6f72 6550 6374   = cloudScorePct
+0001cd70: 6c2c 0d0a 2020 2020 2020 2320 7a53 636f  l,..      # zSco
+0001cd80: 7265 5468 7265 7368 203d 207a 5363 6f72  reThresh = zScor
+0001cd90: 6554 6872 6573 682c 0d0a 2020 2020 2020  eThresh,..      
+0001cda0: 2320 7368 6164 6f77 5375 6d54 6872 6573  # shadowSumThres
+0001cdb0: 6820 3d20 7368 6164 6f77 5375 6d54 6872  h = shadowSumThr
+0001cdc0: 6573 682c 0d0a 2020 2020 2020 2320 636f  esh,..      # co
+0001cdd0: 6e74 7261 6374 5069 7865 6c73 203d 2063  ntractPixels = c
+0001cde0: 6f6e 7472 6163 7450 6978 656c 732c 0d0a  ontractPixels,..
+0001cdf0: 2020 2020 2020 2320 6469 6c61 7465 5069        # dilatePi
+0001ce00: 7865 6c73 203d 2064 696c 6174 6550 6978  xels = dilatePix
+0001ce10: 656c 732c 0d0a 2020 2020 2020 2320 636f  els,..      # co
+0001ce20: 7272 6563 7449 6c6c 756d 696e 6174 696f  rrectIlluminatio
+0001ce30: 6e20 3d20 636f 7272 6563 7449 6c6c 756d  n = correctIllum
+0001ce40: 696e 6174 696f 6e2c 0d0a 2020 2020 2020  ination,..      
+0001ce50: 2320 636f 7272 6563 7453 6361 6c65 203d  # correctScale =
+0001ce60: 2063 6f72 7265 6374 5363 616c 652c 0d0a   correctScale,..
+0001ce70: 2020 2020 2020 2320 6e6f 6e44 6976 6964        # nonDivid
+0001ce80: 6542 616e 6473 203d 206e 6f6e 4469 7669  eBands = nonDivi
+0001ce90: 6465 4261 6e64 732c 0d0a 2020 2020 2020  deBands,..      
+0001cea0: 2320 6578 706f 7274 4261 6e64 7320 3d20  # exportBands = 
+0001ceb0: 6578 706f 7274 4261 6e64 732c 0d0a 2020  exportBands,..  
+0001cec0: 2020 2020 2320 7265 7361 6d70 6c65 4d65      # resampleMe
+0001ced0: 7468 6f64 203d 2072 6573 616d 706c 654d  thod = resampleM
+0001cee0: 6574 686f 642c 0d0a 2020 2020 2020 2320  ethod,..      # 
+0001cef0: 7275 6e43 6861 7374 6169 6e48 6172 6d6f  runChastainHarmo
+0001cf00: 6e69 7a61 7469 6f6e 203d 2027 4e41 272c  nization = 'NA',
+0001cf10: 0d0a 2020 2020 2020 6164 6469 7469 6f6e  ..      addition
+0001cf20: 616c 5072 6f70 6572 7479 4469 6374 203d  alPropertyDict =
+0001cf30: 2061 7267 7329 0d0a 0d0a 2020 6172 6773   args)....  args
+0001cf40: 5b27 7072 6f63 6573 7365 6453 6365 6e65  ['processedScene
+0001cf50: 7327 5d20 3d20 6c73 0d0a 2020 6172 6773  s'] = ls..  args
+0001cf60: 5b27 7072 6f63 6573 7365 6443 6f6d 706f  ['processedCompo
+0001cf70: 7369 7465 7327 5d20 3d20 7473 0d0a 0d0a  sites'] = ts....
+0001cf80: 2020 7265 7475 726e 2061 7267 730d 0a0d    return args...
+0001cf90: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+0001cfa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001cfb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001cfc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001cfd0: 2323 2323 2323 2323 2323 0d0a 2323 2323  ##########..####
+0001cfe0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001cff0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d000: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d010: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001d020: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001d030: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
-0001d040: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001d050: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001d060: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001d070: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001d080: 2323 2323 2323 2323 0d0a 2357 7261 7070  ########..#Wrapp
-0001d090: 6572 2066 756e 6374 696f 6e20 666f 7220  er function for 
-0001d0a0: 6765 7474 696e 6720 4c61 6e64 7361 7420  getting Landsat 
-0001d0b0: 696d 6167 6572 790d 0a64 6566 2067 6574  imagery..def get
-0001d0c0: 5072 6f63 6573 7365 644c 616e 6473 6174  ProcessedLandsat
-0001d0d0: 5363 656e 6573 280d 0a20 2073 7475 6479  Scenes(..  study
-0001d0e0: 4172 6561 2c0d 0a20 2073 7461 7274 5965  Area,..  startYe
-0001d0f0: 6172 2c0d 0a20 2065 6e64 5965 6172 2c0d  ar,..  endYear,.
-0001d100: 0a20 2073 7461 7274 4a75 6c69 616e 2c0d  .  startJulian,.
-0001d110: 0a20 2065 6e64 4a75 6c69 616e 2c0d 0a20  .  endJulian,.. 
-0001d120: 2074 6f61 4f72 5352 203d 2027 5352 272c   toaOrSR = 'SR',
-0001d130: 0d0a 2020 696e 636c 7564 6553 4c43 4f66  ..  includeSLCOf
-0001d140: 664c 3720 3d20 4661 6c73 652c 0d0a 2020  fL7 = False,..  
-0001d150: 6465 6672 696e 6765 4c35 203d 2046 616c  defringeL5 = Fal
-0001d160: 7365 2c0d 0a20 2061 7070 6c79 436c 6f75  se,..  applyClou
-0001d170: 6453 636f 7265 203d 2046 616c 7365 2c0d  dScore = False,.
-0001d180: 0a20 2061 7070 6c79 466d 6173 6b43 6c6f  .  applyFmaskClo
-0001d190: 7564 4d61 736b 203d 2054 7275 652c 0d0a  udMask = True,..
-0001d1a0: 2020 6170 706c 7954 444f 4d20 3d20 4661    applyTDOM = Fa
-0001d1b0: 6c73 652c 0d0a 2020 6170 706c 7946 6d61  lse,..  applyFma
-0001d1c0: 736b 436c 6f75 6453 6861 646f 774d 6173  skCloudShadowMas
-0001d1d0: 6b20 3d20 5472 7565 2c0d 0a20 2061 7070  k = True,..  app
-0001d1e0: 6c79 466d 6173 6b53 6e6f 774d 6173 6b20  lyFmaskSnowMask 
-0001d1f0: 3d20 4661 6c73 652c 0d0a 2020 636c 6f75  = False,..  clou
-0001d200: 6453 636f 7265 5468 7265 7368 203d 2031  dScoreThresh = 1
-0001d210: 302c 0d0a 2020 7065 7266 6f72 6d43 6c6f  0,..  performClo
-0001d220: 7564 5363 6f72 654f 6666 7365 7420 3d20  udScoreOffset = 
-0001d230: 5472 7565 2c0d 0a20 2063 6c6f 7564 5363  True,..  cloudSc
-0001d240: 6f72 6550 6374 6c20 3d20 3130 2c0d 0a20  orePctl = 10,.. 
-0001d250: 207a 5363 6f72 6554 6872 6573 6820 3d20   zScoreThresh = 
-0001d260: 2d31 2c0d 0a20 2073 6861 646f 7753 756d  -1,..  shadowSum
-0001d270: 5468 7265 7368 203d 2030 2e33 352c 0d0a  Thresh = 0.35,..
-0001d280: 2020 636f 6e74 7261 6374 5069 7865 6c73    contractPixels
-0001d290: 203d 2031 2e35 2c0d 0a20 2064 696c 6174   = 1.5,..  dilat
-0001d2a0: 6550 6978 656c 7320 3d20 332e 352c 0d0a  ePixels = 3.5,..
-0001d2b0: 2020 7368 6164 6f77 5375 6d42 616e 6473    shadowSumBands
-0001d2c0: 203d 205b 276e 6972 272c 2773 7769 7231   = ['nir','swir1
-0001d2d0: 275d 2c0d 0a20 2072 6573 616d 706c 654d  '],..  resampleM
-0001d2e0: 6574 686f 6420 3d20 276e 6561 7227 2c0d  ethod = 'near',.
-0001d2f0: 0a20 2068 6172 6d6f 6e69 7a65 4f4c 4920  .  harmonizeOLI 
-0001d300: 3d20 4661 6c73 652c 0d0a 2020 7072 6543  = False,..  preC
-0001d310: 6f6d 7075 7465 6443 6c6f 7564 5363 6f72  omputedCloudScor
-0001d320: 654f 6666 7365 7420 3d20 4e6f 6e65 2c0d  eOffset = None,.
-0001d330: 0a20 2070 7265 436f 6d70 7574 6564 5444  .  preComputedTD
-0001d340: 4f4d 4952 4d65 616e 203d 204e 6f6e 652c  OMIRMean = None,
-0001d350: 0d0a 2020 7072 6543 6f6d 7075 7465 6454  ..  preComputedT
-0001d360: 444f 4d49 5253 7464 4465 7620 3d20 4e6f  DOMIRStdDev = No
-0001d370: 6e65 2c0d 0a20 206c 616e 6473 6174 436f  ne,..  landsatCo
-0001d380: 6c6c 6563 7469 6f6e 5665 7273 696f 6e20  llectionVersion 
-0001d390: 3d20 2743 3227 293a 0d0a 0d0a 2020 6f72  = 'C2'):....  or
-0001d3a0: 6967 696e 203d 2027 4c61 6e64 7361 7427  igin = 'Landsat'
-0001d3b0: 0d0a 2020 746f 614f 7253 5220 3d20 746f  ..  toaOrSR = to
-0001d3c0: 614f 7253 522e 7570 7065 7228 290d 0a20  aOrSR.upper().. 
-0001d3d0: 2069 6620 746f 614f 7253 522e 6c6f 7765   if toaOrSR.lowe
-0001d3e0: 7228 2920 3d3d 2027 746f 6127 2061 6e64  r() == 'toa' and
-0001d3f0: 206c 616e 6473 6174 436f 6c6c 6563 7469   landsatCollecti
-0001d400: 6f6e 5665 7273 696f 6e2e 6c6f 7765 7228  onVersion.lower(
-0001d410: 2920 3d3d 2027 6331 2720 616e 6420 2861  ) == 'c1' and (a
-0001d420: 7070 6c79 466d 6173 6b43 6c6f 7564 4d61  pplyFmaskCloudMa
-0001d430: 736b 206f 7220 6170 706c 7946 6d61 736b  sk or applyFmask
-0001d440: 436c 6f75 6453 6861 646f 774d 6173 6b20  CloudShadowMask 
-0001d450: 206f 7220 6170 706c 7946 6d61 736b 536e   or applyFmaskSn
-0001d460: 6f77 4d61 736b 2029 3a0d 0a20 2020 2061  owMask ):..    a
-0001d470: 6464 5069 7865 6c51 4120 3d20 5472 7565  ddPixelQA = True
-0001d480: 0d0a 2020 656c 7365 3a0d 0a20 2020 2061  ..  else:..    a
-0001d490: 6464 5069 7865 6c51 4120 3d20 4661 6c73  ddPixelQA = Fals
-0001d4a0: 650d 0a0d 0a20 2023 5072 6570 6172 6520  e....  #Prepare 
-0001d4b0: 6461 7465 730d 0a20 2023 5772 6170 2074  dates..  #Wrap t
-0001d4c0: 6865 2064 6174 6573 2069 6620 6e65 6564  he dates if need
-0001d4d0: 6564 0d0a 2020 7772 6170 4f66 6673 6574  ed..  wrapOffset
-0001d4e0: 203d 2030 0d0a 2020 6966 2073 7461 7274   = 0..  if start
-0001d4f0: 4a75 6c69 616e 203e 2065 6e64 4a75 6c69  Julian > endJuli
-0001d500: 616e 3a0d 0a20 2020 2077 7261 704f 6666  an:..    wrapOff
-0001d510: 7365 7420 3d20 3336 350d 0a20 2073 7461  set = 365..  sta
-0001d520: 7274 4461 7465 203d 2065 652e 4461 7465  rtDate = ee.Date
-0001d530: 2e66 726f 6d59 4d44 2873 7461 7274 5965  .fromYMD(startYe
-0001d540: 6172 2c31 2c31 292e 6164 7661 6e63 6528  ar,1,1).advance(
-0001d550: 7374 6172 744a 756c 6961 6e2d 312c 2764  startJulian-1,'d
-0001d560: 6179 2729 0d0a 2020 656e 6444 6174 6520  ay')..  endDate 
-0001d570: 3d20 6565 2e44 6174 652e 6672 6f6d 594d  = ee.Date.fromYM
-0001d580: 4428 656e 6459 6561 722c 312c 3129 2e61  D(endYear,1,1).a
-0001d590: 6476 616e 6365 2865 6e64 4a75 6c69 616e  dvance(endJulian
-0001d5a0: 2d31 2b77 7261 704f 6666 7365 742c 2764  -1+wrapOffset,'d
-0001d5b0: 6179 2729 0d0a 0d0a 2020 6172 6773 203d  ay')....  args =
-0001d5c0: 2066 6f72 6d61 7441 7267 7328 6c6f 6361   formatArgs(loca
-0001d5d0: 6c73 2829 290d 0a20 2069 6620 2761 7267  ls())..  if 'arg
-0001d5e0: 7327 2069 6e20 6172 6773 2e6b 6579 7328  s' in args.keys(
-0001d5f0: 293a 0d0a 2020 2020 6465 6c20 6172 6773  ):..    del args
-0001d600: 5b27 6172 6773 275d 0d0a 0d0a 2020 7072  ['args']....  pr
-0001d610: 696e 7428 2747 6574 2050 726f 6365 7373  int('Get Process
-0001d620: 6564 204c 616e 6473 6174 3a20 2729 0d0a  ed Landsat: ')..
-0001d630: 2020 2320 7072 696e 7428 2753 7461 7274    # print('Start
-0001d640: 2064 6174 653a 272c 2073 7461 7274 4461   date:', startDa
-0001d650: 7465 2e66 6f72 6d61 7428 274d 4d4d 2064  te.format('MMM d
-0001d660: 6420 7979 7979 2729 2e67 6574 496e 666f  d yyyy').getInfo
-0001d670: 2829 2c27 2c20 456e 6420 6461 7465 3a27  (),', End date:'
-0001d680: 2c20 656e 6444 6174 652e 666f 726d 6174  , endDate.format
-0001d690: 2827 4d4d 4d20 6464 2079 7979 7927 292e  ('MMM dd yyyy').
-0001d6a0: 6765 7449 6e66 6f28 2929 0d0a 2020 2320  getInfo())..  # 
-0001d6b0: 666f 7220 6172 6720 696e 2061 7267 732e  for arg in args.
-0001d6c0: 6b65 7973 2829 3a0d 0a20 2023 2020 2070  keys():..  #   p
-0001d6d0: 7269 6e74 2861 7267 2c20 273a 2027 2c20  rint(arg, ': ', 
-0001d6e0: 6172 6773 5b61 7267 5d29 0d0a 0d0a 2020  args[arg])....  
-0001d6f0: 2347 6574 204c 616e 6473 6174 2069 6d61  #Get Landsat ima
-0001d700: 6765 2063 6f6c 6c65 6374 696f 6e0d 0a20  ge collection.. 
-0001d710: 206c 7320 3d20 6765 744c 616e 6473 6174   ls = getLandsat
-0001d720: 285c 0d0a 2020 2020 7374 7564 7941 7265  (\..    studyAre
-0001d730: 6120 3d20 7374 7564 7941 7265 612c 0d0a  a = studyArea,..
-0001d740: 2020 2020 7374 6172 7444 6174 6520 3d20      startDate = 
-0001d750: 7374 6172 7444 6174 652c 0d0a 2020 2020  startDate,..    
-0001d760: 656e 6444 6174 6520 3d20 656e 6444 6174  endDate = endDat
-0001d770: 652c 0d0a 2020 2020 7374 6172 744a 756c  e,..    startJul
-0001d780: 6961 6e20 3d20 7374 6172 744a 756c 6961  ian = startJulia
-0001d790: 6e2c 0d0a 2020 2020 656e 644a 756c 6961  n,..    endJulia
-0001d7a0: 6e20 3d20 656e 644a 756c 6961 6e2c 0d0a  n = endJulian,..
-0001d7b0: 2020 2020 746f 614f 7253 5220 3d20 746f      toaOrSR = to
-0001d7c0: 614f 7253 522c 0d0a 2020 2020 696e 636c  aOrSR,..    incl
-0001d7d0: 7564 6553 4c43 4f66 664c 3720 3d20 696e  udeSLCOffL7 = in
-0001d7e0: 636c 7564 6553 4c43 4f66 664c 372c 0d0a  cludeSLCOffL7,..
-0001d7f0: 2020 2020 6465 6672 696e 6765 4c35 203d      defringeL5 =
-0001d800: 2064 6566 7269 6e67 654c 352c 0d0a 2020   defringeL5,..  
-0001d810: 2020 6164 6450 6978 656c 5141 203d 2061    addPixelQA = a
-0001d820: 6464 5069 7865 6c51 412c 0d0a 2020 2020  ddPixelQA,..    
-0001d830: 7265 7361 6d70 6c65 4d65 7468 6f64 203d  resampleMethod =
-0001d840: 2072 6573 616d 706c 654d 6574 686f 642c   resampleMethod,
-0001d850: 0d0a 2020 2020 6c61 6e64 7361 7443 6f6c  ..    landsatCol
-0001d860: 6c65 6374 696f 6e56 6572 7369 6f6e 203d  lectionVersion =
-0001d870: 206c 616e 6473 6174 436f 6c6c 6563 7469   landsatCollecti
-0001d880: 6f6e 5665 7273 696f 6e29 0d0a 0d0a 2020  onVersion)....  
-0001d890: 2341 7070 6c79 2072 656c 6576 616e 7420  #Apply relevant 
-0001d8a0: 636c 6f75 6420 6d61 736b 696e 6720 6d65  cloud masking me
-0001d8b0: 7468 6f64 730d 0a20 2069 6620 6170 706c  thods..  if appl
-0001d8c0: 7943 6c6f 7564 5363 6f72 653a 0d0a 2020  yCloudScore:..  
-0001d8d0: 2020 7072 696e 7428 2741 7070 6c79 696e    print('Applyin
-0001d8e0: 6720 436c 6f75 6420 5363 6f72 6527 290d  g Cloud Score').
-0001d8f0: 0a20 2020 206c 7320 3d20 6170 706c 7943  .    ls = applyC
-0001d900: 6c6f 7564 5363 6f72 6541 6c67 6f72 6974  loudScoreAlgorit
-0001d910: 686d 285c 0d0a 2020 2020 2020 636f 6c6c  hm(\..      coll
-0001d920: 6563 7469 6f6e 203d 206c 732c 0d0a 2020  ection = ls,..  
-0001d930: 2020 2020 636c 6f75 6453 636f 7265 4675      cloudScoreFu
-0001d940: 6e63 7469 6f6e 203d 206c 616e 6473 6174  nction = landsat
-0001d950: 436c 6f75 6453 636f 7265 2c0d 0a20 2020  CloudScore,..   
-0001d960: 2020 2063 6c6f 7564 5363 6f72 6554 6872     cloudScoreThr
-0001d970: 6573 6820 3d20 636c 6f75 6453 636f 7265  esh = cloudScore
-0001d980: 5468 7265 7368 2c0d 0a20 2020 2020 2063  Thresh,..      c
-0001d990: 6c6f 7564 5363 6f72 6550 6374 6c20 3d20  loudScorePctl = 
-0001d9a0: 636c 6f75 6453 636f 7265 5063 746c 2c0d  cloudScorePctl,.
-0001d9b0: 0a20 2020 2020 2063 6f6e 7472 6163 7450  .      contractP
-0001d9c0: 6978 656c 7320 3d20 636f 6e74 7261 6374  ixels = contract
-0001d9d0: 5069 7865 6c73 2c0d 0a20 2020 2020 2064  Pixels,..      d
-0001d9e0: 696c 6174 6550 6978 656c 7320 3d20 6469  ilatePixels = di
-0001d9f0: 6c61 7465 5069 7865 6c73 2c0d 0a20 2020  latePixels,..   
-0001da00: 2020 2070 6572 666f 726d 436c 6f75 6453     performCloudS
-0001da10: 636f 7265 4f66 6673 6574 203d 2070 6572  coreOffset = per
-0001da20: 666f 726d 436c 6f75 6453 636f 7265 4f66  formCloudScoreOf
-0001da30: 6673 6574 2c0d 0a20 2020 2020 2070 7265  fset,..      pre
-0001da40: 436f 6d70 7574 6564 436c 6f75 6453 636f  ComputedCloudSco
-0001da50: 7265 4f66 6673 6574 203d 2070 7265 436f  reOffset = preCo
-0001da60: 6d70 7574 6564 436c 6f75 6453 636f 7265  mputedCloudScore
-0001da70: 4f66 6673 6574 290d 0a0d 0a20 2069 6620  Offset)....  if 
-0001da80: 6170 706c 7946 6d61 736b 436c 6f75 644d  applyFmaskCloudM
-0001da90: 6173 6b3a 0d0a 2020 2020 7072 696e 7428  ask:..    print(
-0001daa0: 2741 7070 6c79 696e 6720 466d 6173 6b20  'Applying Fmask 
-0001dab0: 436c 6f75 6420 4d61 736b 2729 0d0a 2020  Cloud Mask')..  
-0001dac0: 2020 6c73 203d 206c 732e 6d61 7028 6c61    ls = ls.map(la
-0001dad0: 6d62 6461 2069 6d67 3a20 6170 706c 7942  mbda img: applyB
-0001dae0: 6974 4d61 736b 2869 6d67 2c66 6d61 736b  itMask(img,fmask
-0001daf0: 4269 7444 6963 745b 6c61 6e64 7361 7443  BitDict[landsatC
-0001db00: 6f6c 6c65 6374 696f 6e56 6572 7369 6f6e  ollectionVersion
-0001db10: 5d5b 2763 6c6f 7564 275d 2c6c 616e 6473  ]['cloud'],lands
-0001db20: 6174 466d 6173 6b42 616e 644e 616d 6544  atFmaskBandNameD
-0001db30: 6963 745b 6c61 6e64 7361 7443 6f6c 6c65  ict[landsatColle
-0001db40: 6374 696f 6e56 6572 7369 6f6e 5d29 290d  ctionVersion])).
-0001db50: 0a0d 0a20 2069 6620 6170 706c 7954 444f  ...  if applyTDO
-0001db60: 4d3a 0d0a 2020 2020 7072 696e 7428 2741  M:..    print('A
-0001db70: 7070 6c79 696e 6720 5444 4f4d 2053 6861  pplying TDOM Sha
-0001db80: 646f 7720 4d61 736b 2729 0d0a 2020 2020  dow Mask')..    
-0001db90: 6c73 203d 2073 696d 706c 6554 444f 4d32  ls = simpleTDOM2
-0001dba0: 285c 0d0a 2020 2020 2020 636f 6c6c 6563  (\..      collec
-0001dbb0: 7469 6f6e 203d 206c 732c 0d0a 2020 2020  tion = ls,..    
-0001dbc0: 2020 7a53 636f 7265 5468 7265 7368 203d    zScoreThresh =
-0001dbd0: 207a 5363 6f72 6554 6872 6573 682c 0d0a   zScoreThresh,..
-0001dbe0: 2020 2020 2020 7368 6164 6f77 5375 6d54        shadowSumT
-0001dbf0: 6872 6573 6820 3d20 7368 6164 6f77 5375  hresh = shadowSu
-0001dc00: 6d54 6872 6573 682c 0d0a 2020 2020 2020  mThresh,..      
-0001dc10: 636f 6e74 7261 6374 5069 7865 6c73 203d  contractPixels =
-0001dc20: 2063 6f6e 7472 6163 7450 6978 656c 732c   contractPixels,
-0001dc30: 0d0a 2020 2020 2020 6469 6c61 7465 5069  ..      dilatePi
-0001dc40: 7865 6c73 203d 2064 696c 6174 6550 6978  xels = dilatePix
-0001dc50: 656c 732c 0d0a 2020 2020 2020 7368 6164  els,..      shad
-0001dc60: 6f77 5375 6d42 616e 6473 203d 205b 276e  owSumBands = ['n
-0001dc70: 6972 272c 2773 7769 7231 275d 2c0d 0a20  ir','swir1'],.. 
-0001dc80: 2020 2020 2070 7265 436f 6d70 7574 6564       preComputed
-0001dc90: 5444 4f4d 4952 4d65 616e 203d 2070 7265  TDOMIRMean = pre
-0001dca0: 436f 6d70 7574 6564 5444 4f4d 4952 4d65  ComputedTDOMIRMe
-0001dcb0: 616e 2c0d 0a20 2020 2020 2070 7265 436f  an,..      preCo
-0001dcc0: 6d70 7574 6564 5444 4f4d 4952 5374 6444  mputedTDOMIRStdD
-0001dcd0: 6576 203d 2070 7265 436f 6d70 7574 6564  ev = preComputed
-0001dce0: 5444 4f4d 4952 5374 6444 6576 290d 0a0d  TDOMIRStdDev)...
-0001dcf0: 0a20 2069 6620 6170 706c 7946 6d61 736b  .  if applyFmask
-0001dd00: 436c 6f75 6453 6861 646f 774d 6173 6b3a  CloudShadowMask:
-0001dd10: 0d0a 2020 2020 7072 696e 7428 2741 7070  ..    print('App
-0001dd20: 6c79 696e 6720 466d 6173 6b20 5368 6164  lying Fmask Shad
-0001dd30: 6f77 204d 6173 6b27 290d 0a20 2020 206c  ow Mask')..    l
-0001dd40: 7320 3d20 6c73 2e6d 6170 286c 616d 6264  s = ls.map(lambd
-0001dd50: 6120 696d 673a 2061 7070 6c79 4269 744d  a img: applyBitM
-0001dd60: 6173 6b28 696d 672c 666d 6173 6b42 6974  ask(img,fmaskBit
-0001dd70: 4469 6374 5b6c 616e 6473 6174 436f 6c6c  Dict[landsatColl
-0001dd80: 6563 7469 6f6e 5665 7273 696f 6e5d 5b27  ectionVersion]['
-0001dd90: 7368 6164 6f77 275d 2c6c 616e 6473 6174  shadow'],landsat
-0001dda0: 466d 6173 6b42 616e 644e 616d 6544 6963  FmaskBandNameDic
-0001ddb0: 745b 6c61 6e64 7361 7443 6f6c 6c65 6374  t[landsatCollect
-0001ddc0: 696f 6e56 6572 7369 6f6e 5d29 290d 0a0d  ionVersion]))...
-0001ddd0: 0a0d 0a20 2069 6620 6170 706c 7946 6d61  ...  if applyFma
-0001dde0: 736b 536e 6f77 4d61 736b 3a0d 0a20 2020  skSnowMask:..   
-0001ddf0: 2070 7269 6e74 2827 4170 706c 7969 6e67   print('Applying
-0001de00: 2046 6d61 736b 2073 6e6f 7720 6d61 736b   Fmask snow mask
-0001de10: 2729 0d0a 2020 2020 6c73 203d 206c 732e  ')..    ls = ls.
-0001de20: 6d61 7028 6c61 6d62 6461 2069 6d67 3a20  map(lambda img: 
-0001de30: 6170 706c 7942 6974 4d61 736b 2869 6d67  applyBitMask(img
-0001de40: 2c66 6d61 736b 4269 7444 6963 745b 6c61  ,fmaskBitDict[la
-0001de50: 6e64 7361 7443 6f6c 6c65 6374 696f 6e56  ndsatCollectionV
-0001de60: 6572 7369 6f6e 5d5b 2773 6e6f 7727 5d2c  ersion]['snow'],
-0001de70: 6c61 6e64 7361 7446 6d61 736b 4261 6e64  landsatFmaskBand
-0001de80: 4e61 6d65 4469 6374 5b6c 616e 6473 6174  NameDict[landsat
-0001de90: 436f 6c6c 6563 7469 6f6e 5665 7273 696f  CollectionVersio
-0001dea0: 6e5d 2929 0d0a 0d0a 0d0a 2020 2320 4164  n]))......  # Ad
-0001deb0: 6420 636f 6d6d 6f6e 2069 6e64 6963 6573  d common indices
-0001dec0: 0d0a 2020 6c73 203d 206c 732e 6d61 7028  ..  ls = ls.map(
-0001ded0: 7369 6d70 6c65 4164 6449 6e64 6963 6573  simpleAddIndices
-0001dee0: 295c 0d0a 2020 2020 2020 2020 2020 2e6d  )\..          .m
-0001def0: 6170 2867 6574 5461 7373 656c 6564 4361  ap(getTasseledCa
-0001df00: 7029 5c0d 0a20 2020 2020 2020 2020 202e  p)\..          .
-0001df10: 6d61 7028 7369 6d70 6c65 4164 6454 4341  map(simpleAddTCA
-0001df20: 6e67 6c65 7329 0d0a 0d0a 2020 2320 4164  ngles)....  # Ad
-0001df30: 6420 5365 6e73 6f72 2042 616e 640d 0a20  d Sensor Band.. 
-0001df40: 206c 7320 3d20 6c73 2e6d 6170 286c 616d   ls = ls.map(lam
-0001df50: 6264 6120 696d 673a 2061 6464 5365 6e73  bda img: addSens
-0001df60: 6f72 4261 6e64 2869 6d67 2c20 6c61 6e64  orBand(img, land
-0001df70: 7361 7443 6f6c 6c65 6374 696f 6e56 6572  satCollectionVer
-0001df80: 7369 6f6e 2b27 5f6c 616e 6473 6174 272c  sion+'_landsat',
-0001df90: 2074 6f61 4f72 5352 2929 0d0a 0d0a 2020   toaOrSR))....  
-0001dfa0: 7265 7475 726e 206c 732e 7365 7428 6172  return ls.set(ar
-0001dfb0: 6773 290d 0a0d 0a23 2323 2323 2323 2323  gs)....#########
+0001d020: 2323 2323 230d 0a23 5772 6170 7065 7220  #####..#Wrapper 
+0001d030: 6675 6e63 7469 6f6e 2066 6f72 2067 6574  function for get
+0001d040: 7469 6e67 204c 616e 6473 6174 2069 6d61  ting Landsat ima
+0001d050: 6765 7279 0d0a 6465 6620 6765 7450 726f  gery..def getPro
+0001d060: 6365 7373 6564 4c61 6e64 7361 7453 6365  cessedLandsatSce
+0001d070: 6e65 7328 0d0a 2020 7374 7564 7941 7265  nes(..  studyAre
+0001d080: 612c 0d0a 2020 7374 6172 7459 6561 722c  a,..  startYear,
+0001d090: 0d0a 2020 656e 6459 6561 722c 0d0a 2020  ..  endYear,..  
+0001d0a0: 7374 6172 744a 756c 6961 6e2c 0d0a 2020  startJulian,..  
+0001d0b0: 656e 644a 756c 6961 6e2c 0d0a 2020 746f  endJulian,..  to
+0001d0c0: 614f 7253 5220 3d20 2753 5227 2c0d 0a20  aOrSR = 'SR',.. 
+0001d0d0: 2069 6e63 6c75 6465 534c 434f 6666 4c37   includeSLCOffL7
+0001d0e0: 203d 2046 616c 7365 2c0d 0a20 2064 6566   = False,..  def
+0001d0f0: 7269 6e67 654c 3520 3d20 4661 6c73 652c  ringeL5 = False,
+0001d100: 0d0a 2020 6170 706c 7943 6c6f 7564 5363  ..  applyCloudSc
+0001d110: 6f72 6520 3d20 4661 6c73 652c 0d0a 2020  ore = False,..  
+0001d120: 6170 706c 7946 6d61 736b 436c 6f75 644d  applyFmaskCloudM
+0001d130: 6173 6b20 3d20 5472 7565 2c0d 0a20 2061  ask = True,..  a
+0001d140: 7070 6c79 5444 4f4d 203d 2046 616c 7365  pplyTDOM = False
+0001d150: 2c0d 0a20 2061 7070 6c79 466d 6173 6b43  ,..  applyFmaskC
+0001d160: 6c6f 7564 5368 6164 6f77 4d61 736b 203d  loudShadowMask =
+0001d170: 2054 7275 652c 0d0a 2020 6170 706c 7946   True,..  applyF
+0001d180: 6d61 736b 536e 6f77 4d61 736b 203d 2046  maskSnowMask = F
+0001d190: 616c 7365 2c0d 0a20 2063 6c6f 7564 5363  alse,..  cloudSc
+0001d1a0: 6f72 6554 6872 6573 6820 3d20 3130 2c0d  oreThresh = 10,.
+0001d1b0: 0a20 2070 6572 666f 726d 436c 6f75 6453  .  performCloudS
+0001d1c0: 636f 7265 4f66 6673 6574 203d 2054 7275  coreOffset = Tru
+0001d1d0: 652c 0d0a 2020 636c 6f75 6453 636f 7265  e,..  cloudScore
+0001d1e0: 5063 746c 203d 2031 302c 0d0a 2020 7a53  Pctl = 10,..  zS
+0001d1f0: 636f 7265 5468 7265 7368 203d 202d 312c  coreThresh = -1,
+0001d200: 0d0a 2020 7368 6164 6f77 5375 6d54 6872  ..  shadowSumThr
+0001d210: 6573 6820 3d20 302e 3335 2c0d 0a20 2063  esh = 0.35,..  c
+0001d220: 6f6e 7472 6163 7450 6978 656c 7320 3d20  ontractPixels = 
+0001d230: 312e 352c 0d0a 2020 6469 6c61 7465 5069  1.5,..  dilatePi
+0001d240: 7865 6c73 203d 2033 2e35 2c0d 0a20 2073  xels = 3.5,..  s
+0001d250: 6861 646f 7753 756d 4261 6e64 7320 3d20  hadowSumBands = 
+0001d260: 5b27 6e69 7227 2c27 7377 6972 3127 5d2c  ['nir','swir1'],
+0001d270: 0d0a 2020 7265 7361 6d70 6c65 4d65 7468  ..  resampleMeth
+0001d280: 6f64 203d 2027 6e65 6172 272c 0d0a 2020  od = 'near',..  
+0001d290: 6861 726d 6f6e 697a 654f 4c49 203d 2046  harmonizeOLI = F
+0001d2a0: 616c 7365 2c0d 0a20 2070 7265 436f 6d70  alse,..  preComp
+0001d2b0: 7574 6564 436c 6f75 6453 636f 7265 4f66  utedCloudScoreOf
+0001d2c0: 6673 6574 203d 204e 6f6e 652c 0d0a 2020  fset = None,..  
+0001d2d0: 7072 6543 6f6d 7075 7465 6454 444f 4d49  preComputedTDOMI
+0001d2e0: 524d 6561 6e20 3d20 4e6f 6e65 2c0d 0a20  RMean = None,.. 
+0001d2f0: 2070 7265 436f 6d70 7574 6564 5444 4f4d   preComputedTDOM
+0001d300: 4952 5374 6444 6576 203d 204e 6f6e 652c  IRStdDev = None,
+0001d310: 0d0a 2020 6c61 6e64 7361 7443 6f6c 6c65  ..  landsatColle
+0001d320: 6374 696f 6e56 6572 7369 6f6e 203d 2027  ctionVersion = '
+0001d330: 4332 2729 3a0d 0a0d 0a20 206f 7269 6769  C2'):....  origi
+0001d340: 6e20 3d20 274c 616e 6473 6174 270d 0a20  n = 'Landsat'.. 
+0001d350: 2074 6f61 4f72 5352 203d 2074 6f61 4f72   toaOrSR = toaOr
+0001d360: 5352 2e75 7070 6572 2829 0d0a 2020 6966  SR.upper()..  if
+0001d370: 2074 6f61 4f72 5352 2e6c 6f77 6572 2829   toaOrSR.lower()
+0001d380: 203d 3d20 2774 6f61 2720 616e 6420 6c61   == 'toa' and la
+0001d390: 6e64 7361 7443 6f6c 6c65 6374 696f 6e56  ndsatCollectionV
+0001d3a0: 6572 7369 6f6e 2e6c 6f77 6572 2829 203d  ersion.lower() =
+0001d3b0: 3d20 2763 3127 2061 6e64 2028 6170 706c  = 'c1' and (appl
+0001d3c0: 7946 6d61 736b 436c 6f75 644d 6173 6b20  yFmaskCloudMask 
+0001d3d0: 6f72 2061 7070 6c79 466d 6173 6b43 6c6f  or applyFmaskClo
+0001d3e0: 7564 5368 6164 6f77 4d61 736b 2020 6f72  udShadowMask  or
+0001d3f0: 2061 7070 6c79 466d 6173 6b53 6e6f 774d   applyFmaskSnowM
+0001d400: 6173 6b20 293a 0d0a 2020 2020 6164 6450  ask ):..    addP
+0001d410: 6978 656c 5141 203d 2054 7275 650d 0a20  ixelQA = True.. 
+0001d420: 2065 6c73 653a 0d0a 2020 2020 6164 6450   else:..    addP
+0001d430: 6978 656c 5141 203d 2046 616c 7365 0d0a  ixelQA = False..
+0001d440: 0d0a 2020 2350 7265 7061 7265 2064 6174  ..  #Prepare dat
+0001d450: 6573 0d0a 2020 2357 7261 7020 7468 6520  es..  #Wrap the 
+0001d460: 6461 7465 7320 6966 206e 6565 6465 640d  dates if needed.
+0001d470: 0a20 2077 7261 704f 6666 7365 7420 3d20  .  wrapOffset = 
+0001d480: 300d 0a20 2069 6620 7374 6172 744a 756c  0..  if startJul
+0001d490: 6961 6e20 3e20 656e 644a 756c 6961 6e3a  ian > endJulian:
+0001d4a0: 0d0a 2020 2020 7772 6170 4f66 6673 6574  ..    wrapOffset
+0001d4b0: 203d 2033 3635 0d0a 2020 7374 6172 7444   = 365..  startD
+0001d4c0: 6174 6520 3d20 6565 2e44 6174 652e 6672  ate = ee.Date.fr
+0001d4d0: 6f6d 594d 4428 7374 6172 7459 6561 722c  omYMD(startYear,
+0001d4e0: 312c 3129 2e61 6476 616e 6365 2873 7461  1,1).advance(sta
+0001d4f0: 7274 4a75 6c69 616e 2d31 2c27 6461 7927  rtJulian-1,'day'
+0001d500: 290d 0a20 2065 6e64 4461 7465 203d 2065  )..  endDate = e
+0001d510: 652e 4461 7465 2e66 726f 6d59 4d44 2865  e.Date.fromYMD(e
+0001d520: 6e64 5965 6172 2c31 2c31 292e 6164 7661  ndYear,1,1).adva
+0001d530: 6e63 6528 656e 644a 756c 6961 6e2d 312b  nce(endJulian-1+
+0001d540: 7772 6170 4f66 6673 6574 2c27 6461 7927  wrapOffset,'day'
+0001d550: 290d 0a0d 0a20 2061 7267 7320 3d20 666f  )....  args = fo
+0001d560: 726d 6174 4172 6773 286c 6f63 616c 7328  rmatArgs(locals(
+0001d570: 2929 0d0a 2020 6966 2027 6172 6773 2720  ))..  if 'args' 
+0001d580: 696e 2061 7267 732e 6b65 7973 2829 3a0d  in args.keys():.
+0001d590: 0a20 2020 2064 656c 2061 7267 735b 2761  .    del args['a
+0001d5a0: 7267 7327 5d0d 0a0d 0a20 2070 7269 6e74  rgs']....  print
+0001d5b0: 2827 4765 7420 5072 6f63 6573 7365 6420  ('Get Processed 
+0001d5c0: 4c61 6e64 7361 743a 2027 290d 0a20 2023  Landsat: ')..  #
+0001d5d0: 2070 7269 6e74 2827 5374 6172 7420 6461   print('Start da
+0001d5e0: 7465 3a27 2c20 7374 6172 7444 6174 652e  te:', startDate.
+0001d5f0: 666f 726d 6174 2827 4d4d 4d20 6464 2079  format('MMM dd y
+0001d600: 7979 7927 292e 6765 7449 6e66 6f28 292c  yyy').getInfo(),
+0001d610: 272c 2045 6e64 2064 6174 653a 272c 2065  ', End date:', e
+0001d620: 6e64 4461 7465 2e66 6f72 6d61 7428 274d  ndDate.format('M
+0001d630: 4d4d 2064 6420 7979 7979 2729 2e67 6574  MM dd yyyy').get
+0001d640: 496e 666f 2829 290d 0a20 2023 2066 6f72  Info())..  # for
+0001d650: 2061 7267 2069 6e20 6172 6773 2e6b 6579   arg in args.key
+0001d660: 7328 293a 0d0a 2020 2320 2020 7072 696e  s():..  #   prin
+0001d670: 7428 6172 672c 2027 3a20 272c 2061 7267  t(arg, ': ', arg
+0001d680: 735b 6172 675d 290d 0a0d 0a20 2023 4765  s[arg])....  #Ge
+0001d690: 7420 4c61 6e64 7361 7420 696d 6167 6520  t Landsat image 
+0001d6a0: 636f 6c6c 6563 7469 6f6e 0d0a 2020 6c73  collection..  ls
+0001d6b0: 203d 2067 6574 4c61 6e64 7361 7428 5c0d   = getLandsat(\.
+0001d6c0: 0a20 2020 2073 7475 6479 4172 6561 203d  .    studyArea =
+0001d6d0: 2073 7475 6479 4172 6561 2c0d 0a20 2020   studyArea,..   
+0001d6e0: 2073 7461 7274 4461 7465 203d 2073 7461   startDate = sta
+0001d6f0: 7274 4461 7465 2c0d 0a20 2020 2065 6e64  rtDate,..    end
+0001d700: 4461 7465 203d 2065 6e64 4461 7465 2c0d  Date = endDate,.
+0001d710: 0a20 2020 2073 7461 7274 4a75 6c69 616e  .    startJulian
+0001d720: 203d 2073 7461 7274 4a75 6c69 616e 2c0d   = startJulian,.
+0001d730: 0a20 2020 2065 6e64 4a75 6c69 616e 203d  .    endJulian =
+0001d740: 2065 6e64 4a75 6c69 616e 2c0d 0a20 2020   endJulian,..   
+0001d750: 2074 6f61 4f72 5352 203d 2074 6f61 4f72   toaOrSR = toaOr
+0001d760: 5352 2c0d 0a20 2020 2069 6e63 6c75 6465  SR,..    include
+0001d770: 534c 434f 6666 4c37 203d 2069 6e63 6c75  SLCOffL7 = inclu
+0001d780: 6465 534c 434f 6666 4c37 2c0d 0a20 2020  deSLCOffL7,..   
+0001d790: 2064 6566 7269 6e67 654c 3520 3d20 6465   defringeL5 = de
+0001d7a0: 6672 696e 6765 4c35 2c0d 0a20 2020 2061  fringeL5,..    a
+0001d7b0: 6464 5069 7865 6c51 4120 3d20 6164 6450  ddPixelQA = addP
+0001d7c0: 6978 656c 5141 2c0d 0a20 2020 2072 6573  ixelQA,..    res
+0001d7d0: 616d 706c 654d 6574 686f 6420 3d20 7265  ampleMethod = re
+0001d7e0: 7361 6d70 6c65 4d65 7468 6f64 2c0d 0a20  sampleMethod,.. 
+0001d7f0: 2020 206c 616e 6473 6174 436f 6c6c 6563     landsatCollec
+0001d800: 7469 6f6e 5665 7273 696f 6e20 3d20 6c61  tionVersion = la
+0001d810: 6e64 7361 7443 6f6c 6c65 6374 696f 6e56  ndsatCollectionV
+0001d820: 6572 7369 6f6e 290d 0a0d 0a20 2023 4170  ersion)....  #Ap
+0001d830: 706c 7920 7265 6c65 7661 6e74 2063 6c6f  ply relevant clo
+0001d840: 7564 206d 6173 6b69 6e67 206d 6574 686f  ud masking metho
+0001d850: 6473 0d0a 2020 6966 2061 7070 6c79 436c  ds..  if applyCl
+0001d860: 6f75 6453 636f 7265 3a0d 0a20 2020 2070  oudScore:..    p
+0001d870: 7269 6e74 2827 4170 706c 7969 6e67 2043  rint('Applying C
+0001d880: 6c6f 7564 2053 636f 7265 2729 0d0a 2020  loud Score')..  
+0001d890: 2020 6c73 203d 2061 7070 6c79 436c 6f75    ls = applyClou
+0001d8a0: 6453 636f 7265 416c 676f 7269 7468 6d28  dScoreAlgorithm(
+0001d8b0: 5c0d 0a20 2020 2020 2063 6f6c 6c65 6374  \..      collect
+0001d8c0: 696f 6e20 3d20 6c73 2c0d 0a20 2020 2020  ion = ls,..     
+0001d8d0: 2063 6c6f 7564 5363 6f72 6546 756e 6374   cloudScoreFunct
+0001d8e0: 696f 6e20 3d20 6c61 6e64 7361 7443 6c6f  ion = landsatClo
+0001d8f0: 7564 5363 6f72 652c 0d0a 2020 2020 2020  udScore,..      
+0001d900: 636c 6f75 6453 636f 7265 5468 7265 7368  cloudScoreThresh
+0001d910: 203d 2063 6c6f 7564 5363 6f72 6554 6872   = cloudScoreThr
+0001d920: 6573 682c 0d0a 2020 2020 2020 636c 6f75  esh,..      clou
+0001d930: 6453 636f 7265 5063 746c 203d 2063 6c6f  dScorePctl = clo
+0001d940: 7564 5363 6f72 6550 6374 6c2c 0d0a 2020  udScorePctl,..  
+0001d950: 2020 2020 636f 6e74 7261 6374 5069 7865      contractPixe
+0001d960: 6c73 203d 2063 6f6e 7472 6163 7450 6978  ls = contractPix
+0001d970: 656c 732c 0d0a 2020 2020 2020 6469 6c61  els,..      dila
+0001d980: 7465 5069 7865 6c73 203d 2064 696c 6174  tePixels = dilat
+0001d990: 6550 6978 656c 732c 0d0a 2020 2020 2020  ePixels,..      
+0001d9a0: 7065 7266 6f72 6d43 6c6f 7564 5363 6f72  performCloudScor
+0001d9b0: 654f 6666 7365 7420 3d20 7065 7266 6f72  eOffset = perfor
+0001d9c0: 6d43 6c6f 7564 5363 6f72 654f 6666 7365  mCloudScoreOffse
+0001d9d0: 742c 0d0a 2020 2020 2020 7072 6543 6f6d  t,..      preCom
+0001d9e0: 7075 7465 6443 6c6f 7564 5363 6f72 654f  putedCloudScoreO
+0001d9f0: 6666 7365 7420 3d20 7072 6543 6f6d 7075  ffset = preCompu
+0001da00: 7465 6443 6c6f 7564 5363 6f72 654f 6666  tedCloudScoreOff
+0001da10: 7365 7429 0d0a 0d0a 2020 6966 2061 7070  set)....  if app
+0001da20: 6c79 466d 6173 6b43 6c6f 7564 4d61 736b  lyFmaskCloudMask
+0001da30: 3a0d 0a20 2020 2070 7269 6e74 2827 4170  :..    print('Ap
+0001da40: 706c 7969 6e67 2046 6d61 736b 2043 6c6f  plying Fmask Clo
+0001da50: 7564 204d 6173 6b27 290d 0a20 2020 206c  ud Mask')..    l
+0001da60: 7320 3d20 6c73 2e6d 6170 286c 616d 6264  s = ls.map(lambd
+0001da70: 6120 696d 673a 2061 7070 6c79 4269 744d  a img: applyBitM
+0001da80: 6173 6b28 696d 672c 666d 6173 6b42 6974  ask(img,fmaskBit
+0001da90: 4469 6374 5b6c 616e 6473 6174 436f 6c6c  Dict[landsatColl
+0001daa0: 6563 7469 6f6e 5665 7273 696f 6e5d 5b27  ectionVersion]['
+0001dab0: 636c 6f75 6427 5d2c 6c61 6e64 7361 7446  cloud'],landsatF
+0001dac0: 6d61 736b 4261 6e64 4e61 6d65 4469 6374  maskBandNameDict
+0001dad0: 5b6c 616e 6473 6174 436f 6c6c 6563 7469  [landsatCollecti
+0001dae0: 6f6e 5665 7273 696f 6e5d 2929 0d0a 0d0a  onVersion]))....
+0001daf0: 2020 6966 2061 7070 6c79 5444 4f4d 3a0d    if applyTDOM:.
+0001db00: 0a20 2020 2070 7269 6e74 2827 4170 706c  .    print('Appl
+0001db10: 7969 6e67 2054 444f 4d20 5368 6164 6f77  ying TDOM Shadow
+0001db20: 204d 6173 6b27 290d 0a20 2020 206c 7320   Mask')..    ls 
+0001db30: 3d20 7369 6d70 6c65 5444 4f4d 3228 5c0d  = simpleTDOM2(\.
+0001db40: 0a20 2020 2020 2063 6f6c 6c65 6374 696f  .      collectio
+0001db50: 6e20 3d20 6c73 2c0d 0a20 2020 2020 207a  n = ls,..      z
+0001db60: 5363 6f72 6554 6872 6573 6820 3d20 7a53  ScoreThresh = zS
+0001db70: 636f 7265 5468 7265 7368 2c0d 0a20 2020  coreThresh,..   
+0001db80: 2020 2073 6861 646f 7753 756d 5468 7265     shadowSumThre
+0001db90: 7368 203d 2073 6861 646f 7753 756d 5468  sh = shadowSumTh
+0001dba0: 7265 7368 2c0d 0a20 2020 2020 2063 6f6e  resh,..      con
+0001dbb0: 7472 6163 7450 6978 656c 7320 3d20 636f  tractPixels = co
+0001dbc0: 6e74 7261 6374 5069 7865 6c73 2c0d 0a20  ntractPixels,.. 
+0001dbd0: 2020 2020 2064 696c 6174 6550 6978 656c       dilatePixel
+0001dbe0: 7320 3d20 6469 6c61 7465 5069 7865 6c73  s = dilatePixels
+0001dbf0: 2c0d 0a20 2020 2020 2073 6861 646f 7753  ,..      shadowS
+0001dc00: 756d 4261 6e64 7320 3d20 5b27 6e69 7227  umBands = ['nir'
+0001dc10: 2c27 7377 6972 3127 5d2c 0d0a 2020 2020  ,'swir1'],..    
+0001dc20: 2020 7072 6543 6f6d 7075 7465 6454 444f    preComputedTDO
+0001dc30: 4d49 524d 6561 6e20 3d20 7072 6543 6f6d  MIRMean = preCom
+0001dc40: 7075 7465 6454 444f 4d49 524d 6561 6e2c  putedTDOMIRMean,
+0001dc50: 0d0a 2020 2020 2020 7072 6543 6f6d 7075  ..      preCompu
+0001dc60: 7465 6454 444f 4d49 5253 7464 4465 7620  tedTDOMIRStdDev 
+0001dc70: 3d20 7072 6543 6f6d 7075 7465 6454 444f  = preComputedTDO
+0001dc80: 4d49 5253 7464 4465 7629 0d0a 0d0a 2020  MIRStdDev)....  
+0001dc90: 6966 2061 7070 6c79 466d 6173 6b43 6c6f  if applyFmaskClo
+0001dca0: 7564 5368 6164 6f77 4d61 736b 3a0d 0a20  udShadowMask:.. 
+0001dcb0: 2020 2070 7269 6e74 2827 4170 706c 7969     print('Applyi
+0001dcc0: 6e67 2046 6d61 736b 2053 6861 646f 7720  ng Fmask Shadow 
+0001dcd0: 4d61 736b 2729 0d0a 2020 2020 6c73 203d  Mask')..    ls =
+0001dce0: 206c 732e 6d61 7028 6c61 6d62 6461 2069   ls.map(lambda i
+0001dcf0: 6d67 3a20 6170 706c 7942 6974 4d61 736b  mg: applyBitMask
+0001dd00: 2869 6d67 2c66 6d61 736b 4269 7444 6963  (img,fmaskBitDic
+0001dd10: 745b 6c61 6e64 7361 7443 6f6c 6c65 6374  t[landsatCollect
+0001dd20: 696f 6e56 6572 7369 6f6e 5d5b 2773 6861  ionVersion]['sha
+0001dd30: 646f 7727 5d2c 6c61 6e64 7361 7446 6d61  dow'],landsatFma
+0001dd40: 736b 4261 6e64 4e61 6d65 4469 6374 5b6c  skBandNameDict[l
+0001dd50: 616e 6473 6174 436f 6c6c 6563 7469 6f6e  andsatCollection
+0001dd60: 5665 7273 696f 6e5d 2929 0d0a 0d0a 0d0a  Version]))......
+0001dd70: 2020 6966 2061 7070 6c79 466d 6173 6b53    if applyFmaskS
+0001dd80: 6e6f 774d 6173 6b3a 0d0a 2020 2020 7072  nowMask:..    pr
+0001dd90: 696e 7428 2741 7070 6c79 696e 6720 466d  int('Applying Fm
+0001dda0: 6173 6b20 736e 6f77 206d 6173 6b27 290d  ask snow mask').
+0001ddb0: 0a20 2020 206c 7320 3d20 6c73 2e6d 6170  .    ls = ls.map
+0001ddc0: 286c 616d 6264 6120 696d 673a 2061 7070  (lambda img: app
+0001ddd0: 6c79 4269 744d 6173 6b28 696d 672c 666d  lyBitMask(img,fm
+0001dde0: 6173 6b42 6974 4469 6374 5b6c 616e 6473  askBitDict[lands
+0001ddf0: 6174 436f 6c6c 6563 7469 6f6e 5665 7273  atCollectionVers
+0001de00: 696f 6e5d 5b27 736e 6f77 275d 2c6c 616e  ion]['snow'],lan
+0001de10: 6473 6174 466d 6173 6b42 616e 644e 616d  dsatFmaskBandNam
+0001de20: 6544 6963 745b 6c61 6e64 7361 7443 6f6c  eDict[landsatCol
+0001de30: 6c65 6374 696f 6e56 6572 7369 6f6e 5d29  lectionVersion])
+0001de40: 290d 0a0d 0a0d 0a20 2023 2041 6464 2063  )......  # Add c
+0001de50: 6f6d 6d6f 6e20 696e 6469 6365 730d 0a20  ommon indices.. 
+0001de60: 206c 7320 3d20 6c73 2e6d 6170 2873 696d   ls = ls.map(sim
+0001de70: 706c 6541 6464 496e 6469 6365 7329 5c0d  pleAddIndices)\.
+0001de80: 0a20 2020 2020 2020 2020 202e 6d61 7028  .          .map(
+0001de90: 6765 7454 6173 7365 6c65 6443 6170 295c  getTasseledCap)\
+0001dea0: 0d0a 2020 2020 2020 2020 2020 2e6d 6170  ..          .map
+0001deb0: 2873 696d 706c 6541 6464 5443 416e 676c  (simpleAddTCAngl
+0001dec0: 6573 290d 0a0d 0a20 2023 2041 6464 2053  es)....  # Add S
+0001ded0: 656e 736f 7220 4261 6e64 0d0a 2020 6c73  ensor Band..  ls
+0001dee0: 203d 206c 732e 6d61 7028 6c61 6d62 6461   = ls.map(lambda
+0001def0: 2069 6d67 3a20 6164 6453 656e 736f 7242   img: addSensorB
+0001df00: 616e 6428 696d 672c 206c 616e 6473 6174  and(img, landsat
+0001df10: 436f 6c6c 6563 7469 6f6e 5665 7273 696f  CollectionVersio
+0001df20: 6e2b 275f 6c61 6e64 7361 7427 2c20 746f  n+'_landsat', to
+0001df30: 614f 7253 5229 290d 0a0d 0a20 2072 6574  aOrSR))....  ret
+0001df40: 7572 6e20 6c73 2e73 6574 2861 7267 7329  urn ls.set(args)
+0001df50: 0d0a 0d0a 2323 2323 2323 2323 2323 2323  ....############
+0001df60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001df70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001df80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001df90: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
+0001dfa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001dfb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001dfc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001dfd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001dfe0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001dff0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001e000: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
-0001e010: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001e020: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001e030: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001e040: 2323 2323 2323 2323 2323 230d 0a23 5772  ###########..#Wr
-0001e050: 6170 7065 7220 6675 6e63 7469 6f6e 2066  apper function f
-0001e060: 6f72 2067 6574 7469 6e67 2053 656e 7469  or getting Senti
-0001e070: 6e65 6c32 2069 6d61 6765 7279 0d0a 6465  nel2 imagery..de
-0001e080: 6620 6765 7450 726f 6365 7373 6564 5365  f getProcessedSe
-0001e090: 6e74 696e 656c 3253 6365 6e65 7328 5c0d  ntinel2Scenes(\.
-0001e0a0: 0a20 2073 7475 6479 4172 6561 2c0d 0a20  .  studyArea,.. 
-0001e0b0: 2073 7461 7274 5965 6172 2c0d 0a20 2065   startYear,..  e
-0001e0c0: 6e64 5965 6172 2c0d 0a20 2073 7461 7274  ndYear,..  start
-0001e0d0: 4a75 6c69 616e 2c0d 0a20 2065 6e64 4a75  Julian,..  endJu
-0001e0e0: 6c69 616e 2c0d 0a20 2061 7070 6c79 5141  lian,..  applyQA
-0001e0f0: 4261 6e64 203d 2046 616c 7365 2c0d 0a20  Band = False,.. 
-0001e100: 2061 7070 6c79 436c 6f75 6453 636f 7265   applyCloudScore
-0001e110: 203d 2046 616c 7365 2c0d 0a20 2061 7070   = False,..  app
-0001e120: 6c79 5368 6164 6f77 5368 6966 7420 3d20  lyShadowShift = 
-0001e130: 4661 6c73 652c 0d0a 2020 6170 706c 7954  False,..  applyT
-0001e140: 444f 4d20 3d20 5472 7565 2c0d 0a20 2063  DOM = True,..  c
-0001e150: 6c6f 7564 5363 6f72 6554 6872 6573 6820  loudScoreThresh 
-0001e160: 3d20 3230 2c0d 0a20 2070 6572 666f 726d  = 20,..  perform
-0001e170: 436c 6f75 6453 636f 7265 4f66 6673 6574  CloudScoreOffset
-0001e180: 203d 2054 7275 652c 0d0a 2020 636c 6f75   = True,..  clou
-0001e190: 6453 636f 7265 5063 746c 203d 2031 302c  dScorePctl = 10,
-0001e1a0: 0d0a 2020 636c 6f75 6448 6569 6768 7473  ..  cloudHeights
-0001e1b0: 203d 2065 652e 4c69 7374 2e73 6571 7565   = ee.List.seque
-0001e1c0: 6e63 6528 3530 302c 3130 3030 302c 3530  nce(500,10000,50
-0001e1d0: 3029 2c0d 0a20 207a 5363 6f72 6554 6872  0),..  zScoreThr
-0001e1e0: 6573 6820 3d20 2d31 2c0d 0a20 2073 6861  esh = -1,..  sha
-0001e1f0: 646f 7753 756d 5468 7265 7368 203d 2030  dowSumThresh = 0
-0001e200: 2e33 352c 0d0a 2020 636f 6e74 7261 6374  .35,..  contract
-0001e210: 5069 7865 6c73 203d 2031 2e35 2c0d 0a20  Pixels = 1.5,.. 
-0001e220: 2064 696c 6174 6550 6978 656c 7320 3d20   dilatePixels = 
-0001e230: 332e 352c 0d0a 2020 7368 6164 6f77 5375  3.5,..  shadowSu
-0001e240: 6d42 616e 6473 203d 205b 276e 6972 272c  mBands = ['nir',
-0001e250: 2773 7769 7231 275d 2c0d 0a20 2072 6573  'swir1'],..  res
-0001e260: 616d 706c 654d 6574 686f 6420 3d20 2761  ampleMethod = 'a
-0001e270: 6767 7265 6761 7465 272c 0d0a 2020 746f  ggregate',..  to
-0001e280: 614f 7253 5220 3d20 2754 4f41 272c 0d0a  aOrSR = 'TOA',..
-0001e290: 2020 636f 6e76 6572 7454 6f44 6169 6c79    convertToDaily
-0001e2a0: 4d6f 7361 6963 7320 3d20 5472 7565 2c0d  Mosaics = True,.
-0001e2b0: 0a20 2061 7070 6c79 436c 6f75 6450 726f  .  applyCloudPro
-0001e2c0: 6261 6269 6c69 7479 203d 2054 7275 652c  bability = True,
-0001e2d0: 0d0a 2020 7072 6543 6f6d 7075 7465 6443  ..  preComputedC
-0001e2e0: 6c6f 7564 5363 6f72 654f 6666 7365 7420  loudScoreOffset 
-0001e2f0: 3d20 4e6f 6e65 2c0d 0a20 2070 7265 436f  = None,..  preCo
-0001e300: 6d70 7574 6564 5444 4f4d 4952 4d65 616e  mputedTDOMIRMean
-0001e310: 203d 204e 6f6e 652c 0d0a 2020 7072 6543   = None,..  preC
-0001e320: 6f6d 7075 7465 6454 444f 4d49 5253 7464  omputedTDOMIRStd
-0001e330: 4465 7620 3d20 4e6f 6e65 2c0d 0a20 2063  Dev = None,..  c
-0001e340: 6c6f 7564 5072 6f62 5468 7265 7368 203d  loudProbThresh =
-0001e350: 2034 3029 3a0d 0a0d 0a20 206f 7269 6769   40):....  origi
-0001e360: 6e20 3d20 2753 656e 7469 6e65 6c32 270d  n = 'Sentinel2'.
-0001e370: 0a20 2074 6f61 4f72 5352 203d 2074 6f61  .  toaOrSR = toa
-0001e380: 4f72 5352 2e75 7070 6572 2829 0d0a 0d0a  OrSR.upper()....
-0001e390: 2020 2350 7265 7061 7265 2064 6174 6573    #Prepare dates
-0001e3a0: 0d0a 2020 2357 7261 7020 7468 6520 6461  ..  #Wrap the da
-0001e3b0: 7465 7320 6966 206e 6565 6465 640d 0a20  tes if needed.. 
-0001e3c0: 2077 7261 704f 6666 7365 7420 3d20 300d   wrapOffset = 0.
-0001e3d0: 0a20 2069 6620 7374 6172 744a 756c 6961  .  if startJulia
-0001e3e0: 6e20 3e20 656e 644a 756c 6961 6e3a 0d0a  n > endJulian:..
-0001e3f0: 2020 2020 7772 6170 4f66 6673 6574 203d      wrapOffset =
-0001e400: 2033 3635 0d0a 2020 7374 6172 7444 6174   365..  startDat
-0001e410: 6520 3d20 6565 2e44 6174 652e 6672 6f6d  e = ee.Date.from
-0001e420: 594d 4428 7374 6172 7459 6561 722c 312c  YMD(startYear,1,
-0001e430: 3129 2e61 6476 616e 6365 2873 7461 7274  1).advance(start
-0001e440: 4a75 6c69 616e 2d31 2c27 6461 7927 290d  Julian-1,'day').
-0001e450: 0a20 2065 6e64 4461 7465 203d 2065 652e  .  endDate = ee.
-0001e460: 4461 7465 2e66 726f 6d59 4d44 2865 6e64  Date.fromYMD(end
-0001e470: 5965 6172 2c31 2c31 292e 6164 7661 6e63  Year,1,1).advanc
-0001e480: 6528 656e 644a 756c 6961 6e2d 312b 7772  e(endJulian-1+wr
-0001e490: 6170 4f66 6673 6574 2c27 6461 7927 290d  apOffset,'day').
-0001e4a0: 0a0d 0a20 2061 7267 7320 3d20 666f 726d  ...  args = form
-0001e4b0: 6174 4172 6773 286c 6f63 616c 7328 2929  atArgs(locals())
-0001e4c0: 0d0a 2020 6966 2027 6172 6773 2720 696e  ..  if 'args' in
-0001e4d0: 2061 7267 732e 6b65 7973 2829 3a0d 0a20   args.keys():.. 
-0001e4e0: 2020 2064 656c 2061 7267 735b 2761 7267     del args['arg
-0001e4f0: 7327 5d0d 0a0d 0a20 2070 7269 6e74 2827  s']....  print('
-0001e500: 4765 7420 5072 6f63 6573 7365 6420 5365  Get Processed Se
-0001e510: 6e74 696e 656c 323a 2027 290d 0a20 2070  ntinel2: ')..  p
-0001e520: 7269 6e74 2827 5374 6172 7420 6461 7465  rint('Start date
-0001e530: 3a27 2c20 7374 6172 7444 6174 652e 666f  :', startDate.fo
-0001e540: 726d 6174 2827 4d4d 4d20 6464 2079 7979  rmat('MMM dd yyy
-0001e550: 7927 292e 6765 7449 6e66 6f28 292c 272c  y').getInfo(),',
-0001e560: 2045 6e64 2064 6174 653a 272c 2065 6e64   End date:', end
-0001e570: 4461 7465 2e66 6f72 6d61 7428 274d 4d4d  Date.format('MMM
-0001e580: 2064 6420 7979 7979 2729 2e67 6574 496e   dd yyyy').getIn
-0001e590: 666f 2829 290d 0a20 2066 6f72 2061 7267  fo())..  for arg
-0001e5a0: 2069 6e20 6172 6773 2e6b 6579 7328 293a   in args.keys():
-0001e5b0: 0d0a 2020 2020 7072 696e 7428 6172 672c  ..    print(arg,
-0001e5c0: 2027 3a20 272c 2061 7267 735b 6172 675d   ': ', args[arg]
-0001e5d0: 290d 0a0d 0a20 2023 4765 7420 5365 6e74  )....  #Get Sent
-0001e5e0: 696e 656c 3220 696d 6167 6520 636f 6c6c  inel2 image coll
-0001e5f0: 6563 7469 6f6e 0d0a 2020 7332 7320 3d20  ection..  s2s = 
-0001e600: 6765 7453 3228 5c0d 0a20 2020 2073 7475  getS2(\..    stu
-0001e610: 6479 4172 6561 203d 2073 7475 6479 4172  dyArea = studyAr
-0001e620: 6561 2c0d 0a20 2020 2073 7461 7274 4461  ea,..    startDa
-0001e630: 7465 203d 2073 7461 7274 4461 7465 2c0d  te = startDate,.
-0001e640: 0a20 2020 2065 6e64 4461 7465 203d 2065  .    endDate = e
-0001e650: 6e64 4461 7465 2c0d 0a20 2020 2073 7461  ndDate,..    sta
-0001e660: 7274 4a75 6c69 616e 203d 2073 7461 7274  rtJulian = start
-0001e670: 4a75 6c69 616e 2c0d 0a20 2020 2065 6e64  Julian,..    end
-0001e680: 4a75 6c69 616e 203d 2065 6e64 4a75 6c69  Julian = endJuli
-0001e690: 616e 2c0d 0a20 2020 2072 6573 616d 706c  an,..    resampl
-0001e6a0: 654d 6574 686f 6420 3d20 7265 7361 6d70  eMethod = resamp
-0001e6b0: 6c65 4d65 7468 6f64 2c0d 0a20 2020 2074  leMethod,..    t
-0001e6c0: 6f61 4f72 5352 203d 2074 6f61 4f72 5352  oaOrSR = toaOrSR
-0001e6d0: 2c0d 0a20 2020 2063 6f6e 7665 7274 546f  ,..    convertTo
-0001e6e0: 4461 696c 794d 6f73 6169 6373 203d 2063  DailyMosaics = c
-0001e6f0: 6f6e 7665 7274 546f 4461 696c 794d 6f73  onvertToDailyMos
-0001e700: 6169 6373 2c0d 0a20 2020 2061 6464 436c  aics,..    addCl
-0001e710: 6f75 6450 726f 6261 6269 6c69 7479 203d  oudProbability =
-0001e720: 2061 7070 6c79 436c 6f75 6450 726f 6261   applyCloudProba
-0001e730: 6269 6c69 7479 290d 0a0d 0a20 2069 6620  bility)....  if 
-0001e740: 6170 706c 7951 4142 616e 643a 0d0a 2020  applyQABand:..  
-0001e750: 2020 7072 696e 7428 2741 7070 6c79 696e    print('Applyin
-0001e760: 6720 5141 2042 616e 6420 436c 6f75 6420  g QA Band Cloud 
-0001e770: 4d61 736b 2729 0d0a 2020 2020 7332 7320  Mask')..    s2s 
-0001e780: 3d20 7332 732e 6d61 7028 6d61 736b 5332  = s2s.map(maskS2
-0001e790: 636c 6f75 6473 290d 0a0d 0a20 2069 6620  clouds)....  if 
-0001e7a0: 6170 706c 7943 6c6f 7564 5363 6f72 653a  applyCloudScore:
-0001e7b0: 0d0a 2020 2020 7072 696e 7428 2741 7070  ..    print('App
-0001e7c0: 6c79 696e 6720 436c 6f75 6420 5363 6f72  lying Cloud Scor
-0001e7d0: 6527 290d 0a20 2020 2073 3273 203d 2061  e')..    s2s = a
-0001e7e0: 7070 6c79 436c 6f75 6453 636f 7265 416c  pplyCloudScoreAl
-0001e7f0: 676f 7269 7468 6d28 5c0d 0a20 2020 2020  gorithm(\..     
-0001e800: 2063 6f6c 6c65 6374 696f 6e20 3d20 7332   collection = s2
-0001e810: 732c 0d0a 2020 2020 2020 636c 6f75 6453  s,..      cloudS
-0001e820: 636f 7265 4675 6e63 7469 6f6e 203d 2073  coreFunction = s
-0001e830: 656e 7469 6e65 6c32 436c 6f75 6453 636f  entinel2CloudSco
-0001e840: 7265 2c0d 0a20 2020 2020 2063 6c6f 7564  re,..      cloud
-0001e850: 5363 6f72 6554 6872 6573 6820 3d20 636c  ScoreThresh = cl
-0001e860: 6f75 6453 636f 7265 5468 7265 7368 2c0d  oudScoreThresh,.
-0001e870: 0a20 2020 2020 2063 6c6f 7564 5363 6f72  .      cloudScor
-0001e880: 6550 6374 6c20 3d20 636c 6f75 6453 636f  ePctl = cloudSco
-0001e890: 7265 5063 746c 2c0d 0a20 2020 2020 2063  rePctl,..      c
-0001e8a0: 6f6e 7472 6163 7450 6978 656c 7320 3d20  ontractPixels = 
-0001e8b0: 636f 6e74 7261 6374 5069 7865 6c73 2c0d  contractPixels,.
-0001e8c0: 0a20 2020 2020 2064 696c 6174 6550 6978  .      dilatePix
-0001e8d0: 656c 7320 3d20 6469 6c61 7465 5069 7865  els = dilatePixe
-0001e8e0: 6c73 2c0d 0a20 2020 2020 2070 6572 666f  ls,..      perfo
-0001e8f0: 726d 436c 6f75 6453 636f 7265 4f66 6673  rmCloudScoreOffs
-0001e900: 6574 203d 2070 6572 666f 726d 436c 6f75  et = performClou
-0001e910: 6453 636f 7265 4f66 6673 6574 2c0d 0a20  dScoreOffset,.. 
-0001e920: 2020 2020 2070 7265 436f 6d70 7574 6564       preComputed
-0001e930: 436c 6f75 6453 636f 7265 4f66 6673 6574  CloudScoreOffset
-0001e940: 203d 2070 7265 436f 6d70 7574 6564 436c   = preComputedCl
-0001e950: 6f75 6453 636f 7265 4f66 6673 6574 290d  oudScoreOffset).
-0001e960: 0a0d 0a20 2069 6620 6170 706c 7943 6c6f  ...  if applyClo
-0001e970: 7564 5072 6f62 6162 696c 6974 793a 0d0a  udProbability:..
-0001e980: 2020 2020 7072 696e 7428 2741 7070 6c79      print('Apply
-0001e990: 2043 6c6f 7564 2050 726f 6261 6269 6c69   Cloud Probabili
-0001e9a0: 7479 2729 0d0a 2020 2020 7332 7320 3d20  ty')..    s2s = 
-0001e9b0: 7332 732e 6d61 7028 6c61 6d62 6461 2069  s2s.map(lambda i
-0001e9c0: 6d67 3a20 696d 672e 7570 6461 7465 4d61  mg: img.updateMa
-0001e9d0: 736b 2869 6d67 2e73 656c 6563 7428 5b27  sk(img.select(['
-0001e9e0: 636c 6f75 645f 7072 6f62 6162 696c 6974  cloud_probabilit
-0001e9f0: 7927 5d29 2e6c 7465 2863 6c6f 7564 5072  y']).lte(cloudPr
-0001ea00: 6f62 5468 7265 7368 2929 290d 0a0d 0a20  obThresh))).... 
-0001ea10: 2069 6620 6170 706c 7953 6861 646f 7753   if applyShadowS
-0001ea20: 6869 6674 3a0d 0a20 2020 2070 7269 6e74  hift:..    print
-0001ea30: 2827 4170 706c 7969 6e67 2053 6861 646f  ('Applying Shado
-0001ea40: 7720 5368 6966 7427 290d 0a20 2020 2073  w Shift')..    s
-0001ea50: 3273 203d 2073 3273 2e6d 6170 286c 616d  2s = s2s.map(lam
-0001ea60: 6264 6120 696d 673a 2070 726f 6a65 6374  bda img: project
-0001ea70: 5368 6164 6f77 7357 7261 7070 6572 285c  ShadowsWrapper(\
-0001ea80: 0d0a 2020 2020 2020 696d 6720 3d20 696d  ..      img = im
-0001ea90: 672c 0d0a 2020 2020 2020 636c 6f75 6454  g,..      cloudT
-0001eaa0: 6872 6573 6820 3d20 636c 6f75 6453 636f  hresh = cloudSco
-0001eab0: 7265 5468 7265 7368 2c0d 0a20 2020 2020  reThresh,..     
-0001eac0: 2069 7253 756d 5468 7265 7368 203d 2073   irSumThresh = s
-0001ead0: 6861 646f 7753 756d 5468 7265 7368 2c0d  hadowSumThresh,.
-0001eae0: 0a20 2020 2020 2063 6f6e 7472 6163 7450  .      contractP
-0001eaf0: 6978 656c 7320 3d20 636f 6e74 7261 6374  ixels = contract
-0001eb00: 5069 7865 6c73 2c0d 0a20 2020 2020 2064  Pixels,..      d
-0001eb10: 696c 6174 6550 6978 656c 7320 3d20 6469  ilatePixels = di
-0001eb20: 6c61 7465 5069 7865 6c73 2c0d 0a20 2020  latePixels,..   
-0001eb30: 2020 2063 6c6f 7564 4865 6967 6874 7320     cloudHeights 
-0001eb40: 3d20 636c 6f75 6448 6569 6768 7473 2929  = cloudHeights))
-0001eb50: 0d0a 0d0a 2020 6966 2061 7070 6c79 5444  ....  if applyTD
-0001eb60: 4f4d 3a0d 0a20 2020 2070 7269 6e74 2827  OM:..    print('
-0001eb70: 4170 706c 7969 6e67 2054 444f 4d27 290d  Applying TDOM').
-0001eb80: 0a20 2020 2073 3273 203d 2073 696d 706c  .    s2s = simpl
-0001eb90: 6554 444f 4d32 285c 0d0a 2020 2020 2020  eTDOM2(\..      
-0001eba0: 636f 6c6c 6563 7469 6f6e 203d 2073 3273  collection = s2s
-0001ebb0: 2c0d 0a20 2020 2020 207a 5363 6f72 6554  ,..      zScoreT
-0001ebc0: 6872 6573 6820 3d20 7a53 636f 7265 5468  hresh = zScoreTh
-0001ebd0: 7265 7368 2c0d 0a20 2020 2020 2073 6861  resh,..      sha
-0001ebe0: 646f 7753 756d 5468 7265 7368 203d 2073  dowSumThresh = s
-0001ebf0: 6861 646f 7753 756d 5468 7265 7368 2c0d  hadowSumThresh,.
-0001ec00: 0a20 2020 2020 2063 6f6e 7472 6163 7450  .      contractP
-0001ec10: 6978 656c 7320 3d20 636f 6e74 7261 6374  ixels = contract
-0001ec20: 5069 7865 6c73 2c0d 0a20 2020 2020 2064  Pixels,..      d
-0001ec30: 696c 6174 6550 6978 656c 7320 3d20 6469  ilatePixels = di
-0001ec40: 6c61 7465 5069 7865 6c73 2c0d 0a20 2020  latePixels,..   
-0001ec50: 2020 2073 6861 646f 7753 756d 4261 6e64     shadowSumBand
-0001ec60: 7320 3d20 5b27 6e69 7227 2c27 7377 6972  s = ['nir','swir
-0001ec70: 3127 5d2c 0d0a 2020 2020 2020 7072 6543  1'],..      preC
-0001ec80: 6f6d 7075 7465 6454 444f 4d49 524d 6561  omputedTDOMIRMea
-0001ec90: 6e20 3d20 7072 6543 6f6d 7075 7465 6454  n = preComputedT
-0001eca0: 444f 4d49 524d 6561 6e2c 0d0a 2020 2020  DOMIRMean,..    
-0001ecb0: 2020 7072 6543 6f6d 7075 7465 6454 444f    preComputedTDO
-0001ecc0: 4d49 5253 7464 4465 7620 3d20 7072 6543  MIRStdDev = preC
-0001ecd0: 6f6d 7075 7465 6454 444f 4d49 5253 7464  omputedTDOMIRStd
-0001ece0: 4465 7629 0d0a 0d0a 2020 2320 4164 6420  Dev)....  # Add 
-0001ecf0: 636f 6d6d 6f6e 2069 6e64 6963 6573 0d0a  common indices..
-0001ed00: 2020 7332 7320 3d20 7332 732e 6d61 7028    s2s = s2s.map(
-0001ed10: 7369 6d70 6c65 4164 6449 6e64 6963 6573  simpleAddIndices
-0001ed20: 295c 0d0a 2020 2020 2020 2020 2020 202e  )\..           .
-0001ed30: 6d61 7028 6765 7454 6173 7365 6c65 6443  map(getTasseledC
-0001ed40: 6170 295c 0d0a 2020 2020 2020 2020 2020  ap)\..          
-0001ed50: 202e 6d61 7028 7369 6d70 6c65 4164 6454   .map(simpleAddT
-0001ed60: 4341 6e67 6c65 7329 5c0d 0a20 2020 2020  CAngles)\..     
-0001ed70: 2020 2020 2020 2e6d 6170 286c 616d 6264        .map(lambd
-0001ed80: 6120 696d 673a 2069 6d67 2e61 6464 4261  a img: img.addBa
-0001ed90: 6e64 7328 696d 672e 6e6f 726d 616c 697a  nds(img.normaliz
-0001eda0: 6564 4469 6666 6572 656e 6365 285b 2772  edDifference(['r
-0001edb0: 6531 272c 2027 7265 6427 5d29 2e73 656c  e1', 'red']).sel
-0001edc0: 6563 7428 5b30 5d2c 5b27 4e44 4349 275d  ect([0],['NDCI']
-0001edd0: 2929 290d 0a20 2023 2041 6464 2053 656e  )))..  # Add Sen
-0001ede0: 736f 7220 4261 6e64 0d0a 2020 7332 7320  sor Band..  s2s 
-0001edf0: 3d20 7332 732e 6d61 7028 6c61 6d62 6461  = s2s.map(lambda
-0001ee00: 2069 6d67 3a20 6164 6453 656e 736f 7242   img: addSensorB
-0001ee10: 616e 6428 696d 672c 2027 7365 6e74 696e  and(img, 'sentin
-0001ee20: 656c 3227 2c20 746f 614f 7253 5229 290d  el2', toaOrSR)).
-0001ee30: 0a0d 0a20 0d0a 2020 7265 7475 726e 2073  ... ..  return s
-0001ee40: 3273 2e73 6574 2861 7267 7329 0d0a 0d0a  2s.set(args)....
-0001ee50: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
+0001dfe0: 2323 2323 2323 2323 0d0a 2357 7261 7070  ########..#Wrapp
+0001dff0: 6572 2066 756e 6374 696f 6e20 666f 7220  er function for 
+0001e000: 6765 7474 696e 6720 5365 6e74 696e 656c  getting Sentinel
+0001e010: 3220 696d 6167 6572 790d 0a64 6566 2067  2 imagery..def g
+0001e020: 6574 5072 6f63 6573 7365 6453 656e 7469  etProcessedSenti
+0001e030: 6e65 6c32 5363 656e 6573 285c 0d0a 2020  nel2Scenes(\..  
+0001e040: 7374 7564 7941 7265 612c 0d0a 2020 7374  studyArea,..  st
+0001e050: 6172 7459 6561 722c 0d0a 2020 656e 6459  artYear,..  endY
+0001e060: 6561 722c 0d0a 2020 7374 6172 744a 756c  ear,..  startJul
+0001e070: 6961 6e2c 0d0a 2020 656e 644a 756c 6961  ian,..  endJulia
+0001e080: 6e2c 0d0a 2020 6170 706c 7951 4142 616e  n,..  applyQABan
+0001e090: 6420 3d20 4661 6c73 652c 0d0a 2020 6170  d = False,..  ap
+0001e0a0: 706c 7943 6c6f 7564 5363 6f72 6520 3d20  plyCloudScore = 
+0001e0b0: 4661 6c73 652c 0d0a 2020 6170 706c 7953  False,..  applyS
+0001e0c0: 6861 646f 7753 6869 6674 203d 2046 616c  hadowShift = Fal
+0001e0d0: 7365 2c0d 0a20 2061 7070 6c79 5444 4f4d  se,..  applyTDOM
+0001e0e0: 203d 2054 7275 652c 0d0a 2020 636c 6f75   = True,..  clou
+0001e0f0: 6453 636f 7265 5468 7265 7368 203d 2032  dScoreThresh = 2
+0001e100: 302c 0d0a 2020 7065 7266 6f72 6d43 6c6f  0,..  performClo
+0001e110: 7564 5363 6f72 654f 6666 7365 7420 3d20  udScoreOffset = 
+0001e120: 5472 7565 2c0d 0a20 2063 6c6f 7564 5363  True,..  cloudSc
+0001e130: 6f72 6550 6374 6c20 3d20 3130 2c0d 0a20  orePctl = 10,.. 
+0001e140: 2063 6c6f 7564 4865 6967 6874 7320 3d20   cloudHeights = 
+0001e150: 6565 2e4c 6973 742e 7365 7175 656e 6365  ee.List.sequence
+0001e160: 2835 3030 2c31 3030 3030 2c35 3030 292c  (500,10000,500),
+0001e170: 0d0a 2020 7a53 636f 7265 5468 7265 7368  ..  zScoreThresh
+0001e180: 203d 202d 312c 0d0a 2020 7368 6164 6f77   = -1,..  shadow
+0001e190: 5375 6d54 6872 6573 6820 3d20 302e 3335  SumThresh = 0.35
+0001e1a0: 2c0d 0a20 2063 6f6e 7472 6163 7450 6978  ,..  contractPix
+0001e1b0: 656c 7320 3d20 312e 352c 0d0a 2020 6469  els = 1.5,..  di
+0001e1c0: 6c61 7465 5069 7865 6c73 203d 2033 2e35  latePixels = 3.5
+0001e1d0: 2c0d 0a20 2073 6861 646f 7753 756d 4261  ,..  shadowSumBa
+0001e1e0: 6e64 7320 3d20 5b27 6e69 7227 2c27 7377  nds = ['nir','sw
+0001e1f0: 6972 3127 5d2c 0d0a 2020 7265 7361 6d70  ir1'],..  resamp
+0001e200: 6c65 4d65 7468 6f64 203d 2027 6167 6772  leMethod = 'aggr
+0001e210: 6567 6174 6527 2c0d 0a20 2074 6f61 4f72  egate',..  toaOr
+0001e220: 5352 203d 2027 544f 4127 2c0d 0a20 2063  SR = 'TOA',..  c
+0001e230: 6f6e 7665 7274 546f 4461 696c 794d 6f73  onvertToDailyMos
+0001e240: 6169 6373 203d 2054 7275 652c 0d0a 2020  aics = True,..  
+0001e250: 6170 706c 7943 6c6f 7564 5072 6f62 6162  applyCloudProbab
+0001e260: 696c 6974 7920 3d20 5472 7565 2c0d 0a20  ility = True,.. 
+0001e270: 2070 7265 436f 6d70 7574 6564 436c 6f75   preComputedClou
+0001e280: 6453 636f 7265 4f66 6673 6574 203d 204e  dScoreOffset = N
+0001e290: 6f6e 652c 0d0a 2020 7072 6543 6f6d 7075  one,..  preCompu
+0001e2a0: 7465 6454 444f 4d49 524d 6561 6e20 3d20  tedTDOMIRMean = 
+0001e2b0: 4e6f 6e65 2c0d 0a20 2070 7265 436f 6d70  None,..  preComp
+0001e2c0: 7574 6564 5444 4f4d 4952 5374 6444 6576  utedTDOMIRStdDev
+0001e2d0: 203d 204e 6f6e 652c 0d0a 2020 636c 6f75   = None,..  clou
+0001e2e0: 6450 726f 6254 6872 6573 6820 3d20 3430  dProbThresh = 40
+0001e2f0: 293a 0d0a 0d0a 2020 6f72 6967 696e 203d  ):....  origin =
+0001e300: 2027 5365 6e74 696e 656c 3227 0d0a 2020   'Sentinel2'..  
+0001e310: 746f 614f 7253 5220 3d20 746f 614f 7253  toaOrSR = toaOrS
+0001e320: 522e 7570 7065 7228 290d 0a0d 0a20 2023  R.upper()....  #
+0001e330: 5072 6570 6172 6520 6461 7465 730d 0a20  Prepare dates.. 
+0001e340: 2023 5772 6170 2074 6865 2064 6174 6573   #Wrap the dates
+0001e350: 2069 6620 6e65 6564 6564 0d0a 2020 7772   if needed..  wr
+0001e360: 6170 4f66 6673 6574 203d 2030 0d0a 2020  apOffset = 0..  
+0001e370: 6966 2073 7461 7274 4a75 6c69 616e 203e  if startJulian >
+0001e380: 2065 6e64 4a75 6c69 616e 3a0d 0a20 2020   endJulian:..   
+0001e390: 2077 7261 704f 6666 7365 7420 3d20 3336   wrapOffset = 36
+0001e3a0: 350d 0a20 2073 7461 7274 4461 7465 203d  5..  startDate =
+0001e3b0: 2065 652e 4461 7465 2e66 726f 6d59 4d44   ee.Date.fromYMD
+0001e3c0: 2873 7461 7274 5965 6172 2c31 2c31 292e  (startYear,1,1).
+0001e3d0: 6164 7661 6e63 6528 7374 6172 744a 756c  advance(startJul
+0001e3e0: 6961 6e2d 312c 2764 6179 2729 0d0a 2020  ian-1,'day')..  
+0001e3f0: 656e 6444 6174 6520 3d20 6565 2e44 6174  endDate = ee.Dat
+0001e400: 652e 6672 6f6d 594d 4428 656e 6459 6561  e.fromYMD(endYea
+0001e410: 722c 312c 3129 2e61 6476 616e 6365 2865  r,1,1).advance(e
+0001e420: 6e64 4a75 6c69 616e 2d31 2b77 7261 704f  ndJulian-1+wrapO
+0001e430: 6666 7365 742c 2764 6179 2729 0d0a 0d0a  ffset,'day')....
+0001e440: 2020 6172 6773 203d 2066 6f72 6d61 7441    args = formatA
+0001e450: 7267 7328 6c6f 6361 6c73 2829 290d 0a20  rgs(locals()).. 
+0001e460: 2069 6620 2761 7267 7327 2069 6e20 6172   if 'args' in ar
+0001e470: 6773 2e6b 6579 7328 293a 0d0a 2020 2020  gs.keys():..    
+0001e480: 6465 6c20 6172 6773 5b27 6172 6773 275d  del args['args']
+0001e490: 0d0a 0d0a 2020 7072 696e 7428 2747 6574  ....  print('Get
+0001e4a0: 2050 726f 6365 7373 6564 2053 656e 7469   Processed Senti
+0001e4b0: 6e65 6c32 3a20 2729 0d0a 2020 7072 696e  nel2: ')..  prin
+0001e4c0: 7428 2753 7461 7274 2064 6174 653a 272c  t('Start date:',
+0001e4d0: 2073 7461 7274 4461 7465 2e66 6f72 6d61   startDate.forma
+0001e4e0: 7428 274d 4d4d 2064 6420 7979 7979 2729  t('MMM dd yyyy')
+0001e4f0: 2e67 6574 496e 666f 2829 2c27 2c20 456e  .getInfo(),', En
+0001e500: 6420 6461 7465 3a27 2c20 656e 6444 6174  d date:', endDat
+0001e510: 652e 666f 726d 6174 2827 4d4d 4d20 6464  e.format('MMM dd
+0001e520: 2079 7979 7927 292e 6765 7449 6e66 6f28   yyyy').getInfo(
+0001e530: 2929 0d0a 2020 666f 7220 6172 6720 696e  ))..  for arg in
+0001e540: 2061 7267 732e 6b65 7973 2829 3a0d 0a20   args.keys():.. 
+0001e550: 2020 2070 7269 6e74 2861 7267 2c20 273a     print(arg, ':
+0001e560: 2027 2c20 6172 6773 5b61 7267 5d29 0d0a   ', args[arg])..
+0001e570: 0d0a 2020 2347 6574 2053 656e 7469 6e65  ..  #Get Sentine
+0001e580: 6c32 2069 6d61 6765 2063 6f6c 6c65 6374  l2 image collect
+0001e590: 696f 6e0d 0a20 2073 3273 203d 2067 6574  ion..  s2s = get
+0001e5a0: 5332 285c 0d0a 2020 2020 7374 7564 7941  S2(\..    studyA
+0001e5b0: 7265 6120 3d20 7374 7564 7941 7265 612c  rea = studyArea,
+0001e5c0: 0d0a 2020 2020 7374 6172 7444 6174 6520  ..    startDate 
+0001e5d0: 3d20 7374 6172 7444 6174 652c 0d0a 2020  = startDate,..  
+0001e5e0: 2020 656e 6444 6174 6520 3d20 656e 6444    endDate = endD
+0001e5f0: 6174 652c 0d0a 2020 2020 7374 6172 744a  ate,..    startJ
+0001e600: 756c 6961 6e20 3d20 7374 6172 744a 756c  ulian = startJul
+0001e610: 6961 6e2c 0d0a 2020 2020 656e 644a 756c  ian,..    endJul
+0001e620: 6961 6e20 3d20 656e 644a 756c 6961 6e2c  ian = endJulian,
+0001e630: 0d0a 2020 2020 7265 7361 6d70 6c65 4d65  ..    resampleMe
+0001e640: 7468 6f64 203d 2072 6573 616d 706c 654d  thod = resampleM
+0001e650: 6574 686f 642c 0d0a 2020 2020 746f 614f  ethod,..    toaO
+0001e660: 7253 5220 3d20 746f 614f 7253 522c 0d0a  rSR = toaOrSR,..
+0001e670: 2020 2020 636f 6e76 6572 7454 6f44 6169      convertToDai
+0001e680: 6c79 4d6f 7361 6963 7320 3d20 636f 6e76  lyMosaics = conv
+0001e690: 6572 7454 6f44 6169 6c79 4d6f 7361 6963  ertToDailyMosaic
+0001e6a0: 732c 0d0a 2020 2020 6164 6443 6c6f 7564  s,..    addCloud
+0001e6b0: 5072 6f62 6162 696c 6974 7920 3d20 6170  Probability = ap
+0001e6c0: 706c 7943 6c6f 7564 5072 6f62 6162 696c  plyCloudProbabil
+0001e6d0: 6974 7929 0d0a 0d0a 2020 6966 2061 7070  ity)....  if app
+0001e6e0: 6c79 5141 4261 6e64 3a0d 0a20 2020 2070  lyQABand:..    p
+0001e6f0: 7269 6e74 2827 4170 706c 7969 6e67 2051  rint('Applying Q
+0001e700: 4120 4261 6e64 2043 6c6f 7564 204d 6173  A Band Cloud Mas
+0001e710: 6b27 290d 0a20 2020 2073 3273 203d 2073  k')..    s2s = s
+0001e720: 3273 2e6d 6170 286d 6173 6b53 3263 6c6f  2s.map(maskS2clo
+0001e730: 7564 7329 0d0a 0d0a 2020 6966 2061 7070  uds)....  if app
+0001e740: 6c79 436c 6f75 6453 636f 7265 3a0d 0a20  lyCloudScore:.. 
+0001e750: 2020 2070 7269 6e74 2827 4170 706c 7969     print('Applyi
+0001e760: 6e67 2043 6c6f 7564 2053 636f 7265 2729  ng Cloud Score')
+0001e770: 0d0a 2020 2020 7332 7320 3d20 6170 706c  ..    s2s = appl
+0001e780: 7943 6c6f 7564 5363 6f72 6541 6c67 6f72  yCloudScoreAlgor
+0001e790: 6974 686d 285c 0d0a 2020 2020 2020 636f  ithm(\..      co
+0001e7a0: 6c6c 6563 7469 6f6e 203d 2073 3273 2c0d  llection = s2s,.
+0001e7b0: 0a20 2020 2020 2063 6c6f 7564 5363 6f72  .      cloudScor
+0001e7c0: 6546 756e 6374 696f 6e20 3d20 7365 6e74  eFunction = sent
+0001e7d0: 696e 656c 3243 6c6f 7564 5363 6f72 652c  inel2CloudScore,
+0001e7e0: 0d0a 2020 2020 2020 636c 6f75 6453 636f  ..      cloudSco
+0001e7f0: 7265 5468 7265 7368 203d 2063 6c6f 7564  reThresh = cloud
+0001e800: 5363 6f72 6554 6872 6573 682c 0d0a 2020  ScoreThresh,..  
+0001e810: 2020 2020 636c 6f75 6453 636f 7265 5063      cloudScorePc
+0001e820: 746c 203d 2063 6c6f 7564 5363 6f72 6550  tl = cloudScoreP
+0001e830: 6374 6c2c 0d0a 2020 2020 2020 636f 6e74  ctl,..      cont
+0001e840: 7261 6374 5069 7865 6c73 203d 2063 6f6e  ractPixels = con
+0001e850: 7472 6163 7450 6978 656c 732c 0d0a 2020  tractPixels,..  
+0001e860: 2020 2020 6469 6c61 7465 5069 7865 6c73      dilatePixels
+0001e870: 203d 2064 696c 6174 6550 6978 656c 732c   = dilatePixels,
+0001e880: 0d0a 2020 2020 2020 7065 7266 6f72 6d43  ..      performC
+0001e890: 6c6f 7564 5363 6f72 654f 6666 7365 7420  loudScoreOffset 
+0001e8a0: 3d20 7065 7266 6f72 6d43 6c6f 7564 5363  = performCloudSc
+0001e8b0: 6f72 654f 6666 7365 742c 0d0a 2020 2020  oreOffset,..    
+0001e8c0: 2020 7072 6543 6f6d 7075 7465 6443 6c6f    preComputedClo
+0001e8d0: 7564 5363 6f72 654f 6666 7365 7420 3d20  udScoreOffset = 
+0001e8e0: 7072 6543 6f6d 7075 7465 6443 6c6f 7564  preComputedCloud
+0001e8f0: 5363 6f72 654f 6666 7365 7429 0d0a 0d0a  ScoreOffset)....
+0001e900: 2020 6966 2061 7070 6c79 436c 6f75 6450    if applyCloudP
+0001e910: 726f 6261 6269 6c69 7479 3a0d 0a20 2020  robability:..   
+0001e920: 2070 7269 6e74 2827 4170 706c 7920 436c   print('Apply Cl
+0001e930: 6f75 6420 5072 6f62 6162 696c 6974 7927  oud Probability'
+0001e940: 290d 0a20 2020 2073 3273 203d 2073 3273  )..    s2s = s2s
+0001e950: 2e6d 6170 286c 616d 6264 6120 696d 673a  .map(lambda img:
+0001e960: 2069 6d67 2e75 7064 6174 654d 6173 6b28   img.updateMask(
+0001e970: 696d 672e 7365 6c65 6374 285b 2763 6c6f  img.select(['clo
+0001e980: 7564 5f70 726f 6261 6269 6c69 7479 275d  ud_probability']
+0001e990: 292e 6c74 6528 636c 6f75 6450 726f 6254  ).lte(cloudProbT
+0001e9a0: 6872 6573 6829 2929 0d0a 0d0a 2020 6966  hresh)))....  if
+0001e9b0: 2061 7070 6c79 5368 6164 6f77 5368 6966   applyShadowShif
+0001e9c0: 743a 0d0a 2020 2020 7072 696e 7428 2741  t:..    print('A
+0001e9d0: 7070 6c79 696e 6720 5368 6164 6f77 2053  pplying Shadow S
+0001e9e0: 6869 6674 2729 0d0a 2020 2020 7332 7320  hift')..    s2s 
+0001e9f0: 3d20 7332 732e 6d61 7028 6c61 6d62 6461  = s2s.map(lambda
+0001ea00: 2069 6d67 3a20 7072 6f6a 6563 7453 6861   img: projectSha
+0001ea10: 646f 7773 5772 6170 7065 7228 5c0d 0a20  dowsWrapper(\.. 
+0001ea20: 2020 2020 2069 6d67 203d 2069 6d67 2c0d       img = img,.
+0001ea30: 0a20 2020 2020 2063 6c6f 7564 5468 7265  .      cloudThre
+0001ea40: 7368 203d 2063 6c6f 7564 5363 6f72 6554  sh = cloudScoreT
+0001ea50: 6872 6573 682c 0d0a 2020 2020 2020 6972  hresh,..      ir
+0001ea60: 5375 6d54 6872 6573 6820 3d20 7368 6164  SumThresh = shad
+0001ea70: 6f77 5375 6d54 6872 6573 682c 0d0a 2020  owSumThresh,..  
+0001ea80: 2020 2020 636f 6e74 7261 6374 5069 7865      contractPixe
+0001ea90: 6c73 203d 2063 6f6e 7472 6163 7450 6978  ls = contractPix
+0001eaa0: 656c 732c 0d0a 2020 2020 2020 6469 6c61  els,..      dila
+0001eab0: 7465 5069 7865 6c73 203d 2064 696c 6174  tePixels = dilat
+0001eac0: 6550 6978 656c 732c 0d0a 2020 2020 2020  ePixels,..      
+0001ead0: 636c 6f75 6448 6569 6768 7473 203d 2063  cloudHeights = c
+0001eae0: 6c6f 7564 4865 6967 6874 7329 290d 0a0d  loudHeights))...
+0001eaf0: 0a20 2069 6620 6170 706c 7954 444f 4d3a  .  if applyTDOM:
+0001eb00: 0d0a 2020 2020 7072 696e 7428 2741 7070  ..    print('App
+0001eb10: 6c79 696e 6720 5444 4f4d 2729 0d0a 2020  lying TDOM')..  
+0001eb20: 2020 7332 7320 3d20 7369 6d70 6c65 5444    s2s = simpleTD
+0001eb30: 4f4d 3228 5c0d 0a20 2020 2020 2063 6f6c  OM2(\..      col
+0001eb40: 6c65 6374 696f 6e20 3d20 7332 732c 0d0a  lection = s2s,..
+0001eb50: 2020 2020 2020 7a53 636f 7265 5468 7265        zScoreThre
+0001eb60: 7368 203d 207a 5363 6f72 6554 6872 6573  sh = zScoreThres
+0001eb70: 682c 0d0a 2020 2020 2020 7368 6164 6f77  h,..      shadow
+0001eb80: 5375 6d54 6872 6573 6820 3d20 7368 6164  SumThresh = shad
+0001eb90: 6f77 5375 6d54 6872 6573 682c 0d0a 2020  owSumThresh,..  
+0001eba0: 2020 2020 636f 6e74 7261 6374 5069 7865      contractPixe
+0001ebb0: 6c73 203d 2063 6f6e 7472 6163 7450 6978  ls = contractPix
+0001ebc0: 656c 732c 0d0a 2020 2020 2020 6469 6c61  els,..      dila
+0001ebd0: 7465 5069 7865 6c73 203d 2064 696c 6174  tePixels = dilat
+0001ebe0: 6550 6978 656c 732c 0d0a 2020 2020 2020  ePixels,..      
+0001ebf0: 7368 6164 6f77 5375 6d42 616e 6473 203d  shadowSumBands =
+0001ec00: 205b 276e 6972 272c 2773 7769 7231 275d   ['nir','swir1']
+0001ec10: 2c0d 0a20 2020 2020 2070 7265 436f 6d70  ,..      preComp
+0001ec20: 7574 6564 5444 4f4d 4952 4d65 616e 203d  utedTDOMIRMean =
+0001ec30: 2070 7265 436f 6d70 7574 6564 5444 4f4d   preComputedTDOM
+0001ec40: 4952 4d65 616e 2c0d 0a20 2020 2020 2070  IRMean,..      p
+0001ec50: 7265 436f 6d70 7574 6564 5444 4f4d 4952  reComputedTDOMIR
+0001ec60: 5374 6444 6576 203d 2070 7265 436f 6d70  StdDev = preComp
+0001ec70: 7574 6564 5444 4f4d 4952 5374 6444 6576  utedTDOMIRStdDev
+0001ec80: 290d 0a0d 0a20 2023 2041 6464 2063 6f6d  )....  # Add com
+0001ec90: 6d6f 6e20 696e 6469 6365 730d 0a20 2073  mon indices..  s
+0001eca0: 3273 203d 2073 3273 2e6d 6170 2873 696d  2s = s2s.map(sim
+0001ecb0: 706c 6541 6464 496e 6469 6365 7329 5c0d  pleAddIndices)\.
+0001ecc0: 0a20 2020 2020 2020 2020 2020 2e6d 6170  .           .map
+0001ecd0: 2867 6574 5461 7373 656c 6564 4361 7029  (getTasseledCap)
+0001ece0: 5c0d 0a20 2020 2020 2020 2020 2020 2e6d  \..           .m
+0001ecf0: 6170 2873 696d 706c 6541 6464 5443 416e  ap(simpleAddTCAn
+0001ed00: 676c 6573 295c 0d0a 2020 2020 2020 2020  gles)\..        
+0001ed10: 2020 202e 6d61 7028 6c61 6d62 6461 2069     .map(lambda i
+0001ed20: 6d67 3a20 696d 672e 6164 6442 616e 6473  mg: img.addBands
+0001ed30: 2869 6d67 2e6e 6f72 6d61 6c69 7a65 6444  (img.normalizedD
+0001ed40: 6966 6665 7265 6e63 6528 5b27 7265 3127  ifference(['re1'
+0001ed50: 2c20 2772 6564 275d 292e 7365 6c65 6374  , 'red']).select
+0001ed60: 285b 305d 2c5b 274e 4443 4927 5d29 2929  ([0],['NDCI'])))
+0001ed70: 0d0a 2020 2320 4164 6420 5365 6e73 6f72  ..  # Add Sensor
+0001ed80: 2042 616e 640d 0a20 2073 3273 203d 2073   Band..  s2s = s
+0001ed90: 3273 2e6d 6170 286c 616d 6264 6120 696d  2s.map(lambda im
+0001eda0: 673a 2061 6464 5365 6e73 6f72 4261 6e64  g: addSensorBand
+0001edb0: 2869 6d67 2c20 2773 656e 7469 6e65 6c32  (img, 'sentinel2
+0001edc0: 272c 2074 6f61 4f72 5352 2929 0d0a 0d0a  ', toaOrSR))....
+0001edd0: 200d 0a20 2072 6574 7572 6e20 7332 732e   ..  return s2s.
+0001ede0: 7365 7428 6172 6773 290d 0a0d 0a0d 0a23  set(args)......#
+0001edf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ee00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ee10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ee20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ee30: 2323 2323 2323 2323 0d0a 2323 2323 2323  ########..######
+0001ee40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ee50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001ee60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001ee70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001ee80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001ee90: 2323 2323 2323 2323 2323 230d 0a23 2323  ###########..###
-0001eea0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001eeb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001eec0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001eed0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001eee0: 2323 2323 2323 0d0a 2320 5772 6170 7065  ######..# Wrappe
-0001eef0: 7220 6675 6e63 7469 6f6e 2066 6f72 2067  r function for g
-0001ef00: 6574 7469 6e67 2053 656e 7469 6e65 6c20  etting Sentinel 
-0001ef10: 3220 696d 6167 6572 790d 0a64 6566 2067  2 imagery..def g
-0001ef20: 6574 5365 6e74 696e 656c 3257 7261 7070  etSentinel2Wrapp
-0001ef30: 6572 285c 0d0a 2020 7374 7564 7941 7265  er(\..  studyAre
-0001ef40: 612c 0d0a 2020 7374 6172 7459 6561 722c  a,..  startYear,
-0001ef50: 0d0a 2020 656e 6459 6561 722c 0d0a 2020  ..  endYear,..  
-0001ef60: 7374 6172 744a 756c 6961 6e2c 0d0a 2020  startJulian,..  
-0001ef70: 656e 644a 756c 6961 6e2c 0d0a 2020 7469  endJulian,..  ti
-0001ef80: 6d65 6275 6666 6572 203d 2030 2c0d 0a20  mebuffer = 0,.. 
-0001ef90: 2077 6569 6768 7473 203d 205b 315d 2c0d   weights = [1],.
-0001efa0: 0a20 2063 6f6d 706f 7369 7469 6e67 4d65  .  compositingMe
-0001efb0: 7468 6f64 203d 2027 6d65 646f 6964 272c  thod = 'medoid',
-0001efc0: 0d0a 2020 6170 706c 7951 4142 616e 6420  ..  applyQABand 
-0001efd0: 3d20 4661 6c73 652c 0d0a 2020 6170 706c  = False,..  appl
-0001efe0: 7943 6c6f 7564 5363 6f72 6520 3d20 4661  yCloudScore = Fa
-0001eff0: 6c73 652c 0d0a 2020 6170 706c 7953 6861  lse,..  applySha
-0001f000: 646f 7753 6869 6674 203d 2046 616c 7365  dowShift = False
-0001f010: 2c0d 0a20 2061 7070 6c79 5444 4f4d 203d  ,..  applyTDOM =
-0001f020: 2054 7275 652c 0d0a 2020 636c 6f75 6453   True,..  cloudS
-0001f030: 636f 7265 5468 7265 7368 203d 2032 302c  coreThresh = 20,
-0001f040: 0d0a 2020 7065 7266 6f72 6d43 6c6f 7564  ..  performCloud
-0001f050: 5363 6f72 654f 6666 7365 7420 3d20 5472  ScoreOffset = Tr
-0001f060: 7565 2c0d 0a20 2063 6c6f 7564 5363 6f72  ue,..  cloudScor
-0001f070: 6550 6374 6c20 3d20 3130 2c0d 0a20 2063  ePctl = 10,..  c
-0001f080: 6c6f 7564 4865 6967 6874 7320 3d65 652e  loudHeights =ee.
-0001f090: 4c69 7374 2e73 6571 7565 6e63 6528 3530  List.sequence(50
-0001f0a0: 302c 3130 3030 302c 3530 3029 2c0d 0a20  0,10000,500),.. 
-0001f0b0: 207a 5363 6f72 6554 6872 6573 6820 3d20   zScoreThresh = 
-0001f0c0: 2d31 2c0d 0a20 2073 6861 646f 7753 756d  -1,..  shadowSum
-0001f0d0: 5468 7265 7368 203d 2030 2e33 352c 0d0a  Thresh = 0.35,..
-0001f0e0: 2020 636f 6e74 7261 6374 5069 7865 6c73    contractPixels
-0001f0f0: 203d 2031 2e35 2c0d 0a20 2064 696c 6174   = 1.5,..  dilat
-0001f100: 6550 6978 656c 7320 3d20 332e 352c 0d0a  ePixels = 3.5,..
-0001f110: 2020 7368 6164 6f77 5375 6d42 616e 6473    shadowSumBands
-0001f120: 203d 205b 276e 6972 272c 2773 7769 7231   = ['nir','swir1
-0001f130: 275d 2c0d 0a20 2063 6f72 7265 6374 496c  '],..  correctIl
-0001f140: 6c75 6d69 6e61 7469 6f6e 203d 2046 616c  lumination = Fal
-0001f150: 7365 2c0d 0a20 2063 6f72 7265 6374 5363  se,..  correctSc
-0001f160: 616c 6520 3d20 3235 302c 0d0a 2020 6578  ale = 250,..  ex
-0001f170: 706f 7274 436f 6d70 6f73 6974 6573 203d  portComposites =
-0001f180: 2046 616c 7365 2c0d 0a20 206f 7574 7075   False,..  outpu
-0001f190: 744e 616d 6520 3d20 2753 656e 7469 6e65  tName = 'Sentine
-0001f1a0: 6c32 2d43 6f6d 706f 7369 7465 272c 0d0a  l2-Composite',..
-0001f1b0: 2020 6578 706f 7274 5061 7468 526f 6f74    exportPathRoot
-0001f1c0: 203d 2027 7573 6572 732f 6961 6e68 6f75   = 'users/ianhou
-0001f1d0: 736d 616e 2f74 6573 7427 2c0d 0a20 2063  sman/test',..  c
-0001f1e0: 7273 203d 2027 4550 5347 3a35 3037 3027  rs = 'EPSG:5070'
-0001f1f0: 2c0d 0a20 2074 7261 6e73 666f 726d 203d  ,..  transform =
-0001f200: 205b 3130 2c30 2c2d 3233 3631 3931 352e   [10,0,-2361915.
-0001f210: 302c 302c 2d31 302c 3331 3737 3733 352e  0,0,-10,3177735.
-0001f220: 305d 2c0d 0a20 2073 6361 6c65 203d 204e  0],..  scale = N
-0001f230: 6f6e 652c 0d0a 2020 7265 7361 6d70 6c65  one,..  resample
-0001f240: 4d65 7468 6f64 203d 2027 6167 6772 6567  Method = 'aggreg
-0001f250: 6174 6527 2c0d 0a20 2074 6f61 4f72 5352  ate',..  toaOrSR
-0001f260: 203d 2027 544f 4127 2c0d 0a20 2063 6f6e   = 'TOA',..  con
-0001f270: 7665 7274 546f 4461 696c 794d 6f73 6169  vertToDailyMosai
-0001f280: 6373 203d 2054 7275 652c 0d0a 2020 6170  cs = True,..  ap
-0001f290: 706c 7943 6c6f 7564 5072 6f62 6162 696c  plyCloudProbabil
-0001f2a0: 6974 7920 3d20 5472 7565 2c0d 0a20 2070  ity = True,..  p
-0001f2b0: 7265 436f 6d70 7574 6564 436c 6f75 6453  reComputedCloudS
-0001f2c0: 636f 7265 4f66 6673 6574 203d 204e 6f6e  coreOffset = Non
-0001f2d0: 652c 0d0a 2020 7072 6543 6f6d 7075 7465  e,..  preCompute
-0001f2e0: 6454 444f 4d49 524d 6561 6e20 3d20 4e6f  dTDOMIRMean = No
-0001f2f0: 6e65 2c0d 0a20 2070 7265 436f 6d70 7574  ne,..  preComput
-0001f300: 6564 5444 4f4d 4952 5374 6444 6576 203d  edTDOMIRStdDev =
-0001f310: 204e 6f6e 652c 0d0a 2020 636c 6f75 6450   None,..  cloudP
-0001f320: 726f 6254 6872 6573 6820 3d20 3430 293a  robThresh = 40):
-0001f330: 0d0a 0d0a 2020 6f72 6967 696e 203d 2027  ....  origin = '
-0001f340: 5365 6e74 696e 656c 3227 0d0a 2020 746f  Sentinel2'..  to
-0001f350: 614f 7253 5220 3d20 746f 614f 7253 522e  aOrSR = toaOrSR.
-0001f360: 7570 7065 7228 290d 0a0d 0a20 2061 7267  upper()....  arg
-0001f370: 7320 3d20 666f 726d 6174 4172 6773 286c  s = formatArgs(l
-0001f380: 6f63 616c 7328 2929 0d0a 2020 6966 2027  ocals())..  if '
-0001f390: 6172 6773 2720 696e 2061 7267 732e 6b65  args' in args.ke
-0001f3a0: 7973 2829 3a0d 0a20 2020 2064 656c 2061  ys():..    del a
-0001f3b0: 7267 735b 2761 7267 7327 5d0d 0a0d 0a20  rgs['args'].... 
-0001f3c0: 2073 3273 203d 2067 6574 5072 6f63 6573   s2s = getProces
-0001f3d0: 7365 6453 656e 7469 6e65 6c32 5363 656e  sedSentinel2Scen
-0001f3e0: 6573 285c 0d0a 2020 2020 7374 7564 7941  es(\..    studyA
-0001f3f0: 7265 6120 3d20 7374 7564 7941 7265 612c  rea = studyArea,
-0001f400: 0d0a 2020 2020 7374 6172 7459 6561 7220  ..    startYear 
-0001f410: 3d20 7374 6172 7459 6561 722c 0d0a 2020  = startYear,..  
-0001f420: 2020 656e 6459 6561 7220 3d20 656e 6459    endYear = endY
-0001f430: 6561 722c 0d0a 2020 2020 7374 6172 744a  ear,..    startJ
-0001f440: 756c 6961 6e20 3d20 7374 6172 744a 756c  ulian = startJul
-0001f450: 6961 6e2c 0d0a 2020 2020 656e 644a 756c  ian,..    endJul
-0001f460: 6961 6e20 3d20 656e 644a 756c 6961 6e2c  ian = endJulian,
-0001f470: 0d0a 2020 2020 6170 706c 7951 4142 616e  ..    applyQABan
-0001f480: 6420 3d20 6170 706c 7951 4142 616e 642c  d = applyQABand,
-0001f490: 0d0a 2020 2020 6170 706c 7943 6c6f 7564  ..    applyCloud
-0001f4a0: 5363 6f72 6520 3d20 6170 706c 7943 6c6f  Score = applyClo
-0001f4b0: 7564 5363 6f72 652c 0d0a 2020 2020 6170  udScore,..    ap
-0001f4c0: 706c 7953 6861 646f 7753 6869 6674 203d  plyShadowShift =
-0001f4d0: 2061 7070 6c79 5368 6164 6f77 5368 6966   applyShadowShif
-0001f4e0: 742c 0d0a 2020 2020 6170 706c 7954 444f  t,..    applyTDO
-0001f4f0: 4d20 3d20 6170 706c 7954 444f 4d2c 0d0a  M = applyTDOM,..
-0001f500: 2020 2020 636c 6f75 6453 636f 7265 5468      cloudScoreTh
-0001f510: 7265 7368 203d 2063 6c6f 7564 5363 6f72  resh = cloudScor
-0001f520: 6554 6872 6573 682c 0d0a 2020 2020 7065  eThresh,..    pe
-0001f530: 7266 6f72 6d43 6c6f 7564 5363 6f72 654f  rformCloudScoreO
-0001f540: 6666 7365 7420 3d20 7065 7266 6f72 6d43  ffset = performC
-0001f550: 6c6f 7564 5363 6f72 654f 6666 7365 742c  loudScoreOffset,
-0001f560: 0d0a 2020 2020 636c 6f75 6453 636f 7265  ..    cloudScore
-0001f570: 5063 746c 203d 2063 6c6f 7564 5363 6f72  Pctl = cloudScor
-0001f580: 6550 6374 6c2c 0d0a 2020 2020 636c 6f75  ePctl,..    clou
-0001f590: 6448 6569 6768 7473 203d 2063 6c6f 7564  dHeights = cloud
-0001f5a0: 4865 6967 6874 732c 0d0a 2020 2020 7a53  Heights,..    zS
-0001f5b0: 636f 7265 5468 7265 7368 203d 207a 5363  coreThresh = zSc
-0001f5c0: 6f72 6554 6872 6573 682c 0d0a 2020 2020  oreThresh,..    
-0001f5d0: 7368 6164 6f77 5375 6d54 6872 6573 6820  shadowSumThresh 
-0001f5e0: 3d20 7368 6164 6f77 5375 6d54 6872 6573  = shadowSumThres
-0001f5f0: 682c 0d0a 2020 2020 636f 6e74 7261 6374  h,..    contract
-0001f600: 5069 7865 6c73 203d 2063 6f6e 7472 6163  Pixels = contrac
-0001f610: 7450 6978 656c 732c 0d0a 2020 2020 6469  tPixels,..    di
-0001f620: 6c61 7465 5069 7865 6c73 203d 2064 696c  latePixels = dil
-0001f630: 6174 6550 6978 656c 732c 0d0a 2020 2020  atePixels,..    
-0001f640: 7368 6164 6f77 5375 6d42 616e 6473 203d  shadowSumBands =
-0001f650: 2073 6861 646f 7753 756d 4261 6e64 732c   shadowSumBands,
-0001f660: 0d0a 2020 2020 7265 7361 6d70 6c65 4d65  ..    resampleMe
-0001f670: 7468 6f64 203d 2072 6573 616d 706c 654d  thod = resampleM
-0001f680: 6574 686f 642c 0d0a 2020 2020 746f 614f  ethod,..    toaO
-0001f690: 7253 5220 3d20 746f 614f 7253 522c 0d0a  rSR = toaOrSR,..
-0001f6a0: 2020 2020 636f 6e76 6572 7454 6f44 6169      convertToDai
-0001f6b0: 6c79 4d6f 7361 6963 7320 3d20 636f 6e76  lyMosaics = conv
-0001f6c0: 6572 7454 6f44 6169 6c79 4d6f 7361 6963  ertToDailyMosaic
-0001f6d0: 732c 0d0a 2020 2020 6170 706c 7943 6c6f  s,..    applyClo
-0001f6e0: 7564 5072 6f62 6162 696c 6974 7920 3d20  udProbability = 
-0001f6f0: 6170 706c 7943 6c6f 7564 5072 6f62 6162  applyCloudProbab
-0001f700: 696c 6974 792c 0d0a 2020 2020 7072 6543  ility,..    preC
-0001f710: 6f6d 7075 7465 6443 6c6f 7564 5363 6f72  omputedCloudScor
-0001f720: 654f 6666 7365 7420 3d20 7072 6543 6f6d  eOffset = preCom
-0001f730: 7075 7465 6443 6c6f 7564 5363 6f72 654f  putedCloudScoreO
-0001f740: 6666 7365 742c 0d0a 2020 2020 7072 6543  ffset,..    preC
-0001f750: 6f6d 7075 7465 6454 444f 4d49 524d 6561  omputedTDOMIRMea
-0001f760: 6e20 3d20 7072 6543 6f6d 7075 7465 6454  n = preComputedT
-0001f770: 444f 4d49 524d 6561 6e2c 0d0a 2020 2020  DOMIRMean,..    
-0001f780: 7072 6543 6f6d 7075 7465 6454 444f 4d49  preComputedTDOMI
-0001f790: 5253 7464 4465 7620 3d20 7072 6543 6f6d  RStdDev = preCom
-0001f7a0: 7075 7465 6454 444f 4d49 5253 7464 4465  putedTDOMIRStdDe
-0001f7b0: 762c 0d0a 2020 2020 636c 6f75 6450 726f  v,..    cloudPro
-0001f7c0: 6254 6872 6573 6820 3d20 636c 6f75 6450  bThresh = cloudP
-0001f7d0: 726f 6254 6872 6573 6829 0d0a 0d0a 2020  robThresh)....  
-0001f7e0: 2341 6464 207a 656e 6974 6820 616e 6420  #Add zenith and 
-0001f7f0: 617a 696d 7574 680d 0a20 2023 6966 2063  azimuth..  #if c
-0001f800: 6f72 7265 6374 496c 6c75 6d69 6e61 7469  orrectIlluminati
-0001f810: 6f6e 3a0d 0a20 2023 2020 7332 7320 3d20  on:..  #  s2s = 
-0001f820: 7332 732e 6d61 7028 6675 6e63 7469 6f6e  s2s.map(function
-0001f830: 2869 6d67 297b 0d0a 2020 2320 2020 2072  (img){..  #    r
-0001f840: 6574 7572 6e20 6164 645a 656e 6974 6841  eturn addZenithA
-0001f850: 7a69 6d75 7468 2869 6d67 2c27 544f 4127  zimuth(img,'TOA'
-0001f860: 2c7b 2754 4f41 273a 274d 4541 4e5f 534f  ,{'TOA':'MEAN_SO
-0001f870: 4c41 525f 5a45 4e49 5448 5f41 4e47 4c45  LAR_ZENITH_ANGLE
-0001f880: 277d 2c7b 2754 4f41 273a 274d 4541 4e5f  '},{'TOA':'MEAN_
-0001f890: 534f 4c41 525f 415a 494d 5554 485f 414e  SOLAR_AZIMUTH_AN
-0001f8a0: 474c 4527 7d29 3b0d 0a20 2023 2020 7d29  GLE'});..  #  })
-0001f8b0: 3b0d 0a20 2023 7d0d 0a0d 0a20 2023 4372  ;..  #}....  #Cr
-0001f8c0: 6561 7465 2063 6f6d 706f 7369 7465 2074  eate composite t
-0001f8d0: 696d 6520 7365 7269 6573 0d0a 2020 7473  ime series..  ts
-0001f8e0: 203d 2063 6f6d 706f 7369 7465 5469 6d65   = compositeTime
-0001f8f0: 5365 7269 6573 285c 0d0a 2020 2020 6c73  Series(\..    ls
-0001f900: 203d 2073 3273 2c0d 0a20 2020 2073 7461   = s2s,..    sta
-0001f910: 7274 5965 6172 203d 2073 7461 7274 5965  rtYear = startYe
-0001f920: 6172 2c0d 0a20 2020 2065 6e64 5965 6172  ar,..    endYear
-0001f930: 203d 2065 6e64 5965 6172 2c0d 0a20 2020   = endYear,..   
-0001f940: 2073 7461 7274 4a75 6c69 616e 203d 2073   startJulian = s
-0001f950: 7461 7274 4a75 6c69 616e 2c0d 0a20 2020  tartJulian,..   
-0001f960: 2065 6e64 4a75 6c69 616e 203d 2065 6e64   endJulian = end
-0001f970: 4a75 6c69 616e 2c0d 0a20 2020 2074 696d  Julian,..    tim
-0001f980: 6562 7566 6665 7220 3d20 7469 6d65 6275  ebuffer = timebu
-0001f990: 6666 6572 2c0d 0a20 2020 2077 6569 6768  ffer,..    weigh
-0001f9a0: 7473 203d 2077 6569 6768 7473 2c0d 0a20  ts = weights,.. 
-0001f9b0: 2020 2063 6f6d 706f 7369 7469 6e67 4d65     compositingMe
-0001f9c0: 7468 6f64 203d 2063 6f6d 706f 7369 7469  thod = compositi
-0001f9d0: 6e67 4d65 7468 6f64 290d 0a0d 0a20 2023  ngMethod)....  #
-0001f9e0: 436f 7272 6563 7420 696c 6c75 6d69 6e61  Correct illumina
-0001f9f0: 7469 6f6e 0d0a 2020 2320 6966 2028 636f  tion..  # if (co
-0001fa00: 7272 6563 7449 6c6c 756d 696e 6174 696f  rrectIlluminatio
-0001fa10: 6e29 7b0d 0a20 2023 2020 2066 203d 2065  n){..  #   f = e
-0001fa20: 652e 496d 6167 6528 7473 2e66 6972 7374  e.Image(ts.first
-0001fa30: 2829 293b 0d0a 2020 2320 2020 4d61 702e  ());..  #   Map.
-0001fa40: 6164 644c 6179 6572 2866 2c76 697a 5061  addLayer(f,vizPa
-0001fa50: 7261 6d73 4661 6c73 652c 2746 6972 7374  ramsFalse,'First
-0001fa60: 2d6e 6f6e 2d69 6c6c 756d 696e 6174 6564  -non-illuminated
-0001fa70: 272c 6661 6c73 6529 3b0d 0a0d 0a20 2023  ',false);....  #
-0001fa80: 2020 2070 7269 6e74 2827 436f 7272 6563     print('Correc
-0001fa90: 7469 6e67 2069 6c6c 756d 696e 6174 696f  ting illuminatio
-0001faa0: 6e27 293b 0d0a 2020 2320 2020 7473 203d  n');..  #   ts =
-0001fab0: 2074 732e 6d61 7028 696c 6c75 6d69 6e61   ts.map(illumina
-0001fac0: 7469 6f6e 436f 6e64 6974 696f 6e29 0d0a  tionCondition)..
-0001fad0: 2020 2320 2020 2020 2e6d 6170 2866 756e    #     .map(fun
-0001fae0: 6374 696f 6e28 696d 6729 7b0d 0a20 2023  ction(img){..  #
-0001faf0: 2020 2020 2020 2072 6574 7572 6e20 696c         return il
-0001fb00: 6c75 6d69 6e61 7469 6f6e 436f 7272 6563  luminationCorrec
-0001fb10: 7469 6f6e 2869 6d67 2c20 636f 7272 6563  tion(img, correc
-0001fb20: 7453 6361 6c65 2c73 7475 6479 4172 6561  tScale,studyArea
-0001fb30: 2c5b 2027 626c 7565 272c 2027 6772 6565  ,[ 'blue', 'gree
-0001fb40: 6e27 2c20 2772 6564 272c 276e 6972 272c  n', 'red','nir',
-0001fb50: 2773 7769 7231 272c 2027 7377 6972 3227  'swir1', 'swir2'
-0001fb60: 5d29 3b0d 0a20 2023 2020 2020 207d 293b  ]);..  #     });
-0001fb70: 0d0a 2020 2320 2020 6620 3d20 6565 2e49  ..  #   f = ee.I
-0001fb80: 6d61 6765 2874 732e 6669 7273 7428 2929  mage(ts.first())
-0001fb90: 3b0d 0a20 2023 2020 204d 6170 2e61 6464  ;..  #   Map.add
-0001fba0: 4c61 7965 7228 662c 7669 7a50 6172 616d  Layer(f,vizParam
-0001fbb0: 7346 616c 7365 2c27 4669 7273 742d 696c  sFalse,'First-il
-0001fbc0: 6c75 6d69 6e61 7465 6427 2c66 616c 7365  luminated',false
-0001fbd0: 293b 0d0a 0d0a 2020 2320 4578 706f 7274  );....  # Export
-0001fbe0: 2063 6f6d 706f 7369 7465 730d 0a20 2069   composites..  i
-0001fbf0: 6620 6578 706f 7274 436f 6d70 6f73 6974  f exportComposit
-0001fc00: 6573 3a0d 0a20 2020 2065 7870 6f72 7442  es:..    exportB
-0001fc10: 616e 6444 6963 7420 3d20 7b5c 0d0a 2020  andDict = {\..  
-0001fc20: 2020 2020 2753 525f 6d65 646f 6964 273a      'SR_medoid':
-0001fc30: 5b27 6362 272c 2027 626c 7565 272c 2027  ['cb', 'blue', '
-0001fc40: 6772 6565 6e27 2c20 2772 6564 272c 2027  green', 'red', '
-0001fc50: 7265 3127 2c27 7265 3227 2c27 7265 3327  re1','re2','re3'
-0001fc60: 2c27 6e69 7227 2c20 276e 6972 3227 2c20  ,'nir', 'nir2', 
-0001fc70: 2777 6174 6572 5661 706f 7227 2c20 2773  'waterVapor', 's
-0001fc80: 7769 7231 272c 2027 7377 6972 3227 2c27  wir1', 'swir2','
-0001fc90: 636f 6d70 6f73 6974 654f 6273 436f 756e  compositeObsCoun
-0001fca0: 7427 2c27 7365 6e73 6f72 272c 2779 6561  t','sensor','yea
-0001fcb0: 7227 2c27 6a75 6c69 616e 4461 7927 5d2c  r','julianDay'],
-0001fcc0: 0d0a 2020 2020 2020 2753 525f 6d65 6469  ..      'SR_medi
-0001fcd0: 616e 273a 5b27 6362 272c 2027 626c 7565  an':['cb', 'blue
-0001fce0: 272c 2027 6772 6565 6e27 2c20 2772 6564  ', 'green', 'red
-0001fcf0: 272c 2027 7265 3127 2c27 7265 3227 2c27  ', 're1','re2','
-0001fd00: 7265 3327 2c27 6e69 7227 2c20 276e 6972  re3','nir', 'nir
-0001fd10: 3227 2c20 2777 6174 6572 5661 706f 7227  2', 'waterVapor'
-0001fd20: 2c20 2773 7769 7231 272c 2027 7377 6972  , 'swir1', 'swir
-0001fd30: 3227 2c27 636f 6d70 6f73 6974 654f 6273  2','compositeObs
-0001fd40: 436f 756e 7427 5d2c 0d0a 2020 2020 2020  Count'],..      
-0001fd50: 2754 4f41 5f6d 6564 6f69 6427 3a5b 2763  'TOA_medoid':['c
-0001fd60: 6227 2c20 2762 6c75 6527 2c20 2767 7265  b', 'blue', 'gre
-0001fd70: 656e 272c 2027 7265 6427 2c20 2772 6531  en', 'red', 're1
-0001fd80: 272c 2772 6532 272c 2772 6533 272c 276e  ','re2','re3','n
-0001fd90: 6972 272c 2027 6e69 7232 272c 2027 7761  ir', 'nir2', 'wa
-0001fda0: 7465 7256 6170 6f72 272c 2027 6369 7272  terVapor', 'cirr
-0001fdb0: 7573 272c 2027 7377 6972 3127 2c20 2773  us', 'swir1', 's
-0001fdc0: 7769 7232 272c 2763 6f6d 706f 7369 7465  wir2','composite
-0001fdd0: 4f62 7343 6f75 6e74 272c 2773 656e 736f  ObsCount','senso
-0001fde0: 7227 2c27 7965 6172 272c 276a 756c 6961  r','year','julia
-0001fdf0: 6e44 6179 275d 2c0d 0a20 2020 2020 2027  nDay'],..      '
-0001fe00: 544f 415f 6d65 6469 616e 273a 5b27 6362  TOA_median':['cb
-0001fe10: 272c 2027 626c 7565 272c 2027 6772 6565  ', 'blue', 'gree
-0001fe20: 6e27 2c20 2772 6564 272c 2027 7265 3127  n', 'red', 're1'
-0001fe30: 2c27 7265 3227 2c27 7265 3327 2c27 6e69  ,'re2','re3','ni
-0001fe40: 7227 2c20 276e 6972 3227 2c20 2777 6174  r', 'nir2', 'wat
-0001fe50: 6572 5661 706f 7227 2c20 2763 6972 7275  erVapor', 'cirru
-0001fe60: 7327 2c20 2773 7769 7231 272c 2027 7377  s', 'swir1', 'sw
-0001fe70: 6972 3227 2c27 636f 6d70 6f73 6974 654f  ir2','compositeO
-0001fe80: 6273 436f 756e 7427 5d5c 0d0a 2020 2020  bsCount']\..    
-0001fe90: 7d0d 0a20 2020 206e 6f6e 4469 7669 6465  }..    nonDivide
-0001fea0: 4261 6e64 4469 6374 203d 207b 5c0d 0a20  BandDict = {\.. 
-0001feb0: 2020 2020 2027 6d65 646f 6964 273a 5b27       'medoid':['
-0001fec0: 636f 6d70 6f73 6974 654f 6273 436f 756e  compositeObsCoun
-0001fed0: 7427 2c27 7365 6e73 6f72 272c 2779 6561  t','sensor','yea
-0001fee0: 7227 2c27 6a75 6c69 616e 4461 7927 5d2c  r','julianDay'],
-0001fef0: 0d0a 2020 2020 2020 276d 6564 6961 6e27  ..      'median'
-0001ff00: 3a5b 2763 6f6d 706f 7369 7465 4f62 7343  :['compositeObsC
-0001ff10: 6f75 6e74 275d 5c0d 0a20 2020 207d 0d0a  ount']\..    }..
-0001ff20: 2020 2020 6578 706f 7274 4261 6e64 7320      exportBands 
-0001ff30: 3d20 6578 706f 7274 4261 6e64 4469 6374  = exportBandDict
-0001ff40: 5b74 6f61 4f72 5352 202b 2027 5f27 202b  [toaOrSR + '_' +
-0001ff50: 2063 6f6d 706f 7369 7469 6e67 4d65 7468   compositingMeth
-0001ff60: 6f64 5d0d 0a20 2020 206e 6f6e 4469 7669  od]..    nonDivi
-0001ff70: 6465 4261 6e64 7320 3d20 6e6f 6e44 6976  deBands = nonDiv
-0001ff80: 6964 6542 616e 6444 6963 745b 636f 6d70  ideBandDict[comp
-0001ff90: 6f73 6974 696e 674d 6574 686f 645d 0d0a  ositingMethod]..
-0001ffa0: 0d0a 2020 2020 6578 706f 7274 436f 6d70  ..    exportComp
-0001ffb0: 6f73 6974 6543 6f6c 6c65 6374 696f 6e28  ositeCollection(
-0001ffc0: 5c0d 0a20 2020 2020 2063 6f6c 6c65 6374  \..      collect
-0001ffd0: 696f 6e20 3d20 7473 2c0d 0a20 2020 2020  ion = ts,..     
-0001ffe0: 2065 7870 6f72 7450 6174 6852 6f6f 7420   exportPathRoot 
-0001fff0: 3d20 6578 706f 7274 5061 7468 526f 6f74  = exportPathRoot
-00020000: 2c0d 0a20 2020 2020 206f 7574 7075 744e  ,..      outputN
-00020010: 616d 6520 3d20 6f75 7470 7574 4e61 6d65  ame = outputName
-00020020: 2c0d 0a20 2020 2020 206f 7269 6769 6e20  ,..      origin 
-00020030: 3d20 6f72 6967 696e 2c0d 0a20 2020 2020  = origin,..     
-00020040: 2073 7475 6479 4172 6561 203d 2073 7475   studyArea = stu
-00020050: 6479 4172 6561 2c0d 0a20 2020 2020 2063  dyArea,..      c
-00020060: 7273 203d 2063 7273 2c0d 0a20 2020 2020  rs = crs,..     
-00020070: 2074 7261 6e73 666f 726d 203d 2074 7261   transform = tra
-00020080: 6e73 666f 726d 2c0d 0a20 2020 2020 2073  nsform,..      s
-00020090: 6361 6c65 203d 2073 6361 6c65 2c0d 0a20  cale = scale,.. 
-000200a0: 2020 2020 2073 7461 7274 5965 6172 203d       startYear =
-000200b0: 2073 7461 7274 5965 6172 2c0d 0a20 2020   startYear,..   
-000200c0: 2020 2065 6e64 5965 6172 203d 2065 6e64     endYear = end
-000200d0: 5965 6172 2c0d 0a20 2020 2020 2073 7461  Year,..      sta
-000200e0: 7274 4a75 6c69 616e 203d 2073 7461 7274  rtJulian = start
-000200f0: 4a75 6c69 616e 2c0d 0a20 2020 2020 2065  Julian,..      e
-00020100: 6e64 4a75 6c69 616e 203d 2065 6e64 4a75  ndJulian = endJu
-00020110: 6c69 616e 2c0d 0a20 2020 2020 2063 6f6d  lian,..      com
-00020120: 706f 7369 7469 6e67 4d65 7468 6f64 203d  positingMethod =
-00020130: 2063 6f6d 706f 7369 7469 6e67 4d65 7468   compositingMeth
-00020140: 6f64 2c0d 0a20 2020 2020 2074 696d 6562  od,..      timeb
-00020150: 7566 6665 7220 3d20 7469 6d65 6275 6666  uffer = timebuff
-00020160: 6572 2c0d 0a20 2020 2020 2074 6f61 4f72  er,..      toaOr
-00020170: 5352 203d 2074 6f61 4f72 5352 2c0d 0a20  SR = toaOrSR,.. 
-00020180: 2020 2020 206e 6f6e 4469 7669 6465 4261       nonDivideBa
-00020190: 6e64 7320 3d20 6e6f 6e44 6976 6964 6542  nds = nonDivideB
-000201a0: 616e 6473 2c0d 0a20 2020 2020 2065 7870  ands,..      exp
-000201b0: 6f72 7442 616e 6473 203d 2065 7870 6f72  ortBands = expor
-000201c0: 7442 616e 6473 2c0d 0a20 2020 2020 2061  tBands,..      a
-000201d0: 6464 6974 696f 6e61 6c50 726f 7065 7274  dditionalPropert
-000201e0: 7944 6963 7420 3d20 6172 6773 290d 0a0d  yDict = args)...
-000201f0: 0a20 2061 7267 735b 2770 726f 6365 7373  .  args['process
-00020200: 6564 5363 656e 6573 275d 203d 2073 3273  edScenes'] = s2s
-00020210: 0d0a 2020 6172 6773 5b27 7072 6f63 6573  ..  args['proces
-00020220: 7365 6443 6f6d 706f 7369 7465 7327 5d20  sedComposites'] 
-00020230: 3d20 7473 0d0a 0d0a 2020 7265 7475 726e  = ts....  return
-00020240: 2061 7267 730d 0a0d 0a23 2048 7962 7269   args....# Hybri
-00020250: 6420 6765 7420 4c61 6e64 7361 7420 616e  d get Landsat an
-00020260: 6420 5365 6e74 696e 656c 2032 2070 726f  d Sentinel 2 pro
-00020270: 6365 7373 6564 2073 6365 6e65 730d 0a23  cessed scenes..#
-00020280: 2048 616e 646c 6573 2067 6574 7469 6e67   Handles getting
-00020290: 2070 726f 6365 7373 6564 2073 6365 6e65   processed scene
-000202a0: 7320 2077 6974 6820 4c61 6e64 7361 7420  s  with Landsat 
-000202b0: 616e 6420 5365 6e74 696e 656c 2032 0d0a  and Sentinel 2..
-000202c0: 6465 6620 6765 7450 726f 6365 7373 6564  def getProcessed
-000202d0: 4c61 6e64 7361 7441 6e64 5365 6e74 696e  LandsatAndSentin
-000202e0: 656c 3253 6365 6e65 7328 0d0a 2020 2020  el2Scenes(..    
-000202f0: 2020 7374 7564 7941 7265 612c 0d0a 2020    studyArea,..  
-00020300: 2020 2020 7374 6172 7459 6561 722c 0d0a      startYear,..
-00020310: 2020 2020 2020 656e 6459 6561 722c 0d0a        endYear,..
-00020320: 2020 2020 2020 7374 6172 744a 756c 6961        startJulia
-00020330: 6e2c 0d0a 2020 2020 2020 656e 644a 756c  n,..      endJul
-00020340: 6961 6e2c 0d0a 2020 2020 2020 746f 614f  ian,..      toaO
-00020350: 7253 5220 3d20 2754 4f41 272c 0d0a 2020  rSR = 'TOA',..  
-00020360: 2020 2020 696e 636c 7564 6553 4c43 4f66      includeSLCOf
-00020370: 664c 3720 3d20 4661 6c73 652c 0d0a 2020  fL7 = False,..  
-00020380: 2020 2020 6465 6672 696e 6765 4c35 203d      defringeL5 =
-00020390: 2046 616c 7365 2c0d 0a20 2020 2020 2061   False,..      a
-000203a0: 7070 6c79 5141 4261 6e64 203d 2046 616c  pplyQABand = Fal
-000203b0: 7365 2c0d 0a20 2020 2020 2061 7070 6c79  se,..      apply
-000203c0: 436c 6f75 6450 726f 6261 6269 6c69 7479  CloudProbability
-000203d0: 203d 2054 7275 652c 0d0a 2020 2020 2020   = True,..      
-000203e0: 6170 706c 7953 6861 646f 7753 6869 6674  applyShadowShift
-000203f0: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
-00020400: 2061 7070 6c79 436c 6f75 6453 636f 7265   applyCloudScore
-00020410: 4c61 6e64 7361 7420 3d20 4661 6c73 652c  Landsat = False,
-00020420: 0d0a 2020 2020 2020 6170 706c 7943 6c6f  ..      applyClo
-00020430: 7564 5363 6f72 6553 656e 7469 6e65 6c32  udScoreSentinel2
-00020440: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
-00020450: 2061 7070 6c79 5444 4f4d 4c61 6e64 7361   applyTDOMLandsa
-00020460: 7420 3d20 5472 7565 2c0d 0a20 2020 2020  t = True,..     
-00020470: 2061 7070 6c79 5444 4f4d 5365 6e74 696e   applyTDOMSentin
-00020480: 656c 3220 3d20 5472 7565 2c0d 0a20 2020  el2 = True,..   
-00020490: 2020 2061 7070 6c79 466d 6173 6b43 6c6f     applyFmaskClo
-000204a0: 7564 4d61 736b 203d 2054 7275 652c 0d0a  udMask = True,..
-000204b0: 2020 2020 2020 6170 706c 7946 6d61 736b        applyFmask
-000204c0: 436c 6f75 6453 6861 646f 774d 6173 6b20  CloudShadowMask 
-000204d0: 3d20 5472 7565 2c0d 0a20 2020 2020 2061  = True,..      a
-000204e0: 7070 6c79 466d 6173 6b53 6e6f 774d 6173  pplyFmaskSnowMas
-000204f0: 6b20 3d20 4661 6c73 652c 0d0a 2020 2020  k = False,..    
-00020500: 2020 636c 6f75 6448 6569 6768 7473 203d    cloudHeights =
-00020510: 2065 652e 4c69 7374 2e73 6571 7565 6e63   ee.List.sequenc
-00020520: 6528 3530 302c 3130 3030 302c 3530 3029  e(500,10000,500)
-00020530: 2c0d 0a20 2020 2020 2063 6c6f 7564 5363  ,..      cloudSc
-00020540: 6f72 6554 6872 6573 6820 3d20 3230 2c0d  oreThresh = 20,.
-00020550: 0a20 2020 2020 2070 6572 666f 726d 436c  .      performCl
-00020560: 6f75 6453 636f 7265 4f66 6673 6574 203d  oudScoreOffset =
-00020570: 2054 7275 652c 0d0a 2020 2020 2020 636c   True,..      cl
-00020580: 6f75 6453 636f 7265 5063 746c 203d 2031  oudScorePctl = 1
-00020590: 302c 0d0a 2020 2020 2020 7a53 636f 7265  0,..      zScore
-000205a0: 5468 7265 7368 203d 202d 312c 0d0a 2020  Thresh = -1,..  
-000205b0: 2020 2020 7368 6164 6f77 5375 6d54 6872      shadowSumThr
-000205c0: 6573 6820 3d20 302e 3335 2c0d 0a20 2020  esh = 0.35,..   
-000205d0: 2020 2063 6f6e 7472 6163 7450 6978 656c     contractPixel
-000205e0: 7320 3d20 312e 352c 0d0a 2020 2020 2020  s = 1.5,..      
-000205f0: 6469 6c61 7465 5069 7865 6c73 203d 2033  dilatePixels = 3
-00020600: 2e35 2c0d 0a20 2020 2020 2073 6861 646f  .5,..      shado
-00020610: 7753 756d 4261 6e64 7320 3d20 5b27 6e69  wSumBands = ['ni
-00020620: 7227 2c27 7377 6972 3127 5d2c 0d0a 2020  r','swir1'],..  
-00020630: 2020 2020 6c61 6e64 7361 7452 6573 616d      landsatResam
-00020640: 706c 654d 6574 686f 6420 3d20 276e 6561  pleMethod = 'nea
-00020650: 7227 2c0d 0a20 2020 2020 2073 656e 7469  r',..      senti
-00020660: 6e65 6c32 5265 7361 6d70 6c65 4d65 7468  nel2ResampleMeth
-00020670: 6f64 203d 2027 6167 6772 6567 6174 6527  od = 'aggregate'
-00020680: 2c0d 0a20 2020 2020 2063 6f6e 7665 7274  ,..      convert
-00020690: 546f 4461 696c 794d 6f73 6169 6373 203d  ToDailyMosaics =
-000206a0: 2054 7275 652c 0d0a 2020 2020 2020 7275   True,..      ru
-000206b0: 6e43 6861 7374 6169 6e48 6172 6d6f 6e69  nChastainHarmoni
-000206c0: 7a61 7469 6f6e 203d 2054 7275 652c 0d0a  zation = True,..
-000206d0: 2020 2020 2020 636f 7272 6563 7449 6c6c        correctIll
-000206e0: 756d 696e 6174 696f 6e20 3d20 4661 6c73  umination = Fals
-000206f0: 652c 0d0a 2020 2020 2020 636f 7272 6563  e,..      correc
-00020700: 7453 6361 6c65 203d 2032 3530 2c0d 0a20  tScale = 250,.. 
-00020710: 2020 2020 2070 7265 436f 6d70 7574 6564       preComputed
-00020720: 4c61 6e64 7361 7443 6c6f 7564 5363 6f72  LandsatCloudScor
-00020730: 654f 6666 7365 7420 3d20 4e6f 6e65 2c0d  eOffset = None,.
-00020740: 0a20 2020 2020 2070 7265 436f 6d70 7574  .      preComput
-00020750: 6564 4c61 6e64 7361 7454 444f 4d49 524d  edLandsatTDOMIRM
-00020760: 6561 6e20 3d20 4e6f 6e65 2c0d 0a20 2020  ean = None,..   
-00020770: 2020 2070 7265 436f 6d70 7574 6564 4c61     preComputedLa
-00020780: 6e64 7361 7454 444f 4d49 5253 7464 4465  ndsatTDOMIRStdDe
-00020790: 7620 3d20 4e6f 6e65 2c0d 0a20 2020 2020  v = None,..     
-000207a0: 2070 7265 436f 6d70 7574 6564 5365 6e74   preComputedSent
-000207b0: 696e 656c 3243 6c6f 7564 5363 6f72 654f  inel2CloudScoreO
-000207c0: 6666 7365 7420 3d20 4e6f 6e65 2c0d 0a20  ffset = None,.. 
-000207d0: 2020 2020 2070 7265 436f 6d70 7574 6564       preComputed
-000207e0: 5365 6e74 696e 656c 3254 444f 4d49 524d  Sentinel2TDOMIRM
-000207f0: 6561 6e20 3d20 4e6f 6e65 2c0d 0a20 2020  ean = None,..   
-00020800: 2020 2070 7265 436f 6d70 7574 6564 5365     preComputedSe
-00020810: 6e74 696e 656c 3254 444f 4d49 5253 7464  ntinel2TDOMIRStd
-00020820: 4465 7620 3d20 4e6f 6e65 2c0d 0a20 2020  Dev = None,..   
-00020830: 2020 2063 6c6f 7564 5072 6f62 5468 7265     cloudProbThre
-00020840: 7368 203d 2034 302c 0d0a 2020 2020 2020  sh = 40,..      
-00020850: 6c61 6e64 7361 7443 6f6c 6c65 6374 696f  landsatCollectio
-00020860: 6e56 6572 7369 6f6e 203d 2027 4332 2729  nVersion = 'C2')
-00020870: 3a0d 0a0d 0a20 2069 6620 746f 614f 7253  :....  if toaOrS
-00020880: 5220 3d3d 2027 5352 273a 0d0a 2020 2020  R == 'SR':..    
-00020890: 7275 6e43 6861 7374 6169 6e48 6172 6d6f  runChastainHarmo
-000208a0: 6e69 7a61 7469 6f6e 203d 2046 616c 7365  nization = False
-000208b0: 0d0a 0d0a 2020 6f72 6967 696e 203d 2027  ....  origin = '
-000208c0: 4c61 6e64 7361 742d 5365 6e74 696e 656c  Landsat-Sentinel
-000208d0: 322d 4879 6272 6964 270d 0a20 2074 6f61  2-Hybrid'..  toa
-000208e0: 4f72 5352 203d 2074 6f61 4f72 5352 2e75  OrSR = toaOrSR.u
-000208f0: 7070 6572 2829 0d0a 0d0a 2020 2350 7265  pper()....  #Pre
-00020900: 7061 7265 2064 6174 6573 0d0a 2020 2357  pare dates..  #W
-00020910: 7261 7020 7468 6520 6461 7465 7320 6966  rap the dates if
-00020920: 206e 6565 6465 640d 0a20 2077 7261 704f   needed..  wrapO
-00020930: 6666 7365 7420 3d20 300d 0a20 2069 6620  ffset = 0..  if 
-00020940: 7374 6172 744a 756c 6961 6e20 3e20 656e  startJulian > en
-00020950: 644a 756c 6961 6e3a 0d0a 2020 2020 7772  dJulian:..    wr
-00020960: 6170 4f66 6673 6574 203d 2033 3635 0d0a  apOffset = 365..
-00020970: 2020 7374 6172 7444 6174 6520 3d20 6565    startDate = ee
-00020980: 2e44 6174 652e 6672 6f6d 594d 4428 7374  .Date.fromYMD(st
-00020990: 6172 7459 6561 722c 312c 3129 2e61 6476  artYear,1,1).adv
-000209a0: 616e 6365 2873 7461 7274 4a75 6c69 616e  ance(startJulian
-000209b0: 2d31 2c27 6461 7927 290d 0a20 2065 6e64  -1,'day')..  end
-000209c0: 4461 7465 203d 2065 652e 4461 7465 2e66  Date = ee.Date.f
-000209d0: 726f 6d59 4d44 2865 6e64 5965 6172 2c31  romYMD(endYear,1
-000209e0: 2c31 292e 6164 7661 6e63 6528 656e 644a  ,1).advance(endJ
-000209f0: 756c 6961 6e2d 312b 7772 6170 4f66 6673  ulian-1+wrapOffs
-00020a00: 6574 2c27 6461 7927 290d 0a0d 0a20 2061  et,'day')....  a
-00020a10: 7267 7320 3d20 666f 726d 6174 4172 6773  rgs = formatArgs
-00020a20: 286c 6f63 616c 7328 2929 0d0a 2020 6966  (locals())..  if
-00020a30: 2027 6172 6773 2720 696e 2061 7267 732e   'args' in args.
-00020a40: 6b65 7973 2829 3a0d 0a20 2020 2064 656c  keys():..    del
-00020a50: 2061 7267 735b 2761 7267 7327 5d0d 0a0d   args['args']...
-00020a60: 0a20 2070 7269 6e74 2827 4765 7420 5072  .  print('Get Pr
-00020a70: 6f63 6573 7365 6420 4c61 6e64 7361 7420  ocessed Landsat 
-00020a80: 616e 6420 5365 6e74 696e 656c 3220 5363  and Sentinel2 Sc
-00020a90: 656e 6573 3a20 2729 0d0a 2020 7072 696e  enes: ')..  prin
-00020aa0: 7428 2753 7461 7274 2064 6174 653a 272c  t('Start date:',
-00020ab0: 2073 7461 7274 4461 7465 2e66 6f72 6d61   startDate.forma
-00020ac0: 7428 274d 4d4d 2064 6420 7979 7979 2729  t('MMM dd yyyy')
-00020ad0: 2e67 6574 496e 666f 2829 2c27 2c20 456e  .getInfo(),', En
-00020ae0: 6420 6461 7465 3a27 2c20 656e 6444 6174  d date:', endDat
-00020af0: 652e 666f 726d 6174 2827 4d4d 4d20 6464  e.format('MMM dd
-00020b00: 2079 7979 7927 292e 6765 7449 6e66 6f28   yyyy').getInfo(
-00020b10: 2929 0d0a 2020 666f 7220 6172 6720 696e  ))..  for arg in
-00020b20: 2061 7267 732e 6b65 7973 2829 3a0d 0a20   args.keys():.. 
-00020b30: 2020 2070 7269 6e74 2861 7267 2c20 273a     print(arg, ':
-00020b40: 2027 2c20 6172 6773 5b61 7267 5d29 0d0a   ', args[arg])..
-00020b50: 0d0a 2020 2347 6574 204c 616e 6473 6174  ..  #Get Landsat
-00020b60: 0d0a 2020 6c73 203d 2067 6574 5072 6f63  ..  ls = getProc
-00020b70: 6573 7365 644c 616e 6473 6174 5363 656e  essedLandsatScen
-00020b80: 6573 285c 0d0a 2020 2020 7374 7564 7941  es(\..    studyA
-00020b90: 7265 6120 3d20 7374 7564 7941 7265 612c  rea = studyArea,
-00020ba0: 0d0a 2020 2020 7374 6172 7459 6561 7220  ..    startYear 
-00020bb0: 3d20 7374 6172 7459 6561 722c 0d0a 2020  = startYear,..  
-00020bc0: 2020 656e 6459 6561 7220 3d20 656e 6459    endYear = endY
-00020bd0: 6561 722c 0d0a 2020 2020 7374 6172 744a  ear,..    startJ
-00020be0: 756c 6961 6e20 3d20 7374 6172 744a 756c  ulian = startJul
-00020bf0: 6961 6e2c 0d0a 2020 2020 656e 644a 756c  ian,..    endJul
-00020c00: 6961 6e20 3d20 656e 644a 756c 6961 6e2c  ian = endJulian,
-00020c10: 0d0a 2020 2020 746f 614f 7253 5220 3d20  ..    toaOrSR = 
-00020c20: 746f 614f 7253 522c 0d0a 2020 2020 696e  toaOrSR,..    in
-00020c30: 636c 7564 6553 4c43 4f66 664c 3720 3d20  cludeSLCOffL7 = 
-00020c40: 696e 636c 7564 6553 4c43 4f66 664c 372c  includeSLCOffL7,
-00020c50: 0d0a 2020 2020 6465 6672 696e 6765 4c35  ..    defringeL5
-00020c60: 203d 2064 6566 7269 6e67 654c 352c 0d0a   = defringeL5,..
-00020c70: 2020 2020 6170 706c 7943 6c6f 7564 5363      applyCloudSc
-00020c80: 6f72 6520 3d20 6170 706c 7943 6c6f 7564  ore = applyCloud
-00020c90: 5363 6f72 654c 616e 6473 6174 2c0d 0a20  ScoreLandsat,.. 
-00020ca0: 2020 2061 7070 6c79 466d 6173 6b43 6c6f     applyFmaskClo
-00020cb0: 7564 4d61 736b 203d 2061 7070 6c79 466d  udMask = applyFm
-00020cc0: 6173 6b43 6c6f 7564 4d61 736b 2c0d 0a20  askCloudMask,.. 
-00020cd0: 2020 2061 7070 6c79 5444 4f4d 203d 2061     applyTDOM = a
-00020ce0: 7070 6c79 5444 4f4d 4c61 6e64 7361 742c  pplyTDOMLandsat,
-00020cf0: 0d0a 2020 2020 6170 706c 7946 6d61 736b  ..    applyFmask
-00020d00: 436c 6f75 6453 6861 646f 774d 6173 6b20  CloudShadowMask 
-00020d10: 3d20 6170 706c 7946 6d61 736b 436c 6f75  = applyFmaskClou
-00020d20: 6453 6861 646f 774d 6173 6b2c 0d0a 2020  dShadowMask,..  
-00020d30: 2020 6170 706c 7946 6d61 736b 536e 6f77    applyFmaskSnow
-00020d40: 4d61 736b 203d 2061 7070 6c79 466d 6173  Mask = applyFmas
-00020d50: 6b53 6e6f 774d 6173 6b2c 0d0a 2020 2020  kSnowMask,..    
-00020d60: 636c 6f75 6453 636f 7265 5468 7265 7368  cloudScoreThresh
-00020d70: 203d 2063 6c6f 7564 5363 6f72 6554 6872   = cloudScoreThr
-00020d80: 6573 682c 0d0a 2020 2020 7065 7266 6f72  esh,..    perfor
-00020d90: 6d43 6c6f 7564 5363 6f72 654f 6666 7365  mCloudScoreOffse
-00020da0: 7420 3d20 7065 7266 6f72 6d43 6c6f 7564  t = performCloud
-00020db0: 5363 6f72 654f 6666 7365 742c 0d0a 2020  ScoreOffset,..  
-00020dc0: 2020 636c 6f75 6453 636f 7265 5063 746c    cloudScorePctl
-00020dd0: 203d 2063 6c6f 7564 5363 6f72 6550 6374   = cloudScorePct
-00020de0: 6c2c 0d0a 2020 2020 7a53 636f 7265 5468  l,..    zScoreTh
-00020df0: 7265 7368 203d 207a 5363 6f72 6554 6872  resh = zScoreThr
-00020e00: 6573 682c 0d0a 2020 2020 7368 6164 6f77  esh,..    shadow
-00020e10: 5375 6d54 6872 6573 6820 3d20 7368 6164  SumThresh = shad
-00020e20: 6f77 5375 6d54 6872 6573 682c 0d0a 2020  owSumThresh,..  
-00020e30: 2020 636f 6e74 7261 6374 5069 7865 6c73    contractPixels
-00020e40: 203d 2063 6f6e 7472 6163 7450 6978 656c   = contractPixel
-00020e50: 732c 0d0a 2020 2020 6469 6c61 7465 5069  s,..    dilatePi
-00020e60: 7865 6c73 203d 2064 696c 6174 6550 6978  xels = dilatePix
-00020e70: 656c 732c 0d0a 2020 2020 7368 6164 6f77  els,..    shadow
-00020e80: 5375 6d42 616e 6473 203d 2073 6861 646f  SumBands = shado
-00020e90: 7753 756d 4261 6e64 732c 0d0a 2020 2020  wSumBands,..    
-00020ea0: 7265 7361 6d70 6c65 4d65 7468 6f64 203d  resampleMethod =
-00020eb0: 206c 616e 6473 6174 5265 7361 6d70 6c65   landsatResample
-00020ec0: 4d65 7468 6f64 2c0d 0a20 2020 2023 6861  Method,..    #ha
-00020ed0: 726d 6f6e 697a 654f 4c49 203d 2068 6172  rmonizeOLI = har
-00020ee0: 6d6f 6e69 7a65 4f4c 492c 0d0a 2020 2020  monizeOLI,..    
-00020ef0: 7072 6543 6f6d 7075 7465 6443 6c6f 7564  preComputedCloud
-00020f00: 5363 6f72 654f 6666 7365 7420 3d20 7072  ScoreOffset = pr
-00020f10: 6543 6f6d 7075 7465 644c 616e 6473 6174  eComputedLandsat
-00020f20: 436c 6f75 6453 636f 7265 4f66 6673 6574  CloudScoreOffset
-00020f30: 2c0d 0a20 2020 2070 7265 436f 6d70 7574  ,..    preComput
-00020f40: 6564 5444 4f4d 4952 4d65 616e 203d 2070  edTDOMIRMean = p
-00020f50: 7265 436f 6d70 7574 6564 4c61 6e64 7361  reComputedLandsa
-00020f60: 7454 444f 4d49 524d 6561 6e2c 0d0a 2020  tTDOMIRMean,..  
-00020f70: 2020 7072 6543 6f6d 7075 7465 6454 444f    preComputedTDO
-00020f80: 4d49 5253 7464 4465 7620 3d20 7072 6543  MIRStdDev = preC
-00020f90: 6f6d 7075 7465 6453 656e 7469 6e65 6c32  omputedSentinel2
-00020fa0: 5444 4f4d 4952 5374 6444 6576 2c0d 0a20  TDOMIRStdDev,.. 
-00020fb0: 2020 206c 616e 6473 6174 436f 6c6c 6563     landsatCollec
-00020fc0: 7469 6f6e 5665 7273 696f 6e20 3d20 6c61  tionVersion = la
-00020fd0: 6e64 7361 7443 6f6c 6c65 6374 696f 6e56  ndsatCollectionV
-00020fe0: 6572 7369 6f6e 290d 0a0d 0a20 2023 4765  ersion)....  #Ge
-00020ff0: 7420 5365 6e74 696e 656c 2032 0d0a 2020  t Sentinel 2..  
-00021000: 7332 7320 3d20 6765 7450 726f 6365 7373  s2s = getProcess
-00021010: 6564 5365 6e74 696e 656c 3253 6365 6e65  edSentinel2Scene
-00021020: 7328 5c0d 0a20 2020 2073 7475 6479 4172  s(\..    studyAr
-00021030: 6561 203d 2073 7475 6479 4172 6561 2c0d  ea = studyArea,.
-00021040: 0a20 2020 2073 7461 7274 5965 6172 203d  .    startYear =
-00021050: 2073 7461 7274 5965 6172 2c0d 0a20 2020   startYear,..   
-00021060: 2065 6e64 5965 6172 203d 2065 6e64 5965   endYear = endYe
-00021070: 6172 2c0d 0a20 2020 2073 7461 7274 4a75  ar,..    startJu
-00021080: 6c69 616e 203d 2073 7461 7274 4a75 6c69  lian = startJuli
-00021090: 616e 2c0d 0a20 2020 2065 6e64 4a75 6c69  an,..    endJuli
-000210a0: 616e 203d 2065 6e64 4a75 6c69 616e 2c0d  an = endJulian,.
-000210b0: 0a20 2020 2061 7070 6c79 5141 4261 6e64  .    applyQABand
-000210c0: 203d 2061 7070 6c79 5141 4261 6e64 2c0d   = applyQABand,.
-000210d0: 0a20 2020 2061 7070 6c79 436c 6f75 6453  .    applyCloudS
-000210e0: 636f 7265 203d 2061 7070 6c79 436c 6f75  core = applyClou
-000210f0: 6453 636f 7265 5365 6e74 696e 656c 322c  dScoreSentinel2,
-00021100: 0d0a 2020 2020 6170 706c 7953 6861 646f  ..    applyShado
-00021110: 7753 6869 6674 203d 2061 7070 6c79 5368  wShift = applySh
-00021120: 6164 6f77 5368 6966 742c 0d0a 2020 2020  adowShift,..    
-00021130: 6170 706c 7954 444f 4d20 3d20 6170 706c  applyTDOM = appl
-00021140: 7954 444f 4d53 656e 7469 6e65 6c32 2c0d  yTDOMSentinel2,.
-00021150: 0a20 2020 2063 6c6f 7564 5363 6f72 6554  .    cloudScoreT
-00021160: 6872 6573 6820 3d20 636c 6f75 6453 636f  hresh = cloudSco
-00021170: 7265 5468 7265 7368 2c0d 0a20 2020 2070  reThresh,..    p
-00021180: 6572 666f 726d 436c 6f75 6453 636f 7265  erformCloudScore
-00021190: 4f66 6673 6574 203d 2070 6572 666f 726d  Offset = perform
-000211a0: 436c 6f75 6453 636f 7265 4f66 6673 6574  CloudScoreOffset
-000211b0: 2c0d 0a20 2020 2063 6c6f 7564 5363 6f72  ,..    cloudScor
-000211c0: 6550 6374 6c20 3d20 636c 6f75 6453 636f  ePctl = cloudSco
-000211d0: 7265 5063 746c 2c0d 0a20 2020 2063 6c6f  rePctl,..    clo
-000211e0: 7564 4865 6967 6874 7320 3d20 636c 6f75  udHeights = clou
-000211f0: 6448 6569 6768 7473 2c0d 0a20 2020 207a  dHeights,..    z
-00021200: 5363 6f72 6554 6872 6573 6820 3d20 7a53  ScoreThresh = zS
-00021210: 636f 7265 5468 7265 7368 2c0d 0a20 2020  coreThresh,..   
-00021220: 2073 6861 646f 7753 756d 5468 7265 7368   shadowSumThresh
-00021230: 203d 2073 6861 646f 7753 756d 5468 7265   = shadowSumThre
-00021240: 7368 2c0d 0a20 2020 2063 6f6e 7472 6163  sh,..    contrac
-00021250: 7450 6978 656c 7320 3d20 636f 6e74 7261  tPixels = contra
-00021260: 6374 5069 7865 6c73 2c0d 0a20 2020 2064  ctPixels,..    d
-00021270: 696c 6174 6550 6978 656c 7320 3d20 6469  ilatePixels = di
-00021280: 6c61 7465 5069 7865 6c73 2c0d 0a20 2020  latePixels,..   
-00021290: 2073 6861 646f 7753 756d 4261 6e64 7320   shadowSumBands 
-000212a0: 3d20 7368 6164 6f77 5375 6d42 616e 6473  = shadowSumBands
-000212b0: 2c0d 0a20 2020 2072 6573 616d 706c 654d  ,..    resampleM
-000212c0: 6574 686f 6420 3d20 7365 6e74 696e 656c  ethod = sentinel
-000212d0: 3252 6573 616d 706c 654d 6574 686f 642c  2ResampleMethod,
-000212e0: 0d0a 2020 2020 746f 614f 7253 5220 3d20  ..    toaOrSR = 
-000212f0: 746f 614f 7253 522c 0d0a 2020 2020 636f  toaOrSR,..    co
-00021300: 6e76 6572 7454 6f44 6169 6c79 4d6f 7361  nvertToDailyMosa
-00021310: 6963 7320 3d20 636f 6e76 6572 7454 6f44  ics = convertToD
-00021320: 6169 6c79 4d6f 7361 6963 732c 0d0a 2020  ailyMosaics,..  
-00021330: 2020 6170 706c 7943 6c6f 7564 5072 6f62    applyCloudProb
-00021340: 6162 696c 6974 7920 3d20 6170 706c 7943  ability = applyC
-00021350: 6c6f 7564 5072 6f62 6162 696c 6974 792c  loudProbability,
-00021360: 0d0a 2020 2020 7072 6543 6f6d 7075 7465  ..    preCompute
-00021370: 6443 6c6f 7564 5363 6f72 654f 6666 7365  dCloudScoreOffse
-00021380: 7420 3d20 7072 6543 6f6d 7075 7465 6453  t = preComputedS
-00021390: 656e 7469 6e65 6c32 436c 6f75 6453 636f  entinel2CloudSco
-000213a0: 7265 4f66 6673 6574 2c0d 0a20 2020 2070  reOffset,..    p
-000213b0: 7265 436f 6d70 7574 6564 5444 4f4d 4952  reComputedTDOMIR
-000213c0: 4d65 616e 203d 2070 7265 436f 6d70 7574  Mean = preComput
-000213d0: 6564 5365 6e74 696e 656c 3254 444f 4d49  edSentinel2TDOMI
-000213e0: 524d 6561 6e2c 0d0a 2020 2020 7072 6543  RMean,..    preC
-000213f0: 6f6d 7075 7465 6454 444f 4d49 5253 7464  omputedTDOMIRStd
-00021400: 4465 7620 3d20 7072 6543 6f6d 7075 7465  Dev = preCompute
-00021410: 6453 656e 7469 6e65 6c32 5444 4f4d 4952  dSentinel2TDOMIR
-00021420: 5374 6444 6576 2c0d 0a20 2020 2063 6c6f  StdDev,..    clo
-00021430: 7564 5072 6f62 5468 7265 7368 203d 2063  udProbThresh = c
-00021440: 6c6f 7564 5072 6f62 5468 7265 7368 290d  loudProbThresh).
-00021450: 0a0d 0a0d 0a20 2023 5365 6c65 6374 206f  .....  #Select o
-00021460: 6666 2063 6f6d 6d6f 6e20 6261 6e64 7320  ff common bands 
-00021470: 6265 7477 6565 6e20 4c61 6e64 7361 7420  between Landsat 
-00021480: 616e 6420 5365 6e74 696e 656c 2032 0d0a  and Sentinel 2..
-00021490: 2020 636f 6d6d 6f6e 4261 6e64 7320 3d20    commonBands = 
-000214a0: 205b 2762 6c75 6527 2c20 2767 7265 656e   ['blue', 'green
-000214b0: 272c 2027 7265 6427 2c20 276e 6972 272c  ', 'red', 'nir',
-000214c0: 2027 7377 6972 3127 2c20 2773 7769 7232   'swir1', 'swir2
-000214d0: 272c 2027 7365 6e73 6f72 275d 0d0a 2020  ', 'sensor']..  
-000214e0: 6c73 203d 206c 732e 7365 6c65 6374 2863  ls = ls.select(c
-000214f0: 6f6d 6d6f 6e42 616e 6473 290d 0a20 2073  ommonBands)..  s
-00021500: 3273 203d 2073 3273 2e73 656c 6563 7428  2s = s2s.select(
-00021510: 636f 6d6d 6f6e 4261 6e64 7329 0d0a 2020  commonBands)..  
-00021520: 2346 696c 6c20 696e 2061 6e79 2065 6d70  #Fill in any emp
-00021530: 7479 2063 6f6c 6c65 6374 696f 6e73 0d0a  ty collections..
-00021540: 2020 2349 6620 7468 6579 2772 6520 626f    #If they're bo
-00021550: 7468 2065 6d70 7479 2c20 7468 6973 2077  th empty, this w
-00021560: 696c 6c20 6e6f 7420 776f 726b 0d0a 2020  ill not work..  
-00021570: 6475 6d6d 7949 6d61 6765 203d 6565 2e49  dummyImage =ee.I
-00021580: 6d61 6765 2865 652e 496d 6167 6543 6f6c  mage(ee.ImageCol
-00021590: 6c65 6374 696f 6e28 6565 2e41 6c67 6f72  lection(ee.Algor
-000215a0: 6974 686d 732e 4966 286c 732e 746f 4c69  ithms.If(ls.toLi
-000215b0: 7374 2831 292e 6c65 6e67 7468 2829 2e67  st(1).length().g
-000215c0: 7428 3029 2c6c 732c 7332 7329 292e 6669  t(0),ls,s2s)).fi
-000215d0: 7273 7428 2929 0d0a 2020 6c73 203d 2066  rst())..  ls = f
-000215e0: 696c 6c45 6d70 7479 436f 6c6c 6563 7469  illEmptyCollecti
-000215f0: 6f6e 7328 6c73 2c64 756d 6d79 496d 6167  ons(ls,dummyImag
-00021600: 6529 0d0a 2020 7332 7320 3d20 6669 6c6c  e)..  s2s = fill
-00021610: 456d 7074 7943 6f6c 6c65 6374 696f 6e73  EmptyCollections
-00021620: 2873 3273 2c64 756d 6d79 496d 6167 6529  (s2s,dummyImage)
-00021630: 0d0a 0d0a 0d0a 2020 6966 2072 756e 4368  ......  if runCh
-00021640: 6173 7461 696e 4861 726d 6f6e 697a 6174  astainHarmonizat
-00021650: 696f 6e20 616e 6420 746f 614f 7253 5220  ion and toaOrSR 
-00021660: 3d3d 2027 544f 4127 3a0d 0a0d 0a20 2020  == 'TOA':....   
-00021670: 2023 2053 6570 6172 6174 6520 6561 6368   # Separate each
-00021680: 2073 656e 736f 720d 0a0d 0a20 2020 2074   sensor....    t
-00021690: 6d20 3d20 6c73 2e66 696c 7465 7228 6565  m = ls.filter(ee
-000216a0: 2e46 696c 7465 722e 696e 4c69 7374 2827  .Filter.inList('
-000216b0: 5345 4e53 4f52 5f49 4427 2c5b 2754 4d27  SENSOR_ID',['TM'
-000216c0: 2c27 4554 4d27 5d29 290d 0a20 2020 206f  ,'ETM']))..    o
-000216d0: 6c69 203d 206c 732e 6669 6c74 6572 2865  li = ls.filter(e
-000216e0: 652e 4669 6c74 6572 2e65 7128 2753 454e  e.Filter.eq('SEN
-000216f0: 534f 525f 4944 272c 274f 4c49 5f54 4952  SOR_ID','OLI_TIR
-00021700: 5327 2929 0d0a 2020 2020 2320 656c 7365  S'))..    # else
-00021710: 3a0d 0a20 2020 2023 2020 2074 6d20 3d20  :..    #   tm = 
-00021720: 6c73 2e66 696c 7465 7228 6565 2e46 696c  ls.filter(ee.Fil
-00021730: 7465 722e 696e 4c69 7374 2827 7365 6e73  ter.inList('sens
-00021740: 6f72 272c 5b27 4c41 4e44 5341 545f 3427  or',['LANDSAT_4'
-00021750: 2c27 4c41 4e44 5341 545f 3527 2c27 4c41  ,'LANDSAT_5','LA
-00021760: 4e44 5341 545f 3727 5d29 290d 0a20 2020  NDSAT_7']))..   
-00021770: 2023 2020 206f 6c69 203d 206c 732e 6669   #   oli = ls.fi
-00021780: 6c74 6572 2865 652e 4669 6c74 6572 2e65  lter(ee.Filter.e
-00021790: 7128 2773 656e 736f 7227 2c27 4c41 4e44  q('sensor','LAND
-000217a0: 5341 545f 3827 2929 0d0a 2020 2020 6d73  SAT_8'))..    ms
-000217b0: 6920 3d20 7332 730d 0a0d 0a20 2020 2023  i = s2s....    #
-000217c0: 2046 696c 6c20 6966 206e 6f20 696d 6167   Fill if no imag
-000217d0: 6573 2065 7869 7374 2066 6f72 2070 6172  es exist for par
-000217e0: 7469 6375 6c61 7220 4c61 6e64 7361 7420  ticular Landsat 
-000217f0: 7365 6e73 6f72 0d0a 2020 2020 2320 416c  sensor..    # Al
-00021800: 6c6f 7720 6974 2074 6f20 6661 696c 206f  low it to fail o
-00021810: 6620 6e6f 2069 6d61 6765 7320 6578 6973  f no images exis
-00021820: 7420 666f 7220 5365 6e74 696e 656c 2032  t for Sentinel 2
-00021830: 2073 696e 6365 2074 6865 2070 6f69 6e74   since the point
-00021840: 0d0a 2020 2020 2320 6f66 2074 6869 7320  ..    # of this 
-00021850: 6d65 7468 6f64 2069 7320 746f 2069 6e63  method is to inc
-00021860: 6c75 6465 2053 320d 0a20 2020 2074 6d20  lude S2..    tm 
-00021870: 3d20 6669 6c6c 456d 7074 7943 6f6c 6c65  = fillEmptyColle
-00021880: 6374 696f 6e73 2874 6d2c 2065 652e 496d  ctions(tm, ee.Im
-00021890: 6167 6528 6c73 2e66 6972 7374 2829 2929  age(ls.first()))
-000218a0: 0d0a 2020 2020 6f6c 6920 3d20 6669 6c6c  ..    oli = fill
-000218b0: 456d 7074 7943 6f6c 6c65 6374 696f 6e73  EmptyCollections
-000218c0: 286f 6c69 2c20 6565 2e49 6d61 6765 286c  (oli, ee.Image(l
-000218d0: 732e 6669 7273 7428 2929 290d 0a0d 0a20  s.first())).... 
-000218e0: 2020 2070 7269 6e74 2827 5275 6e6e 696e     print('Runnin
-000218f0: 6720 4368 6173 7461 696e 2065 7420 616c  g Chastain et al
-00021900: 2032 3031 3920 6861 726d 6f6e 697a 6174   2019 harmonizat
-00021910: 696f 6e27 290d 0a0d 0a20 2020 2023 4170  ion')....    #Ap
-00021920: 706c 7920 636f 7272 6563 7469 6f6e 0d0a  ply correction..
-00021930: 2020 2020 2343 7572 7265 6e74 6c79 2063      #Currently c
-00021940: 6f64 6564 2074 6f20 676f 2074 6f20 4554  oded to go to ET
-00021950: 4d2b 0d0a 0d0a 2020 2020 234e 6f20 6e65  M+....    #No ne
-00021960: 6564 2074 6f20 636f 7272 6563 7420 4554  ed to correct ET
-00021970: 4d20 746f 2045 544d 0d0a 2020 2020 2320  M to ETM..    # 
-00021980: 746d 203d 2074 6d2e 6d61 7028 6675 6e63  tm = tm.map(func
-00021990: 7469 6f6e 2869 6d67 297b 7265 7475 726e  tion(img){return
-000219a0: 2067 6574 496d 6167 6573 4c69 622e 6861   getImagesLib.ha
-000219b0: 726d 6f6e 697a 6174 696f 6e43 6861 7374  rmonizationChast
-000219c0: 6169 6e28 696d 672c 2027 4554 4d27 2c27  ain(img, 'ETM','
-000219d0: 4554 4d27 297d 290d 0a20 2020 2023 2065  ETM')})..    # e
-000219e0: 746d 203d 2065 746d 2e6d 6170 2866 756e  tm = etm.map(fun
-000219f0: 6374 696f 6e28 696d 6729 7b72 6574 7572  ction(img){retur
-00021a00: 6e20 6765 7449 6d61 6765 734c 6962 2e68  n getImagesLib.h
-00021a10: 6172 6d6f 6e69 7a61 7469 6f6e 4368 6173  armonizationChas
-00021a20: 7461 696e 2869 6d67 2c20 2745 544d 272c  tain(img, 'ETM',
-00021a30: 2745 544d 2729 7d29 0d0a 0d0a 2020 2020  'ETM')})....    
-00021a40: 2348 6172 6d6f 6e69 7a65 2074 6865 206f  #Harmonize the o
-00021a50: 7468 6572 2074 776f 0d0a 2020 2020 6f6c  ther two..    ol
-00021a60: 6920 3d20 6f6c 692e 6d61 7028 6c61 6d62  i = oli.map(lamb
-00021a70: 6461 2069 6d67 3a20 6861 726d 6f6e 697a  da img: harmoniz
-00021a80: 6174 696f 6e43 6861 7374 6169 6e28 696d  ationChastain(im
-00021a90: 672c 2027 4f4c 4927 2c27 4554 4d27 2929  g, 'OLI','ETM'))
-00021aa0: 0d0a 2020 2020 6d73 6920 3d20 6d73 692e  ..    msi = msi.
-00021ab0: 6d61 7028 6c61 6d62 6461 2069 6d67 3a20  map(lambda img: 
-00021ac0: 6861 726d 6f6e 697a 6174 696f 6e43 6861  harmonizationCha
-00021ad0: 7374 6169 6e28 696d 672c 2027 4d53 4927  stain(img, 'MSI'
-00021ae0: 2c27 4554 4d27 2929 0d0a 0d0a 2020 2020  ,'ETM'))....    
-00021af0: 7332 7320 3d20 6d73 690d 0a0d 0a20 2020  s2s = msi....   
-00021b00: 2023 4d65 7267 6520 4c61 6e64 7361 7420   #Merge Landsat 
-00021b10: 6261 636b 2074 6f67 6574 6865 720d 0a20  back together.. 
-00021b20: 2020 206c 7320 3d20 6565 2e49 6d61 6765     ls = ee.Image
-00021b30: 436f 6c6c 6563 7469 6f6e 2874 6d2e 6d65  Collection(tm.me
-00021b40: 7267 6528 6f6c 6929 290d 0a0d 0a0d 0a20  rge(oli))...... 
-00021b50: 2023 204d 6572 6765 204c 616e 6473 6174   # Merge Landsat
-00021b60: 2061 6e64 2053 320d 0a20 206d 6572 6765   and S2..  merge
-00021b70: 6420 3d20 6565 2e49 6d61 6765 436f 6c6c  d = ee.ImageColl
-00021b80: 6563 7469 6f6e 286c 732e 6d65 7267 6528  ection(ls.merge(
-00021b90: 7332 7329 290d 0a20 206d 6572 6765 6420  s2s))..  merged 
-00021ba0: 3d20 6d65 7267 6564 2e6d 6170 2873 696d  = merged.map(sim
-00021bb0: 706c 6541 6464 496e 6469 6365 7329 5c0d  pleAddIndices)\.
-00021bc0: 0a20 2020 2020 2020 2020 2020 202e 6d61  .            .ma
-00021bd0: 7028 6765 7454 6173 7365 6c65 6443 6170  p(getTasseledCap
-00021be0: 295c 0d0a 2020 2020 2020 2020 2020 2020  )\..            
-00021bf0: 2e6d 6170 2873 696d 706c 6541 6464 5443  .map(simpleAddTC
-00021c00: 416e 676c 6573 290d 0a0d 0a20 206d 6572  Angles)....  mer
-00021c10: 6765 6420 3d20 6d65 7267 6564 2e73 6574  ged = merged.set
-00021c20: 2861 7267 7329 0d0a 0d0a 0d0a 2020 7265  (args)......  re
-00021c30: 7475 726e 206d 6572 6765 640d 0a23 2323  turn merged..###
-00021c40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00021c50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00021c60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00021c70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00021c80: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
-00021c90: 2346 756e 6374 696f 6e20 746f 2072 6567  #Function to reg
-00021ca0: 6973 7465 7220 616e 2069 6d61 6765 436f  ister an imageCo
-00021cb0: 6c6c 6563 7469 6f6e 2074 6f20 696d 6167  llection to imag
-00021cc0: 6573 2077 6974 6869 6e20 6974 0d0a 2341  es within it..#A
-00021cd0: 6c77 6179 7320 7573 6573 2074 6865 2066  lways uses the f
-00021ce0: 6972 7374 2069 6d61 6765 2061 7320 7468  irst image as th
-00021cf0: 6520 7265 6665 7265 6e63 6520 696d 6167  e reference imag
-00021d00: 650d 0a64 6566 2063 6f52 6567 6973 7465  e..def coRegiste
-00021d10: 7243 6f6c 6c65 6374 696f 6e28 696d 6167  rCollection(imag
-00021d20: 6573 2c72 6566 6572 656e 6365 4261 6e64  es,referenceBand
-00021d30: 7320 3d20 5b27 6e69 7227 5d29 3a0d 0a20  s = ['nir']):.. 
-00021d40: 2020 2072 6566 6572 656e 6365 496d 6167     referenceImag
-00021d50: 6549 6e64 6578 203d 2030 0d0a 2020 2020  eIndex = 0..    
-00021d60: 7265 6665 7265 6e63 6549 6d61 6765 203d  referenceImage =
-00021d70: 2065 652e 496d 6167 6528 696d 6167 6573   ee.Image(images
-00021d80: 2e74 6f4c 6973 7428 7265 6665 7265 6e63  .toList(referenc
-00021d90: 6549 6d61 6765 496e 6465 782b 3129 2e67  eImageIndex+1).g
-00021da0: 6574 2872 6566 6572 656e 6365 496d 6167  et(referenceImag
-00021db0: 6549 6e64 6578 2929 2e73 656c 6563 7428  eIndex)).select(
-00021dc0: 7265 6665 7265 6e63 6542 616e 6473 290d  referenceBands).
-00021dd0: 0a0d 0a20 2020 2064 6566 2072 6567 6973  ...    def regis
-00021de0: 7465 7249 6d61 6765 2869 6d61 6765 293a  terImage(image):
-00021df0: 0d0a 2020 2020 2020 2020 2344 6574 6572  ..        #Deter
-00021e00: 6d69 6e65 2074 6865 2064 6973 706c 6163  mine the displac
-00021e10: 656d 656e 7420 6279 206d 6174 6368 696e  ement by matchin
-00021e20: 6720 6f6e 6c79 2074 6865 2072 6566 6572  g only the refer
-00021e30: 656e 6365 4261 6e64 2062 616e 6473 2e0d  enceBand bands..
-00021e40: 0a20 2020 2020 2020 2064 6973 706c 6163  .        displac
-00021e50: 656d 656e 745f 7061 7261 6d73 203d 207b  ement_params = {
-00021e60: 0d0a 2020 2020 2020 2020 2020 2020 2772  ..            'r
-00021e70: 6566 6572 656e 6365 496d 6167 6527 3a20  eferenceImage': 
-00021e80: 7265 6665 7265 6e63 6549 6d61 6765 2c0d  referenceImage,.
-00021e90: 0a20 2020 2020 2020 2020 2020 2027 6d61  .            'ma
-00021ea0: 784f 6666 7365 7427 3a20 3230 2e30 2c0d  xOffset': 20.0,.
-00021eb0: 0a20 2020 2020 2020 2020 2020 2027 7072  .            'pr
-00021ec0: 6f6a 6563 7469 6f6e 273a 204e 6f6e 652c  ojection': None,
-00021ed0: 0d0a 2020 2020 2020 2020 2020 2020 2770  ..            'p
-00021ee0: 6174 6368 5769 6474 6827 3a20 3230 2e30  atchWidth': 20.0
-00021ef0: 2c0d 0a20 2020 2020 2020 2020 2020 2027  ,..            '
-00021f00: 7374 6966 666e 6573 7327 3a20 350d 0a20  stiffness': 5.. 
-00021f10: 2020 2020 2020 2020 2020 207d 0d0a 2020             }..  
-00021f20: 2020 2020 2020 6469 7370 6c61 6365 6d65        displaceme
-00021f30: 6e74 203d 2069 6d61 6765 2e73 656c 6563  nt = image.selec
-00021f40: 7428 7265 6665 7265 6e63 6542 616e 6473  t(referenceBands
-00021f50: 292e 6469 7370 6c61 6365 6d65 6e74 282a  ).displacement(*
-00021f60: 2a64 6973 706c 6163 656d 656e 745f 7061  *displacement_pa
-00021f70: 7261 6d73 290d 0a20 2020 2020 2020 2072  rams)..        r
-00021f80: 6574 7572 6e20 696d 6167 652e 6469 7370  eturn image.disp
-00021f90: 6c61 6365 2864 6973 706c 6163 656d 656e  lace(displacemen
-00021fa0: 7429 0d0a 0d0a 2020 2020 6f75 7420 3d20  t)....    out = 
-00021fb0: 6565 2e49 6d61 6765 436f 6c6c 6563 7469  ee.ImageCollecti
-00021fc0: 6f6e 2865 652e 496d 6167 6543 6f6c 6c65  on(ee.ImageColle
-00021fd0: 6374 696f 6e28 696d 6167 6573 2e74 6f4c  ction(images.toL
-00021fe0: 6973 7428 3130 3030 302c 3129 292e 6d61  ist(10000,1)).ma
-00021ff0: 7028 7265 6769 7374 6572 496d 6167 6529  p(registerImage)
-00022000: 2923 2865 652e 496d 6167 6528 696d 6167  )#(ee.Image(imag
-00022010: 6573 2e74 6f4c 6973 7428 3130 3030 302c  es.toList(10000,
-00022020: 3029 2e67 6574 2831 2929 2c72 6566 6572  0).get(1)),refer
-00022030: 656e 6365 496d 6167 6529 0d0a 2020 2020  enceImage)..    
-00022040: 6f75 7420 3d20 6565 2e49 6d61 6765 436f  out = ee.ImageCo
-00022050: 6c6c 6563 7469 6f6e 2869 6d61 6765 732e  llection(images.
-00022060: 6c69 6d69 7428 3129 2e6d 6572 6765 286f  limit(1).merge(o
-00022070: 7574 2929 0d0a 0d0a 2020 2020 7265 7475  ut))....    retu
-00022080: 726e 206f 7574 0d0a 2323 2323 2323 2323  rn out..########
-00022090: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000220a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000220b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000220c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000220d0: 2323 2323 2323 2323 230d 0a23 4675 6e63  #########..#Func
-000220e0: 7469 6f6e 2074 6f20 6669 6e64 2061 2073  tion to find a s
-000220f0: 7562 7365 7420 6f66 2061 2063 6f6c 6c65  ubset of a colle
-00022100: 6374 696f 6e0d 0a23 466f 7220 6561 6368  ction..#For each
-00022110: 2067 726f 7570 2028 652e 672e 2074 696c   group (e.g. til
-00022120: 6520 6f72 206f 7262 6974 206f 7220 7061  e or orbit or pa
-00022130: 7468 292c 2061 6c6c 2069 6d61 6765 7320  th), all images 
-00022140: 7769 7468 696e 2074 6861 7420 6772 6f75  within that grou
-00022150: 7020 7769 6c6c 2062 6520 7265 6769 7374  p will be regist
-00022160: 6572 6564 0d0a 2341 7320 7369 6e67 6c65  ered..#As single
-00022170: 2063 6f6c 6c65 6374 696f 6e20 6973 2072   collection is r
-00022180: 6574 7572 6e65 640d 0a64 6566 2063 6f52  eturned..def coR
-00022190: 6567 6973 7465 7247 726f 7570 7328 696d  egisterGroups(im
-000221a0: 6773 2c66 6965 6c64 4e61 6d65 203d 2027  gs,fieldName = '
-000221b0: 5345 4e53 494e 475f 4f52 4249 545f 4e55  SENSING_ORBIT_NU
-000221c0: 4d42 4552 272c 6669 656c 6449 734e 756d  MBER',fieldIsNum
-000221d0: 6572 6963 203d 2054 7275 6529 3a0d 0a20  eric = True):.. 
-000221e0: 2020 2067 726f 7570 7320 3d20 6565 2e44     groups = ee.D
-000221f0: 6963 7469 6f6e 6172 7928 696d 6773 2e61  ictionary(imgs.a
-00022200: 6767 7265 6761 7465 5f68 6973 746f 6772  ggregate_histogr
-00022210: 616d 2866 6965 6c64 4e61 6d65 2929 2e6b  am(fieldName)).k
-00022220: 6579 7328 290d 0a20 2020 2069 6620 6669  eys()..    if fi
-00022230: 656c 6449 734e 756d 6572 6963 3a0d 0a20  eldIsNumeric:.. 
-00022240: 2020 2020 2020 2067 726f 7570 7320 3d20         groups = 
-00022250: 6772 6f75 7073 2e6d 6170 286c 616d 6264  groups.map(lambd
-00022260: 6120 6e3a 2065 652e 4e75 6d62 6572 2e70  a n: ee.Number.p
-00022270: 6172 7365 286e 2929 0d0a 0d0a 2020 2020  arse(n))....    
-00022280: 6f75 7420 3d65 652e 496d 6167 6543 6f6c  out =ee.ImageCol
-00022290: 6c65 6374 696f 6e28 6565 2e46 6561 7475  lection(ee.Featu
-000222a0: 7265 436f 6c6c 6563 7469 6f6e 2867 726f  reCollection(gro
-000222b0: 7570 732e 6d61 7028 6c61 6d62 6461 2067  ups.map(lambda g
-000222c0: 726f 7570 3a63 6f52 6567 6973 7465 7243  roup:coRegisterC
-000222d0: 6f6c 6c65 6374 696f 6e28 696d 6773 2e66  ollection(imgs.f
-000222e0: 696c 7465 7228 6565 2e46 696c 7465 722e  ilter(ee.Filter.
-000222f0: 6571 2866 6965 6c64 4e61 6d65 2c67 726f  eq(fieldName,gro
-00022300: 7570 2929 2929 292e 666c 6174 7465 6e28  up))))).flatten(
-00022310: 2929 0d0a 0d0a 2020 2020 7265 7475 726e  ))....    return
-00022320: 206f 7574 0d0a 2323 2323 2323 2323 2323   out..##########
-00022330: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00022340: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00022350: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00022360: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00022370: 2323 2323 2323 230d 0a64 6566 2067 6574  #######..def get
-00022380: 4c61 6e64 7361 7441 6e64 5365 6e74 696e  LandsatAndSentin
-00022390: 656c 3248 7962 7269 6457 7261 7070 6572  el2HybridWrapper
-000223a0: 285c 0d0a 2020 7374 7564 7941 7265 612c  (\..  studyArea,
-000223b0: 0d0a 2020 7374 6172 7459 6561 722c 0d0a  ..  startYear,..
-000223c0: 2020 656e 6459 6561 722c 0d0a 2020 7374    endYear,..  st
-000223d0: 6172 744a 756c 6961 6e2c 0d0a 2020 656e  artJulian,..  en
-000223e0: 644a 756c 6961 6e2c 0d0a 2020 7469 6d65  dJulian,..  time
-000223f0: 6275 6666 6572 203d 2020 302c 0d0a 2020  buffer =  0,..  
-00022400: 7765 6967 6874 7320 3d20 205b 315d 2c0d  weights =  [1],.
-00022410: 0a20 2063 6f6d 706f 7369 7469 6e67 4d65  .  compositingMe
-00022420: 7468 6f64 203d 2027 6d65 646f 6964 272c  thod = 'medoid',
-00022430: 0d0a 2020 746f 614f 7253 5220 3d20 2754  ..  toaOrSR = 'T
-00022440: 4f41 272c 0d0a 2020 696e 636c 7564 6553  OA',..  includeS
-00022450: 4c43 4f66 664c 3720 3d20 4661 6c73 652c  LCOffL7 = False,
-00022460: 0d0a 2020 6465 6672 696e 6765 4c35 203d  ..  defringeL5 =
-00022470: 2046 616c 7365 2c0d 0a20 2061 7070 6c79   False,..  apply
-00022480: 5141 4261 6e64 203d 2046 616c 7365 2c0d  QABand = False,.
-00022490: 0a20 2061 7070 6c79 436c 6f75 6450 726f  .  applyCloudPro
-000224a0: 6261 6269 6c69 7479 203d 2054 7275 652c  bability = True,
-000224b0: 0d0a 2020 6170 706c 7953 6861 646f 7753  ..  applyShadowS
-000224c0: 6869 6674 203d 2046 616c 7365 2c0d 0a20  hift = False,.. 
-000224d0: 2061 7070 6c79 436c 6f75 6453 636f 7265   applyCloudScore
-000224e0: 4c61 6e64 7361 7420 3d20 4661 6c73 652c  Landsat = False,
-000224f0: 0d0a 2020 6170 706c 7943 6c6f 7564 5363  ..  applyCloudSc
-00022500: 6f72 6553 656e 7469 6e65 6c32 203d 2046  oreSentinel2 = F
-00022510: 616c 7365 2c0d 0a20 2061 7070 6c79 5444  alse,..  applyTD
-00022520: 4f4d 4c61 6e64 7361 7420 3d20 5472 7565  OMLandsat = True
-00022530: 2c0d 0a20 2061 7070 6c79 5444 4f4d 5365  ,..  applyTDOMSe
-00022540: 6e74 696e 656c 3220 3d20 5472 7565 2c0d  ntinel2 = True,.
-00022550: 0a20 2061 7070 6c79 466d 6173 6b43 6c6f  .  applyFmaskClo
-00022560: 7564 4d61 736b 203d 2054 7275 652c 0d0a  udMask = True,..
-00022570: 2020 6170 706c 7946 6d61 736b 436c 6f75    applyFmaskClou
-00022580: 6453 6861 646f 774d 6173 6b20 3d20 5472  dShadowMask = Tr
-00022590: 7565 2c0d 0a20 2061 7070 6c79 466d 6173  ue,..  applyFmas
-000225a0: 6b53 6e6f 774d 6173 6b20 3d20 4661 6c73  kSnowMask = Fals
-000225b0: 652c 0d0a 2020 636c 6f75 6448 6569 6768  e,..  cloudHeigh
-000225c0: 7473 203d 2065 652e 4c69 7374 2e73 6571  ts = ee.List.seq
-000225d0: 7565 6e63 6528 3530 302c 3130 3030 302c  uence(500,10000,
-000225e0: 3530 3029 2c0d 0a20 2063 6c6f 7564 5363  500),..  cloudSc
-000225f0: 6f72 6554 6872 6573 6820 3d20 3230 2c0d  oreThresh = 20,.
-00022600: 0a20 2070 6572 666f 726d 436c 6f75 6453  .  performCloudS
-00022610: 636f 7265 4f66 6673 6574 203d 2054 7275  coreOffset = Tru
-00022620: 652c 0d0a 2020 636c 6f75 6453 636f 7265  e,..  cloudScore
-00022630: 5063 746c 203d 2031 302c 0d0a 2020 7a53  Pctl = 10,..  zS
-00022640: 636f 7265 5468 7265 7368 203d 202d 312c  coreThresh = -1,
-00022650: 0d0a 2020 7368 6164 6f77 5375 6d54 6872  ..  shadowSumThr
-00022660: 6573 6820 3d20 302e 3335 2c0d 0a20 2063  esh = 0.35,..  c
-00022670: 6f6e 7472 6163 7450 6978 656c 7320 3d20  ontractPixels = 
-00022680: 312e 352c 0d0a 2020 6469 6c61 7465 5069  1.5,..  dilatePi
-00022690: 7865 6c73 203d 2033 2e35 2c0d 0a20 2073  xels = 3.5,..  s
-000226a0: 6861 646f 7753 756d 4261 6e64 7320 3d20  hadowSumBands = 
-000226b0: 5b27 6e69 7227 2c27 7377 6972 3127 5d2c  ['nir','swir1'],
-000226c0: 0d0a 2020 6c61 6e64 7361 7452 6573 616d  ..  landsatResam
-000226d0: 706c 654d 6574 686f 6420 3d20 276e 6561  pleMethod = 'nea
-000226e0: 7227 2c0d 0a20 2073 656e 7469 6e65 6c32  r',..  sentinel2
-000226f0: 5265 7361 6d70 6c65 4d65 7468 6f64 203d  ResampleMethod =
-00022700: 2027 6167 6772 6567 6174 6527 2c0d 0a20   'aggregate',.. 
-00022710: 2063 6f6e 7665 7274 546f 4461 696c 794d   convertToDailyM
-00022720: 6f73 6169 6373 203d 2054 7275 652c 0d0a  osaics = True,..
-00022730: 2020 7275 6e43 6861 7374 6169 6e48 6172    runChastainHar
-00022740: 6d6f 6e69 7a61 7469 6f6e 203d 2054 7275  monization = Tru
-00022750: 652c 0d0a 2020 636f 7272 6563 7449 6c6c  e,..  correctIll
-00022760: 756d 696e 6174 696f 6e20 3d20 4661 6c73  umination = Fals
-00022770: 652c 0d0a 2020 636f 7272 6563 7453 6361  e,..  correctSca
-00022780: 6c65 203d 2032 3530 2c0d 0a20 2065 7870  le = 250,..  exp
-00022790: 6f72 7443 6f6d 706f 7369 7465 7320 3d20  ortComposites = 
-000227a0: 4661 6c73 652c 0d0a 2020 6f75 7470 7574  False,..  output
-000227b0: 4e61 6d65 203d 2027 4c61 6e64 7361 742d  Name = 'Landsat-
-000227c0: 5365 6e74 696e 656c 322d 4879 6272 6964  Sentinel2-Hybrid
-000227d0: 272c 0d0a 2020 6578 706f 7274 5061 7468  ',..  exportPath
-000227e0: 526f 6f74 203d 204e 6f6e 652c 0d0a 2020  Root = None,..  
-000227f0: 6372 7320 3d20 2745 5053 473a 3530 3730  crs = 'EPSG:5070
-00022800: 272c 0d0a 2020 7472 616e 7366 6f72 6d20  ',..  transform 
-00022810: 3d20 5b33 302c 302c 2d32 3336 3139 3135  = [30,0,-2361915
-00022820: 2e30 2c30 2c2d 3330 2c33 3137 3737 3335  .0,0,-30,3177735
-00022830: 2e30 5d2c 0d0a 2020 7363 616c 6520 3d20  .0],..  scale = 
-00022840: 4e6f 6e65 2c0d 0a20 2070 7265 436f 6d70  None,..  preComp
-00022850: 7574 6564 4c61 6e64 7361 7443 6c6f 7564  utedLandsatCloud
-00022860: 5363 6f72 654f 6666 7365 7420 3d20 4e6f  ScoreOffset = No
-00022870: 6e65 2c0d 0a20 2070 7265 436f 6d70 7574  ne,..  preComput
-00022880: 6564 4c61 6e64 7361 7454 444f 4d49 524d  edLandsatTDOMIRM
-00022890: 6561 6e20 3d20 4e6f 6e65 2c0d 0a20 2070  ean = None,..  p
-000228a0: 7265 436f 6d70 7574 6564 4c61 6e64 7361  reComputedLandsa
-000228b0: 7454 444f 4d49 5253 7464 4465 7620 3d20  tTDOMIRStdDev = 
-000228c0: 4e6f 6e65 2c0d 0a20 2070 7265 436f 6d70  None,..  preComp
-000228d0: 7574 6564 5365 6e74 696e 656c 3243 6c6f  utedSentinel2Clo
-000228e0: 7564 5363 6f72 654f 6666 7365 7420 3d20  udScoreOffset = 
-000228f0: 4e6f 6e65 2c0d 0a20 2070 7265 436f 6d70  None,..  preComp
-00022900: 7574 6564 5365 6e74 696e 656c 3254 444f  utedSentinel2TDO
-00022910: 4d49 524d 6561 6e20 3d20 4e6f 6e65 2c0d  MIRMean = None,.
-00022920: 0a20 2070 7265 436f 6d70 7574 6564 5365  .  preComputedSe
-00022930: 6e74 696e 656c 3254 444f 4d49 5253 7464  ntinel2TDOMIRStd
-00022940: 4465 7620 3d20 4e6f 6e65 2c0d 0a20 2063  Dev = None,..  c
-00022950: 6c6f 7564 5072 6f62 5468 7265 7368 203d  loudProbThresh =
-00022960: 2034 302c 0d0a 2020 6c61 6e64 7361 7443   40,..  landsatC
-00022970: 6f6c 6c65 6374 696f 6e56 6572 7369 6f6e  ollectionVersion
-00022980: 203d 2027 4332 2729 3a0d 0a0d 0a20 206f   = 'C2'):....  o
-00022990: 7269 6769 6e20 3d20 274c 616e 6473 6174  rigin = 'Landsat
-000229a0: 2d53 656e 7469 6e65 6c32 2d48 7962 7269  -Sentinel2-Hybri
-000229b0: 6427 0d0a 2020 746f 614f 7253 5220 3d20  d'..  toaOrSR = 
-000229c0: 746f 614f 7253 522e 7570 7065 7228 290d  toaOrSR.upper().
-000229d0: 0a0d 0a20 2061 7267 7320 3d20 666f 726d  ...  args = form
-000229e0: 6174 4172 6773 286c 6f63 616c 7328 2929  atArgs(locals())
-000229f0: 0d0a 2020 6966 2027 6172 6773 2720 696e  ..  if 'args' in
-00022a00: 2061 7267 732e 6b65 7973 2829 3a0d 0a20   args.keys():.. 
-00022a10: 2020 2064 656c 2061 7267 735b 2761 7267     del args['arg
-00022a20: 7327 5d0d 0a0d 0a20 206d 6572 6765 6420  s']....  merged 
-00022a30: 3d20 6765 7450 726f 6365 7373 6564 4c61  = getProcessedLa
-00022a40: 6e64 7361 7441 6e64 5365 6e74 696e 656c  ndsatAndSentinel
-00022a50: 3253 6365 6e65 7328 5c0d 0a20 2020 2073  2Scenes(\..    s
-00022a60: 7475 6479 4172 6561 203d 2073 7475 6479  tudyArea = study
-00022a70: 4172 6561 2c0d 0a20 2020 2073 7461 7274  Area,..    start
-00022a80: 5965 6172 203d 2073 7461 7274 5965 6172  Year = startYear
-00022a90: 2c0d 0a20 2020 2065 6e64 5965 6172 203d  ,..    endYear =
-00022aa0: 2065 6e64 5965 6172 2c0d 0a20 2020 2073   endYear,..    s
-00022ab0: 7461 7274 4a75 6c69 616e 203d 2073 7461  tartJulian = sta
-00022ac0: 7274 4a75 6c69 616e 2c0d 0a20 2020 2065  rtJulian,..    e
-00022ad0: 6e64 4a75 6c69 616e 203d 2065 6e64 4a75  ndJulian = endJu
-00022ae0: 6c69 616e 2c0d 0a20 2020 2074 6f61 4f72  lian,..    toaOr
-00022af0: 5352 203d 2074 6f61 4f72 5352 2c0d 0a20  SR = toaOrSR,.. 
-00022b00: 2020 2069 6e63 6c75 6465 534c 434f 6666     includeSLCOff
-00022b10: 4c37 203d 2069 6e63 6c75 6465 534c 434f  L7 = includeSLCO
-00022b20: 6666 4c37 2c0d 0a20 2020 2064 6566 7269  ffL7,..    defri
-00022b30: 6e67 654c 3520 3d20 6465 6672 696e 6765  ngeL5 = defringe
-00022b40: 4c35 2c0d 0a20 2020 2061 7070 6c79 5141  L5,..    applyQA
-00022b50: 4261 6e64 203d 2061 7070 6c79 5141 4261  Band = applyQABa
-00022b60: 6e64 2c0d 0a20 2020 2061 7070 6c79 436c  nd,..    applyCl
-00022b70: 6f75 6450 726f 6261 6269 6c69 7479 203d  oudProbability =
-00022b80: 2061 7070 6c79 436c 6f75 6450 726f 6261   applyCloudProba
-00022b90: 6269 6c69 7479 2c0d 0a20 2020 2061 7070  bility,..    app
-00022ba0: 6c79 5368 6164 6f77 5368 6966 7420 3d20  lyShadowShift = 
-00022bb0: 6170 706c 7953 6861 646f 7753 6869 6674  applyShadowShift
-00022bc0: 2c0d 0a20 2020 2061 7070 6c79 436c 6f75  ,..    applyClou
-00022bd0: 6453 636f 7265 4c61 6e64 7361 7420 3d20  dScoreLandsat = 
-00022be0: 6170 706c 7943 6c6f 7564 5363 6f72 654c  applyCloudScoreL
-00022bf0: 616e 6473 6174 2c0d 0a20 2020 2061 7070  andsat,..    app
-00022c00: 6c79 436c 6f75 6453 636f 7265 5365 6e74  lyCloudScoreSent
-00022c10: 696e 656c 3220 3d20 6170 706c 7943 6c6f  inel2 = applyClo
-00022c20: 7564 5363 6f72 6553 656e 7469 6e65 6c32  udScoreSentinel2
-00022c30: 2c0d 0a20 2020 2061 7070 6c79 5444 4f4d  ,..    applyTDOM
-00022c40: 4c61 6e64 7361 7420 3d20 6170 706c 7954  Landsat = applyT
-00022c50: 444f 4d4c 616e 6473 6174 2c0d 0a20 2020  DOMLandsat,..   
-00022c60: 2061 7070 6c79 5444 4f4d 5365 6e74 696e   applyTDOMSentin
-00022c70: 656c 3220 3d20 6170 706c 7954 444f 4d53  el2 = applyTDOMS
-00022c80: 656e 7469 6e65 6c32 2c0d 0a20 2020 2061  entinel2,..    a
-00022c90: 7070 6c79 466d 6173 6b43 6c6f 7564 4d61  pplyFmaskCloudMa
-00022ca0: 736b 203d 2061 7070 6c79 466d 6173 6b43  sk = applyFmaskC
-00022cb0: 6c6f 7564 4d61 736b 2c0d 0a20 2020 2061  loudMask,..    a
-00022cc0: 7070 6c79 466d 6173 6b43 6c6f 7564 5368  pplyFmaskCloudSh
-00022cd0: 6164 6f77 4d61 736b 203d 2061 7070 6c79  adowMask = apply
-00022ce0: 466d 6173 6b43 6c6f 7564 5368 6164 6f77  FmaskCloudShadow
-00022cf0: 4d61 736b 2c0d 0a20 2020 2061 7070 6c79  Mask,..    apply
-00022d00: 466d 6173 6b53 6e6f 774d 6173 6b20 3d20  FmaskSnowMask = 
-00022d10: 6170 706c 7946 6d61 736b 536e 6f77 4d61  applyFmaskSnowMa
-00022d20: 736b 2c0d 0a20 2020 2063 6c6f 7564 4865  sk,..    cloudHe
-00022d30: 6967 6874 7320 3d20 636c 6f75 6448 6569  ights = cloudHei
-00022d40: 6768 7473 2c0d 0a20 2020 2063 6c6f 7564  ghts,..    cloud
-00022d50: 5363 6f72 6554 6872 6573 6820 3d20 636c  ScoreThresh = cl
-00022d60: 6f75 6453 636f 7265 5468 7265 7368 2c0d  oudScoreThresh,.
-00022d70: 0a20 2020 2070 6572 666f 726d 436c 6f75  .    performClou
-00022d80: 6453 636f 7265 4f66 6673 6574 203d 2070  dScoreOffset = p
-00022d90: 6572 666f 726d 436c 6f75 6453 636f 7265  erformCloudScore
-00022da0: 4f66 6673 6574 2c0d 0a20 2020 2063 6c6f  Offset,..    clo
-00022db0: 7564 5363 6f72 6550 6374 6c20 3d20 636c  udScorePctl = cl
-00022dc0: 6f75 6453 636f 7265 5063 746c 2c0d 0a20  oudScorePctl,.. 
-00022dd0: 2020 207a 5363 6f72 6554 6872 6573 6820     zScoreThresh 
-00022de0: 3d20 7a53 636f 7265 5468 7265 7368 2c0d  = zScoreThresh,.
-00022df0: 0a20 2020 2073 6861 646f 7753 756d 5468  .    shadowSumTh
-00022e00: 7265 7368 203d 2073 6861 646f 7753 756d  resh = shadowSum
-00022e10: 5468 7265 7368 2c0d 0a20 2020 2063 6f6e  Thresh,..    con
-00022e20: 7472 6163 7450 6978 656c 7320 3d20 636f  tractPixels = co
-00022e30: 6e74 7261 6374 5069 7865 6c73 2c0d 0a20  ntractPixels,.. 
-00022e40: 2020 2064 696c 6174 6550 6978 656c 7320     dilatePixels 
-00022e50: 3d20 6469 6c61 7465 5069 7865 6c73 2c0d  = dilatePixels,.
-00022e60: 0a20 2020 2073 6861 646f 7753 756d 4261  .    shadowSumBa
-00022e70: 6e64 7320 3d20 7368 6164 6f77 5375 6d42  nds = shadowSumB
-00022e80: 616e 6473 2c0d 0a20 2020 206c 616e 6473  ands,..    lands
-00022e90: 6174 5265 7361 6d70 6c65 4d65 7468 6f64  atResampleMethod
-00022ea0: 203d 206c 616e 6473 6174 5265 7361 6d70   = landsatResamp
-00022eb0: 6c65 4d65 7468 6f64 2c0d 0a20 2020 2073  leMethod,..    s
-00022ec0: 656e 7469 6e65 6c32 5265 7361 6d70 6c65  entinel2Resample
-00022ed0: 4d65 7468 6f64 203d 2073 656e 7469 6e65  Method = sentine
-00022ee0: 6c32 5265 7361 6d70 6c65 4d65 7468 6f64  l2ResampleMethod
-00022ef0: 2c0d 0a20 2020 2063 6f6e 7665 7274 546f  ,..    convertTo
-00022f00: 4461 696c 794d 6f73 6169 6373 203d 2063  DailyMosaics = c
-00022f10: 6f6e 7665 7274 546f 4461 696c 794d 6f73  onvertToDailyMos
-00022f20: 6169 6373 2c0d 0a20 2020 2072 756e 4368  aics,..    runCh
-00022f30: 6173 7461 696e 4861 726d 6f6e 697a 6174  astainHarmonizat
-00022f40: 696f 6e20 3d20 7275 6e43 6861 7374 6169  ion = runChastai
-00022f50: 6e48 6172 6d6f 6e69 7a61 7469 6f6e 2c0d  nHarmonization,.
-00022f60: 0a20 2020 2063 6f72 7265 6374 496c 6c75  .    correctIllu
-00022f70: 6d69 6e61 7469 6f6e 203d 2063 6f72 7265  mination = corre
-00022f80: 6374 496c 6c75 6d69 6e61 7469 6f6e 2c0d  ctIllumination,.
-00022f90: 0a20 2020 2063 6f72 7265 6374 5363 616c  .    correctScal
-00022fa0: 6520 3d20 636f 7272 6563 7453 6361 6c65  e = correctScale
-00022fb0: 2c0d 0a20 2020 2070 7265 436f 6d70 7574  ,..    preComput
-00022fc0: 6564 4c61 6e64 7361 7443 6c6f 7564 5363  edLandsatCloudSc
-00022fd0: 6f72 654f 6666 7365 7420 3d20 7072 6543  oreOffset = preC
-00022fe0: 6f6d 7075 7465 644c 616e 6473 6174 436c  omputedLandsatCl
-00022ff0: 6f75 6453 636f 7265 4f66 6673 6574 2c0d  oudScoreOffset,.
-00023000: 0a20 2020 2070 7265 436f 6d70 7574 6564  .    preComputed
-00023010: 4c61 6e64 7361 7454 444f 4d49 524d 6561  LandsatTDOMIRMea
-00023020: 6e20 3d20 7072 6543 6f6d 7075 7465 644c  n = preComputedL
-00023030: 616e 6473 6174 5444 4f4d 4952 4d65 616e  andsatTDOMIRMean
-00023040: 2c0d 0a20 2020 2070 7265 436f 6d70 7574  ,..    preComput
-00023050: 6564 4c61 6e64 7361 7454 444f 4d49 5253  edLandsatTDOMIRS
-00023060: 7464 4465 7620 3d20 7072 6543 6f6d 7075  tdDev = preCompu
-00023070: 7465 644c 616e 6473 6174 5444 4f4d 4952  tedLandsatTDOMIR
-00023080: 5374 6444 6576 2c0d 0a20 2020 2070 7265  StdDev,..    pre
-00023090: 436f 6d70 7574 6564 5365 6e74 696e 656c  ComputedSentinel
-000230a0: 3243 6c6f 7564 5363 6f72 654f 6666 7365  2CloudScoreOffse
-000230b0: 7420 3d20 7072 6543 6f6d 7075 7465 6453  t = preComputedS
-000230c0: 656e 7469 6e65 6c32 436c 6f75 6453 636f  entinel2CloudSco
-000230d0: 7265 4f66 6673 6574 2c0d 0a20 2020 2070  reOffset,..    p
-000230e0: 7265 436f 6d70 7574 6564 5365 6e74 696e  reComputedSentin
-000230f0: 656c 3254 444f 4d49 524d 6561 6e20 3d20  el2TDOMIRMean = 
-00023100: 7072 6543 6f6d 7075 7465 6453 656e 7469  preComputedSenti
-00023110: 6e65 6c32 5444 4f4d 4952 4d65 616e 2c0d  nel2TDOMIRMean,.
-00023120: 0a20 2020 2070 7265 436f 6d70 7574 6564  .    preComputed
-00023130: 5365 6e74 696e 656c 3254 444f 4d49 5253  Sentinel2TDOMIRS
-00023140: 7464 4465 7620 3d20 7072 6543 6f6d 7075  tdDev = preCompu
-00023150: 7465 6453 656e 7469 6e65 6c32 5444 4f4d  tedSentinel2TDOM
-00023160: 4952 5374 6444 6576 2c0d 0a20 2020 2063  IRStdDev,..    c
-00023170: 6c6f 7564 5072 6f62 5468 7265 7368 203d  loudProbThresh =
-00023180: 2063 6c6f 7564 5072 6f62 5468 7265 7368   cloudProbThresh
-00023190: 2c0d 0a20 2020 206c 616e 6473 6174 436f  ,..    landsatCo
-000231a0: 6c6c 6563 7469 6f6e 5665 7273 696f 6e20  llectionVersion 
-000231b0: 3d20 6c61 6e64 7361 7443 6f6c 6c65 6374  = landsatCollect
-000231c0: 696f 6e56 6572 7369 6f6e 290d 0a0d 0a20  ionVersion).... 
-000231d0: 2023 4372 6561 7465 2068 7962 7269 6420   #Create hybrid 
-000231e0: 636f 6d70 6f73 6974 6573 0d0a 2020 636f  composites..  co
-000231f0: 6d70 6f73 6974 6573 203d 2063 6f6d 706f  mposites = compo
-00023200: 7369 7465 5469 6d65 5365 7269 6573 285c  siteTimeSeries(\
-00023210: 0d0a 2020 2020 6c73 203d 206d 6572 6765  ..    ls = merge
-00023220: 642c 0d0a 2020 2020 7374 6172 7459 6561  d,..    startYea
-00023230: 7220 3d20 7374 6172 7459 6561 722c 0d0a  r = startYear,..
-00023240: 2020 2020 656e 6459 6561 7220 3d20 656e      endYear = en
-00023250: 6459 6561 722c 0d0a 2020 2020 7374 6172  dYear,..    star
-00023260: 744a 756c 6961 6e20 3d20 7374 6172 744a  tJulian = startJ
-00023270: 756c 6961 6e2c 0d0a 2020 2020 656e 644a  ulian,..    endJ
-00023280: 756c 6961 6e20 3d20 656e 644a 756c 6961  ulian = endJulia
-00023290: 6e2c 0d0a 2020 2020 7469 6d65 6275 6666  n,..    timebuff
-000232a0: 6572 203d 2074 696d 6562 7566 6665 722c  er = timebuffer,
-000232b0: 0d0a 2020 2020 7765 6967 6874 7320 3d20  ..    weights = 
-000232c0: 7765 6967 6874 732c 0d0a 2020 2020 636f  weights,..    co
-000232d0: 6d70 6f73 6974 696e 674d 6574 686f 6420  mpositingMethod 
-000232e0: 3d20 636f 6d70 6f73 6974 696e 674d 6574  = compositingMet
-000232f0: 686f 6429 0d0a 0d0a 2020 2320 4578 706f  hod)....  # Expo
-00023300: 7274 2063 6f6d 706f 7369 7465 2063 6f6c  rt composite col
-00023310: 6c65 6374 696f 6e0d 0a20 2069 6620 6578  lection..  if ex
-00023320: 706f 7274 436f 6d70 6f73 6974 6573 3a0d  portComposites:.
-00023330: 0a0d 0a20 2020 2065 7870 6f72 7442 616e  ...    exportBan
-00023340: 6444 6963 7420 3d20 7b5c 0d0a 2020 2020  dDict = {\..    
-00023350: 2020 276d 6564 6f69 6427 3a5b 2762 6c75    'medoid':['blu
-00023360: 6527 2c20 2767 7265 656e 272c 2027 7265  e', 'green', 're
-00023370: 6427 2c27 6e69 7227 2c27 7377 6972 3127  d','nir','swir1'
-00023380: 2c20 2773 7769 7232 272c 2763 6f6d 706f  , 'swir2','compo
-00023390: 7369 7465 4f62 7343 6f75 6e74 272c 2773  siteObsCount','s
-000233a0: 656e 736f 7227 2c27 7965 6172 272c 276a  ensor','year','j
-000233b0: 756c 6961 6e44 6179 275d 2c0d 0a20 2020  ulianDay'],..   
-000233c0: 2020 2027 6d65 6469 616e 273a 5b27 626c     'median':['bl
-000233d0: 7565 272c 2027 6772 6565 6e27 2c20 2772  ue', 'green', 'r
-000233e0: 6564 272c 276e 6972 272c 2773 7769 7231  ed','nir','swir1
-000233f0: 272c 2027 7377 6972 3227 2c27 636f 6d70  ', 'swir2','comp
-00023400: 6f73 6974 654f 6273 436f 756e 7427 5d5c  ositeObsCount']\
-00023410: 0d0a 2020 2020 7d3b 0d0a 2020 2020 6e6f  ..    };..    no
-00023420: 6e44 6976 6964 6542 616e 6444 6963 7420  nDivideBandDict 
-00023430: 3d20 7b5c 0d0a 2020 2020 2020 276d 6564  = {\..      'med
-00023440: 6f69 6427 3a5b 2763 6f6d 706f 7369 7465  oid':['composite
-00023450: 4f62 7343 6f75 6e74 272c 2773 656e 736f  ObsCount','senso
-00023460: 7227 2c27 7965 6172 272c 276a 756c 6961  r','year','julia
-00023470: 6e44 6179 275d 2c0d 0a20 2020 2020 2027  nDay'],..      '
-00023480: 6d65 6469 616e 273a 5b27 636f 6d70 6f73  median':['compos
-00023490: 6974 654f 6273 436f 756e 7427 5d5c 0d0a  iteObsCount']\..
-000234a0: 2020 2020 7d3b 0d0a 2020 2020 6578 706f      };..    expo
-000234b0: 7274 4261 6e64 7320 3d20 6578 706f 7274  rtBands = export
-000234c0: 4261 6e64 4469 6374 5b63 6f6d 706f 7369  BandDict[composi
-000234d0: 7469 6e67 4d65 7468 6f64 5d0d 0a20 2020  tingMethod]..   
-000234e0: 206e 6f6e 4469 7669 6465 4261 6e64 7320   nonDivideBands 
-000234f0: 3d20 6e6f 6e44 6976 6964 6542 616e 6444  = nonDivideBandD
-00023500: 6963 745b 636f 6d70 6f73 6974 696e 674d  ict[compositingM
-00023510: 6574 686f 645d 0d0a 0d0a 2020 2020 6578  ethod]....    ex
-00023520: 706f 7274 436f 6d70 6f73 6974 6543 6f6c  portCompositeCol
-00023530: 6c65 6374 696f 6e28 5c0d 0a20 2020 2020  lection(\..     
-00023540: 2063 6f6c 6c65 6374 696f 6e20 3d20 636f   collection = co
-00023550: 6d70 6f73 6974 6573 2c0d 0a20 2020 2020  mposites,..     
-00023560: 2065 7870 6f72 7450 6174 6852 6f6f 7420   exportPathRoot 
-00023570: 3d20 6578 706f 7274 5061 7468 526f 6f74  = exportPathRoot
-00023580: 2c0d 0a20 2020 2020 206f 7574 7075 744e  ,..      outputN
-00023590: 616d 6520 3d20 6f75 7470 7574 4e61 6d65  ame = outputName
-000235a0: 2c0d 0a20 2020 2020 206f 7269 6769 6e20  ,..      origin 
-000235b0: 3d20 6f72 6967 696e 2c0d 0a20 2020 2020  = origin,..     
-000235c0: 2073 7475 6479 4172 6561 203d 2073 7475   studyArea = stu
-000235d0: 6479 4172 6561 2c0d 0a20 2020 2020 2063  dyArea,..      c
-000235e0: 7273 203d 2063 7273 2c0d 0a20 2020 2020  rs = crs,..     
-000235f0: 2074 7261 6e73 666f 726d 203d 2074 7261   transform = tra
-00023600: 6e73 666f 726d 2c0d 0a20 2020 2020 2073  nsform,..      s
-00023610: 6361 6c65 203d 2073 6361 6c65 2c0d 0a20  cale = scale,.. 
-00023620: 2020 2020 2073 7461 7274 5965 6172 203d       startYear =
-00023630: 2073 7461 7274 5965 6172 2c0d 0a20 2020   startYear,..   
-00023640: 2020 2065 6e64 5965 6172 203d 2065 6e64     endYear = end
-00023650: 5965 6172 2c0d 0a20 2020 2020 2073 7461  Year,..      sta
-00023660: 7274 4a75 6c69 616e 203d 2073 7461 7274  rtJulian = start
-00023670: 4a75 6c69 616e 2c0d 0a20 2020 2020 2065  Julian,..      e
-00023680: 6e64 4a75 6c69 616e 203d 2065 6e64 4a75  ndJulian = endJu
-00023690: 6c69 616e 2c0d 0a20 2020 2020 2063 6f6d  lian,..      com
-000236a0: 706f 7369 7469 6e67 4d65 7468 6f64 203d  positingMethod =
-000236b0: 2063 6f6d 706f 7369 7469 6e67 4d65 7468   compositingMeth
-000236c0: 6f64 2c0d 0a20 2020 2020 2074 696d 6562  od,..      timeb
-000236d0: 7566 6665 7220 3d20 7469 6d65 6275 6666  uffer = timebuff
-000236e0: 6572 2c0d 0a20 2020 2020 2074 6f61 4f72  er,..      toaOr
-000236f0: 5352 203d 2074 6f61 4f72 5352 2c0d 0a20  SR = toaOrSR,.. 
-00023700: 2020 2020 206e 6f6e 4469 7669 6465 4261       nonDivideBa
-00023710: 6e64 7320 3d20 6e6f 6e44 6976 6964 6542  nds = nonDivideB
-00023720: 616e 6473 2c0d 0a20 2020 2020 2065 7870  ands,..      exp
-00023730: 6f72 7442 616e 6473 203d 2065 7870 6f72  ortBands = expor
-00023740: 7442 616e 6473 2c0d 0a20 2020 2020 2061  tBands,..      a
-00023750: 6464 6974 696f 6e61 6c50 726f 7065 7274  dditionalPropert
-00023760: 7944 6963 7420 3d20 6172 6773 290d 0a0d  yDict = args)...
-00023770: 0a20 2061 7267 735b 2770 726f 6365 7373  .  args['process
-00023780: 6564 5363 656e 6573 275d 203d 206d 6572  edScenes'] = mer
-00023790: 6765 640d 0a20 2061 7267 735b 2770 726f  ged..  args['pro
-000237a0: 6365 7373 6564 436f 6d70 6f73 6974 6573  cessedComposites
-000237b0: 275d 203d 2063 6f6d 706f 7369 7465 730d  '] = composites.
-000237c0: 0a0d 0a20 2072 6574 7572 6e20 6172 6773  ...  return args
-000237d0: 0d0a 0d0a 2323 2323 2323 2323 2323 2323  ....############
+0001ee80: 2323 230d 0a23 2057 7261 7070 6572 2066  ###..# Wrapper f
+0001ee90: 756e 6374 696f 6e20 666f 7220 6765 7474  unction for gett
+0001eea0: 696e 6720 5365 6e74 696e 656c 2032 2069  ing Sentinel 2 i
+0001eeb0: 6d61 6765 7279 0d0a 6465 6620 6765 7453  magery..def getS
+0001eec0: 656e 7469 6e65 6c32 5772 6170 7065 7228  entinel2Wrapper(
+0001eed0: 5c0d 0a20 2073 7475 6479 4172 6561 2c0d  \..  studyArea,.
+0001eee0: 0a20 2073 7461 7274 5965 6172 2c0d 0a20  .  startYear,.. 
+0001eef0: 2065 6e64 5965 6172 2c0d 0a20 2073 7461   endYear,..  sta
+0001ef00: 7274 4a75 6c69 616e 2c0d 0a20 2065 6e64  rtJulian,..  end
+0001ef10: 4a75 6c69 616e 2c0d 0a20 2074 696d 6562  Julian,..  timeb
+0001ef20: 7566 6665 7220 3d20 302c 0d0a 2020 7765  uffer = 0,..  we
+0001ef30: 6967 6874 7320 3d20 5b31 5d2c 0d0a 2020  ights = [1],..  
+0001ef40: 636f 6d70 6f73 6974 696e 674d 6574 686f  compositingMetho
+0001ef50: 6420 3d20 276d 6564 6f69 6427 2c0d 0a20  d = 'medoid',.. 
+0001ef60: 2061 7070 6c79 5141 4261 6e64 203d 2046   applyQABand = F
+0001ef70: 616c 7365 2c0d 0a20 2061 7070 6c79 436c  alse,..  applyCl
+0001ef80: 6f75 6453 636f 7265 203d 2046 616c 7365  oudScore = False
+0001ef90: 2c0d 0a20 2061 7070 6c79 5368 6164 6f77  ,..  applyShadow
+0001efa0: 5368 6966 7420 3d20 4661 6c73 652c 0d0a  Shift = False,..
+0001efb0: 2020 6170 706c 7954 444f 4d20 3d20 5472    applyTDOM = Tr
+0001efc0: 7565 2c0d 0a20 2063 6c6f 7564 5363 6f72  ue,..  cloudScor
+0001efd0: 6554 6872 6573 6820 3d20 3230 2c0d 0a20  eThresh = 20,.. 
+0001efe0: 2070 6572 666f 726d 436c 6f75 6453 636f   performCloudSco
+0001eff0: 7265 4f66 6673 6574 203d 2054 7275 652c  reOffset = True,
+0001f000: 0d0a 2020 636c 6f75 6453 636f 7265 5063  ..  cloudScorePc
+0001f010: 746c 203d 2031 302c 0d0a 2020 636c 6f75  tl = 10,..  clou
+0001f020: 6448 6569 6768 7473 203d 6565 2e4c 6973  dHeights =ee.Lis
+0001f030: 742e 7365 7175 656e 6365 2835 3030 2c31  t.sequence(500,1
+0001f040: 3030 3030 2c35 3030 292c 0d0a 2020 7a53  0000,500),..  zS
+0001f050: 636f 7265 5468 7265 7368 203d 202d 312c  coreThresh = -1,
+0001f060: 0d0a 2020 7368 6164 6f77 5375 6d54 6872  ..  shadowSumThr
+0001f070: 6573 6820 3d20 302e 3335 2c0d 0a20 2063  esh = 0.35,..  c
+0001f080: 6f6e 7472 6163 7450 6978 656c 7320 3d20  ontractPixels = 
+0001f090: 312e 352c 0d0a 2020 6469 6c61 7465 5069  1.5,..  dilatePi
+0001f0a0: 7865 6c73 203d 2033 2e35 2c0d 0a20 2073  xels = 3.5,..  s
+0001f0b0: 6861 646f 7753 756d 4261 6e64 7320 3d20  hadowSumBands = 
+0001f0c0: 5b27 6e69 7227 2c27 7377 6972 3127 5d2c  ['nir','swir1'],
+0001f0d0: 0d0a 2020 636f 7272 6563 7449 6c6c 756d  ..  correctIllum
+0001f0e0: 696e 6174 696f 6e20 3d20 4661 6c73 652c  ination = False,
+0001f0f0: 0d0a 2020 636f 7272 6563 7453 6361 6c65  ..  correctScale
+0001f100: 203d 2032 3530 2c0d 0a20 2065 7870 6f72   = 250,..  expor
+0001f110: 7443 6f6d 706f 7369 7465 7320 3d20 4661  tComposites = Fa
+0001f120: 6c73 652c 0d0a 2020 6f75 7470 7574 4e61  lse,..  outputNa
+0001f130: 6d65 203d 2027 5365 6e74 696e 656c 322d  me = 'Sentinel2-
+0001f140: 436f 6d70 6f73 6974 6527 2c0d 0a20 2065  Composite',..  e
+0001f150: 7870 6f72 7450 6174 6852 6f6f 7420 3d20  xportPathRoot = 
+0001f160: 2775 7365 7273 2f69 616e 686f 7573 6d61  'users/ianhousma
+0001f170: 6e2f 7465 7374 272c 0d0a 2020 6372 7320  n/test',..  crs 
+0001f180: 3d20 2745 5053 473a 3530 3730 272c 0d0a  = 'EPSG:5070',..
+0001f190: 2020 7472 616e 7366 6f72 6d20 3d20 5b31    transform = [1
+0001f1a0: 302c 302c 2d32 3336 3139 3135 2e30 2c30  0,0,-2361915.0,0
+0001f1b0: 2c2d 3130 2c33 3137 3737 3335 2e30 5d2c  ,-10,3177735.0],
+0001f1c0: 0d0a 2020 7363 616c 6520 3d20 4e6f 6e65  ..  scale = None
+0001f1d0: 2c0d 0a20 2072 6573 616d 706c 654d 6574  ,..  resampleMet
+0001f1e0: 686f 6420 3d20 2761 6767 7265 6761 7465  hod = 'aggregate
+0001f1f0: 272c 0d0a 2020 746f 614f 7253 5220 3d20  ',..  toaOrSR = 
+0001f200: 2754 4f41 272c 0d0a 2020 636f 6e76 6572  'TOA',..  conver
+0001f210: 7454 6f44 6169 6c79 4d6f 7361 6963 7320  tToDailyMosaics 
+0001f220: 3d20 5472 7565 2c0d 0a20 2061 7070 6c79  = True,..  apply
+0001f230: 436c 6f75 6450 726f 6261 6269 6c69 7479  CloudProbability
+0001f240: 203d 2054 7275 652c 0d0a 2020 7072 6543   = True,..  preC
+0001f250: 6f6d 7075 7465 6443 6c6f 7564 5363 6f72  omputedCloudScor
+0001f260: 654f 6666 7365 7420 3d20 4e6f 6e65 2c0d  eOffset = None,.
+0001f270: 0a20 2070 7265 436f 6d70 7574 6564 5444  .  preComputedTD
+0001f280: 4f4d 4952 4d65 616e 203d 204e 6f6e 652c  OMIRMean = None,
+0001f290: 0d0a 2020 7072 6543 6f6d 7075 7465 6454  ..  preComputedT
+0001f2a0: 444f 4d49 5253 7464 4465 7620 3d20 4e6f  DOMIRStdDev = No
+0001f2b0: 6e65 2c0d 0a20 2063 6c6f 7564 5072 6f62  ne,..  cloudProb
+0001f2c0: 5468 7265 7368 203d 2034 3029 3a0d 0a0d  Thresh = 40):...
+0001f2d0: 0a20 206f 7269 6769 6e20 3d20 2753 656e  .  origin = 'Sen
+0001f2e0: 7469 6e65 6c32 270d 0a20 2074 6f61 4f72  tinel2'..  toaOr
+0001f2f0: 5352 203d 2074 6f61 4f72 5352 2e75 7070  SR = toaOrSR.upp
+0001f300: 6572 2829 0d0a 0d0a 2020 6172 6773 203d  er()....  args =
+0001f310: 2066 6f72 6d61 7441 7267 7328 6c6f 6361   formatArgs(loca
+0001f320: 6c73 2829 290d 0a20 2069 6620 2761 7267  ls())..  if 'arg
+0001f330: 7327 2069 6e20 6172 6773 2e6b 6579 7328  s' in args.keys(
+0001f340: 293a 0d0a 2020 2020 6465 6c20 6172 6773  ):..    del args
+0001f350: 5b27 6172 6773 275d 0d0a 0d0a 2020 7332  ['args']....  s2
+0001f360: 7320 3d20 6765 7450 726f 6365 7373 6564  s = getProcessed
+0001f370: 5365 6e74 696e 656c 3253 6365 6e65 7328  Sentinel2Scenes(
+0001f380: 5c0d 0a20 2020 2073 7475 6479 4172 6561  \..    studyArea
+0001f390: 203d 2073 7475 6479 4172 6561 2c0d 0a20   = studyArea,.. 
+0001f3a0: 2020 2073 7461 7274 5965 6172 203d 2073     startYear = s
+0001f3b0: 7461 7274 5965 6172 2c0d 0a20 2020 2065  tartYear,..    e
+0001f3c0: 6e64 5965 6172 203d 2065 6e64 5965 6172  ndYear = endYear
+0001f3d0: 2c0d 0a20 2020 2073 7461 7274 4a75 6c69  ,..    startJuli
+0001f3e0: 616e 203d 2073 7461 7274 4a75 6c69 616e  an = startJulian
+0001f3f0: 2c0d 0a20 2020 2065 6e64 4a75 6c69 616e  ,..    endJulian
+0001f400: 203d 2065 6e64 4a75 6c69 616e 2c0d 0a20   = endJulian,.. 
+0001f410: 2020 2061 7070 6c79 5141 4261 6e64 203d     applyQABand =
+0001f420: 2061 7070 6c79 5141 4261 6e64 2c0d 0a20   applyQABand,.. 
+0001f430: 2020 2061 7070 6c79 436c 6f75 6453 636f     applyCloudSco
+0001f440: 7265 203d 2061 7070 6c79 436c 6f75 6453  re = applyCloudS
+0001f450: 636f 7265 2c0d 0a20 2020 2061 7070 6c79  core,..    apply
+0001f460: 5368 6164 6f77 5368 6966 7420 3d20 6170  ShadowShift = ap
+0001f470: 706c 7953 6861 646f 7753 6869 6674 2c0d  plyShadowShift,.
+0001f480: 0a20 2020 2061 7070 6c79 5444 4f4d 203d  .    applyTDOM =
+0001f490: 2061 7070 6c79 5444 4f4d 2c0d 0a20 2020   applyTDOM,..   
+0001f4a0: 2063 6c6f 7564 5363 6f72 6554 6872 6573   cloudScoreThres
+0001f4b0: 6820 3d20 636c 6f75 6453 636f 7265 5468  h = cloudScoreTh
+0001f4c0: 7265 7368 2c0d 0a20 2020 2070 6572 666f  resh,..    perfo
+0001f4d0: 726d 436c 6f75 6453 636f 7265 4f66 6673  rmCloudScoreOffs
+0001f4e0: 6574 203d 2070 6572 666f 726d 436c 6f75  et = performClou
+0001f4f0: 6453 636f 7265 4f66 6673 6574 2c0d 0a20  dScoreOffset,.. 
+0001f500: 2020 2063 6c6f 7564 5363 6f72 6550 6374     cloudScorePct
+0001f510: 6c20 3d20 636c 6f75 6453 636f 7265 5063  l = cloudScorePc
+0001f520: 746c 2c0d 0a20 2020 2063 6c6f 7564 4865  tl,..    cloudHe
+0001f530: 6967 6874 7320 3d20 636c 6f75 6448 6569  ights = cloudHei
+0001f540: 6768 7473 2c0d 0a20 2020 207a 5363 6f72  ghts,..    zScor
+0001f550: 6554 6872 6573 6820 3d20 7a53 636f 7265  eThresh = zScore
+0001f560: 5468 7265 7368 2c0d 0a20 2020 2073 6861  Thresh,..    sha
+0001f570: 646f 7753 756d 5468 7265 7368 203d 2073  dowSumThresh = s
+0001f580: 6861 646f 7753 756d 5468 7265 7368 2c0d  hadowSumThresh,.
+0001f590: 0a20 2020 2063 6f6e 7472 6163 7450 6978  .    contractPix
+0001f5a0: 656c 7320 3d20 636f 6e74 7261 6374 5069  els = contractPi
+0001f5b0: 7865 6c73 2c0d 0a20 2020 2064 696c 6174  xels,..    dilat
+0001f5c0: 6550 6978 656c 7320 3d20 6469 6c61 7465  ePixels = dilate
+0001f5d0: 5069 7865 6c73 2c0d 0a20 2020 2073 6861  Pixels,..    sha
+0001f5e0: 646f 7753 756d 4261 6e64 7320 3d20 7368  dowSumBands = sh
+0001f5f0: 6164 6f77 5375 6d42 616e 6473 2c0d 0a20  adowSumBands,.. 
+0001f600: 2020 2072 6573 616d 706c 654d 6574 686f     resampleMetho
+0001f610: 6420 3d20 7265 7361 6d70 6c65 4d65 7468  d = resampleMeth
+0001f620: 6f64 2c0d 0a20 2020 2074 6f61 4f72 5352  od,..    toaOrSR
+0001f630: 203d 2074 6f61 4f72 5352 2c0d 0a20 2020   = toaOrSR,..   
+0001f640: 2063 6f6e 7665 7274 546f 4461 696c 794d   convertToDailyM
+0001f650: 6f73 6169 6373 203d 2063 6f6e 7665 7274  osaics = convert
+0001f660: 546f 4461 696c 794d 6f73 6169 6373 2c0d  ToDailyMosaics,.
+0001f670: 0a20 2020 2061 7070 6c79 436c 6f75 6450  .    applyCloudP
+0001f680: 726f 6261 6269 6c69 7479 203d 2061 7070  robability = app
+0001f690: 6c79 436c 6f75 6450 726f 6261 6269 6c69  lyCloudProbabili
+0001f6a0: 7479 2c0d 0a20 2020 2070 7265 436f 6d70  ty,..    preComp
+0001f6b0: 7574 6564 436c 6f75 6453 636f 7265 4f66  utedCloudScoreOf
+0001f6c0: 6673 6574 203d 2070 7265 436f 6d70 7574  fset = preComput
+0001f6d0: 6564 436c 6f75 6453 636f 7265 4f66 6673  edCloudScoreOffs
+0001f6e0: 6574 2c0d 0a20 2020 2070 7265 436f 6d70  et,..    preComp
+0001f6f0: 7574 6564 5444 4f4d 4952 4d65 616e 203d  utedTDOMIRMean =
+0001f700: 2070 7265 436f 6d70 7574 6564 5444 4f4d   preComputedTDOM
+0001f710: 4952 4d65 616e 2c0d 0a20 2020 2070 7265  IRMean,..    pre
+0001f720: 436f 6d70 7574 6564 5444 4f4d 4952 5374  ComputedTDOMIRSt
+0001f730: 6444 6576 203d 2070 7265 436f 6d70 7574  dDev = preComput
+0001f740: 6564 5444 4f4d 4952 5374 6444 6576 2c0d  edTDOMIRStdDev,.
+0001f750: 0a20 2020 2063 6c6f 7564 5072 6f62 5468  .    cloudProbTh
+0001f760: 7265 7368 203d 2063 6c6f 7564 5072 6f62  resh = cloudProb
+0001f770: 5468 7265 7368 290d 0a0d 0a20 2023 4164  Thresh)....  #Ad
+0001f780: 6420 7a65 6e69 7468 2061 6e64 2061 7a69  d zenith and azi
+0001f790: 6d75 7468 0d0a 2020 2369 6620 636f 7272  muth..  #if corr
+0001f7a0: 6563 7449 6c6c 756d 696e 6174 696f 6e3a  ectIllumination:
+0001f7b0: 0d0a 2020 2320 2073 3273 203d 2073 3273  ..  #  s2s = s2s
+0001f7c0: 2e6d 6170 2866 756e 6374 696f 6e28 696d  .map(function(im
+0001f7d0: 6729 7b0d 0a20 2023 2020 2020 7265 7475  g){..  #    retu
+0001f7e0: 726e 2061 6464 5a65 6e69 7468 417a 696d  rn addZenithAzim
+0001f7f0: 7574 6828 696d 672c 2754 4f41 272c 7b27  uth(img,'TOA',{'
+0001f800: 544f 4127 3a27 4d45 414e 5f53 4f4c 4152  TOA':'MEAN_SOLAR
+0001f810: 5f5a 454e 4954 485f 414e 474c 4527 7d2c  _ZENITH_ANGLE'},
+0001f820: 7b27 544f 4127 3a27 4d45 414e 5f53 4f4c  {'TOA':'MEAN_SOL
+0001f830: 4152 5f41 5a49 4d55 5448 5f41 4e47 4c45  AR_AZIMUTH_ANGLE
+0001f840: 277d 293b 0d0a 2020 2320 207d 293b 0d0a  '});..  #  });..
+0001f850: 2020 237d 0d0a 0d0a 2020 2343 7265 6174    #}....  #Creat
+0001f860: 6520 636f 6d70 6f73 6974 6520 7469 6d65  e composite time
+0001f870: 2073 6572 6965 730d 0a20 2074 7320 3d20   series..  ts = 
+0001f880: 636f 6d70 6f73 6974 6554 696d 6553 6572  compositeTimeSer
+0001f890: 6965 7328 5c0d 0a20 2020 206c 7320 3d20  ies(\..    ls = 
+0001f8a0: 7332 732c 0d0a 2020 2020 7374 6172 7459  s2s,..    startY
+0001f8b0: 6561 7220 3d20 7374 6172 7459 6561 722c  ear = startYear,
+0001f8c0: 0d0a 2020 2020 656e 6459 6561 7220 3d20  ..    endYear = 
+0001f8d0: 656e 6459 6561 722c 0d0a 2020 2020 7374  endYear,..    st
+0001f8e0: 6172 744a 756c 6961 6e20 3d20 7374 6172  artJulian = star
+0001f8f0: 744a 756c 6961 6e2c 0d0a 2020 2020 656e  tJulian,..    en
+0001f900: 644a 756c 6961 6e20 3d20 656e 644a 756c  dJulian = endJul
+0001f910: 6961 6e2c 0d0a 2020 2020 7469 6d65 6275  ian,..    timebu
+0001f920: 6666 6572 203d 2074 696d 6562 7566 6665  ffer = timebuffe
+0001f930: 722c 0d0a 2020 2020 7765 6967 6874 7320  r,..    weights 
+0001f940: 3d20 7765 6967 6874 732c 0d0a 2020 2020  = weights,..    
+0001f950: 636f 6d70 6f73 6974 696e 674d 6574 686f  compositingMetho
+0001f960: 6420 3d20 636f 6d70 6f73 6974 696e 674d  d = compositingM
+0001f970: 6574 686f 6429 0d0a 0d0a 2020 2343 6f72  ethod)....  #Cor
+0001f980: 7265 6374 2069 6c6c 756d 696e 6174 696f  rect illuminatio
+0001f990: 6e0d 0a20 2023 2069 6620 2863 6f72 7265  n..  # if (corre
+0001f9a0: 6374 496c 6c75 6d69 6e61 7469 6f6e 297b  ctIllumination){
+0001f9b0: 0d0a 2020 2320 2020 6620 3d20 6565 2e49  ..  #   f = ee.I
+0001f9c0: 6d61 6765 2874 732e 6669 7273 7428 2929  mage(ts.first())
+0001f9d0: 3b0d 0a20 2023 2020 204d 6170 2e61 6464  ;..  #   Map.add
+0001f9e0: 4c61 7965 7228 662c 7669 7a50 6172 616d  Layer(f,vizParam
+0001f9f0: 7346 616c 7365 2c27 4669 7273 742d 6e6f  sFalse,'First-no
+0001fa00: 6e2d 696c 6c75 6d69 6e61 7465 6427 2c66  n-illuminated',f
+0001fa10: 616c 7365 293b 0d0a 0d0a 2020 2320 2020  alse);....  #   
+0001fa20: 7072 696e 7428 2743 6f72 7265 6374 696e  print('Correctin
+0001fa30: 6720 696c 6c75 6d69 6e61 7469 6f6e 2729  g illumination')
+0001fa40: 3b0d 0a20 2023 2020 2074 7320 3d20 7473  ;..  #   ts = ts
+0001fa50: 2e6d 6170 2869 6c6c 756d 696e 6174 696f  .map(illuminatio
+0001fa60: 6e43 6f6e 6469 7469 6f6e 290d 0a20 2023  nCondition)..  #
+0001fa70: 2020 2020 202e 6d61 7028 6675 6e63 7469       .map(functi
+0001fa80: 6f6e 2869 6d67 297b 0d0a 2020 2320 2020  on(img){..  #   
+0001fa90: 2020 2020 7265 7475 726e 2069 6c6c 756d      return illum
+0001faa0: 696e 6174 696f 6e43 6f72 7265 6374 696f  inationCorrectio
+0001fab0: 6e28 696d 672c 2063 6f72 7265 6374 5363  n(img, correctSc
+0001fac0: 616c 652c 7374 7564 7941 7265 612c 5b20  ale,studyArea,[ 
+0001fad0: 2762 6c75 6527 2c20 2767 7265 656e 272c  'blue', 'green',
+0001fae0: 2027 7265 6427 2c27 6e69 7227 2c27 7377   'red','nir','sw
+0001faf0: 6972 3127 2c20 2773 7769 7232 275d 293b  ir1', 'swir2']);
+0001fb00: 0d0a 2020 2320 2020 2020 7d29 3b0d 0a20  ..  #     });.. 
+0001fb10: 2023 2020 2066 203d 2065 652e 496d 6167   #   f = ee.Imag
+0001fb20: 6528 7473 2e66 6972 7374 2829 293b 0d0a  e(ts.first());..
+0001fb30: 2020 2320 2020 4d61 702e 6164 644c 6179    #   Map.addLay
+0001fb40: 6572 2866 2c76 697a 5061 7261 6d73 4661  er(f,vizParamsFa
+0001fb50: 6c73 652c 2746 6972 7374 2d69 6c6c 756d  lse,'First-illum
+0001fb60: 696e 6174 6564 272c 6661 6c73 6529 3b0d  inated',false);.
+0001fb70: 0a0d 0a20 2023 2045 7870 6f72 7420 636f  ...  # Export co
+0001fb80: 6d70 6f73 6974 6573 0d0a 2020 6966 2065  mposites..  if e
+0001fb90: 7870 6f72 7443 6f6d 706f 7369 7465 733a  xportComposites:
+0001fba0: 0d0a 2020 2020 6578 706f 7274 4261 6e64  ..    exportBand
+0001fbb0: 4469 6374 203d 207b 5c0d 0a20 2020 2020  Dict = {\..     
+0001fbc0: 2027 5352 5f6d 6564 6f69 6427 3a5b 2763   'SR_medoid':['c
+0001fbd0: 6227 2c20 2762 6c75 6527 2c20 2767 7265  b', 'blue', 'gre
+0001fbe0: 656e 272c 2027 7265 6427 2c20 2772 6531  en', 'red', 're1
+0001fbf0: 272c 2772 6532 272c 2772 6533 272c 276e  ','re2','re3','n
+0001fc00: 6972 272c 2027 6e69 7232 272c 2027 7761  ir', 'nir2', 'wa
+0001fc10: 7465 7256 6170 6f72 272c 2027 7377 6972  terVapor', 'swir
+0001fc20: 3127 2c20 2773 7769 7232 272c 2763 6f6d  1', 'swir2','com
+0001fc30: 706f 7369 7465 4f62 7343 6f75 6e74 272c  positeObsCount',
+0001fc40: 2773 656e 736f 7227 2c27 7965 6172 272c  'sensor','year',
+0001fc50: 276a 756c 6961 6e44 6179 275d 2c0d 0a20  'julianDay'],.. 
+0001fc60: 2020 2020 2027 5352 5f6d 6564 6961 6e27       'SR_median'
+0001fc70: 3a5b 2763 6227 2c20 2762 6c75 6527 2c20  :['cb', 'blue', 
+0001fc80: 2767 7265 656e 272c 2027 7265 6427 2c20  'green', 'red', 
+0001fc90: 2772 6531 272c 2772 6532 272c 2772 6533  're1','re2','re3
+0001fca0: 272c 276e 6972 272c 2027 6e69 7232 272c  ','nir', 'nir2',
+0001fcb0: 2027 7761 7465 7256 6170 6f72 272c 2027   'waterVapor', '
+0001fcc0: 7377 6972 3127 2c20 2773 7769 7232 272c  swir1', 'swir2',
+0001fcd0: 2763 6f6d 706f 7369 7465 4f62 7343 6f75  'compositeObsCou
+0001fce0: 6e74 275d 2c0d 0a20 2020 2020 2027 544f  nt'],..      'TO
+0001fcf0: 415f 6d65 646f 6964 273a 5b27 6362 272c  A_medoid':['cb',
+0001fd00: 2027 626c 7565 272c 2027 6772 6565 6e27   'blue', 'green'
+0001fd10: 2c20 2772 6564 272c 2027 7265 3127 2c27  , 'red', 're1','
+0001fd20: 7265 3227 2c27 7265 3327 2c27 6e69 7227  re2','re3','nir'
+0001fd30: 2c20 276e 6972 3227 2c20 2777 6174 6572  , 'nir2', 'water
+0001fd40: 5661 706f 7227 2c20 2763 6972 7275 7327  Vapor', 'cirrus'
+0001fd50: 2c20 2773 7769 7231 272c 2027 7377 6972  , 'swir1', 'swir
+0001fd60: 3227 2c27 636f 6d70 6f73 6974 654f 6273  2','compositeObs
+0001fd70: 436f 756e 7427 2c27 7365 6e73 6f72 272c  Count','sensor',
+0001fd80: 2779 6561 7227 2c27 6a75 6c69 616e 4461  'year','julianDa
+0001fd90: 7927 5d2c 0d0a 2020 2020 2020 2754 4f41  y'],..      'TOA
+0001fda0: 5f6d 6564 6961 6e27 3a5b 2763 6227 2c20  _median':['cb', 
+0001fdb0: 2762 6c75 6527 2c20 2767 7265 656e 272c  'blue', 'green',
+0001fdc0: 2027 7265 6427 2c20 2772 6531 272c 2772   'red', 're1','r
+0001fdd0: 6532 272c 2772 6533 272c 276e 6972 272c  e2','re3','nir',
+0001fde0: 2027 6e69 7232 272c 2027 7761 7465 7256   'nir2', 'waterV
+0001fdf0: 6170 6f72 272c 2027 6369 7272 7573 272c  apor', 'cirrus',
+0001fe00: 2027 7377 6972 3127 2c20 2773 7769 7232   'swir1', 'swir2
+0001fe10: 272c 2763 6f6d 706f 7369 7465 4f62 7343  ','compositeObsC
+0001fe20: 6f75 6e74 275d 5c0d 0a20 2020 207d 0d0a  ount']\..    }..
+0001fe30: 2020 2020 6e6f 6e44 6976 6964 6542 616e      nonDivideBan
+0001fe40: 6444 6963 7420 3d20 7b5c 0d0a 2020 2020  dDict = {\..    
+0001fe50: 2020 276d 6564 6f69 6427 3a5b 2763 6f6d    'medoid':['com
+0001fe60: 706f 7369 7465 4f62 7343 6f75 6e74 272c  positeObsCount',
+0001fe70: 2773 656e 736f 7227 2c27 7965 6172 272c  'sensor','year',
+0001fe80: 276a 756c 6961 6e44 6179 275d 2c0d 0a20  'julianDay'],.. 
+0001fe90: 2020 2020 2027 6d65 6469 616e 273a 5b27       'median':['
+0001fea0: 636f 6d70 6f73 6974 654f 6273 436f 756e  compositeObsCoun
+0001feb0: 7427 5d5c 0d0a 2020 2020 7d0d 0a20 2020  t']\..    }..   
+0001fec0: 2065 7870 6f72 7442 616e 6473 203d 2065   exportBands = e
+0001fed0: 7870 6f72 7442 616e 6444 6963 745b 746f  xportBandDict[to
+0001fee0: 614f 7253 5220 2b20 275f 2720 2b20 636f  aOrSR + '_' + co
+0001fef0: 6d70 6f73 6974 696e 674d 6574 686f 645d  mpositingMethod]
+0001ff00: 0d0a 2020 2020 6e6f 6e44 6976 6964 6542  ..    nonDivideB
+0001ff10: 616e 6473 203d 206e 6f6e 4469 7669 6465  ands = nonDivide
+0001ff20: 4261 6e64 4469 6374 5b63 6f6d 706f 7369  BandDict[composi
+0001ff30: 7469 6e67 4d65 7468 6f64 5d0d 0a0d 0a20  tingMethod].... 
+0001ff40: 2020 2065 7870 6f72 7443 6f6d 706f 7369     exportComposi
+0001ff50: 7465 436f 6c6c 6563 7469 6f6e 285c 0d0a  teCollection(\..
+0001ff60: 2020 2020 2020 636f 6c6c 6563 7469 6f6e        collection
+0001ff70: 203d 2074 732c 0d0a 2020 2020 2020 6578   = ts,..      ex
+0001ff80: 706f 7274 5061 7468 526f 6f74 203d 2065  portPathRoot = e
+0001ff90: 7870 6f72 7450 6174 6852 6f6f 742c 0d0a  xportPathRoot,..
+0001ffa0: 2020 2020 2020 6f75 7470 7574 4e61 6d65        outputName
+0001ffb0: 203d 206f 7574 7075 744e 616d 652c 0d0a   = outputName,..
+0001ffc0: 2020 2020 2020 6f72 6967 696e 203d 206f        origin = o
+0001ffd0: 7269 6769 6e2c 0d0a 2020 2020 2020 7374  rigin,..      st
+0001ffe0: 7564 7941 7265 6120 3d20 7374 7564 7941  udyArea = studyA
+0001fff0: 7265 612c 0d0a 2020 2020 2020 6372 7320  rea,..      crs 
+00020000: 3d20 6372 732c 0d0a 2020 2020 2020 7472  = crs,..      tr
+00020010: 616e 7366 6f72 6d20 3d20 7472 616e 7366  ansform = transf
+00020020: 6f72 6d2c 0d0a 2020 2020 2020 7363 616c  orm,..      scal
+00020030: 6520 3d20 7363 616c 652c 0d0a 2020 2020  e = scale,..    
+00020040: 2020 7374 6172 7459 6561 7220 3d20 7374    startYear = st
+00020050: 6172 7459 6561 722c 0d0a 2020 2020 2020  artYear,..      
+00020060: 656e 6459 6561 7220 3d20 656e 6459 6561  endYear = endYea
+00020070: 722c 0d0a 2020 2020 2020 7374 6172 744a  r,..      startJ
+00020080: 756c 6961 6e20 3d20 7374 6172 744a 756c  ulian = startJul
+00020090: 6961 6e2c 0d0a 2020 2020 2020 656e 644a  ian,..      endJ
+000200a0: 756c 6961 6e20 3d20 656e 644a 756c 6961  ulian = endJulia
+000200b0: 6e2c 0d0a 2020 2020 2020 636f 6d70 6f73  n,..      compos
+000200c0: 6974 696e 674d 6574 686f 6420 3d20 636f  itingMethod = co
+000200d0: 6d70 6f73 6974 696e 674d 6574 686f 642c  mpositingMethod,
+000200e0: 0d0a 2020 2020 2020 7469 6d65 6275 6666  ..      timebuff
+000200f0: 6572 203d 2074 696d 6562 7566 6665 722c  er = timebuffer,
+00020100: 0d0a 2020 2020 2020 746f 614f 7253 5220  ..      toaOrSR 
+00020110: 3d20 746f 614f 7253 522c 0d0a 2020 2020  = toaOrSR,..    
+00020120: 2020 6e6f 6e44 6976 6964 6542 616e 6473    nonDivideBands
+00020130: 203d 206e 6f6e 4469 7669 6465 4261 6e64   = nonDivideBand
+00020140: 732c 0d0a 2020 2020 2020 6578 706f 7274  s,..      export
+00020150: 4261 6e64 7320 3d20 6578 706f 7274 4261  Bands = exportBa
+00020160: 6e64 732c 0d0a 2020 2020 2020 6164 6469  nds,..      addi
+00020170: 7469 6f6e 616c 5072 6f70 6572 7479 4469  tionalPropertyDi
+00020180: 6374 203d 2061 7267 7329 0d0a 0d0a 2020  ct = args)....  
+00020190: 6172 6773 5b27 7072 6f63 6573 7365 6453  args['processedS
+000201a0: 6365 6e65 7327 5d20 3d20 7332 730d 0a20  cenes'] = s2s.. 
+000201b0: 2061 7267 735b 2770 726f 6365 7373 6564   args['processed
+000201c0: 436f 6d70 6f73 6974 6573 275d 203d 2074  Composites'] = t
+000201d0: 730d 0a0d 0a20 2072 6574 7572 6e20 6172  s....  return ar
+000201e0: 6773 0d0a 0d0a 2320 4879 6272 6964 2067  gs....# Hybrid g
+000201f0: 6574 204c 616e 6473 6174 2061 6e64 2053  et Landsat and S
+00020200: 656e 7469 6e65 6c20 3220 7072 6f63 6573  entinel 2 proces
+00020210: 7365 6420 7363 656e 6573 0d0a 2320 4861  sed scenes..# Ha
+00020220: 6e64 6c65 7320 6765 7474 696e 6720 7072  ndles getting pr
+00020230: 6f63 6573 7365 6420 7363 656e 6573 2020  ocessed scenes  
+00020240: 7769 7468 204c 616e 6473 6174 2061 6e64  with Landsat and
+00020250: 2053 656e 7469 6e65 6c20 320d 0a64 6566   Sentinel 2..def
+00020260: 2067 6574 5072 6f63 6573 7365 644c 616e   getProcessedLan
+00020270: 6473 6174 416e 6453 656e 7469 6e65 6c32  dsatAndSentinel2
+00020280: 5363 656e 6573 280d 0a20 2020 2020 2073  Scenes(..      s
+00020290: 7475 6479 4172 6561 2c0d 0a20 2020 2020  tudyArea,..     
+000202a0: 2073 7461 7274 5965 6172 2c0d 0a20 2020   startYear,..   
+000202b0: 2020 2065 6e64 5965 6172 2c0d 0a20 2020     endYear,..   
+000202c0: 2020 2073 7461 7274 4a75 6c69 616e 2c0d     startJulian,.
+000202d0: 0a20 2020 2020 2065 6e64 4a75 6c69 616e  .      endJulian
+000202e0: 2c0d 0a20 2020 2020 2074 6f61 4f72 5352  ,..      toaOrSR
+000202f0: 203d 2027 544f 4127 2c0d 0a20 2020 2020   = 'TOA',..     
+00020300: 2069 6e63 6c75 6465 534c 434f 6666 4c37   includeSLCOffL7
+00020310: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
+00020320: 2064 6566 7269 6e67 654c 3520 3d20 4661   defringeL5 = Fa
+00020330: 6c73 652c 0d0a 2020 2020 2020 6170 706c  lse,..      appl
+00020340: 7951 4142 616e 6420 3d20 4661 6c73 652c  yQABand = False,
+00020350: 0d0a 2020 2020 2020 6170 706c 7943 6c6f  ..      applyClo
+00020360: 7564 5072 6f62 6162 696c 6974 7920 3d20  udProbability = 
+00020370: 5472 7565 2c0d 0a20 2020 2020 2061 7070  True,..      app
+00020380: 6c79 5368 6164 6f77 5368 6966 7420 3d20  lyShadowShift = 
+00020390: 4661 6c73 652c 0d0a 2020 2020 2020 6170  False,..      ap
+000203a0: 706c 7943 6c6f 7564 5363 6f72 654c 616e  plyCloudScoreLan
+000203b0: 6473 6174 203d 2046 616c 7365 2c0d 0a20  dsat = False,.. 
+000203c0: 2020 2020 2061 7070 6c79 436c 6f75 6453       applyCloudS
+000203d0: 636f 7265 5365 6e74 696e 656c 3220 3d20  coreSentinel2 = 
+000203e0: 4661 6c73 652c 0d0a 2020 2020 2020 6170  False,..      ap
+000203f0: 706c 7954 444f 4d4c 616e 6473 6174 203d  plyTDOMLandsat =
+00020400: 2054 7275 652c 0d0a 2020 2020 2020 6170   True,..      ap
+00020410: 706c 7954 444f 4d53 656e 7469 6e65 6c32  plyTDOMSentinel2
+00020420: 203d 2054 7275 652c 0d0a 2020 2020 2020   = True,..      
+00020430: 6170 706c 7946 6d61 736b 436c 6f75 644d  applyFmaskCloudM
+00020440: 6173 6b20 3d20 5472 7565 2c0d 0a20 2020  ask = True,..   
+00020450: 2020 2061 7070 6c79 466d 6173 6b43 6c6f     applyFmaskClo
+00020460: 7564 5368 6164 6f77 4d61 736b 203d 2054  udShadowMask = T
+00020470: 7275 652c 0d0a 2020 2020 2020 6170 706c  rue,..      appl
+00020480: 7946 6d61 736b 536e 6f77 4d61 736b 203d  yFmaskSnowMask =
+00020490: 2046 616c 7365 2c0d 0a20 2020 2020 2063   False,..      c
+000204a0: 6c6f 7564 4865 6967 6874 7320 3d20 6565  loudHeights = ee
+000204b0: 2e4c 6973 742e 7365 7175 656e 6365 2835  .List.sequence(5
+000204c0: 3030 2c31 3030 3030 2c35 3030 292c 0d0a  00,10000,500),..
+000204d0: 2020 2020 2020 636c 6f75 6453 636f 7265        cloudScore
+000204e0: 5468 7265 7368 203d 2032 302c 0d0a 2020  Thresh = 20,..  
+000204f0: 2020 2020 7065 7266 6f72 6d43 6c6f 7564      performCloud
+00020500: 5363 6f72 654f 6666 7365 7420 3d20 5472  ScoreOffset = Tr
+00020510: 7565 2c0d 0a20 2020 2020 2063 6c6f 7564  ue,..      cloud
+00020520: 5363 6f72 6550 6374 6c20 3d20 3130 2c0d  ScorePctl = 10,.
+00020530: 0a20 2020 2020 207a 5363 6f72 6554 6872  .      zScoreThr
+00020540: 6573 6820 3d20 2d31 2c0d 0a20 2020 2020  esh = -1,..     
+00020550: 2073 6861 646f 7753 756d 5468 7265 7368   shadowSumThresh
+00020560: 203d 2030 2e33 352c 0d0a 2020 2020 2020   = 0.35,..      
+00020570: 636f 6e74 7261 6374 5069 7865 6c73 203d  contractPixels =
+00020580: 2031 2e35 2c0d 0a20 2020 2020 2064 696c   1.5,..      dil
+00020590: 6174 6550 6978 656c 7320 3d20 332e 352c  atePixels = 3.5,
+000205a0: 0d0a 2020 2020 2020 7368 6164 6f77 5375  ..      shadowSu
+000205b0: 6d42 616e 6473 203d 205b 276e 6972 272c  mBands = ['nir',
+000205c0: 2773 7769 7231 275d 2c0d 0a20 2020 2020  'swir1'],..     
+000205d0: 206c 616e 6473 6174 5265 7361 6d70 6c65   landsatResample
+000205e0: 4d65 7468 6f64 203d 2027 6e65 6172 272c  Method = 'near',
+000205f0: 0d0a 2020 2020 2020 7365 6e74 696e 656c  ..      sentinel
+00020600: 3252 6573 616d 706c 654d 6574 686f 6420  2ResampleMethod 
+00020610: 3d20 2761 6767 7265 6761 7465 272c 0d0a  = 'aggregate',..
+00020620: 2020 2020 2020 636f 6e76 6572 7454 6f44        convertToD
+00020630: 6169 6c79 4d6f 7361 6963 7320 3d20 5472  ailyMosaics = Tr
+00020640: 7565 2c0d 0a20 2020 2020 2072 756e 4368  ue,..      runCh
+00020650: 6173 7461 696e 4861 726d 6f6e 697a 6174  astainHarmonizat
+00020660: 696f 6e20 3d20 5472 7565 2c0d 0a20 2020  ion = True,..   
+00020670: 2020 2063 6f72 7265 6374 496c 6c75 6d69     correctIllumi
+00020680: 6e61 7469 6f6e 203d 2046 616c 7365 2c0d  nation = False,.
+00020690: 0a20 2020 2020 2063 6f72 7265 6374 5363  .      correctSc
+000206a0: 616c 6520 3d20 3235 302c 0d0a 2020 2020  ale = 250,..    
+000206b0: 2020 7072 6543 6f6d 7075 7465 644c 616e    preComputedLan
+000206c0: 6473 6174 436c 6f75 6453 636f 7265 4f66  dsatCloudScoreOf
+000206d0: 6673 6574 203d 204e 6f6e 652c 0d0a 2020  fset = None,..  
+000206e0: 2020 2020 7072 6543 6f6d 7075 7465 644c      preComputedL
+000206f0: 616e 6473 6174 5444 4f4d 4952 4d65 616e  andsatTDOMIRMean
+00020700: 203d 204e 6f6e 652c 0d0a 2020 2020 2020   = None,..      
+00020710: 7072 6543 6f6d 7075 7465 644c 616e 6473  preComputedLands
+00020720: 6174 5444 4f4d 4952 5374 6444 6576 203d  atTDOMIRStdDev =
+00020730: 204e 6f6e 652c 0d0a 2020 2020 2020 7072   None,..      pr
+00020740: 6543 6f6d 7075 7465 6453 656e 7469 6e65  eComputedSentine
+00020750: 6c32 436c 6f75 6453 636f 7265 4f66 6673  l2CloudScoreOffs
+00020760: 6574 203d 204e 6f6e 652c 0d0a 2020 2020  et = None,..    
+00020770: 2020 7072 6543 6f6d 7075 7465 6453 656e    preComputedSen
+00020780: 7469 6e65 6c32 5444 4f4d 4952 4d65 616e  tinel2TDOMIRMean
+00020790: 203d 204e 6f6e 652c 0d0a 2020 2020 2020   = None,..      
+000207a0: 7072 6543 6f6d 7075 7465 6453 656e 7469  preComputedSenti
+000207b0: 6e65 6c32 5444 4f4d 4952 5374 6444 6576  nel2TDOMIRStdDev
+000207c0: 203d 204e 6f6e 652c 0d0a 2020 2020 2020   = None,..      
+000207d0: 636c 6f75 6450 726f 6254 6872 6573 6820  cloudProbThresh 
+000207e0: 3d20 3430 2c0d 0a20 2020 2020 206c 616e  = 40,..      lan
+000207f0: 6473 6174 436f 6c6c 6563 7469 6f6e 5665  dsatCollectionVe
+00020800: 7273 696f 6e20 3d20 2743 3227 293a 0d0a  rsion = 'C2'):..
+00020810: 0d0a 2020 6966 2074 6f61 4f72 5352 203d  ..  if toaOrSR =
+00020820: 3d20 2753 5227 3a0d 0a20 2020 2072 756e  = 'SR':..    run
+00020830: 4368 6173 7461 696e 4861 726d 6f6e 697a  ChastainHarmoniz
+00020840: 6174 696f 6e20 3d20 4661 6c73 650d 0a0d  ation = False...
+00020850: 0a20 206f 7269 6769 6e20 3d20 274c 616e  .  origin = 'Lan
+00020860: 6473 6174 2d53 656e 7469 6e65 6c32 2d48  dsat-Sentinel2-H
+00020870: 7962 7269 6427 0d0a 2020 746f 614f 7253  ybrid'..  toaOrS
+00020880: 5220 3d20 746f 614f 7253 522e 7570 7065  R = toaOrSR.uppe
+00020890: 7228 290d 0a0d 0a20 2023 5072 6570 6172  r()....  #Prepar
+000208a0: 6520 6461 7465 730d 0a20 2023 5772 6170  e dates..  #Wrap
+000208b0: 2074 6865 2064 6174 6573 2069 6620 6e65   the dates if ne
+000208c0: 6564 6564 0d0a 2020 7772 6170 4f66 6673  eded..  wrapOffs
+000208d0: 6574 203d 2030 0d0a 2020 6966 2073 7461  et = 0..  if sta
+000208e0: 7274 4a75 6c69 616e 203e 2065 6e64 4a75  rtJulian > endJu
+000208f0: 6c69 616e 3a0d 0a20 2020 2077 7261 704f  lian:..    wrapO
+00020900: 6666 7365 7420 3d20 3336 350d 0a20 2073  ffset = 365..  s
+00020910: 7461 7274 4461 7465 203d 2065 652e 4461  tartDate = ee.Da
+00020920: 7465 2e66 726f 6d59 4d44 2873 7461 7274  te.fromYMD(start
+00020930: 5965 6172 2c31 2c31 292e 6164 7661 6e63  Year,1,1).advanc
+00020940: 6528 7374 6172 744a 756c 6961 6e2d 312c  e(startJulian-1,
+00020950: 2764 6179 2729 0d0a 2020 656e 6444 6174  'day')..  endDat
+00020960: 6520 3d20 6565 2e44 6174 652e 6672 6f6d  e = ee.Date.from
+00020970: 594d 4428 656e 6459 6561 722c 312c 3129  YMD(endYear,1,1)
+00020980: 2e61 6476 616e 6365 2865 6e64 4a75 6c69  .advance(endJuli
+00020990: 616e 2d31 2b77 7261 704f 6666 7365 742c  an-1+wrapOffset,
+000209a0: 2764 6179 2729 0d0a 0d0a 2020 6172 6773  'day')....  args
+000209b0: 203d 2066 6f72 6d61 7441 7267 7328 6c6f   = formatArgs(lo
+000209c0: 6361 6c73 2829 290d 0a20 2069 6620 2761  cals())..  if 'a
+000209d0: 7267 7327 2069 6e20 6172 6773 2e6b 6579  rgs' in args.key
+000209e0: 7328 293a 0d0a 2020 2020 6465 6c20 6172  s():..    del ar
+000209f0: 6773 5b27 6172 6773 275d 0d0a 0d0a 2020  gs['args']....  
+00020a00: 7072 696e 7428 2747 6574 2050 726f 6365  print('Get Proce
+00020a10: 7373 6564 204c 616e 6473 6174 2061 6e64  ssed Landsat and
+00020a20: 2053 656e 7469 6e65 6c32 2053 6365 6e65   Sentinel2 Scene
+00020a30: 733a 2027 290d 0a20 2070 7269 6e74 2827  s: ')..  print('
+00020a40: 5374 6172 7420 6461 7465 3a27 2c20 7374  Start date:', st
+00020a50: 6172 7444 6174 652e 666f 726d 6174 2827  artDate.format('
+00020a60: 4d4d 4d20 6464 2079 7979 7927 292e 6765  MMM dd yyyy').ge
+00020a70: 7449 6e66 6f28 292c 272c 2045 6e64 2064  tInfo(),', End d
+00020a80: 6174 653a 272c 2065 6e64 4461 7465 2e66  ate:', endDate.f
+00020a90: 6f72 6d61 7428 274d 4d4d 2064 6420 7979  ormat('MMM dd yy
+00020aa0: 7979 2729 2e67 6574 496e 666f 2829 290d  yy').getInfo()).
+00020ab0: 0a20 2066 6f72 2061 7267 2069 6e20 6172  .  for arg in ar
+00020ac0: 6773 2e6b 6579 7328 293a 0d0a 2020 2020  gs.keys():..    
+00020ad0: 7072 696e 7428 6172 672c 2027 3a20 272c  print(arg, ': ',
+00020ae0: 2061 7267 735b 6172 675d 290d 0a0d 0a20   args[arg]).... 
+00020af0: 2023 4765 7420 4c61 6e64 7361 740d 0a20   #Get Landsat.. 
+00020b00: 206c 7320 3d20 6765 7450 726f 6365 7373   ls = getProcess
+00020b10: 6564 4c61 6e64 7361 7453 6365 6e65 7328  edLandsatScenes(
+00020b20: 5c0d 0a20 2020 2073 7475 6479 4172 6561  \..    studyArea
+00020b30: 203d 2073 7475 6479 4172 6561 2c0d 0a20   = studyArea,.. 
+00020b40: 2020 2073 7461 7274 5965 6172 203d 2073     startYear = s
+00020b50: 7461 7274 5965 6172 2c0d 0a20 2020 2065  tartYear,..    e
+00020b60: 6e64 5965 6172 203d 2065 6e64 5965 6172  ndYear = endYear
+00020b70: 2c0d 0a20 2020 2073 7461 7274 4a75 6c69  ,..    startJuli
+00020b80: 616e 203d 2073 7461 7274 4a75 6c69 616e  an = startJulian
+00020b90: 2c0d 0a20 2020 2065 6e64 4a75 6c69 616e  ,..    endJulian
+00020ba0: 203d 2065 6e64 4a75 6c69 616e 2c0d 0a20   = endJulian,.. 
+00020bb0: 2020 2074 6f61 4f72 5352 203d 2074 6f61     toaOrSR = toa
+00020bc0: 4f72 5352 2c0d 0a20 2020 2069 6e63 6c75  OrSR,..    inclu
+00020bd0: 6465 534c 434f 6666 4c37 203d 2069 6e63  deSLCOffL7 = inc
+00020be0: 6c75 6465 534c 434f 6666 4c37 2c0d 0a20  ludeSLCOffL7,.. 
+00020bf0: 2020 2064 6566 7269 6e67 654c 3520 3d20     defringeL5 = 
+00020c00: 6465 6672 696e 6765 4c35 2c0d 0a20 2020  defringeL5,..   
+00020c10: 2061 7070 6c79 436c 6f75 6453 636f 7265   applyCloudScore
+00020c20: 203d 2061 7070 6c79 436c 6f75 6453 636f   = applyCloudSco
+00020c30: 7265 4c61 6e64 7361 742c 0d0a 2020 2020  reLandsat,..    
+00020c40: 6170 706c 7946 6d61 736b 436c 6f75 644d  applyFmaskCloudM
+00020c50: 6173 6b20 3d20 6170 706c 7946 6d61 736b  ask = applyFmask
+00020c60: 436c 6f75 644d 6173 6b2c 0d0a 2020 2020  CloudMask,..    
+00020c70: 6170 706c 7954 444f 4d20 3d20 6170 706c  applyTDOM = appl
+00020c80: 7954 444f 4d4c 616e 6473 6174 2c0d 0a20  yTDOMLandsat,.. 
+00020c90: 2020 2061 7070 6c79 466d 6173 6b43 6c6f     applyFmaskClo
+00020ca0: 7564 5368 6164 6f77 4d61 736b 203d 2061  udShadowMask = a
+00020cb0: 7070 6c79 466d 6173 6b43 6c6f 7564 5368  pplyFmaskCloudSh
+00020cc0: 6164 6f77 4d61 736b 2c0d 0a20 2020 2061  adowMask,..    a
+00020cd0: 7070 6c79 466d 6173 6b53 6e6f 774d 6173  pplyFmaskSnowMas
+00020ce0: 6b20 3d20 6170 706c 7946 6d61 736b 536e  k = applyFmaskSn
+00020cf0: 6f77 4d61 736b 2c0d 0a20 2020 2063 6c6f  owMask,..    clo
+00020d00: 7564 5363 6f72 6554 6872 6573 6820 3d20  udScoreThresh = 
+00020d10: 636c 6f75 6453 636f 7265 5468 7265 7368  cloudScoreThresh
+00020d20: 2c0d 0a20 2020 2070 6572 666f 726d 436c  ,..    performCl
+00020d30: 6f75 6453 636f 7265 4f66 6673 6574 203d  oudScoreOffset =
+00020d40: 2070 6572 666f 726d 436c 6f75 6453 636f   performCloudSco
+00020d50: 7265 4f66 6673 6574 2c0d 0a20 2020 2063  reOffset,..    c
+00020d60: 6c6f 7564 5363 6f72 6550 6374 6c20 3d20  loudScorePctl = 
+00020d70: 636c 6f75 6453 636f 7265 5063 746c 2c0d  cloudScorePctl,.
+00020d80: 0a20 2020 207a 5363 6f72 6554 6872 6573  .    zScoreThres
+00020d90: 6820 3d20 7a53 636f 7265 5468 7265 7368  h = zScoreThresh
+00020da0: 2c0d 0a20 2020 2073 6861 646f 7753 756d  ,..    shadowSum
+00020db0: 5468 7265 7368 203d 2073 6861 646f 7753  Thresh = shadowS
+00020dc0: 756d 5468 7265 7368 2c0d 0a20 2020 2063  umThresh,..    c
+00020dd0: 6f6e 7472 6163 7450 6978 656c 7320 3d20  ontractPixels = 
+00020de0: 636f 6e74 7261 6374 5069 7865 6c73 2c0d  contractPixels,.
+00020df0: 0a20 2020 2064 696c 6174 6550 6978 656c  .    dilatePixel
+00020e00: 7320 3d20 6469 6c61 7465 5069 7865 6c73  s = dilatePixels
+00020e10: 2c0d 0a20 2020 2073 6861 646f 7753 756d  ,..    shadowSum
+00020e20: 4261 6e64 7320 3d20 7368 6164 6f77 5375  Bands = shadowSu
+00020e30: 6d42 616e 6473 2c0d 0a20 2020 2072 6573  mBands,..    res
+00020e40: 616d 706c 654d 6574 686f 6420 3d20 6c61  ampleMethod = la
+00020e50: 6e64 7361 7452 6573 616d 706c 654d 6574  ndsatResampleMet
+00020e60: 686f 642c 0d0a 2020 2020 2368 6172 6d6f  hod,..    #harmo
+00020e70: 6e69 7a65 4f4c 4920 3d20 6861 726d 6f6e  nizeOLI = harmon
+00020e80: 697a 654f 4c49 2c0d 0a20 2020 2070 7265  izeOLI,..    pre
+00020e90: 436f 6d70 7574 6564 436c 6f75 6453 636f  ComputedCloudSco
+00020ea0: 7265 4f66 6673 6574 203d 2070 7265 436f  reOffset = preCo
+00020eb0: 6d70 7574 6564 4c61 6e64 7361 7443 6c6f  mputedLandsatClo
+00020ec0: 7564 5363 6f72 654f 6666 7365 742c 0d0a  udScoreOffset,..
+00020ed0: 2020 2020 7072 6543 6f6d 7075 7465 6454      preComputedT
+00020ee0: 444f 4d49 524d 6561 6e20 3d20 7072 6543  DOMIRMean = preC
+00020ef0: 6f6d 7075 7465 644c 616e 6473 6174 5444  omputedLandsatTD
+00020f00: 4f4d 4952 4d65 616e 2c0d 0a20 2020 2070  OMIRMean,..    p
+00020f10: 7265 436f 6d70 7574 6564 5444 4f4d 4952  reComputedTDOMIR
+00020f20: 5374 6444 6576 203d 2070 7265 436f 6d70  StdDev = preComp
+00020f30: 7574 6564 5365 6e74 696e 656c 3254 444f  utedSentinel2TDO
+00020f40: 4d49 5253 7464 4465 762c 0d0a 2020 2020  MIRStdDev,..    
+00020f50: 6c61 6e64 7361 7443 6f6c 6c65 6374 696f  landsatCollectio
+00020f60: 6e56 6572 7369 6f6e 203d 206c 616e 6473  nVersion = lands
+00020f70: 6174 436f 6c6c 6563 7469 6f6e 5665 7273  atCollectionVers
+00020f80: 696f 6e29 0d0a 0d0a 2020 2347 6574 2053  ion)....  #Get S
+00020f90: 656e 7469 6e65 6c20 320d 0a20 2073 3273  entinel 2..  s2s
+00020fa0: 203d 2067 6574 5072 6f63 6573 7365 6453   = getProcessedS
+00020fb0: 656e 7469 6e65 6c32 5363 656e 6573 285c  entinel2Scenes(\
+00020fc0: 0d0a 2020 2020 7374 7564 7941 7265 6120  ..    studyArea 
+00020fd0: 3d20 7374 7564 7941 7265 612c 0d0a 2020  = studyArea,..  
+00020fe0: 2020 7374 6172 7459 6561 7220 3d20 7374    startYear = st
+00020ff0: 6172 7459 6561 722c 0d0a 2020 2020 656e  artYear,..    en
+00021000: 6459 6561 7220 3d20 656e 6459 6561 722c  dYear = endYear,
+00021010: 0d0a 2020 2020 7374 6172 744a 756c 6961  ..    startJulia
+00021020: 6e20 3d20 7374 6172 744a 756c 6961 6e2c  n = startJulian,
+00021030: 0d0a 2020 2020 656e 644a 756c 6961 6e20  ..    endJulian 
+00021040: 3d20 656e 644a 756c 6961 6e2c 0d0a 2020  = endJulian,..  
+00021050: 2020 6170 706c 7951 4142 616e 6420 3d20    applyQABand = 
+00021060: 6170 706c 7951 4142 616e 642c 0d0a 2020  applyQABand,..  
+00021070: 2020 6170 706c 7943 6c6f 7564 5363 6f72    applyCloudScor
+00021080: 6520 3d20 6170 706c 7943 6c6f 7564 5363  e = applyCloudSc
+00021090: 6f72 6553 656e 7469 6e65 6c32 2c0d 0a20  oreSentinel2,.. 
+000210a0: 2020 2061 7070 6c79 5368 6164 6f77 5368     applyShadowSh
+000210b0: 6966 7420 3d20 6170 706c 7953 6861 646f  ift = applyShado
+000210c0: 7753 6869 6674 2c0d 0a20 2020 2061 7070  wShift,..    app
+000210d0: 6c79 5444 4f4d 203d 2061 7070 6c79 5444  lyTDOM = applyTD
+000210e0: 4f4d 5365 6e74 696e 656c 322c 0d0a 2020  OMSentinel2,..  
+000210f0: 2020 636c 6f75 6453 636f 7265 5468 7265    cloudScoreThre
+00021100: 7368 203d 2063 6c6f 7564 5363 6f72 6554  sh = cloudScoreT
+00021110: 6872 6573 682c 0d0a 2020 2020 7065 7266  hresh,..    perf
+00021120: 6f72 6d43 6c6f 7564 5363 6f72 654f 6666  ormCloudScoreOff
+00021130: 7365 7420 3d20 7065 7266 6f72 6d43 6c6f  set = performClo
+00021140: 7564 5363 6f72 654f 6666 7365 742c 0d0a  udScoreOffset,..
+00021150: 2020 2020 636c 6f75 6453 636f 7265 5063      cloudScorePc
+00021160: 746c 203d 2063 6c6f 7564 5363 6f72 6550  tl = cloudScoreP
+00021170: 6374 6c2c 0d0a 2020 2020 636c 6f75 6448  ctl,..    cloudH
+00021180: 6569 6768 7473 203d 2063 6c6f 7564 4865  eights = cloudHe
+00021190: 6967 6874 732c 0d0a 2020 2020 7a53 636f  ights,..    zSco
+000211a0: 7265 5468 7265 7368 203d 207a 5363 6f72  reThresh = zScor
+000211b0: 6554 6872 6573 682c 0d0a 2020 2020 7368  eThresh,..    sh
+000211c0: 6164 6f77 5375 6d54 6872 6573 6820 3d20  adowSumThresh = 
+000211d0: 7368 6164 6f77 5375 6d54 6872 6573 682c  shadowSumThresh,
+000211e0: 0d0a 2020 2020 636f 6e74 7261 6374 5069  ..    contractPi
+000211f0: 7865 6c73 203d 2063 6f6e 7472 6163 7450  xels = contractP
+00021200: 6978 656c 732c 0d0a 2020 2020 6469 6c61  ixels,..    dila
+00021210: 7465 5069 7865 6c73 203d 2064 696c 6174  tePixels = dilat
+00021220: 6550 6978 656c 732c 0d0a 2020 2020 7368  ePixels,..    sh
+00021230: 6164 6f77 5375 6d42 616e 6473 203d 2073  adowSumBands = s
+00021240: 6861 646f 7753 756d 4261 6e64 732c 0d0a  hadowSumBands,..
+00021250: 2020 2020 7265 7361 6d70 6c65 4d65 7468      resampleMeth
+00021260: 6f64 203d 2073 656e 7469 6e65 6c32 5265  od = sentinel2Re
+00021270: 7361 6d70 6c65 4d65 7468 6f64 2c0d 0a20  sampleMethod,.. 
+00021280: 2020 2074 6f61 4f72 5352 203d 2074 6f61     toaOrSR = toa
+00021290: 4f72 5352 2c0d 0a20 2020 2063 6f6e 7665  OrSR,..    conve
+000212a0: 7274 546f 4461 696c 794d 6f73 6169 6373  rtToDailyMosaics
+000212b0: 203d 2063 6f6e 7665 7274 546f 4461 696c   = convertToDail
+000212c0: 794d 6f73 6169 6373 2c0d 0a20 2020 2061  yMosaics,..    a
+000212d0: 7070 6c79 436c 6f75 6450 726f 6261 6269  pplyCloudProbabi
+000212e0: 6c69 7479 203d 2061 7070 6c79 436c 6f75  lity = applyClou
+000212f0: 6450 726f 6261 6269 6c69 7479 2c0d 0a20  dProbability,.. 
+00021300: 2020 2070 7265 436f 6d70 7574 6564 436c     preComputedCl
+00021310: 6f75 6453 636f 7265 4f66 6673 6574 203d  oudScoreOffset =
+00021320: 2070 7265 436f 6d70 7574 6564 5365 6e74   preComputedSent
+00021330: 696e 656c 3243 6c6f 7564 5363 6f72 654f  inel2CloudScoreO
+00021340: 6666 7365 742c 0d0a 2020 2020 7072 6543  ffset,..    preC
+00021350: 6f6d 7075 7465 6454 444f 4d49 524d 6561  omputedTDOMIRMea
+00021360: 6e20 3d20 7072 6543 6f6d 7075 7465 6453  n = preComputedS
+00021370: 656e 7469 6e65 6c32 5444 4f4d 4952 4d65  entinel2TDOMIRMe
+00021380: 616e 2c0d 0a20 2020 2070 7265 436f 6d70  an,..    preComp
+00021390: 7574 6564 5444 4f4d 4952 5374 6444 6576  utedTDOMIRStdDev
+000213a0: 203d 2070 7265 436f 6d70 7574 6564 5365   = preComputedSe
+000213b0: 6e74 696e 656c 3254 444f 4d49 5253 7464  ntinel2TDOMIRStd
+000213c0: 4465 762c 0d0a 2020 2020 636c 6f75 6450  Dev,..    cloudP
+000213d0: 726f 6254 6872 6573 6820 3d20 636c 6f75  robThresh = clou
+000213e0: 6450 726f 6254 6872 6573 6829 0d0a 0d0a  dProbThresh)....
+000213f0: 0d0a 2020 2353 656c 6563 7420 6f66 6620  ..  #Select off 
+00021400: 636f 6d6d 6f6e 2062 616e 6473 2062 6574  common bands bet
+00021410: 7765 656e 204c 616e 6473 6174 2061 6e64  ween Landsat and
+00021420: 2053 656e 7469 6e65 6c20 320d 0a20 2063   Sentinel 2..  c
+00021430: 6f6d 6d6f 6e42 616e 6473 203d 2020 5b27  ommonBands =  ['
+00021440: 626c 7565 272c 2027 6772 6565 6e27 2c20  blue', 'green', 
+00021450: 2772 6564 272c 2027 6e69 7227 2c20 2773  'red', 'nir', 's
+00021460: 7769 7231 272c 2027 7377 6972 3227 2c20  wir1', 'swir2', 
+00021470: 2773 656e 736f 7227 5d0d 0a20 206c 7320  'sensor']..  ls 
+00021480: 3d20 6c73 2e73 656c 6563 7428 636f 6d6d  = ls.select(comm
+00021490: 6f6e 4261 6e64 7329 0d0a 2020 7332 7320  onBands)..  s2s 
+000214a0: 3d20 7332 732e 7365 6c65 6374 2863 6f6d  = s2s.select(com
+000214b0: 6d6f 6e42 616e 6473 290d 0a20 2023 4669  monBands)..  #Fi
+000214c0: 6c6c 2069 6e20 616e 7920 656d 7074 7920  ll in any empty 
+000214d0: 636f 6c6c 6563 7469 6f6e 730d 0a20 2023  collections..  #
+000214e0: 4966 2074 6865 7927 7265 2062 6f74 6820  If they're both 
+000214f0: 656d 7074 792c 2074 6869 7320 7769 6c6c  empty, this will
+00021500: 206e 6f74 2077 6f72 6b0d 0a20 2064 756d   not work..  dum
+00021510: 6d79 496d 6167 6520 3d65 652e 496d 6167  myImage =ee.Imag
+00021520: 6528 6565 2e49 6d61 6765 436f 6c6c 6563  e(ee.ImageCollec
+00021530: 7469 6f6e 2865 652e 416c 676f 7269 7468  tion(ee.Algorith
+00021540: 6d73 2e49 6628 6c73 2e74 6f4c 6973 7428  ms.If(ls.toList(
+00021550: 3129 2e6c 656e 6774 6828 292e 6774 2830  1).length().gt(0
+00021560: 292c 6c73 2c73 3273 2929 2e66 6972 7374  ),ls,s2s)).first
+00021570: 2829 290d 0a20 206c 7320 3d20 6669 6c6c  ())..  ls = fill
+00021580: 456d 7074 7943 6f6c 6c65 6374 696f 6e73  EmptyCollections
+00021590: 286c 732c 6475 6d6d 7949 6d61 6765 290d  (ls,dummyImage).
+000215a0: 0a20 2073 3273 203d 2066 696c 6c45 6d70  .  s2s = fillEmp
+000215b0: 7479 436f 6c6c 6563 7469 6f6e 7328 7332  tyCollections(s2
+000215c0: 732c 6475 6d6d 7949 6d61 6765 290d 0a0d  s,dummyImage)...
+000215d0: 0a0d 0a20 2069 6620 7275 6e43 6861 7374  ...  if runChast
+000215e0: 6169 6e48 6172 6d6f 6e69 7a61 7469 6f6e  ainHarmonization
+000215f0: 2061 6e64 2074 6f61 4f72 5352 203d 3d20   and toaOrSR == 
+00021600: 2754 4f41 273a 0d0a 0d0a 2020 2020 2320  'TOA':....    # 
+00021610: 5365 7061 7261 7465 2065 6163 6820 7365  Separate each se
+00021620: 6e73 6f72 0d0a 0d0a 2020 2020 746d 203d  nsor....    tm =
+00021630: 206c 732e 6669 6c74 6572 2865 652e 4669   ls.filter(ee.Fi
+00021640: 6c74 6572 2e69 6e4c 6973 7428 2753 454e  lter.inList('SEN
+00021650: 534f 525f 4944 272c 5b27 544d 272c 2745  SOR_ID',['TM','E
+00021660: 544d 275d 2929 0d0a 2020 2020 6f6c 6920  TM']))..    oli 
+00021670: 3d20 6c73 2e66 696c 7465 7228 6565 2e46  = ls.filter(ee.F
+00021680: 696c 7465 722e 6571 2827 5345 4e53 4f52  ilter.eq('SENSOR
+00021690: 5f49 4427 2c27 4f4c 495f 5449 5253 2729  _ID','OLI_TIRS')
+000216a0: 290d 0a20 2020 2023 2065 6c73 653a 0d0a  )..    # else:..
+000216b0: 2020 2020 2320 2020 746d 203d 206c 732e      #   tm = ls.
+000216c0: 6669 6c74 6572 2865 652e 4669 6c74 6572  filter(ee.Filter
+000216d0: 2e69 6e4c 6973 7428 2773 656e 736f 7227  .inList('sensor'
+000216e0: 2c5b 274c 414e 4453 4154 5f34 272c 274c  ,['LANDSAT_4','L
+000216f0: 414e 4453 4154 5f35 272c 274c 414e 4453  ANDSAT_5','LANDS
+00021700: 4154 5f37 275d 2929 0d0a 2020 2020 2320  AT_7']))..    # 
+00021710: 2020 6f6c 6920 3d20 6c73 2e66 696c 7465    oli = ls.filte
+00021720: 7228 6565 2e46 696c 7465 722e 6571 2827  r(ee.Filter.eq('
+00021730: 7365 6e73 6f72 272c 274c 414e 4453 4154  sensor','LANDSAT
+00021740: 5f38 2729 290d 0a20 2020 206d 7369 203d  _8'))..    msi =
+00021750: 2073 3273 0d0a 0d0a 2020 2020 2320 4669   s2s....    # Fi
+00021760: 6c6c 2069 6620 6e6f 2069 6d61 6765 7320  ll if no images 
+00021770: 6578 6973 7420 666f 7220 7061 7274 6963  exist for partic
+00021780: 756c 6172 204c 616e 6473 6174 2073 656e  ular Landsat sen
+00021790: 736f 720d 0a20 2020 2023 2041 6c6c 6f77  sor..    # Allow
+000217a0: 2069 7420 746f 2066 6169 6c20 6f66 206e   it to fail of n
+000217b0: 6f20 696d 6167 6573 2065 7869 7374 2066  o images exist f
+000217c0: 6f72 2053 656e 7469 6e65 6c20 3220 7369  or Sentinel 2 si
+000217d0: 6e63 6520 7468 6520 706f 696e 740d 0a20  nce the point.. 
+000217e0: 2020 2023 206f 6620 7468 6973 206d 6574     # of this met
+000217f0: 686f 6420 6973 2074 6f20 696e 636c 7564  hod is to includ
+00021800: 6520 5332 0d0a 2020 2020 746d 203d 2066  e S2..    tm = f
+00021810: 696c 6c45 6d70 7479 436f 6c6c 6563 7469  illEmptyCollecti
+00021820: 6f6e 7328 746d 2c20 6565 2e49 6d61 6765  ons(tm, ee.Image
+00021830: 286c 732e 6669 7273 7428 2929 290d 0a20  (ls.first())).. 
+00021840: 2020 206f 6c69 203d 2066 696c 6c45 6d70     oli = fillEmp
+00021850: 7479 436f 6c6c 6563 7469 6f6e 7328 6f6c  tyCollections(ol
+00021860: 692c 2065 652e 496d 6167 6528 6c73 2e66  i, ee.Image(ls.f
+00021870: 6972 7374 2829 2929 0d0a 0d0a 2020 2020  irst()))....    
+00021880: 7072 696e 7428 2752 756e 6e69 6e67 2043  print('Running C
+00021890: 6861 7374 6169 6e20 6574 2061 6c20 3230  hastain et al 20
+000218a0: 3139 2068 6172 6d6f 6e69 7a61 7469 6f6e  19 harmonization
+000218b0: 2729 0d0a 0d0a 2020 2020 2341 7070 6c79  ')....    #Apply
+000218c0: 2063 6f72 7265 6374 696f 6e0d 0a20 2020   correction..   
+000218d0: 2023 4375 7272 656e 746c 7920 636f 6465   #Currently code
+000218e0: 6420 746f 2067 6f20 746f 2045 544d 2b0d  d to go to ETM+.
+000218f0: 0a0d 0a20 2020 2023 4e6f 206e 6565 6420  ...    #No need 
+00021900: 746f 2063 6f72 7265 6374 2045 544d 2074  to correct ETM t
+00021910: 6f20 4554 4d0d 0a20 2020 2023 2074 6d20  o ETM..    # tm 
+00021920: 3d20 746d 2e6d 6170 2866 756e 6374 696f  = tm.map(functio
+00021930: 6e28 696d 6729 7b72 6574 7572 6e20 6765  n(img){return ge
+00021940: 7449 6d61 6765 734c 6962 2e68 6172 6d6f  tImagesLib.harmo
+00021950: 6e69 7a61 7469 6f6e 4368 6173 7461 696e  nizationChastain
+00021960: 2869 6d67 2c20 2745 544d 272c 2745 544d  (img, 'ETM','ETM
+00021970: 2729 7d29 0d0a 2020 2020 2320 6574 6d20  ')})..    # etm 
+00021980: 3d20 6574 6d2e 6d61 7028 6675 6e63 7469  = etm.map(functi
+00021990: 6f6e 2869 6d67 297b 7265 7475 726e 2067  on(img){return g
+000219a0: 6574 496d 6167 6573 4c69 622e 6861 726d  etImagesLib.harm
+000219b0: 6f6e 697a 6174 696f 6e43 6861 7374 6169  onizationChastai
+000219c0: 6e28 696d 672c 2027 4554 4d27 2c27 4554  n(img, 'ETM','ET
+000219d0: 4d27 297d 290d 0a0d 0a20 2020 2023 4861  M')})....    #Ha
+000219e0: 726d 6f6e 697a 6520 7468 6520 6f74 6865  rmonize the othe
+000219f0: 7220 7477 6f0d 0a20 2020 206f 6c69 203d  r two..    oli =
+00021a00: 206f 6c69 2e6d 6170 286c 616d 6264 6120   oli.map(lambda 
+00021a10: 696d 673a 2068 6172 6d6f 6e69 7a61 7469  img: harmonizati
+00021a20: 6f6e 4368 6173 7461 696e 2869 6d67 2c20  onChastain(img, 
+00021a30: 274f 4c49 272c 2745 544d 2729 290d 0a20  'OLI','ETM')).. 
+00021a40: 2020 206d 7369 203d 206d 7369 2e6d 6170     msi = msi.map
+00021a50: 286c 616d 6264 6120 696d 673a 2068 6172  (lambda img: har
+00021a60: 6d6f 6e69 7a61 7469 6f6e 4368 6173 7461  monizationChasta
+00021a70: 696e 2869 6d67 2c20 274d 5349 272c 2745  in(img, 'MSI','E
+00021a80: 544d 2729 290d 0a0d 0a20 2020 2073 3273  TM'))....    s2s
+00021a90: 203d 206d 7369 0d0a 0d0a 2020 2020 234d   = msi....    #M
+00021aa0: 6572 6765 204c 616e 6473 6174 2062 6163  erge Landsat bac
+00021ab0: 6b20 746f 6765 7468 6572 0d0a 2020 2020  k together..    
+00021ac0: 6c73 203d 2065 652e 496d 6167 6543 6f6c  ls = ee.ImageCol
+00021ad0: 6c65 6374 696f 6e28 746d 2e6d 6572 6765  lection(tm.merge
+00021ae0: 286f 6c69 2929 0d0a 0d0a 0d0a 2020 2320  (oli))......  # 
+00021af0: 4d65 7267 6520 4c61 6e64 7361 7420 616e  Merge Landsat an
+00021b00: 6420 5332 0d0a 2020 6d65 7267 6564 203d  d S2..  merged =
+00021b10: 2065 652e 496d 6167 6543 6f6c 6c65 6374   ee.ImageCollect
+00021b20: 696f 6e28 6c73 2e6d 6572 6765 2873 3273  ion(ls.merge(s2s
+00021b30: 2929 0d0a 2020 6d65 7267 6564 203d 206d  ))..  merged = m
+00021b40: 6572 6765 642e 6d61 7028 7369 6d70 6c65  erged.map(simple
+00021b50: 4164 6449 6e64 6963 6573 295c 0d0a 2020  AddIndices)\..  
+00021b60: 2020 2020 2020 2020 2020 2e6d 6170 2867            .map(g
+00021b70: 6574 5461 7373 656c 6564 4361 7029 5c0d  etTasseledCap)\.
+00021b80: 0a20 2020 2020 2020 2020 2020 202e 6d61  .            .ma
+00021b90: 7028 7369 6d70 6c65 4164 6454 4341 6e67  p(simpleAddTCAng
+00021ba0: 6c65 7329 0d0a 0d0a 2020 6d65 7267 6564  les)....  merged
+00021bb0: 203d 206d 6572 6765 642e 7365 7428 6172   = merged.set(ar
+00021bc0: 6773 290d 0a0d 0a0d 0a20 2072 6574 7572  gs)......  retur
+00021bd0: 6e20 6d65 7267 6564 0d0a 2323 2323 2323  n merged..######
+00021be0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00021bf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00021c00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00021c10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00021c20: 2323 2323 2323 2323 2323 230d 0a23 4675  ###########..#Fu
+00021c30: 6e63 7469 6f6e 2074 6f20 7265 6769 7374  nction to regist
+00021c40: 6572 2061 6e20 696d 6167 6543 6f6c 6c65  er an imageColle
+00021c50: 6374 696f 6e20 746f 2069 6d61 6765 7320  ction to images 
+00021c60: 7769 7468 696e 2069 740d 0a23 416c 7761  within it..#Alwa
+00021c70: 7973 2075 7365 7320 7468 6520 6669 7273  ys uses the firs
+00021c80: 7420 696d 6167 6520 6173 2074 6865 2072  t image as the r
+00021c90: 6566 6572 656e 6365 2069 6d61 6765 0d0a  eference image..
+00021ca0: 6465 6620 636f 5265 6769 7374 6572 436f  def coRegisterCo
+00021cb0: 6c6c 6563 7469 6f6e 2869 6d61 6765 732c  llection(images,
+00021cc0: 7265 6665 7265 6e63 6542 616e 6473 203d  referenceBands =
+00021cd0: 205b 276e 6972 275d 293a 0d0a 2020 2020   ['nir']):..    
+00021ce0: 7265 6665 7265 6e63 6549 6d61 6765 496e  referenceImageIn
+00021cf0: 6465 7820 3d20 300d 0a20 2020 2072 6566  dex = 0..    ref
+00021d00: 6572 656e 6365 496d 6167 6520 3d20 6565  erenceImage = ee
+00021d10: 2e49 6d61 6765 2869 6d61 6765 732e 746f  .Image(images.to
+00021d20: 4c69 7374 2872 6566 6572 656e 6365 496d  List(referenceIm
+00021d30: 6167 6549 6e64 6578 2b31 292e 6765 7428  ageIndex+1).get(
+00021d40: 7265 6665 7265 6e63 6549 6d61 6765 496e  referenceImageIn
+00021d50: 6465 7829 292e 7365 6c65 6374 2872 6566  dex)).select(ref
+00021d60: 6572 656e 6365 4261 6e64 7329 0d0a 0d0a  erenceBands)....
+00021d70: 2020 2020 6465 6620 7265 6769 7374 6572      def register
+00021d80: 496d 6167 6528 696d 6167 6529 3a0d 0a20  Image(image):.. 
+00021d90: 2020 2020 2020 2023 4465 7465 726d 696e         #Determin
+00021da0: 6520 7468 6520 6469 7370 6c61 6365 6d65  e the displaceme
+00021db0: 6e74 2062 7920 6d61 7463 6869 6e67 206f  nt by matching o
+00021dc0: 6e6c 7920 7468 6520 7265 6665 7265 6e63  nly the referenc
+00021dd0: 6542 616e 6420 6261 6e64 732e 0d0a 2020  eBand bands...  
+00021de0: 2020 2020 2020 6469 7370 6c61 6365 6d65        displaceme
+00021df0: 6e74 5f70 6172 616d 7320 3d20 7b0d 0a20  nt_params = {.. 
+00021e00: 2020 2020 2020 2020 2020 2027 7265 6665             'refe
+00021e10: 7265 6e63 6549 6d61 6765 273a 2072 6566  renceImage': ref
+00021e20: 6572 656e 6365 496d 6167 652c 0d0a 2020  erenceImage,..  
+00021e30: 2020 2020 2020 2020 2020 276d 6178 4f66            'maxOf
+00021e40: 6673 6574 273a 2032 302e 302c 0d0a 2020  fset': 20.0,..  
+00021e50: 2020 2020 2020 2020 2020 2770 726f 6a65            'proje
+00021e60: 6374 696f 6e27 3a20 4e6f 6e65 2c0d 0a20  ction': None,.. 
+00021e70: 2020 2020 2020 2020 2020 2027 7061 7463             'patc
+00021e80: 6857 6964 7468 273a 2032 302e 302c 0d0a  hWidth': 20.0,..
+00021e90: 2020 2020 2020 2020 2020 2020 2773 7469              'sti
+00021ea0: 6666 6e65 7373 273a 2035 0d0a 2020 2020  ffness': 5..    
+00021eb0: 2020 2020 2020 2020 7d0d 0a20 2020 2020          }..     
+00021ec0: 2020 2064 6973 706c 6163 656d 656e 7420     displacement 
+00021ed0: 3d20 696d 6167 652e 7365 6c65 6374 2872  = image.select(r
+00021ee0: 6566 6572 656e 6365 4261 6e64 7329 2e64  eferenceBands).d
+00021ef0: 6973 706c 6163 656d 656e 7428 2a2a 6469  isplacement(**di
+00021f00: 7370 6c61 6365 6d65 6e74 5f70 6172 616d  splacement_param
+00021f10: 7329 0d0a 2020 2020 2020 2020 7265 7475  s)..        retu
+00021f20: 726e 2069 6d61 6765 2e64 6973 706c 6163  rn image.displac
+00021f30: 6528 6469 7370 6c61 6365 6d65 6e74 290d  e(displacement).
+00021f40: 0a0d 0a20 2020 206f 7574 203d 2065 652e  ...    out = ee.
+00021f50: 496d 6167 6543 6f6c 6c65 6374 696f 6e28  ImageCollection(
+00021f60: 6565 2e49 6d61 6765 436f 6c6c 6563 7469  ee.ImageCollecti
+00021f70: 6f6e 2869 6d61 6765 732e 746f 4c69 7374  on(images.toList
+00021f80: 2831 3030 3030 2c31 2929 2e6d 6170 2872  (10000,1)).map(r
+00021f90: 6567 6973 7465 7249 6d61 6765 2929 2328  egisterImage))#(
+00021fa0: 6565 2e49 6d61 6765 2869 6d61 6765 732e  ee.Image(images.
+00021fb0: 746f 4c69 7374 2831 3030 3030 2c30 292e  toList(10000,0).
+00021fc0: 6765 7428 3129 292c 7265 6665 7265 6e63  get(1)),referenc
+00021fd0: 6549 6d61 6765 290d 0a20 2020 206f 7574  eImage)..    out
+00021fe0: 203d 2065 652e 496d 6167 6543 6f6c 6c65   = ee.ImageColle
+00021ff0: 6374 696f 6e28 696d 6167 6573 2e6c 696d  ction(images.lim
+00022000: 6974 2831 292e 6d65 7267 6528 6f75 7429  it(1).merge(out)
+00022010: 290d 0a0d 0a20 2020 2072 6574 7572 6e20  )....    return 
+00022020: 6f75 740d 0a23 2323 2323 2323 2323 2323  out..###########
+00022030: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00022040: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00022050: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00022060: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00022070: 2323 2323 2323 0d0a 2346 756e 6374 696f  ######..#Functio
+00022080: 6e20 746f 2066 696e 6420 6120 7375 6273  n to find a subs
+00022090: 6574 206f 6620 6120 636f 6c6c 6563 7469  et of a collecti
+000220a0: 6f6e 0d0a 2346 6f72 2065 6163 6820 6772  on..#For each gr
+000220b0: 6f75 7020 2865 2e67 2e20 7469 6c65 206f  oup (e.g. tile o
+000220c0: 7220 6f72 6269 7420 6f72 2070 6174 6829  r orbit or path)
+000220d0: 2c20 616c 6c20 696d 6167 6573 2077 6974  , all images wit
+000220e0: 6869 6e20 7468 6174 2067 726f 7570 2077  hin that group w
+000220f0: 696c 6c20 6265 2072 6567 6973 7465 7265  ill be registere
+00022100: 640d 0a23 4173 2073 696e 676c 6520 636f  d..#As single co
+00022110: 6c6c 6563 7469 6f6e 2069 7320 7265 7475  llection is retu
+00022120: 726e 6564 0d0a 6465 6620 636f 5265 6769  rned..def coRegi
+00022130: 7374 6572 4772 6f75 7073 2869 6d67 732c  sterGroups(imgs,
+00022140: 6669 656c 644e 616d 6520 3d20 2753 454e  fieldName = 'SEN
+00022150: 5349 4e47 5f4f 5242 4954 5f4e 554d 4245  SING_ORBIT_NUMBE
+00022160: 5227 2c66 6965 6c64 4973 4e75 6d65 7269  R',fieldIsNumeri
+00022170: 6320 3d20 5472 7565 293a 0d0a 2020 2020  c = True):..    
+00022180: 6772 6f75 7073 203d 2065 652e 4469 6374  groups = ee.Dict
+00022190: 696f 6e61 7279 2869 6d67 732e 6167 6772  ionary(imgs.aggr
+000221a0: 6567 6174 655f 6869 7374 6f67 7261 6d28  egate_histogram(
+000221b0: 6669 656c 644e 616d 6529 292e 6b65 7973  fieldName)).keys
+000221c0: 2829 0d0a 2020 2020 6966 2066 6965 6c64  ()..    if field
+000221d0: 4973 4e75 6d65 7269 633a 0d0a 2020 2020  IsNumeric:..    
+000221e0: 2020 2020 6772 6f75 7073 203d 2067 726f      groups = gro
+000221f0: 7570 732e 6d61 7028 6c61 6d62 6461 206e  ups.map(lambda n
+00022200: 3a20 6565 2e4e 756d 6265 722e 7061 7273  : ee.Number.pars
+00022210: 6528 6e29 290d 0a0d 0a20 2020 206f 7574  e(n))....    out
+00022220: 203d 6565 2e49 6d61 6765 436f 6c6c 6563   =ee.ImageCollec
+00022230: 7469 6f6e 2865 652e 4665 6174 7572 6543  tion(ee.FeatureC
+00022240: 6f6c 6c65 6374 696f 6e28 6772 6f75 7073  ollection(groups
+00022250: 2e6d 6170 286c 616d 6264 6120 6772 6f75  .map(lambda grou
+00022260: 703a 636f 5265 6769 7374 6572 436f 6c6c  p:coRegisterColl
+00022270: 6563 7469 6f6e 2869 6d67 732e 6669 6c74  ection(imgs.filt
+00022280: 6572 2865 652e 4669 6c74 6572 2e65 7128  er(ee.Filter.eq(
+00022290: 6669 656c 644e 616d 652c 6772 6f75 7029  fieldName,group)
+000222a0: 2929 2929 2e66 6c61 7474 656e 2829 290d  )))).flatten()).
+000222b0: 0a0d 0a20 2020 2072 6574 7572 6e20 6f75  ...    return ou
+000222c0: 740d 0a23 2323 2323 2323 2323 2323 2323  t..#############
+000222d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000222e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000222f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00022300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00022310: 2323 2323 0d0a 6465 6620 6765 744c 616e  ####..def getLan
+00022320: 6473 6174 416e 6453 656e 7469 6e65 6c32  dsatAndSentinel2
+00022330: 4879 6272 6964 5772 6170 7065 7228 5c0d  HybridWrapper(\.
+00022340: 0a20 2073 7475 6479 4172 6561 2c0d 0a20  .  studyArea,.. 
+00022350: 2073 7461 7274 5965 6172 2c0d 0a20 2065   startYear,..  e
+00022360: 6e64 5965 6172 2c0d 0a20 2073 7461 7274  ndYear,..  start
+00022370: 4a75 6c69 616e 2c0d 0a20 2065 6e64 4a75  Julian,..  endJu
+00022380: 6c69 616e 2c0d 0a20 2074 696d 6562 7566  lian,..  timebuf
+00022390: 6665 7220 3d20 2030 2c0d 0a20 2077 6569  fer =  0,..  wei
+000223a0: 6768 7473 203d 2020 5b31 5d2c 0d0a 2020  ghts =  [1],..  
+000223b0: 636f 6d70 6f73 6974 696e 674d 6574 686f  compositingMetho
+000223c0: 6420 3d20 276d 6564 6f69 6427 2c0d 0a20  d = 'medoid',.. 
+000223d0: 2074 6f61 4f72 5352 203d 2027 544f 4127   toaOrSR = 'TOA'
+000223e0: 2c0d 0a20 2069 6e63 6c75 6465 534c 434f  ,..  includeSLCO
+000223f0: 6666 4c37 203d 2046 616c 7365 2c0d 0a20  ffL7 = False,.. 
+00022400: 2064 6566 7269 6e67 654c 3520 3d20 4661   defringeL5 = Fa
+00022410: 6c73 652c 0d0a 2020 6170 706c 7951 4142  lse,..  applyQAB
+00022420: 616e 6420 3d20 4661 6c73 652c 0d0a 2020  and = False,..  
+00022430: 6170 706c 7943 6c6f 7564 5072 6f62 6162  applyCloudProbab
+00022440: 696c 6974 7920 3d20 5472 7565 2c0d 0a20  ility = True,.. 
+00022450: 2061 7070 6c79 5368 6164 6f77 5368 6966   applyShadowShif
+00022460: 7420 3d20 4661 6c73 652c 0d0a 2020 6170  t = False,..  ap
+00022470: 706c 7943 6c6f 7564 5363 6f72 654c 616e  plyCloudScoreLan
+00022480: 6473 6174 203d 2046 616c 7365 2c0d 0a20  dsat = False,.. 
+00022490: 2061 7070 6c79 436c 6f75 6453 636f 7265   applyCloudScore
+000224a0: 5365 6e74 696e 656c 3220 3d20 4661 6c73  Sentinel2 = Fals
+000224b0: 652c 0d0a 2020 6170 706c 7954 444f 4d4c  e,..  applyTDOML
+000224c0: 616e 6473 6174 203d 2054 7275 652c 0d0a  andsat = True,..
+000224d0: 2020 6170 706c 7954 444f 4d53 656e 7469    applyTDOMSenti
+000224e0: 6e65 6c32 203d 2054 7275 652c 0d0a 2020  nel2 = True,..  
+000224f0: 6170 706c 7946 6d61 736b 436c 6f75 644d  applyFmaskCloudM
+00022500: 6173 6b20 3d20 5472 7565 2c0d 0a20 2061  ask = True,..  a
+00022510: 7070 6c79 466d 6173 6b43 6c6f 7564 5368  pplyFmaskCloudSh
+00022520: 6164 6f77 4d61 736b 203d 2054 7275 652c  adowMask = True,
+00022530: 0d0a 2020 6170 706c 7946 6d61 736b 536e  ..  applyFmaskSn
+00022540: 6f77 4d61 736b 203d 2046 616c 7365 2c0d  owMask = False,.
+00022550: 0a20 2063 6c6f 7564 4865 6967 6874 7320  .  cloudHeights 
+00022560: 3d20 6565 2e4c 6973 742e 7365 7175 656e  = ee.List.sequen
+00022570: 6365 2835 3030 2c31 3030 3030 2c35 3030  ce(500,10000,500
+00022580: 292c 0d0a 2020 636c 6f75 6453 636f 7265  ),..  cloudScore
+00022590: 5468 7265 7368 203d 2032 302c 0d0a 2020  Thresh = 20,..  
+000225a0: 7065 7266 6f72 6d43 6c6f 7564 5363 6f72  performCloudScor
+000225b0: 654f 6666 7365 7420 3d20 5472 7565 2c0d  eOffset = True,.
+000225c0: 0a20 2063 6c6f 7564 5363 6f72 6550 6374  .  cloudScorePct
+000225d0: 6c20 3d20 3130 2c0d 0a20 207a 5363 6f72  l = 10,..  zScor
+000225e0: 6554 6872 6573 6820 3d20 2d31 2c0d 0a20  eThresh = -1,.. 
+000225f0: 2073 6861 646f 7753 756d 5468 7265 7368   shadowSumThresh
+00022600: 203d 2030 2e33 352c 0d0a 2020 636f 6e74   = 0.35,..  cont
+00022610: 7261 6374 5069 7865 6c73 203d 2031 2e35  ractPixels = 1.5
+00022620: 2c0d 0a20 2064 696c 6174 6550 6978 656c  ,..  dilatePixel
+00022630: 7320 3d20 332e 352c 0d0a 2020 7368 6164  s = 3.5,..  shad
+00022640: 6f77 5375 6d42 616e 6473 203d 205b 276e  owSumBands = ['n
+00022650: 6972 272c 2773 7769 7231 275d 2c0d 0a20  ir','swir1'],.. 
+00022660: 206c 616e 6473 6174 5265 7361 6d70 6c65   landsatResample
+00022670: 4d65 7468 6f64 203d 2027 6e65 6172 272c  Method = 'near',
+00022680: 0d0a 2020 7365 6e74 696e 656c 3252 6573  ..  sentinel2Res
+00022690: 616d 706c 654d 6574 686f 6420 3d20 2761  ampleMethod = 'a
+000226a0: 6767 7265 6761 7465 272c 0d0a 2020 636f  ggregate',..  co
+000226b0: 6e76 6572 7454 6f44 6169 6c79 4d6f 7361  nvertToDailyMosa
+000226c0: 6963 7320 3d20 5472 7565 2c0d 0a20 2072  ics = True,..  r
+000226d0: 756e 4368 6173 7461 696e 4861 726d 6f6e  unChastainHarmon
+000226e0: 697a 6174 696f 6e20 3d20 5472 7565 2c0d  ization = True,.
+000226f0: 0a20 2063 6f72 7265 6374 496c 6c75 6d69  .  correctIllumi
+00022700: 6e61 7469 6f6e 203d 2046 616c 7365 2c0d  nation = False,.
+00022710: 0a20 2063 6f72 7265 6374 5363 616c 6520  .  correctScale 
+00022720: 3d20 3235 302c 0d0a 2020 6578 706f 7274  = 250,..  export
+00022730: 436f 6d70 6f73 6974 6573 203d 2046 616c  Composites = Fal
+00022740: 7365 2c0d 0a20 206f 7574 7075 744e 616d  se,..  outputNam
+00022750: 6520 3d20 274c 616e 6473 6174 2d53 656e  e = 'Landsat-Sen
+00022760: 7469 6e65 6c32 2d48 7962 7269 6427 2c0d  tinel2-Hybrid',.
+00022770: 0a20 2065 7870 6f72 7450 6174 6852 6f6f  .  exportPathRoo
+00022780: 7420 3d20 4e6f 6e65 2c0d 0a20 2063 7273  t = None,..  crs
+00022790: 203d 2027 4550 5347 3a35 3037 3027 2c0d   = 'EPSG:5070',.
+000227a0: 0a20 2074 7261 6e73 666f 726d 203d 205b  .  transform = [
+000227b0: 3330 2c30 2c2d 3233 3631 3931 352e 302c  30,0,-2361915.0,
+000227c0: 302c 2d33 302c 3331 3737 3733 352e 305d  0,-30,3177735.0]
+000227d0: 2c0d 0a20 2073 6361 6c65 203d 204e 6f6e  ,..  scale = Non
+000227e0: 652c 0d0a 2020 7072 6543 6f6d 7075 7465  e,..  preCompute
+000227f0: 644c 616e 6473 6174 436c 6f75 6453 636f  dLandsatCloudSco
+00022800: 7265 4f66 6673 6574 203d 204e 6f6e 652c  reOffset = None,
+00022810: 0d0a 2020 7072 6543 6f6d 7075 7465 644c  ..  preComputedL
+00022820: 616e 6473 6174 5444 4f4d 4952 4d65 616e  andsatTDOMIRMean
+00022830: 203d 204e 6f6e 652c 0d0a 2020 7072 6543   = None,..  preC
+00022840: 6f6d 7075 7465 644c 616e 6473 6174 5444  omputedLandsatTD
+00022850: 4f4d 4952 5374 6444 6576 203d 204e 6f6e  OMIRStdDev = Non
+00022860: 652c 0d0a 2020 7072 6543 6f6d 7075 7465  e,..  preCompute
+00022870: 6453 656e 7469 6e65 6c32 436c 6f75 6453  dSentinel2CloudS
+00022880: 636f 7265 4f66 6673 6574 203d 204e 6f6e  coreOffset = Non
+00022890: 652c 0d0a 2020 7072 6543 6f6d 7075 7465  e,..  preCompute
+000228a0: 6453 656e 7469 6e65 6c32 5444 4f4d 4952  dSentinel2TDOMIR
+000228b0: 4d65 616e 203d 204e 6f6e 652c 0d0a 2020  Mean = None,..  
+000228c0: 7072 6543 6f6d 7075 7465 6453 656e 7469  preComputedSenti
+000228d0: 6e65 6c32 5444 4f4d 4952 5374 6444 6576  nel2TDOMIRStdDev
+000228e0: 203d 204e 6f6e 652c 0d0a 2020 636c 6f75   = None,..  clou
+000228f0: 6450 726f 6254 6872 6573 6820 3d20 3430  dProbThresh = 40
+00022900: 2c0d 0a20 206c 616e 6473 6174 436f 6c6c  ,..  landsatColl
+00022910: 6563 7469 6f6e 5665 7273 696f 6e20 3d20  ectionVersion = 
+00022920: 2743 3227 293a 0d0a 0d0a 2020 6f72 6967  'C2'):....  orig
+00022930: 696e 203d 2027 4c61 6e64 7361 742d 5365  in = 'Landsat-Se
+00022940: 6e74 696e 656c 322d 4879 6272 6964 270d  ntinel2-Hybrid'.
+00022950: 0a20 2074 6f61 4f72 5352 203d 2074 6f61  .  toaOrSR = toa
+00022960: 4f72 5352 2e75 7070 6572 2829 0d0a 0d0a  OrSR.upper()....
+00022970: 2020 6172 6773 203d 2066 6f72 6d61 7441    args = formatA
+00022980: 7267 7328 6c6f 6361 6c73 2829 290d 0a20  rgs(locals()).. 
+00022990: 2069 6620 2761 7267 7327 2069 6e20 6172   if 'args' in ar
+000229a0: 6773 2e6b 6579 7328 293a 0d0a 2020 2020  gs.keys():..    
+000229b0: 6465 6c20 6172 6773 5b27 6172 6773 275d  del args['args']
+000229c0: 0d0a 0d0a 2020 6d65 7267 6564 203d 2067  ....  merged = g
+000229d0: 6574 5072 6f63 6573 7365 644c 616e 6473  etProcessedLands
+000229e0: 6174 416e 6453 656e 7469 6e65 6c32 5363  atAndSentinel2Sc
+000229f0: 656e 6573 285c 0d0a 2020 2020 7374 7564  enes(\..    stud
+00022a00: 7941 7265 6120 3d20 7374 7564 7941 7265  yArea = studyAre
+00022a10: 612c 0d0a 2020 2020 7374 6172 7459 6561  a,..    startYea
+00022a20: 7220 3d20 7374 6172 7459 6561 722c 0d0a  r = startYear,..
+00022a30: 2020 2020 656e 6459 6561 7220 3d20 656e      endYear = en
+00022a40: 6459 6561 722c 0d0a 2020 2020 7374 6172  dYear,..    star
+00022a50: 744a 756c 6961 6e20 3d20 7374 6172 744a  tJulian = startJ
+00022a60: 756c 6961 6e2c 0d0a 2020 2020 656e 644a  ulian,..    endJ
+00022a70: 756c 6961 6e20 3d20 656e 644a 756c 6961  ulian = endJulia
+00022a80: 6e2c 0d0a 2020 2020 746f 614f 7253 5220  n,..    toaOrSR 
+00022a90: 3d20 746f 614f 7253 522c 0d0a 2020 2020  = toaOrSR,..    
+00022aa0: 696e 636c 7564 6553 4c43 4f66 664c 3720  includeSLCOffL7 
+00022ab0: 3d20 696e 636c 7564 6553 4c43 4f66 664c  = includeSLCOffL
+00022ac0: 372c 0d0a 2020 2020 6465 6672 696e 6765  7,..    defringe
+00022ad0: 4c35 203d 2064 6566 7269 6e67 654c 352c  L5 = defringeL5,
+00022ae0: 0d0a 2020 2020 6170 706c 7951 4142 616e  ..    applyQABan
+00022af0: 6420 3d20 6170 706c 7951 4142 616e 642c  d = applyQABand,
+00022b00: 0d0a 2020 2020 6170 706c 7943 6c6f 7564  ..    applyCloud
+00022b10: 5072 6f62 6162 696c 6974 7920 3d20 6170  Probability = ap
+00022b20: 706c 7943 6c6f 7564 5072 6f62 6162 696c  plyCloudProbabil
+00022b30: 6974 792c 0d0a 2020 2020 6170 706c 7953  ity,..    applyS
+00022b40: 6861 646f 7753 6869 6674 203d 2061 7070  hadowShift = app
+00022b50: 6c79 5368 6164 6f77 5368 6966 742c 0d0a  lyShadowShift,..
+00022b60: 2020 2020 6170 706c 7943 6c6f 7564 5363      applyCloudSc
+00022b70: 6f72 654c 616e 6473 6174 203d 2061 7070  oreLandsat = app
+00022b80: 6c79 436c 6f75 6453 636f 7265 4c61 6e64  lyCloudScoreLand
+00022b90: 7361 742c 0d0a 2020 2020 6170 706c 7943  sat,..    applyC
+00022ba0: 6c6f 7564 5363 6f72 6553 656e 7469 6e65  loudScoreSentine
+00022bb0: 6c32 203d 2061 7070 6c79 436c 6f75 6453  l2 = applyCloudS
+00022bc0: 636f 7265 5365 6e74 696e 656c 322c 0d0a  coreSentinel2,..
+00022bd0: 2020 2020 6170 706c 7954 444f 4d4c 616e      applyTDOMLan
+00022be0: 6473 6174 203d 2061 7070 6c79 5444 4f4d  dsat = applyTDOM
+00022bf0: 4c61 6e64 7361 742c 0d0a 2020 2020 6170  Landsat,..    ap
+00022c00: 706c 7954 444f 4d53 656e 7469 6e65 6c32  plyTDOMSentinel2
+00022c10: 203d 2061 7070 6c79 5444 4f4d 5365 6e74   = applyTDOMSent
+00022c20: 696e 656c 322c 0d0a 2020 2020 6170 706c  inel2,..    appl
+00022c30: 7946 6d61 736b 436c 6f75 644d 6173 6b20  yFmaskCloudMask 
+00022c40: 3d20 6170 706c 7946 6d61 736b 436c 6f75  = applyFmaskClou
+00022c50: 644d 6173 6b2c 0d0a 2020 2020 6170 706c  dMask,..    appl
+00022c60: 7946 6d61 736b 436c 6f75 6453 6861 646f  yFmaskCloudShado
+00022c70: 774d 6173 6b20 3d20 6170 706c 7946 6d61  wMask = applyFma
+00022c80: 736b 436c 6f75 6453 6861 646f 774d 6173  skCloudShadowMas
+00022c90: 6b2c 0d0a 2020 2020 6170 706c 7946 6d61  k,..    applyFma
+00022ca0: 736b 536e 6f77 4d61 736b 203d 2061 7070  skSnowMask = app
+00022cb0: 6c79 466d 6173 6b53 6e6f 774d 6173 6b2c  lyFmaskSnowMask,
+00022cc0: 0d0a 2020 2020 636c 6f75 6448 6569 6768  ..    cloudHeigh
+00022cd0: 7473 203d 2063 6c6f 7564 4865 6967 6874  ts = cloudHeight
+00022ce0: 732c 0d0a 2020 2020 636c 6f75 6453 636f  s,..    cloudSco
+00022cf0: 7265 5468 7265 7368 203d 2063 6c6f 7564  reThresh = cloud
+00022d00: 5363 6f72 6554 6872 6573 682c 0d0a 2020  ScoreThresh,..  
+00022d10: 2020 7065 7266 6f72 6d43 6c6f 7564 5363    performCloudSc
+00022d20: 6f72 654f 6666 7365 7420 3d20 7065 7266  oreOffset = perf
+00022d30: 6f72 6d43 6c6f 7564 5363 6f72 654f 6666  ormCloudScoreOff
+00022d40: 7365 742c 0d0a 2020 2020 636c 6f75 6453  set,..    cloudS
+00022d50: 636f 7265 5063 746c 203d 2063 6c6f 7564  corePctl = cloud
+00022d60: 5363 6f72 6550 6374 6c2c 0d0a 2020 2020  ScorePctl,..    
+00022d70: 7a53 636f 7265 5468 7265 7368 203d 207a  zScoreThresh = z
+00022d80: 5363 6f72 6554 6872 6573 682c 0d0a 2020  ScoreThresh,..  
+00022d90: 2020 7368 6164 6f77 5375 6d54 6872 6573    shadowSumThres
+00022da0: 6820 3d20 7368 6164 6f77 5375 6d54 6872  h = shadowSumThr
+00022db0: 6573 682c 0d0a 2020 2020 636f 6e74 7261  esh,..    contra
+00022dc0: 6374 5069 7865 6c73 203d 2063 6f6e 7472  ctPixels = contr
+00022dd0: 6163 7450 6978 656c 732c 0d0a 2020 2020  actPixels,..    
+00022de0: 6469 6c61 7465 5069 7865 6c73 203d 2064  dilatePixels = d
+00022df0: 696c 6174 6550 6978 656c 732c 0d0a 2020  ilatePixels,..  
+00022e00: 2020 7368 6164 6f77 5375 6d42 616e 6473    shadowSumBands
+00022e10: 203d 2073 6861 646f 7753 756d 4261 6e64   = shadowSumBand
+00022e20: 732c 0d0a 2020 2020 6c61 6e64 7361 7452  s,..    landsatR
+00022e30: 6573 616d 706c 654d 6574 686f 6420 3d20  esampleMethod = 
+00022e40: 6c61 6e64 7361 7452 6573 616d 706c 654d  landsatResampleM
+00022e50: 6574 686f 642c 0d0a 2020 2020 7365 6e74  ethod,..    sent
+00022e60: 696e 656c 3252 6573 616d 706c 654d 6574  inel2ResampleMet
+00022e70: 686f 6420 3d20 7365 6e74 696e 656c 3252  hod = sentinel2R
+00022e80: 6573 616d 706c 654d 6574 686f 642c 0d0a  esampleMethod,..
+00022e90: 2020 2020 636f 6e76 6572 7454 6f44 6169      convertToDai
+00022ea0: 6c79 4d6f 7361 6963 7320 3d20 636f 6e76  lyMosaics = conv
+00022eb0: 6572 7454 6f44 6169 6c79 4d6f 7361 6963  ertToDailyMosaic
+00022ec0: 732c 0d0a 2020 2020 7275 6e43 6861 7374  s,..    runChast
+00022ed0: 6169 6e48 6172 6d6f 6e69 7a61 7469 6f6e  ainHarmonization
+00022ee0: 203d 2072 756e 4368 6173 7461 696e 4861   = runChastainHa
+00022ef0: 726d 6f6e 697a 6174 696f 6e2c 0d0a 2020  rmonization,..  
+00022f00: 2020 636f 7272 6563 7449 6c6c 756d 696e    correctIllumin
+00022f10: 6174 696f 6e20 3d20 636f 7272 6563 7449  ation = correctI
+00022f20: 6c6c 756d 696e 6174 696f 6e2c 0d0a 2020  llumination,..  
+00022f30: 2020 636f 7272 6563 7453 6361 6c65 203d    correctScale =
+00022f40: 2063 6f72 7265 6374 5363 616c 652c 0d0a   correctScale,..
+00022f50: 2020 2020 7072 6543 6f6d 7075 7465 644c      preComputedL
+00022f60: 616e 6473 6174 436c 6f75 6453 636f 7265  andsatCloudScore
+00022f70: 4f66 6673 6574 203d 2070 7265 436f 6d70  Offset = preComp
+00022f80: 7574 6564 4c61 6e64 7361 7443 6c6f 7564  utedLandsatCloud
+00022f90: 5363 6f72 654f 6666 7365 742c 0d0a 2020  ScoreOffset,..  
+00022fa0: 2020 7072 6543 6f6d 7075 7465 644c 616e    preComputedLan
+00022fb0: 6473 6174 5444 4f4d 4952 4d65 616e 203d  dsatTDOMIRMean =
+00022fc0: 2070 7265 436f 6d70 7574 6564 4c61 6e64   preComputedLand
+00022fd0: 7361 7454 444f 4d49 524d 6561 6e2c 0d0a  satTDOMIRMean,..
+00022fe0: 2020 2020 7072 6543 6f6d 7075 7465 644c      preComputedL
+00022ff0: 616e 6473 6174 5444 4f4d 4952 5374 6444  andsatTDOMIRStdD
+00023000: 6576 203d 2070 7265 436f 6d70 7574 6564  ev = preComputed
+00023010: 4c61 6e64 7361 7454 444f 4d49 5253 7464  LandsatTDOMIRStd
+00023020: 4465 762c 0d0a 2020 2020 7072 6543 6f6d  Dev,..    preCom
+00023030: 7075 7465 6453 656e 7469 6e65 6c32 436c  putedSentinel2Cl
+00023040: 6f75 6453 636f 7265 4f66 6673 6574 203d  oudScoreOffset =
+00023050: 2070 7265 436f 6d70 7574 6564 5365 6e74   preComputedSent
+00023060: 696e 656c 3243 6c6f 7564 5363 6f72 654f  inel2CloudScoreO
+00023070: 6666 7365 742c 0d0a 2020 2020 7072 6543  ffset,..    preC
+00023080: 6f6d 7075 7465 6453 656e 7469 6e65 6c32  omputedSentinel2
+00023090: 5444 4f4d 4952 4d65 616e 203d 2070 7265  TDOMIRMean = pre
+000230a0: 436f 6d70 7574 6564 5365 6e74 696e 656c  ComputedSentinel
+000230b0: 3254 444f 4d49 524d 6561 6e2c 0d0a 2020  2TDOMIRMean,..  
+000230c0: 2020 7072 6543 6f6d 7075 7465 6453 656e    preComputedSen
+000230d0: 7469 6e65 6c32 5444 4f4d 4952 5374 6444  tinel2TDOMIRStdD
+000230e0: 6576 203d 2070 7265 436f 6d70 7574 6564  ev = preComputed
+000230f0: 5365 6e74 696e 656c 3254 444f 4d49 5253  Sentinel2TDOMIRS
+00023100: 7464 4465 762c 0d0a 2020 2020 636c 6f75  tdDev,..    clou
+00023110: 6450 726f 6254 6872 6573 6820 3d20 636c  dProbThresh = cl
+00023120: 6f75 6450 726f 6254 6872 6573 682c 0d0a  oudProbThresh,..
+00023130: 2020 2020 6c61 6e64 7361 7443 6f6c 6c65      landsatColle
+00023140: 6374 696f 6e56 6572 7369 6f6e 203d 206c  ctionVersion = l
+00023150: 616e 6473 6174 436f 6c6c 6563 7469 6f6e  andsatCollection
+00023160: 5665 7273 696f 6e29 0d0a 0d0a 2020 2343  Version)....  #C
+00023170: 7265 6174 6520 6879 6272 6964 2063 6f6d  reate hybrid com
+00023180: 706f 7369 7465 730d 0a20 2063 6f6d 706f  posites..  compo
+00023190: 7369 7465 7320 3d20 636f 6d70 6f73 6974  sites = composit
+000231a0: 6554 696d 6553 6572 6965 7328 5c0d 0a20  eTimeSeries(\.. 
+000231b0: 2020 206c 7320 3d20 6d65 7267 6564 2c0d     ls = merged,.
+000231c0: 0a20 2020 2073 7461 7274 5965 6172 203d  .    startYear =
+000231d0: 2073 7461 7274 5965 6172 2c0d 0a20 2020   startYear,..   
+000231e0: 2065 6e64 5965 6172 203d 2065 6e64 5965   endYear = endYe
+000231f0: 6172 2c0d 0a20 2020 2073 7461 7274 4a75  ar,..    startJu
+00023200: 6c69 616e 203d 2073 7461 7274 4a75 6c69  lian = startJuli
+00023210: 616e 2c0d 0a20 2020 2065 6e64 4a75 6c69  an,..    endJuli
+00023220: 616e 203d 2065 6e64 4a75 6c69 616e 2c0d  an = endJulian,.
+00023230: 0a20 2020 2074 696d 6562 7566 6665 7220  .    timebuffer 
+00023240: 3d20 7469 6d65 6275 6666 6572 2c0d 0a20  = timebuffer,.. 
+00023250: 2020 2077 6569 6768 7473 203d 2077 6569     weights = wei
+00023260: 6768 7473 2c0d 0a20 2020 2063 6f6d 706f  ghts,..    compo
+00023270: 7369 7469 6e67 4d65 7468 6f64 203d 2063  sitingMethod = c
+00023280: 6f6d 706f 7369 7469 6e67 4d65 7468 6f64  ompositingMethod
+00023290: 290d 0a0d 0a20 2023 2045 7870 6f72 7420  )....  # Export 
+000232a0: 636f 6d70 6f73 6974 6520 636f 6c6c 6563  composite collec
+000232b0: 7469 6f6e 0d0a 2020 6966 2065 7870 6f72  tion..  if expor
+000232c0: 7443 6f6d 706f 7369 7465 733a 0d0a 0d0a  tComposites:....
+000232d0: 2020 2020 6578 706f 7274 4261 6e64 4469      exportBandDi
+000232e0: 6374 203d 207b 5c0d 0a20 2020 2020 2027  ct = {\..      '
+000232f0: 6d65 646f 6964 273a 5b27 626c 7565 272c  medoid':['blue',
+00023300: 2027 6772 6565 6e27 2c20 2772 6564 272c   'green', 'red',
+00023310: 276e 6972 272c 2773 7769 7231 272c 2027  'nir','swir1', '
+00023320: 7377 6972 3227 2c27 636f 6d70 6f73 6974  swir2','composit
+00023330: 654f 6273 436f 756e 7427 2c27 7365 6e73  eObsCount','sens
+00023340: 6f72 272c 2779 6561 7227 2c27 6a75 6c69  or','year','juli
+00023350: 616e 4461 7927 5d2c 0d0a 2020 2020 2020  anDay'],..      
+00023360: 276d 6564 6961 6e27 3a5b 2762 6c75 6527  'median':['blue'
+00023370: 2c20 2767 7265 656e 272c 2027 7265 6427  , 'green', 'red'
+00023380: 2c27 6e69 7227 2c27 7377 6972 3127 2c20  ,'nir','swir1', 
+00023390: 2773 7769 7232 272c 2763 6f6d 706f 7369  'swir2','composi
+000233a0: 7465 4f62 7343 6f75 6e74 275d 5c0d 0a20  teObsCount']\.. 
+000233b0: 2020 207d 3b0d 0a20 2020 206e 6f6e 4469     };..    nonDi
+000233c0: 7669 6465 4261 6e64 4469 6374 203d 207b  videBandDict = {
+000233d0: 5c0d 0a20 2020 2020 2027 6d65 646f 6964  \..      'medoid
+000233e0: 273a 5b27 636f 6d70 6f73 6974 654f 6273  ':['compositeObs
+000233f0: 436f 756e 7427 2c27 7365 6e73 6f72 272c  Count','sensor',
+00023400: 2779 6561 7227 2c27 6a75 6c69 616e 4461  'year','julianDa
+00023410: 7927 5d2c 0d0a 2020 2020 2020 276d 6564  y'],..      'med
+00023420: 6961 6e27 3a5b 2763 6f6d 706f 7369 7465  ian':['composite
+00023430: 4f62 7343 6f75 6e74 275d 5c0d 0a20 2020  ObsCount']\..   
+00023440: 207d 3b0d 0a20 2020 2065 7870 6f72 7442   };..    exportB
+00023450: 616e 6473 203d 2065 7870 6f72 7442 616e  ands = exportBan
+00023460: 6444 6963 745b 636f 6d70 6f73 6974 696e  dDict[compositin
+00023470: 674d 6574 686f 645d 0d0a 2020 2020 6e6f  gMethod]..    no
+00023480: 6e44 6976 6964 6542 616e 6473 203d 206e  nDivideBands = n
+00023490: 6f6e 4469 7669 6465 4261 6e64 4469 6374  onDivideBandDict
+000234a0: 5b63 6f6d 706f 7369 7469 6e67 4d65 7468  [compositingMeth
+000234b0: 6f64 5d0d 0a0d 0a20 2020 2065 7870 6f72  od]....    expor
+000234c0: 7443 6f6d 706f 7369 7465 436f 6c6c 6563  tCompositeCollec
+000234d0: 7469 6f6e 285c 0d0a 2020 2020 2020 636f  tion(\..      co
+000234e0: 6c6c 6563 7469 6f6e 203d 2063 6f6d 706f  llection = compo
+000234f0: 7369 7465 732c 0d0a 2020 2020 2020 6578  sites,..      ex
+00023500: 706f 7274 5061 7468 526f 6f74 203d 2065  portPathRoot = e
+00023510: 7870 6f72 7450 6174 6852 6f6f 742c 0d0a  xportPathRoot,..
+00023520: 2020 2020 2020 6f75 7470 7574 4e61 6d65        outputName
+00023530: 203d 206f 7574 7075 744e 616d 652c 0d0a   = outputName,..
+00023540: 2020 2020 2020 6f72 6967 696e 203d 206f        origin = o
+00023550: 7269 6769 6e2c 0d0a 2020 2020 2020 7374  rigin,..      st
+00023560: 7564 7941 7265 6120 3d20 7374 7564 7941  udyArea = studyA
+00023570: 7265 612c 0d0a 2020 2020 2020 6372 7320  rea,..      crs 
+00023580: 3d20 6372 732c 0d0a 2020 2020 2020 7472  = crs,..      tr
+00023590: 616e 7366 6f72 6d20 3d20 7472 616e 7366  ansform = transf
+000235a0: 6f72 6d2c 0d0a 2020 2020 2020 7363 616c  orm,..      scal
+000235b0: 6520 3d20 7363 616c 652c 0d0a 2020 2020  e = scale,..    
+000235c0: 2020 7374 6172 7459 6561 7220 3d20 7374    startYear = st
+000235d0: 6172 7459 6561 722c 0d0a 2020 2020 2020  artYear,..      
+000235e0: 656e 6459 6561 7220 3d20 656e 6459 6561  endYear = endYea
+000235f0: 722c 0d0a 2020 2020 2020 7374 6172 744a  r,..      startJ
+00023600: 756c 6961 6e20 3d20 7374 6172 744a 756c  ulian = startJul
+00023610: 6961 6e2c 0d0a 2020 2020 2020 656e 644a  ian,..      endJ
+00023620: 756c 6961 6e20 3d20 656e 644a 756c 6961  ulian = endJulia
+00023630: 6e2c 0d0a 2020 2020 2020 636f 6d70 6f73  n,..      compos
+00023640: 6974 696e 674d 6574 686f 6420 3d20 636f  itingMethod = co
+00023650: 6d70 6f73 6974 696e 674d 6574 686f 642c  mpositingMethod,
+00023660: 0d0a 2020 2020 2020 7469 6d65 6275 6666  ..      timebuff
+00023670: 6572 203d 2074 696d 6562 7566 6665 722c  er = timebuffer,
+00023680: 0d0a 2020 2020 2020 746f 614f 7253 5220  ..      toaOrSR 
+00023690: 3d20 746f 614f 7253 522c 0d0a 2020 2020  = toaOrSR,..    
+000236a0: 2020 6e6f 6e44 6976 6964 6542 616e 6473    nonDivideBands
+000236b0: 203d 206e 6f6e 4469 7669 6465 4261 6e64   = nonDivideBand
+000236c0: 732c 0d0a 2020 2020 2020 6578 706f 7274  s,..      export
+000236d0: 4261 6e64 7320 3d20 6578 706f 7274 4261  Bands = exportBa
+000236e0: 6e64 732c 0d0a 2020 2020 2020 6164 6469  nds,..      addi
+000236f0: 7469 6f6e 616c 5072 6f70 6572 7479 4469  tionalPropertyDi
+00023700: 6374 203d 2061 7267 7329 0d0a 0d0a 2020  ct = args)....  
+00023710: 6172 6773 5b27 7072 6f63 6573 7365 6453  args['processedS
+00023720: 6365 6e65 7327 5d20 3d20 6d65 7267 6564  cenes'] = merged
+00023730: 0d0a 2020 6172 6773 5b27 7072 6f63 6573  ..  args['proces
+00023740: 7365 6443 6f6d 706f 7369 7465 7327 5d20  sedComposites'] 
+00023750: 3d20 636f 6d70 6f73 6974 6573 0d0a 0d0a  = composites....
+00023760: 2020 7265 7475 726e 2061 7267 730d 0a0d    return args...
+00023770: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+00023780: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00023790: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000237a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000237b0: 2323 2323 2323 2323 2323 0d0a 2323 2323  ##########..####
+000237c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000237d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000237e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000237f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00023800: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00023810: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
+00023800: 2323 2323 230d 0a23 4861 726d 6f6e 6963  #####..#Harmonic
+00023810: 2072 6567 7265 7373 696f 6e0d 0a23 2323   regression..###
 00023820: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00023830: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00023840: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00023850: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00023860: 2323 2323 2323 2323 0d0a 2348 6172 6d6f  ########..#Harmo
-00023870: 6e69 6320 7265 6772 6573 7369 6f6e 0d0a  nic regression..
+00023860: 2323 2323 2323 0d0a 2323 2323 2323 2323  ######..########
+00023870: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00023880: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00023890: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000238a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000238b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000238c0: 2323 2323 2323 2323 230d 0a23 2323 2323  #########..#####
-000238d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000238e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000238f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00023900: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00023910: 2323 2323 0d0a 2346 756e 6374 696f 6e20  ####..#Function 
-00023920: 746f 2067 6976 6520 7965 6172 2e64 6420  to give year.dd 
-00023930: 696d 6167 6520 616e 6420 6861 726d 6f6e  image and harmon
-00023940: 6963 7320 6c69 7374 2028 652e 672e 205b  ics list (e.g. [
-00023950: 312c 322c 332c 2e2e 2e5d 290d 0a64 6566  1,2,3,...])..def
-00023960: 2067 6574 4861 726d 6f6e 6963 4c69 7374   getHarmonicList
-00023970: 2879 6561 7244 6174 6549 6d67 2c74 7261  (yearDateImg,tra
-00023980: 6e73 666f 726d 4261 6e64 4e61 6d65 2c68  nsformBandName,h
-00023990: 6172 6d6f 6e69 634c 6973 7429 3a0d 0a20  armonicList):.. 
-000239a0: 2074 3d20 7965 6172 4461 7465 496d 672e   t= yearDateImg.
-000239b0: 7365 6c65 6374 285b 7472 616e 7366 6f72  select([transfor
-000239c0: 6d42 616e 644e 616d 655d 290d 0a20 2073  mBandName])..  s
-000239d0: 656c 6563 7442 616e 6473 203d 2065 652e  electBands = ee.
-000239e0: 4c69 7374 2e73 6571 7565 6e63 6528 302c  List.sequence(0,
-000239f0: 6c65 6e28 6861 726d 6f6e 6963 4c69 7374  len(harmonicList
-00023a00: 292d 3129 0d0a 0d0a 2020 6465 6620 7369  )-1)....  def si
-00023a10: 6e43 6174 2868 293a 0d0a 2020 2020 6874  nCat(h):..    ht
-00023a20: 203d 2068 2a31 3030 0d0a 2020 2020 7265   = h*100..    re
-00023a30: 7475 726e 2065 652e 5374 7269 6e67 2827  turn ee.String('
-00023a40: 7369 6e5f 2729 2e63 6174 2873 7472 2868  sin_').cat(str(h
-00023a50: 7429 292e 6361 7428 275f 2729 2e63 6174  t)).cat('_').cat
-00023a60: 2874 7261 6e73 666f 726d 4261 6e64 4e61  (transformBandNa
-00023a70: 6d65 290d 0a20 2073 696e 4e61 6d65 7320  me)..  sinNames 
-00023a80: 3d20 6c69 7374 286d 6170 286c 616d 6264  = list(map(lambd
-00023a90: 6120 693a 7369 6e43 6174 2869 292c 6861  a i:sinCat(i),ha
-00023aa0: 726d 6f6e 6963 4c69 7374 2929 0d0a 0d0a  rmonicList))....
-00023ab0: 2020 6465 6620 636f 7343 6174 2868 293a    def cosCat(h):
-00023ac0: 0d0a 2020 2020 6874 203d 682a 3130 303b  ..    ht =h*100;
-00023ad0: 0d0a 2020 2020 7265 7475 726e 2065 652e  ..    return ee.
-00023ae0: 5374 7269 6e67 2827 636f 735f 2729 2e63  String('cos_').c
-00023af0: 6174 2873 7472 2868 7429 292e 6361 7428  at(str(ht)).cat(
-00023b00: 275f 2729 2e63 6174 2874 7261 6e73 666f  '_').cat(transfo
-00023b10: 726d 4261 6e64 4e61 6d65 290d 0a0d 0a20  rmBandName).... 
-00023b20: 2063 6f73 4e61 6d65 7320 3d20 6c69 7374   cosNames = list
-00023b30: 286d 6170 286c 616d 6264 6120 6920 3a20  (map(lambda i : 
-00023b40: 636f 7343 6174 2869 292c 6861 726d 6f6e  cosCat(i),harmon
-00023b50: 6963 4c69 7374 2929 0d0a 0d0a 0d0a 0d0a  icList))........
-00023b60: 2020 6d75 6c74 6970 6c69 6572 7320 3d20    multipliers = 
-00023b70: 6565 2e49 6d61 6765 2868 6172 6d6f 6e69  ee.Image(harmoni
-00023b80: 634c 6973 7429 2e6d 756c 7469 706c 7928  cList).multiply(
-00023b90: 6565 2e4e 756d 6265 7228 6d61 7468 2e70  ee.Number(math.p
-00023ba0: 6929 2e66 6c6f 6174 2829 290d 0a20 2073  i).float())..  s
-00023bb0: 696e 496e 6420 3d20 2874 2e6d 756c 7469  inInd = (t.multi
-00023bc0: 706c 7928 6565 2e49 6d61 6765 286d 756c  ply(ee.Image(mul
-00023bd0: 7469 706c 6965 7273 2929 292e 7369 6e28  tipliers))).sin(
-00023be0: 292e 7365 6c65 6374 2873 656c 6563 7442  ).select(selectB
-00023bf0: 616e 6473 2c73 696e 4e61 6d65 7329 2e66  ands,sinNames).f
-00023c00: 6c6f 6174 2829 0d0a 2020 636f 7349 6e64  loat()..  cosInd
-00023c10: 203d 2028 742e 6d75 6c74 6970 6c79 2865   = (t.multiply(e
-00023c20: 652e 496d 6167 6528 6d75 6c74 6970 6c69  e.Image(multipli
-00023c30: 6572 7329 2929 2e63 6f73 2829 2e73 656c  ers))).cos().sel
-00023c40: 6563 7428 7365 6c65 6374 4261 6e64 732c  ect(selectBands,
-00023c50: 636f 734e 616d 6573 292e 666c 6f61 7428  cosNames).float(
-00023c60: 290d 0a0d 0a20 2072 6574 7572 6e20 7965  )....  return ye
-00023c70: 6172 4461 7465 496d 672e 6164 6442 616e  arDateImg.addBan
-00023c80: 6473 2873 696e 496e 642e 6164 6442 616e  ds(sinInd.addBan
-00023c90: 6473 2863 6f73 496e 6429 290d 0a0d 0a23  ds(cosInd))....#
+000238b0: 230d 0a23 4675 6e63 7469 6f6e 2074 6f20  #..#Function to 
+000238c0: 6769 7665 2079 6561 722e 6464 2069 6d61  give year.dd ima
+000238d0: 6765 2061 6e64 2068 6172 6d6f 6e69 6373  ge and harmonics
+000238e0: 206c 6973 7420 2865 2e67 2e20 5b31 2c32   list (e.g. [1,2
+000238f0: 2c33 2c2e 2e2e 5d29 0d0a 6465 6620 6765  ,3,...])..def ge
+00023900: 7448 6172 6d6f 6e69 634c 6973 7428 7965  tHarmonicList(ye
+00023910: 6172 4461 7465 496d 672c 7472 616e 7366  arDateImg,transf
+00023920: 6f72 6d42 616e 644e 616d 652c 6861 726d  ormBandName,harm
+00023930: 6f6e 6963 4c69 7374 293a 0d0a 2020 743d  onicList):..  t=
+00023940: 2079 6561 7244 6174 6549 6d67 2e73 656c   yearDateImg.sel
+00023950: 6563 7428 5b74 7261 6e73 666f 726d 4261  ect([transformBa
+00023960: 6e64 4e61 6d65 5d29 0d0a 2020 7365 6c65  ndName])..  sele
+00023970: 6374 4261 6e64 7320 3d20 6565 2e4c 6973  ctBands = ee.Lis
+00023980: 742e 7365 7175 656e 6365 2830 2c6c 656e  t.sequence(0,len
+00023990: 2868 6172 6d6f 6e69 634c 6973 7429 2d31  (harmonicList)-1
+000239a0: 290d 0a0d 0a20 2064 6566 2073 696e 4361  )....  def sinCa
+000239b0: 7428 6829 3a0d 0a20 2020 2068 7420 3d20  t(h):..    ht = 
+000239c0: 682a 3130 300d 0a20 2020 2072 6574 7572  h*100..    retur
+000239d0: 6e20 6565 2e53 7472 696e 6728 2773 696e  n ee.String('sin
+000239e0: 5f27 292e 6361 7428 7374 7228 6874 2929  _').cat(str(ht))
+000239f0: 2e63 6174 2827 5f27 292e 6361 7428 7472  .cat('_').cat(tr
+00023a00: 616e 7366 6f72 6d42 616e 644e 616d 6529  ansformBandName)
+00023a10: 0d0a 2020 7369 6e4e 616d 6573 203d 206c  ..  sinNames = l
+00023a20: 6973 7428 6d61 7028 6c61 6d62 6461 2069  ist(map(lambda i
+00023a30: 3a73 696e 4361 7428 6929 2c68 6172 6d6f  :sinCat(i),harmo
+00023a40: 6e69 634c 6973 7429 290d 0a0d 0a20 2064  nicList))....  d
+00023a50: 6566 2063 6f73 4361 7428 6829 3a0d 0a20  ef cosCat(h):.. 
+00023a60: 2020 2068 7420 3d68 2a31 3030 3b0d 0a20     ht =h*100;.. 
+00023a70: 2020 2072 6574 7572 6e20 6565 2e53 7472     return ee.Str
+00023a80: 696e 6728 2763 6f73 5f27 292e 6361 7428  ing('cos_').cat(
+00023a90: 7374 7228 6874 2929 2e63 6174 2827 5f27  str(ht)).cat('_'
+00023aa0: 292e 6361 7428 7472 616e 7366 6f72 6d42  ).cat(transformB
+00023ab0: 616e 644e 616d 6529 0d0a 0d0a 2020 636f  andName)....  co
+00023ac0: 734e 616d 6573 203d 206c 6973 7428 6d61  sNames = list(ma
+00023ad0: 7028 6c61 6d62 6461 2069 203a 2063 6f73  p(lambda i : cos
+00023ae0: 4361 7428 6929 2c68 6172 6d6f 6e69 634c  Cat(i),harmonicL
+00023af0: 6973 7429 290d 0a0d 0a0d 0a0d 0a20 206d  ist))........  m
+00023b00: 756c 7469 706c 6965 7273 203d 2065 652e  ultipliers = ee.
+00023b10: 496d 6167 6528 6861 726d 6f6e 6963 4c69  Image(harmonicLi
+00023b20: 7374 292e 6d75 6c74 6970 6c79 2865 652e  st).multiply(ee.
+00023b30: 4e75 6d62 6572 286d 6174 682e 7069 292e  Number(math.pi).
+00023b40: 666c 6f61 7428 2929 0d0a 2020 7369 6e49  float())..  sinI
+00023b50: 6e64 203d 2028 742e 6d75 6c74 6970 6c79  nd = (t.multiply
+00023b60: 2865 652e 496d 6167 6528 6d75 6c74 6970  (ee.Image(multip
+00023b70: 6c69 6572 7329 2929 2e73 696e 2829 2e73  liers))).sin().s
+00023b80: 656c 6563 7428 7365 6c65 6374 4261 6e64  elect(selectBand
+00023b90: 732c 7369 6e4e 616d 6573 292e 666c 6f61  s,sinNames).floa
+00023ba0: 7428 290d 0a20 2063 6f73 496e 6420 3d20  t()..  cosInd = 
+00023bb0: 2874 2e6d 756c 7469 706c 7928 6565 2e49  (t.multiply(ee.I
+00023bc0: 6d61 6765 286d 756c 7469 706c 6965 7273  mage(multipliers
+00023bd0: 2929 292e 636f 7328 292e 7365 6c65 6374  ))).cos().select
+00023be0: 2873 656c 6563 7442 616e 6473 2c63 6f73  (selectBands,cos
+00023bf0: 4e61 6d65 7329 2e66 6c6f 6174 2829 0d0a  Names).float()..
+00023c00: 0d0a 2020 7265 7475 726e 2079 6561 7244  ..  return yearD
+00023c10: 6174 6549 6d67 2e61 6464 4261 6e64 7328  ateImg.addBands(
+00023c20: 7369 6e49 6e64 2e61 6464 4261 6e64 7328  sinInd.addBands(
+00023c30: 636f 7349 6e64 2929 0d0a 0d0a 2323 2323  cosInd))....####
+00023c40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00023c50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00023c60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00023c70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00023c80: 2323 2323 230d 0a23 2323 2323 2323 2323  #####..#########
+00023c90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00023ca0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00023cb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00023cc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00023cd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00023ce0: 2323 2323 2323 2323 0d0a 2323 2323 2323  ########..######
-00023cf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00023d00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00023d10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00023d20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00023d30: 2323 230d 0a23 5461 6b65 7320 6120 6465  ###..#Takes a de
-00023d40: 7065 6e64 656e 7420 616e 6420 696e 6465  pendent and inde
-00023d50: 7065 6e64 656e 7420 7661 7269 6162 6c65  pendent variable
-00023d60: 2061 6e64 2072 6574 7572 6e73 2074 6865   and returns the
-00023d70: 2064 6570 656e 6465 6e74 2c0d 0a23 2073   dependent,..# s
-00023d80: 696e 206f 6620 696e 642c 2061 6e64 2063  in of ind, and c
-00023d90: 6f73 206f 6620 696e 640d 0a23 496e 7465  os of ind..#Inte
-00023da0: 6e64 6564 2066 6f72 2068 6172 6d6f 6e69  nded for harmoni
-00023db0: 6320 7265 6772 6573 7369 6f6e 0d0a 6465  c regression..de
-00023dc0: 6620 6765 7448 6172 6d6f 6e69 6373 3228  f getHarmonics2(
-00023dd0: 636f 6c6c 6563 7469 6f6e 2c74 7261 6e73  collection,trans
-00023de0: 666f 726d 4261 6e64 4e61 6d65 2c68 6172  formBandName,har
-00023df0: 6d6f 6e69 634c 6973 742c 6465 7472 656e  monicList,detren
-00023e00: 6420 3d20 4661 6c73 6529 3a0d 0a0d 0a20  d = False):.... 
-00023e10: 2064 6570 4261 6e64 4e61 6d65 7320 3d20   depBandNames = 
-00023e20: 6565 2e49 6d61 6765 2863 6f6c 6c65 6374  ee.Image(collect
-00023e30: 696f 6e2e 6669 7273 7428 2929 2e62 616e  ion.first()).ban
-00023e40: 644e 616d 6573 2829 2e72 656d 6f76 6528  dNames().remove(
-00023e50: 7472 616e 7366 6f72 6d42 616e 644e 616d  transformBandNam
-00023e60: 6529 0d0a 2020 6465 7042 616e 644e 756d  e)..  depBandNum
-00023e70: 6265 7273 203d 2064 6570 4261 6e64 4e61  bers = depBandNa
-00023e80: 6d65 732e 6d61 7028 6c61 6d62 6461 2064  mes.map(lambda d
-00023e90: 626e 3a64 6570 4261 6e64 4e61 6d65 732e  bn:depBandNames.
-00023ea0: 696e 6465 784f 6628 6462 6e29 290d 0a0d  indexOf(dbn))...
-00023eb0: 0a20 2064 6566 2068 6172 6d57 7261 7028  .  def harmWrap(
-00023ec0: 696d 6729 3a0d 0a20 2020 206f 7574 5420  img):..    outT 
-00023ed0: 3d20 6765 7448 6172 6d6f 6e69 634c 6973  = getHarmonicLis
-00023ee0: 7428 696d 672c 7472 616e 7366 6f72 6d42  t(img,transformB
-00023ef0: 616e 644e 616d 652c 6861 726d 6f6e 6963  andName,harmonic
-00023f00: 4c69 7374 295c 0d0a 2020 2020 2e63 6f70  List)\..    .cop
-00023f10: 7950 726f 7065 7274 6965 7328 696d 672c  yProperties(img,
-00023f20: 5b27 7379 7374 656d 3a74 696d 655f 7374  ['system:time_st
-00023f30: 6172 7427 2c27 7379 7374 656d 3a74 696d  art','system:tim
-00023f40: 655f 656e 6427 5d29 0d0a 2020 2020 7265  e_end'])..    re
-00023f50: 7475 726e 206f 7574 540d 0a20 206f 7574  turn outT..  out
-00023f60: 203d 2063 6f6c 6c65 6374 696f 6e2e 6d61   = collection.ma
-00023f70: 7028 6861 726d 5772 6170 290d 0a0d 0a20  p(harmWrap).... 
-00023f80: 2069 6620 6e6f 7420 6465 7472 656e 643a   if not detrend:
-00023f90: 0d0a 2020 2020 6f75 7442 616e 644e 616d  ..    outBandNam
-00023fa0: 6573 203d 2065 652e 496d 6167 6528 6f75  es = ee.Image(ou
-00023fb0: 742e 6669 7273 7428 2929 2e62 616e 644e  t.first()).bandN
-00023fc0: 616d 6573 2829 2e72 656d 6f76 6541 6c6c  ames().removeAll
-00023fd0: 285b 2779 6561 7227 5d29 0d0a 2020 2020  (['year'])..    
-00023fe0: 6f75 7420 3d20 6f75 742e 7365 6c65 6374  out = out.select
-00023ff0: 286f 7574 4261 6e64 4e61 6d65 7329 0d0a  (outBandNames)..
-00024000: 0d0a 0d0a 2020 696e 6442 616e 644e 616d  ....  indBandNam
-00024010: 6573 203d 2065 652e 496d 6167 6528 6f75  es = ee.Image(ou
-00024020: 742e 6669 7273 7428 2929 2e62 616e 644e  t.first()).bandN
-00024030: 616d 6573 2829 2e72 656d 6f76 6541 6c6c  ames().removeAll
-00024040: 2864 6570 4261 6e64 4e61 6d65 7329 0d0a  (depBandNames)..
-00024050: 2020 696e 6442 616e 644e 756d 6265 7273    indBandNumbers
-00024060: 203d 2069 6e64 4261 6e64 4e61 6d65 732e   = indBandNames.
-00024070: 6d61 7028 6c61 6d62 6461 2069 6e64 3a20  map(lambda ind: 
-00024080: 6565 2e49 6d61 6765 286f 7574 2e66 6972  ee.Image(out.fir
-00024090: 7374 2829 292e 6261 6e64 4e61 6d65 7328  st()).bandNames(
-000240a0: 292e 696e 6465 784f 6628 696e 6429 290d  ).indexOf(ind)).
-000240b0: 0a0d 0a0d 0a20 206f 7574 203d 206f 7574  .....  out = out
-000240c0: 2e73 6574 287b 2769 6e64 4261 6e64 4e61  .set({'indBandNa
-000240d0: 6d65 7327 3a69 6e64 4261 6e64 4e61 6d65  mes':indBandName
-000240e0: 732c 2764 6570 4261 6e64 4e61 6d65 7327  s,'depBandNames'
-000240f0: 3a64 6570 4261 6e64 4e61 6d65 732c 5c0d  :depBandNames,\.
-00024100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024110: 2027 696e 6442 616e 644e 756d 6265 7273   'indBandNumbers
-00024120: 273a 696e 6442 616e 644e 756d 6265 7273  ':indBandNumbers
-00024130: 2c27 6465 7042 616e 644e 756d 6265 7273  ,'depBandNumbers
-00024140: 273a 6465 7042 616e 644e 756d 6265 7273  ':depBandNumbers
-00024150: 7d29 0d0a 0d0a 2020 7265 7475 726e 206f  })....  return o
-00024160: 7574 0d0a 0d0a 2323 2323 2323 2323 2323  ut....##########
+00023cd0: 0d0a 2354 616b 6573 2061 2064 6570 656e  ..#Takes a depen
+00023ce0: 6465 6e74 2061 6e64 2069 6e64 6570 656e  dent and indepen
+00023cf0: 6465 6e74 2076 6172 6961 626c 6520 616e  dent variable an
+00023d00: 6420 7265 7475 726e 7320 7468 6520 6465  d returns the de
+00023d10: 7065 6e64 656e 742c 0d0a 2320 7369 6e20  pendent,..# sin 
+00023d20: 6f66 2069 6e64 2c20 616e 6420 636f 7320  of ind, and cos 
+00023d30: 6f66 2069 6e64 0d0a 2349 6e74 656e 6465  of ind..#Intende
+00023d40: 6420 666f 7220 6861 726d 6f6e 6963 2072  d for harmonic r
+00023d50: 6567 7265 7373 696f 6e0d 0a64 6566 2067  egression..def g
+00023d60: 6574 4861 726d 6f6e 6963 7332 2863 6f6c  etHarmonics2(col
+00023d70: 6c65 6374 696f 6e2c 7472 616e 7366 6f72  lection,transfor
+00023d80: 6d42 616e 644e 616d 652c 6861 726d 6f6e  mBandName,harmon
+00023d90: 6963 4c69 7374 2c64 6574 7265 6e64 203d  icList,detrend =
+00023da0: 2046 616c 7365 293a 0d0a 0d0a 2020 6465   False):....  de
+00023db0: 7042 616e 644e 616d 6573 203d 2065 652e  pBandNames = ee.
+00023dc0: 496d 6167 6528 636f 6c6c 6563 7469 6f6e  Image(collection
+00023dd0: 2e66 6972 7374 2829 292e 6261 6e64 4e61  .first()).bandNa
+00023de0: 6d65 7328 292e 7265 6d6f 7665 2874 7261  mes().remove(tra
+00023df0: 6e73 666f 726d 4261 6e64 4e61 6d65 290d  nsformBandName).
+00023e00: 0a20 2064 6570 4261 6e64 4e75 6d62 6572  .  depBandNumber
+00023e10: 7320 3d20 6465 7042 616e 644e 616d 6573  s = depBandNames
+00023e20: 2e6d 6170 286c 616d 6264 6120 6462 6e3a  .map(lambda dbn:
+00023e30: 6465 7042 616e 644e 616d 6573 2e69 6e64  depBandNames.ind
+00023e40: 6578 4f66 2864 626e 2929 0d0a 0d0a 2020  exOf(dbn))....  
+00023e50: 6465 6620 6861 726d 5772 6170 2869 6d67  def harmWrap(img
+00023e60: 293a 0d0a 2020 2020 6f75 7454 203d 2067  ):..    outT = g
+00023e70: 6574 4861 726d 6f6e 6963 4c69 7374 2869  etHarmonicList(i
+00023e80: 6d67 2c74 7261 6e73 666f 726d 4261 6e64  mg,transformBand
+00023e90: 4e61 6d65 2c68 6172 6d6f 6e69 634c 6973  Name,harmonicLis
+00023ea0: 7429 5c0d 0a20 2020 202e 636f 7079 5072  t)\..    .copyPr
+00023eb0: 6f70 6572 7469 6573 2869 6d67 2c5b 2773  operties(img,['s
+00023ec0: 7973 7465 6d3a 7469 6d65 5f73 7461 7274  ystem:time_start
+00023ed0: 272c 2773 7973 7465 6d3a 7469 6d65 5f65  ','system:time_e
+00023ee0: 6e64 275d 290d 0a20 2020 2072 6574 7572  nd'])..    retur
+00023ef0: 6e20 6f75 7454 0d0a 2020 6f75 7420 3d20  n outT..  out = 
+00023f00: 636f 6c6c 6563 7469 6f6e 2e6d 6170 2868  collection.map(h
+00023f10: 6172 6d57 7261 7029 0d0a 0d0a 2020 6966  armWrap)....  if
+00023f20: 206e 6f74 2064 6574 7265 6e64 3a0d 0a20   not detrend:.. 
+00023f30: 2020 206f 7574 4261 6e64 4e61 6d65 7320     outBandNames 
+00023f40: 3d20 6565 2e49 6d61 6765 286f 7574 2e66  = ee.Image(out.f
+00023f50: 6972 7374 2829 292e 6261 6e64 4e61 6d65  irst()).bandName
+00023f60: 7328 292e 7265 6d6f 7665 416c 6c28 5b27  s().removeAll(['
+00023f70: 7965 6172 275d 290d 0a20 2020 206f 7574  year'])..    out
+00023f80: 203d 206f 7574 2e73 656c 6563 7428 6f75   = out.select(ou
+00023f90: 7442 616e 644e 616d 6573 290d 0a0d 0a0d  tBandNames).....
+00023fa0: 0a20 2069 6e64 4261 6e64 4e61 6d65 7320  .  indBandNames 
+00023fb0: 3d20 6565 2e49 6d61 6765 286f 7574 2e66  = ee.Image(out.f
+00023fc0: 6972 7374 2829 292e 6261 6e64 4e61 6d65  irst()).bandName
+00023fd0: 7328 292e 7265 6d6f 7665 416c 6c28 6465  s().removeAll(de
+00023fe0: 7042 616e 644e 616d 6573 290d 0a20 2069  pBandNames)..  i
+00023ff0: 6e64 4261 6e64 4e75 6d62 6572 7320 3d20  ndBandNumbers = 
+00024000: 696e 6442 616e 644e 616d 6573 2e6d 6170  indBandNames.map
+00024010: 286c 616d 6264 6120 696e 643a 2065 652e  (lambda ind: ee.
+00024020: 496d 6167 6528 6f75 742e 6669 7273 7428  Image(out.first(
+00024030: 2929 2e62 616e 644e 616d 6573 2829 2e69  )).bandNames().i
+00024040: 6e64 6578 4f66 2869 6e64 2929 0d0a 0d0a  ndexOf(ind))....
+00024050: 0d0a 2020 6f75 7420 3d20 6f75 742e 7365  ..  out = out.se
+00024060: 7428 7b27 696e 6442 616e 644e 616d 6573  t({'indBandNames
+00024070: 273a 696e 6442 616e 644e 616d 6573 2c27  ':indBandNames,'
+00024080: 6465 7042 616e 644e 616d 6573 273a 6465  depBandNames':de
+00024090: 7042 616e 644e 616d 6573 2c5c 0d0a 2020  pBandNames,\..  
+000240a0: 2020 2020 2020 2020 2020 2020 2020 2769                'i
+000240b0: 6e64 4261 6e64 4e75 6d62 6572 7327 3a69  ndBandNumbers':i
+000240c0: 6e64 4261 6e64 4e75 6d62 6572 732c 2764  ndBandNumbers,'d
+000240d0: 6570 4261 6e64 4e75 6d62 6572 7327 3a64  epBandNumbers':d
+000240e0: 6570 4261 6e64 4e75 6d62 6572 737d 290d  epBandNumbers}).
+000240f0: 0a0d 0a20 2072 6574 7572 6e20 6f75 740d  ...  return out.
+00024100: 0a0d 0a23 2323 2323 2323 2323 2323 2323  ...#############
+00024110: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00024120: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00024130: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00024140: 2323 2323 2323 2323 2323 2323 0d0a 2323  ############..##
+00024150: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00024160: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00024170: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00024180: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00024190: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000241a0: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
-000241b0: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
-000241c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000241d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000241e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000241f0: 2323 2323 2323 2323 2323 0d0a 2353 696d  ##########..#Sim
-00024200: 706c 6966 6965 7320 7468 6520 7573 6520  plifies the use 
-00024210: 6f66 2074 6865 2072 6f62 7573 7420 6c69  of the robust li
-00024220: 6e65 6172 2072 6567 7265 7373 696f 6e20  near regression 
-00024230: 7265 6475 6365 720d 0a23 4173 7375 6d65  reducer..#Assume
-00024240: 7320 7468 6520 6465 7065 6e64 656e 7420  s the dependent 
-00024250: 6973 2074 6865 2066 6972 7374 2062 616e  is the first ban
-00024260: 6420 616e 6420 616c 6c20 7375 6273 6571  d and all subseq
-00024270: 7565 6e74 2062 616e 6473 2061 7265 2069  uent bands are i
-00024280: 6e64 6570 656e 6465 6e74 730d 0a64 6566  ndependents..def
-00024290: 206e 6577 526f 6275 7374 4d75 6c74 6970   newRobustMultip
-000242a0: 6c65 4c69 6e65 6172 3228 6465 7065 6e64  leLinear2(depend
-000242b0: 656e 7473 496e 6465 7065 6e64 656e 7473  entsIndependents
-000242c0: 293a 0d0a 2020 2353 6574 2075 7020 7468  ):..  #Set up th
-000242d0: 6520 6261 6e64 206e 616d 6573 0d0a 0d0a  e band names....
-000242e0: 2020 6465 7065 6e64 656e 7442 616e 6473    dependentBands
-000242f0: 203d 2065 652e 4c69 7374 2864 6570 656e   = ee.List(depen
-00024300: 6465 6e74 7349 6e64 6570 656e 6465 6e74  dentsIndependent
-00024310: 732e 6765 7428 2764 6570 4261 6e64 4e75  s.get('depBandNu
-00024320: 6d62 6572 7327 2929 0d0a 2020 696e 6465  mbers'))..  inde
-00024330: 7065 6e64 656e 7442 616e 6473 203d 2065  pendentBands = e
-00024340: 652e 4c69 7374 2864 6570 656e 6465 6e74  e.List(dependent
-00024350: 7349 6e64 6570 656e 6465 6e74 732e 6765  sIndependents.ge
-00024360: 7428 2769 6e64 4261 6e64 4e75 6d62 6572  t('indBandNumber
-00024370: 7327 2929 0d0a 2020 626e 7320 3d20 6565  s'))..  bns = ee
-00024380: 2e49 6d61 6765 2864 6570 656e 6465 6e74  .Image(dependent
-00024390: 7349 6e64 6570 656e 6465 6e74 732e 6669  sIndependents.fi
-000243a0: 7273 7428 2929 2e62 616e 644e 616d 6573  rst()).bandNames
-000243b0: 2829 0d0a 2020 6465 7065 6e64 656e 7473  ()..  dependents
-000243c0: 203d 2065 652e 4c69 7374 2864 6570 656e   = ee.List(depen
-000243d0: 6465 6e74 7349 6e64 6570 656e 6465 6e74  dentsIndependent
-000243e0: 732e 6765 7428 2764 6570 4261 6e64 4e61  s.get('depBandNa
-000243f0: 6d65 7327 2929 0d0a 2020 696e 6465 7065  mes'))..  indepe
-00024400: 6e64 656e 7473 203d 2065 652e 4c69 7374  ndents = ee.List
-00024410: 2864 6570 656e 6465 6e74 7349 6e64 6570  (dependentsIndep
-00024420: 656e 6465 6e74 732e 6765 7428 2769 6e64  endents.get('ind
-00024430: 4261 6e64 4e61 6d65 7327 2929 0d0a 0d0a  BandNames'))....
-00024440: 2020 2364 6570 656e 6465 6e74 203d 2062    #dependent = b
-00024450: 6e73 2e73 6c69 6365 2830 2c31 290d 0a20  ns.slice(0,1).. 
-00024460: 2023 696e 6465 7065 6e64 656e 7473 203d   #independents =
-00024470: 2062 6e73 2e73 6c69 6365 2831 2c6e 756c   bns.slice(1,nul
-00024480: 6c29 0d0a 2020 6e6f 496e 6465 7065 6e64  l)..  noIndepend
-00024490: 656e 7473 203d 2069 6e64 6570 656e 6465  ents = independe
-000244a0: 6e74 732e 6c65 6e67 7468 2829 2e61 6464  nts.length().add
-000244b0: 2831 290d 0a20 206e 6f44 6570 656e 6465  (1)..  noDepende
-000244c0: 6e74 7320 3d20 6465 7065 6e64 656e 7473  nts = dependents
-000244d0: 2e6c 656e 6774 6828 290d 0a0d 0a20 206f  .length()....  o
-000244e0: 7574 4e61 6d65 7320 3d20 6565 2e4c 6973  utNames = ee.Lis
-000244f0: 7428 5b27 696e 7465 7263 6570 7427 5d29  t(['intercept'])
-00024500: 2e63 6174 2869 6e64 6570 656e 6465 6e74  .cat(independent
-00024510: 7329 0d0a 0d0a 2020 2341 6464 2063 6f6e  s)....  #Add con
-00024520: 7374 616e 7420 6261 6e64 2066 6f72 2069  stant band for i
-00024530: 6e74 6572 6365 7074 2061 6e64 2072 656f  ntercept and reo
-00024540: 7264 6572 2066 6f72 0d0a 2020 2373 796e  rder for..  #syn
-00024550: 7461 783a 2063 6f6e 7374 616e 742c 2069  tax: constant, i
-00024560: 6e64 312c 696e 6432 2c69 6e64 332c 696e  nd1,ind2,ind3,in
-00024570: 646e 2c64 6570 656e 6465 6e74 0d0a 2020  dn,dependent..  
-00024580: 6465 6620 666f 7246 6974 4675 6e28 696d  def forFitFun(im
-00024590: 6729 3a0d 0a20 2020 206f 7574 203d 2069  g):..    out = i
-000245a0: 6d67 2e61 6464 4261 6e64 7328 6565 2e49  mg.addBands(ee.I
-000245b0: 6d61 6765 2831 292e 7365 6c65 6374 285b  mage(1).select([
-000245c0: 305d 2c5b 2763 6f6e 7374 616e 7427 5d29  0],['constant'])
-000245d0: 290d 0a20 2020 206f 7574 203d 206f 7574  )..    out = out
-000245e0: 2e73 656c 6563 7428 6565 2e4c 6973 7428  .select(ee.List(
-000245f0: 5b27 636f 6e73 7461 6e74 272c 696e 6465  ['constant',inde
-00024600: 7065 6e64 656e 7473 5d29 2e66 6c61 7474  pendents]).flatt
-00024610: 656e 2829 290d 0a20 2020 2072 6574 7572  en())..    retur
-00024620: 6e20 6f75 742e 6164 6442 616e 6473 2869  n out.addBands(i
-00024630: 6d67 2e73 656c 6563 7428 6465 7065 6e64  mg.select(depend
-00024640: 656e 7473 2929 0d0a 0d0a 0d0a 2020 666f  ents))......  fo
-00024650: 7246 6974 203d 2064 6570 656e 6465 6e74  rFit = dependent
-00024660: 7349 6e64 6570 656e 6465 6e74 732e 6d61  sIndependents.ma
-00024670: 7028 666f 7246 6974 4675 6e29 0d0a 0d0a  p(forFitFun)....
-00024680: 2020 2341 7070 6c79 2072 6564 7563 6572    #Apply reducer
-00024690: 2c20 616e 6420 636f 6e76 6572 7420 6261  , and convert ba
-000246a0: 636b 2074 6f20 696d 6167 6520 7769 7468  ck to image with
-000246b0: 2072 6573 7065 6374 6976 6520 6261 6e64   respective band
-000246c0: 4e61 6d65 730d 0a20 2072 6564 7563 6572  Names..  reducer
-000246d0: 4f75 7420 3d20 666f 7246 6974 2e72 6564  Out = forFit.red
-000246e0: 7563 6528 6565 2e52 6564 7563 6572 2e6c  uce(ee.Reducer.l
-000246f0: 696e 6561 7252 6567 7265 7373 696f 6e28  inearRegression(
-00024700: 6e6f 496e 6465 7065 6e64 656e 7473 2c6e  noIndependents,n
-00024710: 6f44 6570 656e 6465 6e74 7329 290d 0a20  oDependents)).. 
-00024720: 2023 202f 2f20 7465 7374 203d 2066 6f72   # // test = for
-00024730: 4669 742e 7265 6475 6365 2865 652e 5265  Fit.reduce(ee.Re
-00024740: 6475 6365 722e 726f 6275 7374 4c69 6e65  ducer.robustLine
-00024750: 6172 5265 6772 6573 7369 6f6e 286e 6f49  arRegression(noI
-00024760: 6e64 6570 656e 6465 6e74 732c 6e6f 4465  ndependents,noDe
-00024770: 7065 6e64 656e 7473 2c30 2e32 2929 0d0a  pendents,0.2))..
-00024780: 2020 2320 2f2f 2072 6573 6964 7320 3d20    # // resids = 
-00024790: 7465 7374 0d0a 2020 2320 2f2f 202e 7365  test..  # // .se
-000247a0: 6c65 6374 285b 315d 2c5b 2772 6573 6964  lect([1],['resid
-000247b0: 7561 6c73 275d 292e 6172 7261 7946 6c61  uals']).arrayFla
-000247c0: 7474 656e 285b 6465 7065 6e64 656e 7473  tten([dependents
-000247d0: 5d29 3b0d 0a20 2023 202f 2f20 4d61 702e  ]);..  # // Map.
-000247e0: 6164 644c 6179 6572 2872 6573 6964 732c  addLayer(resids,
-000247f0: 7b7d 2c27 7265 7369 6473 496d 6167 6527  {},'residsImage'
-00024800: 293b 0d0a 2020 2320 2f2f 204d 6170 2e61  );..  # // Map.a
-00024810: 6464 4c61 7965 7228 7265 6475 6365 724f  ddLayer(reducerO
-00024820: 7574 2e73 656c 6563 7428 5b30 5d29 2c7b  ut.select([0]),{
-00024830: 7d2c 2763 6f65 6666 6963 6965 6e74 7327  },'coefficients'
-00024840: 293b 0d0a 2020 2320 2f2f 204d 6170 2e61  );..  # // Map.a
-00024850: 6464 4c61 7965 7228 7465 7374 2e73 656c  ddLayer(test.sel
-00024860: 6563 7428 5b31 5d29 2c7b 7d2c 2774 7265  ect([1]),{},'tre
-00024870: 7369 6475 616c 7327 293b 0d0a 2020 2320  siduals');..  # 
-00024880: 2f2f 204d 6170 2e61 6464 4c61 7965 7228  // Map.addLayer(
-00024890: 7265 6475 6365 724f 7574 2e73 656c 6563  reducerOut.selec
-000248a0: 7428 5b31 5d29 2c7b 7d2c 2772 6f72 6573  t([1]),{},'rores
-000248b0: 6964 7561 6c73 2729 3b0d 0a20 2072 6564  iduals');..  red
-000248c0: 7563 6572 4f75 7420 3d20 7265 6475 6365  ucerOut = reduce
-000248d0: 724f 7574 2e73 656c 6563 7428 5b30 5d2c  rOut.select([0],
-000248e0: 5b27 636f 6566 6669 6369 656e 7473 275d  ['coefficients']
-000248f0: 292e 6172 7261 7954 7261 6e73 706f 7365  ).arrayTranspose
-00024900: 2829 2e61 7272 6179 466c 6174 7465 6e28  ().arrayFlatten(
-00024910: 5b64 6570 656e 6465 6e74 732c 6f75 744e  [dependents,outN
-00024920: 616d 6573 5d29 0d0a 2020 7265 6475 6365  ames])..  reduce
-00024930: 724f 7574 203d 2072 6564 7563 6572 4f75  rOut = reducerOu
-00024940: 742e 7365 7428 7b27 6e6f 4465 7065 6e64  t.set({'noDepend
-00024950: 656e 7473 273a 6565 2e4e 756d 6265 7228  ents':ee.Number(
-00024960: 6e6f 4465 7065 6e64 656e 7473 292c 5c0d  noDependents),\.
-00024970: 0a20 2027 6d6f 6465 6c4c 656e 6774 6827  .  'modelLength'
-00024980: 3a65 652e 4e75 6d62 6572 286e 6f49 6e64  :ee.Number(noInd
-00024990: 6570 656e 6465 6e74 7329 5c0d 0a20 207d  ependents)\..  }
-000249a0: 290d 0a0d 0a20 2072 6574 7572 6e20 7265  )....  return re
-000249b0: 6475 6365 724f 7574 0d0a 2323 2323 2323  ducerOut..######
+00024190: 2323 2323 2323 230d 0a23 5369 6d70 6c69  #######..#Simpli
+000241a0: 6669 6573 2074 6865 2075 7365 206f 6620  fies the use of 
+000241b0: 7468 6520 726f 6275 7374 206c 696e 6561  the robust linea
+000241c0: 7220 7265 6772 6573 7369 6f6e 2072 6564  r regression red
+000241d0: 7563 6572 0d0a 2341 7373 756d 6573 2074  ucer..#Assumes t
+000241e0: 6865 2064 6570 656e 6465 6e74 2069 7320  he dependent is 
+000241f0: 7468 6520 6669 7273 7420 6261 6e64 2061  the first band a
+00024200: 6e64 2061 6c6c 2073 7562 7365 7175 656e  nd all subsequen
+00024210: 7420 6261 6e64 7320 6172 6520 696e 6465  t bands are inde
+00024220: 7065 6e64 656e 7473 0d0a 6465 6620 6e65  pendents..def ne
+00024230: 7752 6f62 7573 744d 756c 7469 706c 654c  wRobustMultipleL
+00024240: 696e 6561 7232 2864 6570 656e 6465 6e74  inear2(dependent
+00024250: 7349 6e64 6570 656e 6465 6e74 7329 3a0d  sIndependents):.
+00024260: 0a20 2023 5365 7420 7570 2074 6865 2062  .  #Set up the b
+00024270: 616e 6420 6e61 6d65 730d 0a0d 0a20 2064  and names....  d
+00024280: 6570 656e 6465 6e74 4261 6e64 7320 3d20  ependentBands = 
+00024290: 6565 2e4c 6973 7428 6465 7065 6e64 656e  ee.List(dependen
+000242a0: 7473 496e 6465 7065 6e64 656e 7473 2e67  tsIndependents.g
+000242b0: 6574 2827 6465 7042 616e 644e 756d 6265  et('depBandNumbe
+000242c0: 7273 2729 290d 0a20 2069 6e64 6570 656e  rs'))..  indepen
+000242d0: 6465 6e74 4261 6e64 7320 3d20 6565 2e4c  dentBands = ee.L
+000242e0: 6973 7428 6465 7065 6e64 656e 7473 496e  ist(dependentsIn
+000242f0: 6465 7065 6e64 656e 7473 2e67 6574 2827  dependents.get('
+00024300: 696e 6442 616e 644e 756d 6265 7273 2729  indBandNumbers')
+00024310: 290d 0a20 2062 6e73 203d 2065 652e 496d  )..  bns = ee.Im
+00024320: 6167 6528 6465 7065 6e64 656e 7473 496e  age(dependentsIn
+00024330: 6465 7065 6e64 656e 7473 2e66 6972 7374  dependents.first
+00024340: 2829 292e 6261 6e64 4e61 6d65 7328 290d  ()).bandNames().
+00024350: 0a20 2064 6570 656e 6465 6e74 7320 3d20  .  dependents = 
+00024360: 6565 2e4c 6973 7428 6465 7065 6e64 656e  ee.List(dependen
+00024370: 7473 496e 6465 7065 6e64 656e 7473 2e67  tsIndependents.g
+00024380: 6574 2827 6465 7042 616e 644e 616d 6573  et('depBandNames
+00024390: 2729 290d 0a20 2069 6e64 6570 656e 6465  '))..  independe
+000243a0: 6e74 7320 3d20 6565 2e4c 6973 7428 6465  nts = ee.List(de
+000243b0: 7065 6e64 656e 7473 496e 6465 7065 6e64  pendentsIndepend
+000243c0: 656e 7473 2e67 6574 2827 696e 6442 616e  ents.get('indBan
+000243d0: 644e 616d 6573 2729 290d 0a0d 0a20 2023  dNames'))....  #
+000243e0: 6465 7065 6e64 656e 7420 3d20 626e 732e  dependent = bns.
+000243f0: 736c 6963 6528 302c 3129 0d0a 2020 2369  slice(0,1)..  #i
+00024400: 6e64 6570 656e 6465 6e74 7320 3d20 626e  ndependents = bn
+00024410: 732e 736c 6963 6528 312c 6e75 6c6c 290d  s.slice(1,null).
+00024420: 0a20 206e 6f49 6e64 6570 656e 6465 6e74  .  noIndependent
+00024430: 7320 3d20 696e 6465 7065 6e64 656e 7473  s = independents
+00024440: 2e6c 656e 6774 6828 292e 6164 6428 3129  .length().add(1)
+00024450: 0d0a 2020 6e6f 4465 7065 6e64 656e 7473  ..  noDependents
+00024460: 203d 2064 6570 656e 6465 6e74 732e 6c65   = dependents.le
+00024470: 6e67 7468 2829 0d0a 0d0a 2020 6f75 744e  ngth()....  outN
+00024480: 616d 6573 203d 2065 652e 4c69 7374 285b  ames = ee.List([
+00024490: 2769 6e74 6572 6365 7074 275d 292e 6361  'intercept']).ca
+000244a0: 7428 696e 6465 7065 6e64 656e 7473 290d  t(independents).
+000244b0: 0a0d 0a20 2023 4164 6420 636f 6e73 7461  ...  #Add consta
+000244c0: 6e74 2062 616e 6420 666f 7220 696e 7465  nt band for inte
+000244d0: 7263 6570 7420 616e 6420 7265 6f72 6465  rcept and reorde
+000244e0: 7220 666f 720d 0a20 2023 7379 6e74 6178  r for..  #syntax
+000244f0: 3a20 636f 6e73 7461 6e74 2c20 696e 6431  : constant, ind1
+00024500: 2c69 6e64 322c 696e 6433 2c69 6e64 6e2c  ,ind2,ind3,indn,
+00024510: 6465 7065 6e64 656e 740d 0a20 2064 6566  dependent..  def
+00024520: 2066 6f72 4669 7446 756e 2869 6d67 293a   forFitFun(img):
+00024530: 0d0a 2020 2020 6f75 7420 3d20 696d 672e  ..    out = img.
+00024540: 6164 6442 616e 6473 2865 652e 496d 6167  addBands(ee.Imag
+00024550: 6528 3129 2e73 656c 6563 7428 5b30 5d2c  e(1).select([0],
+00024560: 5b27 636f 6e73 7461 6e74 275d 2929 0d0a  ['constant']))..
+00024570: 2020 2020 6f75 7420 3d20 6f75 742e 7365      out = out.se
+00024580: 6c65 6374 2865 652e 4c69 7374 285b 2763  lect(ee.List(['c
+00024590: 6f6e 7374 616e 7427 2c69 6e64 6570 656e  onstant',indepen
+000245a0: 6465 6e74 735d 292e 666c 6174 7465 6e28  dents]).flatten(
+000245b0: 2929 0d0a 2020 2020 7265 7475 726e 206f  ))..    return o
+000245c0: 7574 2e61 6464 4261 6e64 7328 696d 672e  ut.addBands(img.
+000245d0: 7365 6c65 6374 2864 6570 656e 6465 6e74  select(dependent
+000245e0: 7329 290d 0a0d 0a0d 0a20 2066 6f72 4669  s))......  forFi
+000245f0: 7420 3d20 6465 7065 6e64 656e 7473 496e  t = dependentsIn
+00024600: 6465 7065 6e64 656e 7473 2e6d 6170 2866  dependents.map(f
+00024610: 6f72 4669 7446 756e 290d 0a0d 0a20 2023  orFitFun)....  #
+00024620: 4170 706c 7920 7265 6475 6365 722c 2061  Apply reducer, a
+00024630: 6e64 2063 6f6e 7665 7274 2062 6163 6b20  nd convert back 
+00024640: 746f 2069 6d61 6765 2077 6974 6820 7265  to image with re
+00024650: 7370 6563 7469 7665 2062 616e 644e 616d  spective bandNam
+00024660: 6573 0d0a 2020 7265 6475 6365 724f 7574  es..  reducerOut
+00024670: 203d 2066 6f72 4669 742e 7265 6475 6365   = forFit.reduce
+00024680: 2865 652e 5265 6475 6365 722e 6c69 6e65  (ee.Reducer.line
+00024690: 6172 5265 6772 6573 7369 6f6e 286e 6f49  arRegression(noI
+000246a0: 6e64 6570 656e 6465 6e74 732c 6e6f 4465  ndependents,noDe
+000246b0: 7065 6e64 656e 7473 2929 0d0a 2020 2320  pendents))..  # 
+000246c0: 2f2f 2074 6573 7420 3d20 666f 7246 6974  // test = forFit
+000246d0: 2e72 6564 7563 6528 6565 2e52 6564 7563  .reduce(ee.Reduc
+000246e0: 6572 2e72 6f62 7573 744c 696e 6561 7252  er.robustLinearR
+000246f0: 6567 7265 7373 696f 6e28 6e6f 496e 6465  egression(noInde
+00024700: 7065 6e64 656e 7473 2c6e 6f44 6570 656e  pendents,noDepen
+00024710: 6465 6e74 732c 302e 3229 290d 0a20 2023  dents,0.2))..  #
+00024720: 202f 2f20 7265 7369 6473 203d 2074 6573   // resids = tes
+00024730: 740d 0a20 2023 202f 2f20 2e73 656c 6563  t..  # // .selec
+00024740: 7428 5b31 5d2c 5b27 7265 7369 6475 616c  t([1],['residual
+00024750: 7327 5d29 2e61 7272 6179 466c 6174 7465  s']).arrayFlatte
+00024760: 6e28 5b64 6570 656e 6465 6e74 735d 293b  n([dependents]);
+00024770: 0d0a 2020 2320 2f2f 204d 6170 2e61 6464  ..  # // Map.add
+00024780: 4c61 7965 7228 7265 7369 6473 2c7b 7d2c  Layer(resids,{},
+00024790: 2772 6573 6964 7349 6d61 6765 2729 3b0d  'residsImage');.
+000247a0: 0a20 2023 202f 2f20 4d61 702e 6164 644c  .  # // Map.addL
+000247b0: 6179 6572 2872 6564 7563 6572 4f75 742e  ayer(reducerOut.
+000247c0: 7365 6c65 6374 285b 305d 292c 7b7d 2c27  select([0]),{},'
+000247d0: 636f 6566 6669 6369 656e 7473 2729 3b0d  coefficients');.
+000247e0: 0a20 2023 202f 2f20 4d61 702e 6164 644c  .  # // Map.addL
+000247f0: 6179 6572 2874 6573 742e 7365 6c65 6374  ayer(test.select
+00024800: 285b 315d 292c 7b7d 2c27 7472 6573 6964  ([1]),{},'tresid
+00024810: 7561 6c73 2729 3b0d 0a20 2023 202f 2f20  uals');..  # // 
+00024820: 4d61 702e 6164 644c 6179 6572 2872 6564  Map.addLayer(red
+00024830: 7563 6572 4f75 742e 7365 6c65 6374 285b  ucerOut.select([
+00024840: 315d 292c 7b7d 2c27 726f 7265 7369 6475  1]),{},'roresidu
+00024850: 616c 7327 293b 0d0a 2020 7265 6475 6365  als');..  reduce
+00024860: 724f 7574 203d 2072 6564 7563 6572 4f75  rOut = reducerOu
+00024870: 742e 7365 6c65 6374 285b 305d 2c5b 2763  t.select([0],['c
+00024880: 6f65 6666 6963 6965 6e74 7327 5d29 2e61  oefficients']).a
+00024890: 7272 6179 5472 616e 7370 6f73 6528 292e  rrayTranspose().
+000248a0: 6172 7261 7946 6c61 7474 656e 285b 6465  arrayFlatten([de
+000248b0: 7065 6e64 656e 7473 2c6f 7574 4e61 6d65  pendents,outName
+000248c0: 735d 290d 0a20 2072 6564 7563 6572 4f75  s])..  reducerOu
+000248d0: 7420 3d20 7265 6475 6365 724f 7574 2e73  t = reducerOut.s
+000248e0: 6574 287b 276e 6f44 6570 656e 6465 6e74  et({'noDependent
+000248f0: 7327 3a65 652e 4e75 6d62 6572 286e 6f44  s':ee.Number(noD
+00024900: 6570 656e 6465 6e74 7329 2c5c 0d0a 2020  ependents),\..  
+00024910: 276d 6f64 656c 4c65 6e67 7468 273a 6565  'modelLength':ee
+00024920: 2e4e 756d 6265 7228 6e6f 496e 6465 7065  .Number(noIndepe
+00024930: 6e64 656e 7473 295c 0d0a 2020 7d29 0d0a  ndents)\..  })..
+00024940: 0d0a 2020 7265 7475 726e 2072 6564 7563  ..  return reduc
+00024950: 6572 4f75 740d 0a23 2323 2323 2323 2323  erOut..#########
+00024960: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00024970: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00024980: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00024990: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000249a0: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
+000249b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000249c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000249d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000249e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000249f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00024a00: 2323 230d 0a23 2323 2323 2323 2323 2323  ###..###########
-00024a10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00024a20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00024a30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00024a40: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
-00024a50: 2343 6f64 6520 666f 7220 6669 6e64 696e  #Code for findin
-00024a60: 6720 7468 6520 6461 7465 206f 6620 7065  g the date of pe
-00024a70: 616b 206f 6620 6772 6565 6e0d 0a23 2041  ak of green..# A
-00024a80: 6c73 6f20 636f 6e76 6572 7473 2069 7420  lso converts it 
-00024a90: 746f 204a 756c 6961 6e20 6461 792c 206d  to Julian day, m
-00024aa0: 6f6e 7468 2c20 616e 6420 6461 7920 6f66  onth, and day of
-00024ab0: 206d 6f6e 7468 0d0a 6d6f 6e74 6852 656d   month..monthRem
-00024ac0: 6170 203d 5b31 2c20 312c 2031 2c20 312c  ap =[1, 1, 1, 1,
-00024ad0: 2031 2c20 312c 2031 2c20 312c 2031 2c20   1, 1, 1, 1, 1, 
-00024ae0: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
-00024af0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00024b00: 2031 2c20 312c 2031 2c20 312c 2031 2c20   1, 1, 1, 1, 1, 
-00024b10: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
-00024b20: 2c20 322c 2032 2c20 322c 2032 2c20 322c  , 2, 2, 2, 2, 2,
-00024b30: 2032 2c20 322c 2032 2c20 322c 2032 2c20   2, 2, 2, 2, 2, 
-00024b40: 322c 2032 2c20 322c 2032 2c20 322c 2032  2, 2, 2, 2, 2, 2
-00024b50: 2c20 322c 2032 2c20 322c 2032 2c20 322c  , 2, 2, 2, 2, 2,
-00024b60: 2032 2c20 322c 2032 2c20 322c 2032 2c20   2, 2, 2, 2, 2, 
-00024b70: 322c 2032 2c20 332c 2033 2c20 332c 2033  2, 2, 3, 3, 3, 3
-00024b80: 2c20 332c 2033 2c20 332c 2033 2c20 332c  , 3, 3, 3, 3, 3,
-00024b90: 2033 2c20 332c 2033 2c20 332c 2033 2c20   3, 3, 3, 3, 3, 
-00024ba0: 332c 2033 2c20 332c 2033 2c20 332c 2033  3, 3, 3, 3, 3, 3
-00024bb0: 2c20 332c 2033 2c20 332c 2033 2c20 332c  , 3, 3, 3, 3, 3,
-00024bc0: 2033 2c20 332c 2033 2c20 332c 2033 2c20   3, 3, 3, 3, 3, 
-00024bd0: 332c 2034 2c20 342c 2034 2c20 342c 2034  3, 4, 4, 4, 4, 4
-00024be0: 2c20 342c 2034 2c20 342c 2034 2c20 342c  , 4, 4, 4, 4, 4,
-00024bf0: 2034 2c20 342c 2034 2c20 342c 2034 2c20   4, 4, 4, 4, 4, 
-00024c00: 342c 2034 2c20 342c 2034 2c20 342c 2034  4, 4, 4, 4, 4, 4
-00024c10: 2c20 342c 2034 2c20 342c 2034 2c20 342c  , 4, 4, 4, 4, 4,
-00024c20: 2034 2c20 342c 2034 2c20 342c 2035 2c20   4, 4, 4, 4, 5, 
-00024c30: 352c 2035 2c20 352c 2035 2c20 352c 2035  5, 5, 5, 5, 5, 5
-00024c40: 2c20 352c 2035 2c20 352c 2035 2c20 352c  , 5, 5, 5, 5, 5,
-00024c50: 2035 2c20 352c 2035 2c20 352c 2035 2c20   5, 5, 5, 5, 5, 
-00024c60: 352c 2035 2c20 352c 2035 2c20 352c 2035  5, 5, 5, 5, 5, 5
-00024c70: 2c20 352c 2035 2c20 352c 2035 2c20 352c  , 5, 5, 5, 5, 5,
-00024c80: 2035 2c20 352c 2035 2c20 362c 2036 2c20   5, 5, 5, 6, 6, 
-00024c90: 362c 2036 2c20 362c 2036 2c20 362c 2036  6, 6, 6, 6, 6, 6
-00024ca0: 2c20 362c 2036 2c20 362c 2036 2c20 362c  , 6, 6, 6, 6, 6,
-00024cb0: 2036 2c20 362c 2036 2c20 362c 2036 2c20   6, 6, 6, 6, 6, 
-00024cc0: 362c 2036 2c20 362c 2036 2c20 362c 2036  6, 6, 6, 6, 6, 6
-00024cd0: 2c20 362c 2036 2c20 362c 2036 2c20 362c  , 6, 6, 6, 6, 6,
-00024ce0: 2036 2c20 372c 2037 2c20 372c 2037 2c20   6, 7, 7, 7, 7, 
-00024cf0: 372c 2037 2c20 372c 2037 2c20 372c 2037  7, 7, 7, 7, 7, 7
-00024d00: 2c20 372c 2037 2c20 372c 2037 2c20 372c  , 7, 7, 7, 7, 7,
-00024d10: 2037 2c20 372c 2037 2c20 372c 2037 2c20   7, 7, 7, 7, 7, 
-00024d20: 372c 2037 2c20 372c 2037 2c20 372c 2037  7, 7, 7, 7, 7, 7
-00024d30: 2c20 372c 2037 2c20 372c 2037 2c20 372c  , 7, 7, 7, 7, 7,
-00024d40: 2038 2c20 382c 2038 2c20 382c 2038 2c20   8, 8, 8, 8, 8, 
-00024d50: 382c 2038 2c20 382c 2038 2c20 382c 2038  8, 8, 8, 8, 8, 8
-00024d60: 2c20 382c 2038 2c20 382c 2038 2c20 382c  , 8, 8, 8, 8, 8,
-00024d70: 2038 2c20 382c 2038 2c20 382c 2038 2c20   8, 8, 8, 8, 8, 
-00024d80: 382c 2038 2c20 382c 2038 2c20 382c 2038  8, 8, 8, 8, 8, 8
-00024d90: 2c20 382c 2038 2c20 382c 2038 2c20 392c  , 8, 8, 8, 8, 9,
-00024da0: 2039 2c20 392c 2039 2c20 392c 2039 2c20   9, 9, 9, 9, 9, 
-00024db0: 392c 2039 2c20 392c 2039 2c20 392c 2039  9, 9, 9, 9, 9, 9
-00024dc0: 2c20 392c 2039 2c20 392c 2039 2c20 392c  , 9, 9, 9, 9, 9,
-00024dd0: 2039 2c20 392c 2039 2c20 392c 2039 2c20   9, 9, 9, 9, 9, 
-00024de0: 392c 2039 2c20 392c 2039 2c20 392c 2039  9, 9, 9, 9, 9, 9
-00024df0: 2c20 392c 2039 2c20 3130 2c20 3130 2c20  , 9, 9, 10, 10, 
-00024e00: 3130 2c20 3130 2c20 3130 2c20 3130 2c20  10, 10, 10, 10, 
-00024e10: 3130 2c20 3130 2c20 3130 2c20 3130 2c20  10, 10, 10, 10, 
-00024e20: 3130 2c20 3130 2c20 3130 2c20 3130 2c20  10, 10, 10, 10, 
-00024e30: 3130 2c20 3130 2c20 3130 2c20 3130 2c20  10, 10, 10, 10, 
-00024e40: 3130 2c20 3130 2c20 3130 2c20 3130 2c20  10, 10, 10, 10, 
-00024e50: 3130 2c20 3130 2c20 3130 2c20 3130 2c20  10, 10, 10, 10, 
-00024e60: 3130 2c20 3130 2c20 3130 2c20 3130 2c20  10, 10, 10, 10, 
-00024e70: 3130 2c20 3131 2c20 3131 2c20 3131 2c20  10, 11, 11, 11, 
-00024e80: 3131 2c20 3131 2c20 3131 2c20 3131 2c20  11, 11, 11, 11, 
-00024e90: 3131 2c20 3131 2c20 3131 2c20 3131 2c20  11, 11, 11, 11, 
-00024ea0: 3131 2c20 3131 2c20 3131 2c20 3131 2c20  11, 11, 11, 11, 
-00024eb0: 3131 2c20 3131 2c20 3131 2c20 3131 2c20  11, 11, 11, 11, 
-00024ec0: 3131 2c20 3131 2c20 3131 2c20 3131 2c20  11, 11, 11, 11, 
-00024ed0: 3131 2c20 3131 2c20 3131 2c20 3131 2c20  11, 11, 11, 11, 
-00024ee0: 3131 2c20 3131 2c20 3131 2c20 3132 2c20  11, 11, 11, 12, 
-00024ef0: 3132 2c20 3132 2c20 3132 2c20 3132 2c20  12, 12, 12, 12, 
-00024f00: 3132 2c20 3132 2c20 3132 2c20 3132 2c20  12, 12, 12, 12, 
-00024f10: 3132 2c20 3132 2c20 3132 2c20 3132 2c20  12, 12, 12, 12, 
-00024f20: 3132 2c20 3132 2c20 3132 2c20 3132 2c20  12, 12, 12, 12, 
-00024f30: 3132 2c20 3132 2c20 3132 2c20 3132 2c20  12, 12, 12, 12, 
-00024f40: 3132 2c20 3132 2c20 3132 2c20 3132 2c20  12, 12, 12, 12, 
-00024f50: 3132 2c20 3132 2c20 3132 2c20 3132 2c20  12, 12, 12, 12, 
-00024f60: 3132 2c20 3132 205d 0d0a 6d6f 6e74 6844  12, 12 ]..monthD
-00024f70: 6179 5265 6d61 7020 3d20 5b31 2c20 322c  ayRemap = [1, 2,
-00024f80: 2033 2c20 342c 2035 2c20 362c 2037 2c20   3, 4, 5, 6, 7, 
-00024f90: 382c 2039 2c20 3130 2c20 3131 2c20 3132  8, 9, 10, 11, 12
-00024fa0: 2c20 3133 2c20 3134 2c20 3135 2c20 3136  , 13, 14, 15, 16
-00024fb0: 2c20 3137 2c20 3138 2c20 3139 2c20 3230  , 17, 18, 19, 20
-00024fc0: 2c20 3231 2c20 3232 2c20 3233 2c20 3234  , 21, 22, 23, 24
-00024fd0: 2c20 3235 2c20 3236 2c20 3237 2c20 3238  , 25, 26, 27, 28
-00024fe0: 2c20 3239 2c20 3330 2c20 3331 2c20 312c  , 29, 30, 31, 1,
-00024ff0: 2032 2c20 332c 2034 2c20 352c 2036 2c20   2, 3, 4, 5, 6, 
-00025000: 372c 2038 2c20 392c 2031 302c 2031 312c  7, 8, 9, 10, 11,
-00025010: 2031 322c 2031 332c 2031 342c 2031 352c   12, 13, 14, 15,
-00025020: 2031 362c 2031 372c 2031 382c 2031 392c   16, 17, 18, 19,
-00025030: 2032 302c 2032 312c 2032 322c 2032 332c   20, 21, 22, 23,
-00025040: 2032 342c 2032 352c 2032 362c 2032 372c   24, 25, 26, 27,
-00025050: 2032 382c 2031 2c20 322c 2033 2c20 342c   28, 1, 2, 3, 4,
-00025060: 2035 2c20 362c 2037 2c20 382c 2039 2c20   5, 6, 7, 8, 9, 
-00025070: 3130 2c20 3131 2c20 3132 2c20 3133 2c20  10, 11, 12, 13, 
-00025080: 3134 2c20 3135 2c20 3136 2c20 3137 2c20  14, 15, 16, 17, 
-00025090: 3138 2c20 3139 2c20 3230 2c20 3231 2c20  18, 19, 20, 21, 
-000250a0: 3232 2c20 3233 2c20 3234 2c20 3235 2c20  22, 23, 24, 25, 
-000250b0: 3236 2c20 3237 2c20 3238 2c20 3239 2c20  26, 27, 28, 29, 
-000250c0: 3330 2c20 3331 2c20 312c 2032 2c20 332c  30, 31, 1, 2, 3,
-000250d0: 2034 2c20 352c 2036 2c20 372c 2038 2c20   4, 5, 6, 7, 8, 
-000250e0: 392c 2031 302c 2031 312c 2031 322c 2031  9, 10, 11, 12, 1
-000250f0: 332c 2031 342c 2031 352c 2031 362c 2031  3, 14, 15, 16, 1
-00025100: 372c 2031 382c 2031 392c 2032 302c 2032  7, 18, 19, 20, 2
-00025110: 312c 2032 322c 2032 332c 2032 342c 2032  1, 22, 23, 24, 2
-00025120: 352c 2032 362c 2032 372c 2032 382c 2032  5, 26, 27, 28, 2
-00025130: 392c 2033 302c 2031 2c20 322c 2033 2c20  9, 30, 1, 2, 3, 
-00025140: 342c 2035 2c20 362c 2037 2c20 382c 2039  4, 5, 6, 7, 8, 9
-00025150: 2c20 3130 2c20 3131 2c20 3132 2c20 3133  , 10, 11, 12, 13
-00025160: 2c20 3134 2c20 3135 2c20 3136 2c20 3137  , 14, 15, 16, 17
-00025170: 2c20 3138 2c20 3139 2c20 3230 2c20 3231  , 18, 19, 20, 21
-00025180: 2c20 3232 2c20 3233 2c20 3234 2c20 3235  , 22, 23, 24, 25
-00025190: 2c20 3236 2c20 3237 2c20 3238 2c20 3239  , 26, 27, 28, 29
-000251a0: 2c20 3330 2c20 3331 2c20 312c 2032 2c20  , 30, 31, 1, 2, 
-000251b0: 332c 2034 2c20 352c 2036 2c20 372c 2038  3, 4, 5, 6, 7, 8
-000251c0: 2c20 392c 2031 302c 2031 312c 2031 322c  , 9, 10, 11, 12,
-000251d0: 2031 332c 2031 342c 2031 352c 2031 362c   13, 14, 15, 16,
-000251e0: 2031 372c 2031 382c 2031 392c 2032 302c   17, 18, 19, 20,
-000251f0: 2032 312c 2032 322c 2032 332c 2032 342c   21, 22, 23, 24,
-00025200: 2032 352c 2032 362c 2032 372c 2032 382c   25, 26, 27, 28,
-00025210: 2032 392c 2033 302c 2031 2c20 322c 2033   29, 30, 1, 2, 3
-00025220: 2c20 342c 2035 2c20 362c 2037 2c20 382c  , 4, 5, 6, 7, 8,
-00025230: 2039 2c20 3130 2c20 3131 2c20 3132 2c20   9, 10, 11, 12, 
-00025240: 3133 2c20 3134 2c20 3135 2c20 3136 2c20  13, 14, 15, 16, 
-00025250: 3137 2c20 3138 2c20 3139 2c20 3230 2c20  17, 18, 19, 20, 
-00025260: 3231 2c20 3232 2c20 3233 2c20 3234 2c20  21, 22, 23, 24, 
-00025270: 3235 2c20 3236 2c20 3237 2c20 3238 2c20  25, 26, 27, 28, 
-00025280: 3239 2c20 3330 2c20 3331 2c20 312c 2032  29, 30, 31, 1, 2
-00025290: 2c20 332c 2034 2c20 352c 2036 2c20 372c  , 3, 4, 5, 6, 7,
-000252a0: 2038 2c20 392c 2031 302c 2031 312c 2031   8, 9, 10, 11, 1
-000252b0: 322c 2031 332c 2031 342c 2031 352c 2031  2, 13, 14, 15, 1
-000252c0: 362c 2031 372c 2031 382c 2031 392c 2032  6, 17, 18, 19, 2
-000252d0: 302c 2032 312c 2032 322c 2032 332c 2032  0, 21, 22, 23, 2
-000252e0: 342c 2032 352c 2032 362c 2032 372c 2032  4, 25, 26, 27, 2
-000252f0: 382c 2032 392c 2033 302c 2033 312c 2031  8, 29, 30, 31, 1
-00025300: 2c20 322c 2033 2c20 342c 2035 2c20 362c  , 2, 3, 4, 5, 6,
-00025310: 2037 2c20 382c 2039 2c20 3130 2c20 3131   7, 8, 9, 10, 11
-00025320: 2c20 3132 2c20 3133 2c20 3134 2c20 3135  , 12, 13, 14, 15
-00025330: 2c20 3136 2c20 3137 2c20 3138 2c20 3139  , 16, 17, 18, 19
-00025340: 2c20 3230 2c20 3231 2c20 3232 2c20 3233  , 20, 21, 22, 23
-00025350: 2c20 3234 2c20 3235 2c20 3236 2c20 3237  , 24, 25, 26, 27
-00025360: 2c20 3238 2c20 3239 2c20 3330 2c20 312c  , 28, 29, 30, 1,
-00025370: 2032 2c20 332c 2034 2c20 352c 2036 2c20   2, 3, 4, 5, 6, 
-00025380: 372c 2038 2c20 392c 2031 302c 2031 312c  7, 8, 9, 10, 11,
-00025390: 2031 322c 2031 332c 2031 342c 2031 352c   12, 13, 14, 15,
-000253a0: 2031 362c 2031 372c 2031 382c 2031 392c   16, 17, 18, 19,
-000253b0: 2032 302c 2032 312c 2032 322c 2032 332c   20, 21, 22, 23,
-000253c0: 2032 342c 2032 352c 2032 362c 2032 372c   24, 25, 26, 27,
-000253d0: 2032 382c 2032 392c 2033 302c 2033 312c   28, 29, 30, 31,
-000253e0: 2031 2c20 322c 2033 2c20 342c 2035 2c20   1, 2, 3, 4, 5, 
-000253f0: 362c 2037 2c20 382c 2039 2c20 3130 2c20  6, 7, 8, 9, 10, 
-00025400: 3131 2c20 3132 2c20 3133 2c20 3134 2c20  11, 12, 13, 14, 
-00025410: 3135 2c20 3136 2c20 3137 2c20 3138 2c20  15, 16, 17, 18, 
-00025420: 3139 2c20 3230 2c20 3231 2c20 3232 2c20  19, 20, 21, 22, 
-00025430: 3233 2c20 3234 2c20 3235 2c20 3236 2c20  23, 24, 25, 26, 
-00025440: 3237 2c20 3238 2c20 3239 2c20 3330 2c20  27, 28, 29, 30, 
-00025450: 312c 2032 2c20 332c 2034 2c20 352c 2036  1, 2, 3, 4, 5, 6
-00025460: 2c20 372c 2038 2c20 392c 2031 302c 2031  , 7, 8, 9, 10, 1
-00025470: 312c 2031 322c 2031 332c 2031 342c 2031  1, 12, 13, 14, 1
-00025480: 352c 2031 362c 2031 372c 2031 382c 2031  5, 16, 17, 18, 1
-00025490: 392c 2032 302c 2032 312c 2032 322c 2032  9, 20, 21, 22, 2
-000254a0: 332c 2032 342c 2032 352c 2032 362c 2032  3, 24, 25, 26, 2
-000254b0: 372c 2032 382c 2032 392c 2033 302c 2033  7, 28, 29, 30, 3
-000254c0: 3120 5d0d 0a6a 756c 6961 6e44 6179 203d  1 ]..julianDay =
-000254d0: 205b 312c 2032 2c20 332c 2034 2c20 352c   [1, 2, 3, 4, 5,
-000254e0: 2036 2c20 372c 2038 2c20 392c 2031 302c   6, 7, 8, 9, 10,
-000254f0: 2031 312c 2031 322c 2031 332c 2031 342c   11, 12, 13, 14,
-00025500: 2031 352c 2031 362c 2031 372c 2031 382c   15, 16, 17, 18,
-00025510: 2031 392c 2032 302c 2032 312c 2032 322c   19, 20, 21, 22,
-00025520: 2032 332c 2032 342c 2032 352c 2032 362c   23, 24, 25, 26,
-00025530: 2032 372c 2032 382c 2032 392c 2033 302c   27, 28, 29, 30,
-00025540: 2033 312c 2033 322c 2033 332c 2033 342c   31, 32, 33, 34,
-00025550: 2033 352c 2033 362c 2033 372c 2033 382c   35, 36, 37, 38,
-00025560: 2033 392c 2034 302c 2034 312c 2034 322c   39, 40, 41, 42,
-00025570: 2034 332c 2034 342c 2034 352c 2034 362c   43, 44, 45, 46,
-00025580: 2034 372c 2034 382c 2034 392c 2035 302c   47, 48, 49, 50,
-00025590: 2035 312c 2035 322c 2035 332c 2035 342c   51, 52, 53, 54,
-000255a0: 2035 352c 2035 362c 2035 372c 2035 382c   55, 56, 57, 58,
-000255b0: 2035 392c 2036 302c 2036 312c 2036 322c   59, 60, 61, 62,
-000255c0: 2036 332c 2036 342c 2036 352c 2036 362c   63, 64, 65, 66,
-000255d0: 2036 372c 2036 382c 2036 392c 2037 302c   67, 68, 69, 70,
-000255e0: 2037 312c 2037 322c 2037 332c 2037 342c   71, 72, 73, 74,
-000255f0: 2037 352c 2037 362c 2037 372c 2037 382c   75, 76, 77, 78,
-00025600: 2037 392c 2038 302c 2038 312c 2038 322c   79, 80, 81, 82,
-00025610: 2038 332c 2038 342c 2038 352c 2038 362c   83, 84, 85, 86,
-00025620: 2038 372c 2038 382c 2038 392c 2039 302c   87, 88, 89, 90,
-00025630: 2039 312c 2039 322c 2039 332c 2039 342c   91, 92, 93, 94,
-00025640: 2039 352c 2039 362c 2039 372c 2039 382c   95, 96, 97, 98,
-00025650: 2039 392c 2031 3030 2c20 3130 312c 2031   99, 100, 101, 1
-00025660: 3032 2c20 3130 332c 2031 3034 2c20 3130  02, 103, 104, 10
-00025670: 352c 2031 3036 2c20 3130 372c 2031 3038  5, 106, 107, 108
-00025680: 2c20 3130 392c 2031 3130 2c20 3131 312c  , 109, 110, 111,
-00025690: 2031 3132 2c20 3131 332c 2031 3134 2c20   112, 113, 114, 
-000256a0: 3131 352c 2031 3136 2c20 3131 372c 2031  115, 116, 117, 1
-000256b0: 3138 2c20 3131 392c 2031 3230 2c20 3132  18, 119, 120, 12
-000256c0: 312c 2031 3232 2c20 3132 332c 2031 3234  1, 122, 123, 124
-000256d0: 2c20 3132 352c 2031 3236 2c20 3132 372c  , 125, 126, 127,
-000256e0: 2031 3238 2c20 3132 392c 2031 3330 2c20   128, 129, 130, 
-000256f0: 3133 312c 2031 3332 2c20 3133 332c 2031  131, 132, 133, 1
-00025700: 3334 2c20 3133 352c 2031 3336 2c20 3133  34, 135, 136, 13
-00025710: 372c 2031 3338 2c20 3133 392c 2031 3430  7, 138, 139, 140
-00025720: 2c20 3134 312c 2031 3432 2c20 3134 332c  , 141, 142, 143,
-00025730: 2031 3434 2c20 3134 352c 2031 3436 2c20   144, 145, 146, 
-00025740: 3134 372c 2031 3438 2c20 3134 392c 2031  147, 148, 149, 1
-00025750: 3530 2c20 3135 312c 2031 3532 2c20 3135  50, 151, 152, 15
-00025760: 332c 2031 3534 2c20 3135 352c 2031 3536  3, 154, 155, 156
-00025770: 2c20 3135 372c 2031 3538 2c20 3135 392c  , 157, 158, 159,
-00025780: 2031 3630 2c20 3136 312c 2031 3632 2c20   160, 161, 162, 
-00025790: 3136 332c 2031 3634 2c20 3136 352c 2031  163, 164, 165, 1
-000257a0: 3636 2c20 3136 372c 2031 3638 2c20 3136  66, 167, 168, 16
-000257b0: 392c 2031 3730 2c20 3137 312c 2031 3732  9, 170, 171, 172
-000257c0: 2c20 3137 332c 2031 3734 2c20 3137 352c  , 173, 174, 175,
-000257d0: 2031 3736 2c20 3137 372c 2031 3738 2c20   176, 177, 178, 
-000257e0: 3137 392c 2031 3830 2c20 3138 312c 2031  179, 180, 181, 1
-000257f0: 3832 2c20 3138 332c 2031 3834 2c20 3138  82, 183, 184, 18
-00025800: 352c 2031 3836 2c20 3138 372c 2031 3838  5, 186, 187, 188
-00025810: 2c20 3138 392c 2031 3930 2c20 3139 312c  , 189, 190, 191,
-00025820: 2031 3932 2c20 3139 332c 2031 3934 2c20   192, 193, 194, 
-00025830: 3139 352c 2031 3936 2c20 3139 372c 2031  195, 196, 197, 1
-00025840: 3938 2c20 3139 392c 2032 3030 2c20 3230  98, 199, 200, 20
-00025850: 312c 2032 3032 2c20 3230 332c 2032 3034  1, 202, 203, 204
-00025860: 2c20 3230 352c 2032 3036 2c20 3230 372c  , 205, 206, 207,
-00025870: 2032 3038 2c20 3230 392c 2032 3130 2c20   208, 209, 210, 
-00025880: 3231 312c 2032 3132 2c20 3231 332c 2032  211, 212, 213, 2
-00025890: 3134 2c20 3231 352c 2032 3136 2c20 3231  14, 215, 216, 21
-000258a0: 372c 2032 3138 2c20 3231 392c 2032 3230  7, 218, 219, 220
-000258b0: 2c20 3232 312c 2032 3232 2c20 3232 332c  , 221, 222, 223,
-000258c0: 2032 3234 2c20 3232 352c 2032 3236 2c20   224, 225, 226, 
-000258d0: 3232 372c 2032 3238 2c20 3232 392c 2032  227, 228, 229, 2
-000258e0: 3330 2c20 3233 312c 2032 3332 2c20 3233  30, 231, 232, 23
-000258f0: 332c 2032 3334 2c20 3233 352c 2032 3336  3, 234, 235, 236
-00025900: 2c20 3233 372c 2032 3338 2c20 3233 392c  , 237, 238, 239,
-00025910: 2032 3430 2c20 3234 312c 2032 3432 2c20   240, 241, 242, 
-00025920: 3234 332c 2032 3434 2c20 3234 352c 2032  243, 244, 245, 2
-00025930: 3436 2c20 3234 372c 2032 3438 2c20 3234  46, 247, 248, 24
-00025940: 392c 2032 3530 2c20 3235 312c 2032 3532  9, 250, 251, 252
-00025950: 2c20 3235 332c 2032 3534 2c20 3235 352c  , 253, 254, 255,
-00025960: 2032 3536 2c20 3235 372c 2032 3538 2c20   256, 257, 258, 
-00025970: 3235 392c 2032 3630 2c20 3236 312c 2032  259, 260, 261, 2
-00025980: 3632 2c20 3236 332c 2032 3634 2c20 3236  62, 263, 264, 26
-00025990: 352c 2032 3636 2c20 3236 372c 2032 3638  5, 266, 267, 268
-000259a0: 2c20 3236 392c 2032 3730 2c20 3237 312c  , 269, 270, 271,
-000259b0: 2032 3732 2c20 3237 332c 2032 3734 2c20   272, 273, 274, 
-000259c0: 3237 352c 2032 3736 2c20 3237 372c 2032  275, 276, 277, 2
-000259d0: 3738 2c20 3237 392c 2032 3830 2c20 3238  78, 279, 280, 28
-000259e0: 312c 2032 3832 2c20 3238 332c 2032 3834  1, 282, 283, 284
-000259f0: 2c20 3238 352c 2032 3836 2c20 3238 372c  , 285, 286, 287,
-00025a00: 2032 3838 2c20 3238 392c 2032 3930 2c20   288, 289, 290, 
-00025a10: 3239 312c 2032 3932 2c20 3239 332c 2032  291, 292, 293, 2
-00025a20: 3934 2c20 3239 352c 2032 3936 2c20 3239  94, 295, 296, 29
-00025a30: 372c 2032 3938 2c20 3239 392c 2033 3030  7, 298, 299, 300
-00025a40: 2c20 3330 312c 2033 3032 2c20 3330 332c  , 301, 302, 303,
-00025a50: 2033 3034 2c20 3330 352c 2033 3036 2c20   304, 305, 306, 
-00025a60: 3330 372c 2033 3038 2c20 3330 392c 2033  307, 308, 309, 3
-00025a70: 3130 2c20 3331 312c 2033 3132 2c20 3331  10, 311, 312, 31
-00025a80: 332c 2033 3134 2c20 3331 352c 2033 3136  3, 314, 315, 316
-00025a90: 2c20 3331 372c 2033 3138 2c20 3331 392c  , 317, 318, 319,
-00025aa0: 2033 3230 2c20 3332 312c 2033 3232 2c20   320, 321, 322, 
-00025ab0: 3332 332c 2033 3234 2c20 3332 352c 2033  323, 324, 325, 3
-00025ac0: 3236 2c20 3332 372c 2033 3238 2c20 3332  26, 327, 328, 32
-00025ad0: 392c 2033 3330 2c20 3333 312c 2033 3332  9, 330, 331, 332
-00025ae0: 2c20 3333 332c 2033 3334 2c20 3333 352c  , 333, 334, 335,
-00025af0: 2033 3336 2c20 3333 372c 2033 3338 2c20   336, 337, 338, 
-00025b00: 3333 392c 2033 3430 2c20 3334 312c 2033  339, 340, 341, 3
-00025b10: 3432 2c20 3334 332c 2033 3434 2c20 3334  42, 343, 344, 34
-00025b20: 352c 2033 3436 2c20 3334 372c 2033 3438  5, 346, 347, 348
-00025b30: 2c20 3334 392c 2033 3530 2c20 3335 312c  , 349, 350, 351,
-00025b40: 2033 3532 2c20 3335 332c 2033 3534 2c20   352, 353, 354, 
-00025b50: 3335 352c 2033 3536 2c20 3335 372c 2033  355, 356, 357, 3
-00025b60: 3538 2c20 3335 392c 2033 3630 2c20 3336  58, 359, 360, 36
-00025b70: 312c 2033 3632 2c20 3336 332c 2033 3634  1, 362, 363, 364
-00025b80: 2c20 3336 3520 5d0d 0a0d 0a23 2323 2323  , 365 ]....#####
+000249e0: 2323 2323 2323 2323 2323 230d 0a23 436f  ###########..#Co
+000249f0: 6465 2066 6f72 2066 696e 6469 6e67 2074  de for finding t
+00024a00: 6865 2064 6174 6520 6f66 2070 6561 6b20  he date of peak 
+00024a10: 6f66 2067 7265 656e 0d0a 2320 416c 736f  of green..# Also
+00024a20: 2063 6f6e 7665 7274 7320 6974 2074 6f20   converts it to 
+00024a30: 4a75 6c69 616e 2064 6179 2c20 6d6f 6e74  Julian day, mont
+00024a40: 682c 2061 6e64 2064 6179 206f 6620 6d6f  h, and day of mo
+00024a50: 6e74 680d 0a6d 6f6e 7468 5265 6d61 7020  nth..monthRemap 
+00024a60: 3d5b 312c 2031 2c20 312c 2031 2c20 312c  =[1, 1, 1, 1, 1,
+00024a70: 2031 2c20 312c 2031 2c20 312c 2031 2c20   1, 1, 1, 1, 1, 
+00024a80: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
+00024a90: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+00024aa0: 2031 2c20 312c 2031 2c20 312c 2031 2c20   1, 1, 1, 1, 1, 
+00024ab0: 312c 2031 2c20 312c 2031 2c20 312c 2032  1, 1, 1, 1, 1, 2
+00024ac0: 2c20 322c 2032 2c20 322c 2032 2c20 322c  , 2, 2, 2, 2, 2,
+00024ad0: 2032 2c20 322c 2032 2c20 322c 2032 2c20   2, 2, 2, 2, 2, 
+00024ae0: 322c 2032 2c20 322c 2032 2c20 322c 2032  2, 2, 2, 2, 2, 2
+00024af0: 2c20 322c 2032 2c20 322c 2032 2c20 322c  , 2, 2, 2, 2, 2,
+00024b00: 2032 2c20 322c 2032 2c20 322c 2032 2c20   2, 2, 2, 2, 2, 
+00024b10: 322c 2033 2c20 332c 2033 2c20 332c 2033  2, 3, 3, 3, 3, 3
+00024b20: 2c20 332c 2033 2c20 332c 2033 2c20 332c  , 3, 3, 3, 3, 3,
+00024b30: 2033 2c20 332c 2033 2c20 332c 2033 2c20   3, 3, 3, 3, 3, 
+00024b40: 332c 2033 2c20 332c 2033 2c20 332c 2033  3, 3, 3, 3, 3, 3
+00024b50: 2c20 332c 2033 2c20 332c 2033 2c20 332c  , 3, 3, 3, 3, 3,
+00024b60: 2033 2c20 332c 2033 2c20 332c 2033 2c20   3, 3, 3, 3, 3, 
+00024b70: 342c 2034 2c20 342c 2034 2c20 342c 2034  4, 4, 4, 4, 4, 4
+00024b80: 2c20 342c 2034 2c20 342c 2034 2c20 342c  , 4, 4, 4, 4, 4,
+00024b90: 2034 2c20 342c 2034 2c20 342c 2034 2c20   4, 4, 4, 4, 4, 
+00024ba0: 342c 2034 2c20 342c 2034 2c20 342c 2034  4, 4, 4, 4, 4, 4
+00024bb0: 2c20 342c 2034 2c20 342c 2034 2c20 342c  , 4, 4, 4, 4, 4,
+00024bc0: 2034 2c20 342c 2034 2c20 352c 2035 2c20   4, 4, 4, 5, 5, 
+00024bd0: 352c 2035 2c20 352c 2035 2c20 352c 2035  5, 5, 5, 5, 5, 5
+00024be0: 2c20 352c 2035 2c20 352c 2035 2c20 352c  , 5, 5, 5, 5, 5,
+00024bf0: 2035 2c20 352c 2035 2c20 352c 2035 2c20   5, 5, 5, 5, 5, 
+00024c00: 352c 2035 2c20 352c 2035 2c20 352c 2035  5, 5, 5, 5, 5, 5
+00024c10: 2c20 352c 2035 2c20 352c 2035 2c20 352c  , 5, 5, 5, 5, 5,
+00024c20: 2035 2c20 352c 2036 2c20 362c 2036 2c20   5, 5, 6, 6, 6, 
+00024c30: 362c 2036 2c20 362c 2036 2c20 362c 2036  6, 6, 6, 6, 6, 6
+00024c40: 2c20 362c 2036 2c20 362c 2036 2c20 362c  , 6, 6, 6, 6, 6,
+00024c50: 2036 2c20 362c 2036 2c20 362c 2036 2c20   6, 6, 6, 6, 6, 
+00024c60: 362c 2036 2c20 362c 2036 2c20 362c 2036  6, 6, 6, 6, 6, 6
+00024c70: 2c20 362c 2036 2c20 362c 2036 2c20 362c  , 6, 6, 6, 6, 6,
+00024c80: 2037 2c20 372c 2037 2c20 372c 2037 2c20   7, 7, 7, 7, 7, 
+00024c90: 372c 2037 2c20 372c 2037 2c20 372c 2037  7, 7, 7, 7, 7, 7
+00024ca0: 2c20 372c 2037 2c20 372c 2037 2c20 372c  , 7, 7, 7, 7, 7,
+00024cb0: 2037 2c20 372c 2037 2c20 372c 2037 2c20   7, 7, 7, 7, 7, 
+00024cc0: 372c 2037 2c20 372c 2037 2c20 372c 2037  7, 7, 7, 7, 7, 7
+00024cd0: 2c20 372c 2037 2c20 372c 2037 2c20 382c  , 7, 7, 7, 7, 8,
+00024ce0: 2038 2c20 382c 2038 2c20 382c 2038 2c20   8, 8, 8, 8, 8, 
+00024cf0: 382c 2038 2c20 382c 2038 2c20 382c 2038  8, 8, 8, 8, 8, 8
+00024d00: 2c20 382c 2038 2c20 382c 2038 2c20 382c  , 8, 8, 8, 8, 8,
+00024d10: 2038 2c20 382c 2038 2c20 382c 2038 2c20   8, 8, 8, 8, 8, 
+00024d20: 382c 2038 2c20 382c 2038 2c20 382c 2038  8, 8, 8, 8, 8, 8
+00024d30: 2c20 382c 2038 2c20 382c 2039 2c20 392c  , 8, 8, 8, 9, 9,
+00024d40: 2039 2c20 392c 2039 2c20 392c 2039 2c20   9, 9, 9, 9, 9, 
+00024d50: 392c 2039 2c20 392c 2039 2c20 392c 2039  9, 9, 9, 9, 9, 9
+00024d60: 2c20 392c 2039 2c20 392c 2039 2c20 392c  , 9, 9, 9, 9, 9,
+00024d70: 2039 2c20 392c 2039 2c20 392c 2039 2c20   9, 9, 9, 9, 9, 
+00024d80: 392c 2039 2c20 392c 2039 2c20 392c 2039  9, 9, 9, 9, 9, 9
+00024d90: 2c20 392c 2031 302c 2031 302c 2031 302c  , 9, 10, 10, 10,
+00024da0: 2031 302c 2031 302c 2031 302c 2031 302c   10, 10, 10, 10,
+00024db0: 2031 302c 2031 302c 2031 302c 2031 302c   10, 10, 10, 10,
+00024dc0: 2031 302c 2031 302c 2031 302c 2031 302c   10, 10, 10, 10,
+00024dd0: 2031 302c 2031 302c 2031 302c 2031 302c   10, 10, 10, 10,
+00024de0: 2031 302c 2031 302c 2031 302c 2031 302c   10, 10, 10, 10,
+00024df0: 2031 302c 2031 302c 2031 302c 2031 302c   10, 10, 10, 10,
+00024e00: 2031 302c 2031 302c 2031 302c 2031 302c   10, 10, 10, 10,
+00024e10: 2031 312c 2031 312c 2031 312c 2031 312c   11, 11, 11, 11,
+00024e20: 2031 312c 2031 312c 2031 312c 2031 312c   11, 11, 11, 11,
+00024e30: 2031 312c 2031 312c 2031 312c 2031 312c   11, 11, 11, 11,
+00024e40: 2031 312c 2031 312c 2031 312c 2031 312c   11, 11, 11, 11,
+00024e50: 2031 312c 2031 312c 2031 312c 2031 312c   11, 11, 11, 11,
+00024e60: 2031 312c 2031 312c 2031 312c 2031 312c   11, 11, 11, 11,
+00024e70: 2031 312c 2031 312c 2031 312c 2031 312c   11, 11, 11, 11,
+00024e80: 2031 312c 2031 312c 2031 322c 2031 322c   11, 11, 12, 12,
+00024e90: 2031 322c 2031 322c 2031 322c 2031 322c   12, 12, 12, 12,
+00024ea0: 2031 322c 2031 322c 2031 322c 2031 322c   12, 12, 12, 12,
+00024eb0: 2031 322c 2031 322c 2031 322c 2031 322c   12, 12, 12, 12,
+00024ec0: 2031 322c 2031 322c 2031 322c 2031 322c   12, 12, 12, 12,
+00024ed0: 2031 322c 2031 322c 2031 322c 2031 322c   12, 12, 12, 12,
+00024ee0: 2031 322c 2031 322c 2031 322c 2031 322c   12, 12, 12, 12,
+00024ef0: 2031 322c 2031 322c 2031 322c 2031 322c   12, 12, 12, 12,
+00024f00: 2031 3220 5d0d 0a6d 6f6e 7468 4461 7952   12 ]..monthDayR
+00024f10: 656d 6170 203d 205b 312c 2032 2c20 332c  emap = [1, 2, 3,
+00024f20: 2034 2c20 352c 2036 2c20 372c 2038 2c20   4, 5, 6, 7, 8, 
+00024f30: 392c 2031 302c 2031 312c 2031 322c 2031  9, 10, 11, 12, 1
+00024f40: 332c 2031 342c 2031 352c 2031 362c 2031  3, 14, 15, 16, 1
+00024f50: 372c 2031 382c 2031 392c 2032 302c 2032  7, 18, 19, 20, 2
+00024f60: 312c 2032 322c 2032 332c 2032 342c 2032  1, 22, 23, 24, 2
+00024f70: 352c 2032 362c 2032 372c 2032 382c 2032  5, 26, 27, 28, 2
+00024f80: 392c 2033 302c 2033 312c 2031 2c20 322c  9, 30, 31, 1, 2,
+00024f90: 2033 2c20 342c 2035 2c20 362c 2037 2c20   3, 4, 5, 6, 7, 
+00024fa0: 382c 2039 2c20 3130 2c20 3131 2c20 3132  8, 9, 10, 11, 12
+00024fb0: 2c20 3133 2c20 3134 2c20 3135 2c20 3136  , 13, 14, 15, 16
+00024fc0: 2c20 3137 2c20 3138 2c20 3139 2c20 3230  , 17, 18, 19, 20
+00024fd0: 2c20 3231 2c20 3232 2c20 3233 2c20 3234  , 21, 22, 23, 24
+00024fe0: 2c20 3235 2c20 3236 2c20 3237 2c20 3238  , 25, 26, 27, 28
+00024ff0: 2c20 312c 2032 2c20 332c 2034 2c20 352c  , 1, 2, 3, 4, 5,
+00025000: 2036 2c20 372c 2038 2c20 392c 2031 302c   6, 7, 8, 9, 10,
+00025010: 2031 312c 2031 322c 2031 332c 2031 342c   11, 12, 13, 14,
+00025020: 2031 352c 2031 362c 2031 372c 2031 382c   15, 16, 17, 18,
+00025030: 2031 392c 2032 302c 2032 312c 2032 322c   19, 20, 21, 22,
+00025040: 2032 332c 2032 342c 2032 352c 2032 362c   23, 24, 25, 26,
+00025050: 2032 372c 2032 382c 2032 392c 2033 302c   27, 28, 29, 30,
+00025060: 2033 312c 2031 2c20 322c 2033 2c20 342c   31, 1, 2, 3, 4,
+00025070: 2035 2c20 362c 2037 2c20 382c 2039 2c20   5, 6, 7, 8, 9, 
+00025080: 3130 2c20 3131 2c20 3132 2c20 3133 2c20  10, 11, 12, 13, 
+00025090: 3134 2c20 3135 2c20 3136 2c20 3137 2c20  14, 15, 16, 17, 
+000250a0: 3138 2c20 3139 2c20 3230 2c20 3231 2c20  18, 19, 20, 21, 
+000250b0: 3232 2c20 3233 2c20 3234 2c20 3235 2c20  22, 23, 24, 25, 
+000250c0: 3236 2c20 3237 2c20 3238 2c20 3239 2c20  26, 27, 28, 29, 
+000250d0: 3330 2c20 312c 2032 2c20 332c 2034 2c20  30, 1, 2, 3, 4, 
+000250e0: 352c 2036 2c20 372c 2038 2c20 392c 2031  5, 6, 7, 8, 9, 1
+000250f0: 302c 2031 312c 2031 322c 2031 332c 2031  0, 11, 12, 13, 1
+00025100: 342c 2031 352c 2031 362c 2031 372c 2031  4, 15, 16, 17, 1
+00025110: 382c 2031 392c 2032 302c 2032 312c 2032  8, 19, 20, 21, 2
+00025120: 322c 2032 332c 2032 342c 2032 352c 2032  2, 23, 24, 25, 2
+00025130: 362c 2032 372c 2032 382c 2032 392c 2033  6, 27, 28, 29, 3
+00025140: 302c 2033 312c 2031 2c20 322c 2033 2c20  0, 31, 1, 2, 3, 
+00025150: 342c 2035 2c20 362c 2037 2c20 382c 2039  4, 5, 6, 7, 8, 9
+00025160: 2c20 3130 2c20 3131 2c20 3132 2c20 3133  , 10, 11, 12, 13
+00025170: 2c20 3134 2c20 3135 2c20 3136 2c20 3137  , 14, 15, 16, 17
+00025180: 2c20 3138 2c20 3139 2c20 3230 2c20 3231  , 18, 19, 20, 21
+00025190: 2c20 3232 2c20 3233 2c20 3234 2c20 3235  , 22, 23, 24, 25
+000251a0: 2c20 3236 2c20 3237 2c20 3238 2c20 3239  , 26, 27, 28, 29
+000251b0: 2c20 3330 2c20 312c 2032 2c20 332c 2034  , 30, 1, 2, 3, 4
+000251c0: 2c20 352c 2036 2c20 372c 2038 2c20 392c  , 5, 6, 7, 8, 9,
+000251d0: 2031 302c 2031 312c 2031 322c 2031 332c   10, 11, 12, 13,
+000251e0: 2031 342c 2031 352c 2031 362c 2031 372c   14, 15, 16, 17,
+000251f0: 2031 382c 2031 392c 2032 302c 2032 312c   18, 19, 20, 21,
+00025200: 2032 322c 2032 332c 2032 342c 2032 352c   22, 23, 24, 25,
+00025210: 2032 362c 2032 372c 2032 382c 2032 392c   26, 27, 28, 29,
+00025220: 2033 302c 2033 312c 2031 2c20 322c 2033   30, 31, 1, 2, 3
+00025230: 2c20 342c 2035 2c20 362c 2037 2c20 382c  , 4, 5, 6, 7, 8,
+00025240: 2039 2c20 3130 2c20 3131 2c20 3132 2c20   9, 10, 11, 12, 
+00025250: 3133 2c20 3134 2c20 3135 2c20 3136 2c20  13, 14, 15, 16, 
+00025260: 3137 2c20 3138 2c20 3139 2c20 3230 2c20  17, 18, 19, 20, 
+00025270: 3231 2c20 3232 2c20 3233 2c20 3234 2c20  21, 22, 23, 24, 
+00025280: 3235 2c20 3236 2c20 3237 2c20 3238 2c20  25, 26, 27, 28, 
+00025290: 3239 2c20 3330 2c20 3331 2c20 312c 2032  29, 30, 31, 1, 2
+000252a0: 2c20 332c 2034 2c20 352c 2036 2c20 372c  , 3, 4, 5, 6, 7,
+000252b0: 2038 2c20 392c 2031 302c 2031 312c 2031   8, 9, 10, 11, 1
+000252c0: 322c 2031 332c 2031 342c 2031 352c 2031  2, 13, 14, 15, 1
+000252d0: 362c 2031 372c 2031 382c 2031 392c 2032  6, 17, 18, 19, 2
+000252e0: 302c 2032 312c 2032 322c 2032 332c 2032  0, 21, 22, 23, 2
+000252f0: 342c 2032 352c 2032 362c 2032 372c 2032  4, 25, 26, 27, 2
+00025300: 382c 2032 392c 2033 302c 2031 2c20 322c  8, 29, 30, 1, 2,
+00025310: 2033 2c20 342c 2035 2c20 362c 2037 2c20   3, 4, 5, 6, 7, 
+00025320: 382c 2039 2c20 3130 2c20 3131 2c20 3132  8, 9, 10, 11, 12
+00025330: 2c20 3133 2c20 3134 2c20 3135 2c20 3136  , 13, 14, 15, 16
+00025340: 2c20 3137 2c20 3138 2c20 3139 2c20 3230  , 17, 18, 19, 20
+00025350: 2c20 3231 2c20 3232 2c20 3233 2c20 3234  , 21, 22, 23, 24
+00025360: 2c20 3235 2c20 3236 2c20 3237 2c20 3238  , 25, 26, 27, 28
+00025370: 2c20 3239 2c20 3330 2c20 3331 2c20 312c  , 29, 30, 31, 1,
+00025380: 2032 2c20 332c 2034 2c20 352c 2036 2c20   2, 3, 4, 5, 6, 
+00025390: 372c 2038 2c20 392c 2031 302c 2031 312c  7, 8, 9, 10, 11,
+000253a0: 2031 322c 2031 332c 2031 342c 2031 352c   12, 13, 14, 15,
+000253b0: 2031 362c 2031 372c 2031 382c 2031 392c   16, 17, 18, 19,
+000253c0: 2032 302c 2032 312c 2032 322c 2032 332c   20, 21, 22, 23,
+000253d0: 2032 342c 2032 352c 2032 362c 2032 372c   24, 25, 26, 27,
+000253e0: 2032 382c 2032 392c 2033 302c 2031 2c20   28, 29, 30, 1, 
+000253f0: 322c 2033 2c20 342c 2035 2c20 362c 2037  2, 3, 4, 5, 6, 7
+00025400: 2c20 382c 2039 2c20 3130 2c20 3131 2c20  , 8, 9, 10, 11, 
+00025410: 3132 2c20 3133 2c20 3134 2c20 3135 2c20  12, 13, 14, 15, 
+00025420: 3136 2c20 3137 2c20 3138 2c20 3139 2c20  16, 17, 18, 19, 
+00025430: 3230 2c20 3231 2c20 3232 2c20 3233 2c20  20, 21, 22, 23, 
+00025440: 3234 2c20 3235 2c20 3236 2c20 3237 2c20  24, 25, 26, 27, 
+00025450: 3238 2c20 3239 2c20 3330 2c20 3331 205d  28, 29, 30, 31 ]
+00025460: 0d0a 6a75 6c69 616e 4461 7920 3d20 5b31  ..julianDay = [1
+00025470: 2c20 322c 2033 2c20 342c 2035 2c20 362c  , 2, 3, 4, 5, 6,
+00025480: 2037 2c20 382c 2039 2c20 3130 2c20 3131   7, 8, 9, 10, 11
+00025490: 2c20 3132 2c20 3133 2c20 3134 2c20 3135  , 12, 13, 14, 15
+000254a0: 2c20 3136 2c20 3137 2c20 3138 2c20 3139  , 16, 17, 18, 19
+000254b0: 2c20 3230 2c20 3231 2c20 3232 2c20 3233  , 20, 21, 22, 23
+000254c0: 2c20 3234 2c20 3235 2c20 3236 2c20 3237  , 24, 25, 26, 27
+000254d0: 2c20 3238 2c20 3239 2c20 3330 2c20 3331  , 28, 29, 30, 31
+000254e0: 2c20 3332 2c20 3333 2c20 3334 2c20 3335  , 32, 33, 34, 35
+000254f0: 2c20 3336 2c20 3337 2c20 3338 2c20 3339  , 36, 37, 38, 39
+00025500: 2c20 3430 2c20 3431 2c20 3432 2c20 3433  , 40, 41, 42, 43
+00025510: 2c20 3434 2c20 3435 2c20 3436 2c20 3437  , 44, 45, 46, 47
+00025520: 2c20 3438 2c20 3439 2c20 3530 2c20 3531  , 48, 49, 50, 51
+00025530: 2c20 3532 2c20 3533 2c20 3534 2c20 3535  , 52, 53, 54, 55
+00025540: 2c20 3536 2c20 3537 2c20 3538 2c20 3539  , 56, 57, 58, 59
+00025550: 2c20 3630 2c20 3631 2c20 3632 2c20 3633  , 60, 61, 62, 63
+00025560: 2c20 3634 2c20 3635 2c20 3636 2c20 3637  , 64, 65, 66, 67
+00025570: 2c20 3638 2c20 3639 2c20 3730 2c20 3731  , 68, 69, 70, 71
+00025580: 2c20 3732 2c20 3733 2c20 3734 2c20 3735  , 72, 73, 74, 75
+00025590: 2c20 3736 2c20 3737 2c20 3738 2c20 3739  , 76, 77, 78, 79
+000255a0: 2c20 3830 2c20 3831 2c20 3832 2c20 3833  , 80, 81, 82, 83
+000255b0: 2c20 3834 2c20 3835 2c20 3836 2c20 3837  , 84, 85, 86, 87
+000255c0: 2c20 3838 2c20 3839 2c20 3930 2c20 3931  , 88, 89, 90, 91
+000255d0: 2c20 3932 2c20 3933 2c20 3934 2c20 3935  , 92, 93, 94, 95
+000255e0: 2c20 3936 2c20 3937 2c20 3938 2c20 3939  , 96, 97, 98, 99
+000255f0: 2c20 3130 302c 2031 3031 2c20 3130 322c  , 100, 101, 102,
+00025600: 2031 3033 2c20 3130 342c 2031 3035 2c20   103, 104, 105, 
+00025610: 3130 362c 2031 3037 2c20 3130 382c 2031  106, 107, 108, 1
+00025620: 3039 2c20 3131 302c 2031 3131 2c20 3131  09, 110, 111, 11
+00025630: 322c 2031 3133 2c20 3131 342c 2031 3135  2, 113, 114, 115
+00025640: 2c20 3131 362c 2031 3137 2c20 3131 382c  , 116, 117, 118,
+00025650: 2031 3139 2c20 3132 302c 2031 3231 2c20   119, 120, 121, 
+00025660: 3132 322c 2031 3233 2c20 3132 342c 2031  122, 123, 124, 1
+00025670: 3235 2c20 3132 362c 2031 3237 2c20 3132  25, 126, 127, 12
+00025680: 382c 2031 3239 2c20 3133 302c 2031 3331  8, 129, 130, 131
+00025690: 2c20 3133 322c 2031 3333 2c20 3133 342c  , 132, 133, 134,
+000256a0: 2031 3335 2c20 3133 362c 2031 3337 2c20   135, 136, 137, 
+000256b0: 3133 382c 2031 3339 2c20 3134 302c 2031  138, 139, 140, 1
+000256c0: 3431 2c20 3134 322c 2031 3433 2c20 3134  41, 142, 143, 14
+000256d0: 342c 2031 3435 2c20 3134 362c 2031 3437  4, 145, 146, 147
+000256e0: 2c20 3134 382c 2031 3439 2c20 3135 302c  , 148, 149, 150,
+000256f0: 2031 3531 2c20 3135 322c 2031 3533 2c20   151, 152, 153, 
+00025700: 3135 342c 2031 3535 2c20 3135 362c 2031  154, 155, 156, 1
+00025710: 3537 2c20 3135 382c 2031 3539 2c20 3136  57, 158, 159, 16
+00025720: 302c 2031 3631 2c20 3136 322c 2031 3633  0, 161, 162, 163
+00025730: 2c20 3136 342c 2031 3635 2c20 3136 362c  , 164, 165, 166,
+00025740: 2031 3637 2c20 3136 382c 2031 3639 2c20   167, 168, 169, 
+00025750: 3137 302c 2031 3731 2c20 3137 322c 2031  170, 171, 172, 1
+00025760: 3733 2c20 3137 342c 2031 3735 2c20 3137  73, 174, 175, 17
+00025770: 362c 2031 3737 2c20 3137 382c 2031 3739  6, 177, 178, 179
+00025780: 2c20 3138 302c 2031 3831 2c20 3138 322c  , 180, 181, 182,
+00025790: 2031 3833 2c20 3138 342c 2031 3835 2c20   183, 184, 185, 
+000257a0: 3138 362c 2031 3837 2c20 3138 382c 2031  186, 187, 188, 1
+000257b0: 3839 2c20 3139 302c 2031 3931 2c20 3139  89, 190, 191, 19
+000257c0: 322c 2031 3933 2c20 3139 342c 2031 3935  2, 193, 194, 195
+000257d0: 2c20 3139 362c 2031 3937 2c20 3139 382c  , 196, 197, 198,
+000257e0: 2031 3939 2c20 3230 302c 2032 3031 2c20   199, 200, 201, 
+000257f0: 3230 322c 2032 3033 2c20 3230 342c 2032  202, 203, 204, 2
+00025800: 3035 2c20 3230 362c 2032 3037 2c20 3230  05, 206, 207, 20
+00025810: 382c 2032 3039 2c20 3231 302c 2032 3131  8, 209, 210, 211
+00025820: 2c20 3231 322c 2032 3133 2c20 3231 342c  , 212, 213, 214,
+00025830: 2032 3135 2c20 3231 362c 2032 3137 2c20   215, 216, 217, 
+00025840: 3231 382c 2032 3139 2c20 3232 302c 2032  218, 219, 220, 2
+00025850: 3231 2c20 3232 322c 2032 3233 2c20 3232  21, 222, 223, 22
+00025860: 342c 2032 3235 2c20 3232 362c 2032 3237  4, 225, 226, 227
+00025870: 2c20 3232 382c 2032 3239 2c20 3233 302c  , 228, 229, 230,
+00025880: 2032 3331 2c20 3233 322c 2032 3333 2c20   231, 232, 233, 
+00025890: 3233 342c 2032 3335 2c20 3233 362c 2032  234, 235, 236, 2
+000258a0: 3337 2c20 3233 382c 2032 3339 2c20 3234  37, 238, 239, 24
+000258b0: 302c 2032 3431 2c20 3234 322c 2032 3433  0, 241, 242, 243
+000258c0: 2c20 3234 342c 2032 3435 2c20 3234 362c  , 244, 245, 246,
+000258d0: 2032 3437 2c20 3234 382c 2032 3439 2c20   247, 248, 249, 
+000258e0: 3235 302c 2032 3531 2c20 3235 322c 2032  250, 251, 252, 2
+000258f0: 3533 2c20 3235 342c 2032 3535 2c20 3235  53, 254, 255, 25
+00025900: 362c 2032 3537 2c20 3235 382c 2032 3539  6, 257, 258, 259
+00025910: 2c20 3236 302c 2032 3631 2c20 3236 322c  , 260, 261, 262,
+00025920: 2032 3633 2c20 3236 342c 2032 3635 2c20   263, 264, 265, 
+00025930: 3236 362c 2032 3637 2c20 3236 382c 2032  266, 267, 268, 2
+00025940: 3639 2c20 3237 302c 2032 3731 2c20 3237  69, 270, 271, 27
+00025950: 322c 2032 3733 2c20 3237 342c 2032 3735  2, 273, 274, 275
+00025960: 2c20 3237 362c 2032 3737 2c20 3237 382c  , 276, 277, 278,
+00025970: 2032 3739 2c20 3238 302c 2032 3831 2c20   279, 280, 281, 
+00025980: 3238 322c 2032 3833 2c20 3238 342c 2032  282, 283, 284, 2
+00025990: 3835 2c20 3238 362c 2032 3837 2c20 3238  85, 286, 287, 28
+000259a0: 382c 2032 3839 2c20 3239 302c 2032 3931  8, 289, 290, 291
+000259b0: 2c20 3239 322c 2032 3933 2c20 3239 342c  , 292, 293, 294,
+000259c0: 2032 3935 2c20 3239 362c 2032 3937 2c20   295, 296, 297, 
+000259d0: 3239 382c 2032 3939 2c20 3330 302c 2033  298, 299, 300, 3
+000259e0: 3031 2c20 3330 322c 2033 3033 2c20 3330  01, 302, 303, 30
+000259f0: 342c 2033 3035 2c20 3330 362c 2033 3037  4, 305, 306, 307
+00025a00: 2c20 3330 382c 2033 3039 2c20 3331 302c  , 308, 309, 310,
+00025a10: 2033 3131 2c20 3331 322c 2033 3133 2c20   311, 312, 313, 
+00025a20: 3331 342c 2033 3135 2c20 3331 362c 2033  314, 315, 316, 3
+00025a30: 3137 2c20 3331 382c 2033 3139 2c20 3332  17, 318, 319, 32
+00025a40: 302c 2033 3231 2c20 3332 322c 2033 3233  0, 321, 322, 323
+00025a50: 2c20 3332 342c 2033 3235 2c20 3332 362c  , 324, 325, 326,
+00025a60: 2033 3237 2c20 3332 382c 2033 3239 2c20   327, 328, 329, 
+00025a70: 3333 302c 2033 3331 2c20 3333 322c 2033  330, 331, 332, 3
+00025a80: 3333 2c20 3333 342c 2033 3335 2c20 3333  33, 334, 335, 33
+00025a90: 362c 2033 3337 2c20 3333 382c 2033 3339  6, 337, 338, 339
+00025aa0: 2c20 3334 302c 2033 3431 2c20 3334 322c  , 340, 341, 342,
+00025ab0: 2033 3433 2c20 3334 342c 2033 3435 2c20   343, 344, 345, 
+00025ac0: 3334 362c 2033 3437 2c20 3334 382c 2033  346, 347, 348, 3
+00025ad0: 3439 2c20 3335 302c 2033 3531 2c20 3335  49, 350, 351, 35
+00025ae0: 322c 2033 3533 2c20 3335 342c 2033 3535  2, 353, 354, 355
+00025af0: 2c20 3335 362c 2033 3537 2c20 3335 382c  , 356, 357, 358,
+00025b00: 2033 3539 2c20 3336 302c 2033 3631 2c20   359, 360, 361, 
+00025b10: 3336 322c 2033 3633 2c20 3336 342c 2033  362, 363, 364, 3
+00025b20: 3635 205d 0d0a 0d0a 2323 2323 2323 2323  65 ]....########
+00025b30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00025b40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00025b50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00025b60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00025b70: 230d 0a23 2323 2323 2323 2323 2323 2323  #..#############
+00025b80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00025b90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00025ba0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00025bb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00025bc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00025bd0: 2323 2323 0d0a 2323 2323 2323 2323 2323  ####..##########
-00025be0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00025bf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00025c00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00025c10: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
-00025c20: 0a23 4675 6e63 7469 6f6e 2066 6f72 2067  .#Function for g
-00025c30: 6574 7469 6e67 2074 6865 2064 6174 6520  etting the date 
-00025c40: 6f66 2074 6865 2070 6561 6b20 6f66 2076  of the peak of v
-00025c50: 6567 2076 6967 6f72 2d20 6361 6e20 6861  eg vigor- can ha
-00025c60: 6e64 6c65 2062 616e 6473 206e 6567 6174  ndle bands negat
-00025c70: 6976 656c 7920 636f 7272 656c 6174 6564  ively correlated
-00025c80: 2074 6f20 7665 6720 696e 0d0a 2363 6861   to veg in..#cha
-00025c90: 6e67 6544 6972 4469 6374 2064 6963 7469  ngeDirDict dicti
-00025ca0: 6f6e 6172 7920 6162 6f76 650d 0a64 6566  onary above..def
-00025cb0: 2067 6574 5065 616b 4461 7465 2863 6f65   getPeakDate(coe
-00025cc0: 6666 732c 7065 616b 4469 7265 6374 696f  ffs,peakDirectio
-00025cd0: 6e20 3d20 3129 3a0d 0a0d 0a20 2073 696e  n = 1):....  sin
-00025ce0: 203d 2063 6f65 6666 732e 7365 6c65 6374   = coeffs.select
-00025cf0: 285b 305d 290d 0a20 2063 6f73 203d 2063  ([0])..  cos = c
-00025d00: 6f65 6666 732e 7365 6c65 6374 285b 315d  oeffs.select([1]
-00025d10: 290d 0a0d 0a20 2023 4669 6e64 2077 6865  )....  #Find whe
-00025d20: 7265 2069 6e20 6379 636c 6520 736c 6f70  re in cycle slop
-00025d30: 6520 6973 207a 6572 6f0d 0a20 2067 7265  e is zero..  gre
-00025d40: 656e 4461 7465 203d 2028 2873 696e 2e64  enDate = ((sin.d
-00025d50: 6976 6964 6528 636f 7329 292e 6174 616e  ivide(cos)).atan
-00025d60: 2829 292e 6469 7669 6465 2832 2a6d 6174  ()).divide(2*mat
-00025d70: 682e 7069 292e 7265 6e61 6d65 285b 2770  h.pi).rename(['p
-00025d80: 6561 6b44 6174 6527 5d29 0d0a 2020 6772  eakDate'])..  gr
-00025d90: 6565 6e44 6174 654c 6174 6572 203d 2067  eenDateLater = g
-00025da0: 7265 656e 4461 7465 2e61 6464 2830 2e35  reenDate.add(0.5
-00025db0: 290d 0a20 2023 4368 6563 6b20 7768 6963  )..  #Check whic
-00025dc0: 6820 6431 2073 6c6f 7065 203d 2030 2069  h d1 slope = 0 i
-00025dd0: 7320 7468 6520 6d61 7820 6279 2070 7265  s the max by pre
-00025de0: 6469 6374 696e 6720 6f75 7420 7468 6520  dicting out the 
-00025df0: 7661 6c75 650d 0a20 2070 7265 6469 6374  value..  predict
-00025e00: 6564 3120 3d20 636f 6566 6673 2e73 656c  ed1 = coeffs.sel
-00025e10: 6563 7428 5b30 5d29 5c0d 0a20 2020 2020  ect([0])\..     
-00025e20: 2020 2020 2020 2020 202e 6164 6428 7369           .add(si
-00025e30: 6e2e 6d75 6c74 6970 6c79 2867 7265 656e  n.multiply(green
-00025e40: 4461 7465 2e6d 756c 7469 706c 7928 322a  Date.multiply(2*
-00025e50: 6d61 7468 2e70 6929 2e73 696e 2829 2929  math.pi).sin()))
-00025e60: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
-00025e70: 202e 6164 6428 636f 732e 6d75 6c74 6970   .add(cos.multip
-00025e80: 6c79 2867 7265 656e 4461 7465 2e6d 756c  ly(greenDate.mul
-00025e90: 7469 706c 7928 322a 6d61 7468 2e70 6929  tiply(2*math.pi)
-00025ea0: 2e63 6f73 2829 2929 5c0d 0a20 2020 2020  .cos()))\..     
-00025eb0: 2020 2020 2020 2020 202e 7265 6e61 6d65           .rename
-00025ec0: 285b 2770 7265 6469 6374 6564 275d 295c  (['predicted'])\
-00025ed0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00025ee0: 2e6d 756c 7469 706c 7928 6565 2e49 6d61  .multiply(ee.Ima
-00025ef0: 6765 2e63 6f6e 7374 616e 7428 7065 616b  ge.constant(peak
-00025f00: 4469 7265 6374 696f 6e29 295c 0d0a 2020  Direction))\..  
-00025f10: 2020 2020 2020 2020 2020 2020 2e61 6464              .add
-00025f20: 4261 6e64 7328 6772 6565 6e44 6174 6529  Bands(greenDate)
-00025f30: 0d0a 2020 7072 6564 6963 7465 6432 203d  ..  predicted2 =
-00025f40: 2063 6f65 6666 732e 7365 6c65 6374 285b   coeffs.select([
-00025f50: 305d 295c 0d0a 2020 2020 2020 2020 2020  0])\..          
-00025f60: 2020 2020 2e61 6464 2873 696e 2e6d 756c      .add(sin.mul
-00025f70: 7469 706c 7928 6772 6565 6e44 6174 654c  tiply(greenDateL
-00025f80: 6174 6572 2e6d 756c 7469 706c 7928 322a  ater.multiply(2*
-00025f90: 6d61 7468 2e70 6929 2e73 696e 2829 2929  math.pi).sin()))
-00025fa0: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
-00025fb0: 202e 6164 6428 636f 732e 6d75 6c74 6970   .add(cos.multip
-00025fc0: 6c79 2867 7265 656e 4461 7465 4c61 7465  ly(greenDateLate
-00025fd0: 722e 6d75 6c74 6970 6c79 2832 2a6d 6174  r.multiply(2*mat
-00025fe0: 682e 7069 292e 636f 7328 2929 295c 0d0a  h.pi).cos()))\..
-00025ff0: 2020 2020 2020 2020 2020 2020 2020 2e72                .r
-00026000: 656e 616d 6528 5b27 7072 6564 6963 7465  ename(['predicte
-00026010: 6427 5d29 5c0d 0a20 2020 2020 2020 2020  d'])\..         
-00026020: 2020 2020 202e 6d75 6c74 6970 6c79 2865       .multiply(e
-00026030: 652e 496d 6167 652e 636f 6e73 7461 6e74  e.Image.constant
-00026040: 2870 6561 6b44 6972 6563 7469 6f6e 2929  (peakDirection))
-00026050: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
-00026060: 202e 6164 6442 616e 6473 2867 7265 656e   .addBands(green
-00026070: 4461 7465 4c61 7465 7229 0d0a 2020 6669  DateLater)..  fi
-00026080: 6e61 6c47 7265 656e 4461 7465 203d 2065  nalGreenDate = e
-00026090: 652e 496d 6167 6543 6f6c 6c65 6374 696f  e.ImageCollectio
-000260a0: 6e28 5b70 7265 6469 6374 6564 312c 7072  n([predicted1,pr
-000260b0: 6564 6963 7465 6432 5d29 2e71 7561 6c69  edicted2]).quali
-000260c0: 7479 4d6f 7361 6963 2827 7072 6564 6963  tyMosaic('predic
-000260d0: 7465 6427 292e 7365 6c65 6374 285b 2770  ted').select(['p
-000260e0: 6561 6b44 6174 6527 5d29 2e72 656e 616d  eakDate']).renam
-000260f0: 6528 5b27 7065 616b 4a75 6c69 616e 4461  e(['peakJulianDa
-00026100: 7927 5d29 0d0a 0d0a 2020 6669 6e61 6c47  y'])....  finalG
-00026110: 7265 656e 4461 7465 203d 2066 696e 616c  reenDate = final
-00026120: 4772 6565 6e44 6174 652e 7768 6572 6528  GreenDate.where(
-00026130: 6669 6e61 6c47 7265 656e 4461 7465 2e6c  finalGreenDate.l
-00026140: 7428 3029 2c20 6772 6565 6e44 6174 652e  t(0), greenDate.
-00026150: 6164 6428 3129 292e 6d75 6c74 6970 6c79  add(1)).multiply
-00026160: 2833 3635 292e 696e 7431 3628 293b 0d0a  (365).int16();..
-00026170: 0d0a 2020 2343 6f6e 7665 7274 2074 6f20  ..  #Convert to 
-00026180: 6d6f 6e74 6820 616e 6420 6461 7920 6f66  month and day of
-00026190: 206d 6f6e 7468 0d0a 2020 6772 6565 6e4d   month..  greenM
-000261a0: 6f6e 7468 203d 2066 696e 616c 4772 6565  onth = finalGree
-000261b0: 6e44 6174 652e 7265 6d61 7028 6a75 6c69  nDate.remap(juli
-000261c0: 616e 4461 792c 6d6f 6e74 6852 656d 6170  anDay,monthRemap
-000261d0: 292e 7265 6e61 6d65 285b 2770 6561 6b4d  ).rename(['peakM
-000261e0: 6f6e 7468 275d 290d 0a20 2067 7265 656e  onth'])..  green
-000261f0: 4d6f 6e74 6844 6179 203d 2066 696e 616c  MonthDay = final
-00026200: 4772 6565 6e44 6174 652e 7265 6d61 7028  GreenDate.remap(
-00026210: 6a75 6c69 616e 4461 792c 6d6f 6e74 6844  julianDay,monthD
-00026220: 6179 5265 6d61 7029 2e72 656e 616d 6528  ayRemap).rename(
-00026230: 5b27 7065 616b 4461 794f 664d 6f6e 7468  ['peakDayOfMonth
-00026240: 275d 290d 0a20 2067 7265 656e 5374 6163  '])..  greenStac
-00026250: 6b20 3d20 6669 6e61 6c47 7265 656e 4461  k = finalGreenDa
-00026260: 7465 2e61 6464 4261 6e64 7328 6772 6565  te.addBands(gree
-00026270: 6e4d 6f6e 7468 292e 6164 6442 616e 6473  nMonth).addBands
-00026280: 2867 7265 656e 4d6f 6e74 6844 6179 290d  (greenMonthDay).
-00026290: 0a20 2072 6574 7572 6e20 6772 6565 6e53  .  return greenS
-000262a0: 7461 636b 0d0a 2020 234d 6170 2e61 6464  tack..  #Map.add
-000262b0: 4c61 7965 7228 6772 6565 6e53 7461 636b  Layer(greenStack
-000262c0: 2c7b 276d 696e 273a 312c 276d 6178 273a  ,{'min':1,'max':
-000262d0: 3132 7d2c 2767 7265 656e 4d6f 6e74 6827  12},'greenMonth'
-000262e0: 2c46 616c 7365 290d 0a0d 0a23 2323 2323  ,False)....#####
+00025bb0: 2323 2323 2323 2323 2323 2323 0d0a 2346  ############..#F
+00025bc0: 756e 6374 696f 6e20 666f 7220 6765 7474  unction for gett
+00025bd0: 696e 6720 7468 6520 6461 7465 206f 6620  ing the date of 
+00025be0: 7468 6520 7065 616b 206f 6620 7665 6720  the peak of veg 
+00025bf0: 7669 676f 722d 2063 616e 2068 616e 646c  vigor- can handl
+00025c00: 6520 6261 6e64 7320 6e65 6761 7469 7665  e bands negative
+00025c10: 6c79 2063 6f72 7265 6c61 7465 6420 746f  ly correlated to
+00025c20: 2076 6567 2069 6e0d 0a23 6368 616e 6765   veg in..#change
+00025c30: 4469 7244 6963 7420 6469 6374 696f 6e61  DirDict dictiona
+00025c40: 7279 2061 626f 7665 0d0a 6465 6620 6765  ry above..def ge
+00025c50: 7450 6561 6b44 6174 6528 636f 6566 6673  tPeakDate(coeffs
+00025c60: 2c70 6561 6b44 6972 6563 7469 6f6e 203d  ,peakDirection =
+00025c70: 2031 293a 0d0a 0d0a 2020 7369 6e20 3d20   1):....  sin = 
+00025c80: 636f 6566 6673 2e73 656c 6563 7428 5b30  coeffs.select([0
+00025c90: 5d29 0d0a 2020 636f 7320 3d20 636f 6566  ])..  cos = coef
+00025ca0: 6673 2e73 656c 6563 7428 5b31 5d29 0d0a  fs.select([1])..
+00025cb0: 0d0a 2020 2346 696e 6420 7768 6572 6520  ..  #Find where 
+00025cc0: 696e 2063 7963 6c65 2073 6c6f 7065 2069  in cycle slope i
+00025cd0: 7320 7a65 726f 0d0a 2020 6772 6565 6e44  s zero..  greenD
+00025ce0: 6174 6520 3d20 2828 7369 6e2e 6469 7669  ate = ((sin.divi
+00025cf0: 6465 2863 6f73 2929 2e61 7461 6e28 2929  de(cos)).atan())
+00025d00: 2e64 6976 6964 6528 322a 6d61 7468 2e70  .divide(2*math.p
+00025d10: 6929 2e72 656e 616d 6528 5b27 7065 616b  i).rename(['peak
+00025d20: 4461 7465 275d 290d 0a20 2067 7265 656e  Date'])..  green
+00025d30: 4461 7465 4c61 7465 7220 3d20 6772 6565  DateLater = gree
+00025d40: 6e44 6174 652e 6164 6428 302e 3529 0d0a  nDate.add(0.5)..
+00025d50: 2020 2343 6865 636b 2077 6869 6368 2064    #Check which d
+00025d60: 3120 736c 6f70 6520 3d20 3020 6973 2074  1 slope = 0 is t
+00025d70: 6865 206d 6178 2062 7920 7072 6564 6963  he max by predic
+00025d80: 7469 6e67 206f 7574 2074 6865 2076 616c  ting out the val
+00025d90: 7565 0d0a 2020 7072 6564 6963 7465 6431  ue..  predicted1
+00025da0: 203d 2063 6f65 6666 732e 7365 6c65 6374   = coeffs.select
+00025db0: 285b 305d 295c 0d0a 2020 2020 2020 2020  ([0])\..        
+00025dc0: 2020 2020 2020 2e61 6464 2873 696e 2e6d        .add(sin.m
+00025dd0: 756c 7469 706c 7928 6772 6565 6e44 6174  ultiply(greenDat
+00025de0: 652e 6d75 6c74 6970 6c79 2832 2a6d 6174  e.multiply(2*mat
+00025df0: 682e 7069 292e 7369 6e28 2929 295c 0d0a  h.pi).sin()))\..
+00025e00: 2020 2020 2020 2020 2020 2020 2020 2e61                .a
+00025e10: 6464 2863 6f73 2e6d 756c 7469 706c 7928  dd(cos.multiply(
+00025e20: 6772 6565 6e44 6174 652e 6d75 6c74 6970  greenDate.multip
+00025e30: 6c79 2832 2a6d 6174 682e 7069 292e 636f  ly(2*math.pi).co
+00025e40: 7328 2929 295c 0d0a 2020 2020 2020 2020  s()))\..        
+00025e50: 2020 2020 2020 2e72 656e 616d 6528 5b27        .rename(['
+00025e60: 7072 6564 6963 7465 6427 5d29 5c0d 0a20  predicted'])\.. 
+00025e70: 2020 2020 2020 2020 2020 2020 202e 6d75               .mu
+00025e80: 6c74 6970 6c79 2865 652e 496d 6167 652e  ltiply(ee.Image.
+00025e90: 636f 6e73 7461 6e74 2870 6561 6b44 6972  constant(peakDir
+00025ea0: 6563 7469 6f6e 2929 5c0d 0a20 2020 2020  ection))\..     
+00025eb0: 2020 2020 2020 2020 202e 6164 6442 616e           .addBan
+00025ec0: 6473 2867 7265 656e 4461 7465 290d 0a20  ds(greenDate).. 
+00025ed0: 2070 7265 6469 6374 6564 3220 3d20 636f   predicted2 = co
+00025ee0: 6566 6673 2e73 656c 6563 7428 5b30 5d29  effs.select([0])
+00025ef0: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
+00025f00: 202e 6164 6428 7369 6e2e 6d75 6c74 6970   .add(sin.multip
+00025f10: 6c79 2867 7265 656e 4461 7465 4c61 7465  ly(greenDateLate
+00025f20: 722e 6d75 6c74 6970 6c79 2832 2a6d 6174  r.multiply(2*mat
+00025f30: 682e 7069 292e 7369 6e28 2929 295c 0d0a  h.pi).sin()))\..
+00025f40: 2020 2020 2020 2020 2020 2020 2020 2e61                .a
+00025f50: 6464 2863 6f73 2e6d 756c 7469 706c 7928  dd(cos.multiply(
+00025f60: 6772 6565 6e44 6174 654c 6174 6572 2e6d  greenDateLater.m
+00025f70: 756c 7469 706c 7928 322a 6d61 7468 2e70  ultiply(2*math.p
+00025f80: 6929 2e63 6f73 2829 2929 5c0d 0a20 2020  i).cos()))\..   
+00025f90: 2020 2020 2020 2020 2020 202e 7265 6e61             .rena
+00025fa0: 6d65 285b 2770 7265 6469 6374 6564 275d  me(['predicted']
+00025fb0: 295c 0d0a 2020 2020 2020 2020 2020 2020  )\..            
+00025fc0: 2020 2e6d 756c 7469 706c 7928 6565 2e49    .multiply(ee.I
+00025fd0: 6d61 6765 2e63 6f6e 7374 616e 7428 7065  mage.constant(pe
+00025fe0: 616b 4469 7265 6374 696f 6e29 295c 0d0a  akDirection))\..
+00025ff0: 2020 2020 2020 2020 2020 2020 2020 2e61                .a
+00026000: 6464 4261 6e64 7328 6772 6565 6e44 6174  ddBands(greenDat
+00026010: 654c 6174 6572 290d 0a20 2066 696e 616c  eLater)..  final
+00026020: 4772 6565 6e44 6174 6520 3d20 6565 2e49  GreenDate = ee.I
+00026030: 6d61 6765 436f 6c6c 6563 7469 6f6e 285b  mageCollection([
+00026040: 7072 6564 6963 7465 6431 2c70 7265 6469  predicted1,predi
+00026050: 6374 6564 325d 292e 7175 616c 6974 794d  cted2]).qualityM
+00026060: 6f73 6169 6328 2770 7265 6469 6374 6564  osaic('predicted
+00026070: 2729 2e73 656c 6563 7428 5b27 7065 616b  ').select(['peak
+00026080: 4461 7465 275d 292e 7265 6e61 6d65 285b  Date']).rename([
+00026090: 2770 6561 6b4a 756c 6961 6e44 6179 275d  'peakJulianDay']
+000260a0: 290d 0a0d 0a20 2066 696e 616c 4772 6565  )....  finalGree
+000260b0: 6e44 6174 6520 3d20 6669 6e61 6c47 7265  nDate = finalGre
+000260c0: 656e 4461 7465 2e77 6865 7265 2866 696e  enDate.where(fin
+000260d0: 616c 4772 6565 6e44 6174 652e 6c74 2830  alGreenDate.lt(0
+000260e0: 292c 2067 7265 656e 4461 7465 2e61 6464  ), greenDate.add
+000260f0: 2831 2929 2e6d 756c 7469 706c 7928 3336  (1)).multiply(36
+00026100: 3529 2e69 6e74 3136 2829 3b0d 0a0d 0a20  5).int16();.... 
+00026110: 2023 436f 6e76 6572 7420 746f 206d 6f6e   #Convert to mon
+00026120: 7468 2061 6e64 2064 6179 206f 6620 6d6f  th and day of mo
+00026130: 6e74 680d 0a20 2067 7265 656e 4d6f 6e74  nth..  greenMont
+00026140: 6820 3d20 6669 6e61 6c47 7265 656e 4461  h = finalGreenDa
+00026150: 7465 2e72 656d 6170 286a 756c 6961 6e44  te.remap(julianD
+00026160: 6179 2c6d 6f6e 7468 5265 6d61 7029 2e72  ay,monthRemap).r
+00026170: 656e 616d 6528 5b27 7065 616b 4d6f 6e74  ename(['peakMont
+00026180: 6827 5d29 0d0a 2020 6772 6565 6e4d 6f6e  h'])..  greenMon
+00026190: 7468 4461 7920 3d20 6669 6e61 6c47 7265  thDay = finalGre
+000261a0: 656e 4461 7465 2e72 656d 6170 286a 756c  enDate.remap(jul
+000261b0: 6961 6e44 6179 2c6d 6f6e 7468 4461 7952  ianDay,monthDayR
+000261c0: 656d 6170 292e 7265 6e61 6d65 285b 2770  emap).rename(['p
+000261d0: 6561 6b44 6179 4f66 4d6f 6e74 6827 5d29  eakDayOfMonth'])
+000261e0: 0d0a 2020 6772 6565 6e53 7461 636b 203d  ..  greenStack =
+000261f0: 2066 696e 616c 4772 6565 6e44 6174 652e   finalGreenDate.
+00026200: 6164 6442 616e 6473 2867 7265 656e 4d6f  addBands(greenMo
+00026210: 6e74 6829 2e61 6464 4261 6e64 7328 6772  nth).addBands(gr
+00026220: 6565 6e4d 6f6e 7468 4461 7929 0d0a 2020  eenMonthDay)..  
+00026230: 7265 7475 726e 2067 7265 656e 5374 6163  return greenStac
+00026240: 6b0d 0a20 2023 4d61 702e 6164 644c 6179  k..  #Map.addLay
+00026250: 6572 2867 7265 656e 5374 6163 6b2c 7b27  er(greenStack,{'
+00026260: 6d69 6e27 3a31 2c27 6d61 7827 3a31 327d  min':1,'max':12}
+00026270: 2c27 6772 6565 6e4d 6f6e 7468 272c 4661  ,'greenMonth',Fa
+00026280: 6c73 6529 0d0a 0d0a 2323 2323 2323 2323  lse)....########
+00026290: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000262a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000262b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000262c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000262d0: 230d 0a23 2323 2323 2323 2323 2323 2323  #..#############
+000262e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000262f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00026300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00026310: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00026320: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00026330: 2323 2323 0d0a 2323 2323 2323 2323 2323  ####..##########
-00026340: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00026350: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00026360: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00026370: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
-00026380: 0a23 4675 6e63 7469 6f6e 2066 6f72 2067  .#Function for g
-00026390: 6574 7469 6e67 206c 6566 7420 7375 6d20  etting left sum 
-000263a0: 756e 6465 7220 7468 6520 6375 7276 6520  under the curve 
-000263b0: 666f 7220 6120 7369 6e67 6c65 2067 726f  for a single gro
-000263c0: 7769 6e67 2073 6561 736f 6e0d 0a23 5461  wing season..#Ta
-000263d0: 6b65 7320 6361 7265 206f 6620 6e6f 726d  kes care of norm
-000263e0: 616c 697a 6174 696f 6e20 6279 2066 6f72  alization by for
-000263f0: 6369 6e67 2074 6865 206d 696e 2076 616c  cing the min val
-00026400: 7565 2061 6c6f 6e67 2074 6865 2063 7572  ue along the cur
-00026410: 7665 2030 0d0a 2362 7920 7461 6b69 6e67  ve 0..#by taking
-00026420: 2074 6865 2061 6d70 6c69 7475 6465 2061   the amplitude a
-00026430: 7320 7468 6520 696e 7465 7263 6570 740d  s the intercept.
-00026440: 0a23 4173 7375 6d65 7320 7468 6520 7369  .#Assumes the si
-00026450: 6e20 616e 6420 636f 7320 636f 6566 6673  n and cos coeffs
-00026460: 2061 7265 2074 6865 2068 6172 6d43 6f65   are the harmCoe
-00026470: 6666 730d 0a23 7430 2069 7320 7468 6520  ffs..#t0 is the 
-00026480: 7374 6172 7420 7469 6d65 2028 6465 6661  start time (defa
-00026490: 756c 7473 2074 6f20 3029 286d 696e 2076  ults to 0)(min v
-000264a0: 616c 7565 2073 686f 756c 6420 6265 2062  alue should be b
-000264b0: 7574 2064 6f65 736e 2774 2068 6176 6520  ut doesn't have 
-000264c0: 746f 2062 6520 3029 0d0a 2374 3120 6973  to be 0)..#t1 is
-000264d0: 2074 6865 2065 6e64 2074 696d 6520 2864   the end time (d
-000264e0: 6566 6175 6c74 7320 746f 2031 2928 6d61  efaults to 1)(ma
-000264f0: 7820 7661 6c75 6520 7368 6f75 6c64 2062  x value should b
-00026500: 6520 6275 7420 646f 6573 6e27 7420 6861  e but doesn't ha
-00026510: 7665 2074 6f20 6265 2031 290d 0a0d 0a23  ve to be 1)....#
-00026520: 4578 616d 706c 6520 6f66 2077 6861 7420  Example of what 
-00026530: 7468 6973 2063 6f64 6520 6973 2064 6f69  this code is doi
-00026540: 6e67 2063 616e 2062 6520 666f 756e 6420  ng can be found 
-00026550: 6865 7265 3a0d 0a23 2020 6874 7470 3a2f  here:..#  http:/
-00026560: 2f77 7777 2e77 6f6c 6672 616d 616c 7068  /www.wolframalph
-00026570: 612e 636f 6d2f 696e 7075 742f 3f69 3d69  a.com/input/?i=i
-00026580: 6e74 6567 7261 7465 2b30 2e31 3539 3439  ntegrate+0.15949
-00026590: 3037 3439 3233 3939 3231 3537 2b25 3242  074923992157+%2B
-000265a0: 2b2d 302e 3038 3238 3735 3939 2a73 696e  +-0.08287599*sin
-000265b0: 2832 2b50 492b 5429 2b25 3242 2b2d 302e  (2+PI+T)+%2B+-0.
-000265c0: 3131 3235 3230 3130 3631 332a 636f 7328  11252010613*cos(
-000265d0: 322b 5049 2b54 292b 2b66 726f 6d2b 302b  2+PI+T)++from+0+
-000265e0: 746f 2b31 0d0a 6465 6620 6765 7441 7265  to+1..def getAre
-000265f0: 6155 6e64 6572 4375 7276 6528 6861 726d  aUnderCurve(harm
-00026600: 436f 6566 6673 2c74 303d 2030 2c74 3120  Coeffs,t0= 0,t1 
-00026610: 3d20 3129 3a0d 0a0d 0a20 2023 5075 6c6c  = 1):....  #Pull
-00026620: 2061 7061 7274 2074 6865 206d 6f64 656c   apart the model
-00026630: 0d0a 2020 616d 706c 6974 7564 6520 3d20  ..  amplitude = 
-00026640: 6861 726d 436f 6566 6673 2e73 656c 6563  harmCoeffs.selec
-00026650: 7428 5b31 5d29 2e68 7970 6f74 2868 6172  t([1]).hypot(har
-00026660: 6d43 6f65 6666 732e 7365 6c65 6374 285b  mCoeffs.select([
-00026670: 305d 2929 0d0a 2020 696e 7465 7265 6365  0]))..  interece
-00026680: 7074 4e6f 726d 616c 697a 6564 203d 2061  ptNormalized = a
-00026690: 6d70 6c69 7475 6465 2357 6865 6e20 6d61  mplitude#When ma
-000266a0: 6b69 6e67 2074 6865 206d 696e 2030 2c20  king the min 0, 
-000266b0: 7468 6520 696e 7465 7263 6570 7420 6265  the intercept be
-000266c0: 636f 6d65 7320 7468 6520 616d 706c 6974  comes the amplit
-000266d0: 7564 6520 2874 6865 2068 7970 6f74 656e  ude (the hypoten
-000266e0: 7573 6529 0d0a 2020 7369 6e20 3d20 6861  use)..  sin = ha
-000266f0: 726d 436f 6566 6673 2e73 656c 6563 7428  rmCoeffs.select(
-00026700: 5b30 5d29 0d0a 2020 636f 7320 3d20 6861  [0])..  cos = ha
-00026710: 726d 436f 6566 6673 2e73 656c 6563 7428  rmCoeffs.select(
-00026720: 5b31 5d29 0d0a 0d0a 2020 2346 696e 6420  [1])....  #Find 
-00026730: 7468 6520 7375 6d20 6672 6f6d 202d 2069  the sum from - i
-00026740: 6e66 696e 6974 7920 746f 2030 0d0a 2020  nfinity to 0..  
-00026750: 7375 6d30 203d 2069 6e74 6572 6563 6570  sum0 = interecep
-00026760: 744e 6f72 6d61 6c69 7a65 642e 6d75 6c74  tNormalized.mult
-00026770: 6970 6c79 2874 3029 5c0d 0a20 2020 2020  iply(t0)\..     
-00026780: 2020 2020 2020 202e 7375 6274 7261 6374         .subtract
-00026790: 2873 696e 2e64 6976 6964 6528 322a 6d61  (sin.divide(2*ma
-000267a0: 7468 2e70 6929 2e6d 756c 7469 706c 7928  th.pi).multiply(
-000267b0: 6d61 7468 2e73 696e 2832 2a6d 6174 682e  math.sin(2*math.
-000267c0: 7069 2a74 3029 2929 5c0d 0a20 2020 2020  pi*t0)))\..     
-000267d0: 2020 2020 2020 202e 6164 6428 636f 732e         .add(cos.
-000267e0: 6469 7669 6465 2832 2a6d 6174 682e 7069  divide(2*math.pi
-000267f0: 292e 6d75 6c74 6970 6c79 286d 6174 682e  ).multiply(math.
-00026800: 636f 7328 322a 6d61 7468 2e70 692a 7430  cos(2*math.pi*t0
-00026810: 2929 290d 0a20 2023 4669 6e64 2074 6865  )))..  #Find the
-00026820: 2073 756d 2066 726f 6d20 2d20 696e 6669   sum from - infi
-00026830: 6e69 7479 2074 6f20 310d 0a20 2073 756d  nity to 1..  sum
-00026840: 3120 3d20 696e 7465 7265 6365 7074 4e6f  1 = intereceptNo
-00026850: 726d 616c 697a 6564 2e6d 756c 7469 706c  rmalized.multipl
-00026860: 7928 7431 295c 0d0a 2020 2020 2020 2020  y(t1)\..        
-00026870: 2e73 7562 7472 6163 7428 7369 6e2e 6469  .subtract(sin.di
-00026880: 7669 6465 2832 2a6d 6174 682e 7069 292e  vide(2*math.pi).
-00026890: 6d75 6c74 6970 6c79 286d 6174 682e 7369  multiply(math.si
-000268a0: 6e28 322a 6d61 7468 2e70 692a 7431 2929  n(2*math.pi*t1))
-000268b0: 295c 0d0a 2020 2020 2020 2020 2e61 6464  )\..        .add
-000268c0: 2863 6f73 2e64 6976 6964 6528 322a 6d61  (cos.divide(2*ma
-000268d0: 7468 2e70 6929 2e6d 756c 7469 706c 7928  th.pi).multiply(
-000268e0: 6d61 7468 2e63 6f73 2832 2a6d 6174 682e  math.cos(2*math.
-000268f0: 7069 2a74 3129 2929 0d0a 2020 2346 696e  pi*t1)))..  #Fin
-00026900: 6420 7468 6520 6469 6666 6572 656e 6365  d the difference
-00026910: 0d0a 2020 6c65 6674 5375 6d20 3d20 7375  ..  leftSum = su
-00026920: 6d31 2e73 7562 7472 6163 7428 7375 6d30  m1.subtract(sum0
-00026930: 292e 7265 6e61 6d65 285b 2741 5543 275d  ).rename(['AUC']
-00026940: 290d 0a20 2072 6574 7572 6e20 6c65 6674  )..  return left
-00026950: 5375 6d0d 0a0d 0a23 2323 2323 2323 2323  Sum....#########
+00026310: 2323 2323 2323 2323 2323 2323 0d0a 2346  ############..#F
+00026320: 756e 6374 696f 6e20 666f 7220 6765 7474  unction for gett
+00026330: 696e 6720 6c65 6674 2073 756d 2075 6e64  ing left sum und
+00026340: 6572 2074 6865 2063 7572 7665 2066 6f72  er the curve for
+00026350: 2061 2073 696e 676c 6520 6772 6f77 696e   a single growin
+00026360: 6720 7365 6173 6f6e 0d0a 2354 616b 6573  g season..#Takes
+00026370: 2063 6172 6520 6f66 206e 6f72 6d61 6c69   care of normali
+00026380: 7a61 7469 6f6e 2062 7920 666f 7263 696e  zation by forcin
+00026390: 6720 7468 6520 6d69 6e20 7661 6c75 6520  g the min value 
+000263a0: 616c 6f6e 6720 7468 6520 6375 7276 6520  along the curve 
+000263b0: 300d 0a23 6279 2074 616b 696e 6720 7468  0..#by taking th
+000263c0: 6520 616d 706c 6974 7564 6520 6173 2074  e amplitude as t
+000263d0: 6865 2069 6e74 6572 6365 7074 0d0a 2341  he intercept..#A
+000263e0: 7373 756d 6573 2074 6865 2073 696e 2061  ssumes the sin a
+000263f0: 6e64 2063 6f73 2063 6f65 6666 7320 6172  nd cos coeffs ar
+00026400: 6520 7468 6520 6861 726d 436f 6566 6673  e the harmCoeffs
+00026410: 0d0a 2374 3020 6973 2074 6865 2073 7461  ..#t0 is the sta
+00026420: 7274 2074 696d 6520 2864 6566 6175 6c74  rt time (default
+00026430: 7320 746f 2030 2928 6d69 6e20 7661 6c75  s to 0)(min valu
+00026440: 6520 7368 6f75 6c64 2062 6520 6275 7420  e should be but 
+00026450: 646f 6573 6e27 7420 6861 7665 2074 6f20  doesn't have to 
+00026460: 6265 2030 290d 0a23 7431 2069 7320 7468  be 0)..#t1 is th
+00026470: 6520 656e 6420 7469 6d65 2028 6465 6661  e end time (defa
+00026480: 756c 7473 2074 6f20 3129 286d 6178 2076  ults to 1)(max v
+00026490: 616c 7565 2073 686f 756c 6420 6265 2062  alue should be b
+000264a0: 7574 2064 6f65 736e 2774 2068 6176 6520  ut doesn't have 
+000264b0: 746f 2062 6520 3129 0d0a 0d0a 2345 7861  to be 1)....#Exa
+000264c0: 6d70 6c65 206f 6620 7768 6174 2074 6869  mple of what thi
+000264d0: 7320 636f 6465 2069 7320 646f 696e 6720  s code is doing 
+000264e0: 6361 6e20 6265 2066 6f75 6e64 2068 6572  can be found her
+000264f0: 653a 0d0a 2320 2068 7474 703a 2f2f 7777  e:..#  http://ww
+00026500: 772e 776f 6c66 7261 6d61 6c70 6861 2e63  w.wolframalpha.c
+00026510: 6f6d 2f69 6e70 7574 2f3f 693d 696e 7465  om/input/?i=inte
+00026520: 6772 6174 652b 302e 3135 3934 3930 3734  grate+0.15949074
+00026530: 3932 3339 3932 3135 372b 2532 422b 2d30  923992157+%2B+-0
+00026540: 2e30 3832 3837 3539 392a 7369 6e28 322b  .08287599*sin(2+
+00026550: 5049 2b54 292b 2532 422b 2d30 2e31 3132  PI+T)+%2B+-0.112
+00026560: 3532 3031 3036 3133 2a63 6f73 2832 2b50  52010613*cos(2+P
+00026570: 492b 5429 2b2b 6672 6f6d 2b30 2b74 6f2b  I+T)++from+0+to+
+00026580: 310d 0a64 6566 2067 6574 4172 6561 556e  1..def getAreaUn
+00026590: 6465 7243 7572 7665 2868 6172 6d43 6f65  derCurve(harmCoe
+000265a0: 6666 732c 7430 3d20 302c 7431 203d 2031  ffs,t0= 0,t1 = 1
+000265b0: 293a 0d0a 0d0a 2020 2350 756c 6c20 6170  ):....  #Pull ap
+000265c0: 6172 7420 7468 6520 6d6f 6465 6c0d 0a20  art the model.. 
+000265d0: 2061 6d70 6c69 7475 6465 203d 2068 6172   amplitude = har
+000265e0: 6d43 6f65 6666 732e 7365 6c65 6374 285b  mCoeffs.select([
+000265f0: 315d 292e 6879 706f 7428 6861 726d 436f  1]).hypot(harmCo
+00026600: 6566 6673 2e73 656c 6563 7428 5b30 5d29  effs.select([0])
+00026610: 290d 0a20 2069 6e74 6572 6563 6570 744e  )..  intereceptN
+00026620: 6f72 6d61 6c69 7a65 6420 3d20 616d 706c  ormalized = ampl
+00026630: 6974 7564 6523 5768 656e 206d 616b 696e  itude#When makin
+00026640: 6720 7468 6520 6d69 6e20 302c 2074 6865  g the min 0, the
+00026650: 2069 6e74 6572 6365 7074 2062 6563 6f6d   intercept becom
+00026660: 6573 2074 6865 2061 6d70 6c69 7475 6465  es the amplitude
+00026670: 2028 7468 6520 6879 706f 7465 6e75 7365   (the hypotenuse
+00026680: 290d 0a20 2073 696e 203d 2068 6172 6d43  )..  sin = harmC
+00026690: 6f65 6666 732e 7365 6c65 6374 285b 305d  oeffs.select([0]
+000266a0: 290d 0a20 2063 6f73 203d 2068 6172 6d43  )..  cos = harmC
+000266b0: 6f65 6666 732e 7365 6c65 6374 285b 315d  oeffs.select([1]
+000266c0: 290d 0a0d 0a20 2023 4669 6e64 2074 6865  )....  #Find the
+000266d0: 2073 756d 2066 726f 6d20 2d20 696e 6669   sum from - infi
+000266e0: 6e69 7479 2074 6f20 300d 0a20 2073 756d  nity to 0..  sum
+000266f0: 3020 3d20 696e 7465 7265 6365 7074 4e6f  0 = intereceptNo
+00026700: 726d 616c 697a 6564 2e6d 756c 7469 706c  rmalized.multipl
+00026710: 7928 7430 295c 0d0a 2020 2020 2020 2020  y(t0)\..        
+00026720: 2020 2020 2e73 7562 7472 6163 7428 7369      .subtract(si
+00026730: 6e2e 6469 7669 6465 2832 2a6d 6174 682e  n.divide(2*math.
+00026740: 7069 292e 6d75 6c74 6970 6c79 286d 6174  pi).multiply(mat
+00026750: 682e 7369 6e28 322a 6d61 7468 2e70 692a  h.sin(2*math.pi*
+00026760: 7430 2929 295c 0d0a 2020 2020 2020 2020  t0)))\..        
+00026770: 2020 2020 2e61 6464 2863 6f73 2e64 6976      .add(cos.div
+00026780: 6964 6528 322a 6d61 7468 2e70 6929 2e6d  ide(2*math.pi).m
+00026790: 756c 7469 706c 7928 6d61 7468 2e63 6f73  ultiply(math.cos
+000267a0: 2832 2a6d 6174 682e 7069 2a74 3029 2929  (2*math.pi*t0)))
+000267b0: 0d0a 2020 2346 696e 6420 7468 6520 7375  ..  #Find the su
+000267c0: 6d20 6672 6f6d 202d 2069 6e66 696e 6974  m from - infinit
+000267d0: 7920 746f 2031 0d0a 2020 7375 6d31 203d  y to 1..  sum1 =
+000267e0: 2069 6e74 6572 6563 6570 744e 6f72 6d61   intereceptNorma
+000267f0: 6c69 7a65 642e 6d75 6c74 6970 6c79 2874  lized.multiply(t
+00026800: 3129 5c0d 0a20 2020 2020 2020 202e 7375  1)\..        .su
+00026810: 6274 7261 6374 2873 696e 2e64 6976 6964  btract(sin.divid
+00026820: 6528 322a 6d61 7468 2e70 6929 2e6d 756c  e(2*math.pi).mul
+00026830: 7469 706c 7928 6d61 7468 2e73 696e 2832  tiply(math.sin(2
+00026840: 2a6d 6174 682e 7069 2a74 3129 2929 5c0d  *math.pi*t1)))\.
+00026850: 0a20 2020 2020 2020 202e 6164 6428 636f  .        .add(co
+00026860: 732e 6469 7669 6465 2832 2a6d 6174 682e  s.divide(2*math.
+00026870: 7069 292e 6d75 6c74 6970 6c79 286d 6174  pi).multiply(mat
+00026880: 682e 636f 7328 322a 6d61 7468 2e70 692a  h.cos(2*math.pi*
+00026890: 7431 2929 290d 0a20 2023 4669 6e64 2074  t1)))..  #Find t
+000268a0: 6865 2064 6966 6665 7265 6e63 650d 0a20  he difference.. 
+000268b0: 206c 6566 7453 756d 203d 2073 756d 312e   leftSum = sum1.
+000268c0: 7375 6274 7261 6374 2873 756d 3029 2e72  subtract(sum0).r
+000268d0: 656e 616d 6528 5b27 4155 4327 5d29 0d0a  ename(['AUC'])..
+000268e0: 2020 7265 7475 726e 206c 6566 7453 756d    return leftSum
+000268f0: 0d0a 0d0a 2323 2323 2323 2323 2323 2323  ....############
+00026900: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00026910: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00026920: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00026930: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
+00026940: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00026950: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00026960: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00026970: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00026980: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00026990: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000269a0: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
-000269b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000269c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000269d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000269e0: 2323 2323 2323 2323 2323 230d 0a64 6566  ###########..def
-000269f0: 2067 6574 5068 6173 6541 6d70 6c69 7475   getPhaseAmplitu
-00026a00: 6465 5065 616b 2863 6f65 6666 732c 7430  dePeak(coeffs,t0
-00026a10: 203d 2030 2c74 3120 3d20 3129 3a0d 0a20   = 0,t1 = 1):.. 
-00026a20: 2023 5061 7273 6520 7468 6520 6d6f 6465   #Parse the mode
-00026a30: 6c0d 0a20 2062 616e 644e 616d 6573 203d  l..  bandNames =
-00026a40: 2063 6f65 6666 732e 6261 6e64 4e61 6d65   coeffs.bandName
-00026a50: 7328 290d 0a20 2062 616e 644e 756d 6265  s()..  bandNumbe
-00026a60: 7220 3d20 6261 6e64 4e61 6d65 732e 6c65  r = bandNames.le
-00026a70: 6e67 7468 2829 0d0a 2020 6e6f 4465 7065  ngth()..  noDepe
-00026a80: 6e64 656e 7473 203d 2065 652e 4e75 6d62  ndents = ee.Numb
-00026a90: 6572 2863 6f65 6666 732e 6765 7428 276e  er(coeffs.get('n
-00026aa0: 6f44 6570 656e 6465 6e74 7327 2929 0d0a  oDependents'))..
-00026ab0: 2020 6d6f 6465 6c4c 656e 6774 6820 3d20    modelLength = 
-00026ac0: 6565 2e4e 756d 6265 7228 636f 6566 6673  ee.Number(coeffs
-00026ad0: 2e67 6574 2827 6d6f 6465 6c4c 656e 6774  .get('modelLengt
-00026ae0: 6827 2929 0d0a 2020 696e 7465 7263 6570  h'))..  intercep
-00026af0: 7442 616e 6473 203d 2065 652e 4c69 7374  tBands = ee.List
-00026b00: 2e73 6571 7565 6e63 6528 302c 6261 6e64  .sequence(0,band
-00026b10: 4e75 6d62 6572 2e73 7562 7472 6163 7428  Number.subtract(
-00026b20: 3129 2c6d 6f64 656c 4c65 6e67 7468 290d  1),modelLength).
-00026b30: 0a0d 0a20 206d 6f64 656c 7320 3d20 6565  ...  models = ee
-00026b40: 2e4c 6973 742e 7365 7175 656e 6365 2830  .List.sequence(0
-00026b50: 2c6e 6f44 6570 656e 6465 6e74 732e 7375  ,noDependents.su
-00026b60: 6274 7261 6374 2831 2929 0d0a 0d0a 2020  btract(1))....  
-00026b70: 6465 6620 6d6f 6465 6c47 6574 7465 7228  def modelGetter(
-00026b80: 6d6e 293a 0d0a 2020 2020 6d6e 203d 2065  mn):..    mn = e
-00026b90: 652e 4e75 6d62 6572 286d 6e29 0d0a 2020  e.Number(mn)..  
-00026ba0: 2020 7265 7475 726e 2062 616e 644e 616d    return bandNam
-00026bb0: 6573 2e73 6c69 6365 286d 6e2e 6d75 6c74  es.slice(mn.mult
-00026bc0: 6970 6c79 286d 6f64 656c 4c65 6e67 7468  iply(modelLength
-00026bd0: 292c 6d6e 2e6d 756c 7469 706c 7928 6d6f  ),mn.multiply(mo
-00026be0: 6465 6c4c 656e 6774 6829 2e61 6464 286d  delLength).add(m
-00026bf0: 6f64 656c 4c65 6e67 7468 2929 0d0a 0d0a  odelLength))....
-00026c00: 2020 7061 7273 6564 4d6f 6465 6c20 3d6d    parsedModel =m
-00026c10: 6f64 656c 732e 6d61 7028 6d6f 6465 6c47  odels.map(modelG
-00026c20: 6574 7465 7229 0d0a 0d0a 0d0a 2020 2370  etter)......  #p
-00026c30: 7269 6e74 2827 5061 7273 6564 2068 6172  rint('Parsed har
-00026c40: 6d6f 6e69 6320 7265 6772 6573 7369 6f6e  monic regression
-00026c50: 206d 6f64 656c 272c 7061 7273 6564 4d6f   model',parsedMo
-00026c60: 6465 6c29 0d0a 0d0a 2020 2349 7465 7261  del)....  #Itera
-00026c70: 7465 2061 6372 6f73 7320 6d6f 6465 6c73  te across models
-00026c80: 2074 6f20 636f 6e76 6572 7420 746f 2070   to convert to p
-00026c90: 6861 7365 2c20 616d 706c 6974 7564 652c  hase, amplitude,
-00026ca0: 2061 6e64 2070 6561 6b0d 0a20 2064 6566   and peak..  def
-00026cb0: 2070 6170 4765 7474 6572 2870 6d29 3a0d   papGetter(pm):.
-00026cc0: 0a20 2020 2070 6d20 3d20 6565 2e4c 6973  .    pm = ee.Lis
-00026cd0: 7428 706d 293b 0d0a 2020 2020 6d6f 6465  t(pm);..    mode
-00026ce0: 6c43 6f65 6666 7320 3d20 636f 6566 6673  lCoeffs = coeffs
-00026cf0: 2e73 656c 6563 7428 706d 290d 0a0d 0a20  .select(pm).... 
-00026d00: 2020 2069 6e74 6572 6365 7074 203d 206d     intercept = m
-00026d10: 6f64 656c 436f 6566 6673 2e73 656c 6563  odelCoeffs.selec
-00026d20: 7428 272e 2a5f 696e 7465 7263 6570 7427  t('.*_intercept'
-00026d30: 290d 0a20 2020 2068 6172 6d43 6f65 6666  )..    harmCoeff
-00026d40: 7320 3d20 6d6f 6465 6c43 6f65 6666 732e  s = modelCoeffs.
-00026d50: 7365 6c65 6374 2827 2e2a 5f32 3030 5f79  select('.*_200_y
-00026d60: 6561 7227 290d 0a20 2020 206f 7574 4e61  ear')..    outNa
-00026d70: 6d65 203d 2065 652e 5374 7269 6e67 2865  me = ee.String(e
-00026d80: 652e 5374 7269 6e67 2870 6d2e 6765 7428  e.String(pm.get(
-00026d90: 3129 292e 7370 6c69 7428 275f 2729 2e67  1)).split('_').g
-00026da0: 6574 2830 2929 0d0a 2020 2020 7369 676e  et(0))..    sign
-00026db0: 203d 2065 652e 4e75 6d62 6572 2865 652e   = ee.Number(ee.
-00026dc0: 4469 6374 696f 6e61 7279 2863 6861 6e67  Dictionary(chang
-00026dd0: 6544 6972 4469 6374 292e 6765 7428 6f75  eDirDict).get(ou
-00026de0: 744e 616d 6529 292e 6d75 6c74 6970 6c79  tName)).multiply
-00026df0: 282d 3129 0d0a 0d0a 2020 2020 616d 706c  (-1)....    ampl
-00026e00: 6974 7564 6520 3d20 6861 726d 436f 6566  itude = harmCoef
-00026e10: 6673 2e73 656c 6563 7428 5b31 5d29 2e68  fs.select([1]).h
-00026e20: 7970 6f74 2868 6172 6d43 6f65 6666 732e  ypot(harmCoeffs.
-00026e30: 7365 6c65 6374 285b 305d 2929 5c0d 0a20  select([0]))\.. 
-00026e40: 2020 2020 2020 2020 2020 2020 202e 6d75               .mu
-00026e50: 6c74 6970 6c79 2832 295c 0d0a 2020 2020  ltiply(2)\..    
-00026e60: 2020 2020 2020 2020 2020 2e72 656e 616d            .renam
-00026e70: 6528 5b6f 7574 4e61 6d65 2e63 6174 2827  e([outName.cat('
-00026e80: 5f61 6d70 6c69 7475 6465 2729 5d29 0d0a  _amplitude')])..
-00026e90: 2020 2020 7068 6173 6520 3d20 6861 726d      phase = harm
-00026ea0: 436f 6566 6673 2e73 656c 6563 7428 5b30  Coeffs.select([0
-00026eb0: 5d29 2e61 7461 6e32 2868 6172 6d43 6f65  ]).atan2(harmCoe
-00026ec0: 6666 732e 7365 6c65 6374 285b 315d 2929  ffs.select([1]))
-00026ed0: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
-00026ee0: 202e 756e 6974 5363 616c 6528 2d6d 6174   .unitScale(-mat
-00026ef0: 682e 7069 2c20 6d61 7468 2e70 6929 5c0d  h.pi, math.pi)\.
-00026f00: 0a20 2020 2020 2020 2020 2020 2020 202e  .              .
-00026f10: 7265 6e61 6d65 285b 6f75 744e 616d 652e  rename([outName.
-00026f20: 6361 7428 275f 7068 6173 6527 295d 290d  cat('_phase')]).
-00026f30: 0a0d 0a20 2020 2023 4765 7420 7065 616b  ...    #Get peak
-00026f40: 2064 6174 6520 696e 666f 0d0a 2020 2020   date info..    
-00026f50: 7065 616b 4461 7465 203d 2067 6574 5065  peakDate = getPe
-00026f60: 616b 4461 7465 2868 6172 6d43 6f65 6666  akDate(harmCoeff
-00026f70: 732c 7369 676e 290d 0a20 2020 2070 6561  s,sign)..    pea
-00026f80: 6b44 6174 6542 616e 644e 616d 6573 203d  kDateBandNames =
-00026f90: 2070 6561 6b44 6174 652e 6261 6e64 4e61   peakDate.bandNa
-00026fa0: 6d65 7328 290d 0a20 2020 2070 6561 6b44  mes()..    peakD
-00026fb0: 6174 6542 616e 644e 616d 6573 203d 2070  ateBandNames = p
-00026fc0: 6561 6b44 6174 6542 616e 644e 616d 6573  eakDateBandNames
-00026fd0: 2e6d 6170 286c 616d 6264 6120 626e 3a20  .map(lambda bn: 
-00026fe0: 6f75 744e 616d 652e 6361 7428 6565 2e53  outName.cat(ee.S
-00026ff0: 7472 696e 6728 275f 2729 2e63 6174 2865  tring('_').cat(e
-00027000: 652e 5374 7269 6e67 2862 6e29 2929 290d  e.String(bn)))).
-00027010: 0a0d 0a20 2020 2023 4765 7420 7468 6520  ...    #Get the 
-00027020: 6c65 6674 2073 756d 0d0a 2020 2020 6c65  left sum..    le
-00027030: 6674 5375 6d20 3d20 6765 7441 7265 6155  ftSum = getAreaU
-00027040: 6e64 6572 4375 7276 6528 6861 726d 436f  nderCurve(harmCo
-00027050: 6566 6673 2c74 302c 7431 290d 0a20 2020  effs,t0,t1)..   
-00027060: 206c 6566 7453 756d 4261 6e64 4e61 6d65   leftSumBandName
-00027070: 7320 3d20 6c65 6674 5375 6d2e 6261 6e64  s = leftSum.band
-00027080: 4e61 6d65 7328 290d 0a20 2020 206c 6566  Names()..    lef
-00027090: 7453 756d 4261 6e64 4e61 6d65 7320 3d20  tSumBandNames = 
-000270a0: 6c65 6674 5375 6d42 616e 644e 616d 6573  leftSumBandNames
-000270b0: 2e6d 6170 286c 616d 6264 6120 626e 3a20  .map(lambda bn: 
-000270c0: 6f75 744e 616d 652e 6361 7428 6565 2e53  outName.cat(ee.S
-000270d0: 7472 696e 6728 275f 2729 2e63 6174 2865  tring('_').cat(e
-000270e0: 652e 5374 7269 6e67 2862 6e29 2929 290d  e.String(bn)))).
-000270f0: 0a0d 0a20 2020 2072 6574 7572 6e20 616d  ...    return am
-00027100: 706c 6974 7564 655c 0d0a 2020 2020 2020  plitude\..      
-00027110: 2020 2020 2020 2e61 6464 4261 6e64 7328        .addBands(
-00027120: 7068 6173 6529 5c0d 0a20 2020 2020 2020  phase)\..       
-00027130: 2020 2020 202e 6164 6442 616e 6473 2870       .addBands(p
-00027140: 6561 6b44 6174 652e 7265 6e61 6d65 2870  eakDate.rename(p
-00027150: 6561 6b44 6174 6542 616e 644e 616d 6573  eakDateBandNames
-00027160: 2929 5c0d 0a20 2020 2020 2020 2020 2020  ))\..           
-00027170: 202e 6164 6442 616e 6473 286c 6566 7453   .addBands(leftS
-00027180: 756d 2e72 656e 616d 6528 6c65 6674 5375  um.rename(leftSu
-00027190: 6d42 616e 644e 616d 6573 2929 0d0a 0d0a  mBandNames))....
-000271a0: 0d0a 0d0a 2020 2343 6f6e 7665 7274 2074  ....  #Convert t
-000271b0: 6f20 616e 2069 6d61 6765 0d0a 2020 7068  o an image..  ph
-000271c0: 6173 6541 6d70 6c69 7475 6465 203d 7061  aseAmplitude =pa
-000271d0: 7273 6564 4d6f 6465 6c2e 6d61 7028 7061  rsedModel.map(pa
-000271e0: 7047 6574 7465 7229 0d0a 0d0a 2020 7068  pGetter)....  ph
-000271f0: 6173 6541 6d70 6c69 7475 6465 203d 2065  aseAmplitude = e
-00027200: 652e 496d 6167 6543 6f6c 6c65 6374 696f  e.ImageCollectio
-00027210: 6e2e 6672 6f6d 496d 6167 6573 2870 6861  n.fromImages(pha
-00027220: 7365 416d 706c 6974 7564 6529 0d0a 0d0a  seAmplitude)....
-00027230: 2020 7068 6173 6541 6d70 6c69 7475 6465    phaseAmplitude
-00027240: 203d 2065 652e 496d 6167 6528 636f 6c6c   = ee.Image(coll
-00027250: 6563 7469 6f6e 546f 496d 6167 6528 7068  ectionToImage(ph
-00027260: 6173 6541 6d70 6c69 7475 6465 2929 2e66  aseAmplitude)).f
-00027270: 6c6f 6174 2829 5c0d 0a20 2020 2020 2020  loat()\..       
-00027280: 202e 636f 7079 5072 6f70 6572 7469 6573   .copyProperties
-00027290: 2863 6f65 6666 732c 5b27 7379 7374 656d  (coeffs,['system
-000272a0: 3a74 696d 655f 7374 6172 7427 5d29 0d0a  :time_start'])..
-000272b0: 2020 2370 7269 6e74 2827 7061 272c 7068    #print('pa',ph
-000272c0: 6173 6541 6d70 6c69 7475 6465 293b 0d0a  aseAmplitude);..
-000272d0: 2020 7265 7475 726e 2070 6861 7365 416d    return phaseAm
-000272e0: 706c 6974 7564 653b 0d0a 0d0a 2323 2323  plitude;....####
+00026980: 2323 2323 2323 2323 0d0a 6465 6620 6765  ########..def ge
+00026990: 7450 6861 7365 416d 706c 6974 7564 6550  tPhaseAmplitudeP
+000269a0: 6561 6b28 636f 6566 6673 2c74 3020 3d20  eak(coeffs,t0 = 
+000269b0: 302c 7431 203d 2031 293a 0d0a 2020 2350  0,t1 = 1):..  #P
+000269c0: 6172 7365 2074 6865 206d 6f64 656c 0d0a  arse the model..
+000269d0: 2020 6261 6e64 4e61 6d65 7320 3d20 636f    bandNames = co
+000269e0: 6566 6673 2e62 616e 644e 616d 6573 2829  effs.bandNames()
+000269f0: 0d0a 2020 6261 6e64 4e75 6d62 6572 203d  ..  bandNumber =
+00026a00: 2062 616e 644e 616d 6573 2e6c 656e 6774   bandNames.lengt
+00026a10: 6828 290d 0a20 206e 6f44 6570 656e 6465  h()..  noDepende
+00026a20: 6e74 7320 3d20 6565 2e4e 756d 6265 7228  nts = ee.Number(
+00026a30: 636f 6566 6673 2e67 6574 2827 6e6f 4465  coeffs.get('noDe
+00026a40: 7065 6e64 656e 7473 2729 290d 0a20 206d  pendents'))..  m
+00026a50: 6f64 656c 4c65 6e67 7468 203d 2065 652e  odelLength = ee.
+00026a60: 4e75 6d62 6572 2863 6f65 6666 732e 6765  Number(coeffs.ge
+00026a70: 7428 276d 6f64 656c 4c65 6e67 7468 2729  t('modelLength')
+00026a80: 290d 0a20 2069 6e74 6572 6365 7074 4261  )..  interceptBa
+00026a90: 6e64 7320 3d20 6565 2e4c 6973 742e 7365  nds = ee.List.se
+00026aa0: 7175 656e 6365 2830 2c62 616e 644e 756d  quence(0,bandNum
+00026ab0: 6265 722e 7375 6274 7261 6374 2831 292c  ber.subtract(1),
+00026ac0: 6d6f 6465 6c4c 656e 6774 6829 0d0a 0d0a  modelLength)....
+00026ad0: 2020 6d6f 6465 6c73 203d 2065 652e 4c69    models = ee.Li
+00026ae0: 7374 2e73 6571 7565 6e63 6528 302c 6e6f  st.sequence(0,no
+00026af0: 4465 7065 6e64 656e 7473 2e73 7562 7472  Dependents.subtr
+00026b00: 6163 7428 3129 290d 0a0d 0a20 2064 6566  act(1))....  def
+00026b10: 206d 6f64 656c 4765 7474 6572 286d 6e29   modelGetter(mn)
+00026b20: 3a0d 0a20 2020 206d 6e20 3d20 6565 2e4e  :..    mn = ee.N
+00026b30: 756d 6265 7228 6d6e 290d 0a20 2020 2072  umber(mn)..    r
+00026b40: 6574 7572 6e20 6261 6e64 4e61 6d65 732e  eturn bandNames.
+00026b50: 736c 6963 6528 6d6e 2e6d 756c 7469 706c  slice(mn.multipl
+00026b60: 7928 6d6f 6465 6c4c 656e 6774 6829 2c6d  y(modelLength),m
+00026b70: 6e2e 6d75 6c74 6970 6c79 286d 6f64 656c  n.multiply(model
+00026b80: 4c65 6e67 7468 292e 6164 6428 6d6f 6465  Length).add(mode
+00026b90: 6c4c 656e 6774 6829 290d 0a0d 0a20 2070  lLength))....  p
+00026ba0: 6172 7365 644d 6f64 656c 203d 6d6f 6465  arsedModel =mode
+00026bb0: 6c73 2e6d 6170 286d 6f64 656c 4765 7474  ls.map(modelGett
+00026bc0: 6572 290d 0a0d 0a0d 0a20 2023 7072 696e  er)......  #prin
+00026bd0: 7428 2750 6172 7365 6420 6861 726d 6f6e  t('Parsed harmon
+00026be0: 6963 2072 6567 7265 7373 696f 6e20 6d6f  ic regression mo
+00026bf0: 6465 6c27 2c70 6172 7365 644d 6f64 656c  del',parsedModel
+00026c00: 290d 0a0d 0a20 2023 4974 6572 6174 6520  )....  #Iterate 
+00026c10: 6163 726f 7373 206d 6f64 656c 7320 746f  across models to
+00026c20: 2063 6f6e 7665 7274 2074 6f20 7068 6173   convert to phas
+00026c30: 652c 2061 6d70 6c69 7475 6465 2c20 616e  e, amplitude, an
+00026c40: 6420 7065 616b 0d0a 2020 6465 6620 7061  d peak..  def pa
+00026c50: 7047 6574 7465 7228 706d 293a 0d0a 2020  pGetter(pm):..  
+00026c60: 2020 706d 203d 2065 652e 4c69 7374 2870    pm = ee.List(p
+00026c70: 6d29 3b0d 0a20 2020 206d 6f64 656c 436f  m);..    modelCo
+00026c80: 6566 6673 203d 2063 6f65 6666 732e 7365  effs = coeffs.se
+00026c90: 6c65 6374 2870 6d29 0d0a 0d0a 2020 2020  lect(pm)....    
+00026ca0: 696e 7465 7263 6570 7420 3d20 6d6f 6465  intercept = mode
+00026cb0: 6c43 6f65 6666 732e 7365 6c65 6374 2827  lCoeffs.select('
+00026cc0: 2e2a 5f69 6e74 6572 6365 7074 2729 0d0a  .*_intercept')..
+00026cd0: 2020 2020 6861 726d 436f 6566 6673 203d      harmCoeffs =
+00026ce0: 206d 6f64 656c 436f 6566 6673 2e73 656c   modelCoeffs.sel
+00026cf0: 6563 7428 272e 2a5f 3230 305f 7965 6172  ect('.*_200_year
+00026d00: 2729 0d0a 2020 2020 6f75 744e 616d 6520  ')..    outName 
+00026d10: 3d20 6565 2e53 7472 696e 6728 6565 2e53  = ee.String(ee.S
+00026d20: 7472 696e 6728 706d 2e67 6574 2831 2929  tring(pm.get(1))
+00026d30: 2e73 706c 6974 2827 5f27 292e 6765 7428  .split('_').get(
+00026d40: 3029 290d 0a20 2020 2073 6967 6e20 3d20  0))..    sign = 
+00026d50: 6565 2e4e 756d 6265 7228 6565 2e44 6963  ee.Number(ee.Dic
+00026d60: 7469 6f6e 6172 7928 6368 616e 6765 4469  tionary(changeDi
+00026d70: 7244 6963 7429 2e67 6574 286f 7574 4e61  rDict).get(outNa
+00026d80: 6d65 2929 2e6d 756c 7469 706c 7928 2d31  me)).multiply(-1
+00026d90: 290d 0a0d 0a20 2020 2061 6d70 6c69 7475  )....    amplitu
+00026da0: 6465 203d 2068 6172 6d43 6f65 6666 732e  de = harmCoeffs.
+00026db0: 7365 6c65 6374 285b 315d 292e 6879 706f  select([1]).hypo
+00026dc0: 7428 6861 726d 436f 6566 6673 2e73 656c  t(harmCoeffs.sel
+00026dd0: 6563 7428 5b30 5d29 295c 0d0a 2020 2020  ect([0]))\..    
+00026de0: 2020 2020 2020 2020 2020 2e6d 756c 7469            .multi
+00026df0: 706c 7928 3229 5c0d 0a20 2020 2020 2020  ply(2)\..       
+00026e00: 2020 2020 2020 202e 7265 6e61 6d65 285b         .rename([
+00026e10: 6f75 744e 616d 652e 6361 7428 275f 616d  outName.cat('_am
+00026e20: 706c 6974 7564 6527 295d 290d 0a20 2020  plitude')])..   
+00026e30: 2070 6861 7365 203d 2068 6172 6d43 6f65   phase = harmCoe
+00026e40: 6666 732e 7365 6c65 6374 285b 305d 292e  ffs.select([0]).
+00026e50: 6174 616e 3228 6861 726d 436f 6566 6673  atan2(harmCoeffs
+00026e60: 2e73 656c 6563 7428 5b31 5d29 295c 0d0a  .select([1]))\..
+00026e70: 2020 2020 2020 2020 2020 2020 2020 2e75                .u
+00026e80: 6e69 7453 6361 6c65 282d 6d61 7468 2e70  nitScale(-math.p
+00026e90: 692c 206d 6174 682e 7069 295c 0d0a 2020  i, math.pi)\..  
+00026ea0: 2020 2020 2020 2020 2020 2020 2e72 656e              .ren
+00026eb0: 616d 6528 5b6f 7574 4e61 6d65 2e63 6174  ame([outName.cat
+00026ec0: 2827 5f70 6861 7365 2729 5d29 0d0a 0d0a  ('_phase')])....
+00026ed0: 2020 2020 2347 6574 2070 6561 6b20 6461      #Get peak da
+00026ee0: 7465 2069 6e66 6f0d 0a20 2020 2070 6561  te info..    pea
+00026ef0: 6b44 6174 6520 3d20 6765 7450 6561 6b44  kDate = getPeakD
+00026f00: 6174 6528 6861 726d 436f 6566 6673 2c73  ate(harmCoeffs,s
+00026f10: 6967 6e29 0d0a 2020 2020 7065 616b 4461  ign)..    peakDa
+00026f20: 7465 4261 6e64 4e61 6d65 7320 3d20 7065  teBandNames = pe
+00026f30: 616b 4461 7465 2e62 616e 644e 616d 6573  akDate.bandNames
+00026f40: 2829 0d0a 2020 2020 7065 616b 4461 7465  ()..    peakDate
+00026f50: 4261 6e64 4e61 6d65 7320 3d20 7065 616b  BandNames = peak
+00026f60: 4461 7465 4261 6e64 4e61 6d65 732e 6d61  DateBandNames.ma
+00026f70: 7028 6c61 6d62 6461 2062 6e3a 206f 7574  p(lambda bn: out
+00026f80: 4e61 6d65 2e63 6174 2865 652e 5374 7269  Name.cat(ee.Stri
+00026f90: 6e67 2827 5f27 292e 6361 7428 6565 2e53  ng('_').cat(ee.S
+00026fa0: 7472 696e 6728 626e 2929 2929 0d0a 0d0a  tring(bn))))....
+00026fb0: 2020 2020 2347 6574 2074 6865 206c 6566      #Get the lef
+00026fc0: 7420 7375 6d0d 0a20 2020 206c 6566 7453  t sum..    leftS
+00026fd0: 756d 203d 2067 6574 4172 6561 556e 6465  um = getAreaUnde
+00026fe0: 7243 7572 7665 2868 6172 6d43 6f65 6666  rCurve(harmCoeff
+00026ff0: 732c 7430 2c74 3129 0d0a 2020 2020 6c65  s,t0,t1)..    le
+00027000: 6674 5375 6d42 616e 644e 616d 6573 203d  ftSumBandNames =
+00027010: 206c 6566 7453 756d 2e62 616e 644e 616d   leftSum.bandNam
+00027020: 6573 2829 0d0a 2020 2020 6c65 6674 5375  es()..    leftSu
+00027030: 6d42 616e 644e 616d 6573 203d 206c 6566  mBandNames = lef
+00027040: 7453 756d 4261 6e64 4e61 6d65 732e 6d61  tSumBandNames.ma
+00027050: 7028 6c61 6d62 6461 2062 6e3a 206f 7574  p(lambda bn: out
+00027060: 4e61 6d65 2e63 6174 2865 652e 5374 7269  Name.cat(ee.Stri
+00027070: 6e67 2827 5f27 292e 6361 7428 6565 2e53  ng('_').cat(ee.S
+00027080: 7472 696e 6728 626e 2929 2929 0d0a 0d0a  tring(bn))))....
+00027090: 2020 2020 7265 7475 726e 2061 6d70 6c69      return ampli
+000270a0: 7475 6465 5c0d 0a20 2020 2020 2020 2020  tude\..         
+000270b0: 2020 202e 6164 6442 616e 6473 2870 6861     .addBands(pha
+000270c0: 7365 295c 0d0a 2020 2020 2020 2020 2020  se)\..          
+000270d0: 2020 2e61 6464 4261 6e64 7328 7065 616b    .addBands(peak
+000270e0: 4461 7465 2e72 656e 616d 6528 7065 616b  Date.rename(peak
+000270f0: 4461 7465 4261 6e64 4e61 6d65 7329 295c  DateBandNames))\
+00027100: 0d0a 2020 2020 2020 2020 2020 2020 2e61  ..            .a
+00027110: 6464 4261 6e64 7328 6c65 6674 5375 6d2e  ddBands(leftSum.
+00027120: 7265 6e61 6d65 286c 6566 7453 756d 4261  rename(leftSumBa
+00027130: 6e64 4e61 6d65 7329 290d 0a0d 0a0d 0a0d  ndNames)).......
+00027140: 0a20 2023 436f 6e76 6572 7420 746f 2061  .  #Convert to a
+00027150: 6e20 696d 6167 650d 0a20 2070 6861 7365  n image..  phase
+00027160: 416d 706c 6974 7564 6520 3d70 6172 7365  Amplitude =parse
+00027170: 644d 6f64 656c 2e6d 6170 2870 6170 4765  dModel.map(papGe
+00027180: 7474 6572 290d 0a0d 0a20 2070 6861 7365  tter)....  phase
+00027190: 416d 706c 6974 7564 6520 3d20 6565 2e49  Amplitude = ee.I
+000271a0: 6d61 6765 436f 6c6c 6563 7469 6f6e 2e66  mageCollection.f
+000271b0: 726f 6d49 6d61 6765 7328 7068 6173 6541  romImages(phaseA
+000271c0: 6d70 6c69 7475 6465 290d 0a0d 0a20 2070  mplitude)....  p
+000271d0: 6861 7365 416d 706c 6974 7564 6520 3d20  haseAmplitude = 
+000271e0: 6565 2e49 6d61 6765 2863 6f6c 6c65 6374  ee.Image(collect
+000271f0: 696f 6e54 6f49 6d61 6765 2870 6861 7365  ionToImage(phase
+00027200: 416d 706c 6974 7564 6529 292e 666c 6f61  Amplitude)).floa
+00027210: 7428 295c 0d0a 2020 2020 2020 2020 2e63  t()\..        .c
+00027220: 6f70 7950 726f 7065 7274 6965 7328 636f  opyProperties(co
+00027230: 6566 6673 2c5b 2773 7973 7465 6d3a 7469  effs,['system:ti
+00027240: 6d65 5f73 7461 7274 275d 290d 0a20 2023  me_start'])..  #
+00027250: 7072 696e 7428 2770 6127 2c70 6861 7365  print('pa',phase
+00027260: 416d 706c 6974 7564 6529 3b0d 0a20 2072  Amplitude);..  r
+00027270: 6574 7572 6e20 7068 6173 6541 6d70 6c69  eturn phaseAmpli
+00027280: 7475 6465 3b0d 0a0d 0a23 2323 2323 2323  tude;....#######
+00027290: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000272a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000272b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000272c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000272d0: 2323 0d0a 2323 2323 2323 2323 2323 2323  ##..############
+000272e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000272f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00027300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00027310: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00027320: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00027330: 2323 2323 230d 0a23 2323 2323 2323 2323  #####..#########
-00027340: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00027350: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00027360: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00027370: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00027380: 0d0a 2346 756e 6374 696f 6e20 666f 7220  ..#Function for 
-00027390: 6170 706c 7969 6e67 2068 6172 6d6f 6e69  applying harmoni
-000273a0: 6320 7265 6772 6573 7369 6f6e 206d 6f64  c regression mod
-000273b0: 656c 2074 6f20 7365 7420 6f66 2070 7265  el to set of pre
-000273c0: 6469 6374 6f72 2073 6574 730d 0a64 6566  dictor sets..def
-000273d0: 206e 6577 5072 6564 6963 7428 636f 6566   newPredict(coef
-000273e0: 6673 2c68 6172 6d6f 6e69 6373 293a 0d0a  fs,harmonics):..
-000273f0: 2020 2350 6172 7365 2074 6865 206d 6f64    #Parse the mod
-00027400: 656c 0d0a 2020 6261 6e64 4e61 6d65 7320  el..  bandNames 
-00027410: 3d20 636f 6566 6673 2e62 616e 644e 616d  = coeffs.bandNam
-00027420: 6573 2829 0d0a 2020 6261 6e64 4e75 6d62  es()..  bandNumb
-00027430: 6572 203d 2062 616e 644e 616d 6573 2e6c  er = bandNames.l
-00027440: 656e 6774 6828 290d 0a20 206e 6f44 6570  ength()..  noDep
-00027450: 656e 6465 6e74 7320 3d20 6565 2e4e 756d  endents = ee.Num
-00027460: 6265 7228 636f 6566 6673 2e67 6574 2827  ber(coeffs.get('
-00027470: 6e6f 4465 7065 6e64 656e 7473 2729 290d  noDependents')).
-00027480: 0a20 206d 6f64 656c 4c65 6e67 7468 203d  .  modelLength =
-00027490: 2065 652e 4e75 6d62 6572 2863 6f65 6666   ee.Number(coeff
-000274a0: 732e 6765 7428 276d 6f64 656c 4c65 6e67  s.get('modelLeng
-000274b0: 7468 2729 290d 0a20 2069 6e74 6572 6365  th'))..  interce
-000274c0: 7074 4261 6e64 7320 3d20 6565 2e4c 6973  ptBands = ee.Lis
-000274d0: 742e 7365 7175 656e 6365 2830 2c62 616e  t.sequence(0,ban
-000274e0: 644e 756d 6265 722e 7375 6274 7261 6374  dNumber.subtract
-000274f0: 2831 292c 6d6f 6465 6c4c 656e 6774 6829  (1),modelLength)
-00027500: 0d0a 2020 7469 6d65 4261 6e64 203d 2065  ..  timeBand = e
-00027510: 652e 4c69 7374 2868 6172 6d6f 6e69 6373  e.List(harmonics
-00027520: 2e67 6574 2827 696e 6442 616e 644e 616d  .get('indBandNam
-00027530: 6573 2729 292e 6765 7428 3029 0d0a 2020  es')).get(0)..  
-00027540: 6163 7475 616c 4261 6e64 7320 3d20 6861  actualBands = ha
-00027550: 726d 6f6e 6963 732e 6765 7428 2764 6570  rmonics.get('dep
-00027560: 4261 6e64 4e75 6d62 6572 7327 290d 0a20  BandNumbers').. 
-00027570: 2069 6e64 4261 6e64 7320 3d20 6861 726d   indBands = harm
-00027580: 6f6e 6963 732e 6765 7428 2769 6e64 4261  onics.get('indBa
-00027590: 6e64 4e75 6d62 6572 7327 290d 0a20 2069  ndNumbers')..  i
-000275a0: 6e64 4261 6e64 4e61 6d65 7320 3d20 6565  ndBandNames = ee
-000275b0: 2e4c 6973 7428 6861 726d 6f6e 6963 732e  .List(harmonics.
-000275c0: 6765 7428 2769 6e64 4261 6e64 4e61 6d65  get('indBandName
-000275d0: 7327 2929 0d0a 2020 6465 7042 616e 644e  s'))..  depBandN
-000275e0: 616d 6573 203d 2065 652e 4c69 7374 2868  ames = ee.List(h
-000275f0: 6172 6d6f 6e69 6373 2e67 6574 2827 6465  armonics.get('de
-00027600: 7042 616e 644e 616d 6573 2729 290d 0a20  pBandNames')).. 
-00027610: 2070 7265 6469 6374 6564 4261 6e64 4e61   predictedBandNa
-00027620: 6d65 7320 3d20 6465 7042 616e 644e 616d  mes = depBandNam
-00027630: 6573 2e6d 6170 286c 616d 6264 6120 6465  es.map(lambda de
-00027640: 7062 6e6d 733a 6565 2e53 7472 696e 6728  pbnms:ee.String(
-00027650: 6465 7062 6e6d 7329 2e63 6174 2827 5f70  depbnms).cat('_p
-00027660: 7265 6469 6374 6564 2729 290d 0a20 2070  redicted'))..  p
-00027670: 7265 6469 6374 6564 4261 6e64 4e75 6d62  redictedBandNumb
-00027680: 6572 7320 3d20 6565 2e4c 6973 742e 7365  ers = ee.List.se
-00027690: 7175 656e 6365 2830 2c70 7265 6469 6374  quence(0,predict
-000276a0: 6564 4261 6e64 4e61 6d65 732e 6c65 6e67  edBandNames.leng
-000276b0: 7468 2829 2e73 7562 7472 6163 7428 3129  th().subtract(1)
-000276c0: 290d 0a0d 0a20 206d 6f64 656c 7320 3d20  )....  models = 
-000276d0: 6565 2e4c 6973 742e 7365 7175 656e 6365  ee.List.sequence
-000276e0: 2830 2c6e 6f44 6570 656e 6465 6e74 732e  (0,noDependents.
-000276f0: 7375 6274 7261 6374 2831 2929 0d0a 2020  subtract(1))..  
-00027700: 6465 6620 6d6e 4765 7474 6572 286d 6e29  def mnGetter(mn)
-00027710: 3a0d 0a20 2020 206d 6e20 3d20 6565 2e4e  :..    mn = ee.N
-00027720: 756d 6265 7228 6d6e 290d 0a20 2020 2072  umber(mn)..    r
-00027730: 6574 7572 6e20 6261 6e64 4e61 6d65 732e  eturn bandNames.
-00027740: 736c 6963 6528 6d6e 2e6d 756c 7469 706c  slice(mn.multipl
-00027750: 7928 6d6f 6465 6c4c 656e 6774 6829 2c6d  y(modelLength),m
-00027760: 6e2e 6d75 6c74 6970 6c79 286d 6f64 656c  n.multiply(model
-00027770: 4c65 6e67 7468 292e 6164 6428 6d6f 6465  Length).add(mode
-00027780: 6c4c 656e 6774 6829 290d 0a0d 0a20 2070  lLength))....  p
-00027790: 6172 7365 644d 6f64 656c 203d 6d6f 6465  arsedModel =mode
-000277a0: 6c73 2e6d 6170 286d 6e47 6574 7465 7229  ls.map(mnGetter)
-000277b0: 0d0a 0d0a 2020 2370 7269 6e74 2827 5061  ....  #print('Pa
-000277c0: 7273 6564 2068 6172 6d6f 6e69 6320 7265  rsed harmonic re
-000277d0: 6772 6573 7369 6f6e 206d 6f64 656c 272c  gression model',
-000277e0: 7061 7273 6564 4d6f 6465 6c2c 7072 6564  parsedModel,pred
-000277f0: 6963 7465 6442 616e 644e 616d 6573 290d  ictedBandNames).
-00027800: 0a0d 0a20 2023 4170 706c 7920 7061 7273  ...  #Apply pars
-00027810: 6564 206d 6f64 656c 0d0a 2020 6465 6620  ed model..  def 
-00027820: 7072 6564 4765 7474 6572 2869 6d67 293a  predGetter(img):
-00027830: 0d0a 2020 2020 7469 6d65 203d 2069 6d67  ..    time = img
-00027840: 2e73 656c 6563 7428 7469 6d65 4261 6e64  .select(timeBand
-00027850: 290d 0a20 2020 2061 6374 7561 6c20 3d20  )..    actual = 
-00027860: 696d 672e 7365 6c65 6374 2861 6374 7561  img.select(actua
-00027870: 6c42 616e 6473 292e 666c 6f61 7428 290d  lBands).float().
-00027880: 0a20 2020 2070 7265 6469 6374 6f72 4261  .    predictorBa
-00027890: 6e64 7320 3d20 696d 672e 7365 6c65 6374  nds = img.select
-000278a0: 2869 6e64 4261 6e64 4e61 6d65 7329 0d0a  (indBandNames)..
-000278b0: 0d0a 2020 2020 2349 7465 7261 7465 2061  ..    #Iterate a
-000278c0: 6372 6f73 7320 6561 6368 206d 6f64 656c  cross each model
-000278d0: 2066 6f72 2065 6163 6820 6465 7065 6e64   for each depend
-000278e0: 656e 7420 7661 7269 6162 6c65 0d0a 2020  ent variable..  
-000278f0: 2020 6465 6620 706d 4765 7474 6572 2870    def pmGetter(p
-00027900: 6d29 3a0d 0a20 2020 2020 2070 6d20 3d20  m):..      pm = 
-00027910: 6565 2e4c 6973 7428 706d 290d 0a20 2020  ee.List(pm)..   
-00027920: 2020 206d 6f64 656c 436f 6566 6673 203d     modelCoeffs =
-00027930: 2063 6f65 6666 732e 7365 6c65 6374 2870   coeffs.select(p
-00027940: 6d29 0d0a 2020 2020 2020 6f75 744e 616d  m)..      outNam
-00027950: 6520 3d20 6565 2e53 7472 696e 6728 706d  e = ee.String(pm
-00027960: 2e67 6574 2831 2929 2e63 6174 2827 5f70  .get(1)).cat('_p
-00027970: 7265 6469 6374 6564 2729 0d0a 2020 2020  redicted')..    
-00027980: 2020 696e 7465 7263 6570 7420 3d20 6d6f    intercept = mo
-00027990: 6465 6c43 6f65 6666 732e 7365 6c65 6374  delCoeffs.select
-000279a0: 286d 6f64 656c 436f 6566 6673 2e62 616e  (modelCoeffs.ban
-000279b0: 644e 616d 6573 2829 2e73 6c69 6365 2830  dNames().slice(0
-000279c0: 2c31 2929 0d0a 2020 2020 2020 6f74 6865  ,1))..      othe
-000279d0: 7273 203d 206d 6f64 656c 436f 6566 6673  rs = modelCoeffs
-000279e0: 2e73 656c 6563 7428 6d6f 6465 6c43 6f65  .select(modelCoe
-000279f0: 6666 732e 6261 6e64 4e61 6d65 7328 292e  ffs.bandNames().
-00027a00: 736c 6963 6528 312c 4e6f 6e65 2929 0d0a  slice(1,None))..
-00027a10: 0d0a 2020 2020 2020 7072 6564 6963 7465  ..      predicte
-00027a20: 6420 3d20 7072 6564 6963 746f 7242 616e  d = predictorBan
-00027a30: 6473 2e6d 756c 7469 706c 7928 6f74 6865  ds.multiply(othe
-00027a40: 7273 292e 7265 6475 6365 2865 652e 5265  rs).reduce(ee.Re
-00027a50: 6475 6365 722e 7375 6d28 2929 2e61 6464  ducer.sum()).add
-00027a60: 2869 6e74 6572 6365 7074 292e 666c 6f61  (intercept).floa
-00027a70: 7428 290d 0a20 2020 2020 2072 6574 7572  t()..      retur
-00027a80: 6e20 7072 6564 6963 7465 642e 666c 6f61  n predicted.floa
-00027a90: 7428 290d 0a0d 0a0d 0a20 2020 2070 7265  t()......    pre
-00027aa0: 6469 6374 6564 4c69 7374 203d 7061 7273  dictedList =pars
-00027ab0: 6564 4d6f 6465 6c2e 6d61 7028 706d 4765  edModel.map(pmGe
-00027ac0: 7474 6572 290d 0a0d 0a20 2020 2023 436f  tter)....    #Co
-00027ad0: 6e76 6572 7420 746f 2061 6e20 696d 6167  nvert to an imag
-00027ae0: 650d 0a20 2020 2070 7265 6469 6374 6564  e..    predicted
-00027af0: 4c69 7374 203d 2065 652e 496d 6167 6543  List = ee.ImageC
-00027b00: 6f6c 6c65 6374 696f 6e2e 6672 6f6d 496d  ollection.fromIm
-00027b10: 6167 6573 2870 7265 6469 6374 6564 4c69  ages(predictedLi
-00027b20: 7374 290d 0a20 2020 2070 7265 6469 6374  st)..    predict
-00027b30: 6564 496d 6167 6520 3d20 636f 6c6c 6563  edImage = collec
-00027b40: 7469 6f6e 546f 496d 6167 6528 7072 6564  tionToImage(pred
-00027b50: 6963 7465 644c 6973 7429 2e73 656c 6563  ictedList).selec
-00027b60: 7428 7072 6564 6963 7465 6442 616e 644e  t(predictedBandN
-00027b70: 756d 6265 7273 2c70 7265 6469 6374 6564  umbers,predicted
-00027b80: 4261 6e64 4e61 6d65 7329 0d0a 0d0a 2020  BandNames)....  
-00027b90: 2020 2353 6574 2073 6f6d 6520 6d65 7461    #Set some meta
-00027ba0: 6461 7461 0d0a 2020 2020 6f75 7420 3d20  data..    out = 
-00027bb0: 6163 7475 616c 2e61 6464 4261 6e64 7328  actual.addBands(
-00027bc0: 7072 6564 6963 7465 6449 6d61 6765 2e66  predictedImage.f
-00027bd0: 6c6f 6174 2829 295c 0d0a 2020 2020 2e63  loat())\..    .c
-00027be0: 6f70 7950 726f 7065 7274 6965 7328 696d  opyProperties(im
-00027bf0: 672c 5b27 7379 7374 656d 3a74 696d 655f  g,['system:time_
-00027c00: 7374 6172 7427 2c27 7379 7374 656d 3a74  start','system:t
-00027c10: 696d 655f 656e 6427 5d29 0d0a 2020 2020  ime_end'])..    
-00027c20: 7265 7475 726e 206f 7574 0d0a 0d0a 2020  return out....  
-00027c30: 7072 6564 6963 7465 6420 3d68 6172 6d6f  predicted =harmo
-00027c40: 6e69 6373 2e6d 6170 2870 7265 6447 6574  nics.map(predGet
-00027c50: 7465 7229 0d0a 0d0a 2020 7072 6564 6963  ter)....  predic
-00027c60: 7465 6420 3d20 6565 2e49 6d61 6765 436f  ted = ee.ImageCo
-00027c70: 6c6c 6563 7469 6f6e 2870 7265 6469 6374  llection(predict
-00027c80: 6564 290d 0a0d 0a20 2023 4d61 702e 6164  ed)....  #Map.ad
-00027c90: 644c 6179 6572 2870 7265 6469 6374 6564  dLayer(predicted
-00027ca0: 2c7b 7d2c 2770 7265 6469 6374 6564 272c  ,{},'predicted',
-00027cb0: 4661 6c73 6529 0d0a 0d0a 2020 7265 7475  False)....  retu
-00027cc0: 726e 2070 7265 6469 6374 6564 0d0a 0d0a  rn predicted....
+00027310: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
+00027320: 4675 6e63 7469 6f6e 2066 6f72 2061 7070  Function for app
+00027330: 6c79 696e 6720 6861 726d 6f6e 6963 2072  lying harmonic r
+00027340: 6567 7265 7373 696f 6e20 6d6f 6465 6c20  egression model 
+00027350: 746f 2073 6574 206f 6620 7072 6564 6963  to set of predic
+00027360: 746f 7220 7365 7473 0d0a 6465 6620 6e65  tor sets..def ne
+00027370: 7750 7265 6469 6374 2863 6f65 6666 732c  wPredict(coeffs,
+00027380: 6861 726d 6f6e 6963 7329 3a0d 0a20 2023  harmonics):..  #
+00027390: 5061 7273 6520 7468 6520 6d6f 6465 6c0d  Parse the model.
+000273a0: 0a20 2062 616e 644e 616d 6573 203d 2063  .  bandNames = c
+000273b0: 6f65 6666 732e 6261 6e64 4e61 6d65 7328  oeffs.bandNames(
+000273c0: 290d 0a20 2062 616e 644e 756d 6265 7220  )..  bandNumber 
+000273d0: 3d20 6261 6e64 4e61 6d65 732e 6c65 6e67  = bandNames.leng
+000273e0: 7468 2829 0d0a 2020 6e6f 4465 7065 6e64  th()..  noDepend
+000273f0: 656e 7473 203d 2065 652e 4e75 6d62 6572  ents = ee.Number
+00027400: 2863 6f65 6666 732e 6765 7428 276e 6f44  (coeffs.get('noD
+00027410: 6570 656e 6465 6e74 7327 2929 0d0a 2020  ependents'))..  
+00027420: 6d6f 6465 6c4c 656e 6774 6820 3d20 6565  modelLength = ee
+00027430: 2e4e 756d 6265 7228 636f 6566 6673 2e67  .Number(coeffs.g
+00027440: 6574 2827 6d6f 6465 6c4c 656e 6774 6827  et('modelLength'
+00027450: 2929 0d0a 2020 696e 7465 7263 6570 7442  ))..  interceptB
+00027460: 616e 6473 203d 2065 652e 4c69 7374 2e73  ands = ee.List.s
+00027470: 6571 7565 6e63 6528 302c 6261 6e64 4e75  equence(0,bandNu
+00027480: 6d62 6572 2e73 7562 7472 6163 7428 3129  mber.subtract(1)
+00027490: 2c6d 6f64 656c 4c65 6e67 7468 290d 0a20  ,modelLength).. 
+000274a0: 2074 696d 6542 616e 6420 3d20 6565 2e4c   timeBand = ee.L
+000274b0: 6973 7428 6861 726d 6f6e 6963 732e 6765  ist(harmonics.ge
+000274c0: 7428 2769 6e64 4261 6e64 4e61 6d65 7327  t('indBandNames'
+000274d0: 2929 2e67 6574 2830 290d 0a20 2061 6374  )).get(0)..  act
+000274e0: 7561 6c42 616e 6473 203d 2068 6172 6d6f  ualBands = harmo
+000274f0: 6e69 6373 2e67 6574 2827 6465 7042 616e  nics.get('depBan
+00027500: 644e 756d 6265 7273 2729 0d0a 2020 696e  dNumbers')..  in
+00027510: 6442 616e 6473 203d 2068 6172 6d6f 6e69  dBands = harmoni
+00027520: 6373 2e67 6574 2827 696e 6442 616e 644e  cs.get('indBandN
+00027530: 756d 6265 7273 2729 0d0a 2020 696e 6442  umbers')..  indB
+00027540: 616e 644e 616d 6573 203d 2065 652e 4c69  andNames = ee.Li
+00027550: 7374 2868 6172 6d6f 6e69 6373 2e67 6574  st(harmonics.get
+00027560: 2827 696e 6442 616e 644e 616d 6573 2729  ('indBandNames')
+00027570: 290d 0a20 2064 6570 4261 6e64 4e61 6d65  )..  depBandName
+00027580: 7320 3d20 6565 2e4c 6973 7428 6861 726d  s = ee.List(harm
+00027590: 6f6e 6963 732e 6765 7428 2764 6570 4261  onics.get('depBa
+000275a0: 6e64 4e61 6d65 7327 2929 0d0a 2020 7072  ndNames'))..  pr
+000275b0: 6564 6963 7465 6442 616e 644e 616d 6573  edictedBandNames
+000275c0: 203d 2064 6570 4261 6e64 4e61 6d65 732e   = depBandNames.
+000275d0: 6d61 7028 6c61 6d62 6461 2064 6570 626e  map(lambda depbn
+000275e0: 6d73 3a65 652e 5374 7269 6e67 2864 6570  ms:ee.String(dep
+000275f0: 626e 6d73 292e 6361 7428 275f 7072 6564  bnms).cat('_pred
+00027600: 6963 7465 6427 2929 0d0a 2020 7072 6564  icted'))..  pred
+00027610: 6963 7465 6442 616e 644e 756d 6265 7273  ictedBandNumbers
+00027620: 203d 2065 652e 4c69 7374 2e73 6571 7565   = ee.List.seque
+00027630: 6e63 6528 302c 7072 6564 6963 7465 6442  nce(0,predictedB
+00027640: 616e 644e 616d 6573 2e6c 656e 6774 6828  andNames.length(
+00027650: 292e 7375 6274 7261 6374 2831 2929 0d0a  ).subtract(1))..
+00027660: 0d0a 2020 6d6f 6465 6c73 203d 2065 652e  ..  models = ee.
+00027670: 4c69 7374 2e73 6571 7565 6e63 6528 302c  List.sequence(0,
+00027680: 6e6f 4465 7065 6e64 656e 7473 2e73 7562  noDependents.sub
+00027690: 7472 6163 7428 3129 290d 0a20 2064 6566  tract(1))..  def
+000276a0: 206d 6e47 6574 7465 7228 6d6e 293a 0d0a   mnGetter(mn):..
+000276b0: 2020 2020 6d6e 203d 2065 652e 4e75 6d62      mn = ee.Numb
+000276c0: 6572 286d 6e29 0d0a 2020 2020 7265 7475  er(mn)..    retu
+000276d0: 726e 2062 616e 644e 616d 6573 2e73 6c69  rn bandNames.sli
+000276e0: 6365 286d 6e2e 6d75 6c74 6970 6c79 286d  ce(mn.multiply(m
+000276f0: 6f64 656c 4c65 6e67 7468 292c 6d6e 2e6d  odelLength),mn.m
+00027700: 756c 7469 706c 7928 6d6f 6465 6c4c 656e  ultiply(modelLen
+00027710: 6774 6829 2e61 6464 286d 6f64 656c 4c65  gth).add(modelLe
+00027720: 6e67 7468 2929 0d0a 0d0a 2020 7061 7273  ngth))....  pars
+00027730: 6564 4d6f 6465 6c20 3d6d 6f64 656c 732e  edModel =models.
+00027740: 6d61 7028 6d6e 4765 7474 6572 290d 0a0d  map(mnGetter)...
+00027750: 0a20 2023 7072 696e 7428 2750 6172 7365  .  #print('Parse
+00027760: 6420 6861 726d 6f6e 6963 2072 6567 7265  d harmonic regre
+00027770: 7373 696f 6e20 6d6f 6465 6c27 2c70 6172  ssion model',par
+00027780: 7365 644d 6f64 656c 2c70 7265 6469 6374  sedModel,predict
+00027790: 6564 4261 6e64 4e61 6d65 7329 0d0a 0d0a  edBandNames)....
+000277a0: 2020 2341 7070 6c79 2070 6172 7365 6420    #Apply parsed 
+000277b0: 6d6f 6465 6c0d 0a20 2064 6566 2070 7265  model..  def pre
+000277c0: 6447 6574 7465 7228 696d 6729 3a0d 0a20  dGetter(img):.. 
+000277d0: 2020 2074 696d 6520 3d20 696d 672e 7365     time = img.se
+000277e0: 6c65 6374 2874 696d 6542 616e 6429 0d0a  lect(timeBand)..
+000277f0: 2020 2020 6163 7475 616c 203d 2069 6d67      actual = img
+00027800: 2e73 656c 6563 7428 6163 7475 616c 4261  .select(actualBa
+00027810: 6e64 7329 2e66 6c6f 6174 2829 0d0a 2020  nds).float()..  
+00027820: 2020 7072 6564 6963 746f 7242 616e 6473    predictorBands
+00027830: 203d 2069 6d67 2e73 656c 6563 7428 696e   = img.select(in
+00027840: 6442 616e 644e 616d 6573 290d 0a0d 0a20  dBandNames).... 
+00027850: 2020 2023 4974 6572 6174 6520 6163 726f     #Iterate acro
+00027860: 7373 2065 6163 6820 6d6f 6465 6c20 666f  ss each model fo
+00027870: 7220 6561 6368 2064 6570 656e 6465 6e74  r each dependent
+00027880: 2076 6172 6961 626c 650d 0a20 2020 2064   variable..    d
+00027890: 6566 2070 6d47 6574 7465 7228 706d 293a  ef pmGetter(pm):
+000278a0: 0d0a 2020 2020 2020 706d 203d 2065 652e  ..      pm = ee.
+000278b0: 4c69 7374 2870 6d29 0d0a 2020 2020 2020  List(pm)..      
+000278c0: 6d6f 6465 6c43 6f65 6666 7320 3d20 636f  modelCoeffs = co
+000278d0: 6566 6673 2e73 656c 6563 7428 706d 290d  effs.select(pm).
+000278e0: 0a20 2020 2020 206f 7574 4e61 6d65 203d  .      outName =
+000278f0: 2065 652e 5374 7269 6e67 2870 6d2e 6765   ee.String(pm.ge
+00027900: 7428 3129 292e 6361 7428 275f 7072 6564  t(1)).cat('_pred
+00027910: 6963 7465 6427 290d 0a20 2020 2020 2069  icted')..      i
+00027920: 6e74 6572 6365 7074 203d 206d 6f64 656c  ntercept = model
+00027930: 436f 6566 6673 2e73 656c 6563 7428 6d6f  Coeffs.select(mo
+00027940: 6465 6c43 6f65 6666 732e 6261 6e64 4e61  delCoeffs.bandNa
+00027950: 6d65 7328 292e 736c 6963 6528 302c 3129  mes().slice(0,1)
+00027960: 290d 0a20 2020 2020 206f 7468 6572 7320  )..      others 
+00027970: 3d20 6d6f 6465 6c43 6f65 6666 732e 7365  = modelCoeffs.se
+00027980: 6c65 6374 286d 6f64 656c 436f 6566 6673  lect(modelCoeffs
+00027990: 2e62 616e 644e 616d 6573 2829 2e73 6c69  .bandNames().sli
+000279a0: 6365 2831 2c4e 6f6e 6529 290d 0a0d 0a20  ce(1,None)).... 
+000279b0: 2020 2020 2070 7265 6469 6374 6564 203d       predicted =
+000279c0: 2070 7265 6469 6374 6f72 4261 6e64 732e   predictorBands.
+000279d0: 6d75 6c74 6970 6c79 286f 7468 6572 7329  multiply(others)
+000279e0: 2e72 6564 7563 6528 6565 2e52 6564 7563  .reduce(ee.Reduc
+000279f0: 6572 2e73 756d 2829 292e 6164 6428 696e  er.sum()).add(in
+00027a00: 7465 7263 6570 7429 2e66 6c6f 6174 2829  tercept).float()
+00027a10: 0d0a 2020 2020 2020 7265 7475 726e 2070  ..      return p
+00027a20: 7265 6469 6374 6564 2e66 6c6f 6174 2829  redicted.float()
+00027a30: 0d0a 0d0a 0d0a 2020 2020 7072 6564 6963  ......    predic
+00027a40: 7465 644c 6973 7420 3d70 6172 7365 644d  tedList =parsedM
+00027a50: 6f64 656c 2e6d 6170 2870 6d47 6574 7465  odel.map(pmGette
+00027a60: 7229 0d0a 0d0a 2020 2020 2343 6f6e 7665  r)....    #Conve
+00027a70: 7274 2074 6f20 616e 2069 6d61 6765 0d0a  rt to an image..
+00027a80: 2020 2020 7072 6564 6963 7465 644c 6973      predictedLis
+00027a90: 7420 3d20 6565 2e49 6d61 6765 436f 6c6c  t = ee.ImageColl
+00027aa0: 6563 7469 6f6e 2e66 726f 6d49 6d61 6765  ection.fromImage
+00027ab0: 7328 7072 6564 6963 7465 644c 6973 7429  s(predictedList)
+00027ac0: 0d0a 2020 2020 7072 6564 6963 7465 6449  ..    predictedI
+00027ad0: 6d61 6765 203d 2063 6f6c 6c65 6374 696f  mage = collectio
+00027ae0: 6e54 6f49 6d61 6765 2870 7265 6469 6374  nToImage(predict
+00027af0: 6564 4c69 7374 292e 7365 6c65 6374 2870  edList).select(p
+00027b00: 7265 6469 6374 6564 4261 6e64 4e75 6d62  redictedBandNumb
+00027b10: 6572 732c 7072 6564 6963 7465 6442 616e  ers,predictedBan
+00027b20: 644e 616d 6573 290d 0a0d 0a20 2020 2023  dNames)....    #
+00027b30: 5365 7420 736f 6d65 206d 6574 6164 6174  Set some metadat
+00027b40: 610d 0a20 2020 206f 7574 203d 2061 6374  a..    out = act
+00027b50: 7561 6c2e 6164 6442 616e 6473 2870 7265  ual.addBands(pre
+00027b60: 6469 6374 6564 496d 6167 652e 666c 6f61  dictedImage.floa
+00027b70: 7428 2929 5c0d 0a20 2020 202e 636f 7079  t())\..    .copy
+00027b80: 5072 6f70 6572 7469 6573 2869 6d67 2c5b  Properties(img,[
+00027b90: 2773 7973 7465 6d3a 7469 6d65 5f73 7461  'system:time_sta
+00027ba0: 7274 272c 2773 7973 7465 6d3a 7469 6d65  rt','system:time
+00027bb0: 5f65 6e64 275d 290d 0a20 2020 2072 6574  _end'])..    ret
+00027bc0: 7572 6e20 6f75 740d 0a0d 0a20 2070 7265  urn out....  pre
+00027bd0: 6469 6374 6564 203d 6861 726d 6f6e 6963  dicted =harmonic
+00027be0: 732e 6d61 7028 7072 6564 4765 7474 6572  s.map(predGetter
+00027bf0: 290d 0a0d 0a20 2070 7265 6469 6374 6564  )....  predicted
+00027c00: 203d 2065 652e 496d 6167 6543 6f6c 6c65   = ee.ImageColle
+00027c10: 6374 696f 6e28 7072 6564 6963 7465 6429  ction(predicted)
+00027c20: 0d0a 0d0a 2020 234d 6170 2e61 6464 4c61  ....  #Map.addLa
+00027c30: 7965 7228 7072 6564 6963 7465 642c 7b7d  yer(predicted,{}
+00027c40: 2c27 7072 6564 6963 7465 6427 2c46 616c  ,'predicted',Fal
+00027c50: 7365 290d 0a0d 0a20 2072 6574 7572 6e20  se)....  return 
+00027c60: 7072 6564 6963 7465 640d 0a0d 0a23 2323  predicted....###
+00027c70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00027c80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00027c90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00027ca0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00027cb0: 2323 2323 2323 0d0a 2323 2323 2323 2323  ######..########
+00027cc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00027cd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00027ce0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00027cf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00027d00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00027d10: 2323 2323 2323 2323 230d 0a23 2323 2323  #########..#####
-00027d20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00027d30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00027d40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00027d50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00027d60: 2323 2323 0d0a 2346 756e 6374 696f 6e20  ####..#Function 
-00027d70: 746f 2067 6574 2061 2064 756d 6d79 2069  to get a dummy i
-00027d80: 6d61 6765 2073 7461 636b 2066 6f72 2073  mage stack for s
-00027d90: 796e 7468 6574 6963 2074 696d 6520 7365  ynthetic time se
-00027da0: 7269 6573 0d0a 6465 6620 6765 7444 6174  ries..def getDat
-00027db0: 6553 7461 636b 2873 7461 7274 5965 6172  eStack(startYear
-00027dc0: 2c65 6e64 5965 6172 2c73 7461 7274 4a75  ,endYear,startJu
-00027dd0: 6c69 616e 2c65 6e64 4a75 6c69 616e 2c66  lian,endJulian,f
-00027de0: 7265 7175 656e 6379 293a 0d0a 2020 7965  requency):..  ye
-00027df0: 6172 7320 3d20 6565 2e4c 6973 742e 7365  ars = ee.List.se
-00027e00: 7175 656e 6365 2873 7461 7274 5965 6172  quence(startYear
-00027e10: 2c65 6e64 5965 6172 290d 0a20 2064 6174  ,endYear)..  dat
-00027e20: 6573 203d 2065 652e 4c69 7374 2e73 6571  es = ee.List.seq
-00027e30: 7565 6e63 6528 7374 6172 744a 756c 6961  uence(startJulia
-00027e40: 6e2c 656e 644a 756c 6961 6e2c 6672 6571  n,endJulian,freq
-00027e50: 7565 6e63 7929 0d0a 0d0a 2020 6465 6620  uency)....  def 
-00027e60: 7972 4765 7474 6572 2879 7229 3a0d 0a20  yrGetter(yr):.. 
-00027e70: 2020 2064 6566 2064 4765 7474 6572 2864     def dGetter(d
-00027e80: 293a 0d0a 2020 2020 2020 7265 7475 726e  ):..      return
-00027e90: 2065 652e 4461 7465 2e66 726f 6d59 4d44   ee.Date.fromYMD
-00027ea0: 2879 722c 312c 3129 2e61 6476 616e 6365  (yr,1,1).advance
-00027eb0: 2864 2c27 6461 7927 290d 0a20 2020 2064  (d,'day')..    d
-00027ec0: 7320 3d20 6461 7465 732e 6d61 7028 6447  s = dates.map(dG
-00027ed0: 6574 7465 7229 0d0a 2020 2020 7265 7475  etter)..    retu
-00027ee0: 726e 2064 730d 0a0d 0a20 2064 6174 6553  rn ds....  dateS
-00027ef0: 6574 7320 3d20 7965 6172 732e 6d61 7028  ets = years.map(
-00027f00: 7972 4765 7474 6572 290d 0a0d 0a20 206c  yrGetter)....  l
-00027f10: 203d 2072 616e 6765 2831 2c6c 656e 2869   = range(1,len(i
-00027f20: 6e64 6578 4e61 6d65 7329 2b31 290d 0a20  ndexNames)+1).. 
-00027f30: 206c 203d 205b 6925 6920 666f 7220 6920   l = [i%i for i 
-00027f40: 696e 206c 5d0d 0a20 2063 203d 2065 652e  in l]..  c = ee.
-00027f50: 496d 6167 6528 6c29 2e72 656e 616d 6528  Image(l).rename(
-00027f60: 696e 6465 784e 616d 6573 290d 0a20 2063  indexNames)..  c
-00027f70: 203d 2063 2e64 6976 6964 6528 6329 0d0a   = c.divide(c)..
-00027f80: 0d0a 2020 6461 7465 5365 7473 203d 2064  ..  dateSets = d
-00027f90: 6174 6553 6574 732e 666c 6174 7465 6e28  ateSets.flatten(
-00027fa0: 290d 0a0d 0a20 2064 6566 2064 7447 6574  )....  def dtGet
-00027fb0: 7465 7228 6474 293a 0d0a 2020 2020 6474  ter(dt):..    dt
-00027fc0: 203d 2065 652e 4461 7465 2864 7429 0d0a   = ee.Date(dt)..
-00027fd0: 2020 2020 7920 3d20 6474 2e67 6574 2827      y = dt.get('
-00027fe0: 7965 6172 2729 0d0a 2020 2020 6420 3d20  year')..    d = 
-00027ff0: 6474 2e67 6574 4672 6163 7469 6f6e 2827  dt.getFraction('
-00028000: 7965 6172 2729 0d0a 2020 2020 6920 3d20  year')..    i = 
-00028010: 6565 2e49 6d61 6765 2879 2e61 6464 2864  ee.Image(y.add(d
-00028020: 2929 2e66 6c6f 6174 2829 2e73 656c 6563  )).float().selec
-00028030: 7428 5b30 5d2c 5b27 7965 6172 275d 290d  t([0],['year']).
-00028040: 0a0d 0a20 2020 2069 203d 2063 2e61 6464  ...    i = c.add
-00028050: 4261 6e64 7328 6929 2e66 6c6f 6174 2829  Bands(i).float()
-00028060: 5c0d 0a20 2020 2020 202e 7365 7428 2773  \..      .set('s
-00028070: 7973 7465 6d3a 7469 6d65 5f73 7461 7274  ystem:time_start
-00028080: 272c 6474 2e6d 696c 6c69 7328 2929 5c0d  ',dt.millis())\.
-00028090: 0a20 2020 2020 202e 7365 7428 2773 7973  .      .set('sys
-000280a0: 7465 6d3a 7469 6d65 5f65 6e64 272c 6474  tem:time_end',dt
-000280b0: 2e61 6476 616e 6365 2866 7265 7175 656e  .advance(frequen
-000280c0: 6379 2c27 6461 7927 292e 6d69 6c6c 6973  cy,'day').millis
-000280d0: 2829 290d 0a20 2020 2072 6574 7572 6e20  ())..    return 
-000280e0: 690d 0a20 2073 7461 636b 203d 2064 6174  i..  stack = dat
-000280f0: 6553 6574 732e 6d61 7028 6474 4765 7474  eSets.map(dtGett
-00028100: 6572 290d 0a20 2073 7461 636b 203d 2065  er)..  stack = e
-00028110: 652e 496d 6167 6543 6f6c 6c65 6374 696f  e.ImageCollectio
-00028120: 6e2e 6672 6f6d 496d 6167 6573 2873 7461  n.fromImages(sta
-00028130: 636b 290d 0a20 2072 6574 7572 6e20 7374  ck)..  return st
-00028140: 6163 6b0d 0a0d 0a23 2323 2323 2323 2323  ack....#########
+00027d00: 230d 0a23 4675 6e63 7469 6f6e 2074 6f20  #..#Function to 
+00027d10: 6765 7420 6120 6475 6d6d 7920 696d 6167  get a dummy imag
+00027d20: 6520 7374 6163 6b20 666f 7220 7379 6e74  e stack for synt
+00027d30: 6865 7469 6320 7469 6d65 2073 6572 6965  hetic time serie
+00027d40: 730d 0a64 6566 2067 6574 4461 7465 5374  s..def getDateSt
+00027d50: 6163 6b28 7374 6172 7459 6561 722c 656e  ack(startYear,en
+00027d60: 6459 6561 722c 7374 6172 744a 756c 6961  dYear,startJulia
+00027d70: 6e2c 656e 644a 756c 6961 6e2c 6672 6571  n,endJulian,freq
+00027d80: 7565 6e63 7929 3a0d 0a20 2079 6561 7273  uency):..  years
+00027d90: 203d 2065 652e 4c69 7374 2e73 6571 7565   = ee.List.seque
+00027da0: 6e63 6528 7374 6172 7459 6561 722c 656e  nce(startYear,en
+00027db0: 6459 6561 7229 0d0a 2020 6461 7465 7320  dYear)..  dates 
+00027dc0: 3d20 6565 2e4c 6973 742e 7365 7175 656e  = ee.List.sequen
+00027dd0: 6365 2873 7461 7274 4a75 6c69 616e 2c65  ce(startJulian,e
+00027de0: 6e64 4a75 6c69 616e 2c66 7265 7175 656e  ndJulian,frequen
+00027df0: 6379 290d 0a0d 0a20 2064 6566 2079 7247  cy)....  def yrG
+00027e00: 6574 7465 7228 7972 293a 0d0a 2020 2020  etter(yr):..    
+00027e10: 6465 6620 6447 6574 7465 7228 6429 3a0d  def dGetter(d):.
+00027e20: 0a20 2020 2020 2072 6574 7572 6e20 6565  .      return ee
+00027e30: 2e44 6174 652e 6672 6f6d 594d 4428 7972  .Date.fromYMD(yr
+00027e40: 2c31 2c31 292e 6164 7661 6e63 6528 642c  ,1,1).advance(d,
+00027e50: 2764 6179 2729 0d0a 2020 2020 6473 203d  'day')..    ds =
+00027e60: 2064 6174 6573 2e6d 6170 2864 4765 7474   dates.map(dGett
+00027e70: 6572 290d 0a20 2020 2072 6574 7572 6e20  er)..    return 
+00027e80: 6473 0d0a 0d0a 2020 6461 7465 5365 7473  ds....  dateSets
+00027e90: 203d 2079 6561 7273 2e6d 6170 2879 7247   = years.map(yrG
+00027ea0: 6574 7465 7229 0d0a 0d0a 2020 6c20 3d20  etter)....  l = 
+00027eb0: 7261 6e67 6528 312c 6c65 6e28 696e 6465  range(1,len(inde
+00027ec0: 784e 616d 6573 292b 3129 0d0a 2020 6c20  xNames)+1)..  l 
+00027ed0: 3d20 5b69 2569 2066 6f72 2069 2069 6e20  = [i%i for i in 
+00027ee0: 6c5d 0d0a 2020 6320 3d20 6565 2e49 6d61  l]..  c = ee.Ima
+00027ef0: 6765 286c 292e 7265 6e61 6d65 2869 6e64  ge(l).rename(ind
+00027f00: 6578 4e61 6d65 7329 0d0a 2020 6320 3d20  exNames)..  c = 
+00027f10: 632e 6469 7669 6465 2863 290d 0a0d 0a20  c.divide(c).... 
+00027f20: 2064 6174 6553 6574 7320 3d20 6461 7465   dateSets = date
+00027f30: 5365 7473 2e66 6c61 7474 656e 2829 0d0a  Sets.flatten()..
+00027f40: 0d0a 2020 6465 6620 6474 4765 7474 6572  ..  def dtGetter
+00027f50: 2864 7429 3a0d 0a20 2020 2064 7420 3d20  (dt):..    dt = 
+00027f60: 6565 2e44 6174 6528 6474 290d 0a20 2020  ee.Date(dt)..   
+00027f70: 2079 203d 2064 742e 6765 7428 2779 6561   y = dt.get('yea
+00027f80: 7227 290d 0a20 2020 2064 203d 2064 742e  r')..    d = dt.
+00027f90: 6765 7446 7261 6374 696f 6e28 2779 6561  getFraction('yea
+00027fa0: 7227 290d 0a20 2020 2069 203d 2065 652e  r')..    i = ee.
+00027fb0: 496d 6167 6528 792e 6164 6428 6429 292e  Image(y.add(d)).
+00027fc0: 666c 6f61 7428 292e 7365 6c65 6374 285b  float().select([
+00027fd0: 305d 2c5b 2779 6561 7227 5d29 0d0a 0d0a  0],['year'])....
+00027fe0: 2020 2020 6920 3d20 632e 6164 6442 616e      i = c.addBan
+00027ff0: 6473 2869 292e 666c 6f61 7428 295c 0d0a  ds(i).float()\..
+00028000: 2020 2020 2020 2e73 6574 2827 7379 7374        .set('syst
+00028010: 656d 3a74 696d 655f 7374 6172 7427 2c64  em:time_start',d
+00028020: 742e 6d69 6c6c 6973 2829 295c 0d0a 2020  t.millis())\..  
+00028030: 2020 2020 2e73 6574 2827 7379 7374 656d      .set('system
+00028040: 3a74 696d 655f 656e 6427 2c64 742e 6164  :time_end',dt.ad
+00028050: 7661 6e63 6528 6672 6571 7565 6e63 792c  vance(frequency,
+00028060: 2764 6179 2729 2e6d 696c 6c69 7328 2929  'day').millis())
+00028070: 0d0a 2020 2020 7265 7475 726e 2069 0d0a  ..    return i..
+00028080: 2020 7374 6163 6b20 3d20 6461 7465 5365    stack = dateSe
+00028090: 7473 2e6d 6170 2864 7447 6574 7465 7229  ts.map(dtGetter)
+000280a0: 0d0a 2020 7374 6163 6b20 3d20 6565 2e49  ..  stack = ee.I
+000280b0: 6d61 6765 436f 6c6c 6563 7469 6f6e 2e66  mageCollection.f
+000280c0: 726f 6d49 6d61 6765 7328 7374 6163 6b29  romImages(stack)
+000280d0: 0d0a 2020 7265 7475 726e 2073 7461 636b  ..  return stack
+000280e0: 0d0a 0d0a 2323 2323 2323 2323 2323 2323  ....############
+000280f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028100: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028110: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028120: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
+00028130: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028140: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00028150: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00028160: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00028170: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00028180: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00028190: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
-000281a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000281b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000281c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000281d0: 2323 2323 2323 2323 2323 230d 0a64 6566  ###########..def
-000281e0: 2067 6574 4861 726d 6f6e 6963 436f 6566   getHarmonicCoef
-000281f0: 6669 6369 656e 7473 416e 6446 6974 2861  ficientsAndFit(a
-00028200: 6c6c 496d 6167 6573 2c69 6e64 6578 4e61  llImages,indexNa
-00028210: 6d65 732c 7768 6963 6848 6172 6d6f 6e69  mes,whichHarmoni
-00028220: 6373 203d 205b 325d 2c64 6574 7265 6e64  cs = [2],detrend
-00028230: 203d 2046 616c 7365 293a 0d0a 0d0a 2020   = False):....  
-00028240: 2353 656c 6563 7420 6465 7369 7265 6420  #Select desired 
-00028250: 6261 6e64 730d 0a20 2061 6c6c 496e 6469  bands..  allIndi
-00028260: 6365 7320 3d20 616c 6c49 6d61 6765 732e  ces = allImages.
-00028270: 7365 6c65 6374 2869 6e64 6578 4e61 6d65  select(indexName
-00028280: 7329 0d0a 0d0a 2020 2341 6464 2064 6174  s)....  #Add dat
-00028290: 6520 6261 6e64 0d0a 2020 6966 2064 6574  e band..  if det
-000282a0: 7265 6e64 3a0d 0a20 2020 2061 6c6c 496e  rend:..    allIn
-000282b0: 6469 6365 7320 3d20 616c 6c49 6e64 6963  dices = allIndic
-000282c0: 6573 2e6d 6170 2861 6464 4461 7465 4261  es.map(addDateBa
-000282d0: 6e64 290d 0a20 2065 6c73 653a 0d0a 2020  nd)..  else:..  
-000282e0: 2020 616c 6c49 6e64 6963 6573 203d 2061    allIndices = a
-000282f0: 6c6c 496e 6469 6365 732e 6d61 7028 6164  llIndices.map(ad
-00028300: 6459 6561 7246 7261 6374 696f 6e42 616e  dYearFractionBan
-00028310: 6429 0d0a 0d0a 0d0a 2020 2341 6464 2069  d)......  #Add i
-00028320: 6e64 6570 656e 6465 6e74 2070 7265 6469  ndependent predi
-00028330: 6374 6f72 7320 2868 6172 6d6f 6e69 6373  ctors (harmonics
-00028340: 290d 0a20 2077 6974 6848 6172 6d6f 6e69  )..  withHarmoni
-00028350: 6373 203d 2067 6574 4861 726d 6f6e 6963  cs = getHarmonic
-00028360: 7332 2861 6c6c 496e 6469 6365 732c 2779  s2(allIndices,'y
-00028370: 6561 7227 2c77 6869 6368 4861 726d 6f6e  ear',whichHarmon
-00028380: 6963 732c 6465 7472 656e 6429 0d0a 2020  ics,detrend)..  
-00028390: 7769 7468 4861 726d 6f6e 6963 7342 6e73  withHarmonicsBns
-000283a0: 203d 2065 652e 496d 6167 6528 7769 7468   = ee.Image(with
-000283b0: 4861 726d 6f6e 6963 732e 6669 7273 7428  Harmonics.first(
-000283c0: 2929 2e62 616e 644e 616d 6573 2829 2e73  )).bandNames().s
-000283d0: 6c69 6365 286c 656e 2869 6e64 6578 4e61  lice(len(indexNa
-000283e0: 6d65 7329 2b31 2c4e 6f6e 6529 0d0a 0d0a  mes)+1,None)....
-000283f0: 2020 234f 7074 696f 6e61 6c6c 7920 6368    #Optionally ch
-00028400: 6172 7420 7468 6520 636f 6c6c 6563 7469  art the collecti
-00028410: 6f6e 2077 6974 6820 6861 726d 6f6e 6963  on with harmonic
-00028420: 730d 0a0d 0a20 2023 4669 7420 6120 6c69  s....  #Fit a li
-00028430: 6e65 6172 2072 6567 7265 7373 696f 6e20  near regression 
-00028440: 6d6f 6465 6c0d 0a20 2063 6f65 6666 7320  model..  coeffs 
-00028450: 3d20 6e65 7752 6f62 7573 744d 756c 7469  = newRobustMulti
-00028460: 706c 654c 696e 6561 7232 2877 6974 6848  pleLinear2(withH
-00028470: 6172 6d6f 6e69 6373 290d 0a0d 0a20 2023  armonics)....  #
-00028480: 4361 6e20 7669 7375 616c 697a 6520 7468  Can visualize th
-00028490: 6520 7068 6173 6520 616e 6420 616d 706c  e phase and ampl
-000284a0: 6974 7564 6520 6966 206f 6e6c 7920 7468  itude if only th
-000284b0: 6520 6669 7273 7420 285b 325d 2920 6861  e first ([2]) ha
-000284c0: 726d 6f6e 6963 2069 7320 6368 6f73 656e  rmonic is chosen
-000284d0: 0d0a 2020 2320 6966 2077 6869 6368 4861  ..  # if whichHa
-000284e0: 726d 6f6e 6963 7320 3d3d 2032 7b0d 0a20  rmonics == 2{.. 
-000284f0: 2023 2020 2020 7061 203d 2067 6574 5068   #    pa = getPh
-00028500: 6173 6541 6d70 6c69 7475 6465 2863 6f65  aseAmplitude(coe
-00028510: 6666 7329 3b0d 0a20 2023 2020 2f2f 2054  ffs);..  #  // T
-00028520: 7572 6e20 7468 6520 4853 5620 6461 7461  urn the HSV data
-00028530: 2069 6e74 6f20 616e 2052 4742 2069 6d61   into an RGB ima
-00028540: 6765 2061 6e64 2061 6464 2069 7420 746f  ge and add it to
-00028550: 2074 6865 206d 6170 2e0d 0a20 2023 2020   the map...  #  
-00028560: 7365 6173 6f6e 616c 6974 7920 3d20 7061  seasonality = pa
-00028570: 2e73 656c 6563 7428 5b31 2c30 5d29 2e61  .select([1,0]).a
-00028580: 6464 4261 6e64 7328 616c 6c49 6e64 6963  ddBands(allIndic
-00028590: 6573 2e73 656c 6563 7428 5b69 6e64 6578  es.select([index
-000285a0: 4e61 6d65 735b 305d 5d29 2e6d 6561 6e28  Names[0]]).mean(
-000285b0: 2929 2e68 7376 546f 5267 6228 293b 0d0a  )).hsvToRgb();..
-000285c0: 2020 2320 202f 2f20 4d61 702e 6164 644c    #  // Map.addL
-000285d0: 6179 6572 2873 6561 736f 6e61 6c69 7479  ayer(seasonality
-000285e0: 2c20 7b7d 2c20 2753 6561 736f 6e61 6c69  , {}, 'Seasonali
-000285f0: 7479 2729 3b0d 0a20 2023 2020 7d0d 0a0d  ty');..  #  }...
-00028600: 0a0d 0a0d 0a20 2023 4d61 702e 6164 644c  .....  #Map.addL
-00028610: 6179 6572 2863 6f65 6666 732c 7b7d 2c27  ayer(coeffs,{},'
-00028620: 4861 726d 6f6e 6963 2052 6567 7265 7373  Harmonic Regress
-00028630: 696f 6e20 436f 6566 6669 6369 656e 7473  ion Coefficients
-00028640: 272c 4661 6c73 6529 0d0a 2020 7072 6564  ',False)..  pred
-00028650: 6963 7465 6420 3d20 6e65 7750 7265 6469  icted = newPredi
-00028660: 6374 2863 6f65 6666 732c 7769 7468 4861  ct(coeffs,withHa
-00028670: 726d 6f6e 6963 7329 0d0a 2020 7265 7475  rmonics)..  retu
-00028680: 726e 205b 636f 6566 6673 2c70 7265 6469  rn [coeffs,predi
-00028690: 6374 6564 5d0d 0a23 2323 2323 2323 2323  cted]..#########
+00028170: 2323 2323 2323 2323 0d0a 6465 6620 6765  ########..def ge
+00028180: 7448 6172 6d6f 6e69 6343 6f65 6666 6963  tHarmonicCoeffic
+00028190: 6965 6e74 7341 6e64 4669 7428 616c 6c49  ientsAndFit(allI
+000281a0: 6d61 6765 732c 696e 6465 784e 616d 6573  mages,indexNames
+000281b0: 2c77 6869 6368 4861 726d 6f6e 6963 7320  ,whichHarmonics 
+000281c0: 3d20 5b32 5d2c 6465 7472 656e 6420 3d20  = [2],detrend = 
+000281d0: 4661 6c73 6529 3a0d 0a0d 0a20 2023 5365  False):....  #Se
+000281e0: 6c65 6374 2064 6573 6972 6564 2062 616e  lect desired ban
+000281f0: 6473 0d0a 2020 616c 6c49 6e64 6963 6573  ds..  allIndices
+00028200: 203d 2061 6c6c 496d 6167 6573 2e73 656c   = allImages.sel
+00028210: 6563 7428 696e 6465 784e 616d 6573 290d  ect(indexNames).
+00028220: 0a0d 0a20 2023 4164 6420 6461 7465 2062  ...  #Add date b
+00028230: 616e 640d 0a20 2069 6620 6465 7472 656e  and..  if detren
+00028240: 643a 0d0a 2020 2020 616c 6c49 6e64 6963  d:..    allIndic
+00028250: 6573 203d 2061 6c6c 496e 6469 6365 732e  es = allIndices.
+00028260: 6d61 7028 6164 6444 6174 6542 616e 6429  map(addDateBand)
+00028270: 0d0a 2020 656c 7365 3a0d 0a20 2020 2061  ..  else:..    a
+00028280: 6c6c 496e 6469 6365 7320 3d20 616c 6c49  llIndices = allI
+00028290: 6e64 6963 6573 2e6d 6170 2861 6464 5965  ndices.map(addYe
+000282a0: 6172 4672 6163 7469 6f6e 4261 6e64 290d  arFractionBand).
+000282b0: 0a0d 0a0d 0a20 2023 4164 6420 696e 6465  .....  #Add inde
+000282c0: 7065 6e64 656e 7420 7072 6564 6963 746f  pendent predicto
+000282d0: 7273 2028 6861 726d 6f6e 6963 7329 0d0a  rs (harmonics)..
+000282e0: 2020 7769 7468 4861 726d 6f6e 6963 7320    withHarmonics 
+000282f0: 3d20 6765 7448 6172 6d6f 6e69 6373 3228  = getHarmonics2(
+00028300: 616c 6c49 6e64 6963 6573 2c27 7965 6172  allIndices,'year
+00028310: 272c 7768 6963 6848 6172 6d6f 6e69 6373  ',whichHarmonics
+00028320: 2c64 6574 7265 6e64 290d 0a20 2077 6974  ,detrend)..  wit
+00028330: 6848 6172 6d6f 6e69 6373 426e 7320 3d20  hHarmonicsBns = 
+00028340: 6565 2e49 6d61 6765 2877 6974 6848 6172  ee.Image(withHar
+00028350: 6d6f 6e69 6373 2e66 6972 7374 2829 292e  monics.first()).
+00028360: 6261 6e64 4e61 6d65 7328 292e 736c 6963  bandNames().slic
+00028370: 6528 6c65 6e28 696e 6465 784e 616d 6573  e(len(indexNames
+00028380: 292b 312c 4e6f 6e65 290d 0a0d 0a20 2023  )+1,None)....  #
+00028390: 4f70 7469 6f6e 616c 6c79 2063 6861 7274  Optionally chart
+000283a0: 2074 6865 2063 6f6c 6c65 6374 696f 6e20   the collection 
+000283b0: 7769 7468 2068 6172 6d6f 6e69 6373 0d0a  with harmonics..
+000283c0: 0d0a 2020 2346 6974 2061 206c 696e 6561  ..  #Fit a linea
+000283d0: 7220 7265 6772 6573 7369 6f6e 206d 6f64  r regression mod
+000283e0: 656c 0d0a 2020 636f 6566 6673 203d 206e  el..  coeffs = n
+000283f0: 6577 526f 6275 7374 4d75 6c74 6970 6c65  ewRobustMultiple
+00028400: 4c69 6e65 6172 3228 7769 7468 4861 726d  Linear2(withHarm
+00028410: 6f6e 6963 7329 0d0a 0d0a 2020 2343 616e  onics)....  #Can
+00028420: 2076 6973 7561 6c69 7a65 2074 6865 2070   visualize the p
+00028430: 6861 7365 2061 6e64 2061 6d70 6c69 7475  hase and amplitu
+00028440: 6465 2069 6620 6f6e 6c79 2074 6865 2066  de if only the f
+00028450: 6972 7374 2028 5b32 5d29 2068 6172 6d6f  irst ([2]) harmo
+00028460: 6e69 6320 6973 2063 686f 7365 6e0d 0a20  nic is chosen.. 
+00028470: 2023 2069 6620 7768 6963 6848 6172 6d6f   # if whichHarmo
+00028480: 6e69 6373 203d 3d20 327b 0d0a 2020 2320  nics == 2{..  # 
+00028490: 2020 2070 6120 3d20 6765 7450 6861 7365     pa = getPhase
+000284a0: 416d 706c 6974 7564 6528 636f 6566 6673  Amplitude(coeffs
+000284b0: 293b 0d0a 2020 2320 202f 2f20 5475 726e  );..  #  // Turn
+000284c0: 2074 6865 2048 5356 2064 6174 6120 696e   the HSV data in
+000284d0: 746f 2061 6e20 5247 4220 696d 6167 6520  to an RGB image 
+000284e0: 616e 6420 6164 6420 6974 2074 6f20 7468  and add it to th
+000284f0: 6520 6d61 702e 0d0a 2020 2320 2073 6561  e map...  #  sea
+00028500: 736f 6e61 6c69 7479 203d 2070 612e 7365  sonality = pa.se
+00028510: 6c65 6374 285b 312c 305d 292e 6164 6442  lect([1,0]).addB
+00028520: 616e 6473 2861 6c6c 496e 6469 6365 732e  ands(allIndices.
+00028530: 7365 6c65 6374 285b 696e 6465 784e 616d  select([indexNam
+00028540: 6573 5b30 5d5d 292e 6d65 616e 2829 292e  es[0]]).mean()).
+00028550: 6873 7654 6f52 6762 2829 3b0d 0a20 2023  hsvToRgb();..  #
+00028560: 2020 2f2f 204d 6170 2e61 6464 4c61 7965    // Map.addLaye
+00028570: 7228 7365 6173 6f6e 616c 6974 792c 207b  r(seasonality, {
+00028580: 7d2c 2027 5365 6173 6f6e 616c 6974 7927  }, 'Seasonality'
+00028590: 293b 0d0a 2020 2320 207d 0d0a 0d0a 0d0a  );..  #  }......
+000285a0: 0d0a 2020 234d 6170 2e61 6464 4c61 7965  ..  #Map.addLaye
+000285b0: 7228 636f 6566 6673 2c7b 7d2c 2748 6172  r(coeffs,{},'Har
+000285c0: 6d6f 6e69 6320 5265 6772 6573 7369 6f6e  monic Regression
+000285d0: 2043 6f65 6666 6963 6965 6e74 7327 2c46   Coefficients',F
+000285e0: 616c 7365 290d 0a20 2070 7265 6469 6374  alse)..  predict
+000285f0: 6564 203d 206e 6577 5072 6564 6963 7428  ed = newPredict(
+00028600: 636f 6566 6673 2c77 6974 6848 6172 6d6f  coeffs,withHarmo
+00028610: 6e69 6373 290d 0a20 2072 6574 7572 6e20  nics)..  return 
+00028620: 5b63 6f65 6666 732c 7072 6564 6963 7465  [coeffs,predicte
+00028630: 645d 0d0a 2323 2323 2323 2323 2323 2323  d]..############
+00028640: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028650: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028660: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028670: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
+00028680: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028690: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000286a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000286b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000286c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000286d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000286e0: 0d0a 2323 2323 2323 2323 2323 2323 2323  ..##############
-000286f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00028700: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00028710: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00028720: 2323 2323 2323 2323 2323 230d 0a23 5369  ###########..#Si
-00028730: 6d70 6c65 2070 7265 6469 6374 2066 756e  mple predict fun
-00028740: 6374 696f 6e20 666f 7220 6861 726d 6f6e  ction for harmon
-00028750: 6963 2063 6f65 6666 6963 6965 6e74 730d  ic coefficients.
-00028760: 0a23 4578 7065 6374 7320 636f 6566 6673  .#Expects coeffs
-00028770: 2066 726f 6d20 6765 7448 6172 6d6f 6e69   from getHarmoni
-00028780: 6343 6f65 6666 6963 6965 6e74 7341 6e64  cCoefficientsAnd
-00028790: 4669 7420 6675 6e63 7469 6f6e 0d0a 2344  Fit function..#D
-000287a0: 6174 6520 696d 6167 6520 6973 2065 7870  ate image is exp
-000287b0: 6563 7465 6420 746f 2062 6520 7979 7979  ected to be yyyy
-000287c0: 2e64 6420 7768 6572 6520 6464 2069 7320  .dd where dd is 
-000287d0: 7468 6520 6461 7920 6f66 2079 6561 7220  the day of year 
-000287e0: 2f20 3336 3520 2870 726f 706f 7274 696f  / 365 (proportio
-000287f0: 6e20 6f66 2079 6561 7229 0d0a 2365 782e  n of year)..#ex.
-00028800: 2073 796e 7468 496d 6167 6528 636f 6566   synthImage(coef
-00028810: 6673 2c65 652e 496d 6167 6528 5b32 3031  fs,ee.Image([201
-00028820: 392e 365d 292c 5b27 626c 7565 272c 2767  9.6]),['blue','g
-00028830: 7265 656e 272c 2772 6564 272c 276e 6972  reen','red','nir
-00028840: 272c 2773 7769 7231 272c 2773 7769 7232  ','swir1','swir2
-00028850: 272c 274e 4252 272c 274e 4456 4927 5d2c  ','NBR','NDVI'],
-00028860: 5b32 2c34 5d2c 7472 7565 290d 0a64 6566  [2,4],true)..def
-00028870: 2073 796e 7468 496d 6167 6528 636f 6566   synthImage(coef
-00028880: 6673 2c64 6174 6549 6d61 6765 2c69 6e64  fs,dateImage,ind
-00028890: 6578 4e61 6d65 732c 6861 726d 6f6e 6963  exNames,harmonic
-000288a0: 732c 6465 7472 656e 6429 3a0d 0a20 2023  s,detrend):..  #
-000288b0: 5365 7420 7570 2063 6f6e 7374 616e 7420  Set up constant 
-000288c0: 696d 6167 6520 746f 206d 756c 7469 706c  image to multipl
-000288d0: 7920 636f 6566 6673 2062 790d 0a20 2063  y coeffs by..  c
-000288e0: 6f6e 7374 496d 6167 6520 3d20 6565 2e49  onstImage = ee.I
-000288f0: 6d61 6765 2831 290d 0a20 2069 6620 6465  mage(1)..  if de
-00028900: 7472 656e 643a 636f 6e73 7449 6d61 6765  trend:constImage
-00028910: 203d 2063 6f6e 7374 496d 6167 652e 6164   = constImage.ad
-00028920: 6442 616e 6473 2864 6174 6549 6d61 6765  dBands(dateImage
-00028930: 290d 0a20 2066 6f72 2068 6172 6d20 696e  )..  for harm in
-00028940: 2068 6172 6d6f 6e69 6373 3a0d 0a20 2020   harmonics:..   
-00028950: 2063 6f6e 7374 496d 6167 6520 3d20 636f   constImage = co
-00028960: 6e73 7449 6d61 6765 2e61 6464 4261 6e64  nstImage.addBand
-00028970: 7328 6565 2e49 6d61 6765 285b 6461 7465  s(ee.Image([date
-00028980: 496d 6167 652e 6d75 6c74 6970 6c79 2868  Image.multiply(h
-00028990: 6172 6d2a 6d61 7468 2e70 6929 2e73 696e  arm*math.pi).sin
-000289a0: 2829 5d29 2e72 656e 616d 6528 5b27 7b7d  ()]).rename(['{}
-000289b0: 5f73 696e 272e 666f 726d 6174 2868 6172  _sin'.format(har
-000289c0: 6d2a 3130 3029 5d29 2920 2020 2020 2020  m*100)]))       
-000289d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000289e0: 0d0a 2020 666f 7220 6861 726d 2069 6e20  ..  for harm in 
-000289f0: 6861 726d 6f6e 6963 733a 0d0a 2020 2020  harmonics:..    
-00028a00: 636f 6e73 7449 6d61 6765 203d 2063 6f6e  constImage = con
-00028a10: 7374 496d 6167 652e 6164 6442 616e 6473  stImage.addBands
-00028a20: 2865 652e 496d 6167 6528 5b64 6174 6549  (ee.Image([dateI
-00028a30: 6d61 6765 2e6d 756c 7469 706c 7928 6861  mage.multiply(ha
-00028a40: 726d 2a6d 6174 682e 7069 292e 636f 7328  rm*math.pi).cos(
-00028a50: 295d 292e 7265 6e61 6d65 285b 277b 7d5f  )]).rename(['{}_
-00028a60: 636f 7327 2e66 6f72 6d61 7428 6861 726d  cos'.format(harm
-00028a70: 2a31 3030 295d 2929 0d0a 2020 0d0a 2020  *100)]))..  ..  
-00028a80: 2320 636f 6566 6673 7342 6e20 3d20 636f  # coeffssBn = co
-00028a90: 6566 6673 2e73 656c 6563 7428 6565 2e53  effs.select(ee.S
-00028aa0: 7472 696e 6728 696e 6465 784e 616d 6573  tring(indexNames
-00028ab0: 5b30 5d29 2e63 6174 2827 5f2e 2a27 2929  [0]).cat('_.*'))
-00028ac0: 0d0a 2020 2320 7072 696e 7428 636f 6e73  ..  # print(cons
-00028ad0: 7449 6d61 6765 2e62 616e 644e 616d 6573  tImage.bandNames
-00028ae0: 2829 2e67 6574 496e 666f 2829 2c63 6f65  ().getInfo(),coe
-00028af0: 6666 7373 426e 2e62 616e 644e 616d 6573  ffssBn.bandNames
-00028b00: 2829 2e67 6574 496e 666f 2829 290d 0a20  ().getInfo()).. 
-00028b10: 2023 5072 6564 6963 7420 7661 6c75 6573   #Predict values
-00028b20: 2066 6f72 2065 6163 6820 6261 6e64 0d0a   for each band..
-00028b30: 2020 6f75 7420 3d20 6565 2e49 6d61 6765    out = ee.Image
-00028b40: 2831 293b 0d0a 2020 6465 6620 7072 6564  (1);..  def pred
-00028b50: 6963 7457 7261 7070 6572 2862 6e2c 6f75  ictWrapper(bn,ou
-00028b60: 7429 3a0d 0a20 2020 2062 6e20 3d20 6565  t):..    bn = ee
-00028b70: 2e53 7472 696e 6728 626e 290d 0a20 2020  .String(bn)..   
-00028b80: 2023 5365 6c65 6374 2063 6f65 6666 7320   #Select coeffs 
-00028b90: 666f 7220 7468 6174 2062 616e 640d 0a20  for that band.. 
-00028ba0: 2020 2063 6f65 6666 7373 426e 203d 2063     coeffssBn = c
-00028bb0: 6f65 6666 732e 7365 6c65 6374 2865 652e  oeffs.select(ee.
-00028bc0: 5374 7269 6e67 2862 6e29 2e63 6174 2827  String(bn).cat('
-00028bd0: 5f2e 2a27 2929 0d0a 2020 2020 7072 6564  _.*'))..    pred
-00028be0: 6963 7465 6420 3d20 636f 6e73 7449 6d61  icted = constIma
-00028bf0: 6765 2e6d 756c 7469 706c 7928 636f 6566  ge.multiply(coef
-00028c00: 6673 7342 6e29 2e72 6564 7563 6528 2773  fssBn).reduce('s
-00028c10: 756d 2729 2e72 656e 616d 6528 626e 290d  um').rename(bn).
-00028c20: 0a20 2020 2072 6574 7572 6e20 6565 2e49  .    return ee.I
-00028c30: 6d61 6765 286f 7574 292e 6164 6442 616e  mage(out).addBan
-00028c40: 6473 2870 7265 6469 6374 6564 290d 0a0d  ds(predicted)...
-00028c50: 0a20 206f 7574 203d 2065 652e 496d 6167  .  out = ee.Imag
-00028c60: 6528 6565 2e4c 6973 7428 696e 6465 784e  e(ee.List(indexN
-00028c70: 616d 6573 292e 6974 6572 6174 6528 7072  ames).iterate(pr
-00028c80: 6564 6963 7457 7261 7070 6572 2c6f 7574  edictWrapper,out
-00028c90: 2929 3b0d 0a0d 0a20 206f 7574 203d 206f  ));....  out = o
-00028ca0: 7574 2e73 656c 6563 7428 6565 2e4c 6973  ut.select(ee.Lis
-00028cb0: 742e 7365 7175 656e 6365 2831 2c20 6f75  t.sequence(1, ou
-00028cc0: 742e 6261 6e64 4e61 6d65 7328 292e 7369  t.bandNames().si
-00028cd0: 7a65 2829 2e73 7562 7472 6163 7428 3129  ze().subtract(1)
-00028ce0: 2929 0d0a 0d0a 2020 7265 7475 726e 206f  ))....  return o
-00028cf0: 7574 0d0a 2323 2323 2323 2323 2323 2323  ut..############
-00028d00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00028d10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00028d20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00028d30: 2323 2323 2323 2323 230d 0a23 5772 6170  #########..#Wrap
-00028d40: 7065 7220 6675 6e63 7469 6f6e 2074 6f20  per function to 
-00028d50: 6765 7420 636c 696d 6174 6520 6461 7461  get climate data
-00028d60: 0d0a 2320 5375 7070 6f72 7473 3a0d 0a23  ..# Supports:..#
-00028d70: 204e 4153 412f 4f52 4e4c 2f44 4159 4d45   NASA/ORNL/DAYME
-00028d80: 545f 5633 0d0a 2320 4e41 5341 2f4f 524e  T_V3..# NASA/ORN
-00028d90: 4c2f 4441 594d 4554 5f56 340d 0a23 2055  L/DAYMET_V4..# U
-00028da0: 4353 422d 4348 472f 4348 4952 5053 2f44  CSB-CHG/CHIRPS/D
-00028db0: 4149 4c59 2028 7072 6563 6970 6974 6174  AILY (precipitat
-00028dc0: 696f 6e20 6f6e 6c79 290d 0a23 616e 6420  ion only)..#and 
-00028dd0: 706f 7373 6962 6c79 206f 7468 6572 730d  possibly others.
-00028de0: 0a64 6566 2067 6574 436c 696d 6174 6557  .def getClimateW
-00028df0: 7261 7070 6572 2863 6f6c 6c65 6374 696f  rapper(collectio
-00028e00: 6e4e 616d 652c 7374 7564 7941 7265 612c  nName,studyArea,
-00028e10: 7374 6172 7459 6561 722c 656e 6459 6561  startYear,endYea
-00028e20: 722c 7374 6172 744a 756c 6961 6e2c 656e  r,startJulian,en
-00028e30: 644a 756c 6961 6e2c 7469 6d65 6275 6666  dJulian,timebuff
-00028e40: 6572 2c77 6569 6768 7473 2c63 6f6d 706f  er,weights,compo
-00028e50: 7369 7469 6e67 5265 6475 6365 722c 6578  sitingReducer,ex
-00028e60: 706f 7274 436f 6d70 6f73 6974 6573 203d  portComposites =
-00028e70: 2046 616c 7365 2c65 7870 6f72 7450 6174   False,exportPat
-00028e80: 6852 6f6f 7420 3d20 4e6f 6e65 2c63 7273  hRoot = None,crs
-00028e90: 203d 204e 6f6e 652c 7472 616e 7366 6f72   = None,transfor
-00028ea0: 6d20 3d20 4e6f 6e65 2c73 6361 6c65 203d  m = None,scale =
-00028eb0: 204e 6f6e 652c 6578 706f 7274 4261 6e64   None,exportBand
-00028ec0: 7320 3d20 4e6f 6e65 293a 0d0a 2020 6172  s = None):..  ar
-00028ed0: 6773 203d 2066 6f72 6d61 7441 7267 7328  gs = formatArgs(
-00028ee0: 6c6f 6361 6c73 2829 290d 0a20 2069 6620  locals())..  if 
-00028ef0: 2761 7267 7327 2069 6e20 6172 6773 2e6b  'args' in args.k
-00028f00: 6579 7328 293a 0d0a 2020 2020 6465 6c20  eys():..    del 
-00028f10: 6172 6773 5b27 6172 6773 275d 0d0a 2020  args['args']..  
-00028f20: 7072 696e 7428 6172 6773 290d 0a0d 0a20  print(args).... 
-00028f30: 2023 5072 6570 6172 6520 6461 7465 730d   #Prepare dates.
-00028f40: 0a20 2023 5772 6170 2074 6865 2064 6174  .  #Wrap the dat
-00028f50: 6573 2069 6620 6e65 6564 6564 0d0a 2020  es if needed..  
-00028f60: 7772 6170 4f66 6673 6574 203d 2030 0d0a  wrapOffset = 0..
-00028f70: 2020 6966 2073 7461 7274 4a75 6c69 616e    if startJulian
-00028f80: 203e 2065 6e64 4a75 6c69 616e 3a0d 0a20   > endJulian:.. 
-00028f90: 2020 2077 7261 704f 6666 7365 7420 3d20     wrapOffset = 
-00028fa0: 3336 350d 0a0d 0a20 2073 7461 7274 4461  365....  startDa
-00028fb0: 7465 203d 2065 652e 4461 7465 2e66 726f  te = ee.Date.fro
-00028fc0: 6d59 4d44 2873 7461 7274 5965 6172 2c31  mYMD(startYear,1
-00028fd0: 2c31 292e 6164 7661 6e63 6528 7374 6172  ,1).advance(star
-00028fe0: 744a 756c 6961 6e2d 312c 2764 6179 2729  tJulian-1,'day')
-00028ff0: 0d0a 2020 656e 6444 6174 6520 3d20 6565  ..  endDate = ee
-00029000: 2e44 6174 652e 6672 6f6d 594d 4428 656e  .Date.fromYMD(en
-00029010: 6459 6561 722c 312c 3129 2e61 6476 616e  dYear,1,1).advan
-00029020: 6365 2865 6e64 4a75 6c69 616e 2d31 2b77  ce(endJulian-1+w
-00029030: 7261 704f 6666 7365 742c 2764 6179 2729  rapOffset,'day')
-00029040: 0d0a 2020 7072 696e 7428 2753 7461 7274  ..  print('Start
-00029050: 2061 6e64 2065 6e64 2064 6174 6573 3a27   and end dates:'
-00029060: 2c20 7374 6172 7444 6174 652e 666f 726d  , startDate.form
-00029070: 6174 2827 5959 5959 2d4d 4d2d 6464 2729  at('YYYY-MM-dd')
-00029080: 2e67 6574 496e 666f 2829 2c20 656e 6444  .getInfo(), endD
-00029090: 6174 652e 666f 726d 6174 2827 5959 5959  ate.format('YYYY
-000290a0: 2d4d 4d2d 6464 2729 2e67 6574 496e 666f  -MM-dd').getInfo
-000290b0: 2829 290d 0a20 2070 7269 6e74 2827 4a75  ())..  print('Ju
-000290c0: 6c69 616e 2064 6179 7320 6172 653a 272c  lian days are:',
-000290d0: 7374 6172 744a 756c 6961 6e2c 656e 644a  startJulian,endJ
-000290e0: 756c 6961 6e29 0d0a 0d0a 2020 2347 6574  ulian)....  #Get
-000290f0: 2063 6c69 6d61 7465 2064 6174 610d 0a20   climate data.. 
-00029100: 2063 203d 2065 652e 496d 6167 6543 6f6c   c = ee.ImageCol
-00029110: 6c65 6374 696f 6e28 636f 6c6c 6563 7469  lection(collecti
-00029120: 6f6e 4e61 6d65 295c 0d0a 2020 2020 2020  onName)\..      
-00029130: 2020 2020 202e 6669 6c74 6572 426f 756e       .filterBoun
-00029140: 6473 2873 7475 6479 4172 6561 295c 0d0a  ds(studyArea)\..
-00029150: 2020 2020 2020 2020 2020 202e 6669 6c74             .filt
-00029160: 6572 4461 7465 2873 7461 7274 4461 7465  erDate(startDate
-00029170: 2c65 6e64 4461 7465 2e61 6476 616e 6365  ,endDate.advance
-00029180: 2831 2c27 6461 7927 2929 5c0d 0a20 2020  (1,'day'))\..   
-00029190: 2020 2020 2020 2020 2e66 696c 7465 7228          .filter(
-000291a0: 6565 2e46 696c 7465 722e 6361 6c65 6e64  ee.Filter.calend
-000291b0: 6172 5261 6e67 6528 7374 6172 744a 756c  arRange(startJul
-000291c0: 6961 6e2c 656e 644a 756c 6961 6e29 290d  ian,endJulian)).
-000291d0: 0a0d 0a20 2023 5365 7420 746f 2061 7070  ...  #Set to app
-000291e0: 726f 7072 6961 7465 2072 6573 616d 706c  ropriate resampl
-000291f0: 696e 6720 6d65 7468 6f64 0d0a 2020 6320  ing method..  c 
-00029200: 3d20 632e 6d61 7028 6c61 6d62 6461 2069  = c.map(lambda i
-00029210: 6d67 3a20 696d 672e 7265 7361 6d70 6c65  mg: img.resample
-00029220: 2827 6269 6375 6269 6327 2929 0d0a 2020  ('bicubic'))..  
-00029230: 4d61 702e 6164 644c 6179 6572 2863 2c7b  Map.addLayer(c,{
-00029240: 7d2c 2752 6177 2043 6c69 6d61 7465 272c  },'Raw Climate',
-00029250: 4661 6c73 6529 0d0a 0d0a 2020 2343 7265  False)....  #Cre
-00029260: 6174 6520 636f 6d70 6f73 6974 6520 7469  ate composite ti
-00029270: 6d65 2073 6572 6965 730d 0a20 2074 7320  me series..  ts 
-00029280: 3d20 636f 6d70 6f73 6974 6554 696d 6553  = compositeTimeS
-00029290: 6572 6965 7328 632c 7374 6172 7459 6561  eries(c,startYea
-000292a0: 722c 656e 6459 6561 722c 7374 6172 744a  r,endYear,startJ
-000292b0: 756c 6961 6e2c 656e 644a 756c 6961 6e2c  ulian,endJulian,
-000292c0: 7469 6d65 6275 6666 6572 2c77 6569 6768  timebuffer,weigh
-000292d0: 7473 2c4e 6f6e 652c 636f 6d70 6f73 6974  ts,None,composit
-000292e0: 696e 6752 6564 7563 6572 290d 0a20 2074  ingReducer)..  t
-000292f0: 7320 3d20 6565 2e49 6d61 6765 436f 6c6c  s = ee.ImageColl
-00029300: 6563 7469 6f6e 2874 732e 6d61 7028 6c61  ection(ts.map(la
-00029310: 6d62 6461 2069 203a 2069 2e66 6c6f 6174  mbda i : i.float
-00029320: 2829 2929 0d0a 0d0a 2020 2345 7870 6f72  ()))....  #Expor
-00029330: 7420 636f 6d70 6f73 6974 6520 636f 6c6c  t composite coll
-00029340: 6563 7469 6f6e 0d0a 2020 6966 2065 7870  ection..  if exp
-00029350: 6f72 7443 6f6d 706f 7369 7465 733a 0d0a  ortComposites:..
-00029360: 2020 2020 2353 6574 2075 7020 6578 706f      #Set up expo
-00029370: 7274 2062 616e 6473 2069 6620 6e6f 7420  rt bands if not 
-00029380: 7370 6563 6966 6965 640d 0a20 2020 2069  specified..    i
-00029390: 6620 6578 706f 7274 4261 6e64 7320 3d3d  f exportBands ==
-000293a0: 204e 6f6e 653a 0d0a 2020 2020 2020 6578   None:..      ex
-000293b0: 706f 7274 4261 6e64 7320 3d20 6565 2e4c  portBands = ee.L
-000293c0: 6973 7428 6565 2e49 6d61 6765 2874 732e  ist(ee.Image(ts.
-000293d0: 6669 7273 7428 2929 2e62 616e 644e 616d  first()).bandNam
-000293e0: 6573 2829 290d 0a0d 0a20 2020 2065 7870  es())....    exp
-000293f0: 6f72 7443 6f6c 6c65 6374 696f 6e28 6578  ortCollection(ex
-00029400: 706f 7274 5061 7468 526f 6f74 2c63 6f6c  portPathRoot,col
-00029410: 6c65 6374 696f 6e4e 616d 652e 7370 6c69  lectionName.spli
-00029420: 7428 272f 2729 5b2d 315d 2c73 7475 6479  t('/')[-1],study
-00029430: 4172 6561 2c20 6372 732c 7472 616e 7366  Area, crs,transf
-00029440: 6f72 6d2c 7363 616c 652c 7473 2c73 7461  orm,scale,ts,sta
-00029450: 7274 5965 6172 2c65 6e64 5965 6172 2c73  rtYear,endYear,s
-00029460: 7461 7274 4a75 6c69 616e 2c65 6e64 4a75  tartJulian,endJu
-00029470: 6c69 616e 2c63 6f6d 706f 7369 7469 6e67  lian,compositing
-00029480: 5265 6475 6365 722c 7469 6d65 6275 6666  Reducer,timebuff
-00029490: 6572 2c65 7870 6f72 7442 616e 6473 290d  er,exportBands).
-000294a0: 0a0d 0a20 2072 6574 7572 6e20 7473 2323  ...  return ts##
-000294b0: 2323 0d0a 2323 2323 2323 2323 2323 2323  ##..############
-000294c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000294d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000294e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000294f0: 2323 2323 2323 2323 230d 0a23 4164 6473  #########..#Adds
-00029500: 2061 6273 6f6c 7574 6520 6469 6666 6572   absolute differ
-00029510: 656e 6365 2066 726f 6d20 6120 7370 6563  ence from a spec
-00029520: 6966 6965 6420 6261 6e64 2073 756d 6d61  ified band summa
-00029530: 7269 7a65 6420 6279 2061 2070 726f 7669  rized by a provi
-00029540: 6465 6420 7065 7263 656e 7469 6c65 0d0a  ded percentile..
-00029550: 2349 6e74 656e 6465 6420 666f 7220 6375  #Intended for cu
-00029560: 7374 6f6d 2073 6f72 7469 6e67 2061 6372  stom sorting acr
-00029570: 6f73 7320 636f 6c6c 6563 7469 6f6e 730d  oss collections.
-00029580: 0a64 6566 2061 6464 4162 7344 6966 6628  .def addAbsDiff(
-00029590: 696e 436f 6c6c 6563 7469 6f6e 2c20 7175  inCollection, qu
-000295a0: 616c 6974 7942 616e 642c 2070 6572 6365  alityBand, perce
-000295b0: 6e74 696c 652c 7369 676e 293a 0d0a 2020  ntile,sign):..  
-000295c0: 6265 7374 5175 616c 6974 7920 3d20 696e  bestQuality = in
-000295d0: 436f 6c6c 6563 7469 6f6e 2e73 656c 6563  Collection.selec
-000295e0: 7428 5b71 7561 6c69 7479 4261 6e64 5d29  t([qualityBand])
-000295f0: 2e72 6564 7563 6528 6565 2e52 6564 7563  .reduce(ee.Reduc
-00029600: 6572 2e70 6572 6365 6e74 696c 6528 5b70  er.percentile([p
-00029610: 6572 6365 6e74 696c 655d 2929 0d0a 2020  ercentile]))..  
-00029620: 6465 6620 7728 696d 6167 6529 3a0d 0a20  def w(image):.. 
-00029630: 2020 2064 656c 7461 203d 2069 6d61 6765     delta = image
-00029640: 2e73 656c 6563 7428 5b71 7561 6c69 7479  .select([quality
-00029650: 4261 6e64 5d29 2e73 7562 7472 6163 7428  Band]).subtract(
-00029660: 6265 7374 5175 616c 6974 7929 2e61 6273  bestQuality).abs
-00029670: 2829 2e6d 756c 7469 706c 7928 7369 676e  ().multiply(sign
-00029680: 290d 0a20 2020 2072 6574 7572 6e20 696d  )..    return im
-00029690: 6167 652e 6164 6442 616e 6473 2864 656c  age.addBands(del
-000296a0: 7461 2e73 656c 6563 7428 5b30 5d2c 205b  ta.select([0], [
-000296b0: 2764 656c 7461 275d 2929 0d0a 2020 6f75  'delta']))..  ou
-000296c0: 7420 3d20 696e 436f 6c6c 6563 7469 6f6e  t = inCollection
-000296d0: 2e6d 6170 2877 290d 0a20 2072 6574 7572  .map(w)..  retur
-000296e0: 6e20 6f75 740d 0a0d 0a23 2323 2323 2323  n out....#######
-000296f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00029700: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00029710: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00029720: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
-00029730: 234d 6574 686f 6420 666f 7220 6170 706c  #Method for appl
-00029740: 7969 6e67 2074 6865 2071 7561 6c69 7479  ying the quality
-00029750: 4d6f 7361 6963 2066 756e 6374 696f 6e20  Mosaic function 
-00029760: 7573 696e 6720 6120 7370 6563 6966 6965  using a specifie
-00029770: 6420 7065 7263 656e 7469 6c65 0d0a 2355  d percentile..#U
-00029780: 7365 6675 6c20 7768 656e 2074 6865 206d  seful when the m
-00029790: 6178 206f 6620 7468 6520 7175 616c 6974  ax of the qualit
-000297a0: 7920 6261 6e64 2069 7320 6e6f 7420 7768  y band is not wh
-000297b0: 6174 2069 7320 7761 6e74 6564 0d0a 6465  at is wanted..de
-000297c0: 6620 6375 7374 6f6d 5175 616c 6974 794d  f customQualityM
-000297d0: 6f73 6169 6328 696e 436f 6c6c 6563 7469  osaic(inCollecti
-000297e0: 6f6e 2c71 7561 6c69 7479 4261 6e64 2c70  on,qualityBand,p
-000297f0: 6572 6365 6e74 696c 6529 3a0d 0a20 2023  ercentile):..  #
-00029800: 4164 6420 616e 2061 6273 6f6c 7574 6520  Add an absolute 
-00029810: 6469 6666 6572 656e 6365 2066 726f 6d20  difference from 
-00029820: 7468 6520 7370 6563 6966 6965 6420 7065  the specified pe
-00029830: 7263 656e 7469 6c65 0d0a 2020 2354 6869  rcentile..  #Thi
-00029840: 7320 6973 2069 6e76 6572 7465 6420 666f  s is inverted fo
-00029850: 7220 7468 6520 7175 616c 6974 794d 6f73  r the qualityMos
-00029860: 6169 6320 6675 6e63 7469 6f6e 2074 6f20  aic function to 
-00029870: 7072 6f70 6572 6c79 2070 7269 6f72 6974  properly priorit
-00029880: 697a 650d 0a20 2069 6e43 6f6c 6c65 6374  ize..  inCollect
-00029890: 696f 6e44 656c 7461 203d 2061 6464 4162  ionDelta = addAb
-000298a0: 7344 6966 6628 696e 436f 6c6c 6563 7469  sDiff(inCollecti
-000298b0: 6f6e 2c20 7175 616c 6974 7942 616e 642c  on, qualityBand,
-000298c0: 2070 6572 6365 6e74 696c 652c 2d31 290d   percentile,-1).
-000298d0: 0a0d 0a20 2023 4170 706c 7920 7468 6520  ...  #Apply the 
-000298e0: 7175 616c 6974 794d 6f73 6169 6320 6675  qualityMosaic fu
-000298f0: 6e63 7469 6f6e 0d0a 2020 7265 7475 726e  nction..  return
-00029900: 2069 6e43 6f6c 6c65 6374 696f 6e44 656c   inCollectionDel
-00029910: 7461 2e71 7561 6c69 7479 4d6f 7361 6963  ta.qualityMosaic
-00029920: 2827 6465 6c74 6127 290d 0a0d 0a23 2323  ('delta')....###
-00029930: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00029940: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00029950: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00029960: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00029970: 2323 0d0a 234f 6e2d 7468 652d 666c 7920  ##..#On-the-fly 
-00029980: 6261 7369 6320 7761 7465 7220 6d61 736b  basic water mask
-00029990: 696e 6720 6d65 7468 6f64 0d0a 2354 6869  ing method..#Thi
-000299a0: 7320 6d65 7468 6f64 2069 7320 7573 6564  s method is used
-000299b0: 2074 6f20 7072 6f76 6964 6520 6120 7469   to provide a ti
-000299c0: 6d65 2d73 656e 7369 7469 7665 2077 6174  me-sensitive wat
-000299d0: 6572 206d 6173 6b0d 0a23 5468 6973 206d  er mask..#This m
-000299e0: 6574 686f 6420 7465 6e64 7320 746f 2077  ethod tends to w
-000299f0: 6f72 6b20 7765 6c6c 2069 6620 7468 6572  ork well if ther
-00029a00: 6520 6973 206e 6f20 7765 7420 736e 6f77  e is no wet snow
-00029a10: 2070 7265 7365 6e74 0d0a 2357 6574 2073   present..#Wet s
-00029a20: 6e6f 7720 6f76 6572 2066 6c61 7420 6172  now over flat ar
-00029a30: 6561 7320 6361 6e20 7265 7375 6c74 2069  eas can result i
-00029a40: 6e20 6661 6c73 6520 706f 7369 7469 7665  n false positive
-00029a50: 730d 0a23 4465 7369 676e 6564 2074 6f20  s..#Designed to 
-00029a60: 776f 726b 2077 6974 6820 544f 4120 6461  work with TOA da
-00029a70: 7461 2e20 5352 2064 6174 6120 7769 6c6c  ta. SR data will
-00029a80: 2072 6573 756c 7420 696e 2066 616c 7365   result in false
-00029a90: 206e 6567 6174 6976 6573 2028 6f6d 6973   negatives (omis
-00029aa0: 7369 6f6e 290d 0a64 6566 2073 696d 706c  sion)..def simpl
-00029ab0: 6557 6174 6572 4d61 736b 2869 6d67 2c63  eWaterMask(img,c
-00029ac0: 6f6e 7472 6163 7450 6978 656c 7320 3d20  ontractPixels = 
-00029ad0: 302c 736c 6f70 655f 7468 7265 7368 203d  0,slope_thresh =
-00029ae0: 2031 302c 656c 6576 6174 696f 6e49 6d61   10,elevationIma
-00029af0: 6765 5061 7468 203d 2022 5553 4753 2f33  gePath = "USGS/3
-00029b00: 4445 502f 3130 6d22 2c65 6c65 7661 7469  DEP/10m",elevati
-00029b10: 6f6e 466f 6361 6c4d 6561 6e52 6164 6975  onFocalMeanRadiu
-00029b20: 7320 3d20 352e 3529 3a0d 0a20 2069 6d67  s = 5.5):..  img
-00029b30: 203d 2061 6464 5443 416e 676c 6573 2869   = addTCAngles(i
-00029b40: 6d67 290d 0a20 206e 6564 203d 2065 652e  mg)..  ned = ee.
-00029b50: 496d 6167 6528 656c 6576 6174 696f 6e49  Image(elevationI
-00029b60: 6d61 6765 5061 7468 292e 7265 7361 6d70  magePath).resamp
-00029b70: 6c65 2827 6269 6375 6269 6327 290d 0a20  le('bicubic').. 
-00029b80: 2073 6c6f 7065 203d 2065 652e 5465 7272   slope = ee.Terr
-00029b90: 6169 6e2e 736c 6f70 6528 6e65 642e 666f  ain.slope(ned.fo
-00029ba0: 6361 6c5f 6d65 616e 2865 6c65 7661 7469  cal_mean(elevati
-00029bb0: 6f6e 466f 6361 6c4d 6561 6e52 6164 6975  onFocalMeanRadiu
-00029bc0: 7329 290d 0a20 2066 6c61 7420 3d20 736c  s))..  flat = sl
-00029bd0: 6f70 652e 6c74 6528 736c 6f70 655f 7468  ope.lte(slope_th
-00029be0: 7265 7368 290d 0a0d 0a20 2077 6174 6572  resh)....  water
-00029bf0: 4d61 736b 203d 2069 6d67 2e73 656c 6563  Mask = img.selec
-00029c00: 7428 5b27 7463 416e 676c 6542 5727 5d29  t(['tcAngleBW'])
-00029c10: 2e67 7465 282d 302e 3035 295c 0d0a 2020  .gte(-0.05)\..  
-00029c20: 2020 2e41 6e64 2869 6d67 2e73 656c 6563    .And(img.selec
-00029c30: 7428 5b27 7463 416e 676c 6542 4727 5d29  t(['tcAngleBG'])
-00029c40: 2e6c 7465 2830 2e30 3529 295c 0d0a 2020  .lte(0.05))\..  
-00029c50: 2020 2e41 6e64 2869 6d67 2e73 656c 6563    .And(img.selec
-00029c60: 7428 5b27 6272 6967 6874 6e65 7373 275d  t(['brightness']
-00029c70: 292e 6c74 2830 2e33 2929 5c0d 0a20 2020  ).lt(0.3))\..   
-00029c80: 202e 416e 6428 666c 6174 292e 666f 6361   .And(flat).foca
-00029c90: 6c5f 6d69 6e28 636f 6e74 7261 6374 5069  l_min(contractPi
-00029ca0: 7865 6c73 290d 0a0d 0a20 2072 6574 7572  xels)....  retur
-00029cb0: 6e20 7761 7465 724d 6173 6b2e 7265 6e61  n waterMask.rena
-00029cc0: 6d65 285b 2777 6174 6572 4d61 736b 275d  me(['waterMask']
-00029cd0: 290d 0a23 2323 2323 2323 2323 2323 2323  )..#############
-00029ce0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00029cf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00029d00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00029d10: 2323 2323 2323 2323 0d0a 234a 6566 6620  ########..#Jeff 
-00029d20: 486f 204d 6574 686f 6420 666f 7220 616c  Ho Method for al
-00029d30: 6761 6c20 626c 6f6f 6d20 6465 7465 6374  gal bloom detect
-00029d40: 696f 6e0d 0a23 6874 7470 733a 2f2f 7777  ion..#https://ww
-00029d50: 772e 6e61 7475 7265 2e63 6f6d 2f61 7274  w.nature.com/art
-00029d60: 6963 6c65 732f 7334 3135 3836 2d30 3139  icles/s41586-019
-00029d70: 2d31 3634 382d 370d 0a0d 0a23 2053 696d  -1648-7....# Sim
-00029d80: 706c 6966 6965 6420 5363 7269 7074 2066  plified Script f
-00029d90: 6f72 204c 616e 6473 6174 2057 6174 6572  or Landsat Water
-00029da0: 2051 7561 6c69 7479 0d0a 2320 5072 6f64   Quality..# Prod
-00029db0: 7563 6573 2061 206d 6170 206f 6620 616e  uces a map of an
-00029dc0: 2061 6c67 616c 2062 6c6f 6f6d 2069 6e20   algal bloom in 
-00029dd0: 4c61 6b65 2045 7269 6520 6f6e 2032 3031  Lake Erie on 201
-00029de0: 312f 392f 330d 0a23 2043 7265 6174 6564  1/9/3..# Created
-00029df0: 206f 6e20 3132 2f37 2f32 3031 3520 6279   on 12/7/2015 by
-00029e00: 204a 6566 6620 486f 0d0a 0d0a 2320 5370   Jeff Ho....# Sp
-00029e10: 6563 6966 6965 7320 6120 7468 7265 7368  ecifies a thresh
-00029e20: 6f6c 6420 666f 7220 6875 6520 746f 2065  old for hue to e
-00029e30: 7374 696d 6174 6520 2267 7265 656e 2220  stimate "green" 
-00029e40: 7069 7865 6c73 0d0a 2320 7468 6973 2069  pixels..# this i
-00029e50: 7320 7573 6564 2061 7320 616e 2061 6464  s used as an add
-00029e60: 6974 696f 6e61 6c20 6669 6c74 6572 2074  itional filter t
-00029e70: 6f20 7265 6669 6e65 2074 6865 2061 6c67  o refine the alg
-00029e80: 6f72 6974 686d 2061 626f 7665 0d0a 6465  orithm above..de
-00029e90: 6620 486f 4361 6c63 4772 6565 6e6e 6573  f HoCalcGreennes
-00029ea0: 7328 696d 6729 3a0d 0a20 2023 6d61 7020  s(img):..  #map 
-00029eb0: 722c 2067 2c20 616e 6420 6220 666f 7220  r, g, and b for 
-00029ec0: 6d6f 7265 2072 6561 6461 626c 6520 616c  more readable al
-00029ed0: 6765 6272 6120 6265 6c6f 770d 0a20 2072  gebra below..  r
-00029ee0: 203d 2069 6d67 2e73 656c 6563 7428 5b27   = img.select(['
-00029ef0: 7265 6427 5d29 0d0a 2020 6720 3d20 696d  red'])..  g = im
-00029f00: 672e 7365 6c65 6374 285b 2767 7265 656e  g.select(['green
-00029f10: 275d 290d 0a20 2062 203d 2069 6d67 2e73  '])..  b = img.s
-00029f20: 656c 6563 7428 5b27 626c 7565 275d 290d  elect(['blue']).
-00029f30: 0a0d 0a20 2023 6361 6c63 756c 6174 6520  ...  #calculate 
-00029f40: 696e 7465 6e73 6974 792c 2068 7565 0d0a  intensity, hue..
-00029f50: 2020 4920 3d20 722e 6164 6428 6729 2e61    I = r.add(g).a
-00029f60: 6464 2862 292e 7265 6e61 6d65 285b 2749  dd(b).rename(['I
-00029f70: 275d 290d 0a20 206d 696e 7320 3d20 722e  '])..  mins = r.
-00029f80: 6d69 6e28 6729 2e6d 696e 2862 292e 7265  min(g).min(b).re
-00029f90: 6e61 6d65 285b 276d 696e 7327 5d29 0d0a  name(['mins'])..
-00029fa0: 2020 4820 3d20 6d69 6e73 2e77 6865 7265    H = mins.where
-00029fb0: 286d 696e 732e 6571 2872 292c 2862 2e73  (mins.eq(r),(b.s
-00029fc0: 7562 7472 6163 7428 7229 292e 6469 7669  ubtract(r)).divi
-00029fd0: 6465 2849 2e73 7562 7472 6163 7428 722e  de(I.subtract(r.
-00029fe0: 6d75 6c74 6970 6c79 2833 2929 292e 6164  multiply(3))).ad
-00029ff0: 6428 3129 2029 0d0a 2020 4820 3d20 482e  d(1) )..  H = H.
-0002a000: 7768 6572 6528 6d69 6e73 2e65 7128 6729  where(mins.eq(g)
-0002a010: 2c28 722e 7375 6274 7261 6374 2867 2929  ,(r.subtract(g))
-0002a020: 2e64 6976 6964 6528 492e 7375 6274 7261  .divide(I.subtra
-0002a030: 6374 2867 2e6d 756c 7469 706c 7928 3329  ct(g.multiply(3)
-0002a040: 2929 2e61 6464 2832 2920 290d 0a20 2048  )).add(2) )..  H
-0002a050: 203d 2048 2e77 6865 7265 286d 696e 732e   = H.where(mins.
-0002a060: 6571 2862 292c 2867 2e73 7562 7472 6163  eq(b),(g.subtrac
-0002a070: 7428 6229 292e 6469 7669 6465 2849 2e73  t(b)).divide(I.s
-0002a080: 7562 7472 6163 7428 622e 6d75 6c74 6970  ubtract(b.multip
-0002a090: 6c79 2833 2929 2920 290d 0a0d 0a20 2023  ly(3))) )....  #
-0002a0a0: 7069 7865 6c73 2077 6974 6820 6875 6520  pixels with hue 
-0002a0b0: 6265 6c6f 7720 312e 3620 6d6f 7265 206c  below 1.6 more l
-0002a0c0: 696b 656c 7920 746f 2062 6520 626c 6f6f  ikely to be bloo
-0002a0d0: 6d20 616e 6420 6e6f 7420 7375 7370 656e  m and not suspen
-0002a0e0: 6465 6420 7365 6469 6d65 6e74 0d0a 2020  ded sediment..  
-0002a0f0: 4874 6872 6573 6820 3d20 482e 6c74 6528  Hthresh = H.lte(
-0002a100: 312e 3629 0d0a 0d0a 2020 7265 7475 726e  1.6)....  return
-0002a110: 2048 2e72 656e 616d 6528 2748 2729 0d0a   H.rename('H')..
-0002a120: 0d0a 0d0a 2341 7070 6c79 2062 6c6f 6f6d  ....#Apply bloom
-0002a130: 2064 6574 6563 7469 6f6e 2061 6c67 6f72   detection algor
-0002a140: 6974 686d 0d0a 6465 6620 486f 4361 6c63  ithm..def HoCalc
-0002a150: 416c 676f 7269 7468 6d31 2869 6d61 6765  Algorithm1(image
-0002a160: 293a 0d0a 2020 7472 7565 636f 6c6f 7220  ):..  truecolor 
-0002a170: 3d20 3120 2373 686f 7720 7472 7565 2063  = 1 #show true c
-0002a180: 6f6c 6f72 2069 6d61 6765 2061 7320 7765  olor image as we
-0002a190: 6c6c 0d0a 2020 7465 7374 5468 7265 7368  ll..  testThresh
-0002a1a0: 203d 2046 616c 7365 2023 2061 6464 2061   = False # add a
-0002a1b0: 2062 696e 6172 7920 696d 6167 6520 636c   binary image cl
-0002a1c0: 6173 7369 6679 696e 6720 696e 746f 2022  assifying into "
-0002a1d0: 626c 6f6f 6d22 616e 6420 226e 6f6e 2d62  bloom"and "non-b
-0002a1e0: 6c6f 6f6d 0d0a 2020 626c 6f6f 6d54 6872  loom..  bloomThr
-0002a1f0: 6573 686f 6c64 203d 2030 2e30 3233 3436  eshold = 0.02346
-0002a200: 2023 7468 7265 7368 6f6c 6420 666f 7220   #threshold for 
-0002a210: 636c 6173 7369 6669 6361 7469 6f6e 2066  classification f
-0002a220: 6974 2062 6173 6564 206f 6e20 6f74 6865  it based on othe
-0002a230: 7220 6461 7461 0d0a 2020 6772 6565 6e65  r data..  greene
-0002a240: 7373 5468 7265 7368 6f6c 6420 3d20 312e  ssThreshold = 1.
-0002a250: 360d 0a0d 0a20 2023 2041 6c67 6f72 6974  6....  # Algorit
-0002a260: 686d 2031 2062 6173 6564 206f 6e3a 0d0a  hm 1 based on:..
-0002a270: 2020 2320 5761 6e67 2c20 4d2e 2c20 2620    # Wang, M., & 
-0002a280: 5368 692c 2057 2e20 2832 3030 3729 2e20  Shi, W. (2007). 
-0002a290: 5468 6520 4e49 522d 5357 4952 2063 6f6d  The NIR-SWIR com
-0002a2a0: 6269 6e65 6420 6174 6d6f 7370 6865 7269  bined atmospheri
-0002a2b0: 630d 0a20 2023 2020 636f 7272 6563 7469  c..  #  correcti
-0002a2c0: 6f6e 2061 7070 726f 6163 6820 666f 7220  on approach for 
-0002a2d0: 4d4f 4449 5320 6f63 6561 6e20 636f 6c6f  MODIS ocean colo
-0002a2e0: 7220 6461 7461 2070 726f 6365 7373 696e  r data processin
-0002a2f0: 672e 0d0a 2020 2320 204f 7074 6963 7320  g...  #  Optics 
-0002a300: 4578 7072 6573 732c 2031 3528 3234 292c  Express, 15(24),
-0002a310: 2031 3537 3232 e280 9331 3537 3333 2e0d   15722...15733..
-0002a320: 0a0d 0a20 2023 2041 6464 2073 6563 6f6e  ...  # Add secon
-0002a330: 6461 7279 2066 696c 7465 7220 7573 696e  dary filter usin
-0002a340: 6720 6772 6565 6e6e 6573 7320 6675 6e63  g greenness func
-0002a350: 7469 6f6e 2062 656c 6f77 0d0a 2020 696d  tion below..  im
-0002a360: 6167 6520 3d20 696d 6167 652e 6164 6442  age = image.addB
-0002a370: 616e 6473 2848 6f43 616c 6347 7265 656e  ands(HoCalcGreen
-0002a380: 6e65 7373 2869 6d61 6765 2929 0d0a 0d0a  ness(image))....
-0002a390: 2020 2320 4170 706c 7920 616c 676f 7269    # Apply algori
-0002a3a0: 7468 6d20 313a 2042 3420 2d20 312e 3033  thm 1: B4 - 1.03
-0002a3b0: 2a42 350d 0a20 2023 626c 6f6f 6d31 203d  *B5..  #bloom1 =
-0002a3c0: 2069 6d61 6765 2e73 656c 6563 7428 276e   image.select('n
-0002a3d0: 6972 2729 2e73 7562 7472 6163 7428 696d  ir').subtract(im
-0002a3e0: 6167 652e 7365 6c65 6374 2827 7377 6972  age.select('swir
-0002a3f0: 3127 292e 6d75 6c74 6970 6c79 2831 2e30  1').multiply(1.0
-0002a400: 3329 292e 7265 6e61 6d65 2827 626c 6f6f  3)).rename('bloo
-0002a410: 6d31 2729 0d0a 0d0a 2020 2320 4765 7420  m1')....  # Get 
-0002a420: 6269 6e61 7279 2069 6d61 6765 2062 7920  binary image by 
-0002a430: 6170 706c 7969 6e67 2074 6865 2074 6872  applying the thr
-0002a440: 6573 686f 6c64 0d0a 2020 626c 6f6f 6d31  eshold..  bloom1
-0002a450: 5f6d 6173 6b20 3d20 696d 6167 652e 7365  _mask = image.se
-0002a460: 6c65 6374 2822 4822 292e 6c74 6528 6772  lect("H").lte(gr
-0002a470: 6565 6e65 7373 5468 7265 7368 6f6c 6429  eenessThreshold)
-0002a480: 2e72 656e 616d 6528 5b22 626c 6f6f 6d31  .rename(["bloom1
-0002a490: 5f6d 6173 6b22 5d29 0d0a 0d0a 0d0a 2020  _mask"])......  
-0002a4a0: 7265 7475 726e 2069 6d61 6765 5c0d 0a20  return image\.. 
-0002a4b0: 2020 2020 2020 2020 202e 6164 6442 616e           .addBan
-0002a4c0: 6473 2862 6c6f 6f6d 3129 5c0d 0a20 2020  ds(bloom1)\..   
-0002a4d0: 2020 2020 2020 202e 6164 6442 616e 6473         .addBands
-0002a4e0: 2862 6c6f 6f6d 315f 6d61 736b 290d 0a0d  (bloom1_mask)...
-0002a4f0: 0a0d 0a0d 0a0d 0a23 202f 2f2f 2f2f 2f2f  .......# ///////
+000286c0: 2323 2323 2323 2323 0d0a 2353 696d 706c  ########..#Simpl
+000286d0: 6520 7072 6564 6963 7420 6675 6e63 7469  e predict functi
+000286e0: 6f6e 2066 6f72 2068 6172 6d6f 6e69 6320  on for harmonic 
+000286f0: 636f 6566 6669 6369 656e 7473 0d0a 2345  coefficients..#E
+00028700: 7870 6563 7473 2063 6f65 6666 7320 6672  xpects coeffs fr
+00028710: 6f6d 2067 6574 4861 726d 6f6e 6963 436f  om getHarmonicCo
+00028720: 6566 6669 6369 656e 7473 416e 6446 6974  efficientsAndFit
+00028730: 2066 756e 6374 696f 6e0d 0a23 4461 7465   function..#Date
+00028740: 2069 6d61 6765 2069 7320 6578 7065 6374   image is expect
+00028750: 6564 2074 6f20 6265 2079 7979 792e 6464  ed to be yyyy.dd
+00028760: 2077 6865 7265 2064 6420 6973 2074 6865   where dd is the
+00028770: 2064 6179 206f 6620 7965 6172 202f 2033   day of year / 3
+00028780: 3635 2028 7072 6f70 6f72 7469 6f6e 206f  65 (proportion o
+00028790: 6620 7965 6172 290d 0a23 6578 2e20 7379  f year)..#ex. sy
+000287a0: 6e74 6849 6d61 6765 2863 6f65 6666 732c  nthImage(coeffs,
+000287b0: 6565 2e49 6d61 6765 285b 3230 3139 2e36  ee.Image([2019.6
+000287c0: 5d29 2c5b 2762 6c75 6527 2c27 6772 6565  ]),['blue','gree
+000287d0: 6e27 2c27 7265 6427 2c27 6e69 7227 2c27  n','red','nir','
+000287e0: 7377 6972 3127 2c27 7377 6972 3227 2c27  swir1','swir2','
+000287f0: 4e42 5227 2c27 4e44 5649 275d 2c5b 322c  NBR','NDVI'],[2,
+00028800: 345d 2c74 7275 6529 0d0a 6465 6620 7379  4],true)..def sy
+00028810: 6e74 6849 6d61 6765 2863 6f65 6666 732c  nthImage(coeffs,
+00028820: 6461 7465 496d 6167 652c 696e 6465 784e  dateImage,indexN
+00028830: 616d 6573 2c68 6172 6d6f 6e69 6373 2c64  ames,harmonics,d
+00028840: 6574 7265 6e64 293a 0d0a 2020 2353 6574  etrend):..  #Set
+00028850: 2075 7020 636f 6e73 7461 6e74 2069 6d61   up constant ima
+00028860: 6765 2074 6f20 6d75 6c74 6970 6c79 2063  ge to multiply c
+00028870: 6f65 6666 7320 6279 0d0a 2020 636f 6e73  oeffs by..  cons
+00028880: 7449 6d61 6765 203d 2065 652e 496d 6167  tImage = ee.Imag
+00028890: 6528 3129 0d0a 2020 6966 2064 6574 7265  e(1)..  if detre
+000288a0: 6e64 3a63 6f6e 7374 496d 6167 6520 3d20  nd:constImage = 
+000288b0: 636f 6e73 7449 6d61 6765 2e61 6464 4261  constImage.addBa
+000288c0: 6e64 7328 6461 7465 496d 6167 6529 0d0a  nds(dateImage)..
+000288d0: 2020 666f 7220 6861 726d 2069 6e20 6861    for harm in ha
+000288e0: 726d 6f6e 6963 733a 0d0a 2020 2020 636f  rmonics:..    co
+000288f0: 6e73 7449 6d61 6765 203d 2063 6f6e 7374  nstImage = const
+00028900: 496d 6167 652e 6164 6442 616e 6473 2865  Image.addBands(e
+00028910: 652e 496d 6167 6528 5b64 6174 6549 6d61  e.Image([dateIma
+00028920: 6765 2e6d 756c 7469 706c 7928 6861 726d  ge.multiply(harm
+00028930: 2a6d 6174 682e 7069 292e 7369 6e28 295d  *math.pi).sin()]
+00028940: 292e 7265 6e61 6d65 285b 277b 7d5f 7369  ).rename(['{}_si
+00028950: 6e27 2e66 6f72 6d61 7428 6861 726d 2a31  n'.format(harm*1
+00028960: 3030 295d 2929 2020 2020 2020 2020 2020  00)]))          
+00028970: 2020 2020 2020 2020 2020 2020 200d 0a20               .. 
+00028980: 2066 6f72 2068 6172 6d20 696e 2068 6172   for harm in har
+00028990: 6d6f 6e69 6373 3a0d 0a20 2020 2063 6f6e  monics:..    con
+000289a0: 7374 496d 6167 6520 3d20 636f 6e73 7449  stImage = constI
+000289b0: 6d61 6765 2e61 6464 4261 6e64 7328 6565  mage.addBands(ee
+000289c0: 2e49 6d61 6765 285b 6461 7465 496d 6167  .Image([dateImag
+000289d0: 652e 6d75 6c74 6970 6c79 2868 6172 6d2a  e.multiply(harm*
+000289e0: 6d61 7468 2e70 6929 2e63 6f73 2829 5d29  math.pi).cos()])
+000289f0: 2e72 656e 616d 6528 5b27 7b7d 5f63 6f73  .rename(['{}_cos
+00028a00: 272e 666f 726d 6174 2868 6172 6d2a 3130  '.format(harm*10
+00028a10: 3029 5d29 290d 0a20 200d 0a20 2023 2063  0)]))..  ..  # c
+00028a20: 6f65 6666 7373 426e 203d 2063 6f65 6666  oeffssBn = coeff
+00028a30: 732e 7365 6c65 6374 2865 652e 5374 7269  s.select(ee.Stri
+00028a40: 6e67 2869 6e64 6578 4e61 6d65 735b 305d  ng(indexNames[0]
+00028a50: 292e 6361 7428 275f 2e2a 2729 290d 0a20  ).cat('_.*')).. 
+00028a60: 2023 2070 7269 6e74 2863 6f6e 7374 496d   # print(constIm
+00028a70: 6167 652e 6261 6e64 4e61 6d65 7328 292e  age.bandNames().
+00028a80: 6765 7449 6e66 6f28 292c 636f 6566 6673  getInfo(),coeffs
+00028a90: 7342 6e2e 6261 6e64 4e61 6d65 7328 292e  sBn.bandNames().
+00028aa0: 6765 7449 6e66 6f28 2929 0d0a 2020 2350  getInfo())..  #P
+00028ab0: 7265 6469 6374 2076 616c 7565 7320 666f  redict values fo
+00028ac0: 7220 6561 6368 2062 616e 640d 0a20 206f  r each band..  o
+00028ad0: 7574 203d 2065 652e 496d 6167 6528 3129  ut = ee.Image(1)
+00028ae0: 3b0d 0a20 2064 6566 2070 7265 6469 6374  ;..  def predict
+00028af0: 5772 6170 7065 7228 626e 2c6f 7574 293a  Wrapper(bn,out):
+00028b00: 0d0a 2020 2020 626e 203d 2065 652e 5374  ..    bn = ee.St
+00028b10: 7269 6e67 2862 6e29 0d0a 2020 2020 2353  ring(bn)..    #S
+00028b20: 656c 6563 7420 636f 6566 6673 2066 6f72  elect coeffs for
+00028b30: 2074 6861 7420 6261 6e64 0d0a 2020 2020   that band..    
+00028b40: 636f 6566 6673 7342 6e20 3d20 636f 6566  coeffssBn = coef
+00028b50: 6673 2e73 656c 6563 7428 6565 2e53 7472  fs.select(ee.Str
+00028b60: 696e 6728 626e 292e 6361 7428 275f 2e2a  ing(bn).cat('_.*
+00028b70: 2729 290d 0a20 2020 2070 7265 6469 6374  '))..    predict
+00028b80: 6564 203d 2063 6f6e 7374 496d 6167 652e  ed = constImage.
+00028b90: 6d75 6c74 6970 6c79 2863 6f65 6666 7373  multiply(coeffss
+00028ba0: 426e 292e 7265 6475 6365 2827 7375 6d27  Bn).reduce('sum'
+00028bb0: 292e 7265 6e61 6d65 2862 6e29 0d0a 2020  ).rename(bn)..  
+00028bc0: 2020 7265 7475 726e 2065 652e 496d 6167    return ee.Imag
+00028bd0: 6528 6f75 7429 2e61 6464 4261 6e64 7328  e(out).addBands(
+00028be0: 7072 6564 6963 7465 6429 0d0a 0d0a 2020  predicted)....  
+00028bf0: 6f75 7420 3d20 6565 2e49 6d61 6765 2865  out = ee.Image(e
+00028c00: 652e 4c69 7374 2869 6e64 6578 4e61 6d65  e.List(indexName
+00028c10: 7329 2e69 7465 7261 7465 2870 7265 6469  s).iterate(predi
+00028c20: 6374 5772 6170 7065 722c 6f75 7429 293b  ctWrapper,out));
+00028c30: 0d0a 0d0a 2020 6f75 7420 3d20 6f75 742e  ....  out = out.
+00028c40: 7365 6c65 6374 2865 652e 4c69 7374 2e73  select(ee.List.s
+00028c50: 6571 7565 6e63 6528 312c 206f 7574 2e62  equence(1, out.b
+00028c60: 616e 644e 616d 6573 2829 2e73 697a 6528  andNames().size(
+00028c70: 292e 7375 6274 7261 6374 2831 2929 290d  ).subtract(1))).
+00028c80: 0a0d 0a20 2072 6574 7572 6e20 6f75 740d  ...  return out.
+00028c90: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+00028ca0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028cb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028cc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028cd0: 2323 2323 2323 0d0a 2357 7261 7070 6572  ######..#Wrapper
+00028ce0: 2066 756e 6374 696f 6e20 746f 2067 6574   function to get
+00028cf0: 2063 6c69 6d61 7465 2064 6174 610d 0a23   climate data..#
+00028d00: 2053 7570 706f 7274 733a 0d0a 2320 4e41   Supports:..# NA
+00028d10: 5341 2f4f 524e 4c2f 4441 594d 4554 5f56  SA/ORNL/DAYMET_V
+00028d20: 330d 0a23 204e 4153 412f 4f52 4e4c 2f44  3..# NASA/ORNL/D
+00028d30: 4159 4d45 545f 5634 0d0a 2320 5543 5342  AYMET_V4..# UCSB
+00028d40: 2d43 4847 2f43 4849 5250 532f 4441 494c  -CHG/CHIRPS/DAIL
+00028d50: 5920 2870 7265 6369 7069 7461 7469 6f6e  Y (precipitation
+00028d60: 206f 6e6c 7929 0d0a 2361 6e64 2070 6f73   only)..#and pos
+00028d70: 7369 626c 7920 6f74 6865 7273 0d0a 6465  sibly others..de
+00028d80: 6620 6765 7443 6c69 6d61 7465 5772 6170  f getClimateWrap
+00028d90: 7065 7228 636f 6c6c 6563 7469 6f6e 4e61  per(collectionNa
+00028da0: 6d65 2c73 7475 6479 4172 6561 2c73 7461  me,studyArea,sta
+00028db0: 7274 5965 6172 2c65 6e64 5965 6172 2c73  rtYear,endYear,s
+00028dc0: 7461 7274 4a75 6c69 616e 2c65 6e64 4a75  tartJulian,endJu
+00028dd0: 6c69 616e 2c74 696d 6562 7566 6665 722c  lian,timebuffer,
+00028de0: 7765 6967 6874 732c 636f 6d70 6f73 6974  weights,composit
+00028df0: 696e 6752 6564 7563 6572 2c65 7870 6f72  ingReducer,expor
+00028e00: 7443 6f6d 706f 7369 7465 7320 3d20 4661  tComposites = Fa
+00028e10: 6c73 652c 6578 706f 7274 5061 7468 526f  lse,exportPathRo
+00028e20: 6f74 203d 204e 6f6e 652c 6372 7320 3d20  ot = None,crs = 
+00028e30: 4e6f 6e65 2c74 7261 6e73 666f 726d 203d  None,transform =
+00028e40: 204e 6f6e 652c 7363 616c 6520 3d20 4e6f   None,scale = No
+00028e50: 6e65 2c65 7870 6f72 7442 616e 6473 203d  ne,exportBands =
+00028e60: 204e 6f6e 6529 3a0d 0a20 2061 7267 7320   None):..  args 
+00028e70: 3d20 666f 726d 6174 4172 6773 286c 6f63  = formatArgs(loc
+00028e80: 616c 7328 2929 0d0a 2020 6966 2027 6172  als())..  if 'ar
+00028e90: 6773 2720 696e 2061 7267 732e 6b65 7973  gs' in args.keys
+00028ea0: 2829 3a0d 0a20 2020 2064 656c 2061 7267  ():..    del arg
+00028eb0: 735b 2761 7267 7327 5d0d 0a20 2070 7269  s['args']..  pri
+00028ec0: 6e74 2861 7267 7329 0d0a 0d0a 2020 2350  nt(args)....  #P
+00028ed0: 7265 7061 7265 2064 6174 6573 0d0a 2020  repare dates..  
+00028ee0: 2357 7261 7020 7468 6520 6461 7465 7320  #Wrap the dates 
+00028ef0: 6966 206e 6565 6465 640d 0a20 2077 7261  if needed..  wra
+00028f00: 704f 6666 7365 7420 3d20 300d 0a20 2069  pOffset = 0..  i
+00028f10: 6620 7374 6172 744a 756c 6961 6e20 3e20  f startJulian > 
+00028f20: 656e 644a 756c 6961 6e3a 0d0a 2020 2020  endJulian:..    
+00028f30: 7772 6170 4f66 6673 6574 203d 2033 3635  wrapOffset = 365
+00028f40: 0d0a 0d0a 2020 7374 6172 7444 6174 6520  ....  startDate 
+00028f50: 3d20 6565 2e44 6174 652e 6672 6f6d 594d  = ee.Date.fromYM
+00028f60: 4428 7374 6172 7459 6561 722c 312c 3129  D(startYear,1,1)
+00028f70: 2e61 6476 616e 6365 2873 7461 7274 4a75  .advance(startJu
+00028f80: 6c69 616e 2d31 2c27 6461 7927 290d 0a20  lian-1,'day').. 
+00028f90: 2065 6e64 4461 7465 203d 2065 652e 4461   endDate = ee.Da
+00028fa0: 7465 2e66 726f 6d59 4d44 2865 6e64 5965  te.fromYMD(endYe
+00028fb0: 6172 2c31 2c31 292e 6164 7661 6e63 6528  ar,1,1).advance(
+00028fc0: 656e 644a 756c 6961 6e2d 312b 7772 6170  endJulian-1+wrap
+00028fd0: 4f66 6673 6574 2c27 6461 7927 290d 0a20  Offset,'day').. 
+00028fe0: 2070 7269 6e74 2827 5374 6172 7420 616e   print('Start an
+00028ff0: 6420 656e 6420 6461 7465 733a 272c 2073  d end dates:', s
+00029000: 7461 7274 4461 7465 2e66 6f72 6d61 7428  tartDate.format(
+00029010: 2759 5959 592d 4d4d 2d64 6427 292e 6765  'YYYY-MM-dd').ge
+00029020: 7449 6e66 6f28 292c 2065 6e64 4461 7465  tInfo(), endDate
+00029030: 2e66 6f72 6d61 7428 2759 5959 592d 4d4d  .format('YYYY-MM
+00029040: 2d64 6427 292e 6765 7449 6e66 6f28 2929  -dd').getInfo())
+00029050: 0d0a 2020 7072 696e 7428 274a 756c 6961  ..  print('Julia
+00029060: 6e20 6461 7973 2061 7265 3a27 2c73 7461  n days are:',sta
+00029070: 7274 4a75 6c69 616e 2c65 6e64 4a75 6c69  rtJulian,endJuli
+00029080: 616e 290d 0a0d 0a20 2023 4765 7420 636c  an)....  #Get cl
+00029090: 696d 6174 6520 6461 7461 0d0a 2020 6320  imate data..  c 
+000290a0: 3d20 6565 2e49 6d61 6765 436f 6c6c 6563  = ee.ImageCollec
+000290b0: 7469 6f6e 2863 6f6c 6c65 6374 696f 6e4e  tion(collectionN
+000290c0: 616d 6529 5c0d 0a20 2020 2020 2020 2020  ame)\..         
+000290d0: 2020 2e66 696c 7465 7242 6f75 6e64 7328    .filterBounds(
+000290e0: 7374 7564 7941 7265 6129 5c0d 0a20 2020  studyArea)\..   
+000290f0: 2020 2020 2020 2020 2e66 696c 7465 7244          .filterD
+00029100: 6174 6528 7374 6172 7444 6174 652c 656e  ate(startDate,en
+00029110: 6444 6174 652e 6164 7661 6e63 6528 312c  dDate.advance(1,
+00029120: 2764 6179 2729 295c 0d0a 2020 2020 2020  'day'))\..      
+00029130: 2020 2020 202e 6669 6c74 6572 2865 652e       .filter(ee.
+00029140: 4669 6c74 6572 2e63 616c 656e 6461 7252  Filter.calendarR
+00029150: 616e 6765 2873 7461 7274 4a75 6c69 616e  ange(startJulian
+00029160: 2c65 6e64 4a75 6c69 616e 2929 0d0a 0d0a  ,endJulian))....
+00029170: 2020 2353 6574 2074 6f20 6170 7072 6f70    #Set to approp
+00029180: 7269 6174 6520 7265 7361 6d70 6c69 6e67  riate resampling
+00029190: 206d 6574 686f 640d 0a20 2063 203d 2063   method..  c = c
+000291a0: 2e6d 6170 286c 616d 6264 6120 696d 673a  .map(lambda img:
+000291b0: 2069 6d67 2e72 6573 616d 706c 6528 2762   img.resample('b
+000291c0: 6963 7562 6963 2729 290d 0a20 204d 6170  icubic'))..  Map
+000291d0: 2e61 6464 4c61 7965 7228 632c 7b7d 2c27  .addLayer(c,{},'
+000291e0: 5261 7720 436c 696d 6174 6527 2c46 616c  Raw Climate',Fal
+000291f0: 7365 290d 0a0d 0a20 2023 4372 6561 7465  se)....  #Create
+00029200: 2063 6f6d 706f 7369 7465 2074 696d 6520   composite time 
+00029210: 7365 7269 6573 0d0a 2020 7473 203d 2063  series..  ts = c
+00029220: 6f6d 706f 7369 7465 5469 6d65 5365 7269  ompositeTimeSeri
+00029230: 6573 2863 2c73 7461 7274 5965 6172 2c65  es(c,startYear,e
+00029240: 6e64 5965 6172 2c73 7461 7274 4a75 6c69  ndYear,startJuli
+00029250: 616e 2c65 6e64 4a75 6c69 616e 2c74 696d  an,endJulian,tim
+00029260: 6562 7566 6665 722c 7765 6967 6874 732c  ebuffer,weights,
+00029270: 4e6f 6e65 2c63 6f6d 706f 7369 7469 6e67  None,compositing
+00029280: 5265 6475 6365 7229 0d0a 2020 7473 203d  Reducer)..  ts =
+00029290: 2065 652e 496d 6167 6543 6f6c 6c65 6374   ee.ImageCollect
+000292a0: 696f 6e28 7473 2e6d 6170 286c 616d 6264  ion(ts.map(lambd
+000292b0: 6120 6920 3a20 692e 666c 6f61 7428 2929  a i : i.float())
+000292c0: 290d 0a0d 0a20 2023 4578 706f 7274 2063  )....  #Export c
+000292d0: 6f6d 706f 7369 7465 2063 6f6c 6c65 6374  omposite collect
+000292e0: 696f 6e0d 0a20 2069 6620 6578 706f 7274  ion..  if export
+000292f0: 436f 6d70 6f73 6974 6573 3a0d 0a20 2020  Composites:..   
+00029300: 2023 5365 7420 7570 2065 7870 6f72 7420   #Set up export 
+00029310: 6261 6e64 7320 6966 206e 6f74 2073 7065  bands if not spe
+00029320: 6369 6669 6564 0d0a 2020 2020 6966 2065  cified..    if e
+00029330: 7870 6f72 7442 616e 6473 203d 3d20 4e6f  xportBands == No
+00029340: 6e65 3a0d 0a20 2020 2020 2065 7870 6f72  ne:..      expor
+00029350: 7442 616e 6473 203d 2065 652e 4c69 7374  tBands = ee.List
+00029360: 2865 652e 496d 6167 6528 7473 2e66 6972  (ee.Image(ts.fir
+00029370: 7374 2829 292e 6261 6e64 4e61 6d65 7328  st()).bandNames(
+00029380: 2929 0d0a 0d0a 2020 2020 6578 706f 7274  ))....    export
+00029390: 436f 6c6c 6563 7469 6f6e 2865 7870 6f72  Collection(expor
+000293a0: 7450 6174 6852 6f6f 742c 636f 6c6c 6563  tPathRoot,collec
+000293b0: 7469 6f6e 4e61 6d65 2e73 706c 6974 2827  tionName.split('
+000293c0: 2f27 295b 2d31 5d2c 7374 7564 7941 7265  /')[-1],studyAre
+000293d0: 612c 2063 7273 2c74 7261 6e73 666f 726d  a, crs,transform
+000293e0: 2c73 6361 6c65 2c74 732c 7374 6172 7459  ,scale,ts,startY
+000293f0: 6561 722c 656e 6459 6561 722c 7374 6172  ear,endYear,star
+00029400: 744a 756c 6961 6e2c 656e 644a 756c 6961  tJulian,endJulia
+00029410: 6e2c 636f 6d70 6f73 6974 696e 6752 6564  n,compositingRed
+00029420: 7563 6572 2c74 696d 6562 7566 6665 722c  ucer,timebuffer,
+00029430: 6578 706f 7274 4261 6e64 7329 0d0a 0d0a  exportBands)....
+00029440: 2020 7265 7475 726e 2074 7323 2323 230d    return ts####.
+00029450: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+00029460: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00029470: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00029480: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00029490: 2323 2323 2323 0d0a 2341 6464 7320 6162  ######..#Adds ab
+000294a0: 736f 6c75 7465 2064 6966 6665 7265 6e63  solute differenc
+000294b0: 6520 6672 6f6d 2061 2073 7065 6369 6669  e from a specifi
+000294c0: 6564 2062 616e 6420 7375 6d6d 6172 697a  ed band summariz
+000294d0: 6564 2062 7920 6120 7072 6f76 6964 6564  ed by a provided
+000294e0: 2070 6572 6365 6e74 696c 650d 0a23 496e   percentile..#In
+000294f0: 7465 6e64 6564 2066 6f72 2063 7573 746f  tended for custo
+00029500: 6d20 736f 7274 696e 6720 6163 726f 7373  m sorting across
+00029510: 2063 6f6c 6c65 6374 696f 6e73 0d0a 6465   collections..de
+00029520: 6620 6164 6441 6273 4469 6666 2869 6e43  f addAbsDiff(inC
+00029530: 6f6c 6c65 6374 696f 6e2c 2071 7561 6c69  ollection, quali
+00029540: 7479 4261 6e64 2c20 7065 7263 656e 7469  tyBand, percenti
+00029550: 6c65 2c73 6967 6e29 3a0d 0a20 2062 6573  le,sign):..  bes
+00029560: 7451 7561 6c69 7479 203d 2069 6e43 6f6c  tQuality = inCol
+00029570: 6c65 6374 696f 6e2e 7365 6c65 6374 285b  lection.select([
+00029580: 7175 616c 6974 7942 616e 645d 292e 7265  qualityBand]).re
+00029590: 6475 6365 2865 652e 5265 6475 6365 722e  duce(ee.Reducer.
+000295a0: 7065 7263 656e 7469 6c65 285b 7065 7263  percentile([perc
+000295b0: 656e 7469 6c65 5d29 290d 0a20 2064 6566  entile]))..  def
+000295c0: 2077 2869 6d61 6765 293a 0d0a 2020 2020   w(image):..    
+000295d0: 6465 6c74 6120 3d20 696d 6167 652e 7365  delta = image.se
+000295e0: 6c65 6374 285b 7175 616c 6974 7942 616e  lect([qualityBan
+000295f0: 645d 292e 7375 6274 7261 6374 2862 6573  d]).subtract(bes
+00029600: 7451 7561 6c69 7479 292e 6162 7328 292e  tQuality).abs().
+00029610: 6d75 6c74 6970 6c79 2873 6967 6e29 0d0a  multiply(sign)..
+00029620: 2020 2020 7265 7475 726e 2069 6d61 6765      return image
+00029630: 2e61 6464 4261 6e64 7328 6465 6c74 612e  .addBands(delta.
+00029640: 7365 6c65 6374 285b 305d 2c20 5b27 6465  select([0], ['de
+00029650: 6c74 6127 5d29 290d 0a20 206f 7574 203d  lta']))..  out =
+00029660: 2069 6e43 6f6c 6c65 6374 696f 6e2e 6d61   inCollection.ma
+00029670: 7028 7729 0d0a 2020 7265 7475 726e 206f  p(w)..  return o
+00029680: 7574 0d0a 0d0a 2323 2323 2323 2323 2323  ut....##########
+00029690: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000296a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000296b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000296c0: 2323 2323 2323 2323 2323 230d 0a23 4d65  ###########..#Me
+000296d0: 7468 6f64 2066 6f72 2061 7070 6c79 696e  thod for applyin
+000296e0: 6720 7468 6520 7175 616c 6974 794d 6f73  g the qualityMos
+000296f0: 6169 6320 6675 6e63 7469 6f6e 2075 7369  aic function usi
+00029700: 6e67 2061 2073 7065 6369 6669 6564 2070  ng a specified p
+00029710: 6572 6365 6e74 696c 650d 0a23 5573 6566  ercentile..#Usef
+00029720: 756c 2077 6865 6e20 7468 6520 6d61 7820  ul when the max 
+00029730: 6f66 2074 6865 2071 7561 6c69 7479 2062  of the quality b
+00029740: 616e 6420 6973 206e 6f74 2077 6861 7420  and is not what 
+00029750: 6973 2077 616e 7465 640d 0a64 6566 2063  is wanted..def c
+00029760: 7573 746f 6d51 7561 6c69 7479 4d6f 7361  ustomQualityMosa
+00029770: 6963 2869 6e43 6f6c 6c65 6374 696f 6e2c  ic(inCollection,
+00029780: 7175 616c 6974 7942 616e 642c 7065 7263  qualityBand,perc
+00029790: 656e 7469 6c65 293a 0d0a 2020 2341 6464  entile):..  #Add
+000297a0: 2061 6e20 6162 736f 6c75 7465 2064 6966   an absolute dif
+000297b0: 6665 7265 6e63 6520 6672 6f6d 2074 6865  ference from the
+000297c0: 2073 7065 6369 6669 6564 2070 6572 6365   specified perce
+000297d0: 6e74 696c 650d 0a20 2023 5468 6973 2069  ntile..  #This i
+000297e0: 7320 696e 7665 7274 6564 2066 6f72 2074  s inverted for t
+000297f0: 6865 2071 7561 6c69 7479 4d6f 7361 6963  he qualityMosaic
+00029800: 2066 756e 6374 696f 6e20 746f 2070 726f   function to pro
+00029810: 7065 726c 7920 7072 696f 7269 7469 7a65  perly prioritize
+00029820: 0d0a 2020 696e 436f 6c6c 6563 7469 6f6e  ..  inCollection
+00029830: 4465 6c74 6120 3d20 6164 6441 6273 4469  Delta = addAbsDi
+00029840: 6666 2869 6e43 6f6c 6c65 6374 696f 6e2c  ff(inCollection,
+00029850: 2071 7561 6c69 7479 4261 6e64 2c20 7065   qualityBand, pe
+00029860: 7263 656e 7469 6c65 2c2d 3129 0d0a 0d0a  rcentile,-1)....
+00029870: 2020 2341 7070 6c79 2074 6865 2071 7561    #Apply the qua
+00029880: 6c69 7479 4d6f 7361 6963 2066 756e 6374  lityMosaic funct
+00029890: 696f 6e0d 0a20 2072 6574 7572 6e20 696e  ion..  return in
+000298a0: 436f 6c6c 6563 7469 6f6e 4465 6c74 612e  CollectionDelta.
+000298b0: 7175 616c 6974 794d 6f73 6169 6328 2764  qualityMosaic('d
+000298c0: 656c 7461 2729 0d0a 0d0a 2323 2323 2323  elta')....######
+000298d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000298e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000298f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00029900: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
+00029910: 0a23 4f6e 2d74 6865 2d66 6c79 2062 6173  .#On-the-fly bas
+00029920: 6963 2077 6174 6572 206d 6173 6b69 6e67  ic water masking
+00029930: 206d 6574 686f 640d 0a23 5468 6973 206d   method..#This m
+00029940: 6574 686f 6420 6973 2075 7365 6420 746f  ethod is used to
+00029950: 2070 726f 7669 6465 2061 2074 696d 652d   provide a time-
+00029960: 7365 6e73 6974 6976 6520 7761 7465 7220  sensitive water 
+00029970: 6d61 736b 0d0a 2354 6869 7320 6d65 7468  mask..#This meth
+00029980: 6f64 2074 656e 6473 2074 6f20 776f 726b  od tends to work
+00029990: 2077 656c 6c20 6966 2074 6865 7265 2069   well if there i
+000299a0: 7320 6e6f 2077 6574 2073 6e6f 7720 7072  s no wet snow pr
+000299b0: 6573 656e 740d 0a23 5765 7420 736e 6f77  esent..#Wet snow
+000299c0: 206f 7665 7220 666c 6174 2061 7265 6173   over flat areas
+000299d0: 2063 616e 2072 6573 756c 7420 696e 2066   can result in f
+000299e0: 616c 7365 2070 6f73 6974 6976 6573 0d0a  alse positives..
+000299f0: 2344 6573 6967 6e65 6420 746f 2077 6f72  #Designed to wor
+00029a00: 6b20 7769 7468 2054 4f41 2064 6174 612e  k with TOA data.
+00029a10: 2053 5220 6461 7461 2077 696c 6c20 7265   SR data will re
+00029a20: 7375 6c74 2069 6e20 6661 6c73 6520 6e65  sult in false ne
+00029a30: 6761 7469 7665 7320 286f 6d69 7373 696f  gatives (omissio
+00029a40: 6e29 0d0a 6465 6620 7369 6d70 6c65 5761  n)..def simpleWa
+00029a50: 7465 724d 6173 6b28 696d 672c 636f 6e74  terMask(img,cont
+00029a60: 7261 6374 5069 7865 6c73 203d 2030 2c73  ractPixels = 0,s
+00029a70: 6c6f 7065 5f74 6872 6573 6820 3d20 3130  lope_thresh = 10
+00029a80: 2c65 6c65 7661 7469 6f6e 496d 6167 6550  ,elevationImageP
+00029a90: 6174 6820 3d20 2255 5347 532f 3344 4550  ath = "USGS/3DEP
+00029aa0: 2f31 306d 222c 656c 6576 6174 696f 6e46  /10m",elevationF
+00029ab0: 6f63 616c 4d65 616e 5261 6469 7573 203d  ocalMeanRadius =
+00029ac0: 2035 2e35 293a 0d0a 2020 696d 6720 3d20   5.5):..  img = 
+00029ad0: 6164 6454 4341 6e67 6c65 7328 696d 6729  addTCAngles(img)
+00029ae0: 0d0a 2020 6e65 6420 3d20 6565 2e49 6d61  ..  ned = ee.Ima
+00029af0: 6765 2865 6c65 7661 7469 6f6e 496d 6167  ge(elevationImag
+00029b00: 6550 6174 6829 2e72 6573 616d 706c 6528  ePath).resample(
+00029b10: 2762 6963 7562 6963 2729 0d0a 2020 736c  'bicubic')..  sl
+00029b20: 6f70 6520 3d20 6565 2e54 6572 7261 696e  ope = ee.Terrain
+00029b30: 2e73 6c6f 7065 286e 6564 2e66 6f63 616c  .slope(ned.focal
+00029b40: 5f6d 6561 6e28 656c 6576 6174 696f 6e46  _mean(elevationF
+00029b50: 6f63 616c 4d65 616e 5261 6469 7573 2929  ocalMeanRadius))
+00029b60: 0d0a 2020 666c 6174 203d 2073 6c6f 7065  ..  flat = slope
+00029b70: 2e6c 7465 2873 6c6f 7065 5f74 6872 6573  .lte(slope_thres
+00029b80: 6829 0d0a 0d0a 2020 7761 7465 724d 6173  h)....  waterMas
+00029b90: 6b20 3d20 696d 672e 7365 6c65 6374 285b  k = img.select([
+00029ba0: 2774 6341 6e67 6c65 4257 275d 292e 6774  'tcAngleBW']).gt
+00029bb0: 6528 2d30 2e30 3529 5c0d 0a20 2020 202e  e(-0.05)\..    .
+00029bc0: 416e 6428 696d 672e 7365 6c65 6374 285b  And(img.select([
+00029bd0: 2774 6341 6e67 6c65 4247 275d 292e 6c74  'tcAngleBG']).lt
+00029be0: 6528 302e 3035 2929 5c0d 0a20 2020 202e  e(0.05))\..    .
+00029bf0: 416e 6428 696d 672e 7365 6c65 6374 285b  And(img.select([
+00029c00: 2762 7269 6768 746e 6573 7327 5d29 2e6c  'brightness']).l
+00029c10: 7428 302e 3329 295c 0d0a 2020 2020 2e41  t(0.3))\..    .A
+00029c20: 6e64 2866 6c61 7429 2e66 6f63 616c 5f6d  nd(flat).focal_m
+00029c30: 696e 2863 6f6e 7472 6163 7450 6978 656c  in(contractPixel
+00029c40: 7329 0d0a 0d0a 2020 7265 7475 726e 2077  s)....  return w
+00029c50: 6174 6572 4d61 736b 2e72 656e 616d 6528  aterMask.rename(
+00029c60: 5b27 7761 7465 724d 6173 6b27 5d29 0d0a  ['waterMask'])..
+00029c70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00029c80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00029c90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00029ca0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00029cb0: 2323 2323 230d 0a23 4a65 6666 2048 6f20  #####..#Jeff Ho 
+00029cc0: 4d65 7468 6f64 2066 6f72 2061 6c67 616c  Method for algal
+00029cd0: 2062 6c6f 6f6d 2064 6574 6563 7469 6f6e   bloom detection
+00029ce0: 0d0a 2368 7474 7073 3a2f 2f77 7777 2e6e  ..#https://www.n
+00029cf0: 6174 7572 652e 636f 6d2f 6172 7469 636c  ature.com/articl
+00029d00: 6573 2f73 3431 3538 362d 3031 392d 3136  es/s41586-019-16
+00029d10: 3438 2d37 0d0a 0d0a 2320 5369 6d70 6c69  48-7....# Simpli
+00029d20: 6669 6564 2053 6372 6970 7420 666f 7220  fied Script for 
+00029d30: 4c61 6e64 7361 7420 5761 7465 7220 5175  Landsat Water Qu
+00029d40: 616c 6974 790d 0a23 2050 726f 6475 6365  ality..# Produce
+00029d50: 7320 6120 6d61 7020 6f66 2061 6e20 616c  s a map of an al
+00029d60: 6761 6c20 626c 6f6f 6d20 696e 204c 616b  gal bloom in Lak
+00029d70: 6520 4572 6965 206f 6e20 3230 3131 2f39  e Erie on 2011/9
+00029d80: 2f33 0d0a 2320 4372 6561 7465 6420 6f6e  /3..# Created on
+00029d90: 2031 322f 372f 3230 3135 2062 7920 4a65   12/7/2015 by Je
+00029da0: 6666 2048 6f0d 0a0d 0a23 2053 7065 6369  ff Ho....# Speci
+00029db0: 6669 6573 2061 2074 6872 6573 686f 6c64  fies a threshold
+00029dc0: 2066 6f72 2068 7565 2074 6f20 6573 7469   for hue to esti
+00029dd0: 6d61 7465 2022 6772 6565 6e22 2070 6978  mate "green" pix
+00029de0: 656c 730d 0a23 2074 6869 7320 6973 2075  els..# this is u
+00029df0: 7365 6420 6173 2061 6e20 6164 6469 7469  sed as an additi
+00029e00: 6f6e 616c 2066 696c 7465 7220 746f 2072  onal filter to r
+00029e10: 6566 696e 6520 7468 6520 616c 676f 7269  efine the algori
+00029e20: 7468 6d20 6162 6f76 650d 0a64 6566 2048  thm above..def H
+00029e30: 6f43 616c 6347 7265 656e 6e65 7373 2869  oCalcGreenness(i
+00029e40: 6d67 293a 0d0a 2020 236d 6170 2072 2c20  mg):..  #map r, 
+00029e50: 672c 2061 6e64 2062 2066 6f72 206d 6f72  g, and b for mor
+00029e60: 6520 7265 6164 6162 6c65 2061 6c67 6562  e readable algeb
+00029e70: 7261 2062 656c 6f77 0d0a 2020 7220 3d20  ra below..  r = 
+00029e80: 696d 672e 7365 6c65 6374 285b 2772 6564  img.select(['red
+00029e90: 275d 290d 0a20 2067 203d 2069 6d67 2e73  '])..  g = img.s
+00029ea0: 656c 6563 7428 5b27 6772 6565 6e27 5d29  elect(['green'])
+00029eb0: 0d0a 2020 6220 3d20 696d 672e 7365 6c65  ..  b = img.sele
+00029ec0: 6374 285b 2762 6c75 6527 5d29 0d0a 0d0a  ct(['blue'])....
+00029ed0: 2020 2363 616c 6375 6c61 7465 2069 6e74    #calculate int
+00029ee0: 656e 7369 7479 2c20 6875 650d 0a20 2049  ensity, hue..  I
+00029ef0: 203d 2072 2e61 6464 2867 292e 6164 6428   = r.add(g).add(
+00029f00: 6229 2e72 656e 616d 6528 5b27 4927 5d29  b).rename(['I'])
+00029f10: 0d0a 2020 6d69 6e73 203d 2072 2e6d 696e  ..  mins = r.min
+00029f20: 2867 292e 6d69 6e28 6229 2e72 656e 616d  (g).min(b).renam
+00029f30: 6528 5b27 6d69 6e73 275d 290d 0a20 2048  e(['mins'])..  H
+00029f40: 203d 206d 696e 732e 7768 6572 6528 6d69   = mins.where(mi
+00029f50: 6e73 2e65 7128 7229 2c28 622e 7375 6274  ns.eq(r),(b.subt
+00029f60: 7261 6374 2872 2929 2e64 6976 6964 6528  ract(r)).divide(
+00029f70: 492e 7375 6274 7261 6374 2872 2e6d 756c  I.subtract(r.mul
+00029f80: 7469 706c 7928 3329 2929 2e61 6464 2831  tiply(3))).add(1
+00029f90: 2920 290d 0a20 2048 203d 2048 2e77 6865  ) )..  H = H.whe
+00029fa0: 7265 286d 696e 732e 6571 2867 292c 2872  re(mins.eq(g),(r
+00029fb0: 2e73 7562 7472 6163 7428 6729 292e 6469  .subtract(g)).di
+00029fc0: 7669 6465 2849 2e73 7562 7472 6163 7428  vide(I.subtract(
+00029fd0: 672e 6d75 6c74 6970 6c79 2833 2929 292e  g.multiply(3))).
+00029fe0: 6164 6428 3229 2029 0d0a 2020 4820 3d20  add(2) )..  H = 
+00029ff0: 482e 7768 6572 6528 6d69 6e73 2e65 7128  H.where(mins.eq(
+0002a000: 6229 2c28 672e 7375 6274 7261 6374 2862  b),(g.subtract(b
+0002a010: 2929 2e64 6976 6964 6528 492e 7375 6274  )).divide(I.subt
+0002a020: 7261 6374 2862 2e6d 756c 7469 706c 7928  ract(b.multiply(
+0002a030: 3329 2929 2029 0d0a 0d0a 2020 2370 6978  3))) )....  #pix
+0002a040: 656c 7320 7769 7468 2068 7565 2062 656c  els with hue bel
+0002a050: 6f77 2031 2e36 206d 6f72 6520 6c69 6b65  ow 1.6 more like
+0002a060: 6c79 2074 6f20 6265 2062 6c6f 6f6d 2061  ly to be bloom a
+0002a070: 6e64 206e 6f74 2073 7573 7065 6e64 6564  nd not suspended
+0002a080: 2073 6564 696d 656e 740d 0a20 2048 7468   sediment..  Hth
+0002a090: 7265 7368 203d 2048 2e6c 7465 2831 2e36  resh = H.lte(1.6
+0002a0a0: 290d 0a0d 0a20 2072 6574 7572 6e20 482e  )....  return H.
+0002a0b0: 7265 6e61 6d65 2827 4827 290d 0a0d 0a0d  rename('H').....
+0002a0c0: 0a23 4170 706c 7920 626c 6f6f 6d20 6465  .#Apply bloom de
+0002a0d0: 7465 6374 696f 6e20 616c 676f 7269 7468  tection algorith
+0002a0e0: 6d0d 0a64 6566 2048 6f43 616c 6341 6c67  m..def HoCalcAlg
+0002a0f0: 6f72 6974 686d 3128 696d 6167 6529 3a0d  orithm1(image):.
+0002a100: 0a20 2074 7275 6563 6f6c 6f72 203d 2031  .  truecolor = 1
+0002a110: 2023 7368 6f77 2074 7275 6520 636f 6c6f   #show true colo
+0002a120: 7220 696d 6167 6520 6173 2077 656c 6c0d  r image as well.
+0002a130: 0a20 2074 6573 7454 6872 6573 6820 3d20  .  testThresh = 
+0002a140: 4661 6c73 6520 2320 6164 6420 6120 6269  False # add a bi
+0002a150: 6e61 7279 2069 6d61 6765 2063 6c61 7373  nary image class
+0002a160: 6966 7969 6e67 2069 6e74 6f20 2262 6c6f  ifying into "blo
+0002a170: 6f6d 2261 6e64 2022 6e6f 6e2d 626c 6f6f  om"and "non-bloo
+0002a180: 6d0d 0a20 2062 6c6f 6f6d 5468 7265 7368  m..  bloomThresh
+0002a190: 6f6c 6420 3d20 302e 3032 3334 3620 2374  old = 0.02346 #t
+0002a1a0: 6872 6573 686f 6c64 2066 6f72 2063 6c61  hreshold for cla
+0002a1b0: 7373 6966 6963 6174 696f 6e20 6669 7420  ssification fit 
+0002a1c0: 6261 7365 6420 6f6e 206f 7468 6572 2064  based on other d
+0002a1d0: 6174 610d 0a20 2067 7265 656e 6573 7354  ata..  greenessT
+0002a1e0: 6872 6573 686f 6c64 203d 2031 2e36 0d0a  hreshold = 1.6..
+0002a1f0: 0d0a 2020 2320 416c 676f 7269 7468 6d20  ..  # Algorithm 
+0002a200: 3120 6261 7365 6420 6f6e 3a0d 0a20 2023  1 based on:..  #
+0002a210: 2057 616e 672c 204d 2e2c 2026 2053 6869   Wang, M., & Shi
+0002a220: 2c20 572e 2028 3230 3037 292e 2054 6865  , W. (2007). The
+0002a230: 204e 4952 2d53 5749 5220 636f 6d62 696e   NIR-SWIR combin
+0002a240: 6564 2061 746d 6f73 7068 6572 6963 0d0a  ed atmospheric..
+0002a250: 2020 2320 2063 6f72 7265 6374 696f 6e20    #  correction 
+0002a260: 6170 7072 6f61 6368 2066 6f72 204d 4f44  approach for MOD
+0002a270: 4953 206f 6365 616e 2063 6f6c 6f72 2064  IS ocean color d
+0002a280: 6174 6120 7072 6f63 6573 7369 6e67 2e0d  ata processing..
+0002a290: 0a20 2023 2020 4f70 7469 6373 2045 7870  .  #  Optics Exp
+0002a2a0: 7265 7373 2c20 3135 2832 3429 2c20 3135  ress, 15(24), 15
+0002a2b0: 3732 32e2 8093 3135 3733 332e 0d0a 0d0a  722...15733.....
+0002a2c0: 2020 2320 4164 6420 7365 636f 6e64 6172    # Add secondar
+0002a2d0: 7920 6669 6c74 6572 2075 7369 6e67 2067  y filter using g
+0002a2e0: 7265 656e 6e65 7373 2066 756e 6374 696f  reenness functio
+0002a2f0: 6e20 6265 6c6f 770d 0a20 2069 6d61 6765  n below..  image
+0002a300: 203d 2069 6d61 6765 2e61 6464 4261 6e64   = image.addBand
+0002a310: 7328 486f 4361 6c63 4772 6565 6e6e 6573  s(HoCalcGreennes
+0002a320: 7328 696d 6167 6529 290d 0a0d 0a20 2023  s(image))....  #
+0002a330: 2041 7070 6c79 2061 6c67 6f72 6974 686d   Apply algorithm
+0002a340: 2031 3a20 4234 202d 2031 2e30 332a 4235   1: B4 - 1.03*B5
+0002a350: 0d0a 2020 2362 6c6f 6f6d 3120 3d20 696d  ..  #bloom1 = im
+0002a360: 6167 652e 7365 6c65 6374 2827 6e69 7227  age.select('nir'
+0002a370: 292e 7375 6274 7261 6374 2869 6d61 6765  ).subtract(image
+0002a380: 2e73 656c 6563 7428 2773 7769 7231 2729  .select('swir1')
+0002a390: 2e6d 756c 7469 706c 7928 312e 3033 2929  .multiply(1.03))
+0002a3a0: 2e72 656e 616d 6528 2762 6c6f 6f6d 3127  .rename('bloom1'
+0002a3b0: 290d 0a0d 0a20 2023 2047 6574 2062 696e  )....  # Get bin
+0002a3c0: 6172 7920 696d 6167 6520 6279 2061 7070  ary image by app
+0002a3d0: 6c79 696e 6720 7468 6520 7468 7265 7368  lying the thresh
+0002a3e0: 6f6c 640d 0a20 2062 6c6f 6f6d 315f 6d61  old..  bloom1_ma
+0002a3f0: 736b 203d 2069 6d61 6765 2e73 656c 6563  sk = image.selec
+0002a400: 7428 2248 2229 2e6c 7465 2867 7265 656e  t("H").lte(green
+0002a410: 6573 7354 6872 6573 686f 6c64 292e 7265  essThreshold).re
+0002a420: 6e61 6d65 285b 2262 6c6f 6f6d 315f 6d61  name(["bloom1_ma
+0002a430: 736b 225d 290d 0a0d 0a0d 0a20 2072 6574  sk"])......  ret
+0002a440: 7572 6e20 696d 6167 655c 0d0a 2020 2020  urn image\..    
+0002a450: 2020 2020 2020 2e61 6464 4261 6e64 7328        .addBands(
+0002a460: 626c 6f6f 6d31 295c 0d0a 2020 2020 2020  bloom1)\..      
+0002a470: 2020 2020 2e61 6464 4261 6e64 7328 626c      .addBands(bl
+0002a480: 6f6f 6d31 5f6d 6173 6b29 0d0a 0d0a 0d0a  oom1_mask)......
+0002a490: 0d0a 0d0a 2320 2f2f 2f2f 2f2f 2f2f 2f2f  ....# //////////
+0002a4a0: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
+0002a4b0: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
+0002a4c0: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
+0002a4d0: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
+0002a4e0: 0d0a 2320 2f2f 2045 4e44 2046 554e 4354  ..# // END FUNCT
+0002a4f0: 494f 4e53 0d0a 2320 2f2f 2f2f 2f2f 2f2f  IONS..# ////////
 0002a500: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
 0002a510: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
 0002a520: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
 0002a530: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
-0002a540: 2f2f 2f0d 0a23 202f 2f20 454e 4420 4655  ///..# // END FU
-0002a550: 4e43 5449 4f4e 530d 0a23 202f 2f2f 2f2f  NCTIONS..# /////
-0002a560: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
-0002a570: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
-0002a580: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
-0002a590: 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f 2f2f  ////////////////
-0002a5a0: 2f2f 2f2f 2f2f 2f2f 2f2f 2f0d 0a0d 0a0d  ///////////.....
-0002a5b0: 0a74 6573 7441 7265 6173 203d 207b 7d3b  .testAreas = {};
-0002a5c0: 0d0a 7465 7374 4172 6561 735b 2743 4f27  ..testAreas['CO'
-0002a5d0: 5d20 3d20 6565 2e47 656f 6d65 7472 792e  ] = ee.Geometry.
-0002a5e0: 506f 6c79 676f 6e28 0d0a 2020 2020 2020  Polygon(..      
-0002a5f0: 2020 5b5b 5b2d 3130 382e 3238 3633 3035    [[[-108.286305
-0002a600: 3039 3036 3437 3539 2c20 3338 2e30 3835  09064759, 38.085
-0002a610: 3334 3336 3338 3132 3039 3235 5d2c 0d0a  343638120925],..
-0002a620: 2020 2020 2020 2020 2020 5b2d 3130 382e            [-108.
-0002a630: 3238 3633 3035 3039 3036 3437 3539 2c20  28630509064759, 
-0002a640: 3337 2e31 3830 3531 3232 3030 3932 3934  37.1805122009294
-0002a650: 355d 2c0d 0a20 2020 2020 2020 2020 205b  5],..          [
-0002a660: 2d31 3036 2e37 3438 3231 3931 3533 3134  -106.74821915314
-0002a670: 3735 392c 2033 372e 3138 3035 3132 3230  759, 37.18051220
-0002a680: 3039 3239 3435 5d2c 0d0a 2020 2020 2020  092945],..      
-0002a690: 2020 2020 5b2d 3130 362e 3734 3832 3139      [-106.748219
-0002a6a0: 3135 3331 3437 3539 2c20 3338 2e30 3835  15314759, 38.085
-0002a6b0: 3334 3336 3338 3132 3039 3235 5d5d 5d2c  343638120925]]],
-0002a6c0: 204e 6f6e 652c 2046 616c 7365 290d 0a74   None, False)..t
-0002a6d0: 6573 7441 7265 6173 5b27 434f 5f4e 6f72  estAreas['CO_Nor
-0002a6e0: 7468 275d 203d 2065 652e 4765 6f6d 6574  th'] = ee.Geomet
-0002a6f0: 7279 2e50 6f6c 7967 6f6e 280d 0a20 2020  ry.Polygon(..   
-0002a700: 2020 2020 205b 5b5b 2d31 3036 2e34 3139       [[[-106.419
-0002a710: 3737 3836 3933 3339 3532 342c 2034 302e  77869339524, 40.
-0002a720: 3937 3934 3737 3032 3339 3332 3334 5d2c  97947702393234],
-0002a730: 0d0a 2020 2020 2020 2020 2020 5b2d 3130  ..          [-10
-0002a740: 362e 3431 3937 3738 3639 3333 3935 3234  6.41977869339524
-0002a750: 2c20 3339 2e39 3634 3036 3332 3138 3134  , 39.96406321814
-0002a760: 3030 315d 2c0d 0a20 2020 2020 2020 2020  001],..         
-0002a770: 205b 2d31 3035 2e32 3035 3738 3934 3335   [-105.205789435
-0002a780: 3538 3237 342c 2033 392e 3936 3430 3633  58274, 39.964063
-0002a790: 3231 3831 3430 3031 5d2c 0d0a 2020 2020  21814001],..    
-0002a7a0: 2020 2020 2020 5b2d 3130 352e 3230 3537        [-105.2057
-0002a7b0: 3839 3433 3535 3832 3734 2c20 3430 2e39  8943558274, 40.9
-0002a7c0: 3739 3437 3730 3233 3933 3233 345d 5d5d  7947702393234]]]
-0002a7d0: 2c20 4e6f 6e65 2c20 4661 6c73 6529 0d0a  , None, False)..
-0002a7e0: 7465 7374 4172 6561 735b 2743 4127 5d20  testAreas['CA'] 
-0002a7f0: 3d65 652e 4765 6f6d 6574 7279 2e50 6f6c  =ee.Geometry.Pol
-0002a800: 7967 6f6e 280d 0a20 2020 2020 2020 205b  ygon(..        [
-0002a810: 5b5b 2d31 3139 2e39 3633 3833 3736 3032  [[-119.963837602
-0002a820: 3837 3530 362c 2033 372e 3133 3831 3530  87506, 37.138150
-0002a830: 3537 3431 3038 3731 345d 2c0d 0a20 2020  574108714],..   
-0002a840: 2020 2020 2020 205b 2d31 3139 2e39 3633         [-119.963
-0002a850: 3833 3736 3032 3837 3530 362c 2033 362e  83760287506, 36.
-0002a860: 3430 3737 3434 3132 3130 3634 3234 5d2c  40774412106424],
-0002a870: 0d0a 2020 2020 2020 2020 2020 5b2d 3131  ..          [-11
-0002a880: 372e 3935 3333 3339 3535 3630 3030 3036  7.95333955600006
-0002a890: 2c20 3336 2e34 3037 3734 3431 3231 3036  , 36.40774412106
-0002a8a0: 3432 345d 2c0d 0a20 2020 2020 2020 2020  424],..         
-0002a8b0: 205b 2d31 3137 2e39 3533 3333 3935 3536   [-117.953339556
-0002a8c0: 3030 3030 362c 2033 372e 3133 3831 3530  00006, 37.138150
-0002a8d0: 3537 3431 3038 3731 345d 5d5d 2c20 4e6f  574108714]]], No
-0002a8e0: 6e65 2c20 4661 6c73 6529 0d0a 0d0a 7465  ne, False)....te
-0002a8f0: 7374 4172 6561 735b 2743 415f 536d 616c  stAreas['CA_Smal
-0002a900: 6c27 5d20 3d20 6565 2e47 656f 6d65 7472  l'] = ee.Geometr
-0002a910: 792e 506f 6c79 676f 6e28 0d0a 2020 2020  y.Polygon(..    
-0002a920: 2020 2020 5b5b 5b2d 3132 332e 3232 3536      [[[-123.2256
-0002a930: 3639 3638 3337 3436 3235 2c20 3339 2e36  6968374625, 39.6
-0002a940: 3737 3230 3935 3939 3236 3931 3535 5d2c  77209599269155],
-0002a950: 0d0a 2020 2020 2020 2020 2020 5b2d 3132  ..          [-12
-0002a960: 332e 3232 3536 3639 3638 3337 3436 3235  3.22566968374625
-0002a970: 2c20 3338 2e39 3933 3137 3935 3034 3639  , 38.99317950469
-0002a980: 3735 3836 5d2c 0d0a 2020 2020 2020 2020  7586],..        
-0002a990: 2020 5b2d 3132 322e 3630 3439 3432 3134    [-122.60494214
-0002a9a0: 3436 3833 3735 2c20 3338 2e39 3933 3137  468375, 38.99317
-0002a9b0: 3935 3034 3639 3735 3836 5d2c 0d0a 2020  9504697586],..  
-0002a9c0: 2020 2020 2020 2020 5b2d 3132 322e 3630          [-122.60
-0002a9d0: 3439 3432 3134 3436 3833 3735 2c20 3339  494214468375, 39
-0002a9e0: 2e36 3737 3230 3935 3939 3236 3931 3535  .677209599269155
-0002a9f0: 5d5d 5d2c 204e 6f6e 652c 2046 616c 7365  ]]], None, False
-0002aa00: 290d 0a0d 0a74 6573 7441 7265 6173 5b27  )....testAreas['
-0002aa10: 4849 275d 203d 2065 652e 4765 6f6d 6574  HI'] = ee.Geomet
-0002aa20: 7279 2e50 6f6c 7967 6f6e 280d 0a20 2020  ry.Polygon(..   
-0002aa30: 2020 2020 205b 5b5b 2d31 3630 2e35 3038       [[[-160.508
-0002aa40: 3234 3837 3434 3530 3534 342c 2032 322e  24874450544, 22.
-0002aa50: 3635 3938 3134 3531 3339 3039 3437 345d  659814513909474]
-0002aa60: 2c0d 0a20 2020 2020 2020 2020 205b 2d31  ,..          [-1
-0002aa70: 3630 2e35 3038 3234 3837 3434 3530 3534  60.5082487445054
-0002aa80: 342c 2031 382e 3534 3735 3033 3039 3935  4, 18.5475030995
-0002aa90: 3938 3237 5d2c 0d0a 2020 2020 2020 2020  9827],..        
-0002aaa0: 2020 5b2d 3135 342e 3335 3539 3034 3939    [-154.35590499
-0002aab0: 3435 3035 3434 2c20 3138 2e35 3437 3530  450544, 18.54750
-0002aac0: 3330 3939 3539 3832 375d 2c0d 0a20 2020  309959827],..   
-0002aad0: 2020 2020 2020 205b 2d31 3534 2e33 3535         [-154.355
-0002aae0: 3930 3439 3934 3530 3534 342c 2032 322e  90499450544, 22.
-0002aaf0: 3635 3938 3134 3531 3339 3039 3437 345d  659814513909474]
-0002ab00: 5d5d 2c20 4e6f 6e65 2c20 4661 6c73 6529  ]], None, False)
-0002ab10: 0d0a                                     ..
+0002a540: 2f2f 2f2f 2f2f 2f2f 0d0a 0d0a 0d0a 7465  ////////......te
+0002a550: 7374 4172 6561 7320 3d20 7b7d 3b0d 0a74  stAreas = {};..t
+0002a560: 6573 7441 7265 6173 5b27 434f 275d 203d  estAreas['CO'] =
+0002a570: 2065 652e 4765 6f6d 6574 7279 2e50 6f6c   ee.Geometry.Pol
+0002a580: 7967 6f6e 280d 0a20 2020 2020 2020 205b  ygon(..        [
+0002a590: 5b5b 2d31 3038 2e32 3836 3330 3530 3930  [[-108.286305090
+0002a5a0: 3634 3735 392c 2033 382e 3038 3533 3433  64759, 38.085343
+0002a5b0: 3633 3831 3230 3932 355d 2c0d 0a20 2020  638120925],..   
+0002a5c0: 2020 2020 2020 205b 2d31 3038 2e32 3836         [-108.286
+0002a5d0: 3330 3530 3930 3634 3735 392c 2033 372e  30509064759, 37.
+0002a5e0: 3138 3035 3132 3230 3039 3239 3435 5d2c  18051220092945],
+0002a5f0: 0d0a 2020 2020 2020 2020 2020 5b2d 3130  ..          [-10
+0002a600: 362e 3734 3832 3139 3135 3331 3437 3539  6.74821915314759
+0002a610: 2c20 3337 2e31 3830 3531 3232 3030 3932  , 37.18051220092
+0002a620: 3934 355d 2c0d 0a20 2020 2020 2020 2020  945],..         
+0002a630: 205b 2d31 3036 2e37 3438 3231 3931 3533   [-106.748219153
+0002a640: 3134 3735 392c 2033 382e 3038 3533 3433  14759, 38.085343
+0002a650: 3633 3831 3230 3932 355d 5d5d 2c20 4e6f  638120925]]], No
+0002a660: 6e65 2c20 4661 6c73 6529 0d0a 7465 7374  ne, False)..test
+0002a670: 4172 6561 735b 2743 4f5f 4e6f 7274 6827  Areas['CO_North'
+0002a680: 5d20 3d20 6565 2e47 656f 6d65 7472 792e  ] = ee.Geometry.
+0002a690: 506f 6c79 676f 6e28 0d0a 2020 2020 2020  Polygon(..      
+0002a6a0: 2020 5b5b 5b2d 3130 362e 3431 3937 3738    [[[-106.419778
+0002a6b0: 3639 3333 3935 3234 2c20 3430 2e39 3739  69339524, 40.979
+0002a6c0: 3437 3730 3233 3933 3233 345d 2c0d 0a20  47702393234],.. 
+0002a6d0: 2020 2020 2020 2020 205b 2d31 3036 2e34           [-106.4
+0002a6e0: 3139 3737 3836 3933 3339 3532 342c 2033  1977869339524, 3
+0002a6f0: 392e 3936 3430 3633 3231 3831 3430 3031  9.96406321814001
+0002a700: 5d2c 0d0a 2020 2020 2020 2020 2020 5b2d  ],..          [-
+0002a710: 3130 352e 3230 3537 3839 3433 3535 3832  105.205789435582
+0002a720: 3734 2c20 3339 2e39 3634 3036 3332 3138  74, 39.964063218
+0002a730: 3134 3030 315d 2c0d 0a20 2020 2020 2020  14001],..       
+0002a740: 2020 205b 2d31 3035 2e32 3035 3738 3934     [-105.2057894
+0002a750: 3335 3538 3237 342c 2034 302e 3937 3934  3558274, 40.9794
+0002a760: 3737 3032 3339 3332 3334 5d5d 5d2c 204e  7702393234]]], N
+0002a770: 6f6e 652c 2046 616c 7365 290d 0a74 6573  one, False)..tes
+0002a780: 7441 7265 6173 5b27 4341 275d 203d 6565  tAreas['CA'] =ee
+0002a790: 2e47 656f 6d65 7472 792e 506f 6c79 676f  .Geometry.Polygo
+0002a7a0: 6e28 0d0a 2020 2020 2020 2020 5b5b 5b2d  n(..        [[[-
+0002a7b0: 3131 392e 3936 3338 3337 3630 3238 3735  119.963837602875
+0002a7c0: 3036 2c20 3337 2e31 3338 3135 3035 3734  06, 37.138150574
+0002a7d0: 3130 3837 3134 5d2c 0d0a 2020 2020 2020  108714],..      
+0002a7e0: 2020 2020 5b2d 3131 392e 3936 3338 3337      [-119.963837
+0002a7f0: 3630 3238 3735 3036 2c20 3336 2e34 3037  60287506, 36.407
+0002a800: 3734 3431 3231 3036 3432 345d 2c0d 0a20  74412106424],.. 
+0002a810: 2020 2020 2020 2020 205b 2d31 3137 2e39           [-117.9
+0002a820: 3533 3333 3935 3536 3030 3030 362c 2033  5333955600006, 3
+0002a830: 362e 3430 3737 3434 3132 3130 3634 3234  6.40774412106424
+0002a840: 5d2c 0d0a 2020 2020 2020 2020 2020 5b2d  ],..          [-
+0002a850: 3131 372e 3935 3333 3339 3535 3630 3030  117.953339556000
+0002a860: 3036 2c20 3337 2e31 3338 3135 3035 3734  06, 37.138150574
+0002a870: 3130 3837 3134 5d5d 5d2c 204e 6f6e 652c  108714]]], None,
+0002a880: 2046 616c 7365 290d 0a0d 0a74 6573 7441   False)....testA
+0002a890: 7265 6173 5b27 4341 5f53 6d61 6c6c 275d  reas['CA_Small']
+0002a8a0: 203d 2065 652e 4765 6f6d 6574 7279 2e50   = ee.Geometry.P
+0002a8b0: 6f6c 7967 6f6e 280d 0a20 2020 2020 2020  olygon(..       
+0002a8c0: 205b 5b5b 2d31 3233 2e32 3235 3636 3936   [[[-123.2256696
+0002a8d0: 3833 3734 3632 352c 2033 392e 3637 3732  8374625, 39.6772
+0002a8e0: 3039 3539 3932 3639 3135 355d 2c0d 0a20  09599269155],.. 
+0002a8f0: 2020 2020 2020 2020 205b 2d31 3233 2e32           [-123.2
+0002a900: 3235 3636 3936 3833 3734 3632 352c 2033  2566968374625, 3
+0002a910: 382e 3939 3331 3739 3530 3436 3937 3538  8.99317950469758
+0002a920: 365d 2c0d 0a20 2020 2020 2020 2020 205b  6],..          [
+0002a930: 2d31 3232 2e36 3034 3934 3231 3434 3638  -122.60494214468
+0002a940: 3337 352c 2033 382e 3939 3331 3739 3530  375, 38.99317950
+0002a950: 3436 3937 3538 365d 2c0d 0a20 2020 2020  4697586],..     
+0002a960: 2020 2020 205b 2d31 3232 2e36 3034 3934       [-122.60494
+0002a970: 3231 3434 3638 3337 352c 2033 392e 3637  214468375, 39.67
+0002a980: 3732 3039 3539 3932 3639 3135 355d 5d5d  7209599269155]]]
+0002a990: 2c20 4e6f 6e65 2c20 4661 6c73 6529 0d0a  , None, False)..
+0002a9a0: 0d0a 7465 7374 4172 6561 735b 2748 4927  ..testAreas['HI'
+0002a9b0: 5d20 3d20 6565 2e47 656f 6d65 7472 792e  ] = ee.Geometry.
+0002a9c0: 506f 6c79 676f 6e28 0d0a 2020 2020 2020  Polygon(..      
+0002a9d0: 2020 5b5b 5b2d 3136 302e 3530 3832 3438    [[[-160.508248
+0002a9e0: 3734 3435 3035 3434 2c20 3232 2e36 3539  74450544, 22.659
+0002a9f0: 3831 3435 3133 3930 3934 3734 5d2c 0d0a  814513909474],..
+0002aa00: 2020 2020 2020 2020 2020 5b2d 3136 302e            [-160.
+0002aa10: 3530 3832 3438 3734 3435 3035 3434 2c20  50824874450544, 
+0002aa20: 3138 2e35 3437 3530 3330 3939 3539 3832  18.5475030995982
+0002aa30: 375d 2c0d 0a20 2020 2020 2020 2020 205b  7],..          [
+0002aa40: 2d31 3534 2e33 3535 3930 3439 3934 3530  -154.35590499450
+0002aa50: 3534 342c 2031 382e 3534 3735 3033 3039  544, 18.54750309
+0002aa60: 3935 3938 3237 5d2c 0d0a 2020 2020 2020  959827],..      
+0002aa70: 2020 2020 5b2d 3135 342e 3335 3539 3034      [-154.355904
+0002aa80: 3939 3435 3035 3434 2c20 3232 2e36 3539  99450544, 22.659
+0002aa90: 3831 3435 3133 3930 3934 3734 5d5d 5d2c  814513909474]]],
+0002aaa0: 204e 6f6e 652c 2046 616c 7365 290d 0a     None, False)..
```

### Comparing `geeViz-2023.6.1/geeViz/migrateGEEAssets.py` & `geeViz-2023.7.1/geeViz/migrateGEEAssets.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/phEEnoViz.py` & `geeViz-2023.7.1/geeViz/phEEnoViz.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz/taskManagerLib.py` & `geeViz-2023.7.1/geeViz/taskManagerLib.py`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/geeViz.egg-info/PKG-INFO` & `geeViz-2023.7.1/geeViz.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: geeViz
-Version: 2023.6.1
+Version: 2023.7.1
 Summary: A package to help with GEE data processing, analysis, and visualization
 Home-page: https://github.com/gee-community/geeViz
 Author: Ian Housman
 Author-email: ian.housman@gmail.com
 License: Apache
 Keywords: earthengine google remote sensing landsat sentinel modis forestry forest
 Classifier: Programming Language :: Python :: 3
```

### Comparing `geeViz-2023.6.1/geeViz.egg-info/SOURCES.txt` & `geeViz-2023.7.1/geeViz.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `geeViz-2023.6.1/setup.py` & `geeViz-2023.7.1/setup.py`

 * *Files identical despite different names*

